<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Divalent Ionic Crystals (BaO, NaCl Structure): Cohesive Energy of Ba⁺O⁻ vs Ba²⁺O²⁻</title>
  <style>
    :root{
      --bg: #0b0d12;
      --panel: #111522;
      --panel2:#0f1320;
      --text: #e9ecf5;
      --muted:#b9c0d6;
      --faint:#7f8aa8;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line: rgba(255,255,255,.10);
      --shadow: 0 10px 28px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f8fc;
        --panel:#ffffff;
        --panel2:#fbfbff;
        --text:#0b1220;
        --muted:#334155;
        --faint:#64748b;
        --line: rgba(2,6,23,.10);
        --shadow: 0 12px 30px rgba(2,6,23,.10);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 600px at 20% 0%, rgba(125,211,252,.10), transparent 60%),
                  radial-gradient(900px 520px at 90% 10%, rgba(167,139,250,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      line-height:1.6;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding: 28px 18px 10px;
      position:relative;
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      padding: 0 18px 60px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
    }
    .hero{
      max-width:1200px;
      margin:0 auto;
      padding: 0 18px 10px;
    }
    .titleCard{
      background: linear-gradient(180deg, rgba(125,211,252,.10), transparent 55%),
                  linear-gradient(90deg, rgba(167,139,250,.10), transparent 55%),
                  var(--panel);
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      border-radius: var(--radius2);
      padding: 18px 18px 16px;
      overflow:hidden;
      position:relative;
      transform: translateY(0);
      transition: transform .25s ease, box-shadow .25s ease;
    }
    .titleCard:hover{ transform: translateY(-2px); box-shadow: 0 14px 34px rgba(0,0,0,.22); }
    .kicker{
      color:var(--muted);
      font-size:13px;
      letter-spacing:.12em;
      text-transform:uppercase;
      margin:0 0 8px;
    }
    h1{
      margin:0 0 10px;
      font-size: clamp(22px, 2.2vw, 34px);
      line-height:1.2;
    }
    .sub{
      margin:0;
      color:var(--muted);
      max-width: 90ch;
    }

    /* TOC */
    aside{
      position:relative;
    }
    .toc{
      position: sticky;
      top: 14px;
      background: var(--panel);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 12px;
    }
    .toc h2{
      font-size:14px;
      margin:0 0 10px;
      color:var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .toc nav a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--text);
      border:1px solid transparent;
      transition: background .18s ease, transform .18s ease, border-color .18s ease;
      font-size:14px;
    }
    .toc nav a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
      transform: translateX(2px);
      text-decoration:none;
    }
    .toc nav a.active{
      background: rgba(167,139,250,.12);
      border-color: rgba(167,139,250,.30);
    }
    .toc .mini{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed var(--line);
      color:var(--faint);
      font-size:12px;
    }

    main{
      min-width:0;
    }
    section{
      background: var(--panel);
      border:1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 18px;
      margin-bottom: 16px;
      overflow:hidden;
    }
    section h2{
      margin:0 0 10px;
      font-size: 20px;
      line-height:1.25;
    }
    section h3{
      margin: 16px 0 8px;
      font-size: 16px;
      color: var(--muted);
    }
    p{margin: 10px 0}
    ul{margin: 8px 0 8px 20px}
    li{margin: 6px 0}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 760px){
      .grid2{grid-template-columns:1fr}
    }

    .callout{
      border:1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent 40%),
                  var(--panel2);
      padding: 12px 12px 10px;
      margin: 12px 0;
    }
    .callout strong{color:var(--accent)}
    .callout.bad strong{color:var(--bad)}
    .callout.warn strong{color:var(--warn)}
    .callout.good strong{color:var(--good)}
    .badgeRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(125,211,252,.10);
      color: var(--text);
      white-space:nowrap;
    }
    .badge.alt{background: rgba(167,139,250,.10)}
    .badge.dim{background: rgba(148,163,184,.10); color:var(--muted)}
    .eqCard{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(0,0,0,.12);
      padding: 12px;
      margin: 12px 0;
    }
    .eqTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .eqTop .label{
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--muted);
    }
    pre{
      margin:0;
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      overflow:auto;
      font-family: var(--mono);
      font-size: 13px;
      line-height:1.55;
      white-space: pre;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(125,211,252,.12);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 13px;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,.18);
      border-color: rgba(125,211,252,.35);
    }
    .btn:active{transform: translateY(0)}
    .btn.alt{background: rgba(167,139,250,.14)}
    .btn.alt:hover{background: rgba(167,139,250,.20); border-color: rgba(167,139,250,.35)}
    .muted{color:var(--muted)}
    .faint{color:var(--faint)}
    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.08);
    }
    .table th, .table td{
      padding: 10px 10px;
      border-bottom:1px solid var(--line);
      text-align:left;
      vertical-align:top;
      font-size:14px;
    }
    .table th{
      color: var(--muted);
      font-weight:600;
      background: rgba(255,255,255,.03);
    }
    .table tr:last-child td{border-bottom:none}

    details{
      border:1px dashed var(--line);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(0,0,0,.06);
      margin: 12px 0;
    }
    details summary{
      cursor:pointer;
      font-weight:600;
      color: var(--accent);
      user-select:none;
      outline:none;
    }

    figure{
      margin: 12px 0 2px;
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 10px;
      background: rgba(0,0,0,.08);
      overflow:hidden;
    }
    figcaption{
      margin-top:8px;
      color: var(--muted);
      font-size: 13px;
    }
    canvas{width:100%; height:auto; display:block}

    .backTop{
      display:inline-block;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(148,163,184,.10);
      color: var(--text);
      font-size: 13px;
      transition: transform .15s ease, background .15s ease;
    }
    .backTop:hover{transform: translateY(-1px); background: rgba(148,163,184,.16); text-decoration:none}

    footer{
      max-width:1200px;
      margin:0 auto;
      padding: 0 18px 36px;
      color: var(--faint);
      font-size: 13px;
    }

    /* print */
    @media print{
      body{background:#fff; color:#000}
      .wrap{grid-template-columns:1fr; padding:0}
      aside{display:none}
      header{padding:0}
      section, .titleCard{
        box-shadow:none;
        border:1px solid #ccc;
        break-inside: avoid;
      }
      a{color:#000; text-decoration:underline}
      .btn{display:none}
      pre{background:#f6f6f6}
      figure{break-inside: avoid}
    }
  </style>
</head>

<body>
  <a id="top"></a>
  <header>
    <div class="hero">
      <div class="titleCard">
        <p class="kicker">Crystal Binding • Electrostatics • Lattice Energy</p>
        <h1>Divalent Ionic Crystals (BaO, NaCl Structure): Which Valence State Wins—Ba⁺O⁻ or Ba²⁺O²⁻?</h1>
        <p class="sub">
          We estimate the cohesive energy per BaO “molecule” for two hypothetical ionic charge states using a clean
          electrostatic lattice model (Madelung energy) plus atomic ionization/affinity energetics, referenced to
          <em>separated neutral atoms</em>. Repulsion is neglected (as requested), so the math focuses on Coulomb fields in a periodic lattice.
        </p>
        <div class="badgeRow">
          <span class="badge">NaCl structure (rocksalt)</span>
          <span class="badge alt">Madelung constant α</span>
          <span class="badge dim">Reference: neutral atoms → ions → crystal</span>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <aside>
      <div class="toc" aria-label="Table of contents">
        <h2>Table of Contents</h2>
        <nav id="tocNav">
          <a href="#quick">Quick Summary</a>
          <a href="#part0">PART 0 — Concept Primer</a>
          <a href="#part0b">PART 0B — Industry & Applied Physics</a>
          <a href="#part1">PART 1 — Problem Analysis</a>
          <a href="#part2">PART 2 — Strategy & Tips</a>
          <a href="#part3">PART 3 — Full Solution</a>
          <a href="#part4">PART 4 — Deeper Understanding</a>
          <a href="#part5">PART 5 — Optional Plot Guide</a>
        </nav>
        <div class="mini">
          Tip: use the copy buttons to grab equations and the final numeric results as plain text.
        </div>
      </div>
    </aside>

    <main>
      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><strong>What this is about:</strong> Compare cohesive energies of BaO (NaCl lattice) for two charge assignments: (Ba⁺, O⁻) vs (Ba²⁺, O²⁻), referenced to separated <em>neutral</em> Ba and O atoms.</li>
          <li><strong>Key physics idea:</strong> Total energy = (atomic ionization costs) − (electron affinity gains) + (electrostatic lattice binding).</li>
          <li><strong>Governing lattice equation:</strong> Electrostatic potential in a periodic point-charge lattice, ultimately giving the Madelung energy
            <span class="muted">U<sub>lat</sub> = −α |z<sub>+</sub>z<sub>−</sub>| (e² / (4πϵ₀R₀))</span>.</li>
          <li><strong>Given data:</strong> R₀ = 2.76 Å; Ba ionization potentials: I₁ = 5.19 eV, I₂ = 9.96 eV; O electron affinities: EA₁ = +1.5 eV, EA₂ = −9.0 eV (second addition is endothermic).</li>
          <li><strong>Model choice:</strong> Neglect repulsive/overlap energy, treat ions as point charges in an infinite NaCl lattice (Madelung constant α ≈ 1.74756).</li>
          <li><strong>Numeric results (per BaO pair):</strong>
            Ba⁺O⁻: cohesive energy ≈ <strong>5.43 eV</strong>;
            Ba²⁺O²⁻: cohesive energy ≈ <strong>13.82 eV</strong>.</li>
          <li><strong>Physical meaning:</strong> The divalent state gains much stronger Coulomb binding (∝ z²) and wins despite the costly second electron attachment to oxygen.</li>
          <li><strong>Prediction:</strong> The crystal favors <strong>Ba²⁺O²⁻</strong> (consistent with real BaO being largely ionic and divalent).</li>
        </ul>
        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <h3>0.1 Core definitions (symbols + SI units)</h3>
        <div class="callout">
          <ul>
            <li><strong>R₀</strong> — nearest-neighbor ion separation (m). Here, R₀ = 2.76 Å = 2.76×10⁻¹⁰ m.</li>
            <li><strong>e</strong> — elementary charge (C).</li>
            <li><strong>ϵ₀</strong> — vacuum permittivity (F/m).</li>
            <li><strong>z<sub>+</sub>, z<sub>−</sub></strong> — ionic valences (dimensionless): charges are +z<sub>+</sub>e and −z<sub>−</sub>e.</li>
            <li><strong>α</strong> — Madelung constant (dimensionless), depends only on lattice geometry. For NaCl structure: α ≈ 1.74756.</li>
            <li><strong>I₁, I₂</strong> — successive ionization energies (eV): energy required to remove electrons from Ba.</li>
            <li><strong>EA₁, EA₂</strong> — successive electron affinities of oxygen (eV), interpreted as “energy released” upon adding each electron. Negative means energy is required (endothermic).</li>
            <li><strong>U<sub>lat</sub></strong> — electrostatic lattice energy per ion pair (eV or J).</li>
            <li><strong>E<sub>coh</sub></strong> — cohesive energy per molecule relative to separated neutral atoms (eV): positive means bound by that amount.</li>
          </ul>
        </div>

        <h3>0.2 Physical meaning (intuition)</h3>
        <p>
          In an ionic crystal, the dominant binding is Coulomb attraction between oppositely charged ions, but the
          <em>net</em> energy also includes the cost to create the ions from neutral atoms. Higher valence increases charge
          and therefore lattice binding roughly like <span class="muted">|z<sub>+</sub>z<sub>−</sub>|</span>, but it can also require extra ionization energy and may
          run into unfavorable electron affinity for multiple electrons on an anion.
        </p>

        <h3>0.3 Key laws/principles and validity conditions</h3>
        <div class="grid2">
          <div class="callout">
            <strong>Electrostatics in matter (here: vacuum-like Coulomb)</strong>
            <p class="muted">
              We approximate ion-ion interactions by vacuum Coulomb energy. The mathematical backbone is Poisson’s equation:
              <span class="muted">∇²φ = −ρ/ϵ₀</span>,
              with periodic charge density for a crystal.
            </p>
          </div>
          <div class="callout warn">
            <strong>Validity & limitations</strong>
            <ul class="muted">
              <li>Neglect short-range Pauli repulsion and polarization → lattice energy becomes an upper bound on binding magnitude.</li>
              <li>Assume perfect ionic charges (integer valence) and infinite lattice (no surfaces/defects).</li>
              <li>Use fixed R₀ for both charge states (explicit problem assumption).</li>
            </ul>
          </div>
        </div>

        <h3>0.4 Common models/approximations (why used)</h3>
        <ul>
          <li><strong>Born–Landé / Madelung model:</strong> separates long-range Coulomb (computable via lattice sums) from short-range repulsion (often modeled as A/Rⁿ). Here we <em>drop</em> the repulsion term by instruction.</li>
          <li><strong>Point-charge lattice + Madelung constant:</strong> replaces a difficult many-body electrostatic problem with a single dimensionless geometry factor α.</li>
          <li><strong>Thermodynamic cycle (Born–Haber-like bookkeeping):</strong> ensures energies are referenced to the same baseline (neutral atoms).</li>
        </ul>

        <h3>0.5 Mini intuition examples (quick)</h3>
        <ul>
          <li>If you double every charge magnitude, Coulomb energy scales by the <em>product</em> of charges: (2e)(2e) → 4× stronger binding at the same spacing.</li>
          <li>Electron affinity can be unfavorable for adding extra electrons to an already negative ion (repulsion), but a strong lattice field can stabilize it.</li>
        </ul>

        <div class="callout bad">
          <strong>What to watch for (pitfalls)</strong>
          <ul class="muted">
            <li><strong>Sign conventions:</strong> “electron affinity” may be quoted as energy released (positive) or energy change (negative). Here we treat the stated numbers as <em>energy released</em>; negative implies energy is required.</li>
            <li><strong>Double counting:</strong> lattice energy is a pairwise sum; correct formulas include a 1/2 factor when using potential φ at an ion site.</li>
            <li><strong>Reference state:</strong> cohesive energy must be relative to separated neutral atoms, not separated ions.</li>
          </ul>
        </div>

        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part0b">
        <h2>PART 0B — Industry & Applied Physics Perspective</h2>
        <p>
          The “which valence state is stabilized by a lattice?” question shows up everywhere engineers care about
          <strong>material stability, processing windows, and functional performance</strong>.
        </p>

        <h3>Where this appears in industry (3+ concrete areas)</h3>
        <ul>
          <li><strong>Ceramics & refractories:</strong> oxide stability (BaO, MgO, Al₂O₃) controls high-temperature corrosion resistance and phase formation in furnaces and coatings.</li>
          <li><strong>Electronics & dielectrics:</strong> ionic bonding strength influences dielectric constant, leakage, breakdown, and defect chemistry (oxygen vacancies, dopant charge compensation).</li>
          <li><strong>Battery & solid electrolytes:</strong> lattice energies help determine redox stability and whether multivalent states (e.g., O²⁻ frameworks) remain stable under strong internal fields.</li>
          <li><strong>Thin-film manufacturing:</strong> oxidation state stability affects sputtering/ALD targets, stoichiometry control, and post-anneal behavior.</li>
        </ul>

        <h3>Why engineers care</h3>
        <ul>
          <li><strong>Performance:</strong> oxidation state influences band structure, defect levels, and ionic mobility.</li>
          <li><strong>Reliability:</strong> wrong valence/defect population can accelerate aging (electromigration, dielectric degradation).</li>
          <li><strong>Cost & manufacturability:</strong> stable phases reduce scrap and broaden processing tolerances (temperature, oxygen partial pressure).</li>
        </ul>

        <h3>Measurement/validation methods (brief)</h3>
        <ul>
          <li><strong>XPS / EELS:</strong> identifies oxidation states via core-level shifts and fine structure.</li>
          <li><strong>XRD + Rietveld:</strong> validates crystal structure and lattice parameter changes linked to ionic radii/valence.</li>
          <li><strong>Thermochemistry (calorimetry) & phase diagrams:</strong> ties formation enthalpies to stable charge states.</li>
        </ul>

        <h3>Design trade-offs and constraints</h3>
        <ul>
          <li>Real materials are not perfect point-charge lattices: <strong>polarization</strong>, <strong>covalency</strong>, and <strong>short-range repulsion</strong> shift energies.</li>
          <li>R₀ may change with valence (different ionic radii). The problem fixes R₀ to isolate electrostatic scaling.</li>
          <li>Defects can stabilize non-integer “effective valence” through charge compensation.</li>
        </ul>

        <div class="callout">
          <strong>From lab to product</strong>
          <p class="muted">
            In real design workflows, the “Madelung + atomic energies” picture is the quick physics check.
            For product-grade predictions, engineers move to: (i) Born–Landé with fitted repulsion, (ii) polarizable-ion models,
            or (iii) DFT formation energies with defect chemical potentials—yet the scaling insight (stronger charge → much stronger lattice stabilization) remains a key intuition.
          </p>
        </div>

        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <h3>1.1 Restate the problem (in plain words)</h3>
        <p>
          Barium oxide (BaO) has the NaCl (rocksalt) structure. Using the observed nearest-neighbor distance
          R₀ = 2.76 Å, estimate the cohesive energies per BaO pair for two hypothetical ionic charge assignments:
        </p>
        <ul>
          <li>(A) Ba⁺ O⁻</li>
          <li>(B) Ba²⁺ O²⁻</li>
        </ul>
        <p>
          The reference is <strong>separated neutral atoms</strong> Ba and O. You are given Ba ionization energies
          I₁ = 5.19 eV, I₂ = 9.96 eV, and oxygen electron affinities for adding the first and second electrons:
          EA₁ = 1.5 eV and EA₂ = −9.0 eV. Assume R₀ is the same for both forms and <strong>neglect repulsive energy</strong>.
          Predict which valence state is favored.
        </p>

        <h3>1.2 Given quantities</h3>
        <table class="table" aria-label="Given quantities">
          <tr><th>Quantity</th><th>Value</th><th>Meaning</th></tr>
          <tr><td>R₀</td><td>2.76 Å</td><td>Nearest-neighbor separation</td></tr>
          <tr><td>I₁, I₂</td><td>5.19 eV, 9.96 eV</td><td>Ba first/second ionization energies</td></tr>
          <tr><td>EA₁, EA₂</td><td>+1.5 eV, −9.0 eV</td><td>Energy released adding 1st/2nd electron to O (2nd is unfavorable)</td></tr>
          <tr><td>Structure</td><td>NaCl</td><td>Madelung constant α ≈ 1.74756</td></tr>
        </table>

        <h3>1.3 Unknowns / required outputs</h3>
        <ul>
          <li>Cohesive energy per BaO pair for Ba⁺O⁻: E<sub>coh</sub>(1,1)</li>
          <li>Cohesive energy per BaO pair for Ba²⁺O²⁻: E<sub>coh</sub>(2,2)</li>
          <li>Which state is predicted to occur (larger E<sub>coh</sub>)</li>
        </ul>

        <h3>1.4 Relevant principles (why they apply)</h3>
        <ul>
          <li><strong>Energy bookkeeping (thermochemical cycle):</strong> neutral atoms → ions (ionization + electron affinity) → crystal (lattice energy).</li>
          <li><strong>Electrostatic lattice energy:</strong> for an infinite periodic ionic crystal, Coulomb energy can be summarized by the Madelung constant α.</li>
        </ul>
        <p class="muted">
          We do <em>not</em> use detailed quantum chemistry here; the problem explicitly requests a simplified lattice + atomic energetics estimate and neglects repulsion.
        </p>

        <div class="callout warn">
          <strong>Explicit assumptions</strong>
          <ul class="muted">
            <li>Ions are point charges ±z e at ideal NaCl lattice sites.</li>
            <li>Infinite crystal (periodic boundary conditions), overall charge neutrality per unit cell.</li>
            <li>Same nearest-neighbor distance R₀ for both charge assignments.</li>
            <li>Neglect all short-range repulsion and polarization energies.</li>
          </ul>
        </div>

        <h3>1.5 Possible approaches (compare 2–3)</h3>
        <ul>
          <li><strong>Approach 1: Madelung + ionization/affinity (best here).</strong>
            <span class="muted">Fast, uses given data directly; matches the problem statement.</span></li>
          <li><strong>Approach 2: Full Born–Landé with repulsion (more realistic).</strong>
            <span class="muted">Would require repulsion exponent n or compressibility; not given and explicitly neglected.</span></li>
          <li><strong>Approach 3: Ab initio formation energy (DFT).</strong>
            <span class="muted">High fidelity but far beyond the intended pencil-and-paper estimate.</span></li>
        </ul>
        <p><strong>Choice:</strong> Approach 1 is the correct fit to the provided inputs and assumptions.</p>

        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

        <ol>
          <li><strong>Set the reference:</strong> energy zero = separated neutral Ba + neutral O at infinity.</li>
          <li><strong>Define ionic charges:</strong> (+z<sub>+</sub>e, −z<sub>−</sub>e) with z = 1 or 2.</li>
          <li><strong>Compute lattice energy:</strong> use NaCl Madelung energy
            <span class="muted">U<sub>lat</sub> = −α |z<sub>+</sub>z<sub>−</sub>| (e²/(4πϵ₀R₀))</span>.</li>
          <li><strong>Compute “ion creation” energy:</strong>
            <span class="muted">E<sub>ions</sub> = (sum of Ba ionization energies) − (sum of O electron affinities)</span>
            using the problem’s sign convention.</li>
          <li><strong>Total energy change:</strong>
            <span class="muted">ΔE = E<sub>ions</sub> + U<sub>lat</sub></span>.</li>
          <li><strong>Cohesive energy:</strong> E<sub>coh</sub> = −ΔE (positive = bound).</li>
          <li><strong>Compare the two E<sub>coh</sub> values:</strong> larger cohesive energy ⇒ more stable under these assumptions.</li>
          <li><strong>Sanity checks:</strong> units, scaling with z, and whether signs match physical expectations.</li>
        </ol>

        <div class="callout bad">
          <strong>Common mistakes (quick tips)</strong>
          <ul class="muted">
            <li>Forgetting that lattice energy scales with <strong>|z<sub>+</sub>z<sub>−</sub>|</strong> (so 2+/2− gives 4× Coulomb binding at fixed R₀).</li>
            <li>Mixing up “electron affinity” sign convention—here EA₂ = −9 eV means the second electron addition costs +9 eV.</li>
            <li>Reporting ΔE instead of cohesive energy (E<sub>coh</sub> = −ΔE).</li>
          </ul>
        </div>

        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>3.1 Qualitative expectation (before calculating)</h3>
        <p>
          Going from ±1 charges to ±2 charges multiplies Coulomb attraction by 4 at the same separation.
          That is a huge stabilization. The “penalty” is: Ba must lose a second electron (cost I₂) and O must
          accept a second electron (here unfavorable by 9 eV). The question is which effect dominates.
        </p>

        <h3>3.2 Mathematical physics model (variables, domain, operators, boundary conditions)</h3>
        <div class="callout">
          <strong>Mathematical model (electrostatic field in a periodic crystal)</strong>
          <ul class="muted">
            <li><strong>Domain:</strong> infinite 3D space ℝ³ with a periodic point-charge distribution (NaCl lattice).</li>
            <li><strong>Unknown field:</strong> electrostatic potential φ(x) (V) and electric field E = −∇φ (V/m).</li>
            <li><strong>Governing PDE:</strong> Poisson equation
              <span class="muted">∇²φ(x) = −ρ(x)/ϵ₀</span>,
              where ρ is a lattice of Dirac deltas at ion positions.</li>
            <li><strong>Charge density (schematic):</strong>
              <span class="muted">
                ρ(x) = Σ<sub>R∈Λ</sub> [ z<sub>+</sub>e δ(x−R) − z<sub>−</sub>e δ(x−R−d) ]
              </span>
              where Λ is the Bravais lattice and d is the basis shift taking cations to anions.</li>
            <li><strong>Boundary/compatibility condition:</strong> overall neutrality per unit cell
              (<span class="muted">z<sub>+</sub> = z<sub>−</sub> for BaO</span>) ensures the periodic solution is well-defined (otherwise φ diverges).</li>
            <li><strong>Energy functional:</strong> electrostatic energy (in vacuum form)
              <span class="muted">U = (1/2)∫ ρ φ d³x = (ϵ₀/2)∫ |E|² d³x</span>,
              with periodic regularization (because point charges make the integral formally divergent unless handled by a convergent lattice-sum method such as Ewald summation).</li>
          </ul>
        </div>

        <details>
          <summary>Why this PDE/energy setup is valid (linearity, symmetry, and convergence)</summary>
          <p class="muted">
            Electrostatics is linear: if ρ = ρ₁ + ρ₂ then φ = φ₁ + φ₂ because ∇² is linear. Crystal symmetry implies φ is periodic up to an additive constant.
            The direct sum Σ qᵢqⱼ/rᵢⱼ is conditionally convergent in 3D for alternating charges; mathematically, one defines it via a convergent procedure (Ewald)
            that is equivalent to solving Poisson’s equation with periodic boundary conditions and neutrality.
            The final result is encapsulated by a single dimensionless constant α (the Madelung constant).
          </p>
        </details>

        <h3>3.3 Derive the Madelung lattice energy (step-by-step, no “magic jumps”)</h3>

        <p>
          Consider one reference cation at the origin with charge <span class="muted">q<sub>+</sub> = +z e</span>.
          The potential at the origin due to all other ions is
        </p>

        <div class="eqCard" data-copy="eq_madelung_phi">
          <div class="eqTop">
            <div class="label">Key equation • site potential from a lattice sum</div>
            <button class="btn" data-copy-btn="eq_madelung_phi">Copy equation</button>
          </div>
          <pre id="eq_madelung_phi">φ(0) = (1/(4πϵ0)) * Σ_{j≠0} (q_j / r_j)</pre>
        </div>

        <p>
          The electrostatic energy associated with placing the reference charge into this potential is
          <span class="muted">q<sub>+</sub> φ(0)</span>. But if we sum over all ions, each interacting pair would be counted twice (i with j, and j with i),
          so the correct total lattice energy is
        </p>

        <div class="eqCard" data-copy="eq_pair_half">
          <div class="eqTop">
            <div class="label">Key equation • factor 1/2 prevents double counting</div>
            <button class="btn" data-copy-btn="eq_pair_half">Copy equation</button>
          </div>
          <pre id="eq_pair_half">U_lat (per ion pair) = (1/2) * q_+ * φ(0)</pre>
        </div>

        <p>
          For an NaCl lattice, the alternating-sign lattice sum can be written in nondimensional form by scaling all distances by the nearest-neighbor separation R₀:
          let <span class="muted">r_j = R₀ s_j</span>, where <span class="muted">s_j</span> are dimensionless distances (pure numbers determined by lattice geometry).
          Then
        </p>

        <div class="eqCard" data-copy="eq_nondim">
          <div class="eqTop">
            <div class="label">Nondimensionalization • pull out the Coulomb scale</div>
            <button class="btn" data-copy-btn="eq_nondim">Copy equation</button>
          </div>
          <pre id="eq_nondim">φ(0) = (1/(4πϵ0)) * (1/R0) * Σ_{j≠0} (q_j / s_j)</pre>
        </div>

        <p>
          In NaCl structure, every <span class="muted">q_j</span> is either <span class="muted">+z e</span> or <span class="muted">−z e</span>.
          Factor out <span class="muted">z e</span>:
        </p>

        <div class="eqCard" data-copy="eq_alpha_def">
          <div class="eqTop">
            <div class="label">Definition of Madelung constant</div>
            <button class="btn" data-copy-btn="eq_alpha_def">Copy equation</button>
          </div>
          <pre id="eq_alpha_def">Σ_{j≠0} (q_j / s_j) = -(z e) * α   (for NaCl),  with α ≈ 1.74756</pre>
        </div>

        <p>
          The minus sign appears because the nearest neighbors of a cation are anions (opposite sign), so the net potential is negative.
          Substitute into the energy:
        </p>

        <div class="eqCard" data-copy="eq_ulat">
          <div class="eqTop">
            <div class="label">Madelung lattice energy per ion pair (NaCl)</div>
            <button class="btn alt" data-copy-btn="eq_ulat">Copy equation</button>
          </div>
          <pre id="eq_ulat">U_lat = (1/2) * (z e) * [ (1/(4πϵ0)) * (1/R0) * (-(z e) α) ]
      = - α * z^2 * (e^2/(4πϵ0 R0))</pre>
        </div>

        <p>
          For a general ionic compound with charges <span class="muted">+z<sub>+</sub>e</span> and <span class="muted">−z<sub>−</sub>e</span>,
          the product <span class="muted">z<sub>+</sub>z<sub>−</sub></span> replaces <span class="muted">z²</span>:
        </p>

        <div class="eqCard" data-copy="eq_ulat_general">
          <div class="eqTop">
            <div class="label">General charge product scaling</div>
            <button class="btn" data-copy-btn="eq_ulat_general">Copy equation</button>
          </div>
          <pre id="eq_ulat_general">U_lat = - α * |z_+ z_-| * (e^2/(4πϵ0 R0))</pre>
        </div>

        <div class="callout">
          <strong>Math Insight</strong>
          <p class="muted">
            The lattice problem is a <em>periodic Poisson equation</em> (an elliptic PDE). The Madelung constant α is the dimensionless value of a
            conditionally convergent Green’s-function lattice sum. In other words: α is the “geometry eigen-number” of the Coulomb kernel 1/r on the NaCl point set.
          </p>
        </div>

        <h3>3.4 Atomic ion formation energy (with careful signs)</h3>
        <p>
          We now connect the crystal energy to separated neutral atoms using a thermochemical path:
        </p>
        <ul>
          <li>Remove electrons from Ba: costs ionization energies.</li>
          <li>Add those electrons to O: changes energy by <span class="muted">−EA</span> for each electron if EA is “energy released”.</li>
          <li>Bring ions together into lattice: add <span class="muted">U<sub>lat</sub></span> (negative).</li>
        </ul>

        <p>
          Let the energy change from neutral atoms to the crystal be <span class="muted">ΔE</span>.
          Then the cohesive energy (energy released upon forming the crystal) is
          <span class="muted">E<sub>coh</sub> = −ΔE</span>.
        </p>

        <div class="eqCard" data-copy="eq_deltaE">
          <div class="eqTop">
            <div class="label">Total energy change relative to neutral atoms</div>
            <button class="btn alt" data-copy-btn="eq_deltaE">Copy equation</button>
          </div>
          <pre id="eq_deltaE">ΔE = (sum of Ba ionization energies) - (sum of O electron affinities) + U_lat
E_coh = -ΔE</pre>
        </div>

        <details>
          <summary>Dimensional analysis check (why the Coulomb term has energy units)</summary>
          <p class="muted">
            In SI: e²/(4πϵ₀R₀) has units (C²)/(F·m) = (C²)/(C²/J·m · m) = J. In “solid-state units” it’s common to use
            e²/(4πϵ₀) = 14.3996 eV·Å, so dividing by R₀ in Å gives eV. The prefactors α and z are dimensionless.
          </p>
        </details>

        <h3>3.5 Numerical evaluation</h3>
        <p>
          Use the convenient constant:
          <span class="muted">e²/(4πϵ₀) = 14.3996 eV·Å</span>.
          For R₀ = 2.76 Å and α = 1.74756:
        </p>

        <div class="eqCard" data-copy="eq_coulomb_scale">
          <div class="eqTop">
            <div class="label">Coulomb energy scale (per unit charge product)</div>
            <button class="btn" data-copy-btn="eq_coulomb_scale">Copy equation</button>
          </div>
          <pre id="eq_coulomb_scale">C = α * (14.3996 eV·Å) / R0
  = 1.74756 * 14.3996 / 2.76  eV
  ≈ 9.11745 eV</pre>
        </div>

        <p>
          Therefore:
          <span class="muted">U<sub>lat</sub> = −C |z<sub>+</sub>z<sub>−</sub>|</span>.
        </p>

        <h3>Case A: Ba⁺O⁻ (z<sub>+</sub>z<sub>−</sub>=1)</h3>
        <p>
          Ion creation energy:
        </p>
        <ul>
          <li>Ba → Ba⁺ + e⁻ costs <span class="muted">I₁ = 5.19 eV</span>.</li>
          <li>O + e⁻ → O⁻ releases <span class="muted">EA₁ = 1.5 eV</span>, so energy change is <span class="muted">−EA₁ = −1.5 eV</span>.</li>
        </ul>

        <div class="eqCard" data-copy="eq_caseA">
          <div class="eqTop">
            <div class="label">Case A energy bookkeeping</div>
            <button class="btn" data-copy-btn="eq_caseA">Copy equation</button>
          </div>
          <pre id="eq_caseA">U_lat(1) = -C * 1 = -9.11745 eV

ΔE_A = I1 - EA1 + U_lat(1)
     = 5.19 - 1.5 - 9.11745
     = -5.42745 eV

E_coh,A = -ΔE_A = 5.42745 eV</pre>
        </div>

        <h3>Case B: Ba²⁺O²⁻ (z<sub>+</sub>z<sub>−</sub>=4)</h3>
        <p>
          Ion creation energy:
        </p>
        <ul>
          <li>Ba → Ba²⁺ + 2e⁻ costs <span class="muted">I₁ + I₂ = 5.19 + 9.96 = 15.15 eV</span>.</li>
          <li>O + e⁻ → O⁻ releases EA₁ = 1.5 eV → energy change −1.5 eV.</li>
          <li>O⁻ + e⁻ → O²⁻ releases EA₂ = −9.0 eV, i.e. it <em>requires</em> 9 eV → energy change −EA₂ = +9.0 eV.</li>
        </ul>

        <div class="eqCard" data-copy="eq_caseB">
          <div class="eqTop">
            <div class="label">Case B energy bookkeeping</div>
            <button class="btn" data-copy-btn="eq_caseB">Copy equation</button>
          </div>
          <pre id="eq_caseB">U_lat(4) = -C * 4 = -36.46980 eV

ΔE_B = (I1+I2) - EA1 - EA2 + U_lat(4)
     = 15.15 - 1.5 - (-9.0) - 36.46980
     = 15.15 - 1.5 + 9.0 - 36.46980
     = -13.81980 eV

E_coh,B = -ΔE_B = 13.81980 eV</pre>
        </div>

        <div class="callout good">
          <strong>Final result (boxed)</strong>
          <div class="eqCard" data-copy="final_answer">
            <div class="eqTop">
              <div class="label">Final answer (plain text)</div>
              <button class="btn alt" data-copy-btn="final_answer">Copy final answer</button>
            </div>
            <pre id="final_answer">Given R0 = 2.76 Å and NaCl Madelung α = 1.74756 (repulsion neglected):

Ba+O−:
  E_coh ≈ 5.43 eV per BaO pair

Ba2+O2−:
  E_coh ≈ 13.82 eV per BaO pair

Prediction: Ba2+O2− is energetically favored (larger cohesive energy), despite the unfavorable second electron affinity.</pre>
          </div>
        </div>

        <h3>3.6 Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <strong>Units</strong>
            <p class="muted">
              Every term in ΔE is in eV. The Coulomb scale uses 14.3996 eV·Å / Å = eV, multiplied by α (dimensionless).
            </p>
          </div>
          <div class="callout">
            <strong>Limiting-case scaling</strong>
            <p class="muted">
              If we ignore atomic ion/affinity terms, U<sub>lat</sub> scales linearly with |z<sub>+</sub>z<sub>−</sub>|.
              So moving from 1 to 4 multiplies lattice binding by 4 → exactly what we see: −9.12 eV → −36.47 eV.
            </p>
          </div>
        </div>
        <div class="callout warn">
          <strong>Physical interpretation</strong>
          <p class="muted">
            The second electron on oxygen is hard to add in isolation (EA₂ negative), but in a crystal the strong electrostatic field
            stabilizes extra charge. Under this simplified model, that stabilization is large enough that the divalent state wins by a wide margin.
          </p>
        </div>

        <figure aria-label="Plot of lattice energy versus charge product">
          <canvas id="plot" width="900" height="520"></canvas>
          <figcaption>
            One simple learning plot: the electrostatic lattice energy (repulsion neglected) is linear in the charge product
            |z<sub>+</sub>z<sub>−</sub>| for a fixed structure and R₀: U<sub>lat</sub> = −C|z<sub>+</sub>z<sub>−</sub>|.
            Here C ≈ 9.12 eV for BaO with R₀ = 2.76 Å (NaCl α).
          </figcaption>
        </figure>

        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>4.1 Re-interpret the final formula</h3>
        <p>
          The cohesive energy (in this model) comes from competing terms:
        </p>
        <div class="eqCard" data-copy="eq_ecoh_structure">
          <div class="eqTop">
            <div class="label">Structure of the result</div>
            <button class="btn" data-copy-btn="eq_ecoh_structure">Copy equation</button>
          </div>
          <pre id="eq_ecoh_structure">E_coh = -ΔE = -[(Ionization costs) - (Electron affinity gains) + U_lat]
      = (Electron affinity gains) - (Ionization costs) - U_lat</pre>
        </div>

        <ul>
          <li><strong>Ionization costs:</strong> push against higher cation valence.</li>
          <li><strong>Electron affinity gains:</strong> favor anion formation; but can become unfavorable for multiple electrons.</li>
          <li><strong>Lattice energy U<sub>lat</sub>:</strong> becomes dramatically more negative with higher charges, typically dominating.</li>
        </ul>

        <h3>4.2 Parameter dependence (what controls stability)</h3>
        <ul>
          <li><strong>Charge product |z<sub>+</sub>z<sub>−</sub>|:</strong> strongest lever; Coulomb binding ∝ |z<sub>+</sub>z<sub>−</sub>|.</li>
          <li><strong>Spacing R₀:</strong> tighter lattice (smaller R₀) strengthens binding like 1/R₀.</li>
          <li><strong>Structure (α):</strong> different crystal structures have different α; larger α → stronger binding at same R₀.</li>
          <li><strong>Atomic energetics (I’s and EA’s):</strong> can flip the preferred valence when ionization penalties are huge or electron affinities are very unfavorable.</li>
        </ul>

        <details>
          <summary>Small/large parameter insight (asymptotics)</summary>
          <p class="muted">
            Define a dimensionless “lattice strength” parameter:
            <span class="muted">Λ = α (e²/(4πϵ₀R₀)) / E<sub>atom</sub></span>,
            where E<sub>atom</sub> is a typical atomic energy scale (e.g., I₂ or |EA₂|).
            If Λ ≫ 1, lattice binding dominates and higher valences are often stabilized. If Λ ≪ 1, atomic penalties dominate and lower valence may win.
            In this problem, α e²/(4πϵ₀R₀) ≈ 9.1 eV, comparable to the “difficult” scale 9 eV (EA₂ magnitude), so stabilization is strong—then multiplied by 4 for the divalent case.
          </p>
        </details>

        <h3>4.3 Alternative derivation idea (brief but meaningful)</h3>
        <p class="muted">
          Instead of quoting α, one can compute it by solving Poisson’s equation in Fourier space using the periodic Green’s function:
          expand ρ(x) and φ(x) in reciprocal lattice vectors G, solve
          <span class="muted">−|G|² φ̂(G) = −ρ̂(G)/ϵ₀</span> for G ≠ 0, and then evaluate the regularized energy
          <span class="muted">(1/2)∫ρφ</span>. Ewald summation is the practical hybrid of real-space and reciprocal-space convergence acceleration.
        </p>

        <h3>4.4 Concept check (self-test with answers)</h3>
        <ul>
          <li><strong>Q:</strong> Why must the unit cell be neutral for a periodic electrostatic solution?<br>
              <strong>A:</strong> Otherwise the G=0 Fourier mode makes φ diverge; physically, an infinite net charge density is impossible without compensation.</li>
          <li><strong>Q:</strong> Why does U<sub>lat</sub> scale with |z<sub>+</sub>z<sub>−</sub>| and not z<sub>+</sub>+z<sub>−</sub>?<br>
              <strong>A:</strong> Coulomb pair energy is proportional to q₁q₂; the lattice sum preserves that multiplicative scaling.</li>
          <li><strong>Q:</strong> If R₀ were larger, what happens to the preference for Ba²⁺O²⁻?<br>
              <strong>A:</strong> Lattice stabilization weakens like 1/R₀, so the benefit of higher valence shrinks; atomic penalties could then dominate.</li>
          <li><strong>Q:</strong> What physical effect is hidden in the “repulsive energy” we neglected?<br>
              <strong>A:</strong> Short-range Pauli exclusion (overlap) repulsion and related quantum effects that set the equilibrium spacing and prevent collapse.</li>
        </ul>

        <a class="backTop" href="#top">Back to top</a>
      </section>

      <section id="part5">
        <h2>PART 5 — Optional Plot Guide (Because a Plot Exists)</h2>
        <p>
          The plot shows the <strong>electrostatic lattice energy</strong> (repulsion neglected) as a function of the
          <strong>charge product</strong> <span class="muted">p = |z<sub>+</sub>z<sub>−</sub>|</span>.
          It is useful because it visualizes the most important scaling law in this problem:
          <span class="muted">U<sub>lat</sub> = −C p</span>.
        </p>
        <ul>
          <li><strong>x-axis:</strong> p = |z<sub>+</sub>z<sub>−</sub>| (dimensionless), from 0 to 4.</li>
          <li><strong>y-axis:</strong> U<sub>lat</sub> in eV per ion pair (negative = binding).</li>
          <li><strong>Example values used:</strong> C computed from the given R₀ and NaCl α for BaO (C ≈ 9.12 eV). This is not an extra assumption—just the numeric evaluation of the provided inputs.</li>
          <li><strong>Features to notice:</strong> straight-line behavior (linearity), and the large jump from p=1 to p=4, explaining why Ba²⁺O²⁻ is favored.</li>
        </ul>

        <a class="backTop" href="#top">Back to top</a>
      </section>
    </main>
  </div>

  <footer>
    <p>
      Notes: This is a simplified electrostatic + atomic-energetics estimate. Real crystals include short-range repulsion, polarization, covalency, and possible changes in R₀ with valence.
      Under the problem’s assumptions (same R₀, neglect repulsion), the divalent state is strongly stabilized by Coulomb binding.
    </p>
  </footer>

  <script>
    // ---------- Copy buttons (plain text) ----------
    function copyTextFromElementId(id){
      const el = document.getElementById(id);
      if(!el) return;
      const text = el.textContent.replace(/\u00A0/g,' ');
      navigator.clipboard.writeText(text).then(()=>{
        const btn = document.querySelector('[data-copy-btn="'+id+'"]');
        if(!btn) return;
        const old = btn.textContent;
        btn.textContent = "Copied ✓";
        setTimeout(()=>btn.textContent = old, 900);
      }).catch(()=>{ /* ignore */ });
    }
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-copy-btn]');
      if(!btn) return;
      copyTextFromElementId(btn.getAttribute('data-copy-btn'));
    });

    // ---------- Sticky TOC active section ----------
    const tocLinks = Array.from(document.querySelectorAll('#tocNav a'));
    const sections = tocLinks.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);

    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          tocLinks.forEach(a => a.classList.remove('active'));
          const id = '#'+entry.target.id;
          const link = tocLinks.find(a => a.getAttribute('href') === id);
          if(link) link.classList.add('active');
        }
      });
    }, {root:null, threshold: 0.2, rootMargin: "-10% 0px -70% 0px"});

    sections.forEach(sec => obs.observe(sec));

    // ---------- One simple plot on <canvas> ----------
    function drawPlot(){
      const canvas = document.getElementById('plot');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');

      // Responsive sizing while keeping crispness on HiDPI
      const parent = canvas.parentElement;
      const cssW = parent.clientWidth - 20; // padding buffer
      const cssH = Math.max(280, Math.round(cssW * 0.55));
      const dpr = window.devicePixelRatio || 1;

      canvas.style.width = cssW + 'px';
      canvas.style.height = cssH + 'px';
      canvas.width = Math.round(cssW * dpr);
      canvas.height = Math.round(cssH * dpr);

      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.clearRect(0,0,cssW,cssH);

      // Plot data: U_lat = -C p with C ≈ 9.11745 eV from the solution
      const C = 9.11745;
      const xMin=0, xMax=4;
      const yMin=-40, yMax=5; // include 0 and negative binding

      // Layout
      const padL=62, padR=16, padT=28, padB=52;
      const W = cssW - padL - padR;
      const H = cssH - padT - padB;

      function xToPx(x){ return padL + (x-xMin)/(xMax-xMin)*W; }
      function yToPx(y){ return padT + (yMax-y)/(yMax-yMin)*H; }

      // Colors (do not hardcode "style themes", keep minimal)
      const text = getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#e9ecf5';
      const line = getComputedStyle(document.documentElement).getPropertyValue('--line').trim() || 'rgba(255,255,255,.10)';
      const muted = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || '#b9c0d6';
      const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#7dd3fc';
      const accent2 = getComputedStyle(document.documentElement).getPropertyValue('--accent2').trim() || '#a78bfa';

      // Title
      ctx.fillStyle = text;
      ctx.font = '600 14px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Electrostatic lattice energy vs charge product (NaCl, R₀ = 2.76 Å)', padL, 18);

      // Gridlines and ticks
      ctx.strokeStyle = line;
      ctx.lineWidth = 1;

      // x ticks at 0..4
      ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillStyle = muted;

      for(let xt=0; xt<=4; xt++){
        const xp = xToPx(xt);
        ctx.beginPath();
        ctx.moveTo(xp, padT);
        ctx.lineTo(xp, padT+H);
        ctx.stroke();
        ctx.fillText(String(xt), xp-3, padT+H+20);
      }

      // y ticks: -40, -30, -20, -10, 0
      const yTicks = [-40,-30,-20,-10,0];
      yTicks.forEach(yt=>{
        const yp = yToPx(yt);
        ctx.beginPath();
        ctx.moveTo(padL, yp);
        ctx.lineTo(padL+W, yp);
        ctx.stroke();
        ctx.fillText(String(yt), 12, yp+4);
      });

      // Axes
      ctx.strokeStyle = muted;
      ctx.beginPath();
      ctx.moveTo(padL, padT);
      ctx.lineTo(padL, padT+H);
      ctx.lineTo(padL+W, padT+H);
      ctx.stroke();

      // Axis labels
      ctx.fillStyle = muted;
      ctx.fillText('p = |z₊ z₋| (dimensionless)', padL + Math.max(0,(W/2)-75), padT+H+42);

      // y label (rotated)
      ctx.save();
      ctx.translate(18, padT + H/2 + 40);
      ctx.rotate(-Math.PI/2);
      ctx.fillText('U_lat (eV per ion pair)', 0, 0);
      ctx.restore();

      // Plot line U = -C p
      ctx.strokeStyle = accent;
      ctx.lineWidth = 2;
      ctx.beginPath();
      for(let i=0;i<=80;i++){
        const p = xMin + (xMax-xMin)*i/80;
        const U = -C*p;
        const xp = xToPx(p);
        const yp = yToPx(U);
        if(i===0) ctx.moveTo(xp,yp); else ctx.lineTo(xp,yp);
      }
      ctx.stroke();

      // Mark p=1 and p=4
      function mark(p, color, label){
        const U = -C*p;
        const xp = xToPx(p);
        const yp = yToPx(U);
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(xp, yp, 4, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = text;
        ctx.fillText(label, xp+8, yp-8);
      }
      mark(1, accent2, 'p=1 (Ba⁺O⁻)');
      mark(4, accent2, 'p=4 (Ba²⁺O²⁻)');

      // Legend
      const lx = padL + W - 220, ly = padT + 8;
      ctx.fillStyle = 'rgba(0,0,0,.12)';
      ctx.strokeStyle = line;
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.roundRect(lx, ly, 210, 46, 10);
      ctx.fill();
      ctx.stroke();
      ctx.strokeStyle = accent;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(lx+10, ly+18);
      ctx.lineTo(lx+50, ly+18);
      ctx.stroke();
      ctx.fillStyle = text;
      ctx.fillText('U_lat = −C p,  C≈9.12 eV', lx+60, ly+22);
    }

    // Canvas roundRect polyfill for older browsers
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        const radius = Array.isArray(r) ? r : [r,r,r,r];
        this.beginPath();
        this.moveTo(x + radius[0], y);
        this.lineTo(x + w - radius[1], y);
        this.quadraticCurveTo(x + w, y, x + w, y + radius[1]);
        this.lineTo(x + w, y + h - radius[2]);
        this.quadraticCurveTo(x + w, y + h, x + w - radius[2], y + h);
        this.lineTo(x + radius[3], y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - radius[3]);
        this.lineTo(x, y + radius[0]);
        this.quadraticCurveTo(x, y, x + radius[0], y);
        this.closePath();
        return this;
      };
    }

    window.addEventListener('load', drawPlot);
    window.addEventListener('resize', ()=>{
      // cheap debounce
      clearTimeout(window.__plotT);
      window.__plotT = setTimeout(drawPlot, 80);
    });
  </script>
</body>
</html>
