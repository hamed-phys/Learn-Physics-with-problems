<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#0b1020"/>
  <title>Diatomic Line Diffraction (ABAB…): Condition, Parity Intensities, and Extinctions</title>
  <style>
    :root{
      --bg:#070a12;
      --panel:#0c1222;
      --panel2:#0a0f1d;
      --text:#e9eefc;
      --muted:#aab6df;
      --faint:#7f8ab5;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --border:rgba(255,255,255,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      --serif: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f9ff;
        --panel:#ffffff;
        --panel2:#f3f6ff;
        --text:#11162a;
        --muted:#3a466e;
        --faint:#5b6792;
        --border:rgba(17,22,42,.12);
        --shadow: 0 18px 50px rgba(16,22,50,.10);
      }
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 20% 0%, rgba(125,211,252,.14), transparent 55%),
                  radial-gradient(900px 650px at 90% 10%, rgba(167,139,250,.14), transparent 60%),
                  var(--bg);
      color:var(--text);
      line-height:1.58;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding: 26px 18px 10px;
      max-width: 1150px;
      margin: 0 auto;
    }
    .hero{
      background: linear-gradient(135deg, rgba(125,211,252,.18), rgba(167,139,250,.10));
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: calc(var(--radius) + 6px);
      padding: 18px 18px 14px;
      overflow:hidden;
      position:relative;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(800px 300px at 25% 0%, rgba(125,211,252,.30), transparent 60%),
                  radial-gradient(700px 300px at 90% 30%, rgba(167,139,250,.28), transparent 62%);
      opacity:.55;
      pointer-events:none;
    }
    .hero > *{position:relative}
    h1{
      margin:0 0 6px;
      font-size: clamp(22px, 3.2vw, 34px);
      letter-spacing: .2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size: clamp(13px, 1.8vw, 15.5px);
    }
    main{
      max-width: 1150px;
      margin: 0 auto;
      padding: 12px 18px 60px;
      display:grid;
      grid-template-columns: 290px 1fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 980px){
      main{grid-template-columns: 1fr}
    }
    nav.toc{
      position: sticky;
      top: 12px;
      align-self:start;
      background: color-mix(in srgb, var(--panel) 86%, transparent);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(10px);
    }
    @media (max-width: 980px){
      nav.toc{position:relative; top:0}
    }
    .toc h2{
      margin:0 0 10px;
      font-size: 14px;
      color: var(--muted);
      letter-spacing:.4px;
      text-transform: uppercase;
    }
    .toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--text);
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size: 14px;
    }
    .toc a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.22);
      transform: translateY(-1px);
      text-decoration:none;
    }
    .content{
      display:flex;
      flex-direction:column;
      gap: 16px;
      min-width:0;
    }
    section, article{
      background: color-mix(in srgb, var(--panel) 92%, transparent);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      overflow:hidden;
    }
    section h2, article h2{
      margin:0 0 10px;
      font-size: 18px;
    }
    h3{
      margin:16px 0 8px;
      font-size: 16px;
      color: color-mix(in srgb, var(--text) 92%, var(--muted));
    }
    p{margin: 8px 0}
    ul{margin:8px 0 8px 18px}
    li{margin: 6px 0}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 860px){
      .grid2{grid-template-columns:1fr}
    }
    .callout{
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--panel2) 92%, transparent);
      border-radius: 16px;
      padding: 12px;
      margin: 10px 0;
      position:relative;
      overflow:hidden;
    }
    .callout:before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width: 3px;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      opacity:.9;
    }
    .callout .title{
      font-weight: 700;
      margin:0 0 6px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .badge{
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
      white-space:nowrap;
    }
    .equation{
      margin: 10px 0;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.16);
      font-family: var(--mono);
      font-size: 13px;
      overflow:auto;
      position:relative;
    }
    @media (prefers-color-scheme: light){
      .equation{background: rgba(17,22,42,.04)}
    }
    .eqrow{
      display:flex; align-items:flex-start; gap:10px; justify-content:space-between;
    }
    .copybtn{
      flex:0 0 auto;
      border:1px solid var(--border);
      background: rgba(125,211,252,.10);
      color: var(--text);
      border-radius: 12px;
      padding: 6px 10px;
      font-size: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      margin-left: 10px;
    }
    .copybtn:hover{transform: translateY(-1px); border-color: rgba(125,211,252,.25); background: rgba(125,211,252,.14)}
    .copybtn:active{transform: translateY(0px)}
    .kpi{
      display:flex; flex-wrap:wrap; gap:8px;
      margin-top: 10px;
    }
    .pill{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--muted);
    }
    details{
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,.02);
      margin: 10px 0;
    }
    summary{
      cursor:pointer;
      font-weight: 700;
      color: color-mix(in srgb, var(--text) 90%, var(--muted));
    }
    summary::-webkit-details-marker{display:none}
    summary:before{
      content:"▸";
      display:inline-block;
      margin-right:8px;
      transform: translateY(-1px);
      transition: transform .15s ease;
      color: var(--accent);
    }
    details[open] summary:before{transform: rotate(90deg) translateX(1px)}
    figure{
      margin: 10px 0 0;
      border:1px solid var(--border);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(0,0,0,.14);
    }
    figure figcaption{
      padding: 10px 12px;
      font-size: 12.5px;
      color: var(--muted);
      border-top: 1px solid var(--border);
      background: rgba(255,255,255,.02);
    }
    canvas{display:block; width:100%; height:280px}
    .backtop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      width: fit-content;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .backtop:hover{
      transform: translateY(-1px);
      border-color: rgba(125,211,252,.25);
      background: rgba(125,211,252,.10);
      text-decoration:none;
    }
    footer{
      max-width: 1150px;
      margin: 0 auto;
      padding: 0 18px 40px;
      color: var(--faint);
      font-size: 12.5px;
    }
    .finalbox{
      border: 1px solid rgba(52,211,153,.35);
      background: color-mix(in srgb, rgba(52,211,153,.12) 80%, transparent);
      border-radius: 16px;
      padding: 12px;
      margin: 10px 0;
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      nav.toc{display:none}
      header, main, footer{max-width: 100%; margin: 0; padding: 0}
      section, article{
        box-shadow:none;
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }
      a{color:#000; text-decoration:underline}
      .copybtn{display:none}
      .backtop{display:none}
      figure{page-break-inside: avoid}
    }
  </style>
</head>
<body>
  <a id="top"></a>
  <header>
    <div class="hero">
      <h1>Diatomic Line Diffraction (ABAB…): Condition, Parity Intensities, and Extinctions</h1>
      <p class="sub">
        A mathematically rigorous, physics-friendly derivation of the interference condition and the even/odd selection rule for a 1D alternating chain.
      </p>
      <div class="kpi" aria-label="Key tags">
        <span class="pill">Topic: X-ray / wave scattering</span>
        <span class="pill">Model: 1D lattice + 2-atom basis</span>
        <span class="pill">Result: nλ = a cosθ, Iodd ∝ |fA−fB|², Ieven ∝ |fA+fB|²</span>
      </div>
    </div>
  </header>

  <main>
    <nav class="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <a href="#quick">Quick Summary</a>
      <a href="#p0">PART 0 — Concept Primer</a>
      <a href="#p0b">PART 0B — Industry & Applied Physics</a>
      <a href="#p1">PART 1 — Problem Analysis</a>
      <a href="#p2">PART 2 — Strategy & Tips</a>
      <a href="#p3">PART 3 — Full Solution</a>
      <a href="#p4">PART 4 — Deeper Understanding</a>
      <a href="#p5">PART 5 — Optional Plot Guide</a>
    </nav>

    <div class="content">
      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this problem is about:</b> Diffraction from a 1D line of atoms with alternating species <b>A</b> and <b>B</b> (…ABAB…).</li>
          <li><b>Key physics idea:</b> Scattered waves add as complex phasors; periodicity gives sharp maxima when the phase advance per unit cell is an integer multiple of <i>2π</i>.</li>
          <li><b>Mathematical core:</b> The scattered amplitude is a discrete Fourier transform of the density: <span style="font-family:var(--mono)">A(q) = Σ_j f_j e^{i q·r_j}</span>.</li>
          <li><b>Geometry result:</b> With incident beam perpendicular to the chain, the constructive condition becomes <b>nλ = a cosθ</b>.</li>
          <li><b>Selection rule:</b> The 2-atom basis gives a <i>structure factor</i> <span style="font-family:var(--mono)">S_n = f_A + f_B (-1)^n</span>.</li>
          <li><b>Intensity parity:</b> <b>I<sub>odd</sub> ∝ |f_A − f_B|²</b>, <b>I<sub>even</sub> ∝ |f_A + f_B|²</b>.</li>
          <li><b>Physical meaning:</b> Odd orders probe the A–B contrast; even orders probe the average scattering strength.</li>
          <li><b>Special case:</b> If <b>f_A = f_B</b>, all odd orders vanish (systematic absences / extinctions).</li>
        </ul>
      </section>

      <article id="p0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <div>
            <h3>Core definitions (symbols + SI units)</h3>
            <ul>
              <li><b>λ</b> — x-ray wavelength (m).</li>
              <li><b>k</b> — wave number, <span style="font-family:var(--mono)">k = 2π/λ</span> (rad·m<sup>−1</sup>).</li>
              <li><b>k⃗<sub>i</sub>, k⃗<sub>s</sub></b> — incident and scattered wave vectors (rad·m<sup>−1</sup>), |k⃗|=k in elastic scattering.</li>
              <li><b>q⃗</b> — scattering vector: <span style="font-family:var(--mono)">q⃗ = k⃗_s − k⃗_i</span> (rad·m<sup>−1</sup>).</li>
              <li><b>f<sub>A</sub>, f<sub>B</sub></b> — atomic form factors (effective scattering amplitudes; in x-ray crystallography often treated as dimensionless relative to electron scattering).</li>
              <li><b>a</b> — repeat length (unit cell length) along the chain (m). Here A—B bond length is <b>a/2</b>.</li>
              <li><b>θ</b> — angle between the diffracted beam direction and the atom line (rad or degrees).</li>
            </ul>
          </div>
          <div>
            <h3>Physical meaning & intuition</h3>
            <ul>
              <li><b>Form factor f</b> tells “how strongly” an atom scatters at a given q; heavier atoms generally scatter more (larger electron density).</li>
              <li><b>q⃗</b> measures the spatial frequency you probe: large |q| resolves finer real-space structure.</li>
              <li><b>Interference</b> is controlled by phase differences: phase = q⃗·r⃗ for a point at r⃗ (plane-wave approximation).</li>
              <li>A diatomic chain has two length scales: spacing <b>a/2</b> between atoms, and periodicity <b>a</b> of the AB basis.</li>
            </ul>
          </div>
        </div>

        <div class="callout">
          <p class="title">Key law / principle <span class="badge">wave superposition</span></p>
          <p>
            For elastic scattering in the far field (Fraunhofer regime), the complex scattered amplitude is the linear superposition of contributions
            from each scatterer:
          </p>
          <div class="equation" data-copy="A(q) = Σ_j f_j e^{i q·r_j}">
            <div class="eqrow">
              <div>
                A(q) = Σ<sub>j</sub> f<sub>j</sub> e<sup>i q⃗·r⃗<sub>j</sub></sup>
              </div>
              <button class="copybtn" type="button" data-copy-btn>Copy</button>
            </div>
          </div>
          <p>
            This is essentially a discrete Fourier transform of the scatterer distribution (linearity of the wave equation in the weak-scattering limit).
          </p>
        </div>

        <h3>Validity conditions / assumptions (what makes this model work)</h3>
        <ul>
          <li><b>Single scattering (kinematic diffraction):</b> scattered field is small compared with the incident field (no strong multiple scattering).</li>
          <li><b>Plane-wave incidence and far-field detection:</b> phases are well approximated by plane-wave factors e<sup>i k⃗·r⃗</sup>.</li>
          <li><b>Elastic scattering:</b> |k⃗<sub>s</sub>| = |k⃗<sub>i</sub>| = 2π/λ.</li>
          <li><b>Ideal infinite or long chain:</b> large number of unit cells makes peaks sharp at reciprocal-lattice values.</li>
        </ul>

        <h3>Common models / approximations</h3>
        <ul>
          <li><b>Basis + lattice factorization:</b> amplitude = (lattice sum) × (structure factor) — a central simplification from periodicity.</li>
          <li><b>Neglect polarization and absorption</b> (unless specified). Those change absolute intensity but not the parity selection rule derived here.</li>
        </ul>

        <h3>Mini intuition examples (minimal algebra)</h3>
        <ul>
          <li><b>Two-point interference:</b> if two equal scatterers are separated by d along x, the intensity oscillates with phase q<sub>x</sub>d.</li>
          <li><b>Alternating chain:</b> if A and B scatter differently, odd orders “see” the contrast (difference) while even orders “see” the sum.</li>
        </ul>

        <div class="callout">
          <p class="title">What to watch for <span class="badge">pitfalls</span></p>
          <ul>
            <li>Don’t confuse <b>θ</b> here (angle between scattered beam and chain) with the usual Bragg angle (often defined to planes).</li>
            <li>Keep track of the <b>coordinate projection</b>: only the component of q⃗ along the chain produces phase differences along the chain.</li>
            <li>Remember there are <b>two periodicities</b>: spacing a/2 and unit cell a; the problem’s “interference condition” refers to unit-cell periodicity.</li>
          </ul>
        </div>

        <div class="callout">
          <p class="title">Math Insight <span class="badge">Fourier / eigen-structure</span></p>
          <p>
            The map <span style="font-family:var(--mono)">ρ(x) → A(q_x)</span> is a Fourier transform: periodic ρ(x) produces discrete spectral lines at
            reciprocal lattice vectors <span style="font-family:var(--mono)">G_n = 2πn/a</span>. The diatomic basis multiplies these lines by a
            <i>structure factor</i>, which can create zeros (extinctions) by destructive interference.
          </p>
        </div>

        <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
      </article>

      <article id="p0b">
        <h2>PART 0B — Industry & Applied Physics Perspective</h2>
        <h3>Where this appears in industry (concrete applications)</h3>
        <ul>
          <li><b>Materials characterization (XRD):</b> detecting ordering in alloys (e.g., alternating species) via systematic absences and superlattice peaks.</li>
          <li><b>Semiconductor superlattices & epitaxy:</b> alternating layers/atoms create selection rules used to confirm layer periodicity and composition.</li>
          <li><b>Nanomanufacturing / thin films:</b> monitoring deposition quality and compositional modulation; diffraction peak parity can reveal intermixing.</li>
          <li><b>1D/chain-like materials:</b> polymers, charge-density-wave materials, quasi-1D conductors—diffraction gives periodicity and contrast.</li>
        </ul>

        <h3>Why engineers care</h3>
        <ul>
          <li><b>Performance:</b> ordering affects electronic band structure, thermal conductivity, and mechanical strength.</li>
          <li><b>Reliability:</b> diffusion/intermixing degrades designed periodicity; parity-dependent peak changes can be an early indicator.</li>
          <li><b>Cost & yield:</b> diffraction-based metrology is fast, non-destructive, and scalable for process control.</li>
        </ul>

        <h3>Typical measurement / validation methods</h3>
        <ul>
          <li><b>X-ray diffraction (lab or synchrotron)</b> to measure peak positions (periodicity) and intensities (contrast/order parameter).</li>
          <li><b>Electron diffraction (TEM/SAED)</b> for nanoscale domains; selection rules are analogous but scattering factors differ.</li>
          <li><b>Reflectometry / grazing-incidence</b> to enhance sensitivity for thin films and layered structures.</li>
        </ul>

        <h3>Design trade-offs & constraints</h3>
        <ul>
          <li><b>Tolerances:</b> disorder and finite size broaden peaks; intensity parity can wash out if A/B mixing occurs.</li>
          <li><b>Non-idealities:</b> thermal vibrations (Debye–Waller factor), strain, defects change intensities beyond the simple |…|² rule.</li>
          <li><b>Instrumentation:</b> angular resolution limits the ability to resolve adjacent diffraction orders in 1D-like systems.</li>
        </ul>

        <details>
          <summary>From lab to product: adapting the ideal model</summary>
          <p>
            In production metrology, the ideal infinite-chain sums are replaced by finite-size models and disorder averages. Practically, engineers fit
            measured intensities with a structure factor multiplied by envelope functions (finite coherence length, instrument resolution),
            and include corrections (absorption, polarization, Debye–Waller). The <b>even/odd selection rule</b> remains a robust signature of
            alternating composition as long as A and B are distinguishable (f<sub>A</sub> ≠ f<sub>B</sub>).
          </p>
        </details>

        <a class="backtop" href="#top">↑ Back to top</a>
      </article>

      <article id="p1">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>
        <h3>Restating the problem</h3>
        <p>
          We have a 1D line of atoms in the sequence <b>ABAB…</b>. The A–B bond length is <b>a/2</b>, so the pattern repeats every <b>a</b>.
          X-rays are incident <b>perpendicular</b> to the atom line. Let <b>θ</b> be the angle between the <b>diffracted (scattered) beam</b> and the line.
          Atomic form factors are <b>f<sub>A</sub></b> and <b>f<sub>B</sub></b>.
        </p>
        <p>Tasks:</p>
        <ol>
          <li>(a) Show the interference (constructive) condition: <b>nλ = a cosθ</b>.</li>
          <li>(b) Show that diffracted intensity is proportional to <b>|f<sub>A</sub> − f<sub>B</sub>|²</b> for odd n, and to <b>|f<sub>A</sub> + f<sub>B</sub>|²</b> for even n.</li>
          <li>(c) Explain what happens if <b>f<sub>A</sub> = f<sub>B</sub></b>.</li>
        </ol>

        <div class="grid2">
          <div>
            <h3>Given</h3>
            <ul>
              <li>Sequence: ABAB… along a straight line.</li>
              <li>Nearest-neighbor distance: a/2.</li>
              <li>Unit cell length (repeat): a.</li>
              <li>Incident beam ⟂ to the line.</li>
              <li>Form factors: f<sub>A</sub>, f<sub>B</sub>.</li>
            </ul>
          </div>
          <div>
            <h3>Unknowns / what must be shown</h3>
            <ul>
              <li>Constructive condition relating λ, a, θ, and integer n.</li>
              <li>Parity-dependent intensity formula.</li>
              <li>Interpretation of equal form factors.</li>
            </ul>
          </div>
        </div>

        <h3>Relevant principles and why they apply</h3>
        <ul>
          <li><b>Wave superposition:</b> scattering amplitudes add linearly in the weak-scattering regime.</li>
          <li><b>Phase accumulation:</b> relative phase between scatterers depends on the component of q⃗ along the chain.</li>
          <li><b>Periodicity:</b> a periodic arrangement produces discrete diffraction orders (reciprocal lattice).</li>
        </ul>

        <div class="callout">
          <p class="title">Assumptions <span class="badge">explicit</span></p>
          <ul>
            <li>Elastic scattering: |k⃗<sub>s</sub>| = |k⃗<sub>i</sub>|.</li>
            <li>Plane-wave illumination and far-field detection.</li>
            <li>Kinematic (single-scattering) approximation.</li>
            <li>Long chain (many unit cells) so that maxima are well-defined.</li>
          </ul>
        </div>

        <h3>Possible solution approaches (compare)</h3>
        <ul>
          <li><b>Approach A: Path-difference geometry</b> (fast intuition). Pros: quick to get nλ relation. Cons: can be ambiguous without vector notation.</li>
          <li><b>Approach B: Scattering-vector formalism</b> using <span style="font-family:var(--mono)">A(q)=Σ f_j e^{iq·r_j}</span>. Pros: clean, rigorous, naturally yields structure factor and parity rule. Cons: slightly more abstract.</li>
          <li><b>Approach C: Fourier series of a periodic density</b>. Pros: emphasizes mathematical physics (spectral lines). Cons: needs careful handling of discrete delta combs.</li>
        </ul>
        <p>
          <b>Best choice:</b> Approach B (scattering vector + lattice/basis factorization), because it simultaneously proves (a) and (b) with minimal ambiguity and maximal rigor.
        </p>

        <a class="backtop" href="#top">↑ Back to top</a>
      </article>

      <article id="p2">
        <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

        <ol>
          <li><b>Set coordinates:</b> Put the chain on the x-axis; define atom positions. (Goal: explicit r⃗<sub>j</sub>.)</li>
          <li><b>Write plane waves:</b> Use incident/scattered wavevectors k⃗<sub>i</sub>, k⃗<sub>s</sub>. (Tool: e^{ik⃗·r⃗}.)</li>
          <li><b>Define q⃗ = k⃗<sub>s</sub> − k⃗<sub>i</sub>:</b> show phases are q⃗·r⃗<sub>j</sub>. (Meaning: phase difference driver.)</li>
          <li><b>Project onto the chain:</b> compute q<sub>x</sub> using the geometry “incident ⟂ chain” and θ definition. (Meaning: which component matters.)</li>
          <li><b>Factor the sum:</b> group atoms into unit cells: lattice sum × basis sum. (Tool: geometric series; periodicity.)</li>
          <li><b>Find maxima:</b> lattice sum peaks when q<sub>x</sub>a = 2πn ⇒ nλ = a cosθ. (Meaning: diffraction orders.)</li>
          <li><b>Evaluate structure factor at maxima:</b> basis phase gives (-1)<sup>n</sup> leading to even/odd intensities. (Meaning: selection rule.)</li>
          <li><b>Handle special case:</b> set f<sub>A</sub>=f<sub>B</sub> to interpret extinctions. (Meaning: identical basis → reduced period.)</li>
          <li><b>Sanity checks:</b> dimensional analysis and limiting cases. (Meaning: confidence and physical interpretation.)</li>
        </ol>

        <div class="callout">
          <p class="title">Common mistakes <span class="badge">quick tips</span></p>
          <ul>
            <li><b>Using wrong angle:</b> Here θ is between scattered beam and the chain, so q<sub>x</sub> = k cosθ (because k⃗<sub>i</sub> has no x component).</li>
            <li><b>Forgetting the basis:</b> The parity effect comes from the extra phase e^{iq<sub>x</sub>(a/2)} between A and B inside the unit cell.</li>
            <li><b>Confusing spacing:</b> Adjacent atoms are spaced by a/2, but the AB pattern repeats every a.</li>
          </ul>
        </div>

        <a class="backtop" href="#top">↑ Back to top</a>
      </article>

      <article id="p3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Physical intuition (before calculating)</h3>
        <p>
          A long periodic array behaves like a “spatial frequency filter”: it scatters strongly only when the outgoing wave matches the periodic phase advance
          along the chain. For a diatomic basis, there is an additional internal interference between A and B. If A and B scatter equally, the chain effectively
          looks like a monoatomic chain with spacing a/2, so some “orders” defined with period a must disappear.
        </p>

        <h3>Mathematical model (variables, domains, coordinates, conditions)</h3>
        <div class="callout">
          <p class="title">Model specification <span class="badge">mathematical physics</span></p>
          <ul>
            <li><b>Domain:</b> a 1D set of point scatterers embedded in 3D space; positions lie on the x-axis.</li>
            <li><b>Coordinate system:</b> chain along x; incident beam along +y (perpendicular to x).</li>
            <li><b>Atomic positions:</b> unit cell index m = 0,1,…,N−1; within each cell:
              <ul>
                <li>A at x = m a</li>
                <li>B at x = m a + a/2</li>
              </ul>
            </li>
            <li><b>Incident field:</b> scalar plane wave (for simplicity) <span style="font-family:var(--mono)">E_i(r) = E0 e^{i k⃗_i·r}</span>.</li>
            <li><b>Far-field scattered amplitude:</b> linear superposition (Born/kinematic):
              <span style="font-family:var(--mono)">A(q⃗) = Σ_j f_j e^{i q⃗·r⃗_j}</span>.</li>
            <li><b>Boundary/initial conditions:</b> time-harmonic steady state; no explicit PDE solving needed because we use the known Green’s-function far-field form (linearity).</li>
          </ul>
        </div>

        <details>
          <summary>Optional mathematical physics note: connection to PDEs and Green’s functions</summary>
          <p>
            In the weak-scattering limit, the scattered field satisfies a driven Helmholtz equation
            <span style="font-family:var(--mono)">(∇² + k²)ψ_s = -V(r) ψ_i</span>,
            with V(r) a scattering potential (sum of localized atomic contributions). The far-field solution is a convolution with the Helmholtz Green’s function,
            which in the Fraunhofer limit yields a Fourier transform of V(r). That’s the origin of the phasor sum
            <span style="font-family:var(--mono)">A(q⃗)=∫ V(r) e^{i q⃗·r} d³r</span>, discretized here to atoms.
          </p>
        </details>

        <h3>Step 1: Write k⃗<sub>i</sub>, k⃗<sub>s</sub>, and q⃗</h3>
        <p>
          Let the chain be the x-axis. “Incident beam perpendicular to the line” means the incident wavevector has no x-component. Choose:
        </p>
        <div class="equation" data-copy="k_i = k ŷ,  |k_i|=k=2π/λ">
          <div class="eqrow">
            <div>k⃗<sub>i</sub> = k ŷ, &nbsp;&nbsp;|k⃗<sub>i</sub>| = k = 2π/λ</div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          The scattered wavevector k⃗<sub>s</sub> makes an angle θ with the chain (x-axis). Therefore its x-component is:
        </p>
        <div class="equation" data-copy="k_s,x = k cosθ  (θ is angle between diffracted beam and chain)">
          <div class="eqrow">
            <div>k<sub>s,x</sub> = k cosθ &nbsp;&nbsp;(θ is the angle between the diffracted beam and the x-axis)</div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          Define the scattering vector:
        </p>
        <div class="equation" data-copy="q = k_s − k_i">
          <div class="eqrow">
            <div>q⃗ = k⃗<sub>s</sub> − k⃗<sub>i</sub></div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          Since k⃗<sub>i</sub> has no x-component, the x-component of q⃗ is simply:
        </p>
        <div class="equation" data-copy="q_x = k_s,x − k_i,x = k cosθ">
          <div class="eqrow">
            <div>q<sub>x</sub> = k<sub>s,x</sub> − k<sub>i,x</sub> = k cosθ</div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>

        <div class="callout">
          <p class="title">Why this step is valid <span class="badge">linearity + projection</span></p>
          <p>
            The phase at an atom at position r⃗<sub>j</sub> is q⃗·r⃗<sub>j</sub>. Because all atoms lie on the x-axis, r⃗<sub>j</sub> = x<sub>j</sub> x̂ and
            q⃗·r⃗<sub>j</sub> = q<sub>x</sub> x<sub>j</sub>. Thus only q<sub>x</sub> matters for interference along the chain.
          </p>
        </div>

        <h3>Step 2: Write the full scattering amplitude as a lattice sum × basis sum</h3>
        <p>
          Positions in the m-th unit cell:
        </p>
        <div class="equation" data-copy="x_A(m)=ma,  x_B(m)=ma + a/2,  m=0..N−1">
          <div class="eqrow">
            <div>x<sub>A</sub>(m)=ma, &nbsp; x<sub>B</sub>(m)=ma + a/2, &nbsp; m=0..N−1</div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          The amplitude is the sum over all atoms:
        </p>
        <div class="equation" data-copy="A(qx)=Σ_{m=0}^{N−1}[ fA e^{iqx(ma)} + fB e^{iqx(ma+a/2)} ]">
          <div class="eqrow">
            <div>
              A(q<sub>x</sub>) = Σ<sub>m=0</sub><sup>N−1</sup>
              [ f<sub>A</sub> e<sup>i q<sub>x</sub>(ma)</sup> + f<sub>B</sub> e<sup>i q<sub>x</sub>(ma + a/2)</sup> ]
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          Factor out e<sup>i q<sub>x</sub> ma</sup> inside the bracket (algebraic factoring is valid by distributivity):
        </p>
        <div class="equation" data-copy="A(qx)=Σ_{m=0}^{N−1} e^{iqx ma} [ fA + fB e^{iqx a/2} ]">
          <div class="eqrow">
            <div>
              A(q<sub>x</sub>) = Σ<sub>m=0</sub><sup>N−1</sup> e<sup>i q<sub>x</sub> m a</sup>
              [ f<sub>A</sub> + f<sub>B</sub> e<sup>i q<sub>x</sub> a/2</sup> ]
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          This is the key factorization:
        </p>
        <div class="equation" data-copy="A(qx)=L_N(qx) · F(qx), where L_N=Σ_{m=0}^{N−1} e^{iqx ma},  F=fA + fB e^{iqx a/2}">
          <div class="eqrow">
            <div>
              A(q<sub>x</sub>) = L<sub>N</sub>(q<sub>x</sub>) · F(q<sub>x</sub>),<br/>
              L<sub>N</sub>(q<sub>x</sub>) = Σ<sub>m=0</sub><sup>N−1</sup> e<sup>i q<sub>x</sub> m a</sup>, &nbsp;
              F(q<sub>x</sub>) = f<sub>A</sub> + f<sub>B</sub> e<sup>i q<sub>x</sub> a/2</sup>.
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>

        <div class="callout">
          <p class="title">Math Insight <span class="badge">geometric series</span></p>
          <p>
            L<sub>N</sub> is a geometric series in the complex ratio r = e<sup>i q<sub>x</sub>a</sup>.
            Its magnitude becomes very large when r ≈ 1, i.e., when q<sub>x</sub>a is an integer multiple of 2π.
            That is the mathematical origin of “diffraction orders.”
          </p>
        </div>

        <h3>Step 3: Derive the interference condition (part a)</h3>
        <p>
          Evaluate the lattice sum:
        </p>
        <div class="equation" data-copy="L_N(qx)= (1 − e^{iqx Na})/(1 − e^{iqx a})  (for e^{iqx a}≠1)">
          <div class="eqrow">
            <div>
              L<sub>N</sub>(q<sub>x</sub>) =
              <span style="white-space:nowrap"> (1 − e<sup>i q<sub>x</sub> N a</sup>) / (1 − e<sup>i q<sub>x</sub> a</sup>) </span>
              &nbsp; (for e<sup>i q<sub>x</sub>a</sup> ≠ 1)
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          The “principal maxima” occur when the denominator is near zero, i.e.:
        </p>
        <div class="equation" data-copy="1 − e^{iqx a} = 0  ⇒  e^{iqx a}=1  ⇒  qx a = 2π n,  n∈ℤ">
          <div class="eqrow">
            <div>
              1 − e<sup>i q<sub>x</sub> a</sup> = 0
              ⇒ e<sup>i q<sub>x</sub> a</sup> = 1
              ⇒ q<sub>x</sub> a = 2π n, &nbsp; n ∈ ℤ
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          Substitute q<sub>x</sub> = k cosθ with k = 2π/λ:
        </p>
        <div class="equation" data-copy="(2π/λ) cosθ · a = 2π n  ⇒  nλ = a cosθ">
          <div class="eqrow">
            <div>
              (2π/λ) cosθ · a = 2π n
              ⇒ nλ = a cosθ
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>

        <div class="finalbox">
          <div class="eqrow">
            <div>
              <b>Part (a) result (boxed):</b><br/>
              <span style="font-family:var(--mono); font-size:14px;">
                nλ = a cosθ
              </span>
            </div>
            <button class="copybtn" type="button" data-copy-btn data-copy="nλ = a cosθ">Copy</button>
          </div>
          <p style="margin:8px 0 0; color:var(--muted);">
            Interpretation: The outgoing wave must accumulate an integer multiple of 2π phase over one full AB unit cell (length a) along the chain direction.
          </p>
        </div>

        <h3>Step 4: Compute intensity parity (part b)</h3>
        <p>
          At the diffraction maxima we have q<sub>x</sub>a = 2πn. Then the internal basis phase becomes:
        </p>
        <div class="equation" data-copy="e^{i qx a/2} = e^{i (2πn)(1/2)} = e^{iπ n} = (−1)^n">
          <div class="eqrow">
            <div>
              e<sup>i q<sub>x</sub> a/2</sup> = e<sup>i (2πn)(1/2)</sup> = e<sup>iπ n</sup> = (−1)<sup>n</sup>
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          Therefore the structure factor at order n is:
        </p>
        <div class="equation" data-copy="S_n = fA + fB (−1)^n">
          <div class="eqrow">
            <div>
              S<sub>n</sub> = f<sub>A</sub> + f<sub>B</sub>(−1)<sup>n</sup>
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          For a long chain, the lattice sum gives a large factor (≈N) at the maxima, so intensity is proportional to |S<sub>n</sub>|² (up to the same order-dependent envelope).
          Explicitly:
        </p>
        <div class="equation" data-copy="I_n ∝ |A|^2 ≈ |L_N|^2 |S_n|^2; at maxima |L_N|^2 scales ~ N^2 so parity is controlled by |S_n|^2">
          <div class="eqrow">
            <div>
              I<sub>n</sub> ∝ |A|² = |L<sub>N</sub>|² |S<sub>n</sub>|²; at maxima |L<sub>N</sub>|² ~ N², so parity is controlled by |S<sub>n</sub>|².
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>

        <p>
          Now separate even/odd:
        </p>
        <div class="grid2">
          <div class="callout">
            <p class="title">Odd n <span class="badge">n = 2m+1</span></p>
            <p>(−1)<sup>n</sup> = −1, so:</p>
            <div class="equation" data-copy="S_odd = fA − fB  ⇒  I_odd ∝ |fA − fB|^2">
              <div class="eqrow">
                <div>
                  S<sub>odd</sub> = f<sub>A</sub> − f<sub>B</sub>
                  ⇒ I<sub>odd</sub> ∝ |f<sub>A</sub> − f<sub>B</sub>|²
                </div>
                <button class="copybtn" type="button" data-copy-btn>Copy</button>
              </div>
            </div>
          </div>
          <div class="callout">
            <p class="title">Even n <span class="badge">n = 2m</span></p>
            <p>(−1)<sup>n</sup> = +1, so:</p>
            <div class="equation" data-copy="S_even = fA + fB  ⇒  I_even ∝ |fA + fB|^2">
              <div class="eqrow">
                <div>
                  S<sub>even</sub> = f<sub>A</sub> + f<sub>B</sub>
                  ⇒ I<sub>even</sub> ∝ |f<sub>A</sub> + f<sub>B</sub>|²
                </div>
                <button class="copybtn" type="button" data-copy-btn>Copy</button>
              </div>
            </div>
          </div>
        </div>

        <h3>Step 5: Special case f<sub>A</sub> = f<sub>B</sub> (part c)</h3>
        <p>
          If f<sub>A</sub> = f<sub>B</sub> = f, then:
        </p>
        <div class="equation" data-copy="S_n = f + f(−1)^n = f(1 + (−1)^n)">
          <div class="eqrow">
            <div>
              S<sub>n</sub> = f + f(−1)<sup>n</sup> = f(1 + (−1)<sup>n</sup>)
            </div>
            <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
        </div>
        <p>
          So:
        </p>
        <ul>
          <li><b>Odd n:</b> 1 + (−1) = 0 ⇒ S<sub>odd</sub> = 0 ⇒ <b>I<sub>odd</sub> = 0</b> (systematic absences).</li>
          <li><b>Even n:</b> 1 + (+1) = 2 ⇒ S<sub>even</sub> = 2f ⇒ <b>I<sub>even</sub> ∝ |2f|² = 4|f|²</b> (enhanced).</li>
        </ul>

        <div class="callout">
          <p class="title">Physical explanation <span class="badge">extinction / symmetry</span></p>
          <p>
            When A and B scatter identically, the “AB” labeling carries no physical contrast. The chain becomes effectively monoatomic with spacing a/2.
            The diffraction pattern defined by the larger period a then shows <b>missing odd orders</b> because those correspond to Fourier components that cancel by symmetry.
          </p>
        </div>

        <h3>Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <p class="title">Dimensional analysis <span class="badge">units</span></p>
            <ul>
              <li>In <span style="font-family:var(--mono)">nλ = a cosθ</span>, both λ and a have units of length; cosθ is dimensionless ⇒ consistent.</li>
              <li>q<sub>x</sub> = (2π/λ)cosθ has units 1/length ⇒ phase q<sub>x</sub>x is dimensionless ⇒ consistent.</li>
            </ul>
          </div>
          <div class="callout">
            <p class="title">Limiting cases <span class="badge">asymptotics</span></p>
            <ul>
              <li>θ → 90° ⇒ cosθ → 0 ⇒ only n=0 satisfies nλ = a cosθ: scattering along the chain direction kills phase matching along x.</li>
              <li>f<sub>B</sub> → 0 (B scatters negligibly) ⇒ I<sub>odd</sub> and I<sub>even</sub> both reduce toward |f<sub>A</sub>|² (no strong parity contrast).</li>
              <li>Large contrast |f<sub>A</sub>−f<sub>B</sub>| ≫ 0 ⇒ odd peaks become strong: ordering is “visible.”</li>
            </ul>
          </div>
        </div>

        <div class="finalbox" id="finalAnswerBox">
          <div class="eqrow">
            <div>
              <b>Final Answer (Parts a–c):</b><br/>
              <span style="font-family:var(--mono); font-size:14px;">
                (a) nλ = a cosθ.<br/>
                (b) I_odd ∝ |fA − fB|^2, &nbsp; I_even ∝ |fA + fB|^2.<br/>
                (c) If fA = fB, then I_odd = 0 (systematic absences) and even orders are enhanced.
              </span>
            </div>
            <button class="copybtn" type="button" id="copyFinal">Copy</button>
          </div>
        </div>

        <figure aria-label="Single static plot">
          <canvas id="plot" width="1200" height="560"></canvas>
          <figcaption>
            One illustrative (example-values) plot of alternating diffraction-order intensities versus order n.
            Example only: fA = 1.0, fB = 0.6 (arbitrary units). The symbolic results remain the final answer.
          </figcaption>
        </figure>

        <a class="backtop" href="#top">↑ Back to top</a>
      </article>

      <article id="p4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpret the final formula: what each term controls</h3>
        <ul>
          <li><b>nλ = a cosθ</b>: selects scattering directions where the phase advance over one AB unit cell is 2πn.</li>
          <li><b>f<sub>A</sub> + f<sub>B</sub></b> (even n): measures the “average” scattering strength of the two-atom basis.</li>
          <li><b>f<sub>A</sub> − f<sub>B</sub></b> (odd n): measures the <b>contrast</b> between the two species—this is why odd peaks are used to quantify ordering/composition modulation.</li>
        </ul>

        <h3>Parameter dependence (qualitative)</h3>
        <ul>
          <li>Increasing <b>a</b> (larger repeat length) narrows reciprocal spacing and changes the angles satisfying the condition for a fixed λ.</li>
          <li>Changing <b>λ</b> scales the “diffraction angles” through cosθ = nλ/a (must satisfy |cosθ| ≤ 1).</li>
          <li>Increasing |f<sub>A</sub>−f<sub>B</sub>| boosts odd-order intensities strongly (quadratically, since I ∝ |…|²).</li>
        </ul>

        <details>
          <summary>Alternative derivation idea (brief but meaningful): density + Fourier series</summary>
          <p>
            Represent the chain as a 1D “Dirac comb” with a 2-atom basis:
            <span style="font-family:var(--mono)">ρ(x)=Σ_m [ fA δ(x−ma) + fB δ(x−ma−a/2) ]</span>.
            Its Fourier transform is
            <span style="font-family:var(--mono)">ρ̃(qx)= (2π/a) Σ_n δ(qx−2πn/a) · (fA + fB e^{iqx a/2})</span>.
            Evaluating the basis factor at qx=2πn/a yields fA+fB(−1)^n, giving the same parity rule.
          </p>
        </details>

        <h3>Concept check (self-test with answers)</h3>
        <ul>
          <li><b>Q:</b> Why does only q<sub>x</sub> matter? <b>A:</b> All atoms lie on the x-axis, so q⃗·r⃗ = q<sub>x</sub>x.</li>
          <li><b>Q:</b> What physical feature do odd orders measure? <b>A:</b> The A–B contrast (difference) in scattering strength.</li>
          <li><b>Q:</b> Why do odd orders vanish when f<sub>A</sub>=f<sub>B</sub>? <b>A:</b> The basis becomes symmetric; the corresponding Fourier components cancel (structure factor zero).</li>
          <li><b>Q:</b> If disorder mixes A and B randomly, what happens? <b>A:</b> The effective contrast decreases, suppressing odd intensities and broadening peaks.</li>
        </ul>

        <a class="backtop" href="#top">↑ Back to top</a>
      </article>

      <article id="p5">
        <h2>PART 5 — Optional Plot Guide</h2>
        <p>
          The plot shows <b>example</b> intensities vs diffraction order n using the derived formulas:
          <span style="font-family:var(--mono)">I_even ∝ |fA+fB|²</span> and <span style="font-family:var(--mono)">I_odd ∝ |fA−fB|²</span>.
          It’s useful because it visually emphasizes the <b>parity alternation</b>: even orders cluster at one level and odd orders at another.
        </p>
        <ul>
          <li><b>x-axis:</b> diffraction order n (dimensionless integer).</li>
          <li><b>y-axis:</b> relative intensity (arbitrary units, normalized for display).</li>
          <li><b>Example values (only for plotting):</b> f<sub>A</sub>=1.0, f<sub>B</sub>=0.6.</li>
          <li><b>Features to notice:</b> constant “even level” vs constant “odd level” and the gap between them (set by contrast).</li>
        </ul>

        <a class="backtop" href="#top">↑ Back to top</a>
      </article>
    </div>
  </main>

  <footer>
    <p>
      Built as a single-file, self-contained learning article (vanilla HTML/CSS/JS). Copy buttons copy plain-text equations and the final answer.
      Print view hides UI-only elements.
    </p>
  </footer>

  <script>
    // Copy buttons for equations (plain text from data-copy, falling back to textContent)
    (function(){
      function copyText(text){
        if(!text) return;
        navigator.clipboard.writeText(text).then(()=> {
          // minimal UX feedback without popups
        }).catch(()=>{});
      }

      document.querySelectorAll('[data-copy-btn]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const host = btn.closest('[data-copy]');
          const text = btn.getAttribute('data-copy') || (host ? host.getAttribute('data-copy') : null) || (host ? host.innerText : null);
          copyText((text || '').trim());
          btn.textContent = "Copied";
          setTimeout(()=>btn.textContent="Copy", 900);
        });
      });

      const copyFinal = document.getElementById('copyFinal');
      if(copyFinal){
        copyFinal.addEventListener('click', ()=>{
          const txt =
`(a) nλ = a cosθ.
(b) I_odd ∝ |fA − fB|^2,  I_even ∝ |fA + fB|^2.
(c) If fA = fB, then I_odd = 0 (systematic absences) and even orders are enhanced.`;
          copyText(txt);
          copyFinal.textContent = "Copied";
          setTimeout(()=>copyFinal.textContent="Copy", 900);
        });
      }
    })();

    // One static plot (non-interactive) showing parity alternation with example values
    (function(){
      const canvas = document.getElementById('plot');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');

      // Example values for visualization only
      const fA = 1.0, fB = 0.6;
      const Ieven = Math.pow(Math.abs(fA + fB), 2);
      const Iodd  = Math.pow(Math.abs(fA - fB), 2);

      const nMin = 0, nMax = 10;
      const data = [];
      for(let n=nMin; n<=nMax; n++){
        data.push({n, I: (n%2===0)? Ieven : Iodd});
      }

      function draw(){
        // Responsive + crisp on high-DPI
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const cssW = canvas.clientWidth;
        const cssH = canvas.clientHeight;
        canvas.width = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);

        // Layout
        const W = cssW, H = cssH;
        ctx.clearRect(0,0,W,H);

        const padL = 56, padR = 16, padT = 34, padB = 44;
        const plotW = W - padL - padR;
        const plotH = H - padT - padB;

        // Title
        ctx.font = "600 14px " + getComputedStyle(document.body).fontFamily;
        ctx.fillStyle = getComputedStyle(document.body).color;
        ctx.fillText("Example: Parity Alternation of Intensities vs Order n", padL, 18);

        // Axes ranges
        const Imax = Math.max(Ieven, Iodd) * 1.15;
        const x0 = padL, y0 = padT + plotH;

        function xMap(n){
          return x0 + ( (n - nMin) / (nMax - nMin) ) * plotW;
        }
        function yMap(I){
          return padT + plotH - (I / Imax) * plotH;
        }

        // Gridlines + ticks
        const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--border').trim() || "rgba(255,255,255,.12)";
        ctx.strokeStyle = gridColor;
        ctx.lineWidth = 1;

        // Y grid (5)
        const yTicks = 5;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || "#aab6df";

        for(let i=0;i<=yTicks;i++){
          const val = (Imax * i / yTicks);
          const y = yMap(val);
          ctx.beginPath();
          ctx.moveTo(x0, y);
          ctx.lineTo(x0 + plotW, y);
          ctx.stroke();
          const label = (val).toFixed(2);
          ctx.fillText(label, 8, y + 4);
        }

        // X ticks at each integer
        for(let n=nMin;n<=nMax;n++){
          const x = xMap(n);
          ctx.beginPath();
          ctx.moveTo(x, y0);
          ctx.lineTo(x, y0+6);
          ctx.stroke();
          ctx.fillText(String(n), x-3, y0+22);
        }

        // Axes
        ctx.strokeStyle = getComputedStyle(document.body).color;
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(x0, padT);
        ctx.lineTo(x0, y0);
        ctx.lineTo(x0+plotW, y0);
        ctx.stroke();

        // Axis labels
        ctx.fillStyle = getComputedStyle(document.body).color;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
        ctx.fillText("Order n (dimensionless)", x0 + plotW/2 - 60, H - 12);

        ctx.save();
        ctx.translate(14, padT + plotH/2 + 40);
        ctx.rotate(-Math.PI/2);
        ctx.fillText("Relative intensity (arb. units)", 0, 0);
        ctx.restore();

        // Draw data as lollipops
        const evenColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || "#7dd3fc";
        const oddColor  = getComputedStyle(document.documentElement).getPropertyValue('--accent2').trim() || "#a78bfa";
        const baseColor = gridColor;

        data.forEach(d=>{
          const x = xMap(d.n);
          const y = yMap(d.I);

          ctx.strokeStyle = baseColor;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(x, y0);
          ctx.lineTo(x, y);
          ctx.stroke();

          ctx.fillStyle = (d.n%2===0)? evenColor : oddColor;
          ctx.beginPath();
          ctx.arc(x, y, 5.5, 0, Math.PI*2);
          ctx.fill();
        });

        // Legend
        const lx = x0 + plotW - 210;
        const ly = padT + 10;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;

        ctx.fillStyle = evenColor;
        ctx.beginPath(); ctx.arc(lx, ly, 5, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = getComputedStyle(document.body).color;
        ctx.fillText("even n: |fA+fB|²", lx+12, ly+4);

        ctx.fillStyle = oddColor;
        ctx.beginPath(); ctx.arc(lx, ly+18, 5, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = getComputedStyle(document.body).color;
        ctx.fillText("odd n:  |fA−fB|²", lx+12, ly+22);
      }

      const ro = new ResizeObserver(()=>draw());
      ro.observe(canvas);
      draw();
    })();
  </script>
</body>
</html>
