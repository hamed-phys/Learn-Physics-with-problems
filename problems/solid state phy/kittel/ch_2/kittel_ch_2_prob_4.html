<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>Width of a Diffraction Maximum (Finite 1D Crystal): Derivation, Math Physics, and Engineering Relevance</title>
  <style>
    :root{
      --bg:#0b0d12;
      --panel:#101522;
      --panel2:#0f1320;
      --text:#e8ecf6;
      --muted:#b8c0d6;
      --faint:#7f8aa8;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f8fc;
        --panel:#ffffff;
        --panel2:#ffffff;
        --text:#0d1326;
        --muted:#374151;
        --faint:#6b7280;
        --border:rgba(15,23,42,.12);
        --shadow: 0 12px 30px rgba(2,6,23,.10);
      }
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, rgba(125,211,252,.16), transparent 55%),
                  radial-gradient(1200px 600px at 85% 0%, rgba(167,139,250,.14), transparent 60%),
                  var(--bg);
      line-height:1.55;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre{font-family:var(--mono)}
    .wrap{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      width:min(1200px, 96vw);
      margin:0 auto;
      padding:18px 0 60px;
    }
    header{
      grid-column:1/-1;
      background:linear-gradient(180deg, rgba(125,211,252,.10), rgba(167,139,250,.08));
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero{
      padding:18px 18px 14px;
      display:grid;
      gap:10px;
    }
    .kicker{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      color:var(--muted);
      font-size:.95rem;
    }
    .pill{
      border:1px solid var(--border);
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.04);
      backdrop-filter: blur(6px);
    }
    h1{
      margin:0;
      font-size:clamp(1.35rem, 1.9vw + 1rem, 2.2rem);
      letter-spacing:.2px;
    }
    .sub{
      color:var(--muted);
      max-width:90ch;
      margin:0;
    }

    /* Sticky TOC */
    nav{
      position:sticky;
      top:14px;
      align-self:start;
      background:rgba(16,21,34,.70);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:14px 12px;
      backdrop-filter: blur(10px);
    }
    @media (prefers-color-scheme: light){
      nav{background:rgba(255,255,255,.75)}
    }
    nav h2{
      margin:0 0 8px;
      font-size:1rem;
      letter-spacing:.3px;
      color:var(--text);
    }
    .toc{
      list-style:none;
      padding:0;
      margin:0;
      display:grid;
      gap:6px;
      font-size:.95rem;
    }
    .toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid transparent;
      color:var(--muted);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .toc a:hover{
      background:rgba(125,211,252,.10);
      border-color:rgba(125,211,252,.25);
      transform: translateY(-1px);
      text-decoration:none;
      color:var(--text);
    }

    main{
      background:rgba(16,21,34,.55);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    @media (prefers-color-scheme: light){
      main{background:rgba(255,255,255,.78)}
    }
    article{padding:18px}
    section{
      padding:16px 0;
      border-top:1px solid var(--border);
    }
    section:first-of-type{border-top:none}
    h2{
      margin:0 0 8px;
      font-size:1.3rem;
    }
    h3{
      margin:14px 0 8px;
      font-size:1.05rem;
      color:var(--text);
    }
    p{margin:8px 0; color:var(--muted)}
    ul, ol{margin:8px 0 8px 22px; color:var(--muted)}
    li{margin:5px 0}
    .grid2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr; padding:12px 0 60px}
      nav{position:relative; top:auto}
      .grid2{grid-template-columns:1fr}
    }

    /* Callouts */
    .callout{
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius:16px;
      padding:12px 12px 10px;
      box-shadow: 0 8px 22px rgba(0,0,0,.20);
    }
    .callout strong{color:var(--text)}
    .callout .title{
      display:flex; align-items:center; gap:10px;
      margin:0 0 6px;
      color:var(--text);
      font-weight:700;
      letter-spacing:.2px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 0 4px rgba(125,211,252,.12);
    }
    .dot.warn{background:var(--warn); box-shadow:0 0 0 4px rgba(251,191,36,.14)}
    .dot.ok{background:var(--ok); box-shadow:0 0 0 4px rgba(52,211,153,.12)}
    .dot.bad{background:var(--bad); box-shadow:0 0 0 4px rgba(251,113,133,.12)}
    .muted{color:var(--muted)}
    .faint{color:var(--faint)}

    /* Equation blocks + copy */
    .eq{
      margin:10px 0;
      border:1px solid var(--border);
      border-radius:14px;
      overflow:hidden;
      background:rgba(0,0,0,.16);
    }
    @media (prefers-color-scheme: light){
      .eq{background:rgba(15,23,42,.03)}
    }
    .eqhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border-bottom:1px solid var(--border);
      background:rgba(255,255,255,.03);
    }
    .eqhead .label{
      font-weight:700;
      color:var(--text);
      font-size:.95rem;
    }
    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:7px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:650;
      font-size:.9rem;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(125,211,252,.35);
      background: rgba(125,211,252,.08);
    }
    .btn:active{transform: translateY(0px) scale(.99)}
    .eq pre{
      margin:0;
      padding:10px 12px 12px;
      overflow:auto;
      color:var(--text);
      font-size:.95rem;
      line-height:1.45;
    }
    .inline-mono{font-family:var(--mono); color:var(--text); font-size:.95em}
    .box{
      display:grid;
      gap:10px;
    }

    details{
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(255,255,255,.03);
      margin:10px 0;
    }
    details summary{
      cursor:pointer;
      font-weight:750;
      color:var(--text);
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    details summary::-webkit-details-marker{display:none}
    details summary:after{
      content:"▾";
      color:var(--faint);
      transition: transform .18s ease;
    }
    details[open] summary:after{transform: rotate(180deg)}
    details .content{margin-top:8px; color:var(--muted)}

    figure{
      margin:12px 0 0;
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      background:rgba(0,0,0,.12);
    }
    figcaption{
      padding:10px 12px 12px;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:.95rem;
    }
    canvas{display:block; width:100%; height:auto}
    .backtop{
      display:inline-flex; align-items:center; gap:8px;
      margin-top:10px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .backtop:hover{
      transform: translateY(-1px);
      border-color: rgba(167,139,250,.35);
      background: rgba(167,139,250,.08);
      text-decoration:none;
      color:var(--text);
    }
    footer{
      grid-column:1/-1;
      color:var(--faint);
      padding:10px 0 0;
      text-align:center;
      font-size:.95rem;
    }

    /* Print-friendly */
    @media print{
      body{background:#fff !important; color:#000}
      nav{display:none}
      header, main{box-shadow:none !important}
      .btn{display:none}
      a{color:#000; text-decoration:underline}
      section{break-inside:avoid-page}
      figure{break-inside:avoid-page}
      .callout, .eq, details{break-inside:avoid-page}
    }
  </style>
</head>

<body>
  <a id="top"></a>
  <div class="wrap">
    <header>
      <div class="hero">
        <div class="kicker">
          <span class="pill">Diffraction from a finite crystal</span>
          <span class="pill">Geometric series → Dirichlet kernel</span>
          <span class="pill">Peak width ∝ 1/M</span>
          <span class="pill">Applied physics + industrial engineering lens</span>
        </div>
        <h1>Width of a Diffraction Maximum (Finite 1D Lattice): Full Derivation + Mathematical Physics</h1>
        <p class="sub">
          We compute the scattering amplitude from <span class="inline-mono">M</span> identical point scatterers on a 1D lattice,
          derive the exact intensity envelope, and prove the first-zero peak width scales like <span class="inline-mono">1/M</span>.
          Along the way, we interpret the result as a Fourier-transform object (a finite comb convolved with a sinc-like kernel),
          connect it to resolution limits in real instruments, and highlight engineering consequences.
        </p>
      </div>
    </header>

    <nav aria-label="Table of contents">
      <h2>Contents</h2>
      <ul class="toc">
        <li><a href="#qs">Quick Summary</a></li>
        <li><a href="#p0">PART 0 — Concept Primer</a></li>
        <li><a href="#p0b">PART 0B — Industry & Applied Physics</a></li>
        <li><a href="#p1">PART 1 — Problem Analysis</a></li>
        <li><a href="#p2">PART 2 — Strategy & Tips</a></li>
        <li><a href="#p3">PART 3 — Full Solution</a></li>
        <li><a href="#p4">PART 4 — Deeper Understanding</a></li>
        <li><a href="#p5">PART 5 — Optional Plot Guide</a></li>
      </ul>
    </nav>

    <main>
      <article>
        <!-- Quick Summary -->
        <section id="qs">
          <h2>Quick Summary</h2>
          <ul>
            <li><strong>What this is:</strong> scattering/diffraction from a <strong>finite</strong> 1D crystal: <span class="inline-mono">M</span> identical point scatterers at positions <span class="inline-mono">x_m = m a</span>.</li>
            <li><strong>Key physics idea:</strong> waves from different lattice points interfere; peaks occur when phase advances by integer multiples of <span class="inline-mono">2π</span> between neighbors.</li>
            <li><strong>Governing equation:</strong> the complex amplitude is a finite sum (a geometric series)
              <span class="inline-mono">F(Δk) = Σ_{m=0}^{M-1} exp(-i m a Δk)</span>.
            </li>
            <li><strong>Intensity:</strong> <span class="inline-mono">I(Δk) ∝ |F(Δk)|²</span> gives the exact peak shape:
              <span class="inline-mono">|F|² = sin²(M aΔk /2)/sin²(aΔk/2)</span>.
            </li>
            <li><strong>Maxima condition:</strong> principal maxima at <span class="inline-mono">aΔk = 2πh</span>, <span class="inline-mono">h ∈ ℤ</span>.</li>
            <li><strong>Width result (first zeros):</strong> near a maximum, write <span class="inline-mono">aΔk = 2πh + ε</span>; first zeros satisfy <span class="inline-mono">ε = ±2π/M</span> ⇒ peak width scales like <strong>1/M</strong>.</li>
            <li><strong>Meaning:</strong> larger crystals (more periods) produce much <strong>sharper</strong> diffraction peaks (higher spectral/angular resolution).</li>
            <li><strong>Result type:</strong> symbolic, exact; the plot below uses example values only to visualize narrowing with <span class="inline-mono">M</span>.</li>
          </ul>

          <div class="grid2">
            <div class="callout">
              <div class="title"><span class="dot ok"></span>Final Results (boxed)</div>
              <div class="eq" data-eq="eq-final">
                <div class="eqhead">
                  <div class="label">Key equation: finite-lattice intensity</div>
                  <button class="btn" data-copy="eq-final">Copy equation</button>
                </div>
                <pre id="eq-final">F(Δk) = Σ_{m=0}^{M-1} exp(-i m a Δk)
|F(Δk)|^2 = sin^2(M aΔk / 2) / sin^2(aΔk / 2)</pre>
              </div>

              <div class="eq" data-eq="eq-width">
                <div class="eqhead">
                  <div class="label">Peak width via first zeros</div>
                  <button class="btn" data-copy="eq-width">Copy equation</button>
                </div>
                <pre id="eq-width">Maxima: aΔk = 2πh
Let aΔk = 2πh + ε.
First zeros: ε = ±(2π/M)
⇒ width between first zeros: Δε = 4π/M  (scales as 1/M)</pre>
              </div>
            </div>

            <div class="callout">
              <div class="title"><span class="dot"></span>Math Insight (preview)</div>
              <p class="muted">
                <strong>Mathematical object:</strong> <span class="inline-mono">F</span> is the discrete Fourier transform of a
                length-<span class="inline-mono">M</span> “top-hat” sequence. Up to a phase,
                <span class="inline-mono">F</span> is the <strong>Dirichlet kernel</strong>, and
                <span class="inline-mono">|F|²</span> is its squared magnitude—an exact interference envelope whose central lobe
                width shrinks like <span class="inline-mono">1/M</span>.
              </p>
              <details>
                <summary>Why peak narrowing is inevitable (one sentence)</summary>
                <div class="content">
                  A finite chain is a “windowed” periodic structure, and windowing in real space becomes convolution in reciprocal space, producing a main lobe whose width scales inversely with the window length (here, <span class="inline-mono">Ma</span>).
                </div>
              </details>
            </div>
          </div>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 0 -->
        <section id="p0">
          <h2>PART 0 — Concept Primer (THEORY BEFORE SOLVING)</h2>

          <h3>Core definitions (symbols + SI units)</h3>
          <ul>
            <li><strong>Lattice spacing</strong> <span class="inline-mono">a</span> (meters, m): distance between neighboring scatterers.</li>
            <li><strong>Number of scatterers</strong> <span class="inline-mono">M</span> (dimensionless): points indexed <span class="inline-mono">m = 0,1,...,M−1</span>.</li>
            <li><strong>Positions</strong> <span class="inline-mono">x_m = m a</span> (m): 1D lattice points along the chain.</li>
            <li><strong>Wavevector mismatch</strong> <span class="inline-mono">Δk</span> (rad/m): for elastic scattering, <span class="inline-mono">Δk = k_s − k_i</span> projected along the chain direction.</li>
            <li><strong>Scattering amplitude</strong> <span class="inline-mono">F(Δk)</span> (arbitrary amplitude units): sum of complex phasors.</li>
            <li><strong>Scattered intensity</strong> <span class="inline-mono">I(Δk) ∝ |F(Δk)|²</span> (relative intensity units).</li>
          </ul>

          <h3>Physical meaning (intuition)</h3>
          <p>
            Each lattice point emits a wave with phase <span class="inline-mono">exp(-i Δk x_m)</span>.
            When <span class="inline-mono">Δk</span> is such that the phase difference between neighboring points
            is an integer multiple of <span class="inline-mono">2π</span>, all phasors align and the amplitude adds
            coherently, giving a large peak. When phases drift, partial cancellation occurs.
          </p>

          <h3>Key principles + validity conditions</h3>
          <ul>
            <li><strong>Linearity / superposition:</strong> total complex amplitude is a sum of contributions.</li>
            <li><strong>Far-field (Fraunhofer) limit:</strong> path-length differences become linear in position, enabling the phase factor <span class="inline-mono">exp(-i Δk x)</span>.</li>
            <li><strong>Identical point scatterers:</strong> same scattering strength; only phases differ.</li>
            <li><strong>Static lattice:</strong> positions fixed; no thermal motion/Debye-Waller in this ideal model.</li>
          </ul>

          <div class="callout">
            <div class="title"><span class="dot warn"></span>Assumptions (what’s being idealized)</div>
            <ul>
              <li>Scatterers are points (no form factor), identical, and equally spaced.</li>
              <li>Single scattering (no multiple scattering / dynamical diffraction).</li>
              <li>Observation in far field so phases depend only on <span class="inline-mono">Δk</span> and positions.</li>
              <li>We treat 1D to isolate the core interference math; the same peak-narrowing logic extends to 3D.</li>
            </ul>
          </div>

          <h3>Common models/approximations and why they’re used</h3>
          <ul>
            <li><strong>Geometric-series evaluation:</strong> exact closed form for finite sums of exponentials.</li>
            <li><strong>Near-maximum expansion:</strong> set <span class="inline-mono">aΔk = 2πh + ε</span> with small <span class="inline-mono">ε</span> to compute peak width.</li>
            <li><strong>Small-angle/small-ε asymptotics:</strong> <span class="inline-mono">sin(ε/2) ≈ ε/2</span> for scaling checks.</li>
          </ul>

          <h3>Mini intuition examples (quick)</h3>
          <ul>
            <li><strong>M = 1:</strong> no interference; intensity constant: <span class="inline-mono">|F|² = 1</span>.</li>
            <li><strong>M = 2:</strong> classic two-slit: <span class="inline-mono">|F|² = 4 cos²(aΔk/2)</span>.</li>
            <li><strong>Large M:</strong> very sharp peaks at <span class="inline-mono">aΔk = 2πh</span>, with narrow main lobes and many small side lobes.</li>
          </ul>

          <h3>What to watch for (pitfalls)</h3>
          <ul>
            <li>Mixing up <span class="inline-mono">k</span> vs <span class="inline-mono">Δk</span> (the interference depends on the mismatch).</li>
            <li>Forgetting the absolute value squared: intensity depends on <span class="inline-mono">F*F</span>, not on <span class="inline-mono">F</span>.</li>
            <li>Not handling the “0/0” form at maxima correctly (use limits or expansions).</li>
            <li>Confusing <strong>peak height</strong> scaling (<span class="inline-mono">~M²</span>) with <strong>peak width</strong> scaling (<span class="inline-mono">~1/M</span>).</li>
          </ul>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 0B -->
        <section id="p0b">
          <h2>PART 0B — Industry & Applied Physics Perspective</h2>

          <h3>Where this shows up (concrete application areas)</h3>
          <ul>
            <li><strong>X-ray diffraction (XRD) & materials QA:</strong> peak widths encode crystallite size and microstrain; used in metallurgy, semiconductors, pharmaceuticals.</li>
            <li><strong>Optical gratings & spectrometers:</strong> finite grating length sets spectral resolution; governs instrument design in telecom and sensing.</li>
            <li><strong>Electron diffraction / TEM:</strong> finite domain sizes and coherence lengths shape diffraction spots; crucial in nanoscale characterization.</li>
            <li><strong>Manufacturing metrology:</strong> periodic structures (lithography lines, MEMS gratings) produce diffraction signatures used for inline inspection.</li>
          </ul>

          <h3>Why engineers care</h3>
          <ul>
            <li><strong>Performance:</strong> sharper peaks → better ability to separate close spacings or wavelengths (higher resolution).</li>
            <li><strong>Reliability:</strong> peak broadening can signal defects, grain refinement, stress—predicts fatigue behavior and failure risk.</li>
            <li><strong>Cost & throughput:</strong> knowing the fundamental width scaling helps set realistic specs for detector resolution and acquisition time.</li>
            <li><strong>Manufacturability:</strong> finite size and edge roughness act like windowing → side lobes and broadened peaks; tolerances matter.</li>
          </ul>

          <h3>Typical measurement/validation methods</h3>
          <ul>
            <li>XRD peak fitting (Gaussian/Lorentzian/Voigt) plus instrument broadening deconvolution.</li>
            <li>Optical spectral calibration using known lines; grating resolving power checks.</li>
            <li>TEM selected-area diffraction spot size vs aperture and domain size.</li>
          </ul>

          <h3>Design trade-offs & constraints</h3>
          <ul>
            <li><strong>Bigger M</strong> narrows peaks but increases size, cost, and sensitivity to misalignment and nonuniformity.</li>
            <li><strong>Edge effects</strong> produce side lobes; apodization (tapering) can reduce side lobes but broadens the main lobe (classic window trade-off).</li>
            <li><strong>Real materials</strong> include disorder, thermal motion, strain gradients—each broadens peaks beyond the ideal <span class="inline-mono">1/M</span> width.</li>
          </ul>

          <div class="callout">
            <div class="title"><span class="dot"></span>From lab to product</div>
            <p class="muted">
              In real instruments, the measured width is a convolution of the ideal finite-crystal response with:
              (i) the source coherence function, (ii) instrument resolution, and (iii) sample imperfections.
              Engineers often treat the ideal <span class="inline-mono">|F|²</span> as the “physics kernel” and add broadening terms
              (e.g., Voigt profiles) for robust specification and QA.
            </p>
          </div>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 1 -->
        <section id="p1">
          <h2>PART 1 — Problem Analysis (no solving yet)</h2>

          <h3>Problem restatement (in plain words)</h3>
          <p>
            We have a 1D lattice of <span class="inline-mono">M</span> identical point scatterers at positions
            <span class="inline-mono">x_m = m a</span>. The total scattered amplitude is proportional to the sum of the phasors
            <span class="inline-mono">exp(-i m a Δk)</span>.
            <br/>
            (a) Compute the scattered intensity <span class="inline-mono">|F|²</span> and show it equals
            <span class="inline-mono">sin²(M aΔk/2)/sin²(aΔk/2)</span>.
            <br/>
            (b) Diffraction maxima occur at <span class="inline-mono">aΔk = 2πh</span>. Let <span class="inline-mono">aΔk = 2πh + ε</span>.
            Find the first zero of <span class="inline-mono">sin(M aΔk/2)</span> near the maximum and show
            <span class="inline-mono">ε = 2π/M</span>, implying the peak width scales as <span class="inline-mono">1/M</span>.
          </p>

          <div class="grid2">
            <div>
              <h3>Given</h3>
              <ul>
                <li><span class="inline-mono">x_m = m a</span>, <span class="inline-mono">m ∈ {0,...,M−1}</span></li>
                <li><span class="inline-mono">F(Δk) ∝ Σ exp(-i m a Δk)</span></li>
                <li>Geometric series identity: <span class="inline-mono">Σ_{m=0}^{M-1} x^m = (1-x^M)/(1-x)</span></li>
              </ul>
            </div>
            <div>
              <h3>Unknowns / targets</h3>
              <ul>
                <li>(a) Prove a closed form for <span class="inline-mono">|F(Δk)|²</span>.</li>
                <li>(b) Find the first zero near a maximum and deduce width scaling.</li>
              </ul>
            </div>
          </div>

          <h3>Relevant principles (and why they apply)</h3>
          <ul>
            <li><strong>Superposition:</strong> identical scatterers → amplitude sum of phasors.</li>
            <li><strong>Complex conjugation:</strong> intensity is modulus squared <span class="inline-mono">F*F</span>.</li>
            <li><strong>Trigonometric identities:</strong> convert complex exponentials into sine ratios.</li>
            <li><strong>Root-finding:</strong> zeros of the numerator control main-lobe boundaries near maxima.</li>
          </ul>

          <div class="callout">
            <div class="title"><span class="dot warn"></span>Mathematical model (explicit)</div>
            <p class="muted">
              <strong>Domain / coordinates:</strong> 1D chain along coordinate <span class="inline-mono">x</span>.
              Scatterers sit at discrete points <span class="inline-mono">x_m = m a</span>, <span class="inline-mono">m=0,...,M−1</span>.
              <br/>
              <strong>Field model (far field):</strong> each point contributes a phase factor
              <span class="inline-mono">e^{-i Δk x_m}</span> to the observed amplitude at a fixed detector direction.
              <br/>
              <strong>Boundary conditions:</strong> finite chain (“hard window”)—no scatterers outside <span class="inline-mono">[0,(M−1)a]</span>.
              <br/>
              <strong>Key variable:</strong> scalar mismatch <span class="inline-mono">Δk</span> (projection along chain). In 3D, it is a vector and dot product appears: <span class="inline-mono">Δk·a</span>.
              <br/>
              <strong>Operators (where relevant):</strong> underlying wave fields satisfy a linear wave/Helmholtz PDE
              <span class="inline-mono">(∇² + k²)ψ = 0</span> in the homogeneous region; linearity justifies phasor summation.
              We do not solve the PDE here; we use its far-field phase structure.
            </p>
          </div>

          <h3>2–3 approaches (pros/cons)</h3>
          <ol>
            <li>
              <strong>Geometric-series algebra (best here):</strong>
              direct closed form for <span class="inline-mono">F</span> and then <span class="inline-mono">|F|²</span>.
              <span class="faint">Pros: exact, short, transparent. Cons: needs careful handling of maxima limits.</span>
            </li>
            <li>
              <strong>Fourier-transform viewpoint:</strong>
              treat the lattice as a finite sampled comb (windowed) and use transform properties.
              <span class="faint">Pros: deep insight, links to signal processing. Cons: more abstraction than needed.</span>
            </li>
            <li>
              <strong>Phasor polygon geometry:</strong>
              interpret the sum as a chord of a regular polygon in the complex plane.
              <span class="faint">Pros: strong intuition. Cons: algebra still needed to get the sine ratio neatly.</span>
            </li>
          </ol>
          <p><strong>Chosen approach:</strong> geometric-series derivation, supplemented with Fourier/Dirichlet-kernel interpretation for mathematical physics insight.</p>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 2 -->
        <section id="p2">
          <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

          <ol>
            <li><strong>Define the phasor sum</strong> <span class="inline-mono">F(Δk)</span> and set <span class="inline-mono">x = e^{-i aΔk}</span> (turn it into a geometric series).</li>
            <li><strong>Evaluate the sum exactly</strong> using <span class="inline-mono">(1-x^M)/(1-x)</span>.</li>
            <li><strong>Rewrite numerator/denominator magnitudes</strong> by factoring half-angles: use
              <span class="inline-mono">1-e^{-iθ} = e^{-iθ/2}(e^{iθ/2}-e^{-iθ/2}) = 2i e^{-iθ/2} sin(θ/2)</span>.
            </li>
            <li><strong>Compute</strong> <span class="inline-mono">|F|² = F*F</span>: global phases cancel, leaving a ratio of sine-squared terms.</li>
            <li><strong>Locate maxima</strong> from constructive interference: <span class="inline-mono">aΔk = 2πh</span>.</li>
            <li><strong>Expand near a maximum</strong>: write <span class="inline-mono">aΔk = 2πh + ε</span>.</li>
            <li><strong>Find first zeros</strong> of the numerator <span class="inline-mono">sin(M(aΔk)/2)</span> near the maximum: solve for <span class="inline-mono">ε</span>.</li>
            <li><strong>Conclude width scaling</strong> and perform sanity checks: dimensions and limiting cases.</li>
          </ol>

          <div class="callout">
            <div class="title"><span class="dot bad"></span>Common mistakes</div>
            <ul>
              <li>Dropping the complex conjugate: <span class="inline-mono">|F|²</span> is not <span class="inline-mono">F²</span>.</li>
              <li>Misusing the zero condition: near maxima, denominator is small too—use the exact sine ratio or careful limits.</li>
              <li>For part (b), solving <span class="inline-mono">sin(Mε/2)=0</span> but forgetting the nearest nonzero root is <span class="inline-mono">±2π/M</span>, not <span class="inline-mono">0</span>.</li>
              <li>Confusing “width” definition: here it’s from the <strong>first zeros</strong> around a principal maximum.</li>
            </ul>
          </div>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 3 -->
        <section id="p3">
          <h2>PART 3 — Full Solution (DETAILED + TEACHING)</h2>

          <h3>Qualitative expectation (before calculating)</h3>
          <p>
            With more equally spaced scatterers, interference becomes more selective:
            constructive interference happens only when the phase step per lattice spacing is extremely close to <span class="inline-mono">2πh</span>.
            Therefore we expect sharper peaks (smaller width) as <span class="inline-mono">M</span> increases, and peak heights to grow strongly due to coherent addition.
          </p>

          <h3>(a) Derive the exact intensity formula</h3>

          <div class="callout">
            <div class="title"><span class="dot"></span>Start from the amplitude sum</div>
            <p class="muted">
              Define the amplitude (up to an overall constant factor):
              <span class="inline-mono">F(Δk) = Σ_{m=0}^{M-1} exp(-i m a Δk)</span>.
              This is valid by linearity of the wave equation (superposition): each scatterer’s contribution is a solution of the same linear PDE, so their sum is also a solution in the far field.
            </p>
          </div>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Step 1: Convert to a geometric series</div>
              <button class="btn" data-copy="eq-step1">Copy equation</button>
            </div>
            <pre id="eq-step1">Let x = exp(-i aΔk). Then
F(Δk) = Σ_{m=0}^{M-1} x^m = (1 - x^M)/(1 - x)
= (1 - exp(-i M aΔk)) / (1 - exp(-i aΔk)).</pre>
          </div>

          <p>
            <strong>Why this step is valid:</strong> for any complex number <span class="inline-mono">x ≠ 1</span>, the finite-sum identity
            <span class="inline-mono">Σ_{m=0}^{M-1} x^m = (1-x^M)/(1-x)</span> holds (it follows from multiplying the sum by <span class="inline-mono">(1-x)</span> and telescoping).
            If <span class="inline-mono">x = 1</span> (i.e., <span class="inline-mono">aΔk = 2πh</span>), we interpret the expression by a limit; physically it’s exactly coherent addition.
          </p>

          <h3>Mathematical physics move: express differences of exponentials via sine</h3>
          <p>
            The key identity is:
            <span class="inline-mono">1 - e^{-iθ} = e^{-iθ/2}(e^{iθ/2} - e^{-iθ/2}) = 2i e^{-iθ/2} sin(θ/2)</span>.
            This is a standard half-angle factorization coming from Euler’s formula, and it is essential because magnitudes of complex phases are 1, leaving pure sine magnitudes.
          </p>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Step 2: Factor numerator and denominator</div>
              <button class="btn" data-copy="eq-step2">Copy equation</button>
            </div>
            <pre id="eq-step2">Use 1 - e^{-iθ} = 2i e^{-iθ/2} sin(θ/2).

Numerator:
1 - e^{-i M aΔk} = 2i e^{-i (M aΔk)/2} sin(M aΔk / 2)

Denominator:
1 - e^{-i aΔk} = 2i e^{-i (aΔk)/2} sin(aΔk / 2)</pre>
          </div>

          <p>
            Substitute into <span class="inline-mono">F</span>:
          </p>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Step 3: Simplify F(Δk)</div>
              <button class="btn" data-copy="eq-step3">Copy equation</button>
            </div>
            <pre id="eq-step3">F(Δk) = [2i e^{-i(M aΔk)/2} sin(M aΔk/2)] / [2i e^{-i(aΔk)/2} sin(aΔk/2)]
      = e^{-i[(M aΔk)/2 - (aΔk)/2]} * [ sin(M aΔk/2) / sin(aΔk/2) ]
      = e^{-i (M-1) aΔk / 2} * [ sin(M aΔk/2) / sin(aΔk/2) ].</pre>
          </div>

          <p>
            <strong>Why this matters:</strong> the prefactor <span class="inline-mono">e^{-i (M-1) aΔk/2}</span> is a pure phase (unit modulus),
            so it does not affect intensity. The entire interference pattern is controlled by the sine ratio.
          </p>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Step 4: Compute intensity |F|²</div>
              <button class="btn" data-copy="eq-step4">Copy equation</button>
            </div>
            <pre id="eq-step4">|F(Δk)|^2 = F*F
= | e^{-i (M-1) aΔk / 2} |^2 * [ sin(M aΔk/2) / sin(aΔk/2) ]^2
= 1 * sin^2(M aΔk/2) / sin^2(aΔk/2).</pre>
          </div>

          <div class="callout">
            <div class="title"><span class="dot ok"></span>Result for (a)</div>
            <p class="muted">
              We have shown:
              <span class="inline-mono">|F(Δk)|² = sin²(M aΔk/2) / sin²(aΔk/2)</span>,
              matching the required form (and identical to the vector-dot-product form <span class="inline-mono">a·Δk</span> in higher dimensions).
            </p>
          </div>

          <h3>Sanity checks for (a)</h3>
          <ul>
            <li><strong>Dimensions:</strong> <span class="inline-mono">aΔk</span> is dimensionless (m × rad/m), so sines are well-defined.</li>
            <li><strong>M=1:</strong> formula gives <span class="inline-mono">sin²(aΔk/2)/sin²(aΔk/2)=1</span> (correct).</li>
            <li><strong>At maxima</strong> <span class="inline-mono">aΔk→2πh</span>: both numerator and denominator → 0, but the limit is finite and equals <span class="inline-mono">M²</span> (coherent addition of <span class="inline-mono">M</span> equal phasors).</li>
          </ul>

          <details>
            <summary>Limit at the exact maximum (how |F|² becomes M²)</summary>
            <div class="content">
              Near <span class="inline-mono">aΔk = 2πh</span>, set <span class="inline-mono">aΔk = 2πh + ε</span> with small <span class="inline-mono">ε</span>.
              Then
              <span class="inline-mono">sin(M aΔk/2) = sin(M(πh + ε/2)) = sin(Mπh + Mε/2) = (−1)^{Mh} sin(Mε/2)</span>,
              and
              <span class="inline-mono">sin(aΔk/2) = sin(πh + ε/2) = (−1)^h sin(ε/2)</span>.
              For small <span class="inline-mono">ε</span>, <span class="inline-mono">sin(Mε/2) ≈ Mε/2</span> and <span class="inline-mono">sin(ε/2) ≈ ε/2</span>, so the ratio tends to <span class="inline-mono">M</span> and the intensity tends to <span class="inline-mono">M²</span>.
            </div>
          </details>

          <h3>(b) Width of the diffraction maximum (first zeros)</h3>

          <p>
            We are told a diffraction maximum appears at
            <span class="inline-mono">aΔk = 2πh</span>, <span class="inline-mono">h ∈ ℤ</span>.
            To study the peak shape locally, we perturb:
          </p>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Local parameterization around a maximum</div>
              <button class="btn" data-copy="eq-local">Copy equation</button>
            </div>
            <pre id="eq-local">Let aΔk = 2πh + ε, where ε is small (dimensionless).</pre>
          </div>

          <p>
            Substitute into the numerator sine:
          </p>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Compute sin(M aΔk/2) near the maximum</div>
              <button class="btn" data-copy="eq-num">Copy equation</button>
            </div>
            <pre id="eq-num">sin(M aΔk / 2) = sin( M(2πh + ε)/2 )
               = sin( Mπh + Mε/2 )
               = sin(Mπh)cos(Mε/2) + cos(Mπh)sin(Mε/2)
               = 0 + (−1)^{Mh} sin(Mε/2)
               = (±) sin(Mε/2).</pre>
          </div>

          <p>
            <strong>Why each step is valid:</strong> we used the addition formula
            <span class="inline-mono">sin(α+β)=sinα cosβ + cosα sinβ</span>, and the fact that
            <span class="inline-mono">sin(Mπh)=0</span> for integers <span class="inline-mono">M,h</span>.
            The sign <span class="inline-mono">(−1)^{Mh}</span> does not matter for zeros or intensity.
          </p>

          <p>
            The <strong>first zeros</strong> of the intensity around the maximum are determined by the first nonzero solutions of
            <span class="inline-mono">sin(M aΔk/2)=0</span>, i.e. <span class="inline-mono">sin(Mε/2)=0</span>.
          </p>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Solve for the nearest nonzero zeros</div>
              <button class="btn" data-copy="eq-zeros">Copy equation</button>
            </div>
            <pre id="eq-zeros">sin(Mε/2) = 0  ⇒  Mε/2 = nπ,  n ∈ ℤ.
Nearest nonzero zeros: n = ±1  ⇒  ε = ±(2π/M).</pre>
          </div>

          <div class="callout">
            <div class="title"><span class="dot ok"></span>Result for (b): width scaling</div>
            <p class="muted">
              The first zeros occur at <span class="inline-mono">ε = ±2π/M</span>.
              Therefore the distance between the first zeros (a common “diffraction maximum width” definition) is
              <span class="inline-mono">Δε = 4π/M</span>, hence the peak width is <strong>proportional to 1/M</strong>.
            </p>
          </div>

          <h3>Dimensional + physical interpretation of the width</h3>
          <p>
            Because <span class="inline-mono">ε</span> is defined by <span class="inline-mono">aΔk = 2πh + ε</span>, we have
            <span class="inline-mono">Δk-width ≈ Δε / a = (4π/M)/a = 4π/(Ma)</span>.
            The relevant length is the chain length <span class="inline-mono">L ≈ Ma</span>, so the reciprocal-space width scales as <span class="inline-mono">~1/L</span>,
            matching the general Fourier uncertainty intuition.
          </p>

          <div class="callout">
            <div class="title"><span class="dot"></span>Math Insight (callout): Dirichlet kernel & eigenstructure flavor</div>
            <p class="muted">
              Define the discrete “windowed lattice density”
              <span class="inline-mono">ρ(x) = Σ_{m=0}^{M-1} δ(x - m a)</span>.
              Its Fourier transform (in 1D) is
              <span class="inline-mono">ρ̂(q) = ∫ ρ(x) e^{-iqx} dx = Σ_{m=0}^{M-1} e^{-iq m a}</span>,
              which is exactly <span class="inline-mono">F</span> with <span class="inline-mono">q = Δk</span>.
              Thus the diffraction pattern is the squared magnitude of a Fourier transform of a finite measure.
              Up to a phase, this is the Dirichlet kernel, the finite-dimensional analog of an “eigenfunction expansion” peak:
              increasing <span class="inline-mono">M</span> increases “spectral selectivity,” narrowing the main lobe as <span class="inline-mono">1/M</span>.
            </p>
            <details>
              <summary>Where operators appear (brief but meaningful)</summary>
              <div class="content">
                In wave scattering, the field <span class="inline-mono">ψ</span> often satisfies a Helmholtz equation
                <span class="inline-mono">(∇² + k²)ψ = S</span> with a source term <span class="inline-mono">S</span>.
                Point scatterers correspond to localized sources (Dirac deltas). Green’s function methods yield far-field phases
                <span class="inline-mono">e^{ik r}/r</span>; the lattice sum arises from superposing those contributions, using linearity of the operator <span class="inline-mono">∇² + k²</span>.
                While we don’t solve the PDE here, the finite-sum interference pattern is a direct consequence of that linear operator framework.
              </div>
            </details>
          </div>

          <h3>Nondimensionalization / scaling (why 1/M is robust)</h3>
          <p>
            Introduce the dimensionless phase step <span class="inline-mono">θ = aΔk</span>. Then
            <span class="inline-mono">|F|² = sin²(Mθ/2)/sin²(θ/2)</span>.
            The only “size” parameter is <span class="inline-mono">M</span>.
            Near a maximum <span class="inline-mono">θ = 2πh</span>, let <span class="inline-mono">θ = 2πh + ε</span>;
            zeros occur when <span class="inline-mono">Mε/2 = ±π</span>.
            Since the root condition depends on the product <span class="inline-mono">Mε</span>, the characteristic width must scale like <span class="inline-mono">ε ~ 1/M</span>.
          </p>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- Plot -->
        <section id="plot">
          <h2>One static plot (example values) — Peak narrowing with M</h2>
          <p>
            The formula is symbolic; to visualize the width scaling, we plot the normalized intensity
            <span class="inline-mono">I_norm(ε) = (1/M²)|F|²</span> around a principal maximum (take <span class="inline-mono">h=0</span>, so <span class="inline-mono">θ = ε</span>).
            The only “numbers” here are example choices of <span class="inline-mono">M</span>.
          </p>

          <figure>
            <canvas id="c" width="1200" height="700" aria-label="Diffraction peak width vs M"></canvas>
            <figcaption>
              <strong>Static example plot:</strong> normalized intensity <span class="inline-mono">I_norm(ε)</span> versus <span class="inline-mono">ε = aΔk</span>
              for <span class="inline-mono">M = 10, 30, 100</span> (example values). The first zeros occur at <span class="inline-mono">ε = ±2π/M</span>,
              so the main lobe visibly narrows as <span class="inline-mono">M</span> increases.
            </figcaption>
          </figure>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 4 -->
        <section id="p4">
          <h2>PART 4 — Deeper Understanding (THEORY AROUND THE RESULT)</h2>

          <h3>Re-interpret the final formula</h3>
          <p>
            The intensity
            <span class="inline-mono">|F|² = sin²(Mθ/2)/sin²(θ/2)</span> with <span class="inline-mono">θ=aΔk</span> has:
          </p>
          <ul>
            <li><strong>Numerator</strong> <span class="inline-mono">sin²(Mθ/2)</span>: creates many zeros and the fine structure; its first nontrivial zero near a maximum sets the main-lobe width.</li>
            <li><strong>Denominator</strong> <span class="inline-mono">sin²(θ/2)</span>: encodes the single-step interference; near maxima it also tends to zero, but the ratio remains finite and produces the coherent peak.</li>
            <li><strong>Peak height</strong> at maxima: scales like <span class="inline-mono">M²</span> (coherent power scaling).</li>
            <li><strong>Peak width</strong> between first zeros: scales like <span class="inline-mono">1/M</span>.</li>
          </ul>

          <h3>Parameter dependence (qualitative + quantitative)</h3>
          <ul>
            <li>Increase <span class="inline-mono">M</span> → peaks become <strong>taller</strong> (<span class="inline-mono">~M²</span>) and <strong>narrower</strong> (<span class="inline-mono">~1/M</span>).</li>
            <li>Increase spacing <span class="inline-mono">a</span> (for fixed physical <span class="inline-mono">Δk</span>) → phase step grows faster; peaks in <span class="inline-mono">Δk</span>-space become closer (since maxima at <span class="inline-mono">Δk = 2πh/a</span>).</li>
            <li>In physical angle/wavelength coordinates, the mapping <span class="inline-mono">Δk(θ_scatter)</span> determines how <span class="inline-mono">Δk</span>-width translates to an angular/spectral width (instrument-specific Jacobian).</li>
          </ul>

          <h3>Alternative derivation idea (brief but meaningful)</h3>
          <p>
            Treat the finite lattice as the product of an infinite lattice (a Dirac comb in real space) and a finite rectangular window.
            In Fourier space, this becomes a convolution: sharp reciprocal-lattice spikes convolved with the transform of the window (a sinc-like function),
            producing spikes with finite width. The window length is <span class="inline-mono">~Ma</span>, so the sinc main lobe scales as <span class="inline-mono">~1/(Ma)</span>,
            matching the exact <span class="inline-mono">1/M</span> result.
          </p>

          <div class="callout">
            <div class="title"><span class="dot"></span>Limiting-case asymptotics (small ε around a maximum)</div>
            <p class="muted">
              With <span class="inline-mono">θ = 2πh + ε</span> and small <span class="inline-mono">ε</span>:
              <span class="inline-mono">|F|² ≈ [sin²(Mε/2)]/[sin²(ε/2)]</span>.
              Using <span class="inline-mono">sin(ε/2) ≈ ε/2</span>, we get
              <span class="inline-mono">|F|² ≈ (2/ε)² sin²(Mε/2)</span>.
              The envelope’s first zero is at <span class="inline-mono">Mε/2 = π</span> ⇒ <span class="inline-mono">ε = 2π/M</span>, confirming the scaling without any “magic jump.”
            </p>
          </div>

          <h3>Concept check (self-test, with answers)</h3>
          <ul>
            <li><strong>Q:</strong> Why does intensity scale as <span class="inline-mono">M²</span> at a maximum? <strong>A:</strong> amplitudes add linearly (~<span class="inline-mono">M</span>), intensity is amplitude squared (~<span class="inline-mono">M²</span>).</li>
            <li><strong>Q:</strong> What sets the main-lobe width? <strong>A:</strong> the nearest zeros of the numerator <span class="inline-mono">sin(Mθ/2)</span>, giving <span class="inline-mono">θ ≈ ±2π/M</span> about a maximum.</li>
            <li><strong>Q:</strong> If the lattice spacing doubles, where do maxima in <span class="inline-mono">Δk</span> occur? <strong>A:</strong> at <span class="inline-mono">Δk = 2πh/a</span>, so they get closer by a factor of 2.</li>
            <li><strong>Q:</strong> Does the <span class="inline-mono">e^{-i(M-1)θ/2}</span> phase matter for intensity? <strong>A:</strong> no; its magnitude is 1.</li>
          </ul>

          <div class="eq">
            <div class="eqhead">
              <div class="label">Final Answer (plain text)</div>
              <button class="btn" data-copy="final-answer">Copy final answer</button>
            </div>
            <pre id="final-answer">Given F(Δk) = Σ_{m=0}^{M-1} exp(-i m aΔk) = (1 - exp(-i M aΔk)) / (1 - exp(-i aΔk)),
rewrite 1 - exp(-iθ) = 2i exp(-iθ/2) sin(θ/2) to get
F(Δk) = exp(-i (M-1) aΔk/2) * [ sin(M aΔk/2) / sin(aΔk/2) ].

Therefore the intensity is
|F(Δk)|^2 = sin^2(M aΔk/2) / sin^2(aΔk/2).

A principal maximum occurs at aΔk = 2πh. Write aΔk = 2πh + ε.
Then sin(M aΔk/2) = ± sin(Mε/2), so the first nonzero zeros satisfy Mε/2 = ±π,
hence ε = ±(2π/M). Thus the width between first zeros is Δε = 4π/M, i.e. it scales as 1/M.</pre>
          </div>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <!-- PART 5 -->
        <section id="p5">
          <h2>PART 5 — Optional Plot Guide (ONLY IF A PLOT EXISTS)</h2>

          <h3>What the plot shows (and why it’s useful)</h3>
          <ul>
            <li><strong>Quantity plotted:</strong> <span class="inline-mono">I_norm(ε) = (1/M²) sin²(Mε/2)/sin²(ε/2)</span> around the principal maximum.</li>
            <li><strong>Why normalize:</strong> peak heights differ by <span class="inline-mono">M²</span>; normalization isolates <strong>width</strong> changes.</li>
            <li><strong>Feature to notice:</strong> the first zeros occur at <span class="inline-mono">ε = ±2π/M</span>, so larger <span class="inline-mono">M</span> gives a narrower main lobe.</li>
          </ul>

          <h3>Axes and units</h3>
          <ul>
            <li><strong>x-axis:</strong> <span class="inline-mono">ε = aΔk</span> (dimensionless).</li>
            <li><strong>y-axis:</strong> <span class="inline-mono">I_norm</span> (dimensionless, relative intensity).</li>
          </ul>

          <h3>Example values (only for visualization)</h3>
          <ul>
            <li><span class="inline-mono">M = 10, 30, 100</span> are chosen to show the trend clearly; the solution itself is symbolic and general.</li>
          </ul>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>
      </article>
    </main>

    <footer>
      Built as a single self-contained HTML article (vanilla HTML/CSS/JS). Print-friendly. Copy buttons included.
    </footer>
  </div>

  <script>
    (function(){
      function copyTextFromEl(id){
        const el = document.getElementById(id);
        if(!el) return;
        const text = el.textContent.replace(/\u00A0/g,' ');
        navigator.clipboard.writeText(text).then(()=>flash(id), ()=>fallbackCopy(text));
      }
      function fallbackCopy(text){
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position='fixed';
        ta.style.left='-9999px';
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); }catch(e){}
        document.body.removeChild(ta);
      }
      function flash(id){
        const el = document.getElementById(id);
        if(!el) return;
        const parent = el.closest('.eq') || el;
        const old = parent.style.outline;
        parent.style.outline = '2px solid rgba(125,211,252,.55)';
        parent.style.outlineOffset = '2px';
        setTimeout(()=>{ parent.style.outline = old; parent.style.outlineOffset='0px'; }, 650);
      }
      document.querySelectorAll('[data-copy]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-copy');
          copyTextFromEl(id);
        });
      });

      // ----- Static plot -----
      const canvas = document.getElementById('c');
      if(!canvas) return;

      const ctx = canvas.getContext('2d');

      function I_norm(eps, M){
        // normalized intensity: (1/M^2) * sin^2(M eps/2)/sin^2(eps/2)
        const half = eps/2;
        const num = Math.sin(M*half);
        const den = Math.sin(half);

        // Handle near-zero denominator via limit: ratio -> M
        if(Math.abs(den) < 1e-8){
          return 1; // normalized peak height
        }
        const ratio = (num/den);
        return (ratio*ratio)/(M*M);
      }

      function draw(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const cssW = canvas.clientWidth;
        const cssH = Math.round(cssW * 0.58);
        canvas.style.height = cssH + 'px';
        canvas.width = Math.floor(cssW * dpr);
        canvas.height = Math.floor(cssH * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);

        const W = cssW, H = cssH;
        ctx.clearRect(0,0,W,H);

        // Layout
        const padL = 62, padR = 18, padT = 44, padB = 52;
        const plotW = W - padL - padR;
        const plotH = H - padT - padB;

        // Axes ranges (dimensionless eps)
        const xmin = -0.9, xmax = 0.9;
        const ymin = 0, ymax = 1.05;

        function x2px(x){ return padL + (x - xmin) / (xmax - xmin) * plotW; }
        function y2px(y){ return padT + (1 - (y - ymin)/(ymax - ymin)) * plotH; }

        // Background panel
        ctx.save();
        ctx.globalAlpha = 0.9;
        ctx.fillStyle = 'rgba(255,255,255,0.03)';
        ctx.strokeStyle = 'rgba(255,255,255,0.10)';
        roundRect(ctx, padL-10, padT-10, plotW+20, plotH+20, 14, true, true);
        ctx.restore();

        // Title
        ctx.save();
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#e8ecf6';
        ctx.font = '700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.fillText('Normalized diffraction peak around a principal maximum', padL, 20);
        ctx.font = '400 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || '#b8c0d6';
        ctx.fillText('I_norm(ε) = (1/M²)·sin²(Mε/2)/sin²(ε/2)   (example M = 10, 30, 100)', padL, 36);
        ctx.restore();

        // Gridlines + ticks
        ctx.save();
        ctx.strokeStyle = 'rgba(255,255,255,0.10)';
        ctx.lineWidth = 1;
        // vertical grid ticks
        const xticks = [-0.8,-0.4,0,0.4,0.8];
        xticks.forEach(x=>{
          const px = x2px(x);
          ctx.beginPath();
          ctx.moveTo(px, padT);
          ctx.lineTo(px, padT+plotH);
          ctx.stroke();
        });
        // horizontal grid ticks
        const yticks = [0,0.25,0.5,0.75,1.0];
        yticks.forEach(y=>{
          const py = y2px(y);
          ctx.beginPath();
          ctx.moveTo(padL, py);
          ctx.lineTo(padL+plotW, py);
          ctx.stroke();
        });
        ctx.restore();

        // Axes
        ctx.save();
        ctx.strokeStyle = 'rgba(255,255,255,0.22)';
        ctx.lineWidth = 1.5;
        // x-axis
        ctx.beginPath();
        ctx.moveTo(padL, padT+plotH);
        ctx.lineTo(padL+plotW, padT+plotH);
        ctx.stroke();
        // y-axis
        ctx.beginPath();
        ctx.moveTo(padL, padT);
        ctx.lineTo(padL, padT+plotH);
        ctx.stroke();
        ctx.restore();

        // Tick labels
        ctx.save();
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || '#b8c0d6';
        ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
        xticks.forEach(x=>{
          const px = x2px(x);
          const txt = x.toFixed(1).replace('-0.0','0.0');
          ctx.fillText(txt, px-10, padT+plotH+22);
          // tick mark
          ctx.strokeStyle = 'rgba(255,255,255,0.22)';
          ctx.beginPath();
          ctx.moveTo(px, padT+plotH);
          ctx.lineTo(px, padT+plotH+6);
          ctx.stroke();
        });
        yticks.forEach(y=>{
          const py = y2px(y);
          const txt = y.toFixed(2).replace(/0+$/,'').replace(/\.$/,'');
          ctx.fillText(txt, 10, py+4);
          ctx.strokeStyle = 'rgba(255,255,255,0.22)';
          ctx.beginPath();
          ctx.moveTo(padL-6, py);
          ctx.lineTo(padL, py);
          ctx.stroke();
        });
        // axis labels
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#e8ecf6';
        ctx.font = '700 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.fillText('ε = aΔk (dimensionless)', padL + Math.max(0, plotW/2 - 70), H - 14);
        ctx.save();
        ctx.translate(16, padT + plotH/2 + 55);
        ctx.rotate(-Math.PI/2);
        ctx.fillText('I_norm (dimensionless)', 0, 0);
        ctx.restore();
        ctx.restore();

        // Curves (no explicit colors specified; use currentColor-like via computed accent variables)
        const styles = [
          {M:10,  stroke: cssVar('--accent')},
          {M:30,  stroke: cssVar('--accent2')},
          {M:100, stroke: cssVar('--ok')}
        ];

        styles.forEach(s=>{
          ctx.save();
          ctx.strokeStyle = s.stroke;
          ctx.lineWidth = 2;
          ctx.beginPath();
          const N = 1400;
          for(let i=0;i<=N;i++){
            const x = xmin + (xmax-xmin)*i/N;
            const y = I_norm(x, s.M);
            const px = x2px(x);
            const py = y2px(Math.min(y, ymax));
            if(i===0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
          }
          ctx.stroke();
          ctx.restore();
        });

        // Legend
        ctx.save();
        const lx = padL + plotW - 150;
        const ly = padT + 14;
        ctx.fillStyle = 'rgba(255,255,255,0.03)';
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        roundRect(ctx, lx-10, ly-10, 150, 78, 12, true, true);

        ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#e8ecf6';
        ctx.fillText('Legend', lx, ly);

        const items = [
          {label:'M = 10',  stroke: styles[0].stroke},
          {label:'M = 30',  stroke: styles[1].stroke},
          {label:'M = 100', stroke: styles[2].stroke}
        ];
        items.forEach((it, idx)=>{
          const y = ly + 16 + idx*18;
          ctx.strokeStyle = it.stroke;
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(lx, y);
          ctx.lineTo(lx+26, y);
          ctx.stroke();
          ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || '#b8c0d6';
          ctx.fillText(it.label, lx+34, y+4);
        });
        ctx.restore();
      }

      function roundRect(ctx, x, y, w, h, r, fill, stroke){
        const rr = Math.min(r, w/2, h/2);
        ctx.beginPath();
        ctx.moveTo(x+rr, y);
        ctx.arcTo(x+w, y, x+w, y+h, rr);
        ctx.arcTo(x+w, y+h, x, y+h, rr);
        ctx.arcTo(x, y+h, x, y, rr);
        ctx.arcTo(x, y, x+w, y, rr);
        ctx.closePath();
        if(fill) ctx.fill();
        if(stroke) ctx.stroke();
      }

      function cssVar(name){
        const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        if(!v) return '#ffffff';
        // allow rgba(...) or hex; just return as-is
        return v;
      }

      window.addEventListener('resize', draw, {passive:true});
      draw();
    })();
  </script>
</body>
</html>
