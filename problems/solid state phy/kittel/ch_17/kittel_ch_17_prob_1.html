<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Diffraction from 1D and 2D Lattices: Cones, Film Patterns, and Surface LEED Geometry</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#0f1624;
      --ink:#e8eefc;
      --muted:#b8c3dd;
      --faint:#7f8aa6;
      --line:rgba(255,255,255,.12);
      --accent:#7cc7ff;
      --accent2:#a7ffcf;
      --warn:#ffd37c;
      --good:#a7ffcf;
      --bad:#ff8fb1;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 10% 0%, rgba(124,199,255,.12), transparent 60%),
        radial-gradient(900px 700px at 90% 15%, rgba(167,255,207,.10), transparent 55%),
        linear-gradient(180deg, #070a10 0%, var(--bg) 100%);
      line-height:1.55;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:28px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    .title{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      padding:22px 22px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .title:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(700px 260px at 15% 20%, rgba(124,199,255,.18), transparent 60%),
        radial-gradient(520px 280px at 85% 30%, rgba(167,255,207,.14), transparent 60%);
      pointer-events:none;
      filter:blur(0px);
      opacity:.9;
    }
    .title > *{position:relative}
    h1{
      margin:0;
      font-size: clamp(1.4rem, 2.2vw, 2.1rem);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      max-width: 75ch;
      font-size: 1.02rem;
    }

    main{
      max-width:1200px;
      margin: 0 auto;
      padding: 16px 18px 80px;
      display:grid;
      grid-template-columns: 330px 1fr;
      gap:16px;
      align-items:start;
    }

    nav.toc{
      position:sticky;
      top:12px;
      align-self:start;
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px 14px 12px;
      overflow:hidden;
    }
    nav.toc .toc-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    nav.toc h2{
      margin:0;
      font-size:1rem;
      letter-spacing:.2px;
    }
    .toc small{color:var(--faint)}
    .toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      border:1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      font-size:.95rem;
    }
    .toc a:hover{
      background:rgba(124,199,255,.08);
      border-color:rgba(124,199,255,.22);
      transform: translateX(2px);
      text-decoration:none;
      color:var(--ink);
    }
    .toc .group{
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid var(--line);
    }

    article{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 18px 6px;
      overflow:hidden;
    }

    section{
      padding: 4px 0 18px;
      border-top:1px solid rgba(255,255,255,.08);
      margin-top:14px;
    }
    section:first-of-type{border-top:none; margin-top:0}
    h2{
      margin: 6px 0 10px;
      font-size: 1.25rem;
    }
    h3{
      margin: 16px 0 8px;
      font-size: 1.05rem;
      color: var(--ink);
    }
    p{margin:10px 0; color:var(--muted)}
    ul{margin:8px 0 10px 20px; color:var(--muted)}
    li{margin:6px 0}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      main{grid-template-columns: 1fr}
      nav.toc{position:relative; top:auto}
      .grid2,.grid3{grid-template-columns:1fr}
    }

    .card{
      background: rgba(0,0,0,.18);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      padding: 12px 12px;
    }
    .callout{
      border-left: 4px solid rgba(124,199,255,.65);
      background: rgba(124,199,255,.06);
    }
    .callout.warn{
      border-left-color: rgba(255,211,124,.75);
      background: rgba(255,211,124,.06);
    }
    .callout.good{
      border-left-color: rgba(167,255,207,.72);
      background: rgba(167,255,207,.06);
    }
    .callout.bad{
      border-left-color: rgba(255,143,177,.72);
      background: rgba(255,143,177,.06);
    }
    .label{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:600;
      letter-spacing:.2px;
      color:var(--ink);
      margin-bottom:6px;
    }
    .label .dot{
      width:9px; height:9px; border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 0 3px rgba(124,199,255,.15);
    }
    .label.warn .dot{background:var(--warn); box-shadow:0 0 0 3px rgba(255,211,124,.15)}
    .label.good .dot{background:var(--good); box-shadow:0 0 0 3px rgba(167,255,207,.15)}
    .label.bad .dot{background:var(--bad); box-shadow:0 0 0 3px rgba(255,143,177,.15)}

    .eq{
      position:relative;
      margin:10px 0;
      padding:12px 44px 12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      overflow:auto;
      font-family:var(--mono);
      color:#eaf2ff;
      font-size: .93rem;
      line-height:1.35;
    }
    .copybtn{
      position:absolute;
      top:10px;
      right:10px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      padding:6px 9px;
      border-radius: 12px;
      cursor:pointer;
      font-size:.82rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .copybtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.28)}
    .copybtn:active{transform: translateY(0px) scale(.99)}
    .pill{
      display:inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size:.85rem;
      margin-left:8px;
    }

    details{
      border:1px solid var(--line);
      border-radius:var(--radius2);
      background: rgba(0,0,0,.18);
      padding:10px 12px;
      margin:10px 0;
    }
    summary{
      cursor:pointer;
      color:var(--ink);
      font-weight:600;
    }
    details p, details ul{color:var(--muted)}
    .backtop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin:14px 0 6px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      transition: transform .12s ease, background .12s ease;
    }
    .backtop:hover{transform: translateY(-1px); background: rgba(124,199,255,.08); color:var(--ink); text-decoration:none}

    footer{
      margin-top:16px;
      padding: 14px 0 6px;
      border-top:1px solid rgba(255,255,255,.10);
      color: var(--faint);
      font-size:.92rem;
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      header, main{max-width:100%; padding:0}
      nav.toc{display:none}
      article{box-shadow:none; border:1px solid #ccc; background:#fff}
      .card, .eq, details{background:#fff}
      .copybtn{display:none}
      a{color:#000; text-decoration:underline}
      section{page-break-inside:avoid}
      h2{page-break-after:avoid}
    }
  </style>
</head>

<body>
<header id="top">
  <div class="title">
    <h1>Diffraction from a Linear Array and a Square Array: Geometry of Cones, Film/Plate Patterns, and (110) Surface Spots</h1>
    <p class="subtitle">
      A physics-tutor + applied-engineering walkthrough of why a 1D lattice produces <span class="pill">cones</span>,
      how those cones cut a <span class="pill">cylindrical film</span> vs a <span class="pill">flat plate</span>,
      why a 2D square lattice gives a <span class="pill">spot grid</span>, and how to read surface-diffraction patterns as a
      <span class="pill">reciprocal-lattice map</span>.
    </p>
  </div>
</header>

<main>
  <nav class="toc" aria-label="Table of Contents">
    <div class="toc-head">
      <h2>Contents</h2>
      <small>sticky</small>
    </div>
    <a href="#qs">Quick Summary</a>
    <a href="#p0">PART 0 — Concept Primer</a>
    <a href="#p0b">PART 0B — Industry & Applied Physics</a>
    <div class="group">
      <a href="#p1">PART 1 — Problem Analysis</a>
      <a href="#p2">PART 2 — Strategy & Tips</a>
      <a href="#p3">PART 3 — Full Solution</a>
      <a href="#p4">PART 4 — Deeper Understanding</a>
      <a href="#p5">PART 5 — Optional Plot Guide</a>
    </div>
  </nav>

  <article>
    <section id="qs">
      <h2>Quick Summary</h2>
      <ul>
        <li><b>What this is about:</b> diffraction from (i) a 1D lattice (a line of atoms, spacing <i>a</i>) and (ii) a 2D square lattice (spacing <i>a</i>), including the <b>recorded pattern geometry</b> on different detectors.</li>
        <li><b>Key physics idea:</b> coherent scattering sums a <b>phase factor</b> over lattice points; maxima occur when the <b>scattering vector</b> matches a <b>reciprocal-lattice vector</b>.</li>
        <li><b>Governing condition (Laue/reciprocal form):</b> for a 1D lattice along unit vector <b>u</b>, <span style="white-space:nowrap;">(k<sub>f</sub> − k<sub>i</sub>)·(a u) = 2πn</span>.</li>
        <li><b>Equivalent 1D “path-difference” form:</b> with incident beam perpendicular to the line, <b>a cos θ = nλ</b>, where θ is the angle between diffracted ray and the line (axis).</li>
        <li><b>Geometric result for the 1D lattice:</b> each integer <i>n</i> produces diffracted rays on a <b>cone</b> around the line (fiber) axis.</li>
        <li><b>Detector-dependent pattern:</b> a <b>cylindrical film</b> coaxial with the line records <b>rings</b> (unrolled: horizontal “layer lines”); a <b>flat plate</b> normal to the incident beam records <b>hyperbolae</b>.</li>
        <li><b>2D square lattice result:</b> normal incidence gives a <b>square array of spots</b> (scaled by λ and camera length) because reciprocal space is also square.</li>
        <li><b>Surface electron diffraction (Ni(110)) reading:</b> spot pattern orientation reflects the <b>rectangular surface net</b>; reciprocal-lattice directions are perpendicular to real-space periodicities, so spot spacing is <b>inverse</b> to atomic-row spacing.</li>
        <li><b>Result type:</b> primarily <b>symbolic + geometric</b> (sketch-level), with sanity checks via dimensions and limiting cases.</li>
      </ul>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p0">
      <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

      <div class="grid2">
        <div class="card">
          <div class="label"><span class="dot"></span>Core definitions (symbols + units)</div>
          <ul>
            <li><b>λ</b> (m): wavelength of x-rays/electrons (for electrons, λ is the de Broglie wavelength).</li>
            <li><b>k</b> (m⁻¹): wavevector magnitude, <b>|k| = 2π/λ</b>.</li>
            <li><b>k<sub>i</sub>, k<sub>f</sub></b> (m⁻¹): incident and scattered wavevectors.</li>
            <li><b>Δk</b> (m⁻¹): scattering vector, <b>Δk = k<sub>f</sub> − k<sub>i</sub></b>.</li>
            <li><b>a</b> (m): lattice constant (spacing between equivalent scattering centers along a direction).</li>
            <li><b>G</b> (m⁻¹): reciprocal-lattice vector (discrete values that encode periodicity).</li>
            <li><b>L</b> (m): detector distance (“camera length”) from specimen to plate.</li>
            <li><b>θ</b> (rad): here we use θ as <b>angle between diffracted ray and the lattice line axis</b> (as in the provided figure).</li>
          </ul>
        </div>

        <div class="card">
          <div class="label"><span class="dot"></span>Physical meaning (intuition)</div>
          <ul>
            <li>A periodic structure acts like a <b>spatial frequency filter</b>: only certain Δk values add in phase.</li>
            <li>A 1D lattice has periodicity only along one axis → allowed Δk are discrete only along that axis → diffracted directions form <b>cones</b>.</li>
            <li>A 2D lattice is periodic in a plane → allowed Δk live on a 2D grid → diffracted directions map to a <b>spot lattice</b> on the detector.</li>
            <li>The detector records <b>where the cone (or reciprocal map) intersects its surface</b> (cylinder vs plane gives different curves).</li>
          </ul>
        </div>
      </div>

      <h3>Key laws/principles and validity conditions</h3>
      <div class="card callout">
        <div class="label"><span class="dot"></span>Wave-scattering + lattice sum (coherent interference)</div>
        <p>
          In the far field (Fraunhofer regime), the scattered complex amplitude from point scatterers at positions r<sub>j</sub> is proportional to:
        </p>
        <div class="eq" data-copy="eq">
A(Δk) ∝ Σ_j f_j(Δk) · exp(i Δk · r_j)
Intensity: I(Δk) ∝ |A(Δk)|²
        <button class="copybtn" type="button" data-copy-btn>Copy</button>
        </div>
        <p>
          For a perfect lattice and identical scatterers (f<sub>j</sub>=f), the sum becomes sharply peaked when <b>Δk equals a reciprocal-lattice vector</b>.
          This is the <b>Laue condition</b>.
        </p>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="label"><span class="dot"></span>Laue condition (operator / vector form)</div>
          <div class="eq" data-copy="eq">
Δk = k_f − k_i
Constructive interference (ideal infinite crystal):
Δk = G  (a reciprocal-lattice vector)
          <button class="copybtn" type="button" data-copy-btn>Copy</button>
          </div>
          <p>
            Mathematically, this is a <b>Fourier-series selection rule</b>: the Fourier transform of a periodic comb is another comb at reciprocal frequencies.
          </p>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>Common approximations used here</div>
          <ul>
            <li><b>Kinematic (single-scattering) approximation:</b> neglect multiple scattering; good for x-ray diffraction in thin/weakly scattering samples and for qualitative geometry.</li>
            <li><b>Far-field (Fraunhofer) approximation:</b> detector is far enough that rays can be treated as directions; phase varies linearly with position.</li>
            <li><b>Small-angle mapping (optional):</b> detector coordinates proportional to transverse k-components when scattering angles are small.</li>
          </ul>
        </div>
      </div>

      <h3>Mini intuition examples (minimal algebra)</h3>
      <ul>
        <li><b>Two scatterers</b> separated by a: maxima occur when path difference is nλ.</li>
        <li><b>Many scatterers in a line</b>: the same condition becomes much sharper → thin cones of strong intensity.</li>
        <li><b>Periodic plane (2D)</b>: maxima become a 2D grid in reciprocal space → spot lattice on the detector.</li>
      </ul>

      <div class="card callout warn">
        <div class="label warn"><span class="dot"></span>What to watch for (pitfalls)</div>
        <ul>
          <li><b>Angle conventions:</b> θ might be defined relative to the lattice axis or the incident beam; keep the geometry consistent.</li>
          <li><b>Detector geometry matters:</b> the “same” diffraction directions can appear as rings, arcs, or hyperbolae depending on detector shape and placement.</li>
          <li><b>Finite size / disorder:</b> real samples broaden spots into streaks/arcs; perfect delta-function peaks are an idealization.</li>
          <li><b>Reciprocal vs real-space rotation:</b> spot spacing is inversely proportional to real-space spacing, and directions are perpendicular in the Fourier sense.</li>
        </ul>
      </div>

      <div class="card callout good">
        <div class="label good"><span class="dot"></span>Math Insight</div>
        <p>
          The core equation <b>A(Δk) ∝ Σ exp(iΔk·r)</b> is a <b>discrete Fourier transform</b> of the lattice.
          Periodicity makes this a distribution supported on the <b>reciprocal lattice</b> (a “Dirac comb”).
          Geometrically, diffraction is the intersection of that reciprocal support with the <b>Ewald sphere</b> (|k<sub>f</sub>|=|k<sub>i</sub>|).
        </p>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p0b">
      <h2>PART 0B — Industry & Applied Physics Perspective</h2>

      <div class="grid3">
        <div class="card">
          <div class="label"><span class="dot"></span>Where this appears (3+ areas)</div>
          <ul>
            <li><b>Materials manufacturing:</b> texture and grain orientation in rolled metals (XRD “fiber texture”).</li>
            <li><b>Semiconductor processing:</b> surface reconstructions and thin-film epitaxy (LEED/RHEED).</li>
            <li><b>Polymers & biomaterials:</b> oriented fibers (DNA/protein helices; industrial polymer fibers) showing layer-line patterns.</li>
            <li><b>Additive manufacturing QA:</b> phase identification + residual strain via diffraction peak shifts/broadening.</li>
          </ul>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>Why engineers care</div>
          <ul>
            <li><b>Performance:</b> crystallographic orientation controls strength, conductivity, corrosion, magnetic behavior.</li>
            <li><b>Reliability:</b> defects/disorder broaden features → diagnostics of damage, fatigue, or poor processing.</li>
            <li><b>Cost & throughput:</b> diffraction is a fast non-destructive probe for process control.</li>
            <li><b>Manufacturability:</b> tolerances in spacing/ordering map to tolerances in reciprocal features.</li>
          </ul>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>How it’s measured in practice</div>
          <ul>
            <li><b>X-ray diffraction (XRD):</b> Debye–Scherrer rings, texture goniometry, grazing-incidence XRD for thin films.</li>
            <li><b>Electron diffraction:</b> LEED for surfaces; RHEED for in-situ monitoring during growth.</li>
            <li><b>Calibration:</b> camera length L and wavelength λ must be known; often calibrated using standards (e.g., polycrystalline powders).</li>
          </ul>
        </div>
      </div>

      <div class="card callout">
        <div class="label"><span class="dot"></span>Design trade-offs & constraints (real vs ideal)</div>
        <ul>
          <li><b>Finite coherence</b> and <b>finite sample size</b> broaden peaks → weaker, thicker “cones” and smeared spots.</li>
          <li><b>Multiple scattering</b> for low-energy electrons can distort simple kinematic predictions; still, symmetry and orientation remain highly informative.</li>
          <li><b>Surface sensitivity</b> means contamination/oxidation can completely change a LEED pattern—cleanliness becomes a process variable.</li>
          <li><b>Alignment tolerances</b> (sample tilt, detector centering) shift patterns; industrial fixtures often include fiducials and automatic alignment.</li>
        </ul>
      </div>

      <details>
        <summary>From lab to product: adapting the idealized model</summary>
        <p>
          In production, you rarely have a perfect infinite lattice. The “delta-function” reciprocal peaks become broadened by:
          finite domain size (Fourier-limited broadening), microstrain (phase gradients), mosaic spread (orientation distribution),
          and instrumental resolution. Engineers incorporate these into fit models (e.g., Williamson–Hall type reasoning in XRD,
          or spot-profile analysis in electron diffraction) while preserving the same geometric backbone: <b>reciprocal-lattice symmetry</b>.
        </p>
      </details>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p1">
      <h2>PART 1 — Problem Analysis (No solving yet)</h2>

      <h3>Restating the problem (in plain words)</h3>
      <p>
        You are given the known result for diffraction from a <b>single 1D line of atoms</b> with spacing <b>a</b>
        under a monochromatic beam perpendicular to the line: constructive interference occurs when <b>a cos θ = nλ</b>.
        For a fixed integer <i>n</i>, the diffracted rays form a <b>cone</b> around the line axis.
        You must:
      </p>
      <ul>
        <li><b>(a)</b> Describe what the diffraction looks like on a <b>cylindrical film</b> coaxial with the line (fiber).</li>
        <li><b>(b)</b> Describe what it looks like on a <b>flat photographic plate</b> behind the fiber and normal to the incident beam.</li>
        <li><b>(c)</b> For a <b>single plane</b> of atoms forming a <b>square lattice</b> (spacing a), with the plane normal to the beam, sketch/describe the pattern.</li>
        <li><b>(d)</b> For the electron backscattering pattern from <b>Ni(110)</b>, explain the <b>orientation</b> of the diffraction pattern relative to the surface atomic positions (assuming only surface atoms contribute).</li>
      </ul>

      <div class="grid2">
        <div class="card">
          <div class="label"><span class="dot"></span>Given quantities</div>
          <ul>
            <li>1D lattice spacing: <b>a</b></li>
            <li>Wavelength: <b>λ</b> (monochromatic)</li>
            <li>Constructive condition: <b>a cos θ = nλ</b> (integer n)</li>
            <li>Geometry: incident beam ⟂ to the line (fiber axis)</li>
            <li>Detectors: cylindrical film coaxial with line; flat plate normal to beam</li>
            <li>2D lattice: square lattice of constant <b>a</b>, plane ⟂ beam</li>
            <li>Surface: Ni(110) atomic net (rectangular symmetry)</li>
          </ul>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>Unknowns / what to find</div>
          <ul>
            <li>Shapes of recorded intensity loci (rings vs hyperbolae) for the 1D cone diffraction.</li>
            <li>Qualitative spot geometry for 2D square lattice diffraction.</li>
            <li>Orientation reasoning linking a real-space surface lattice to its reciprocal-space diffraction pattern.</li>
          </ul>
        </div>
      </div>

      <h3>Relevant principles and why they apply</h3>
      <ul>
        <li><b>Linearity/superposition:</b> the wave amplitude is a linear sum over scatterers → interference.</li>
        <li><b>Translational symmetry:</b> periodicity enforces discrete phase-matching (Laue/reciprocal lattice).</li>
        <li><b>Geometric optics of rays:</b> once directions are known (cones), the detector pattern is found by <b>intersecting those rays with the detector surface</b>.</li>
      </ul>

      <div class="card callout">
        <div class="label"><span class="dot"></span>Assumptions (explicit)</div>
        <ul>
          <li><b>Kinematic diffraction:</b> single scattering dominates (qualitative geometry preserved even if not perfect).</li>
          <li><b>Far-field:</b> detector is far enough that diffracted rays can be treated as straight lines from the sample.</li>
          <li><b>Ideal periodicity:</b> spacing a is uniform; the fiber is well-aligned with the detector axis in (a).</li>
          <li><b>For (d):</b> only the top surface layer contributes (surface sensitivity of low-energy electrons).</li>
        </ul>
      </div>

      <h3>2–3 approaches (compare and choose)</h3>
      <div class="grid3">
        <div class="card">
          <div class="label"><span class="dot"></span>Approach A: Path-difference geometry</div>
          <p>
            Use the given <b>a cos θ = nλ</b> and interpret θ as a constant cone half-angle.
            Then compute detector intersection curves.
          </p>
          <p><b>Pros:</b> intuitive, minimal formalism. <b>Cons:</b> must be careful about coordinate definitions.</p>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>Approach B: Reciprocal-lattice + Laue</div>
          <p>
            Use <b>Δk = G</b>, with 1D/2D reciprocal lattices, then intersect with Ewald sphere and map to detector.
          </p>
          <p><b>Pros:</b> systematic, generalizes to (c) and (d). <b>Cons:</b> heavier abstraction.</p>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>Approach C: Fourier transform viewpoint</div>
          <p>
            Treat the lattice as a sum of delta functions and analyze its Fourier spectrum.
          </p>
          <p><b>Pros:</b> clarifies spot orientation and inversions. <b>Cons:</b> less direct for detector geometry curves.</p>
        </div>
      </div>

      <p>
        <b>Chosen approach:</b> combine <b>A</b> (for detector intersection shapes) with <b>B/C</b> (for 2D lattice and surface orientation).
        This gives the cleanest path with the most physical insight.
      </p>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p2">
      <h2>PART 2 — Strategy & Tips (Roadmap only)</h2>

      <ol style="color:var(--muted); margin-left:20px;">
        <li><b>Fix coordinates:</b> choose axes: z along the line (fiber), x along incident beam, y transverse. (Goal: avoid angle confusion.)</li>
        <li><b>State the wave model:</b> monochromatic plane wave, k=2π/λ; scattered wavevector has same magnitude. (Tool: |k<sub>f</sub>|=|k<sub>i</sub>|.)</li>
        <li><b>Write the 1D Laue condition:</b> (k<sub>f</sub>−k<sub>i</sub>)·(a ẑ)=2πn ⇒ a k cosθ =2πn ⇒ a cosθ=nλ. (Meaning: discrete kz values.)</li>
        <li><b>Interpret constant θ:</b> for each n, diffracted directions have fixed angle to ẑ ⇒ a cone about the z-axis. (Meaning: rotational symmetry around the line.)</li>
        <li><b>(a) Intersect cone with cylinder:</b> r=R cylinder, r=|z| tanθ cone ⇒ z=±R cotθ ⇒ rings on film; unroll gives horizontal lines. (Meaning: “layer lines”.)</li>
        <li><b>(b) Intersect cone with plane:</b> plane x=L, ray parametrization gives a hyperbola in (y,z). (Meaning: hyperbolic arcs symmetric about the center.)</li>
        <li><b>(c) Use 2D reciprocal lattice:</b> square lattice → reciprocal square grid; normal incidence gives a square array of spots on the plate (scaled by λ and L). (Meaning: direct readout of in-plane periodicities.)</li>
        <li><b>(d) Surface net → reciprocal net:</b> Ni(110) has a rectangular surface lattice; diffraction pattern mirrors its reciprocal rectangular symmetry, with spot spacings inversely proportional to real-space spacings and axes tied to surface atomic rows.</li>
      </ol>

      <div class="card callout bad">
        <div class="label bad"><span class="dot"></span>Common mistakes (quick tips)</div>
        <ul>
          <li><b>Mixing θ definitions:</b> here θ is to the <b>line axis</b>, not the beam.</li>
          <li><b>Forgetting the detector mapping:</b> “cones” are in angle space; the film/plate shows their <b>intersection curves</b>.</li>
          <li><b>Thinking spots align with rows:</b> in reciprocal space, peaks correspond to periodicities; directions relate via Fourier geometry (reciprocal vectors are normal to real-space lattice planes/rows).</li>
        </ul>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p3">
      <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

      <h3>Qualitative expectation before calculating</h3>
      <p>
        A 1D periodic structure only “selects” wavevector mismatch along one direction (the line axis). So we expect diffraction to be
        <b>rotationally symmetric around that axis</b>, producing cones. Any detector will show <b>the intersection of cones with its surface</b>:
        rings on a coaxial cylinder, and conic sections (hyperbolae) on a plane. A 2D square lattice should give a 4-fold symmetric spot grid.
      </p>

      <h3>Mathematical model (variables, domains, coordinates, and conditions)</h3>
      <div class="card callout">
        <div class="label"><span class="dot"></span>Model setup</div>
        <ul>
          <li><b>Space:</b> 3D Euclidean space with coordinates (x,y,z).</li>
          <li><b>Lattice (1D):</b> scatterers at r<sub>m</sub> = m a ẑ, with m ∈ ℤ, spacing a (m).</li>
          <li><b>Incident wave:</b> ψ<sub>i</sub>(r) = exp(i k<sub>i</sub>·r), with k<sub>i</sub>=k x̂ and k=2π/λ.</li>
          <li><b>Elastic scattering:</b> |k<sub>f</sub>|=|k<sub>i</sub>|=k (no energy change), so scattered directions lie on a sphere in k-space (Ewald sphere).</li>
          <li><b>Far field:</b> detector is sufficiently far that each pixel corresponds to a direction k<sub>f</sub>/k.</li>
        </ul>
      </div>

      <h3>Step 1: Derive the 1D Laue condition and recover a cosθ = nλ</h3>
      <p>
        The scattered amplitude from the infinite 1D lattice is (up to an overall factor):
      </p>
      <div class="eq" data-copy="eq">
A(Δk) ∝ Σ_{m=-∞}^{∞} exp(i Δk · r_m)
     = Σ_m exp(i Δk · (m a ẑ))
     = Σ_m exp(i m a Δk_z)
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        This is a classic Fourier-series sum. For an infinite lattice, it becomes a comb of delta peaks when the phase increment per step is a multiple of 2π:
      </p>
      <div class="eq" data-copy="eq">
Constructive condition:
a Δk_z = 2π n ,  n ∈ ℤ
⇒ Δk_z = (2π/a) n
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        Now relate Δk<sub>z</sub> to the scattering direction. Since the incident beam is along x̂, the incident z-component is:
        <b>k<sub>i,z</sub>=0</b>. The scattered wavevector k<sub>f</sub> makes an angle θ with the z-axis (line axis), so:
      </p>
      <div class="eq" data-copy="eq">
k_{f,z} = k cosθ
Δk_z = k_{f,z} − k_{i,z} = k cosθ
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        Substitute into the Laue condition:
      </p>
      <div class="eq" data-copy="eq">
a (k cosθ) = 2π n
a ( (2π/λ) cosθ ) = 2π n
⇒ a cosθ = n λ
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        <b>Why each step is valid:</b> linear superposition gives the sum; translational symmetry makes the phase increment constant; the infinite-sum limit produces discrete peaks; elastic scattering fixes |k|; geometry gives k<sub>f,z</sub>=k cosθ.
      </p>

      <h3>Step 2: Show that fixed n implies a cone of diffracted rays</h3>
      <p>
        For each integer n, the condition <b>a cosθ = nλ</b> fixes <b>cosθ</b>, hence fixes θ (when |nλ/a| ≤ 1).
        Therefore, k<sub>f</sub> directions satisfy:
      </p>
      <div class="eq" data-copy="eq">
Angle between k_f and ẑ is constant: θ = arccos(nλ/a).
Set of directions with fixed θ about ẑ forms a cone (axis ẑ).
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>

      <details>
        <summary>Dimensional analysis sanity check</summary>
        <p>
          In <b>a cosθ = nλ</b>, a and λ have units of length; cosθ and n are dimensionless. Units match.
        </p>
      </details>

      <h3>(a) Cylindrical film coaxial with the line (fiber): what appears on the film?</h3>
      <p>
        Let the cylindrical film have radius <b>R</b> around the z-axis (fiber axis). In cylindrical coordinates (r,φ,z):
      </p>
      <ul>
        <li><b>Cylinder:</b> r = R.</li>
        <li><b>Cone:</b> r = |z| tanθ (for a cone with apex at the scattering origin and half-angle θ from the axis).</li>
      </ul>
      <p>
        Intersect them:
      </p>
      <div class="eq" data-copy="eq">
r = R and r = |z| tanθ
⇒ R = |z| tanθ
⇒ |z| = R cotθ
⇒ z = ± R cotθ
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        This means: for each order n (each θ), the cone hits the cylindrical film at a <b>constant z</b> (above and below the beam plane),
        independent of azimuth φ. Therefore the recorded intensity is:
      </p>
      <ul>
        <li><b>Two circular rings</b> around the cylinder at z = +R cotθ and z = −R cotθ.</li>
        <li>If you <b>unroll the film</b> to a flat sheet, each ring becomes a <b>horizontal line</b> (“layer line”).</li>
        <li>There is also the strong <b>direct beam</b> (n=0 gives θ=90°), which corresponds to the “equator” (z≈0) line where the incident beam passes.</li>
      </ul>

      <div class="card callout good">
        <div class="label good"><span class="dot"></span>Answer (a) — Appearance on the cylindrical film</div>
        <p>
          A sequence of <b>rings</b> (unrolled: <b>equally spaced horizontal layer lines</b>) symmetric above and below the beam,
          each ring corresponding to an integer n satisfying |nλ/a|≤1. Rotational symmetry about the fiber makes the intensity uniform around each ring.
        </p>
      </div>

      <details>
        <summary>Limiting cases (helps your sketch)</summary>
        <ul>
          <li><b>Small n (including n=0):</b> cosθ small ⇒ θ near 90° ⇒ cotθ small ⇒ rings near z=0 (near the equator).</li>
          <li><b>nλ → a:</b> θ → 0 ⇒ cotθ → ∞ ⇒ rings move far away along z (may miss a finite film).</li>
        </ul>
      </details>

      <h3>(b) Flat photographic plate behind the fiber, normal to the incident beam</h3>
      <p>
        Put the plate perpendicular to the incident beam (beam along x̂). Let the plate be the plane:
        <b>x = L</b>, with coordinates on the plate (y,z).
      </p>
      <p>
        Parameterize the ray direction on the cone. Use θ as the fixed angle from ẑ, and let φ be the azimuth around ẑ.
        Then a unit direction vector is:
      </p>
      <div class="eq" data-copy="eq">
n̂(θ,φ) = (sinθ cosφ) x̂ + (sinθ sinφ) ŷ + (cosθ) ẑ
Ray from origin: r(t) = t n̂,  t>0
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        Intersect with plane x=L:
      </p>
      <div class="eq" data-copy="eq">
x(t) = t sinθ cosφ = L
⇒ t = L / (sinθ cosφ)   (requires cosφ>0 to reach x=L)
Then:
y = t sinθ sinφ = L tanφ
z = t cosθ = L (cosθ)/(sinθ cosφ) = L cotθ · (1/cosφ)
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        Eliminate φ using y = L tanφ ⇒ tanφ = y/L ⇒ cosφ = 1/√(1+tan²φ) = 1/√(1+(y/L)²).
        Substitute into z:
      </p>
      <div class="eq" data-copy="eq">
z = L cotθ · √(1 + (y/L)²)
Square both sides:
z² = L² cot²θ · (1 + y²/L²) = L² cot²θ + y² cot²θ
Rearrange:
(z²)/(L² cot²θ) − (y²)/(L²) = 1
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        That is a <b>hyperbola</b> in the (y,z) coordinates of the plate. Because the cone also includes directions with z→−z,
        you get symmetric hyperbolae above and below the center.
      </p>

      <div class="card callout good">
        <div class="label good"><span class="dot"></span>Answer (b) — Appearance on the flat plate</div>
        <p>
          A set of <b>hyperbolic arcs</b> (one pair per diffraction order n), symmetric about the central beam point.
          Each order n fixes θ via <b>a cosθ = nλ</b>, and the cone–plane intersection produces the hyperbola
          <b>z²/(L² cot²θ) − y²/L² = 1</b>.
        </p>
      </div>

      <details>
        <summary>Why “hyperbolae” makes intuitive sense</summary>
        <p>
          A cone cut by a plane generally gives a conic section. Here the plane is not perpendicular to the cone axis (ẑ),
          so the intersection is not a circle. The derived equation has the standard hyperbola form (positive and negative squared terms).
        </p>
      </details>

      <h3>(c) Diffraction from a single plane of atoms forming a square lattice (constant a), plane normal to beam</h3>
      <p>
        Now the lattice is <b>2D</b>. Take the atomic plane to be the xy-plane (z=0) for convenience, and let the beam be normal to it,
        along ẑ: k<sub>i</sub>=k ẑ. Lattice points are r<sub>mn</sub> = m a x̂ + n a ŷ (m,n ∈ ℤ).
      </p>
      <p>
        The amplitude becomes a 2D lattice sum:
      </p>
      <div class="eq" data-copy="eq">
A(Δk) ∝ Σ_{m,n} exp(i Δk · (m a x̂ + n a ŷ))
     = (Σ_m exp(i m a Δk_x)) (Σ_n exp(i n a Δk_y))
⇒ peaks when:
a Δk_x = 2π h,   a Δk_y = 2π k,  with h,k ∈ ℤ
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        Thus the reciprocal lattice in-plane is also a <b>square grid</b>:
      </p>
      <div class="eq" data-copy="eq">
G_{hk} = (2π/a)(h x̂ + k ŷ)
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>
      <p>
        With normal incidence, the scattering preserves |k|, so only those G<sub>hk</sub> that intersect the Ewald sphere contribute.
        On a flat detector perpendicular to the beam, the spots appear at transverse positions proportional to the transverse wavevector components.
        In a small-angle (paraxial) camera-length approximation:
      </p>
      <div class="eq" data-copy="eq">
On detector at distance L:
(y_det, x_det) ∝ L (k_f,⊥ / k) ≈ L (G_⊥ / k)
So spot spacing on detector ∝ (λ L / a)
      <button class="copybtn" type="button" data-copy-btn>Copy</button>
      </div>

      <div class="card callout good">
        <div class="label good"><span class="dot"></span>Answer (c) — Appearance for a square lattice plane</div>
        <p>
          A <b>square array of diffraction spots</b> centered on the direct beam, with <b>four-fold symmetry</b>.
          The reciprocal lattice is square, so spot positions form a square grid; the spacing on the photographic plate scales like <b>λL/a</b>.
        </p>
      </div>

      <h3>(d) Orientation of the Ni(110) electron backscattering pattern relative to surface atoms</h3>
      <p>
        Low-energy electron diffraction/backscattering is strongly <b>surface sensitive</b>. If only the top layer contributes, the pattern is
        governed primarily by the <b>2D surface lattice</b> (not the 3D bulk).
      </p>

      <p>
        The (110) surface of an FCC crystal (like Ni) forms a <b>rectangular net</b> with two distinct in-plane periodicities:
        one direction has <b>closer-packed atomic rows</b>, and the perpendicular direction has a different spacing (often visibly “row-and-trough” in models).
        The reciprocal lattice of a rectangular net is also rectangular, with spacings inversely proportional to the real-space spacings.
      </p>

      <div class="card callout">
        <div class="label"><span class="dot"></span>Core reciprocal-space rule (orientation + spacing)</div>
        <div class="eq" data-copy="eq">
If the surface has real-space primitive vectors a1 and a2 (rectangular),
then reciprocal vectors b1 and b2 satisfy:
a_i · b_j = 2π δ_ij

Consequences:
• b1 ⟂ a2 and b2 ⟂ a1 (in a rectangular net)
• |b1| = 2π/|a1| ,  |b2| = 2π/|a2|
So larger real-space spacing ⇒ closer reciprocal spots.
        <button class="copybtn" type="button" data-copy-btn>Copy</button>
        </div>
      </div>

      <p>
        Therefore, the diffraction spot pattern:
      </p>
      <ul>
        <li>Shows <b>two-fold / rectangular symmetry</b> (not four-fold), reflecting the (110) surface net.</li>
        <li>Has a <b>denser spot spacing</b> along the reciprocal direction corresponding to the <b>larger real-space spacing</b> on the surface.</li>
        <li>Is <b>oriented with axes tied to the surface lattice axes</b>: spot rows align along reciprocal lattice directions, which are perpendicular (Fourier-dual) to the real-space periodicities/rows.</li>
      </ul>

      <div class="card callout good">
        <div class="label good"><span class="dot"></span>Answer (d) — Orientation explanation (what to say in words)</div>
        <p>
          The Ni(110) surface atoms form a <b>rectangular</b> 2D lattice (rows in one direction, different spacing in the perpendicular direction).
          The electron diffraction pattern is essentially a map of the <b>surface reciprocal lattice</b>, so it is also rectangular.
          Spot spacing is <b>inversely</b> related to surface atomic spacing: the direction on the surface with <b>larger</b> real-space period gives
          <b>closer</b> spots in the pattern. The pattern’s principal axes line up with the surface lattice axes (reciprocal to them),
          and bright spot rows appear perpendicular to the corresponding real-space periodicities (Fourier geometry).
        </p>
      </div>

      <details>
        <summary>Sanity check for (d): why “inverse spacing” must be true</summary>
        <p>
          If you doubled the real-space period a → 2a, the phase advance between neighbors halves, so you need half the Δk increment
          to reach the next 2π condition. That means reciprocal-lattice spacing shrinks by 2: (2π/a) → (2π/(2a)).
        </p>
      </details>

      <div class="card callout warn">
        <div class="label warn"><span class="dot"></span>Final Answer (copy-friendly)</div>
        <div class="eq" id="finalAnswer" data-copy="final">
(a) Cones (orders n via a cosθ = nλ) intersect a coaxial cylindrical film in rings at z = ± R cotθ (uniform in azimuth). Unrolled film: horizontal “layer lines” symmetric about the beam line.

(b) The same cones intersect a flat plate normal to the incident beam (plane x=L) in hyperbolae:
z²/(L² cot²θ) − y²/L² = 1 (one symmetric pair per n).

(c) A 2D square lattice (constant a) normal to the beam gives a square grid of spots (reciprocal lattice is square):
Δk_x = (2π/a)h, Δk_y = (2π/a)k, so spot spacing on plate scales like (λL/a).

(d) Ni(110) surface has a rectangular 2D atomic net; the diffraction pattern is the rectangular reciprocal lattice.
Spot spacings are inverse to real-space spacings and axes align with the surface lattice axes (reciprocal directions).
        <button class="copybtn" type="button" data-copy-btn>Copy</button>
        </div>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p4">
      <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

      <h3>Re-interpreting the key equations (what each term controls)</h3>
      <ul>
        <li><b>a cosθ = nλ (1D line):</b> fixes allowed <b>axial component</b> of scattering: Δk<sub>z</sub> = 2πn/a. Larger a → cones closer together in angle space (more closely spaced orders).</li>
        <li><b>Cylinder intersection z = ±R cotθ:</b> detector geometry converts angle θ to axial position on film. Larger R spreads rings further apart for a given θ.</li>
        <li><b>2D square reciprocal lattice:</b> periodicity in x and y produces discrete Δk<sub>x</sub>, Δk<sub>y</sub> → spot grid. Real-space symmetry becomes reciprocal-space symmetry.</li>
        <li><b>Surface diffraction:</b> “pattern is the reciprocal lattice” is a Fourier statement; spot orientation and spacing encode the surface unit cell.</li>
      </ul>

      <h3>Parameter dependence (qualitative)</h3>
      <div class="grid2">
        <div class="card">
          <div class="label"><span class="dot"></span>Changing wavelength λ</div>
          <ul>
            <li><b>1D cones:</b> larger λ increases nλ/a, changing θ; fewer orders satisfy |nλ/a|≤1 (orders disappear as wavelength grows).</li>
            <li><b>2D spots on detector:</b> spot spacing grows with λ (since transverse angles increase for fixed reciprocal spacing).</li>
          </ul>
        </div>
        <div class="card">
          <div class="label"><span class="dot"></span>Changing lattice constant a</div>
          <ul>
            <li><b>1D cones:</b> larger a → more allowed orders (since λ/a is smaller), cones become more closely spaced in angle.</li>
            <li><b>2D spots:</b> larger a → reciprocal spacing shrinks → spots move closer to the center (for fixed λ and L).</li>
          </ul>
        </div>
      </div>

      <h3>Alternative derivation idea (brief but meaningful)</h3>
      <p>
        Instead of ray geometry, you can use the <b>Ewald sphere construction</b>:
        for 1D, reciprocal space is a set of equally spaced planes (or points along one axis, depending on viewpoint);
        the Ewald sphere intersects these to give allowed k<sub>f</sub> directions, which project as cones.
        For 2D surfaces, reciprocal space is a 2D lattice; intersection with the Ewald sphere gives spot positions.
      </p>

      <h3>Concept check (self-test with answers)</h3>
      <ul>
        <li><b>Q:</b> Why does a 1D lattice produce cones, not discrete rays? <b>A:</b> Only one component (along the line) is quantized; the azimuthal angle remains free → rotationally symmetric set of directions.</li>
        <li><b>Q:</b> Why do rings become straight lines when the film is unrolled? <b>A:</b> A ring at fixed z on a cylinder becomes a horizontal line in the (φ,z) unwrapped coordinates.</li>
        <li><b>Q:</b> Why are the plate intersections hyperbolae? <b>A:</b> A cone intersected by a plane at a tilt to its axis yields a conic section with opposite-sign squared terms; algebra gives the hyperbola form.</li>
        <li><b>Q:</b> If real-space spacing doubles, what happens to reciprocal spot spacing? <b>A:</b> It halves (inverse proportionality).</li>
        <li><b>Q:</b> What symmetry would you expect from a square lattice plane? <b>A:</b> Four-fold rotational symmetry in the spot arrangement (square reciprocal lattice).</li>
      </ul>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="p5">
      <h2>PART 5 — Optional Plot Guide</h2>
      <div class="card">
        <div class="label"><span class="dot"></span>No plot included (and why)</div>
        <p>
          This problem is primarily <b>geometric and symbolic</b>: it asks for qualitative/sketch descriptions of patterns on different detector geometries.
          A numeric plot would require choosing arbitrary example values of (a, λ, L, R) and would not improve the core learning outcome as much as the
          analytic intersection results (rings vs hyperbolae vs spot lattice).
        </p>
      </div>
      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <footer>
      <p>
        Notes: This article used kinematic diffraction and far-field geometry to explain detector patterns. Real experiments may show broadened rings/spots due to finite domain size, disorder, and instrument resolution; low-energy electron diffraction can involve multiple scattering but preserves symmetry/orientation cues strongly.
      </p>
    </footer>
  </article>
</main>

<script>
  // Smooth scroll for TOC links
  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      const id = a.getAttribute('href');
      if(!id || id.length<2) return;
      const target = document.querySelector(id);
      if(!target) return;
      e.preventDefault();
      target.scrollIntoView({behavior:'smooth', block:'start'});
      history.replaceState(null, '', id);
    });
  });

  // Copy buttons for equations and final answer
  function copyText(text){
    return navigator.clipboard.writeText(text);
  }
  function flash(btn, msg){
    const old = btn.textContent;
    btn.textContent = msg;
    btn.style.borderColor = "rgba(167,255,207,.45)";
    btn.style.background = "rgba(167,255,207,.10)";
    setTimeout(()=>{
      btn.textContent = old;
      btn.style.borderColor = "";
      btn.style.background = "";
    }, 900);
  }
  document.querySelectorAll('[data-copy-btn]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const box = btn.closest('.eq');
      if(!box) return;
      // Extract visible code text (exclude button text)
      const clone = box.cloneNode(true);
      clone.querySelectorAll('button').forEach(b=>b.remove());
      const text = clone.textContent.replace(/\n{3,}/g,"\n\n").trim();
      try{
        await copyText(text);
        flash(btn, "Copied");
      }catch(err){
        // Fallback: create temp textarea
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); flash(btn, "Copied"); }
        catch(e){ flash(btn, "Copy failed"); }
        document.body.removeChild(ta);
      }
    });
  });
</script>
</body>
</html>