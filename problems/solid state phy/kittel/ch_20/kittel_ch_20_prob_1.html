<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Frenkel Defects: Equilibrium Interstitial/Vacancy Concentration (Derivation)</title>
  <style>
    :root{
      --bg: #0b0f14;
      --card: #111826;
      --card2:#0f1622;
      --text:#e8eef7;
      --muted:#b6c2d6;
      --faint:#7f8aa3;
      --accent:#6ad1ff;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --border: rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(106,209,255,.14), transparent 60%),
        radial-gradient(900px 600px at 95% 0%, rgba(167,139,250,.12), transparent 55%),
        radial-gradient(800px 600px at 60% 110%, rgba(52,211,153,.08), transparent 60%),
        var(--bg);
      color:var(--text);
      line-height:1.55;
    }

    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    header{
      padding:28px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .titleblock h1{
      font-size:clamp(1.55rem, 2.2vw, 2.15rem);
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      max-width:72ch;
    }
    .badgeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      margin-top:6px;
    }
    .badge{
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      padding:7px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:.86rem;
      backdrop-filter: blur(8px);
      box-shadow: 0 6px 18px rgba(0,0,0,.15);
      white-space:nowrap;
    }
    .badge strong{ color:var(--text); font-weight:650; }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:14px 18px 70px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
    }

    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025));
      border-radius:16px;
      padding:14px 14px 12px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .toc h2{
      margin:0 0 10px;
      font-size:1.02rem;
      letter-spacing:.2px;
    }
    .toc ol{
      margin:0;
      padding-left:18px;
      color:var(--muted);
    }
    .toc li{ margin:7px 0; }
    .toc a{
      color:var(--muted);
      display:inline-block;
      transform: translateZ(0);
      transition: color .15s ease, transform .15s ease;
    }
    .toc a:hover{
      color:var(--text);
      transform: translateX(2px);
      text-decoration:none;
    }
    .toc .mini{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed rgba(255,255,255,.14);
      color:var(--faint);
      font-size:.9rem;
    }
    .toc .mini a{ color:var(--faint); }
    .toc .mini a:hover{ color:var(--text); }

    article{
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-radius:18px;
      padding:18px 18px 10px;
      box-shadow:var(--shadow);
      min-width:0;
    }

    section{
      padding:14px 0;
      border-top:1px solid rgba(255,255,255,.08);
    }
    section:first-of-type{ border-top:none; padding-top:8px; }
    h2{
      margin:0 0 10px;
      font-size:1.25rem;
      letter-spacing:.2px;
    }
    h3{
      margin:16px 0 8px;
      font-size:1.05rem;
      color:var(--text);
      letter-spacing:.15px;
    }
    p{ margin:8px 0; color:var(--muted); }
    ul,ol{ color:var(--muted); }
    li{ margin:6px 0; }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
      nav.toc{ position:relative; top:auto; }
      .grid2{ grid-template-columns: 1fr; }
      .badgeRow{ justify-content:flex-start; }
    }

    .callout{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px 12px 10px;
      background:linear-gradient(180deg, rgba(17,24,38,.65), rgba(15,22,34,.65));
      box-shadow: 0 10px 26px rgba(0,0,0,.22);
      margin:10px 0;
      position:relative;
      overflow:hidden;
    }
    .callout:before{
      content:"";
      position:absolute;
      inset:-2px auto -2px -2px;
      width:5px;
      background: linear-gradient(180deg, var(--accent), transparent 70%);
      opacity:.85;
      border-radius:14px 0 0 14px;
    }
    .callout h4{
      margin:0 0 6px;
      font-size:.95rem;
      color:var(--text);
      letter-spacing:.15px;
    }
    .callout p, .callout ul{ margin:6px 0; }
    .callout.assumptions:before{ background: linear-gradient(180deg, var(--warn), transparent 70%); }
    .callout.mistakes:before{ background: linear-gradient(180deg, var(--bad), transparent 70%); }
    .callout.keyeq:before{ background: linear-gradient(180deg, var(--accent2), transparent 70%); }
    .callout.final:before{ background: linear-gradient(180deg, var(--ok), transparent 70%); }
    .callout.math:before{ background: linear-gradient(180deg, #22c55e, transparent 70%); }

    .eqbox{
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      background:rgba(0,0,0,.18);
      padding:12px;
      margin:10px 0;
      overflow:auto;
    }
    .eq{
      font-family:var(--mono);
      font-size:.95rem;
      color:#eaf2ff;
      white-space:pre-wrap;
      margin:0;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin:10px 0 0;
    }
    button.copy{
      appearance:none;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:.9rem;
      transition: transform .12s ease, border-color .15s ease, background .15s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
    }
    button.copy:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.20);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    }
    button.copy:active{ transform: translateY(0px) scale(.99); }

    details{
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:10px 12px;
      background: rgba(0,0,0,.12);
      margin:10px 0;
    }
    details summary{
      cursor:pointer;
      color:var(--text);
      font-weight:650;
      list-style:none;
    }
    details summary::-webkit-details-marker{ display:none; }
    details summary:after{
      content:"▾";
      float:right;
      color:var(--faint);
      transition: transform .15s ease;
    }
    details[open] summary:after{ transform: rotate(180deg); }
    details .content{ color:var(--muted); margin-top:8px; }

    figure{
      margin:14px 0 6px;
      padding:12px;
      border-radius:18px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.16);
    }
    figcaption{
      color:var(--faint);
      font-size:.9rem;
      margin-top:8px;
    }

    .backTop{
      display:inline-block;
      margin-top:10px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      transition: transform .12s ease, color .15s ease, border-color .15s ease;
    }
    .backTop:hover{
      transform: translateY(-1px);
      color:var(--text);
      border-color: rgba(255,255,255,.20);
      text-decoration:none;
    }

    footer{
      max-width:1200px;
      margin:0 auto;
      padding:0 18px 26px;
      color:var(--faint);
    }

    /* Print-friendly */
    @media print{
      body{ background:#fff; color:#000; }
      header, main, article, nav.toc, footer{ box-shadow:none !important; }
      nav.toc{ display:none; }
      main{ display:block; }
      article{ border:1px solid #ddd; background:#fff; }
      .callout, .eqbox, figure, details{ break-inside:avoid; }
      a{ color:#000; text-decoration:underline; }
      button{ display:none; }
    }
  </style>
</head>

<body>
  <header id="top">
    <div class="topbar">
      <div class="titleblock">
        <h1>Frenkel Defects in Thermal Equilibrium: Counting + Free-Energy Minimization</h1>
        <p class="subtitle">
          Derive the equilibrium number <span style="font-family:var(--mono);">n</span> of interstitial atoms (and hence vacancies) in a crystal with
          <span style="font-family:var(--mono);">N</span> lattice sites and <span style="font-family:var(--mono);">N'</span> available interstitial positions.
          Includes a rigorous statistical-mechanics derivation and the dilute-limit asymptotics.
        </p>
      </div>
      <div class="badgeRow">
        <div class="badge"><strong>Topic</strong>: Defects &amp; Stat Mech</div>
        <div class="badge"><strong>Result</strong>: symbolic + dilute limit</div>
        <div class="badge"><strong>Lens</strong>: applied physics + industry</div>
      </div>
    </div>
  </header>

  <main>
    <nav class="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <ol>
        <li><a href="#quick">Quick Summary</a></li>
        <li><a href="#part0">PART 0 — Concept Primer</a></li>
        <li><a href="#part0b">PART 0B — Industry &amp; Applied Physics Perspective</a></li>
        <li><a href="#part1">PART 1 — Problem Analysis</a></li>
        <li><a href="#part2">PART 2 — Strategy &amp; Tips</a></li>
        <li><a href="#part3">PART 3 — Full Solution</a></li>
        <li><a href="#part4">PART 4 — Deeper Understanding</a></li>
        <li><a href="#part5">PART 5 — Optional Plot Guide</a></li>
      </ol>
      <div class="mini">
        <div><a href="#finalAnswer">Jump to Final Answer</a></div>
        <div style="margin-top:6px;"><a href="#top">Back to top</a></div>
      </div>
    </nav>

    <article>
      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><strong>What this is about:</strong> A <em>Frenkel defect</em> is a vacancy–interstitial pair created when an atom leaves a lattice site and occupies an interstitial site.</li>
          <li><strong>Key physics idea:</strong> Equilibrium defect populations minimize the <em>Helmholtz free energy</em> <span style="font-family:var(--mono);">F = U − TS</span> (canonical ensemble, fixed <span style="font-family:var(--mono);">T</span>).</li>
          <li><strong>Configurational counting:</strong> Number of microstates for <span style="font-family:var(--mono);">n</span> Frenkel pairs is
            <span style="font-family:var(--mono);">W(n) = C(N, n) C(N', n)</span>.</li>
          <li><strong>Governing equation (equilibrium condition):</strong> Set <span style="font-family:var(--mono);">∂F/∂n = 0</span> using Stirling’s approximation.</li>
          <li><strong>Main result to show:</strong>
            <span style="font-family:var(--mono);">E_i = k_B T ln[((N−n)(N'−n))/n^2]</span>.</li>
          <li><strong>Dilute limit (n ≪ N, N'):</strong> Solve asymptotically to get
            <span style="font-family:var(--mono);">n ≈ sqrt(NN') exp(−E_i/(2k_B T))</span>.</li>
          <li><strong>Physical meaning:</strong> Defect concentration is exponentially activated by the formation energy, but boosted by the large number of available sites (<span style="font-family:var(--mono);">N, N'</span>).</li>
          <li><strong>Applied relevance:</strong> Defect populations govern diffusion rates, ionic conductivity, swelling/creep, and yield in manufacturing heat treatments.</li>
        </ul>
      </section>

      <section id="part0">
        <h2>PART 0 — Concept Primer (THEORY BEFORE SOLVING)</h2>

        <div class="grid2">
          <div class="callout keyeq">
            <h4>Core definitions (symbols + typical SI units)</h4>
            <ul>
              <li><span style="font-family:var(--mono);">N</span>: number of lattice sites (dimensionless count).</li>
              <li><span style="font-family:var(--mono);">N'</span>: number of distinct interstitial positions (dimensionless count).</li>
              <li><span style="font-family:var(--mono);">n</span>: number of Frenkel pairs = vacancies = interstitial atoms (dimensionless count).</li>
              <li><span style="font-family:var(--mono);">E_i</span>: energy to create one Frenkel pair (J). (Problem statement: remove atom from lattice site and place it interstitially.)</li>
              <li><span style="font-family:var(--mono);">k_B</span>: Boltzmann constant (J/K).</li>
              <li><span style="font-family:var(--mono);">T</span>: absolute temperature (K).</li>
              <li><span style="font-family:var(--mono);">W</span>: number of microstates (dimensionless).</li>
              <li><span style="font-family:var(--mono);">S = k_B ln W</span>: configurational entropy (J/K).</li>
              <li><span style="font-family:var(--mono);">F = U − TS</span>: Helmholtz free energy (J).</li>
            </ul>
          </div>

          <div class="callout">
            <h4>Physical meaning &amp; intuition</h4>
            <p>
              Creating a Frenkel pair costs energy <span style="font-family:var(--mono);">E_i</span>, so low temperatures suppress defects.
              But defects also <em>increase entropy</em> because there are many ways to choose which lattice sites are vacant and which
              interstitial sites are occupied. At finite <span style="font-family:var(--mono);">T</span>, equilibrium comes from balancing these effects.
            </p>
            <p>
              In statistical mechanics at fixed <span style="font-family:var(--mono);">T</span>, the equilibrium macrostate minimizes <span style="font-family:var(--mono);">F</span>.
              This is a variational principle: <span style="font-family:var(--mono);">∂F/∂n = 0</span> at equilibrium.
            </p>
          </div>
        </div>

        <h3>Key laws/principles &amp; validity conditions</h3>
        <ul>
          <li><strong>Canonical ensemble:</strong> crystal exchanges heat with a reservoir; <span style="font-family:var(--mono);">T</span> fixed, <span style="font-family:var(--mono);">N</span> fixed.</li>
          <li><strong>Free-energy minimum:</strong> For a system at fixed <span style="font-family:var(--mono);">T</span>, <span style="font-family:var(--mono);">V</span>, and particle number, equilibrium minimizes Helmholtz free energy.</li>
          <li><strong>Non-interacting dilute defects (baseline model):</strong> defects do not strongly interact; defect formation energy is approximately linear: <span style="font-family:var(--mono);">U(n) = n E_i</span>.</li>
          <li><strong>Configurational entropy from counting:</strong> assumes distinct sites and indistinguishability of defects except by position.</li>
          <li><strong>Stirling approximation:</strong> used when <span style="font-family:var(--mono);">N, N', n</span> are large; accurate in crystals where counts are macroscopic.</li>
        </ul>

        <h3>Common models/approximations and why they’re used</h3>
        <ul>
          <li><strong>Independent-site model:</strong> counts states via binomial coefficients; simplest tractable description for equilibrium concentrations.</li>
          <li><strong>Dilute limit <span style="font-family:var(--mono);">n ≪ N, N'</span>:</strong> yields closed-form asymptotic expressions and connects to Arrhenius activation.</li>
          <li><strong>Constant formation energy:</strong> ignores strain-field interactions and defect clustering; good at low defect densities.</li>
        </ul>

        <h3>Mini intuition examples (conceptual)</h3>
        <ul>
          <li><strong>Low T:</strong> energy dominates ⇒ <span style="font-family:var(--mono);">n</span> tiny (nearly perfect lattice).</li>
          <li><strong>Higher T:</strong> entropy term grows like <span style="font-family:var(--mono);">k_B T ln W</span> ⇒ more defects become favorable.</li>
          <li><strong>More interstitial sites <span style="font-family:var(--mono);">N'</span>:</strong> larger state count ⇒ higher <span style="font-family:var(--mono);">n</span> at the same <span style="font-family:var(--mono);">T</span>.</li>
        </ul>

        <div class="callout mistakes">
          <h4>What to watch for (pitfalls &amp; hidden assumptions)</h4>
          <ul>
            <li><strong>Forgetting the pair constraint:</strong> For Frenkel defects, vacancies and interstitials are created in equal numbers: both are <span style="font-family:var(--mono);">n</span>.</li>
            <li><strong>Mixing ensembles:</strong> here we use Helmholtz free energy (<span style="font-family:var(--mono);">T,V,N</span> fixed). Don’t jump to chemical potentials unless you define a grand-canonical model.</li>
            <li><strong>Entropy sign errors:</strong> <span style="font-family:var(--mono);">F = U − TS</span>; more microstates (larger <span style="font-family:var(--mono);">W</span>) means larger <span style="font-family:var(--mono);">S</span> and thus smaller <span style="font-family:var(--mono);">F</span>.</li>
            <li><strong>Stirling domain:</strong> Stirling requires large counts; if <span style="font-family:var(--mono);">n</span> is extremely small, the discrete nature matters (but macroscopic crystals still typically justify it).</li>
          </ul>
        </div>

        <div class="callout math">
          <h4>Math Insight (interpret the core equation as a mathematical object)</h4>
          <p>
            The equilibrium condition is a <strong>variational / optimization problem</strong>:
            minimize the scalar functional <span style="font-family:var(--mono);">F(n) = nE_i − k_B T ln W(n)</span> over the discrete domain
            <span style="font-family:var(--mono);">n ∈ {0,1,2,…,min(N,N')}</span>. In the thermodynamic limit we treat <span style="font-family:var(--mono);">n</span>
            as continuous and solve the Euler condition <span style="font-family:var(--mono);">dF/dn = 0</span>. This is analogous to finding the stationary point of a convex-like function,
            where the energetic linear term competes against a concave logarithmic entropy term.
          </p>
        </div>
      </section>

      <section id="part0b">
        <h2>PART 0B — Industry &amp; Applied Physics Perspective</h2>

        <h3>Where Frenkel-defect physics shows up (concrete applications)</h3>
        <ul>
          <li><strong>Ionic conductors &amp; solid electrolytes:</strong> interstitial ions + vacancies drive ionic conductivity in batteries and fuel cells.</li>
          <li><strong>Diffusion-controlled heat treatments:</strong> vacancy populations control diffusion rates (carburizing, nitriding, annealing) and thus microstructure evolution.</li>
          <li><strong>Radiation damage &amp; reliability:</strong> irradiation creates Frenkel pairs; annealing schedules aim to recombine or stabilize defects to reduce swelling/embrittlement.</li>
          <li><strong>Semiconductor/device yield:</strong> point defects affect carrier lifetimes, leakage currents, and dopant diffusion—impacting wafer yield and long-term drift.</li>
        </ul>

        <h3>Why engineers care</h3>
        <ul>
          <li><strong>Performance:</strong> diffusion, conductivity, and mechanical creep often scale strongly with defect concentration.</li>
          <li><strong>Reliability &amp; safety:</strong> defects can nucleate cracks, alter corrosion rates, and change thermal stability.</li>
          <li><strong>Cost &amp; manufacturability:</strong> controlling defect populations via temperature/time cycles reduces scrap and improves process windows.</li>
        </ul>

        <h3>Typical measurement/validation methods</h3>
        <ul>
          <li><strong>Electrical/ionic conductivity vs T:</strong> Arrhenius-type trends can infer activation energies linked to defect formation/migration.</li>
          <li><strong>Diffusion experiments:</strong> tracer diffusion and SIMS profiles connect to vacancy availability.</li>
          <li><strong>Positron annihilation spectroscopy:</strong> sensitive probe of vacancy-type defects.</li>
          <li><strong>Scattering/microscopy:</strong> diffuse scattering or TEM (for higher defect concentrations/defect clusters).</li>
        </ul>

        <h3>Design trade-offs &amp; constraints (real materials)</h3>
        <ul>
          <li><strong>Non-ideality:</strong> defect–defect interactions, elastic strain, and charge compensation can make <span style="font-family:var(--mono);">E_i</span> depend on <span style="font-family:var(--mono);">n</span>.</li>
          <li><strong>Finite kinetics:</strong> equilibrium may not be reached; diffusion-limited relaxation introduces time scales.</li>
          <li><strong>Tolerances &amp; composition:</strong> impurities can pin defects or change available interstitial sites (<span style="font-family:var(--mono);">N'</span> effectively changes).</li>
        </ul>

        <details>
          <summary>From lab to product (how the ideal model is adapted)</summary>
          <div class="content">
            <p>
              In production, engineers often combine the equilibrium concentration from this model with a <em>kinetic transport model</em>
              (diffusion equation <span style="font-family:var(--mono);">∂c/∂t = ∇·(D∇c)</span> where <span style="font-family:var(--mono);">D</span> depends on defect populations).
              They also calibrate <span style="font-family:var(--mono);">E_i</span> against experimental data or atomistic simulations, and include
              non-ideal corrections (activity coefficients) when defect concentrations are not dilute.
            </p>
          </div>
        </details>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (no solving yet)</h2>

        <h3>Problem restatement (in plain words)</h3>
        <p>
          A crystal has <span style="font-family:var(--mono);">N</span> lattice sites and <span style="font-family:var(--mono);">N'</span> possible interstitial sites.
          A Frenkel defect is made by taking one atom from a lattice site (creating one vacancy) and placing it into an interstitial site (creating one interstitial atom).
          If there are <span style="font-family:var(--mono);">n</span> such pairs, show that equilibrium implies:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_target">E_i = k_B T ln [ ((N − n)(N' − n)) / n^2 ]</pre>
        </div>
        <p>
          Then, in the dilute limit <span style="font-family:var(--mono);">n ≪ N, N'</span>, show
          <span style="font-family:var(--mono);">n ≈ (N N')^(1/2) exp(−E_i/(2k_B T))</span>.
        </p>

        <h3>Given quantities</h3>
        <ul>
          <li><span style="font-family:var(--mono);">N</span>, <span style="font-family:var(--mono);">N'</span>, <span style="font-family:var(--mono);">T</span>, <span style="font-family:var(--mono);">E_i</span>, <span style="font-family:var(--mono);">k_B</span></li>
        </ul>

        <h3>Unknowns</h3>
        <ul>
          <li><span style="font-family:var(--mono);">n</span> (equilibrium number of interstitial atoms / vacancies)</li>
        </ul>

        <h3>What must be proved</h3>
        <ul>
          <li>The equilibrium relation between <span style="font-family:var(--mono);">n</span> and the parameters (log equation above).</li>
          <li>The dilute-limit asymptotic approximation for <span style="font-family:var(--mono);">n</span>.</li>
        </ul>

        <h3>Relevant principles (and why they apply)</h3>
        <ul>
          <li><strong>Free-energy minimization:</strong> system at temperature <span style="font-family:var(--mono);">T</span> equilibrates to minimize Helmholtz free energy.</li>
          <li><strong>Combinatorial entropy:</strong> the number of arrangements of vacancies and interstitials determines entropy.</li>
          <li><strong>Thermodynamic limit + Stirling:</strong> large <span style="font-family:var(--mono);">N</span>, <span style="font-family:var(--mono);">N'</span> justify log-factorial approximations.</li>
        </ul>

        <div class="callout assumptions">
          <h4>Explicit assumptions</h4>
          <ul>
            <li><strong>Pairing constraint:</strong> each Frenkel defect creates exactly one vacancy and one interstitial ⇒ both counts equal <span style="font-family:var(--mono);">n</span>.</li>
            <li><strong>Independent-site model:</strong> defects are non-interacting; formation energy is <span style="font-family:var(--mono);">U(n)=nE_i</span>.</li>
            <li><strong>All sites equivalent:</strong> all lattice sites equivalent and all interstitial sites equivalent (no energy distribution across sites).</li>
            <li><strong>Equilibrium achieved:</strong> kinetics not limiting; we solve equilibrium only.</li>
          </ul>
        </div>

        <h3>Possible approaches (2–3) and comparison</h3>
        <ol>
          <li>
            <strong>Helmholtz free energy minimization (counting microstates):</strong>
            compute <span style="font-family:var(--mono);">W(n)</span>, set <span style="font-family:var(--mono);">F(n)=nE_i − k_BT ln W(n)</span>, minimize.
            <em>Pros:</em> direct, standard, transparent. <em>Cons:</em> requires Stirling/log algebra.
          </li>
          <li>
            <strong>Law of mass action / chemical potentials:</strong> treat reaction “lattice atom → vacancy + interstitial” and equate chemical potentials.
            <em>Pros:</em> elegant, scalable to charged defects. <em>Cons:</em> must define chemical potentials carefully and still uses entropy of mixing.
          </li>
          <li>
            <strong>Partition function method:</strong> compute dominant term in <span style="font-family:var(--mono);">Z = Σ_n W(n) e^{−β n E_i}</span> via Laplace method.
            <em>Pros:</em> most formal; connects to large-deviation theory. <em>Cons:</em> heavier machinery than needed.
          </li>
        </ol>

        <p>
          <strong>Best choice here:</strong> Free-energy minimization (Approach 1) matches the requested equation directly and keeps the logic explicit.
        </p>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy &amp; Tips (roadmap only)</h2>

        <ol>
          <li><strong>Model the macrostate:</strong> specify <span style="font-family:var(--mono);">n</span> vacancies among <span style="font-family:var(--mono);">N</span> sites and <span style="font-family:var(--mono);">n</span> interstitial atoms among <span style="font-family:var(--mono);">N'</span> sites.</li>
          <li><strong>Count microstates:</strong> compute <span style="font-family:var(--mono);">W(n)=C(N,n)C(N',n)</span>.</li>
          <li><strong>Write energy:</strong> use <span style="font-family:var(--mono);">U(n)=nE_i</span>.</li>
          <li><strong>Write free energy:</strong> <span style="font-family:var(--mono);">F(n)=U(n)−TS(n)=nE_i − k_BT ln W(n)</span>.</li>
          <li><strong>Thermodynamic approximation:</strong> apply Stirling to <span style="font-family:var(--mono);">ln(n!)</span> to get an analytic expression.</li>
          <li><strong>Minimize:</strong> treat <span style="font-family:var(--mono);">n</span> as continuous and solve <span style="font-family:var(--mono);">dF/dn=0</span>.</li>
          <li><strong>Rearrange:</strong> isolate <span style="font-family:var(--mono);">E_i</span> to match the target log equation.</li>
          <li><strong>Dilute limit:</strong> set <span style="font-family:var(--mono);">N−n≈N</span>, <span style="font-family:var(--mono);">N'−n≈N'</span> and solve for <span style="font-family:var(--mono);">n</span>.</li>
          <li><strong>Sanity checks:</strong> dimensions (log argument dimensionless), limiting cases (<span style="font-family:var(--mono);">T→0</span>), monotonicity with <span style="font-family:var(--mono);">T</span>.</li>
        </ol>

        <div class="callout mistakes">
          <h4>Common mistakes (quick tips)</h4>
          <ul>
            <li>Using <span style="font-family:var(--mono);">W=C(N,n)+C(N',n)</span> instead of a product (choices are independent ⇒ multiply).</li>
            <li>Dropping the constraint that the number of vacancies equals number of interstitials.</li>
            <li>Sign error in <span style="font-family:var(--mono);">F = U − k_BT ln W</span>.</li>
            <li>Forgetting that <span style="font-family:var(--mono);">ln</span> requires a dimensionless argument (a good dimensional check).</li>
          </ul>
        </div>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (DETAILED + TEACHING)</h2>

        <h3>Start with physical intuition (qualitative expectation)</h3>
        <p>
          Each Frenkel pair costs energy <span style="font-family:var(--mono);">E_i</span>, so at low <span style="font-family:var(--mono);">T</span> we expect <span style="font-family:var(--mono);">n</span> to be very small.
          As temperature increases, the entropy gained by having many possible defect arrangements grows like <span style="font-family:var(--mono);">k_BT ln W</span>,
          so <span style="font-family:var(--mono);">n</span> increases rapidly—typically with an Arrhenius-like factor <span style="font-family:var(--mono);">exp(−E_i/(2k_BT))</span>.
        </p>

        <h3>Mathematical model (variables, domain, conditions)</h3>
        <div class="callout math">
          <h4>Model statement</h4>
          <ul>
            <li><strong>State variable:</strong> integer <span style="font-family:var(--mono);">n</span> = number of Frenkel pairs.</li>
            <li><strong>Domain:</strong> <span style="font-family:var(--mono);">n ∈ {0,1,2,…,min(N,N')}</span>.</li>
            <li><strong>Energy model:</strong> <span style="font-family:var(--mono);">U(n)=nE_i</span> (linearity: independent identical defects).</li>
            <li><strong>Entropy model:</strong> <span style="font-family:var(--mono);">S(n)=k_B ln W(n)</span>, with <span style="font-family:var(--mono);">W(n)</span> computed by combinatorics.</li>
            <li><strong>Equilibrium condition:</strong> minimize Helmholtz free energy at fixed <span style="font-family:var(--mono);">T</span>:
              <span style="font-family:var(--mono);">F(n)=U(n)−TS(n)</span>. In the thermodynamic limit, solve <span style="font-family:var(--mono);">dF/dn=0</span>.</li>
          </ul>
          <p style="margin-top:8px;">
            Note: This is a scalar optimization problem (no spatial fields), so operators like <span style="font-family:var(--mono);">∇</span>, <span style="font-family:var(--mono);">∇·</span>, <span style="font-family:var(--mono);">∇×</span>, or the Laplacian do not appear in the core derivation.
            (In kinetics, a diffusion PDE would appear, but equilibrium counting does not require it.)
          </p>
        </div>

        <h3>Step 1: Count microstates W(n)</h3>
        <p>
          A macrostate with <span style="font-family:var(--mono);">n</span> Frenkel defects means:
        </p>
        <ul>
          <li>Choose which <span style="font-family:var(--mono);">n</span> of the <span style="font-family:var(--mono);">N</span> lattice sites are vacant.</li>
          <li>Choose which <span style="font-family:var(--mono);">n</span> of the <span style="font-family:var(--mono);">N'</span> interstitial sites are occupied.</li>
        </ul>
        <p>
          These choices are independent, so the number of distinct configurations is the product of binomial coefficients:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_W">W(n) = C(N, n) C(N', n)
     = [N!/(n!(N−n)!)] · [N'!/(n!(N'−n)!)]</pre>
        </div>
        <p>
          This step is valid by basic combinatorics: selecting sets of sites is a counting problem with indistinguishable defects.
        </p>

        <h3>Step 2: Write energy and free energy</h3>
        <p>
          By the problem statement, each Frenkel defect costs energy <span style="font-family:var(--mono);">E_i</span>, so:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_UF">U(n) = n E_i

S(n) = k_B ln W(n)

F(n) = U(n) − T S(n) = nE_i − k_B T ln W(n)</pre>
        </div>
        <p>
          The linearity of <span style="font-family:var(--mono);">U(n)</span> is an approximation: it assumes defects do not interact strongly (dilute / mean-field regime).
        </p>

        <h3>Step 3: Use Stirling’s approximation to simplify ln W(n)</h3>
        <p>
          For large integers <span style="font-family:var(--mono);">m</span>, Stirling gives:
          <span style="font-family:var(--mono);">ln(m!) ≈ m ln m − m</span> (subleading terms cancel in derivatives and are negligible here).
        </p>
        <p>
          Apply Stirling to each factorial in <span style="font-family:var(--mono);">ln W(n)</span>:
        </p>

        <div class="eqbox">
          <pre class="eq" id="eq_lnW">ln W(n) = ln N! − ln n! − ln(N−n)!  +  ln N'! − ln n! − ln(N'−n)!

Using ln m! ≈ m ln m − m:

ln W(n) ≈ [N ln N − N] − [n ln n − n] − [(N−n) ln(N−n) − (N−n)]
        + [N' ln N' − N'] − [n ln n − n] − [(N'−n) ln(N'−n) − (N'−n)]</pre>
        </div>

        <p>
          We will differentiate with respect to <span style="font-family:var(--mono);">n</span>, so constants in <span style="font-family:var(--mono);">n</span> can be ignored after differentiation, but we keep them for clarity.
        </p>

        <details>
          <summary>Derivative helper (why the next derivative step is “legal”)</summary>
          <div class="content">
            <p>
              We approximate discrete <span style="font-family:var(--mono);">n</span> by a continuous variable because the minimum occurs at large counts in the thermodynamic limit.
              Differentiating an asymptotic expression is justified because Stirling’s approximation is smooth and the relative error becomes small for large numbers.
              After finding the stationary point, one can round to the nearest integer.
            </p>
            <p>
              Also note the derivative identity:
              <span style="font-family:var(--mono);">d/dn [(a−n) ln(a−n)] = −ln(a−n) − 1</span>,
              which we’ll use repeatedly.
            </p>
          </div>
        </details>

        <h3>Step 4: Compute dF/dn and set it to zero</h3>
        <p>
          First differentiate <span style="font-family:var(--mono);">F(n)=nE_i − k_B T ln W(n)</span>:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_dF">dF/dn = E_i − k_B T · d(ln W)/dn</pre>
        </div>

        <p>Now compute <span style="font-family:var(--mono);">d(ln W)/dn</span> from the Stirling-expanded form.</p>

        <h4>Differentiate the lattice-site factor C(N,n)</h4>
        <p>
          Consider
          <span style="font-family:var(--mono);">ln C(N,n) = ln N! − ln n! − ln(N−n)!</span>.
          Using Stirling:
        </p>
        <div class="eqbox">
          <pre class="eq">ln C(N,n) ≈ [N ln N − N] − [n ln n − n] − [(N−n) ln(N−n) − (N−n)]</pre>
        </div>
        <p>Differentiate term-by-term:</p>
        <div class="eqbox">
          <pre class="eq" id="eq_dlnC_N">d/dn [−(n ln n − n)] = −(ln n + 1 − 1) = −ln n
d/dn [−((N−n) ln(N−n) − (N−n))]
  = −(−ln(N−n) − 1 + 1) = +ln(N−n)

Therefore: d/dn ln C(N,n) = ln(N−n) − ln n = ln[(N−n)/n]</pre>
        </div>

        <h4>Differentiate the interstitial factor C(N',n)</h4>
        <p>By the same algebra (replace <span style="font-family:var(--mono);">N</span> by <span style="font-family:var(--mono);">N'</span>):</p>
        <div class="eqbox">
          <pre class="eq" id="eq_dlnC_Np">d/dn ln C(N',n) = ln[(N'−n)/n]</pre>
        </div>

        <h4>Combine to get d(ln W)/dn</h4>
        <p>
          Since <span style="font-family:var(--mono);">ln W = ln C(N,n) + ln C(N',n)</span>, linearity of differentiation gives:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_dlnW">d(ln W)/dn = ln[(N−n)/n] + ln[(N'−n)/n]
           = ln[ ((N−n)(N'−n)) / n^2 ]</pre>
        </div>

        <h4>Set the equilibrium condition</h4>
        <p>
          At equilibrium, <span style="font-family:var(--mono);">dF/dn = 0</span>:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_equil">0 = E_i − k_B T · ln[ ((N−n)(N'−n)) / n^2 ]</pre>
        </div>
        <p>Rearrange to obtain the required result:</p>

        <div class="callout final" id="finalAnswer">
          <h4>Final Result (boxed)</h4>
          <div class="eqbox" style="margin-top:8px;">
            <pre class="eq" id="eq_final">E_i = k_B T ln [ ((N − n)(N' − n)) / n^2 ]</pre>
          </div>
          <div class="btnRow">
            <button class="copy" data-copy-target="eq_final">Copy key equation (plain text)</button>
            <button class="copy" data-copy-final="true">Copy final answer (plain text)</button>
          </div>
        </div>

        <h3>Step 5: Dilute limit asymptotics (n ≪ N, N')</h3>
        <p>
          If <span style="font-family:var(--mono);">n ≪ N</span> and <span style="font-family:var(--mono);">n ≪ N'</span>, then:
          <span style="font-family:var(--mono);">N−n ≈ N</span> and <span style="font-family:var(--mono);">N'−n ≈ N'</span>.
          Substitute these into the equilibrium equation:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq_dilute1">E_i ≈ k_B T ln[ (N N') / n^2 ]</pre>
        </div>
        <p>Exponentiate both sides (valid because exp is monotone):</p>
        <div class="eqbox">
          <pre class="eq" id="eq_dilute2">exp(E_i/(k_B T)) ≈ (N N') / n^2</pre>
        </div>
        <p>Solve for <span style="font-family:var(--mono);">n</span> (take positive root since <span style="font-family:var(--mono);">n ≥ 0</span>):</p>
        <div class="eqbox">
          <pre class="eq" id="eq_dilute3">n^2 ≈ N N' · exp(−E_i/(k_B T))
n ≈ sqrt(N N') · exp(−E_i/(2 k_B T))</pre>
        </div>

        <div class="callout keyeq">
          <h4>Dilute-limit result</h4>
          <div class="eqbox" style="margin-top:8px;">
            <pre class="eq" id="eq_final_dilute">n ≈ (N N')^(1/2) exp(−E_i/(2 k_B T))   (for n ≪ N, N')</pre>
          </div>
          <div class="btnRow">
            <button class="copy" data-copy-target="eq_final_dilute">Copy dilute-limit equation (plain text)</button>
          </div>
        </div>

        <h3>Sanity checks</h3>
        <h4>1) Dimensional analysis</h4>
        <ul>
          <li><span style="font-family:var(--mono);">E_i</span> has units of J.</li>
          <li><span style="font-family:var(--mono);">k_B T</span> has units of J.</li>
          <li><span style="font-family:var(--mono);">ln( ... )</span> requires a dimensionless argument: <span style="font-family:var(--mono);">((N−n)(N'−n))/n^2</span> is a pure number ⇒ OK.</li>
        </ul>

        <h4>2) Limiting cases</h4>
        <ul>
          <li><strong>T → 0:</strong> <span style="font-family:var(--mono);">exp(−E_i/(2k_BT)) → 0</span> ⇒ <span style="font-family:var(--mono);">n → 0</span> (defects freeze out).</li>
          <li><strong>Large E<sub>i</sub>:</strong> higher formation energy suppresses <span style="font-family:var(--mono);">n</span> exponentially.</li>
          <li><strong>Larger N or N':</strong> more available sites increases <span style="font-family:var(--mono);">n</span> via <span style="font-family:var(--mono);">sqrt(NN')</span>, reflecting configurational entropy.</li>
        </ul>

        <h4>3) Physical interpretation in plain language</h4>
        <p>
          The equilibrium defect count is set by a competition:
          energy penalizes creating pairs linearly (<span style="font-family:var(--mono);">nE_i</span>),
          while entropy rewards them logarithmically through the large number of ways to place them.
          The final equation is essentially “energy per defect equals thermal energy times a log of available placement options”.
        </p>

        <figure aria-label="Optional plot of normalized defect concentration versus temperature">
          <canvas id="plot" style="width:100%; height:320px; display:block; border-radius:14px;"></canvas>
          <figcaption>
            Single static plot (example values) showing how normalized equilibrium Frenkel-pair count increases with temperature via
            <span style="font-family:var(--mono);">n / sqrt(NN') ≈ exp(−E_i/(2k_BT))</span>.
          </figcaption>
        </figure>

        <a class="backTop" href="#top">Back to top ↑</a>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (THEORY AROUND THE RESULT)</h2>

        <h3>Re-interpret the final formula (what each term controls)</h3>
        <p>
          From
          <span style="font-family:var(--mono);">E_i = k_B T ln(((N−n)(N'−n))/n^2)</span>:
        </p>
        <ul>
          <li><strong><span style="font-family:var(--mono);">E_i</span> (formation energy):</strong> the “energy barrier” opposing defect formation.</li>
          <li><strong><span style="font-family:var(--mono);">k_B T</span> (thermal energy):</strong> sets the scale of entropic driving; higher <span style="font-family:var(--mono);">T</span> allows more defects.</li>
          <li><strong>Log argument:</strong> ratio of “available placements” to “already occupied placements”. As <span style="font-family:var(--mono);">n</span> increases, availability decreases (<span style="font-family:var(--mono);">N−n</span>, <span style="font-family:var(--mono);">N'−n</span>), providing saturation behavior beyond the dilute limit.</li>
        </ul>

        <h3>Parameter dependence (qualitative and quantitative)</h3>
        <ul>
          <li><strong>Temperature:</strong> in dilute limit, <span style="font-family:var(--mono);">ln n</span> is linear in <span style="font-family:var(--mono);">1/T</span> with slope <span style="font-family:var(--mono);">−E_i/(2k_B)</span>.</li>
          <li><strong>Available interstitial sites <span style="font-family:var(--mono);">N'</span>:</strong> increases <span style="font-family:var(--mono);">n</span> as <span style="font-family:var(--mono);">sqrt(N')</span> in dilute limit.</li>
          <li><strong>Non-dilute correction:</strong> if <span style="font-family:var(--mono);">n</span> becomes a non-negligible fraction of <span style="font-family:var(--mono);">N</span> or <span style="font-family:var(--mono);">N'</span>, the factors <span style="font-family:var(--mono);">N−n</span>, <span style="font-family:var(--mono);">N'−n</span> reduce the growth (crowding effect).</li>
        </ul>

        <h3>An alternative derivation idea (brief but meaningful)</h3>
        <p>
          You can write the canonical partition function over the defect number:
          <span style="font-family:var(--mono);">Z = Σ_n W(n) exp(−β n E_i)</span>, where <span style="font-family:var(--mono);">β = 1/(k_B T)</span>.
          In the thermodynamic limit, the sum is dominated by the maximum of
          <span style="font-family:var(--mono);">ln W(n) − β n E_i</span>. Setting its derivative to zero produces the same condition as
          <span style="font-family:var(--mono);">dF/dn = 0</span>, since <span style="font-family:var(--mono);">F = −k_B T ln Z</span> and the saddle point selects equilibrium <span style="font-family:var(--mono);">n</span>.
        </p>

        <h3>Concept check (self-test with answers)</h3>
        <ul>
          <li><strong>Q:</strong> Why is <span style="font-family:var(--mono);">W</span> a product of two binomial coefficients?<br/>
              <strong>A:</strong> Choosing vacancy sites and choosing interstitial occupied sites are independent combinatorial choices.</li>
          <li><strong>Q:</strong> Why does the dilute limit produce an Arrhenius factor with <span style="font-family:var(--mono);">E_i/2</span>?<br/>
              <strong>A:</strong> The equilibrium condition involves <span style="font-family:var(--mono);">n^2</span> in the denominator because you create <em>pairs</em>; solving for <span style="font-family:var(--mono);">n</span> takes a square root, halving the exponent.</li>
          <li><strong>Q:</strong> What breaks if defects strongly interact?<br/>
              <strong>A:</strong> The energy is no longer <span style="font-family:var(--mono);">nE_i</span>; it may include nonlinear terms (e.g., <span style="font-family:var(--mono);">~n^2</span>), changing the equilibrium equation.</li>
          <li><strong>Q:</strong> Is the log equation valid for <span style="font-family:var(--mono);">n</span> near <span style="font-family:var(--mono);">N</span>?<br/>
              <strong>A:</strong> The combinatorial form remains meaningful, but the physical assumptions (dilute, independent defects) usually fail long before that.</li>
        </ul>

        <a class="backTop" href="#top">Back to top ↑</a>
      </section>

      <section id="part5">
        <h2>PART 5 — Optional Plot Guide</h2>

        <h3>What the plot shows and why it’s useful</h3>
        <p>
          The plot shows the <strong>normalized equilibrium defect number</strong>
          <span style="font-family:var(--mono);">n / sqrt(NN')</span> versus temperature <span style="font-family:var(--mono);">T</span>
          using the dilute-limit formula:
          <span style="font-family:var(--mono);">n / sqrt(NN') ≈ exp(−E_i/(2k_BT))</span>.
          It highlights the strong (exponential) temperature sensitivity that engineers exploit in annealing and diffusion-driven processes.
        </p>

        <h3>Axes and units</h3>
        <ul>
          <li><strong>x-axis:</strong> Temperature <span style="font-family:var(--mono);">T</span> in K.</li>
          <li><strong>y-axis:</strong> Dimensionless normalized concentration <span style="font-family:var(--mono);">n / sqrt(NN')</span>.</li>
        </ul>

        <h3>Example values used (only for the plot)</h3>
        <ul>
          <li><span style="font-family:var(--mono);">E_i = 1.6 eV</span> (converted to J in the code)</li>
          <li>Temperature range: <span style="font-family:var(--mono);">300–1400 K</span></li>
        </ul>

        <h3>Features to notice</h3>
        <ul>
          <li><strong>Curvature:</strong> exponential activation produces a rapidly rising curve with <span style="font-family:var(--mono);">T</span>.</li>
          <li><strong>Low-T suppression:</strong> near room temperature, the normalized value is extremely small for eV-scale <span style="font-family:var(--mono);">E_i</span>.</li>
          <li><strong>Engineering implication:</strong> modest increases in <span style="font-family:var(--mono);">T</span> can change defect populations by orders of magnitude.</li>
        </ul>

        <a class="backTop" href="#top">Back to top ↑</a>
      </section>
    </article>
  </main>

  <footer>
    <p>
      Print tip: use your browser’s print dialog for a clean, high-contrast version (the sticky TOC and buttons are hidden in print).
    </p>
  </footer>

  <script>
    // Smooth scrolling for in-page anchors
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', (e) => {
        const href = a.getAttribute('href');
        if (!href || href.length < 2) return;
        const target = document.querySelector(href);
        if (!target) return;
        e.preventDefault();
        target.scrollIntoView({behavior:'smooth', block:'start'});
        history.replaceState(null, '', href);
      });
    });

    // Copy buttons
    function copyText(text){
      return navigator.clipboard.writeText(text);
    }

    document.querySelectorAll('button.copy[data-copy-target]').forEach(btn => {
      btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-copy-target');
        const el = document.getElementById(id);
        if(!el) return;
        const text = el.textContent.trim();
        try{
          await copyText(text);
          const old = btn.textContent;
          btn.textContent = 'Copied ✓';
          setTimeout(()=>btn.textContent = old, 900);
        }catch(err){
          const old = btn.textContent;
          btn.textContent = 'Copy failed';
          setTimeout(()=>btn.textContent = old, 900);
        }
      });
    });

    document.querySelectorAll('button.copy[data-copy-final="true"]').forEach(btn => {
      btn.addEventListener('click', async () => {
        const key = document.getElementById('eq_final')?.textContent?.trim() || '';
        const dilute = document.getElementById('eq_final_dilute')?.textContent?.trim() || '';
        const combined =
`FINAL ANSWER (plain text)

1) Exact equilibrium condition:
${key}

2) Dilute limit (n << N, N'):
${dilute}`;
        try{
          await copyText(combined.trim());
          const old = btn.textContent;
          btn.textContent = 'Copied ✓';
          setTimeout(()=>btn.textContent = old, 900);
        }catch(err){
          const old = btn.textContent;
          btn.textContent = 'Copy failed';
          setTimeout(()=>btn.textContent = old, 900);
        }
      });
    });

    // Canvas plot: normalized n/sqrt(NN') = exp(-Ei/(2 kB T))
    const canvas = document.getElementById('plot');
    const ctx = canvas.getContext('2d');

    function drawPlot(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);

      const w = rect.width, h = rect.height;

      // Background
      ctx.clearRect(0,0,w,h);
      // subtle panel
      ctx.fillStyle = 'rgba(255,255,255,0.02)';
      ctx.fillRect(0,0,w,h);

      // Margins
      const m = {l:54, r:18, t:34, b:44};
      const pw = w - m.l - m.r;
      const ph = h - m.t - m.b;

      // Example parameters
      const kB = 1.380649e-23;          // J/K
      const eV = 1.602176634e-19;       // J
      const Ei = 1.6 * eV;              // example: 1.6 eV

      const Tmin = 300, Tmax = 1400;
      // y range: compute endpoints and pad
      const yAt = T => Math.exp(-Ei/(2*kB*T));
      const yMin = yAt(Tmin);
      const yMax = yAt(Tmax);

      // For visibility, use log scale on y? Problem didn't require; keep linear but it's tiny.
      // We'll plot y on a log10 axis for readability while still representing the key relationship.
      // Axis label will indicate log10.
      const log10 = x => Math.log(x)/Math.log(10);
      const Ymin = log10(yMin);
      const Ymax = log10(yMax);

      const xToPx = T => m.l + (T - Tmin) / (Tmax - Tmin) * pw;
      const yToPx = Y => m.t + (Ymax - Y) / (Ymax - Ymin) * ph;

      // Gridlines and axes
      ctx.lineWidth = 1;

      // grid style
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      ctx.fillStyle = 'rgba(255,255,255,0.70)';
      ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';

      // X ticks
      const xTicks = [300, 500, 700, 900, 1100, 1300, 1400];
      xTicks.forEach(T => {
        const x = xToPx(T);
        ctx.beginPath();
        ctx.moveTo(x, m.t);
        ctx.lineTo(x, m.t + ph);
        ctx.stroke();
        // tick label
        ctx.fillStyle = 'rgba(182,194,214,0.95)';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText(String(T), x, m.t + ph + 8);
      });

      // Y ticks in log10 space (integer ticks)
      const yTickMin = Math.floor(Ymin);
      const yTickMax = Math.ceil(Ymax);
      for(let Y = yTickMin; Y <= yTickMax; Y++){
        const y = yToPx(Y);
        ctx.strokeStyle = 'rgba(255,255,255,0.10)';
        ctx.beginPath();
        ctx.moveTo(m.l, y);
        ctx.lineTo(m.l + pw, y);
        ctx.stroke();

        ctx.fillStyle = 'rgba(182,194,214,0.95)';
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(`10^${Y}`, m.l - 10, y);
      }

      // Axes lines
      ctx.strokeStyle = 'rgba(255,255,255,0.28)';
      ctx.beginPath();
      ctx.moveTo(m.l, m.t);
      ctx.lineTo(m.l, m.t + ph);
      ctx.lineTo(m.l + pw, m.t + ph);
      ctx.stroke();

      // Title
      ctx.fillStyle = 'rgba(232,238,247,0.95)';
      ctx.font = '13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'bottom';
      ctx.fillText('Example: normalized Frenkel defects vs temperature (dilute limit)', m.l, m.t - 10);

      // Axis labels
      ctx.fillStyle = 'rgba(182,194,214,0.95)';
      ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText('Temperature T (K)', m.l + pw/2, m.t + ph + 26);

      // y label rotated
      ctx.save();
      ctx.translate(16, m.t + ph/2);
      ctx.rotate(-Math.PI/2);
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText('Normalized concentration  n/√(NN\')  (log scale)', 0, 0);
      ctx.restore();

      // Plot curve
      ctx.strokeStyle = 'rgba(106,209,255,0.95)';
      ctx.lineWidth = 2;

      ctx.beginPath();
      const N = 240;
      for(let i=0; i<=N; i++){
        const T = Tmin + (Tmax - Tmin) * (i/N);
        const y = log10(yAt(T));
        const xpx = xToPx(T);
        const ypx = yToPx(y);
        if(i===0) ctx.moveTo(xpx, ypx);
        else ctx.lineTo(xpx, ypx);
      }
      ctx.stroke();

      // Legend
      const lx = m.l + 10, ly = m.t + 10;
      ctx.fillStyle = 'rgba(0,0,0,0.22)';
      ctx.strokeStyle = 'rgba(255,255,255,0.12)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.roundRect(lx, ly, 260, 42, 10);
      ctx.fill();
      ctx.stroke();

      ctx.strokeStyle = 'rgba(106,209,255,0.95)';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(lx + 12, ly + 18);
      ctx.lineTo(lx + 46, ly + 18);
      ctx.stroke();

      ctx.fillStyle = 'rgba(232,238,247,0.92)';
      ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';
      ctx.fillText('n/√(NN\') ≈ exp(−E_i/(2k_B T))', lx + 54, ly + 18);
      ctx.fillStyle = 'rgba(182,194,214,0.92)';
      ctx.fillText('Example E_i = 1.6 eV', lx + 54, ly + 34);
    }

    // RoundRect polyfill for older browsers
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        const rr = Math.min(r, w/2, h/2);
        this.beginPath();
        this.moveTo(x + rr, y);
        this.arcTo(x + w, y, x + w, y + h, rr);
        this.arcTo(x + w, y + h, x, y + h, rr);
        this.arcTo(x, y + h, x, y, rr);
        this.arcTo(x, y, x + w, y, rr);
        this.closePath();
        return this;
      };
    }

    window.addEventListener('resize', drawPlot, {passive:true});
    drawPlot();
  </script>
</body>
</html>