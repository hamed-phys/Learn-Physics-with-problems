<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>k·p Perturbation Theory at a Band Edge: Dispersion and Effective Mass (Nondegenerate, Cubic Crystal)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1622;
      --card:#101a2a;
      --text:#e9eef7;
      --muted:#b7c3d6;
      --faint:#7f8aa3;
      --accent:#7dd3fc;
      --accent2:#a7f3d0;
      --warn:#fbbf24;
      --danger:#fb7185;
      --ok:#34d399;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --max: 1120px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 5%, rgba(125,211,252,.10), transparent 60%),
        radial-gradient(900px 650px at 85% 20%, rgba(167,243,208,.08), transparent 55%),
        radial-gradient(900px 700px at 50% 95%, rgba(251,191,36,.06), transparent 60%),
        linear-gradient(180deg, var(--bg), #070b10 70%);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre{font-family:var(--mono)}
    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding: 22px 18px 80px;
    }

    header.hero{
      background: linear-gradient(180deg, rgba(125,211,252,.10), rgba(167,243,208,.06));
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px 18px 14px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    header.hero:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 260px at 20% 10%, rgba(125,211,252,.18), transparent 60%),
                  radial-gradient(520px 260px at 85% 25%, rgba(167,243,208,.14), transparent 58%);
      pointer-events:none;
      filter: blur(0px);
      opacity:.9;
    }
    header.hero > *{position:relative}
    .title{
      display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap;
      justify-content:space-between;
    }
    .title h1{
      margin:0;
      font-size: clamp(20px, 2.3vw, 30px);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      max-width: 80ch;
    }

    .layout{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 18px;
      margin-top:18px;
      align-items:start;
    }
    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
    }

    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      border:1px solid var(--border);
      background: rgba(16,26,42,.72);
      backdrop-filter: blur(10px);
      border-radius:16px;
      padding: 14px 12px;
      box-shadow: var(--shadow);
    }
    nav.toc h2{
      margin:0 0 10px;
      font-size:14px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.12em;
    }
    nav.toc a{
      display:block;
      padding:8px 10px;
      border-radius:10px;
      color:var(--text);
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size: 14px;
    }
    nav.toc a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
      transform: translateX(2px);
      text-decoration:none;
    }
    .toc small{color:var(--faint); display:block; margin-top:10px; line-height:1.4}

    main{
      min-width:0;
    }

    section{
      border:1px solid var(--border);
      background: rgba(15,22,34,.68);
      backdrop-filter: blur(8px);
      border-radius:18px;
      padding: 18px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
    }
    section h2{
      margin:0 0 10px;
      font-size: 18px;
      letter-spacing:.2px;
    }
    section h3{
      margin:14px 0 8px;
      font-size: 15.5px;
      color: var(--accent2);
    }
    .muted{color:var(--muted)}
    .faint{color:var(--faint)}
    ul{margin: 10px 0 0 20px}
    li{margin: 6px 0}
    hr.sep{
      border:0; height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent);
      margin: 14px 0;
    }

    .grid2{
      display:grid; gap:12px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 860px){ .grid2{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--border);
      background: rgba(16,26,42,.80);
      border-radius:16px;
      padding: 12px 12px;
    }

    .callout{
      border-left: 4px solid rgba(125,211,252,.8);
      background: rgba(125,211,252,.08);
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(125,211,252,.22);
    }
    .callout.warn{
      border-left-color: rgba(251,191,36,.95);
      background: rgba(251,191,36,.08);
      border-color: rgba(251,191,36,.22);
    }
    .callout.danger{
      border-left-color: rgba(251,113,133,.95);
      background: rgba(251,113,133,.08);
      border-color: rgba(251,113,133,.22);
    }
    .callout.ok{
      border-left-color: rgba(52,211,153,.95);
      background: rgba(52,211,153,.08);
      border-color: rgba(52,211,153,.22);
    }
    .callout h4{
      margin:0 0 6px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: .10em;
      color: var(--muted);
    }

    .eqbox{
      border:1px solid rgba(167,243,208,.22);
      background: rgba(167,243,208,.07);
      border-radius: 14px;
      padding: 12px;
      overflow:auto;
    }
    .eqrow{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap;
    }
    .eqbox pre{
      margin:0;
      font-size: 13px;
      line-height:1.45;
      white-space: pre-wrap;
      word-break: break-word;
      flex: 1 1 520px;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size: 13px;
      user-select:none;
      flex: 0 0 auto;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.28);
    }
    .btn:active{transform: translateY(0px)}
    .btn.small{padding:6px 8px; border-radius:10px; font-size:12px}

    details{
      border:1px solid var(--border);
      background: rgba(16,26,42,.55);
      border-radius: 14px;
      padding: 10px 10px;
      margin-top: 10px;
    }
    summary{
      cursor:pointer;
      color: var(--text);
      font-weight:600;
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    details[open]{box-shadow: 0 10px 30px rgba(0,0,0,.22)}
    .backtop{
      display:inline-block;
      margin-top:10px;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      transition: transform .12s ease, background .12s ease;
    }
    .backtop:hover{transform: translateY(-1px); background: rgba(125,211,252,.10); text-decoration:none}

    figure{
      margin: 12px 0 0;
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      background: rgba(16,26,42,.70);
      overflow:hidden;
    }
    figcaption{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
    }
    canvas{
      width: 100%;
      height: 320px;
      display:block;
      border-radius: 12px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
    }

    footer{
      margin-top: 18px;
      color: var(--faint);
      font-size: 13px;
      text-align:center;
    }

    @media print{
      body{background:#fff; color:#000}
      header.hero, section, nav.toc, figure{box-shadow:none; backdrop-filter:none}
      header.hero, section, nav.toc, figure{
        background:#fff; border:1px solid #bbb;
      }
      nav.toc{position:relative; top:auto}
      a{color:#000; text-decoration:underline}
      .btn{display:none !important}
      .layout{grid-template-columns:1fr}
      .callout, .eqbox{border-color:#aaa}
      section{break-inside:avoid; page-break-inside:avoid}
      h2{break-after:avoid}
    }
  </style>
</head>

<body>
  <div class="wrap" id="top">
    <header class="hero">
      <div class="title">
        <div>
          <h1>Band-edge structure from k·p perturbation theory (nondegenerate Γ-point, cubic crystal)</h1>
          <p class="subtitle">
            We derive the near-edge dispersion ε<sub>n</sub>(k) and the effective mass m* using second-order perturbation theory
            applied to the Bloch Hamiltonian expanded around k = 0 (Γ point), then specialize to cubic symmetry and the
            conduction-band edge dominated by valence-band coupling.
          </p>
        </div>
        <div class="card" style="min-width:260px">
          <div class="muted" style="font-size:13px; text-transform:uppercase; letter-spacing:.12em;">Quick Tools</div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn" id="copyFinal">Copy Final Answer (plain text)</button>
            <a class="btn" href="#part3" style="display:inline-block;">Jump to Full Solution</a>
          </div>
          <div class="faint" style="margin-top:10px; font-size:12.5px;">
            Tip: Use the “Copy equation” buttons next to key formulas.
          </div>
        </div>
      </div>
    </header>

    <div class="layout">
      <nav class="toc" aria-label="Table of contents">
        <h2>Table of Contents</h2>
        <a href="#qs">Quick Summary</a>
        <a href="#part0">PART 0 — Concept Primer</a>
        <a href="#part0b">PART 0B — Industry & Applied Physics</a>
        <a href="#part1">PART 1 — Problem Analysis</a>
        <a href="#part2">PART 2 — Strategy & Tips</a>
        <a href="#part3">PART 3 — Full Solution</a>
        <a href="#part4">PART 4 — Deeper Understanding</a>
        <a href="#part5">PART 5 — Optional Plot Guide</a>
        <small>
          Sticky TOC • Print-friendly • No external libraries • One static canvas plot
        </small>
      </nav>

      <main>
        <section id="qs">
          <h2>Quick Summary</h2>
          <ul>
            <li><b>What this problem is about:</b> Use <b>k·p perturbation theory</b> to obtain the band-edge dispersion ε<sub>n</sub>(k) near k = 0 and the <b>effective mass</b> m*.</li>
            <li><b>Key physics idea:</b> Expand the Bloch Hamiltonian as <span class="muted">(p + ħk)</span><sup>2</sup>/2m, treat the <b>linear k·p term</b> as a perturbation, and keep <b>second-order</b> corrections.</li>
            <li><b>Governing eigenproblem:</b> Solve an <b>eigenvalue problem</b> on a unit cell with periodic boundary conditions:
              H(k)u<sub>n,k</sub>(r) = ε<sub>n</sub>(k)u<sub>n,k</sub>(r).</li>
            <li><b>Main result type:</b> <b>Symbolic</b> formulas for ε<sub>n</sub>(k) and m* in terms of momentum matrix elements ⟨n0|p|j0⟩ and energy separations.</li>
            <li><b>Dispersion near the edge:</b> A parabolic term ħ²k²/(2m) plus a second-order coupling correction ∝ Σ |⟨n0|k·p|j0⟩|²/(ε<sub>n</sub>(0) − ε<sub>j</sub>(0)).</li>
            <li><b>Effective mass:</b> In cubic crystals at Γ, the curvature is isotropic, giving a scalar m* related to ⟨p<sub>x</sub>⟩ couplings.</li>
            <li><b>Physical meaning:</b> <b>Smaller gaps</b> (closer bands) generally give <b>lighter masses</b> (larger curvature) if matrix elements are not tiny.</li>
            <li><b>Engineering consequence:</b> m* controls carrier mobility, density of states, quantum confinement energies, and device speed/power trade-offs.</li>
          </ul>
        </section>

        <section id="part0">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

          <div class="grid2">
            <div class="card">
              <h3>Core definitions (symbols + SI units)</h3>
              <ul>
                <li><b>r</b> (m): position in real space; unit cell region Ω with periodicity of the lattice.</li>
                <li><b>k</b> (m<sup>−1</sup>): crystal wavevector (reciprocal space); we expand around k = 0 (Γ point).</li>
                <li><b>ψ<sub>n,k</sub>(r)</b>: Bloch state, ψ<sub>n,k</sub>(r) = e<sup>i k·r</sup> u<sub>n,k</sub>(r), where u is lattice-periodic.</li>
                <li><b>p</b> (kg·m/s): momentum operator p = −iħ∇ (operator notation: ∇ is the gradient).</li>
                <li><b>H</b> (J): single-electron crystal Hamiltonian (no fields):
                  H = p²/(2m) + V(r), with V periodic: V(r + R) = V(r).</li>
                <li><b>ε<sub>n</sub>(k)</b> (J or eV): band energy (eigenvalue).</li>
                <li><b>m</b> (kg): free electron mass; <b>m*</b> (kg): effective mass near the band edge.</li>
              </ul>
            </div>

            <div class="card">
              <h3>Physical meaning (intuition)</h3>
              <ul>
                <li><b>k·p theory</b> links how bands curve in k-space to how strongly a state couples to nearby bands via the momentum operator.</li>
                <li>The <b>effective mass</b> is the inverse curvature of ε(k) near the extremum:
                  a large curvature means a <b>small m*</b> (carriers accelerate easily).</li>
                <li>The <b>energy gap</b> (energy separation to other bands) appears in denominators; smaller separation means stronger mixing and larger curvature changes.</li>
              </ul>
            </div>
          </div>

          <hr class="sep"/>

          <h3>Mathematical model (variables, domain, boundary conditions)</h3>
          <div class="callout">
            <h4>Model statement</h4>
            <p class="muted" style="margin:0">
              Consider a periodic crystal potential V(r) defined on ℝ³ with lattice vectors R.
              The Bloch eigenproblem can be written for the periodic part u<sub>n,k</sub>(r) on a unit cell Ω:
            </p>
            <div class="eqbox" style="margin-top:10px">
              <div class="eqrow">
                <pre id="eq_model">
H(k) u_{n,k}(r) = ε_n(k) u_{n,k}(r),
H(k) = (1/2m) (p + ħk)^2 + V(r),
p = -iħ∇,
u_{n,k}(r + R) = u_{n,k}(r)  (periodic boundary conditions on Ω).</pre>
                <button class="btn" data-copy="#eq_model">Copy equation</button>
              </div>
            </div>
            <p class="faint" style="margin:10px 0 0">
              This is an <b>eigenvalue problem</b> (operator equation) on a periodic domain; the spectrum ε<sub>n</sub>(k) forms energy bands.
            </p>
          </div>

          <h3>Key laws/principles and validity conditions</h3>
          <ul>
            <li><b>Linearity:</b> Quantum mechanics uses linear operators; perturbation theory applies to linear eigenproblems.</li>
            <li><b>k expansion validity:</b> Small k near Γ so that band mixing remains perturbative (energy separations not too small relative to coupling).</li>
            <li><b>Nondegenerate assumption:</b> Band n at k=0 is nondegenerate, so standard nondegenerate perturbation theory applies.</li>
            <li><b>Cubic symmetry:</b> Ensures isotropy at Γ (effective mass becomes a scalar rather than a tensor in the simplest case).</li>
          </ul>

          <h3>Common approximations in this topic (and why)</h3>
          <ul>
            <li><b>Effective mass approximation:</b> Keep only quadratic terms in k: ε ≈ ε(0) + ħ²k²/(2m*) near an extremum. Used because it yields simple transport and confinement models.</li>
            <li><b>Two-/few-band dominance:</b> Often only the closest bands dominate the second-order sum due to energy denominators.</li>
            <li><b>Symmetry simplifications:</b> At Γ, parity/time-reversal/cubic symmetry often makes ⟨n0|p|n0⟩ = 0 and reduces tensor structure.</li>
          </ul>

          <h3>Mini intuition examples (minimal algebra)</h3>
          <ul>
            <li><b>Free electron:</b> V=0 → ε = ħ²k²/(2m), so m* = m.</li>
            <li><b>Strong coupling to nearby band:</b> If a nearby band lies only energy Δ away, the correction ~ |p|²/Δ can be large → m* can be much smaller (or larger depending on sign of Δ).</li>
            <li><b>Large band gap:</b> If Δ is large, coupling is weak → m* stays close to m.</li>
          </ul>

          <div class="callout warn" style="margin-top:12px">
            <h4>What to watch for (pitfalls)</h4>
            <ul style="margin:0 0 0 18px">
              <li><b>Degeneracy:</b> If the band edge is degenerate, you must use <b>degenerate</b> perturbation theory (matrix problem), not the scalar formula derived here.</li>
              <li><b>Sign of denominators:</b> For conduction band vs valence bands, ε<sub>c</sub>−ε<sub>v</sub> &gt; 0, so contributions typically <b>increase</b> m/m* (reduce m*).</li>
              <li><b>Tensor vs scalar:</b> Without cubic symmetry (or at non-Γ points), m* is generally a <b>tensor</b>.</li>
              <li><b>Gauge/phase of Bloch states:</b> Matrix elements depend on consistent phase conventions; physical results remain gauge-invariant when done correctly.</li>
            </ul>
          </div>

          <div class="callout ok" style="margin-top:12px">
            <h4>Math Insight</h4>
            <p class="muted" style="margin:0">
              The core object is an operator-valued <b>quadratic form</b> in k:
              H(k) = H(0) + (ħ/m) k·p + ħ²k²/(2m).
              Near k=0, the band energy is obtained by <b>Rayleigh–Schrödinger perturbation theory</b> for a linear self-adjoint eigenproblem.
              The effective mass is the <b>Hessian</b> (second derivative) of ε<sub>n</sub>(k) at k=0: a local quadratic approximation (dispersion relation).
            </p>
          </div>
        </section>

        <section id="part0b">
          <h2>PART 0B — Industry & Applied Physics Perspective</h2>

          <h3>Where this appears in industry (concrete application areas)</h3>
          <ul>
            <li><b>Semiconductor device design:</b> MOSFETs, HEMTs, and FinFETs—m* affects mobility, injection velocity, and quantum capacitance.</li>
            <li><b>Optoelectronics:</b> LEDs/lasers/photodetectors—band curvature influences joint density of states, absorption edge shape, and exciton binding energies.</li>
            <li><b>Strain engineering & heterostructures:</b> SiGe, III–V stacks, and 2D materials—strain shifts band edges and changes k·p couplings, tuning m* and performance.</li>
            <li><b>Thermoelectrics:</b> Power factor depends on mobility (∝ 1/m*) and density-of-states mass; engineers exploit band engineering to optimize both.</li>
          </ul>

          <h3>Why engineers care (performance, reliability, cost)</h3>
          <ul>
            <li><b>Performance:</b> Smaller m* can boost carrier mobility and high-frequency response (f<sub>T</sub>, f<sub>max</sub>).</li>
            <li><b>Power & efficiency:</b> Band curvature influences threshold behavior, tunneling rates, and leakage in nanoscale devices.</li>
            <li><b>Manufacturability:</b> Process-induced strain, alloy fluctuations, and interface roughness modify band structure; robust designs account for m* sensitivity.</li>
            <li><b>Reliability:</b> Hot-carrier effects and impact ionization depend on band structure and effective masses (energy gain vs scattering).</li>
          </ul>

          <h3>Typical measurement/validation methods</h3>
          <ul>
            <li><b>Cyclotron resonance</b> and <b>Shubnikov–de Haas</b> oscillations: directly probe effective masses.</li>
            <li><b>Angle-resolved photoemission (ARPES)</b>: measures dispersion ε(k) (especially in metals/2D materials).</li>
            <li><b>Optical spectroscopy</b> (absorption edge, excitons): constrains band parameters used in k·p models.</li>
            <li><b>DFT + k·p fitting</b>: industry often fits compact k·p parameters to first-principles band structures for device simulation.</li>
          </ul>

          <h3>Design trade-offs & constraints</h3>
          <div class="grid2">
            <div class="callout">
              <h4>Trade-off examples</h4>
              <ul style="margin:0 0 0 18px">
                <li><b>Mobility vs density of states:</b> Light transport mass helps mobility, but heavier DOS mass can increase carrier concentration—designs balance both.</li>
                <li><b>Small gap vs leakage:</b> Smaller E<sub>g</sub> can give lighter m* (good for speed) but increases leakage/tunneling (bad for power).</li>
                <li><b>Strain benefits vs variability:</b> Strain can improve m* but introduces process variability and reliability risks.</li>
              </ul>
            </div>
            <div class="callout ok">
              <h4>From lab to product</h4>
              <p class="muted" style="margin:0">
                Real device models extend the ideal k·p picture by including strain, confinement, nonparabolicity,
                scattering, and band anisotropy. In compact models, the k·p-derived m* becomes an <b>effective parameter</b>
                calibrated against measurements and multi-physics simulations.
              </p>
            </div>
          </div>
        </section>

        <section id="part1">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

          <h3>Problem restatement (in plain words)</h3>
          <p class="muted">
            We consider a <b>nondegenerate</b> band-edge state at k = 0 (Γ) in a <b>cubic</b> crystal.
            Using <b>second-order perturbation theory</b> in k·p theory, derive:
            (i) the near-Γ dispersion ε<sub>n</sub>(k) to order k²,
            (ii) the corresponding effective mass expression at Γ,
            and (iii) a simplified formula for the conduction-band effective mass in a narrow-gap semiconductor dominated by valence-band coupling.
          </p>

          <div class="grid2">
            <div class="card">
              <h3>Given</h3>
              <ul>
                <li>Periodic potential V(r); Bloch theory holds.</li>
                <li>A nondegenerate orbital (band) n at k = 0 with energy ε<sub>n</sub>(0).</li>
                <li>Cubic symmetry at the band edge (isotropy).</li>
              </ul>
            </div>
            <div class="card">
              <h3>Unknowns / Targets</h3>
              <ul>
                <li>ε<sub>n</sub>(k) to O(k²) in terms of momentum matrix elements.</li>
                <li>Effective mass m* at k=0 (curvature).</li>
                <li>Conduction-band approximation in terms of band gap E<sub>g</sub> and valence states v.</li>
              </ul>
            </div>
          </div>

          <h3>Relevant principles (and why they apply)</h3>
          <ul>
            <li><b>Bloch eigenproblem:</b> Periodic potential → eigenstates labeled by k and band index n.</li>
            <li><b>Operator expansion:</b> H(k) = (p + ħk)²/(2m) + V allows a controlled small-k expansion.</li>
            <li><b>Rayleigh–Schrödinger perturbation theory:</b> Nondegenerate eigenvalue at k=0 → standard second-order formula applies.</li>
            <li><b>Symmetry arguments:</b> At Γ in a time-reversal + inversion-symmetric situation (typical), ⟨n0|p|n0⟩ = 0; cubic symmetry gives isotropic mass.</li>
          </ul>

          <div class="callout warn">
            <h4>Assumptions stated explicitly</h4>
            <ul style="margin:0 0 0 18px">
              <li><b>Nondegenerate</b> band at k=0 (no near-degeneracy requiring matrix perturbation theory).</li>
              <li><b>Small k</b>: truncate at O(k²); neglect O(k³) and higher (nonparabolicity).</li>
              <li><b>No external fields</b> (no A(r), no Zeeman, no spin-orbit unless implicitly in bands).</li>
              <li><b>Cubic symmetry</b> near Γ → scalar effective mass (otherwise tensor).</li>
            </ul>
          </div>

          <h3>Possible approaches (compare 2–3)</h3>
          <div class="grid2">
            <div class="card">
              <h3>Approach A: Expand H(k) and apply perturbation theory (best here)</h3>
              <ul>
                <li><b>Pros:</b> Direct, systematic, yields the requested sums over bands.</li>
                <li><b>Cons:</b> Requires careful symmetry/normalization handling.</li>
                <li><b>Best when:</b> You want explicit matrix-element formulas (this problem).</li>
              </ul>
            </div>
            <div class="card">
              <h3>Approach B: Use effective Hamiltonian / Löwdin partitioning</h3>
              <ul>
                <li><b>Pros:</b> Natural for reducing to few-band models; connects to Kane model.</li>
                <li><b>Cons:</b> More formal machinery than needed for this prompt.</li>
                <li><b>Best when:</b> Degeneracy or multi-band coupling dominates.</li>
              </ul>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            We choose <b>Approach A</b> because the problem explicitly asks for the second-order perturbation result and its effective-mass consequence.
          </p>
        </section>

        <section id="part2">
          <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

          <ol style="margin: 10px 0 0 22px">
            <li><b>Write the Bloch Hamiltonian H(k)</b> for the periodic part u<sub>n,k</sub>:
              use p = −iħ∇ and H(k) = (p + ħk)²/(2m) + V(r).</li>
            <li><b>Expand H(k) around k=0</b>:
              identify the unperturbed operator H(0) and perturbation W(k) containing k·p and k².</li>
            <li><b>Apply nondegenerate perturbation theory</b> to the eigenvalue ε<sub>n</sub>(k):
              first-order in W, then second-order from the k·p term.</li>
            <li><b>Use symmetry</b> to justify ⟨n0|p|n0⟩ = 0 at Γ (so no linear-in-k energy term).</li>
            <li><b>Collect all O(k²) contributions</b> to get ε<sub>n</sub>(k) to quadratic order.</li>
            <li><b>Define effective mass</b> via curvature: 1/m* = (1/ħ²) ∂²ε/∂k<sub>x</sub>² at k=0 (cubic → isotropic).</li>
            <li><b>Specialize to conduction band</b> and approximate denominators by E<sub>g</sub>, summing over valence bands to obtain the narrow-gap expression.</li>
            <li><b>Sanity checks</b>: dimensions, limiting cases (large gap, free electron), and sign of denominators.</li>
          </ol>

          <div class="callout danger" style="margin-top:12px">
            <h4>Common mistakes</h4>
            <ul style="margin:0 0 0 18px">
              <li>Forgetting that the <b>k² term</b> in H(k) contributes already at <b>first order</b>.</li>
              <li>Using the scalar effective mass formula in <b>non-cubic</b> or <b>anisotropic</b> cases (should be a tensor).</li>
              <li>Applying nondegenerate perturbation theory when the band edge is <b>degenerate</b> (must diagonalize within the degenerate subspace).</li>
              <li>Dropping symmetry too casually: ⟨p⟩=0 is typical at Γ but depends on the state’s symmetry and chosen gauge; justify it.</li>
            </ul>
          </div>
        </section>

        <section id="part3">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

          <h3>Physical intuition first: what should ε(k) look like near a band edge?</h3>
          <p class="muted">
            At an extremum (like Γ for many band edges), the dispersion is typically <b>parabolic</b>:
            ε(k) ≈ ε(0) + (ħ²/2m*)k² for small k. The question is how <b>m*</b> differs from the free-electron mass m.
            k·p theory says: <b>mixing</b> with nearby bands through momentum matrix elements changes the curvature.
            Closer bands (small energy denominators) usually produce <b>stronger curvature changes</b>.
          </p>

          <hr class="sep"/>

          <h3>Step 1: Start from the Bloch Hamiltonian and expand around k = 0</h3>
          <p class="muted">
            Write ψ<sub>n,k</sub>(r) = e<sup>i k·r</sup> u<sub>n,k</sub>(r), where u<sub>n,k</sub>(r) is periodic on the unit cell.
            Substituting into the Schrödinger equation gives the eigenproblem for u<sub>n,k</sub>:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_Hk">
H(k) u_{n,k}(r) = ε_n(k) u_{n,k}(r),
H(k) = (1/2m) (p + ħk)^2 + V(r),
p = -iħ∇.</pre>
              <button class="btn" data-copy="#eq_Hk">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            Now expand the operator (p + ħk)²:
            (p + ħk)² = p² + 2ħ k·p + ħ² k².
            This is valid because k is just a parameter (a constant vector), while p is a linear differential operator;
            the cross term is exactly 2ħ k·p.
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_expand">
H(k) = H(0) + W(k),
H(0) = p^2/(2m) + V(r),
W(k) = (ħ/m) k·p + (ħ^2 k^2)/(2m).</pre>
              <button class="btn" data-copy="#eq_expand">Copy equation</button>
            </div>
          </div>

          <div class="callout">
            <h4>Why this step is mathematically valid</h4>
            <p class="muted" style="margin:0">
              We are expanding an operator polynomial in (p + ħk). Because k is a constant parameter and p is linear,
              the expansion is exact. The perturbation W(k) is small when k is small, enabling a controlled series in k.
            </p>
          </div>

          <hr class="sep"/>

          <h3>Step 2: Apply nondegenerate perturbation theory to ε<sub>n</sub>(k)</h3>
          <p class="muted">
            Let |n0⟩ denote the normalized eigenstate u<sub>n,0</sub> of H(0) with eigenvalue ε<sub>n</sub>(0):
            H(0)|n0⟩ = ε<sub>n</sub>(0)|n0⟩.
            The standard Rayleigh–Schrödinger expansion for a nondegenerate level gives:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_PT_general">
ε_n(k) = ε_n(0)
       + ⟨n0|W(k)|n0⟩
       + Σ_{j≠n} |⟨j0|W(k)|n0⟩|^2 / (ε_n(0) - ε_j(0))
       + O(W^3).</pre>
              <button class="btn" data-copy="#eq_PT_general">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            Because we only want terms up to O(k²):
          </p>
          <ul>
            <li class="muted">
              The piece (ħ²k²)/(2m) in W is already O(k²), so it contributes via the <b>first-order</b> expectation value.
            </li>
            <li class="muted">
              The k·p term is O(k), so it contributes to O(k²) through the <b>second-order</b> sum (square of an O(k) matrix element).
            </li>
            <li class="muted">
              Cross terms involving (k·p) with (k²) would be O(k³), so they are neglected at this order.
            </li>
          </ul>

          <hr class="sep"/>

          <h3>Step 3: Evaluate the first-order correction ⟨n0|W(k)|n0⟩</h3>
          <p class="muted">
            Using W(k) = (ħ/m)k·p + ħ²k²/(2m):
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_first_order">
⟨n0|W(k)|n0⟩ = (ħ/m) k·⟨n0|p|n0⟩ + (ħ^2 k^2)/(2m).</pre>
              <button class="btn" data-copy="#eq_first_order">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            At k=0 in many crystals (especially with time-reversal symmetry and typical Γ-point choices),
            the expectation value of momentum in a stationary Bloch state vanishes:
            ⟨n0|p|n0⟩ = 0.
            Intuitively, there is no preferred direction at Γ for a nondegenerate state in a cubic crystal.
          </p>

          <details>
            <summary>Deeper note: why ⟨n0|p|n0⟩ often vanishes at Γ</summary>
            <p class="muted">
              Momentum p is odd under spatial inversion (r → −r) and changes sign under time reversal.
              At Γ, Bloch states can be chosen with definite symmetry; for nondegenerate states in centrosymmetric lattices,
              the integrand in ⟨p⟩ is often odd and integrates to zero over the unit cell.
              Even without inversion, time-reversal symmetry at k=0 constrains expectation values.
              (If symmetries are broken, linear-in-k terms can appear, but that is outside the standard “band edge at Γ” setting here.)
            </p>
          </details>

          <p class="muted" style="margin-top:10px">
            Therefore, to O(k²),
            the first-order energy shift is simply ħ²k²/(2m).
          </p>

          <hr class="sep"/>

          <h3>Step 4: Evaluate the second-order correction from the k·p term</h3>
          <p class="muted">
            In the second-order sum, keep only the k·p part of W because it is O(k) and yields O(k²) when squared:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_second_order">
⟨j0|W(k)|n0⟩ ≈ (ħ/m) ⟨j0|k·p|n0⟩  (to first order in k),
so

Σ_{j≠n} |⟨j0|W(k)|n0⟩|^2/(ε_n(0)-ε_j(0))
= (ħ^2/m^2) Σ_{j≠n} |⟨j0|k·p|n0⟩|^2 / (ε_n(0)-ε_j(0)).</pre>
              <button class="btn" data-copy="#eq_second_order">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            Since |⟨j0|k·p|n0⟩|² = |⟨n0|k·p|j0⟩|² (Hermitian conjugation),
            we can write the numerator in the common form used in textbooks.
          </p>

          <hr class="sep"/>

          <h3>Step 5: Combine terms to obtain ε<sub>n</sub>(k) to O(k²)</h3>
          <p class="muted">
            Collecting ε<sub>n</sub>(0), the first-order ħ²k²/(2m), and the second-order k·p contribution yields:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_39">
ε_n(k) = ε_n(0)
       + (ħ^2 k^2)/(2m)
       + (ħ^2/m^2) Σ_{j≠n}  |⟨n0|k·p|j0⟩|^2 / (ε_n(0) - ε_j(0))
       + O(k^3).</pre>
              <button class="btn" data-copy="#eq_39">Copy equation</button>
            </div>
          </div>

          <div class="callout ok" style="margin-top:12px">
            <h4>Key equation (band-edge dispersion)</h4>
            <p class="muted" style="margin:0">
              This is the requested second-order k·p result (often labeled as Eq. 39): a free-electron-like term plus
              a band-mixing correction weighted by momentum matrix elements and inverse energy separations.
            </p>
          </div>

          <hr class="sep"/>

          <h3>Step 6: Extract the effective mass at k = 0 (cubic crystal)</h3>
          <p class="muted">
            In general, the effective mass is a tensor:
            (1/m* )<sub>αβ</sub> = (1/ħ²) ∂²ε/∂k<sub>α</sub>∂k<sub>β</sub> at k=0.
            For a <b>cubic</b> crystal at Γ, symmetry makes this isotropic:
            m* is a scalar and we can compute curvature along x.
          </p>

          <p class="muted">
            Set k = (k<sub>x</sub>, 0, 0). Then k·p = k<sub>x</sub> p<sub>x</sub>, so Eq. (39) becomes:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_kx">
ε_n(k_x) = ε_n(0)
         + (ħ^2 k_x^2)/(2m)
         + (ħ^2/m^2) Σ_{j≠n} |⟨n0|p_x|j0⟩|^2 k_x^2 / (ε_n(0) - ε_j(0))
         + O(k_x^3).</pre>
              <button class="btn" data-copy="#eq_kx">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            Group the k<sub>x</sub>² coefficient and match it to the definition
            ε ≈ ε(0) + ħ²k<sub>x</sub>²/(2m*):
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_match">
Coefficient of k_x^2:

ħ^2/(2m*) = ħ^2/(2m) + (ħ^2/m^2) Σ_{j≠n} |⟨n0|p_x|j0⟩|^2 / (ε_n(0)-ε_j(0)).</pre>
              <button class="btn" data-copy="#eq_match">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            Divide both sides by ħ²/2 to obtain:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_1overmstar">
1/m* = 1/m + (2/m^2) Σ_{j≠n} |⟨n0|p_x|j0⟩|^2 / (ε_n(0)-ε_j(0)).</pre>
              <button class="btn" data-copy="#eq_1overmstar">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            Multiply by m to get the commonly quoted form:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_40">
m/m* = 1 + (2/m) Σ_{j≠n} |⟨n0|p_x|j0⟩|^2 / (ε_n(0) - ε_j(0)).</pre>
              <button class="btn" data-copy="#eq_40">Copy equation</button>
            </div>
          </div>

          <div class="callout">
            <h4>Dimension check (sanity)</h4>
            <p class="muted" style="margin:0">
              |⟨p_x⟩|² has units (kg·m/s)² = kg²·m²/s².
              Divide by energy (J = kg·m²/s²) → kg.
              Multiply by (2/m) → dimensionless, consistent with m/m* being dimensionless.
            </p>
          </div>

          <hr class="sep"/>

          <h3>Step 7: Conduction-band edge dominated by valence-band coupling (narrow-gap approximation)</h3>
          <p class="muted">
            For the conduction band edge |c⟩ at Γ, the dominant nearby states are often the valence-band edge states |v⟩.
            Then the energy denominators are approximately:
            ε<sub>c</sub>(0) − ε<sub>v</sub>(0) ≈ E<sub>g</sub> (the band gap).
          </p>

          <p class="muted">
            Insert this into Eq. (40) and restrict the sum to valence bands v:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_cgap">
m/m*_c = 1 + (2/m) Σ_v |⟨c|p_x|v⟩|^2 / (ε_c(0)-ε_v(0))
      ≈ 1 + (2/(m E_g)) Σ_v |⟨c|p_x|v⟩|^2.</pre>
              <button class="btn" data-copy="#eq_cgap">Copy equation</button>
            </div>
          </div>

          <p class="muted" style="margin-top:10px">
            In many narrow-gap semiconductors, the correction term can dominate the “1” (free-electron piece),
            leading to the simplified textbook estimate:
          </p>

          <div class="eqbox">
            <div class="eqrow">
              <pre id="eq_41">
m/m*_c ≈ (2/(m E_g)) Σ_v |⟨c|p_α|v⟩|^2,</pre>
              <button class="btn" data-copy="#eq_41">Copy equation</button>
            </div>
          </div>

          <p class="faint" style="margin-top:8px">
            Here p<sub>α</sub> can be p<sub>x</sub>, p<sub>y</sub>, or p<sub>z</sub>; cubic symmetry makes the result direction-independent at Γ.
          </p>

          <div class="callout ok" style="margin-top:12px">
            <h4>Final Answer (boxed)</h4>
            <div class="eqbox" style="margin-top:10px">
              <div class="eqrow">
                <pre id="final_answer">
(1) Band-edge dispersion to O(k^2):
ε_n(k) = ε_n(0) + (ħ^2 k^2)/(2m) + (ħ^2/m^2) Σ_{j≠n} |⟨n0|k·p|j0⟩|^2 / (ε_n(0) - ε_j(0)).

(2) Effective mass at Γ in a cubic crystal (scalar m*):
m/m* = 1 + (2/m) Σ_{j≠n} |⟨n0|p_x|j0⟩|^2 / (ε_n(0) - ε_j(0))
      (equivalently 1/m* = 1/m + (2/m^2) Σ ... ).

(3) Conduction-band edge dominated by valence bands (ε_c - ε_v ≈ E_g):
m/m*_c ≈ 1 + (2/(m E_g)) Σ_v |⟨c|p_α|v⟩|^2
and often (for narrow gaps / strong coupling)  m/m*_c ≈ (2/(m E_g)) Σ_v |⟨c|p_α|v⟩|^2.</pre>
                <button class="btn" data-copy="#final_answer">Copy final answer</button>
              </div>
            </div>
          </div>

          <h3>Sanity checks and limiting cases</h3>
          <ul>
            <li class="muted"><b>Free-electron limit:</b> If V → 0 or couplings vanish, matrix elements to other bands effectively vanish → ε ≈ ħ²k²/(2m) and m* → m.</li>
            <li class="muted"><b>Large-gap limit:</b> If all (ε<sub>n</sub>−ε<sub>j</sub>) are large, the sum is small → m* close to m.</li>
            <li class="muted"><b>Narrow gap:</b> Small E<sub>g</sub> makes the correction large → m* can be much smaller than m (light electrons), consistent with many III–V semiconductors.</li>
            <li class="muted"><b>Sign reasoning:</b> For a conduction band coupled to lower valence bands, ε<sub>c</sub>−ε<sub>v</sub>&gt;0 so the correction increases m/m* → decreases m* (more curvature).</li>
          </ul>

          <a class="backtop" href="#top">Back to top ↑</a>
        </section>

        <section>
          <h2>One static plot: how m* changes curvature (example values)</h2>
          <p class="muted">
            The effective-mass approximation means near k=0 the band is parabolic:
            ε(k) − ε(0) = ħ²k²/(2m*). Smaller m* gives larger curvature (steeper rise).
            This plot uses <b>example values</b> (not part of the symbolic result) to visualize the relationship.
          </p>

          <figure>
            <canvas id="plot" aria-label="Dispersion plot: energy vs k for different effective masses"></canvas>
            <figcaption>
              Example parabolic dispersions: Δε(k)=ħ²k²/(2m*) for m* = m and m* = 0.067m (typical of GaAs electrons, shown only as an example).
              Axes: k (1/nm) and Δε (eV).
            </figcaption>
          </figure>

          <a class="backtop" href="#top">Back to top ↑</a>
        </section>

        <section id="part4">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

          <h3>Re-interpreting the formulas: what controls what?</h3>
          <ul>
            <li class="muted">
              The correction term is a <b>sum over virtual transitions</b> to other bands j:
              stronger momentum coupling |⟨n0|p|j0⟩| → larger effect.
            </li>
            <li class="muted">
              The denominator (ε<sub>n</sub>−ε<sub>j</sub>) is an <b>energy separation</b>:
              closer bands (smaller separation) produce larger curvature changes.
            </li>
            <li class="muted">
              Cubic symmetry makes the effective mass <b>isotropic</b> at Γ, so any axis gives the same curvature.
              Without cubic symmetry, replace p<sub>x</sub> with tensor components and compute (1/m*)<sub>αβ</sub>.
            </li>
          </ul>

          <h3>Parameter dependence (qualitative)</h3>
          <ul>
            <li class="muted"><b>Decrease E<sub>g</sub></b> (narrower gap) → typically <b>smaller m*</b> (faster carriers), assuming matrix elements comparable.</li>
            <li class="muted"><b>Increase |⟨c|p|v⟩|</b> (stronger interband coupling) → <b>smaller m*</b>.</li>
            <li class="muted"><b>Include more remote bands</b> → corrections can accumulate; sometimes needed for quantitative accuracy.</li>
          </ul>

          <details>
            <summary>Alternative derivation idea (brief but meaningful)</summary>
            <p class="muted">
              An alternative route is <b>Löwdin partitioning</b> (a.k.a. Schrieffer–Wolff transformation) to build an
              effective Hamiltonian within the target band subspace by integrating out remote bands.
              Expanding that effective Hamiltonian to second order in k reproduces the same |p|²/Δ structure,
              and naturally generalizes to multi-band (degenerate) band edges.
            </p>
          </details>

          <div class="callout">
            <h4>Concept checks (with answers)</h4>
            <ul style="margin:0 0 0 18px">
              <li><b>Q:</b> Why does the k·p term contribute at second order to ε(k)? <br><b>A:</b> Because it is O(k) and its first-order expectation often vanishes at Γ; squaring it in second-order perturbation gives O(k²).</li>
              <li><b>Q:</b> What happens if the band edge is degenerate? <br><b>A:</b> Use degenerate perturbation theory; ε(k) is obtained by diagonalizing a k-dependent matrix within the degenerate subspace.</li>
              <li><b>Q:</b> Why does a smaller band gap tend to produce a lighter conduction-band mass? <br><b>A:</b> The correction scales roughly like |p|²/E<sub>g</sub>; smaller E<sub>g</sub> increases curvature, decreasing m*.</li>
              <li><b>Q:</b> Is m* always scalar? <br><b>A:</b> No—generally it is a tensor. It becomes scalar at Γ only under sufficient symmetry (e.g., cubic).</li>
            </ul>
          </div>

          <a class="backtop" href="#top">Back to top ↑</a>
        </section>

        <section id="part5">
          <h2>PART 5 — Optional Plot Guide</h2>

          <h3>What the plot shows and why it’s useful</h3>
          <ul>
            <li class="muted">It visualizes Δε(k) = ħ²k²/(2m*): <b>parabolic dispersion</b> near the band edge.</li>
            <li class="muted">Comparing two m* values makes the key engineering takeaway immediate: <b>lighter mass → larger curvature</b>.</li>
          </ul>

          <h3>Axes and units</h3>
          <ul>
            <li class="muted"><b>Horizontal axis:</b> k in 1/nm (example range).</li>
            <li class="muted"><b>Vertical axis:</b> Δε in eV (energy relative to ε(0)).</li>
          </ul>

          <h3>Example values used (not part of the symbolic solution)</h3>
          <ul>
            <li class="muted">Curve A: m* = m (free-electron curvature).</li>
            <li class="muted">Curve B: m* = 0.067 m (example “light electron” mass typical of some semiconductors).</li>
          </ul>

          <h3>Features to notice</h3>
          <ul>
            <li class="muted"><b>Curvature difference:</b> At the same k, smaller m* yields larger Δε.</li>
            <li class="muted"><b>Quadratic scaling:</b> Doubling k increases Δε by a factor of 4 (parabolic law).</li>
          </ul>

          <a class="backtop" href="#top">Back to top ↑</a>
        </section>

        <footer>
          <p>
            Prepared as a self-contained learning article: k·p perturbation → dispersion → effective mass → engineering meaning.
          </p>
        </footer>
      </main>
    </div>
  </div>

  <script>
    (function(){
      const links = document.querySelectorAll('a[href^="#"]');
      links.forEach(a=>{
        a.addEventListener('click', (e)=>{
          const id = a.getAttribute('href');
          const el = document.querySelector(id);
          if(!el) return;
          e.preventDefault();
          el.scrollIntoView({behavior:'smooth', block:'start'});
          history.pushState(null, "", id);
        });
      });
    })();

    async function copyTextFromSelector(sel){
      const el = document.querySelector(sel);
      if(!el) return false;
      const text = el.innerText.trim();
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(err){
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try{
          document.execCommand('copy');
          document.body.removeChild(ta);
          return true;
        }catch(e){
          document.body.removeChild(ta);
          return false;
        }
      }
    }

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed';
      t.style.bottom='16px';
      t.style.left='50%';
      t.style.transform='translateX(-50%)';
      t.style.padding='10px 12px';
      t.style.borderRadius='12px';
      t.style.background='rgba(0,0,0,.75)';
      t.style.border='1px solid rgba(255,255,255,.18)';
      t.style.color='#fff';
      t.style.fontSize='13px';
      t.style.zIndex='9999';
      t.style.backdropFilter='blur(10px)';
      t.style.boxShadow='0 10px 30px rgba(0,0,0,.35)';
      t.style.opacity='0';
      t.style.transition='opacity .18s ease, transform .18s ease';
      document.body.appendChild(t);
      requestAnimationFrame(()=>{ t.style.opacity='1'; t.style.transform='translateX(-50%) translateY(-2px)'; });
      setTimeout(()=>{
        t.style.opacity='0';
        t.style.transform='translateX(-50%) translateY(0px)';
        setTimeout(()=> t.remove(), 250);
      }, 1100);
    }

    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const ok = await copyTextFromSelector(btn.getAttribute('data-copy'));
        toast(ok ? 'Copied.' : 'Copy failed.');
      });
    });

    document.getElementById('copyFinal').addEventListener('click', async ()=>{
      const ok = await copyTextFromSelector('#final_answer');
      toast(ok ? 'Final answer copied.' : 'Copy failed.');
    });

    (function(){
      const canvas = document.getElementById('plot');
      const ctx = canvas.getContext('2d');

      function draw(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const rect = canvas.getBoundingClientRect();
        const W = Math.max(320, Math.floor(rect.width));
        const H = Math.max(260, Math.floor(rect.height));
        canvas.width = Math.floor(W * dpr);
        canvas.height = Math.floor(H * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);

        const padL = 54, padR = 16, padT = 34, padB = 46;
        const x0 = padL, y0 = H - padB, x1 = W - padR, y1 = padT;
        const plotW = x1 - x0, plotH = y0 - y1;

        const hbar = 1.054571817e-34; // J*s
        const m = 9.1093837015e-31;   // kg
        const eV = 1.602176634e-19;   // J

        const kMax_nm = 1.0;
        const kMax = kMax_nm * 1e9; // 1/m

        const mstarA = 1.0 * m;
        const mstarB = 0.067 * m;

        function deltaE(k, mstar){
          return (hbar*hbar * k*k) / (2*mstar); // J
        }

        const yMaxJ = deltaE(kMax, mstarB);
        const yMax = (yMaxJ / eV) * 1.05; // eV

        const xFromKnm = (knm)=> x0 + (knm / kMax_nm) * plotW;
        const yFromEv = (ev)=> y0 - (ev / yMax) * plotH;

        ctx.clearRect(0,0,W,H);

        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgba(255,255,255,.10)';
        const xTicks = 6, yTicks = 6;
        for(let i=0;i<=xTicks;i++){
          const x = x0 + (i/xTicks)*plotW;
          ctx.beginPath(); ctx.moveTo(x,y0); ctx.lineTo(x,y1); ctx.stroke();
        }
        for(let j=0;j<=yTicks;j++){
          const y = y0 - (j/yTicks)*plotH;
          ctx.beginPath(); ctx.moveTo(x0,y); ctx.lineTo(x1,y); ctx.stroke();
        }

        ctx.strokeStyle = 'rgba(255,255,255,.38)';
        ctx.lineWidth = 1.5;
        ctx.beginPath(); ctx.moveTo(x0,y0); ctx.lineTo(x1,y0); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(x0,y0); ctx.lineTo(x0,y1); ctx.stroke();

        ctx.fillStyle = 'rgba(233,238,247,.95)';
        ctx.font = '600 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.fillText('Example band-edge parabolas: Δε(k)=ħ²k²/(2m*)', x0, 20);

        ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.fillStyle = 'rgba(233,238,247,.88)';
        ctx.fillText('k (1/nm)', Math.floor((x0+x1)/2)-18, H-14);
        ctx.save();
        ctx.translate(16, Math.floor((y0+y1)/2)+30);
        ctx.rotate(-Math.PI/2);
        ctx.fillText('Δε (eV)', 0, 0);
        ctx.restore();

        ctx.fillStyle = 'rgba(183,195,214,.92)';
        ctx.font = '11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        for(let i=0;i<=xTicks;i++){
          const knm = (i/xTicks)*kMax_nm;
          const x = xFromKnm(knm);
          ctx.beginPath(); ctx.moveTo(x,y0); ctx.lineTo(x,y0+6); ctx.strokeStyle='rgba(255,255,255,.28)'; ctx.stroke();
          const s = knm.toFixed(2);
          ctx.fillText(s, x-10, y0+20);
        }
        for(let j=0;j<=yTicks;j++){
          const ev = (j/yTicks)*yMax;
          const y = yFromEv(ev);
          ctx.beginPath(); ctx.moveTo(x0-6,y); ctx.lineTo(x0,y); ctx.strokeStyle='rgba(255,255,255,.28)'; ctx.stroke();
          const s = ev.toFixed(3);
          ctx.fillText(s, 6, y+4);
        }

        function drawCurve(mstar, stroke){
          ctx.strokeStyle = stroke;
          ctx.lineWidth = 2.2;
          ctx.beginPath();
          const N = 250;
          for(let i=0;i<=N;i++){
            const knm = (i/N)*kMax_nm;
            const k = knm * 1e9;
            const ev = deltaE(k, mstar)/eV;
            const x = xFromKnm(knm);
            const y = yFromEv(ev);
            if(i===0) ctx.moveTo(x,y);
            else ctx.lineTo(x,y);
          }
          ctx.stroke();
        }

        drawCurve(mstarA, 'rgba(233,238,247,.70)');
        drawCurve(mstarB, 'rgba(233,238,247,.95)');

        const lx = x1 - 240, ly = y1 + 10;
        ctx.fillStyle = 'rgba(16,26,42,.72)';
        ctx.strokeStyle = 'rgba(255,255,255,.16)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.roundRect(lx, ly, 224, 54, 12);
        ctx.fill(); ctx.stroke();

        ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.fillStyle = 'rgba(233,238,247,.92)';

        ctx.strokeStyle = 'rgba(233,238,247,.70)'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(lx+14, ly+18); ctx.lineTo(lx+44, ly+18); ctx.stroke();
        ctx.fillText('m* = m', lx+52, ly+22);

        ctx.strokeStyle = 'rgba(233,238,247,.95)'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(lx+14, ly+36); ctx.lineTo(lx+44, ly+36); ctx.stroke();
        ctx.fillText('m* = 0.067 m (example)', lx+52, ly+40);
      }

      if(!CanvasRenderingContext2D.prototype.roundRect){
        CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){
          const rr = Math.min(r, w/2, h/2);
          this.beginPath();
          this.moveTo(x+rr,y);
          this.arcTo(x+w,y, x+w,y+h, rr);
          this.arcTo(x+w,y+h, x,y+h, rr);
          this.arcTo(x,y+h, x,y, rr);
          this.arcTo(x,y, x+w,y, rr);
          this.closePath();
          return this;
        };
      }

      window.addEventListener('resize', draw, {passive:true});
      draw();
    })();
  </script>
</body>
</html>
