<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RF Saturation of a Two-Level Spin System: Rate Equations, Steady-State Magnetization, and Power Absorption</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --card:#111b27;
      --text:#eaf0f7;
      --muted:#a9b6c6;
      --faint:#6d7c90;
      --accent:#7dd3fc;
      --accent2:#a7f3d0;
      --warn:#fbbf24;
      --danger:#fb7185;
      --ok:#86efac;
      --border:rgba(255,255,255,0.10);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius:16px;
      --radius2:22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      --lh:1.6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      line-height:var(--lh);
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(125,211,252,0.12), transparent 55%),
        radial-gradient(900px 600px at 80% 0%, rgba(167,243,208,0.10), transparent 55%),
        radial-gradient(900px 700px at 70% 100%, rgba(251,191,36,0.08), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:28px 18px 10px;
      position:relative;
      overflow:hidden;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:0 12px 70px;
    }
    .hero{
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid var(--border);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
      padding:22px 18px;
      display:grid;
      grid-template-columns: 1.25fr 0.75fr;
      gap:16px;
      align-items:start;
    }
    .hero h1{
      margin:0 0 8px;
      font-size: clamp(1.35rem, 2.2vw, 2.0rem);
      letter-spacing:0.2px;
    }
    .sub{
      color:var(--muted);
      margin:0;
      font-size:0.98rem;
    }
    .meta{
      background:rgba(255,255,255,0.03);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px 12px;
      color:var(--muted);
      font-size:0.92rem;
    }
    .meta b{color:var(--text)}
    main{
      margin-top:14px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:14px;
      align-items:start;
    }
    nav{
      position:sticky;
      top:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.025));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px 12px;
      max-height: calc(100vh - 24px);
      overflow:auto;
    }
    nav h2{
      font-size:0.95rem;
      margin:0 0 8px;
      color:var(--text);
      letter-spacing:0.3px;
    }
    .toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      margin:4px 0;
      color:var(--muted);
      border:1px solid transparent;
      transition:transform 160ms ease, background 160ms ease, border-color 160ms ease;
    }
    .toc a:hover{
      background:rgba(125,211,252,0.08);
      border-color:rgba(125,211,252,0.25);
      transform:translateX(2px);
      color:var(--text);
      text-decoration:none;
    }
    .content{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    section, article{
      background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.025));
      border:1px solid var(--border);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
      padding:18px 16px;
    }
    section h2, article h2{
      margin:0 0 10px;
      font-size:1.25rem;
      letter-spacing:0.2px;
    }
    h3{
      margin:14px 0 8px;
      font-size:1.05rem;
      color:var(--text);
    }
    p{margin:8px 0; color:var(--text)}
    ul{margin:8px 0 10px 20px; color:var(--text)}
    li{margin:6px 0}
    .muted{color:var(--muted)}
    .grid2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .grid3{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
    }
    .card{
      background:rgba(255,255,255,0.03);
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px 12px;
    }
    .callout{
      border-radius:16px;
      padding:12px 12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      position:relative;
      overflow:hidden;
    }
    .callout::before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width:4px;
      background:linear-gradient(180deg, var(--accent), rgba(125,211,252,0.1));
      opacity:0.9;
    }
    .callout.warn::before{background:linear-gradient(180deg, var(--warn), rgba(251,191,36,0.1))}
    .callout.danger::before{background:linear-gradient(180deg, var(--danger), rgba(251,113,133,0.1))}
    .callout.ok::before{background:linear-gradient(180deg, var(--ok), rgba(134,239,172,0.1))}
    .callout h4{
      margin:0 0 6px;
      font-size:0.98rem;
      letter-spacing:0.15px;
    }
    .eq{
      font-family:var(--mono);
      font-size:0.94rem;
      background:rgba(0,0,0,0.28);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 10px;
      overflow:auto;
      white-space:pre;
    }
    .eqrow{
      display:flex;
      gap:10px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.04);
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      font-size:0.90rem;
      cursor:pointer;
      transition:transform 150ms ease, background 150ms ease, border-color 150ms ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      background:rgba(125,211,252,0.10);
      border-color:rgba(125,211,252,0.25);
      transform:translateY(-1px);
    }
    .btn:active{transform:translateY(0px)}
    details{
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      background:rgba(255,255,255,0.02);
    }
    summary{
      cursor:pointer;
      color:var(--text);
      font-weight:600;
    }
    .backtop{
      display:inline-block;
      margin-top:10px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
    }
    figure{
      margin:12px 0 0;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--border);
      background:rgba(0,0,0,0.20);
    }
    figcaption{color:var(--muted); font-size:0.92rem; margin-top:8px}
    canvas{width:100%; height:auto; display:block; border-radius:12px}
    .kpi{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:8px;
    }
    .pill{
      font-size:0.88rem;
      color:var(--muted);
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      border-radius:999px;
      padding:6px 10px;
    }

    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
      main{grid-template-columns:1fr}
      nav{position:relative; top:auto}
    }
    @media (max-width: 720px){
      .grid2,.grid3{grid-template-columns:1fr}
      .eq{font-size:0.90rem}
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      header, nav, .btn, .backtop{display:none !important}
      section, article{box-shadow:none; border:1px solid #ccc; background:#fff}
      .eq{background:#f7f7f7; color:#000}
      a{color:#000; text-decoration:underline}
      .pagebreak{break-before:page}
    }
  </style>
</head>

<body>
  <header id="top">
    <div class="wrap">
      <div class="hero">
        <div>
          <h1>RF Saturation in a Two-Level Spin System</h1>
          <p class="sub">
            Derive the longitudinal magnetization dynamics, obtain the steady-state reduction
            <span class="muted">(saturation)</span>, and compute the absorbed RF power—using rigorous rate-equation physics with applied/industrial relevance.
          </p>
          <div class="kpi">
            <span class="pill">Model: two-level + rate equations (ODE)</span>
            <span class="pill">Key time: T1 (spin-lattice relaxation)</span>
            <span class="pill">Control: RF-induced transition rate W_rf</span>
          </div>
        </div>
        <div class="meta">
          <div><b>Output:</b> symbolic closed forms</div>
          <div><b>Main results:</b> Mz(t) ODE, Mz_ss, absorbed power P(W_rf)</div>
          <div><b>Use case:</b> saturation onset → measure T1</div>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <main>
      <nav aria-label="Table of contents">
        <h2>Table of Contents</h2>
        <div class="toc">
          <a href="#qs">Quick Summary</a>
          <a href="#p0">PART 0 — Concept Primer</a>
          <a href="#p0b">PART 0B — Industry & Applied Physics Perspective</a>
          <a href="#p1">PART 1 — Problem Analysis</a>
          <a href="#p2">PART 2 — Strategy & Tips</a>
          <a href="#p3">PART 3 — Full Solution</a>
          <a href="#p4">PART 4 — Deeper Understanding</a>
          <a href="#p5">PART 5 — Optional Plot Guide</a>
        </div>
      </nav>

      <div class="content">

        <section id="qs">
          <h2>Quick Summary</h2>
          <ul>
            <li><b>What this is about:</b> A two-level spin system in a static field <span class="muted">H0 ẑ</span> is driven by an RF field that causes additional transitions at rate <span class="muted">W_rf</span>.</li>
            <li><b>Key physics idea:</b> RF pumping competes with spin-lattice relaxation (<span class="muted">T1</span>), reducing the population difference and thus <span class="muted">Mz</span> (saturation).</li>
            <li><b>Governing equations:</b> Coupled population rate ODEs for <span class="muted">N1, N2</span>, rewritten as a single ODE for the population difference <span class="muted">n = N1 − N2</span>, and hence for <span class="muted">Mz</span>.</li>
            <li><b>Core ODE form:</b> <span class="muted">dn/dt = −(1/T1 + 2W_rf) n + (1/T1) n0</span> (equivalently with <span class="muted">N(W21−W12)</span> source).</li>
            <li><b>Steady-state magnetization:</b> <span class="muted">Mz = M0 / (1 + 2 W_rf T1)</span>.</li>
            <li><b>Absorbed RF power:</b> <span class="muted">P_abs = ΔE · W_rf (N1 − N2) = ΔE · W_rf n</span> → <span class="muted">P_abs(W_rf) = ΔE · W_rf n0 / (1 + 2 W_rf T1)</span>.</li>
            <li><b>Physical meaning:</b> As <span class="muted">W_rf</span> increases, <span class="muted">Mz</span> collapses toward zero (equal populations), while absorption <span class="muted">saturates</span> (no unlimited growth).</li>
            <li><b>Measurement insight:</b> Saturation onset around <span class="muted">2W_rf T1 ~ 1</span> gives <span class="muted">T1</span>.</li>
          </ul>

          <div class="callout ok">
            <h4>Math Insight</h4>
            <p class="muted">
              The central equation is a <b>linear first-order inhomogeneous ODE</b> (a stable “relaxation” equation).
              Mathematically it is a dissipative dynamical system with a single stable fixed point.
              The RF adds an extra decay channel (increases the effective relaxation rate) and shifts the fixed point.
            </p>
          </div>

          <a class="backtop" href="#top">Back to top ↑</a>
        </section>

        <article id="p0">
          <h2>PART 0 — Concept Primer (THEORY BEFORE SOLVING)</h2>

          <h3>0.1 Physical setup and symbols (with units)</h3>
          <div class="grid2">
            <div class="card">
              <ul>
                <li><b>Two levels:</b> level 1 and level 2, separated by energy <b>ΔE</b> [J]. For spins in a static field, typically <span class="muted">ΔE = ħω0</span>.</li>
                <li><b>Populations:</b> <b>N1</b>, <b>N2</b> [dimensionless counts or number density integrated over sample]. Total <b>N = N1 + N2</b> (constant in this closed model).</li>
                <li><b>Thermal transition rates:</b> <b>W12</b> (1→2), <b>W21</b> (2→1) [s⁻¹]. They describe spin-lattice relaxation processes.</li>
                <li><b>RF-induced transition rate:</b> <b>W_rf</b> [s⁻¹], assumed to drive transitions <em>symmetrically</em> (stimulated absorption and emission with the same rate coefficient under near-resonant driving).</li>
              </ul>
            </div>
            <div class="card">
              <ul>
                <li><b>Population difference:</b> <b>n = N1 − N2</b> [same units as N].</li>
                <li><b>Equilibrium population difference:</b> <b>n0</b> [same units], set by temperature (Boltzmann).</li>
                <li><b>Longitudinal relaxation time:</b> <b>T1</b> [s], defined here via <span class="muted">1/T1 = W12 + W21</span>.</li>
                <li><b>Longitudinal magnetization:</b> <b>Mz</b> [A/m] (or total magnetic moment if not normalized by volume). For a two-level spin system, <span class="muted">Mz ∝ n</span>.</li>
              </ul>
            </div>
          </div>

          <h3>0.2 What these quantities “mean” physically</h3>
          <ul>
            <li><b>W12, W21:</b> random thermally-driven flips caused by coupling to the environment (phonons, electrons, etc.). They try to restore the <b>Boltzmann population ratio</b>.</li>
            <li><b>T1:</b> the timescale for <b>Mz</b> (or population difference) to return to equilibrium after being disturbed.</li>
            <li><b>W_rf:</b> how hard the RF drive is pumping transitions; proportional to RF power in many regimes (and depends on linewidth, detuning, etc., in more complete models).</li>
            <li><b>Saturation:</b> when RF pumping is strong enough that the two levels approach <b>equal populations</b> (n → 0), so there is little net absorption left.</li>
          </ul>

          <h3>0.3 Key principles and validity conditions</h3>
          <div class="callout">
            <h4>Assumptions behind the simple saturation model</h4>
            <ul class="muted">
              <li><b>Two-level approximation:</b> only two Zeeman levels matter (good for spin-1/2 or isolated transition).</li>
              <li><b>Rate-equation regime:</b> incoherent population dynamics; phase coherence (T2) is not explicitly modeled.</li>
              <li><b>On-resonance / symmetric RF drive:</b> RF induces transitions 1→2 and 2→1 with the same coefficient W_rf.</li>
              <li><b>Closed population:</b> N = N1 + N2 is constant (no loss, pumping from outside, etc.).</li>
              <li><b>Constant parameters:</b> W12, W21, W_rf treated as time-independent during the measurement.</li>
            </ul>
          </div>

          <h3>0.4 Common models/approximations in this topic</h3>
          <ul>
            <li><b>Bloch equations</b> (coherent + relaxation): full magnetization dynamics with T1 and T2, plus precession and RF fields.</li>
            <li><b>Rate equations</b> (this problem): population-only dynamics; effectively the <em>longitudinal</em> part of Bloch in an incoherent limit.</li>
            <li><b>Linear response</b> (weak RF): when <span class="muted">2 W_rf T1 ≪ 1</span>, magnetization is near equilibrium and absorption scales linearly with RF intensity.</li>
          </ul>

          <h3>0.5 Mini intuition examples (minimal algebra)</h3>
          <ul>
            <li><b>No RF (W_rf = 0):</b> populations relax to equilibrium, so <span class="muted">Mz → M0</span> on timescale T1.</li>
            <li><b>Very strong RF:</b> rapid RF-induced flips equalize populations (n → 0), so <span class="muted">Mz → 0</span> regardless of temperature.</li>
            <li><b>Intermediate RF:</b> partial saturation reduces Mz and makes the sample absorb less efficiently than expected from weak-drive scaling.</li>
          </ul>

          <h3>0.6 What to watch for (pitfalls & sign conventions)</h3>
          <ul>
            <li><b>Which level is “up” vs “down”:</b> be consistent about whether level 1 is lower energy. The sign of n depends on that labeling, but the measurable magnitude trends are robust.</li>
            <li><b>T1 definition:</b> here <span class="muted">1/T1 = W12 + W21</span> (as stated in the problem). Some texts define T1 via different conventions—always check.</li>
            <li><b>RF symmetry:</b> using the same W_rf for 1→2 and 2→1 assumes stimulated absorption and emission are driven similarly (near resonance, classical drive).</li>
            <li><b>Absorbed power uses the net rate:</b> absorption minus stimulated emission, i.e., proportional to population difference.</li>
          </ul>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <article id="p0b">
          <h2>PART 0B — Industry & Applied Physics Perspective</h2>

          <div class="grid3">
            <div class="card">
              <h3 style="margin-top:0">Where this appears</h3>
              <ul class="muted">
                <li><b>MRI / NMR:</b> RF saturation and recovery sequences (T1 mapping, contrast control).</li>
                <li><b>EPR/ESR spectroscopy:</b> saturation behavior reveals relaxation pathways in materials and defects.</li>
                <li><b>Quantum sensing & NV centers:</b> optical/RF saturation linked to readout fidelity and linewidth.</li>
                <li><b>Magnetic materials QA:</b> relaxation times connect to microstructure, impurities, and stress.</li>
              </ul>
            </div>
            <div class="card">
              <h3 style="margin-top:0">Why engineers care</h3>
              <ul class="muted">
                <li><b>Performance:</b> saturation limits signal amplitude and SNR at high drive power.</li>
                <li><b>Safety & heating:</b> absorbed RF power becomes heat (SAR in MRI; thermal budgets in sensors).</li>
                <li><b>Reliability:</b> relaxation parameters drift with temperature, aging, contamination.</li>
                <li><b>Cost/throughput:</b> faster measurement often means higher power—until saturation wastes power.</li>
              </ul>
            </div>
            <div class="card">
              <h3 style="margin-top:0">Measurement in practice</h3>
              <ul class="muted">
                <li><b>Saturation curves:</b> sweep RF power, fit Mz or signal vs power to extract T1.</li>
                <li><b>Inversion-recovery:</b> time-domain method; saturation model informs optimal pulse power.</li>
                <li><b>Calibrations:</b> coil efficiency (B1), sample loading, Q-factor affect effective W_rf.</li>
              </ul>
            </div>
          </div>

          <div class="callout warn" style="margin-top:12px;">
            <h4>Design trade-offs & non-idealities</h4>
            <ul class="muted">
              <li><b>Real materials:</b> multi-level structure, inhomogeneous broadening, and distribution of T1 values.</li>
              <li><b>RF field nonuniformity:</b> spatially varying B1 → spatially varying W_rf → non-single-exponential behavior.</li>
              <li><b>Detuning & linewidth:</b> off-resonance drive reduces effective transition rate and modifies saturation law.</li>
              <li><b>Thermal management:</b> absorbed power changes temperature, feeding back into W12/W21 (and thus T1).</li>
            </ul>
          </div>

          <details style="margin-top:12px;">
            <summary>From lab to product: how the ideal model gets adapted</summary>
            <p class="muted">
              In real instruments, W_rf is not a direct knob—it is inferred from RF power, coil geometry, sample loading,
              resonance linewidth, and detuning. Engineering workflows often calibrate B1 (field amplitude) and then map it to an
              effective W_rf by fitting saturation curves. For production systems, safety limits (heating), tolerances (coil placement),
              and automated QA routines are built around these fitted parameters to ensure consistent operation across units.
            </p>
          </details>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <article id="p1">
          <h2>PART 1 — Problem Analysis (no solving yet)</h2>

          <h3>1.1 Restate the problem in plain language</h3>
          <p>
            We have a two-level spin system in thermal equilibrium at temperature <b>T</b> in a static magnetic field
            <b>H0 ẑ</b>. Populations <b>N1</b> and <b>N2</b> relax due to thermal transitions with rates <b>W12</b> and <b>W21</b>.
            We then apply an RF signal that induces transitions at rate <b>W_rf</b>.
          </p>
          <p class="muted">
            (a) Derive the dynamical equation for <b>dMz/dt</b> and show that the steady-state magnetization becomes
            <b>Mz = M0 / (1 + 2 W_rf T1)</b>, where <b>1/T1 = W12 + W21</b>.
            <br/>
            (b) Use this to write the rate at which energy is absorbed from the RF field, and interpret what happens as
            <b>W_rf → 1/(2T1)</b>.
          </p>

          <h3>1.2 Given quantities</h3>
          <ul>
            <li>Thermal transition rates <b>W12</b>, <b>W21</b> [s⁻¹]</li>
            <li>RF-induced transition rate <b>W_rf</b> [s⁻¹]</li>
            <li>Total population <b>N = N1 + N2</b> (constant)</li>
            <li>Definition <b>1/T1 = W12 + W21</b> [s⁻¹]</li>
            <li>Helpful definitions suggested: <b>n = N1 − N2</b>, <b>n0 = N(W21 − W12)/(W21 + W12)</b></li>
          </ul>

          <h3>1.3 Unknowns / what must be shown</h3>
          <ul>
            <li>ODE for <b>dMz/dt</b> (equivalently for dn/dt)</li>
            <li>Steady-state relation <b>Mz = M0/(1 + 2 W_rf T1)</b></li>
            <li>Absorbed power rate <b>P_abs</b> and saturation interpretation near <b>W_rf ~ 1/(2T1)</b></li>
          </ul>

          <h3>1.4 Relevant principles and why they apply</h3>
          <ul>
            <li><b>Master/rate equations</b> for populations: appropriate because the problem is explicitly given in terms of transition rates (incoherent kinetics).</li>
            <li><b>Conservation of total population</b>: in a closed two-level system, N is constant; this reduces the dynamics to one independent variable (n).</li>
            <li><b>Magnetization proportional to population difference</b>: for a two-level Zeeman system, net longitudinal magnetization tracks the imbalance between spin states.</li>
          </ul>
          <p class="muted">
            We do not need spatial PDEs (no gradients, ∇ operators) because the model is lumped (spatially uniform).
            The “operator” content is therefore the time derivative d/dt acting on state variables (ODE dynamics).
          </p>

          <h3>1.5 Assumptions (explicit)</h3>
          <div class="callout">
            <h4>Assumptions used in the derivation</h4>
            <ul class="muted">
              <li>RF induces <b>both</b> upward and downward transitions with the same coefficient W_rf (stimulated absorption & emission).</li>
              <li>All rates are constant in time; the system is homogeneous (single n, single Mz).</li>
              <li>Two-level approximation; no additional levels participate.</li>
              <li>Energy splitting ΔE is fixed by H0 (no power broadening physics beyond the rate model).</li>
            </ul>
          </div>

          <h3>1.6 Possible approaches (compare 2–3)</h3>
          <div class="grid3">
            <div class="card">
              <h3 style="margin-top:0">Approach A: Direct population ODEs</h3>
              <p class="muted">Write coupled ODEs for N1 and N2, then convert to n = N1 − N2. Clear and systematic.</p>
            </div>
            <div class="card">
              <h3 style="margin-top:0">Approach B: Bloch-equation analogy</h3>
              <p class="muted">Use longitudinal Bloch equation with an RF-induced “extra relaxation” term. Faster, but hides the kinetic origin of the 2W_rf factor.</p>
            </div>
            <div class="card">
              <h3 style="margin-top:0">Approach C: Detailed balance + steady-state only</h3>
              <p class="muted">Solve only for steady state by flux balance. Works for Mz_ss but does not naturally produce dMz/dt.</p>
            </div>
          </div>
          <p><b>Choice:</b> Approach A is best because the problem explicitly provides transition rates and asks for dMz/dt.</p>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <article id="p2">
          <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

          <ol>
            <li><b>Write the population rate equations</b> for N1 and N2, including thermal (W12, W21) and RF (W_rf) transitions.</li>
            <li><b>Use conservation</b> N = N1 + N2 to reduce to one variable n = N1 − N2.</li>
            <li><b>Derive dn/dt</b> by subtracting the two ODEs; simplify to a linear ODE.</li>
            <li><b>Identify n0</b> (equilibrium difference) by setting W_rf = 0 and dn/dt = 0.</li>
            <li><b>Relate magnetization to n</b>: Mz = α n, define M0 = α n0 so results carry over directly.</li>
            <li><b>Steady-state under RF</b>: set dn/dt = 0 to find n_ss, hence Mz_ss.</li>
            <li><b>Energy absorption rate</b>: net absorbed power = ΔE × (upward RF transitions − downward RF transitions).</li>
            <li><b>Interpret saturation</b> using limits: small W_rf (linear response) vs W_rf ~ 1/(2T1) vs large W_rf.</li>
          </ol>

          <div class="callout danger">
            <h4>Common mistakes</h4>
            <ul class="muted">
              <li>Forgetting that RF causes <b>both</b> directions of transitions → missing the factor <b>2W_rf</b> in the decay term.</li>
              <li>Using absorbed power ∝ W_rf N1 only (ignoring stimulated emission ∝ W_rf N2). Net absorption must use <b>N1 − N2</b>.</li>
              <li>Mixing definitions of T1; here <b>1/T1 = W12 + W21</b> (given).</li>
              <li>Dropping the source term N(W21 − W12) that encodes thermal bias (without it you cannot recover equilibrium magnetization).</li>
            </ul>
          </div>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <article id="p3">
          <h2>PART 3 — Full Solution (DETAILED + TEACHING)</h2>

          <h3>3.1 Qualitative expectation (before math)</h3>
          <ul>
            <li>Without RF, the system relaxes to a biased population difference (Boltzmann), giving <span class="muted">Mz → M0</span> over time <span class="muted">T1</span>.</li>
            <li>RF adds extra transitions that tend to equalize populations (reduce <span class="muted">n</span>), so <span class="muted">Mz</span> should drop below <span class="muted">M0</span>.</li>
            <li>At strong RF, populations become nearly equal, so <span class="muted">Mz → 0</span>, and net absorption stops growing indefinitely (saturation).</li>
          </ul>

          <h3>3.2 Mathematical model (variables, domain, ODE structure)</h3>
          <div class="callout">
            <h4>Mathematical model</h4>
            <ul class="muted">
              <li><b>Unknowns:</b> N1(t), N2(t) for t ≥ 0 (time domain).</li>
              <li><b>Parameters:</b> W12, W21, W_rf ≥ 0 constants; total N = N1 + N2 constant.</li>
              <li><b>ODE system:</b> linear, time-invariant (LTI), first order.</li>
              <li><b>Initial condition:</b> N1(0), N2(0) given (not needed for steady-state, but needed for transient).</li>
              <li><b>Boundary conditions:</b> none (lumped ODE, no spatial coordinate, so no ∇, ∇·, ∇× terms).</li>
            </ul>
          </div>

          <h3>3.3 Step 1 — Write the population rate equations</h3>
          <p>
            Let level 1 be the lower-energy level and level 2 the higher-energy level, with energy gap <b>ΔE</b>.
            Thermal processes cause transitions:
            <span class="muted">1→2</span> at rate coefficient <span class="muted">W12</span> and
            <span class="muted">2→1</span> at <span class="muted">W21</span>.
            The RF field drives <b>stimulated</b> transitions both ways with coefficient <span class="muted">W_rf</span>.
          </p>

          <div class="eqrow">
            <div class="eq" id="eq1">dN1/dt = -W12 N1 + W21 N2  - W_rf N1 + W_rf N2
dN2/dt = -W21 N2 + W12 N1  - W_rf N2 + W_rf N1</div>
            <button class="btn" data-copy="#eq1">Copy equation</button>
          </div>

          <p class="muted">
            Why these terms are valid: each term is “(rate coefficient) × (population in the originating level)”
            with a minus sign for loss and plus sign for gain. Linearity holds because we assume independent,
            memoryless transitions (Markov kinetics).
          </p>

          <h3>3.4 Step 2 — Use conserved total population</h3>
          <p>
            Define the total population and the difference:
            <span class="muted">N = N1 + N2</span> and <span class="muted">n = N1 − N2</span>.
            Adding the two ODEs from above gives:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq2">d(N1+N2)/dt = dN/dt = 0  ⇒  N is constant.</div>
            <button class="btn" data-copy="#eq2">Copy equation</button>
          </div>

          <p class="muted">
            This conservation is expected: the RF and thermal transitions only shuffle population between the two levels.
          </p>

          <h3>3.5 Step 3 — Derive the single ODE for n(t)</h3>
          <p>
            Subtract the second population equation from the first:
            <span class="muted">dn/dt = d(N1 − N2)/dt = dN1/dt − dN2/dt</span>.
          </p>

          <details>
            <summary>Show the subtraction algebra (no “magic jumps”)</summary>
            <div class="eq" id="eq3a">dn/dt = (-W12 N1 + W21 N2 - W_rf N1 + W_rf N2)
     - (-W21 N2 + W12 N1 - W_rf N2 + W_rf N1)

= -W12 N1 + W21 N2 - W_rf N1 + W_rf N2 + W21 N2 - W12 N1 + W_rf N2 - W_rf N1

= -2W12 N1 + 2W21 N2 - 2W_rf N1 + 2W_rf N2</div>
            <button class="btn" data-copy="#eq3a">Copy algebra</button>
            <p class="muted">
              Regrouping is valid by linearity; we simply collected like terms.
            </p>
          </details>

          <p>
            Now rewrite N1 and N2 using N and n:
            <span class="muted">N1 = (N + n)/2</span>, <span class="muted">N2 = (N − n)/2</span>.
            Substitute into the collected form:
          </p>

          <details>
            <summary>Substitute N1=(N+n)/2, N2=(N−n)/2</summary>
            <div class="eq" id="eq3b">dn/dt = 2[ -(W12+W_rf) N1 + (W21+W_rf) N2 ]
     = 2[ -(W12+W_rf)(N+n)/2 + (W21+W_rf)(N-n)/2 ]

= -(W12+W_rf)(N+n) + (W21+W_rf)(N-n)

= [-(W12+W_rf) + (W21+W_rf)] N  + [-(W12+W_rf) - (W21+W_rf)] n

= (W21 - W12) N  - (W12 + W21 + 2W_rf) n</div>
            <button class="btn" data-copy="#eq3b">Copy substitution</button>
          </details>

          <div class="eqrow">
            <div class="eq" id="eq3">dn/dt = N(W21 − W12) − (W12 + W21 + 2W_rf) n</div>
            <button class="btn" data-copy="#eq3">Copy equation</button>
          </div>

          <p class="muted">
            This is a stable linear ODE: the coefficient of n is negative (since rates are positive), so the system relaxes to a fixed point.
          </p>

          <h3>3.6 Step 4 — Identify T1 and equilibrium n0</h3>
          <p>
            The problem defines <span class="muted">1/T1 = W12 + W21</span>.
            With <span class="muted">W_rf = 0</span>, steady state means <span class="muted">dn/dt = 0</span>, giving:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq4">0 = N(W21 − W12) − (W12 + W21) n0
⇒ n0 = N(W21 − W12)/(W21 + W12)</div>
            <button class="btn" data-copy="#eq4">Copy equation</button>
          </div>

          <p class="muted">
            This matches the hint. It encodes the thermal bias (detailed balance) without explicitly writing Boltzmann factors.
          </p>

          <h3>3.7 Step 5 — Rewrite the ODE in “relaxation-to-fixed-point” form</h3>
          <p>
            Using <span class="muted">1/T1 = W12 + W21</span> and the expression for n0, we can rewrite:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq5">dn/dt = - (1/T1 + 2W_rf) n + (1/T1) n0</div>
            <button class="btn" data-copy="#eq5">Copy equation</button>
          </div>

          <p class="muted">
            This form makes the physics transparent: RF adds an extra decay channel <span class="muted">(2W_rf)</span> that drives n toward zero,
            while the lattice drives n toward n0 at rate <span class="muted">1/T1</span>.
          </p>

          <h3>3.8 Step 6 — Convert to magnetization dynamics dMz/dt</h3>
          <p>
            For a two-level Zeeman system, the longitudinal magnetization is proportional to the population difference:
            <span class="muted">Mz = α n</span>, where α is a constant relating one net spin imbalance to magnetization
            (e.g., α = μ/V for a sample, with μ a magnetic moment per spin).
            Define the thermal-equilibrium magnetization <span class="muted">M0 = α n0</span>.
          </p>

          <p>
            Multiply the n-ODE by α:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq6">dMz/dt = - (1/T1 + 2W_rf) Mz + (1/T1) M0</div>
            <button class="btn" data-copy="#eq6">Copy equation</button>
          </div>

          <div class="callout ok">
            <h4>Interpretation</h4>
            <p class="muted">
              This is exactly a “forced relaxation” ODE:
              <b>Mz</b> relaxes toward a reduced steady value because RF pumping continually destroys polarization.
              The effective longitudinal decay rate is <b>(1/T1 + 2W_rf)</b>.
            </p>
          </div>

          <h3>3.9 Step 7 — Steady state Mz (show the required result)</h3>
          <p>
            Steady state means <span class="muted">dMz/dt = 0</span>. From the ODE:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq7">0 = - (1/T1 + 2W_rf) Mz + (1/T1) M0
⇒ Mz = ( (1/T1) / (1/T1 + 2W_rf) ) M0
⇒ Mz = M0 / (1 + 2W_rf T1)</div>
            <button class="btn" data-copy="#eq7">Copy equation</button>
          </div>

          <div class="callout">
            <h4>FINAL RESULT (Part a)</h4>
            <div class="eq" id="finalA">Steady-state longitudinal magnetization:
Mz = M0 / (1 + 2 W_rf T1)

Dynamics:
dMz/dt = - (1/T1 + 2W_rf) Mz + (1/T1) M0</div>
            <div style="margin-top:10px;">
              <button class="btn" data-copy="#finalA">Copy final answer (a)</button>
            </div>
          </div>

          <h3>3.10 Part (b) — Rate of energy absorption from the RF field</h3>
          <p>
            Each RF-induced <b>upward</b> transition (1→2) absorbs energy <b>ΔE</b> from the RF field.
            Each RF-induced <b>downward</b> transition (2→1) corresponds to stimulated emission, returning <b>ΔE</b> to the field.
          </p>

          <p>
            Upward RF transition rate = <span class="muted">W_rf N1</span>. Downward RF transition rate = <span class="muted">W_rf N2</span>.
            Therefore the <b>net</b> energy absorption rate (power absorbed) is:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq8">P_abs = ΔE [ (W_rf N1) − (W_rf N2) ]
     = ΔE W_rf (N1 − N2)
     = ΔE W_rf n</div>
            <button class="btn" data-copy="#eq8">Copy equation</button>
          </div>

          <p class="muted">
            Dimensional check: ΔE [J] × W_rf [s⁻¹] × n [dimensionless count] = J/s = W (watts). ✔
          </p>

          <p>
            In steady state, <span class="muted">n = n0/(1 + 2W_rf T1)</span>, so:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq9">P_abs(W_rf) = ΔE W_rf n0 / (1 + 2W_rf T1)</div>
            <button class="btn" data-copy="#eq9">Copy equation</button>
          </div>

          <p>
            If you prefer magnetization form, use <span class="muted">Mz = α n</span>, so <span class="muted">n = Mz/α</span> and <span class="muted">n0 = M0/α</span>:
          </p>

          <div class="eqrow">
            <div class="eq" id="eq10">P_abs(W_rf) = (ΔE/α) · W_rf · M0 / (1 + 2W_rf T1)
with α = Mz/n (a constant for the sample)</div>
            <button class="btn" data-copy="#eq10">Copy equation</button>
          </div>

          <div class="callout">
            <h4>What happens as W_rf approaches 1/(2T1)?</h4>
            <ul class="muted">
              <li>At <b>W_rf = 1/(2T1)</b>, the magnetization becomes <span class="muted">Mz = M0/(1+1) = M0/2</span>: <b>50% saturation</b>.</li>
              <li>The absorbed power becomes <span class="muted">P_abs = ΔE · (1/(2T1)) · n0 / 2 = ΔE n0 /(4T1)</span>.</li>
              <li>As W_rf grows beyond this, <b>Mz keeps decreasing</b>, so <b>net absorption stops scaling linearly</b> and begins to <b>saturate</b>.</li>
              <li>In the strong-drive limit <span class="muted">W_rf → ∞</span>, <span class="muted">P_abs → ΔE n0 /(2T1)</span> (finite ceiling).</li>
            </ul>
          </div>

          <div class="callout ok">
            <h4>FINAL RESULT (Part b)</h4>
            <div class="eq" id="finalB">Net absorbed RF power:
P_abs = ΔE W_rf (N1 − N2) = ΔE W_rf n

Steady state:
P_abs(W_rf) = ΔE W_rf n0 / (1 + 2 W_rf T1)

Saturation onset around:
2 W_rf T1 ~ 1  (Mz reduced significantly; used to measure T1)</div>
            <div style="margin-top:10px;">
              <button class="btn" data-copy="#finalB">Copy final answer (b)</button>
            </div>
          </div>

          <h3>3.11 Sanity checks (units, limits, physical interpretation)</h3>
          <div class="grid2">
            <div class="callout">
              <h4>Limiting cases</h4>
              <ul class="muted">
                <li><b>Weak RF:</b> if <span class="muted">2W_rf T1 ≪ 1</span>, then <span class="muted">Mz ≈ M0(1 − 2W_rf T1 + …)</span> (small reduction).</li>
                <li><b>Strong RF:</b> if <span class="muted">2W_rf T1 ≫ 1</span>, then <span class="muted">Mz ≈ M0/(2W_rf T1) → 0</span> (fully saturated).</li>
                <li><b>No RF:</b> W_rf = 0 gives Mz = M0 (correct).</li>
              </ul>
            </div>
            <div class="callout">
              <h4>Absorbed power behavior</h4>
              <ul class="muted">
                <li><b>Weak RF:</b> <span class="muted">P_abs ≈ ΔE n0 W_rf</span> (linear response).</li>
                <li><b>Strong RF:</b> <span class="muted">P_abs → ΔE n0 /(2T1)</span> (finite saturation ceiling).</li>
                <li><b>Sign:</b> if level 1 is more populated (<span class="muted">n&gt;0</span>), net absorption is positive.</li>
              </ul>
            </div>
          </div>

          <h3>3.12 One static plot (example values only) to visualize saturation</h3>
          <figure>
            <canvas id="plot" aria-label="Plot of saturation curves"></canvas>
            <figcaption>
              Example visualization (dimensionless): <b>Mz/M0 = 1/(1+s)</b> and <b>P_abs/(ΔE n0 / (2T1)) = s/(1+s)</b>,
              where <b>s = 2W_rf T1</b> (example axis). This plot uses no problem-specific numbers.
            </figcaption>
          </figure>

          <div class="callout" style="margin-top:12px;">
            <h4>Copy-ready final answer (plain text)</h4>
            <div class="eq" id="finalAll">Given two levels with thermal rates W12, W21 and RF-induced rate W_rf (both directions):

Population equations:
dN1/dt = -W12 N1 + W21 N2 - W_rf N1 + W_rf N2
dN2/dt = -W21 N2 + W12 N1 - W_rf N2 + W_rf N1

With N=N1+N2 const and n=N1-N2:
dn/dt = N(W21-W12) - (W12+W21+2W_rf) n
Define 1/T1 = W12+W21 and n0 = N(W21-W12)/(W21+W12):
dn/dt = -(1/T1+2W_rf) n + (1/T1) n0

With Mz = α n and M0 = α n0:
dMz/dt = -(1/T1+2W_rf) Mz + (1/T1) M0
Steady state:
Mz = M0/(1+2W_rf T1)

Net absorbed RF power:
P_abs = ΔE[W_rf N1 - W_rf N2] = ΔE W_rf (N1-N2) = ΔE W_rf n
Steady state:
P_abs(W_rf) = ΔE W_rf n0/(1+2W_rf T1)
At W_rf = 1/(2T1): Mz = M0/2 and P_abs = ΔE n0/(4T1). Saturation onset near 2W_rf T1 ~ 1 gives T1.</div>
            <div style="margin-top:10px;">
              <button class="btn" data-copy="#finalAll">Copy final answer</button>
            </div>
          </div>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <article id="p4">
          <h2>PART 4 — Deeper Understanding (THEORY AROUND THE RESULT)</h2>

          <h3>4.1 Re-interpret the steady-state formula term-by-term</h3>
          <div class="callout">
            <h4>Mz = M0 / (1 + 2W_rf T1)</h4>
            <ul class="muted">
              <li><b>M0</b>: the thermal (Boltzmann) polarization in the absence of RF.</li>
              <li><b>T1</b>: how quickly the lattice can “repair” polarization after RF disrupts it.</li>
              <li><b>2W_rf</b>: the RF equalization rate for the population difference (factor 2 because RF flips act on both levels and reduce n from both sides).</li>
              <li><b>Dimensionless saturation parameter</b>: <span class="muted">s = 2W_rf T1</span> controls everything.</li>
            </ul>
          </div>

          <h3>4.2 Parameter dependence (qualitative + useful quantitative notes)</h3>
          <ul>
            <li><b>Increase W_rf:</b> decreases Mz monotonically; absorption increases then saturates.</li>
            <li><b>Increase T1:</b> makes saturation easier at a given W_rf (because lattice repair is slower); the curve vs W_rf shifts left.</li>
            <li><b>Increase thermal bias n0 (or M0):</b> raises both magnetization and the maximum possible absorbed power ceiling.</li>
          </ul>

          <h3>4.3 Alternative derivation idea (brief but meaningful)</h3>
          <details>
            <summary>Flux-balance (steady-state) derivation without solving the ODE</summary>
            <p class="muted">
              In steady state, the net flow into level 1 must equal net flow out. Equivalently, the net change of n is zero:
              thermal processes drive n toward n0 with characteristic rate 1/T1, while RF processes drive n toward 0 with rate 2W_rf.
              Writing “repair minus destruction” gives directly:
              <span class="muted">0 = (n0 - n)/T1 - 2W_rf n</span> ⇒ <span class="muted">n = n0/(1+2W_rf T1)</span>.
              This is the same fixed point as the full ODE derivation.
            </p>
          </details>

          <h3>4.4 Concept checks (self-test with answers)</h3>
          <ul>
            <li><b>Q:</b> Why does RF introduce a factor <span class="muted">2W_rf</span> in the decay term for n?
              <br/><b>A:</b> Because RF drives both 1→2 and 2→1 transitions; both processes reduce the difference n = N1 − N2, producing an effective decay proportional to (N1+N2)=N and yielding the 2W_rf contribution to the n coefficient.</li>
            <li><b>Q:</b> In the weak RF limit, how does absorbed power scale with W_rf?
              <br/><b>A:</b> Linearly: <span class="muted">P_abs ≈ ΔE n0 W_rf</span> when <span class="muted">2W_rf T1 ≪ 1</span>.</li>
            <li><b>Q:</b> Why does absorption saturate instead of increasing without bound?
              <br/><b>A:</b> Increasing W_rf reduces the population difference n, and net absorption is proportional to n. The product W_rf·n approaches a finite ceiling.</li>
            <li><b>Q:</b> How can saturation measure T1?
              <br/><b>A:</b> The “knee” occurs when <span class="muted">2W_rf T1 ~ 1</span>. If you calibrate W_rf versus RF power, the saturation onset gives T1.</li>
          </ul>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <article id="p5">
          <h2>PART 5 — Optional Plot Guide</h2>

          <p>
            The plot shows the dynamics in terms of the <b>dimensionless saturation parameter</b>
            <span class="muted">s = 2W_rf T1</span>:
          </p>
          <ul>
            <li><b>x-axis:</b> <span class="muted">s = 2W_rf T1</span> (dimensionless RF strength).</li>
            <li><b>Left y (curve 1):</b> <span class="muted">Mz/M0 = 1/(1+s)</span> (how polarization collapses).</li>
            <li><b>Right idea (curve 2, normalized):</b> <span class="muted">P_abs / (ΔE n0 /(2T1)) = s/(1+s)</span> (how absorption saturates to 1).</li>
          </ul>
          <div class="callout warn">
            <h4>Example values note</h4>
            <p class="muted">
              The plot uses <b>no numerical parameters</b> from the problem; it is purely dimensionless to illustrate
              the functional dependence. The final answers remain symbolic.
            </p>
          </div>

          <a class="backtop" href="#top">Back to top ↑</a>
        </article>

        <footer class="pagebreak" style="padding:16px 4px; color:var(--muted);">
          <p>
            <b>End of article.</b> You can paste this HTML directly into your website. It includes a sticky TOC, copy buttons,
            collapsible deeper notes, and a single static canvas plot.
          </p>
        </footer>

      </div>
    </main>
  </div>

  <script>
    // Smooth scroll for in-page anchors
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[href^="#"]');
      if(!a) return;
      const id = a.getAttribute('href');
      const el = document.querySelector(id);
      if(!el) return;
      e.preventDefault();
      el.scrollIntoView({behavior:'smooth', block:'start'});
      history.replaceState(null, '', id);
    });

    // Copy buttons
    async function copyTextFromSelector(sel){
      const el = document.querySelector(sel);
      if(!el) return false;
      const text = el.innerText.replace(/\n{3,}/g, "\n\n").trim();
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(err){
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); }catch(e){}
        document.body.removeChild(ta);
        return true;
      }
    }

    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const sel = btn.getAttribute('data-copy');
        const ok = await copyTextFromSelector(sel);
        const old = btn.textContent;
        btn.textContent = ok ? 'Copied!' : 'Copy failed';
        btn.style.borderColor = ok ? 'rgba(134,239,172,0.45)' : 'rgba(251,113,133,0.45)';
        setTimeout(()=>{
          btn.textContent = old;
          btn.style.borderColor = 'var(--border)';
        }, 900);
      });
    });

    // Single static plot: Mz/M0 and normalized P_abs vs s = 2 W_rf T1
    const canvas = document.getElementById('plot');
    function drawPlot(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = canvas.getBoundingClientRect();
      const W = Math.max(320, rect.width);
      const H = Math.max(240, Math.min(420, Math.round(rect.width * 0.55)));

      canvas.width = Math.round(W * dpr);
      canvas.height = Math.round(H * dpr);
      canvas.style.height = H + 'px';

      const ctx = canvas.getContext('2d');
      ctx.setTransform(dpr,0,0,dpr,0,0);

      // Layout
      const padL = 56, padR = 16, padT = 36, padB = 44;
      const x0 = padL, y0 = padT;
      const x1 = W - padR, y1 = H - padB;
      const plotW = x1 - x0, plotH = y1 - y0;

      // Background
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle = 'rgba(0,0,0,0.18)';
      roundRect(ctx, 10, 10, W-20, H-20, 14);
      ctx.fill();

      // Axes ranges
      const sMin = 0, sMax = 6; // dimensionless
      const yMin = 0, yMax = 1;

      const xMap = s => x0 + (s - sMin) / (sMax - sMin) * plotW;
      const yMap = y => y1 - (y - yMin) / (yMax - yMin) * plotH;

      // Grid
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      ctx.lineWidth = 1;

      const xTicks = 6;
      for(let i=0;i<=xTicks;i++){
        const s = sMin + (sMax - sMin) * i / xTicks;
        const x = xMap(s);
        ctx.beginPath();
        ctx.moveTo(x, y0);
        ctx.lineTo(x, y1);
        ctx.stroke();
        // ticks
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText(s.toFixed(0), x, y1 + 8);
      }

      const yTicks = 5;
      for(let j=0;j<=yTicks;j++){
        const yv = yMin + (yMax - yMin) * j / yTicks;
        const y = yMap(yv);
        ctx.beginPath();
        ctx.moveTo(x0, y);
        ctx.lineTo(x1, y);
        ctx.stroke();
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(yv.toFixed(1), x0 - 10, y);
      }

      // Axes
      ctx.strokeStyle = 'rgba(255,255,255,0.35)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(x0, y0);
      ctx.lineTo(x0, y1);
      ctx.lineTo(x1, y1);
      ctx.stroke();

      // Title
      ctx.fillStyle = 'rgba(255,255,255,0.92)';
      ctx.font = '14px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText('Saturation curves vs s = 2 W_rf T1 (dimensionless)', x0, 10);

      // Axis labels
      ctx.fillStyle = 'rgba(255,255,255,0.85)';
      ctx.font = '13px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom';
      ctx.fillText('s = 2 W_rf T1', x0 + plotW/2, H - 10);

      ctx.save();
      ctx.translate(16, y0 + plotH/2);
      ctx.rotate(-Math.PI/2);
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText('Normalized value (0 to 1)', 0, 0);
      ctx.restore();

      // Curves: y1 = Mz/M0 = 1/(1+s), y2 = P_norm = s/(1+s)
      function curvePoints(f){
        const pts = [];
        const N = 250;
        for(let i=0;i<=N;i++){
          const s = sMin + (sMax - sMin) * i / N;
          const y = f(s);
          pts.push([xMap(s), yMap(y)]);
        }
        return pts;
      }

      // Draw curve helper (no fixed color by request; use default strokeStyle only by opacity changes)
      function drawCurve(pts, style){
        ctx.save();
        ctx.strokeStyle = style;
        ctx.lineWidth = 2.5;
        ctx.beginPath();
        ctx.moveTo(pts[0][0], pts[0][1]);
        for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i][0], pts[i][1]);
        ctx.stroke();
        ctx.restore();
      }

      const ptsMz = curvePoints(s => 1/(1+s));
      const ptsP  = curvePoints(s => s/(1+s));

      // Use neutral distinguishable strokes (vary alpha + dash)
      drawCurve(ptsMz, 'rgba(255,255,255,0.85)');
      ctx.setLineDash([6,4]);
      drawCurve(ptsP, 'rgba(255,255,255,0.70)');
      ctx.setLineDash([]);

      // Legend
      const lx = x0 + 10, ly = y0 + 8;
      ctx.fillStyle = 'rgba(0,0,0,0.35)';
      roundRect(ctx, lx, ly, 260, 54, 12);
      ctx.fill();
      ctx.strokeStyle = 'rgba(255,255,255,0.16)';
      ctx.stroke();

      // Legend entries
      ctx.font = '12.5px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';

      // Solid line sample
      ctx.strokeStyle = 'rgba(255,255,255,0.85)';
      ctx.lineWidth = 2.5;
      ctx.beginPath(); ctx.moveTo(lx+12, ly+18); ctx.lineTo(lx+46, ly+18); ctx.stroke();
      ctx.fillStyle = 'rgba(255,255,255,0.90)';
      ctx.fillText('Mz/M0 = 1/(1+s)', lx+56, ly+18);

      // Dashed line sample
      ctx.setLineDash([6,4]);
      ctx.strokeStyle = 'rgba(255,255,255,0.70)';
      ctx.beginPath(); ctx.moveTo(lx+12, ly+38); ctx.lineTo(lx+46, ly+38); ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = 'rgba(255,255,255,0.90)';
      ctx.fillText('P_norm = s/(1+s)', lx+56, ly+38);

      // Mark the point s=1 (i.e., W_rf = 1/(2T1))
      const sStar = 1;
      const xStar = xMap(sStar);
      ctx.strokeStyle = 'rgba(251,191,36,0.55)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(xStar, y0);
      ctx.lineTo(xStar, y1);
      ctx.stroke();

      ctx.fillStyle = 'rgba(251,191,36,0.95)';
      ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom';
      ctx.fillText('s=1 (W_rf=1/2T1)', xStar, y0 - 6);

      function roundRect(ctx, x, y, w, h, r){
        const rr = Math.min(r, w/2, h/2);
        ctx.beginPath();
        ctx.moveTo(x+rr, y);
        ctx.arcTo(x+w, y, x+w, y+h, rr);
        ctx.arcTo(x+w, y+h, x, y+h, rr);
        ctx.arcTo(x, y+h, x, y, rr);
        ctx.arcTo(x, y, x+w, y, rr);
        ctx.closePath();
      }
    }

    const ro = new ResizeObserver(()=>drawPlot());
    ro.observe(canvas);
    drawPlot();
    window.addEventListener('resize', drawPlot, {passive:true});
  </script>
</body>
</html>