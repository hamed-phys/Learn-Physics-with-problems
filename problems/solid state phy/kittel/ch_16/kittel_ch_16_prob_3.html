<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Effect of an Air Gap on Measuring High Dielectric Constants (Series Capacitor Model)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1733;
      --card:#101a3a;
      --ink:#e9ecff;
      --muted:#b9c0ff;
      --faint:rgba(233,236,255,.08);
      --line:rgba(233,236,255,.14);
      --accent:#7aa2ff;
      --accent2:#7dffcb;
      --warn:#ffd27a;
      --danger:#ff7aa8;
      --ok:#7dffcb;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(122,162,255,.22), transparent 60%),
        radial-gradient(900px 500px at 100% 0%, rgba(125,255,203,.14), transparent 60%),
        radial-gradient(900px 700px at 40% 110%, rgba(255,210,122,.10), transparent 60%),
        var(--bg);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre{font-family:var(--mono)}
    pre{
      margin:0;
      padding:14px 14px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      border-radius:12px;
      overflow:auto;
    }

    header{
      padding:28px 18px 14px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(15,23,51,.75), rgba(15,23,51,.35));
      position:relative;
      overflow:hidden;
    }
    header:before{
      content:"";
      position:absolute; inset:-40px -40px auto auto;
      width:260px; height:260px;
      background: radial-gradient(circle at 30% 30%, rgba(122,162,255,.25), transparent 60%);
      filter: blur(0px);
      transform: rotate(10deg);
      pointer-events:none;
    }
    .wrap{
      max-width:1180px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      padding:18px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr}
    }

    .title{
      max-width:1180px;
      margin:0 auto;
      padding:0 18px;
    }
    h1{
      font-size: clamp(1.35rem, 2.4vw, 2.2rem);
      margin:0 0 6px 0;
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      margin:0;
      max-width: 78ch;
    }

    nav.toc{
      position: sticky;
      top: 12px;
      align-self:start;
      background: rgba(16,26,58,.72);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      backdrop-filter: blur(10px);
    }
    .toc h2{
      font-size: .95rem;
      margin:0 0 8px 0;
      color: var(--muted);
      letter-spacing:.4px;
      text-transform: uppercase;
    }
    .toc a{
      display:block;
      padding:8px 10px;
      margin:4px 0;
      border-radius: 10px;
      border:1px solid transparent;
      color: var(--ink);
      background: transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:.95rem;
    }
    .toc a:hover{
      background: rgba(122,162,255,.10);
      border-color: rgba(122,162,255,.20);
      transform: translateY(-1px);
      text-decoration:none;
    }
    .toc .mini{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed var(--line);
      color:var(--muted);
      font-size:.92rem;
    }

    main{
      background: rgba(16,26,58,.40);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    article{
      padding:18px;
    }

    section{
      padding:14px 0 8px;
      border-top:1px solid rgba(233,236,255,.10);
    }
    section:first-of-type{border-top:0}
    h2{
      font-size: 1.2rem;
      margin: 0 0 10px 0;
    }
    h3{
      font-size: 1.02rem;
      margin: 14px 0 8px 0;
      color: var(--muted);
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 760px){
      .grid2{grid-template-columns:1fr}
    }

    .card{
      background: rgba(16,26,58,.62);
      border:1px solid var(--line);
      border-radius: 14px;
      padding:14px;
    }

    .callout{
      border-radius: 14px;
      border:1px solid var(--line);
      padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      position:relative;
      overflow:hidden;
    }
    .callout:before{
      content:"";
      position:absolute;
      inset: -80px auto auto -80px;
      width:200px; height:200px;
      background: radial-gradient(circle at 30% 30%, rgba(122,162,255,.18), transparent 60%);
      pointer-events:none;
    }
    .callout strong{color: var(--ink)}
    .tag{
      display:inline-block;
      font-size:.78rem;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      color: var(--muted);
      background: rgba(0,0,0,.18);
      margin-right:6px;
    }
    .tag.warn{border-color: rgba(255,210,122,.35); color:#ffe3aa}
    .tag.danger{border-color: rgba(255,122,168,.35); color:#ffc1d8}
    .tag.ok{border-color: rgba(125,255,203,.35); color:#c8ffea}

    ul{margin:8px 0 0 18px}
    li{margin:6px 0}
    .eqblock{
      margin-top:10px;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
    }
    .eqhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .eqhead .label{
      font-size:.92rem;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .btn{
      cursor:pointer;
      border:1px solid var(--line);
      background: rgba(122,162,255,.10);
      color: var(--ink);
      padding:8px 10px;
      border-radius: 12px;
      font-size:.9rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(122,162,255,.16);
      border-color: rgba(122,162,255,.30);
    }
    .btn:active{transform: translateY(0px) scale(.98)}
    .btn.secondary{
      background: rgba(125,255,203,.10);
      border-color: rgba(125,255,203,.20);
    }
    .btn.secondary:hover{
      background: rgba(125,255,203,.16);
      border-color: rgba(125,255,203,.30);
    }

    details{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background: rgba(0,0,0,.14);
      margin-top:10px;
    }
    summary{
      cursor:pointer;
      color: var(--muted);
      font-weight:600;
      outline:none;
    }
    summary::-webkit-details-marker{display:none}
    summary:before{
      content:"▸";
      display:inline-block;
      margin-right:8px;
      transform: translateY(-1px);
      transition: transform .12s ease;
      color: var(--accent);
    }
    details[open] summary:before{transform: rotate(90deg) translateX(1px)}

    figure{
      margin:12px 0 0;
      padding:12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
      border-radius:14px;
    }
    figcaption{
      color: var(--muted);
      font-size:.92rem;
      margin-top:10px;
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius:12px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(233,236,255,.10);
    }

    .backtop{
      display:inline-block;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--ink);
    }
    .backtop:hover{background: rgba(122,162,255,.10); text-decoration:none}

    footer{
      max-width:1180px;
      margin:0 auto;
      padding: 0 18px 26px;
      color: var(--muted);
      font-size:.92rem;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 14px;
      transform: translateX(-50%);
      background: rgba(16,26,58,.95);
      border: 1px solid var(--line);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 999;
      font-size: .92rem;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }

    /* Print-friendly */
    @media print{
      body{background:white; color:black}
      nav.toc{display:none}
      main, .card, .callout, .eqblock, figure, details{
        box-shadow:none !important;
        background:white !important;
        border-color:#ddd !important;
      }
      .btn{display:none}
      a{color:black; text-decoration:underline}
      header{background:white; border-bottom:1px solid #ddd}
      section{break-inside:avoid; page-break-inside:avoid}
      h2{page-break-after:avoid}
    }
  </style>
</head>

<body>
<header id="top">
  <div class="title">
    <h1>Effect of an Air Gap on Measuring High Dielectric Constants</h1>
    <p class="subtitle">
      A thin unintended air layer in a parallel-plate capacitor acts like a <em>series capacitor</em> and can cap the
      <strong>maximum apparent dielectric constant</strong> you can ever measure—no matter how large the true dielectric constant is.
    </p>
  </div>
</header>

<div class="wrap">
  <nav class="toc" aria-label="Table of contents">
    <h2>Contents</h2>
    <a href="#quick">Quick Summary</a>
    <a href="#part0">PART 0 — Concept Primer</a>
    <a href="#part0b">PART 0B — Industry &amp; Applied Physics Perspective</a>
    <a href="#part1">PART 1 — Problem Analysis</a>
    <a href="#part2">PART 2 — Strategy &amp; Tips</a>
    <a href="#part3">PART 3 — Full Solution</a>
    <a href="#part4">PART 4 — Deeper Understanding</a>
    <a href="#part5">PART 5 — Optional Plot Guide</a>
    <div class="mini">
      <div><span class="tag ok">Model</span> 1D electrostatics, series layers</div>
      <div><span class="tag warn">Key</span> Air-gap dominates when dielectric is high-κ</div>
      <div><span class="tag danger">Result</span> κ<sub>app,max</sub> ≈ 1/q + 1</div>
    </div>
  </nav>

  <main>
    <article>
      <section id="quick">
        <h2>Quick Summary</h2>
        <div class="card">
          <ul>
            <li><strong>What this is about:</strong> How a small air gap between capacitor plates and a dielectric slab corrupts dielectric-constant measurements.</li>
            <li><strong>Key physics idea:</strong> Layers along the field direction behave as <em>capacitors in series</em>, so the smallest permittivity layer (air) can dominate.</li>
            <li><strong>Governing equations:</strong> Electrostatics with <code>∇×E = 0</code>, <code>∇·D = ρ_f</code>, and interface conditions; plus the series-capacitance relation.</li>
            <li><strong>Main formula:</strong> Apparent (measured) dielectric constant (relative permittivity) inferred from total thickness is
              <code>κ_app = (1+q)κ / (1 + qκ)</code>.</li>
            <li><strong>Highest possible apparent κ:</strong> As true <code>κ → ∞</code>, the measurement saturates at
              <code>κ_app,max = (1+q)/q ≈ 1/q + 1</code>.</li>
            <li><strong>For q = 10^-3:</strong> <strong>κ<sub>app,max</sub> ≈ 1001</strong>. Even an “infinite-κ” dielectric cannot measure above ~1001 if an air gap is 0.1% of the dielectric thickness.</li>
            <li><strong>Industrial meaning:</strong> Contact quality, surface roughness, and voids can set a hard ceiling on measured κ and cause large underestimation for high-κ materials.</li>
            <li><strong>Result type:</strong> Symbolic + one key numeric evaluation for <code>q = 10^-3</code>.</li>
          </ul>
        </div>
        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <div class="card">
            <h3>Core definitions (symbols + SI units)</h3>
            <ul>
              <li><strong>A</strong>: plate area (m²)</li>
              <li><strong>d</strong>: dielectric thickness (m)</li>
              <li><strong>qd</strong>: air-gap thickness (m), with <strong>q</strong> dimensionless (gap fraction)</li>
              <li><strong>V</strong>: applied voltage (V)</li>
              <li><strong>E</strong>: electric field (V/m)</li>
              <li><strong>D</strong>: electric displacement (C/m²)</li>
              <li><strong>ε₀</strong>: vacuum permittivity (F/m)</li>
              <li><strong>κ</strong>: relative permittivity of dielectric (dimensionless), sometimes written ε<sub>r</sub></li>
              <li><strong>C</strong>: capacitance (F)</li>
            </ul>
          </div>

          <div class="card">
            <h3>Physical meaning (intuition)</h3>
            <ul>
              <li><strong>κ</strong> tells how much a material polarizes, reducing the required field for a given free charge: <code>D = ε₀κ E</code> in linear isotropic dielectrics.</li>
              <li>In <strong>series layers</strong>, the same free surface charge flows onto all layers → the same <strong>D</strong> passes through each layer (1D case).</li>
              <li>Voltage drops add: <code>V = ∫ E·dl</code>. A thin low-κ layer can take a big share of the voltage.</li>
            </ul>
          </div>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag ok">Key laws</span>
            <strong>Electrostatics in layered media</strong>
          </div>
          <ul>
            <li><strong>Field is conservative:</strong> <code>∇×E = 0</code> ⇒ in 1D, <code>E = -dφ/dz</code>.</li>
            <li><strong>Gauss law for D:</strong> <code>∇·D = ρ_f</code>. In the dielectric/air bulk, <code>ρ_f = 0</code> ⇒ <code>∂D_z/∂z = 0</code> ⇒ <strong>D<sub>z</sub> is constant</strong> through the stack.</li>
            <li><strong>Constitutive law (linear isotropic):</strong> <code>D = ε E</code> with <code>ε = ε₀κ</code> (dielectric), and <code>ε = ε₀</code> (air, κ≈1).</li>
            <li><strong>Interface conditions:</strong> tangential <code>E</code> continuous; normal <code>D</code> jumps only by free surface charge. With no free charge at the internal interface, <strong>D<sub>n</sub> is continuous</strong>.</li>
          </ul>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="card">
            <h3>Common models/approximations (and why)</h3>
            <ul>
              <li><strong>Parallel-plate, 1D field:</strong> assumes lateral dimensions ≫ thickness, neglect fringing.</li>
              <li><strong>Uniform layers:</strong> each region has constant ε (piecewise constant material model).</li>
              <li><strong>Air as κ=1:</strong> good at standard conditions; small deviations don’t change the main conclusion.</li>
              <li><strong>Linear dielectric:</strong> D proportional to E; valid if not near breakdown or strong nonlinearity.</li>
            </ul>
          </div>

          <div class="card">
            <h3>What to watch for (pitfalls)</h3>
            <ul>
              <li><strong>Series vs parallel confusion:</strong> Layers along the field are series; side-by-side patches are parallel.</li>
              <li><strong>Which thickness is used in “apparent κ”:</strong> instrument/user often divides by total thickness (dielectric + gap) as if uniform.</li>
              <li><strong>High-κ trap:</strong> larger κ makes the air gap <em>more</em> dominant (counterintuitive but true).</li>
              <li><strong>Breakdown risk:</strong> most voltage can concentrate in the air gap, raising E there.</li>
            </ul>
          </div>
        </div>

        <details>
          <summary>Mini intuition examples (quick, minimal algebra)</summary>
          <ul>
            <li>If you stack a “good conductor” and an “insulator” in series for current flow, the insulator limits the current. Similarly, for electric displacement in series layers, the low-permittivity layer limits capacitance.</li>
            <li>If κ is huge, the dielectric needs only a tiny field to support a given D, so its voltage drop is tiny; nearly all V appears across the air gap.</li>
          </ul>
        </details>

        <div class="callout" style="margin-top:12px;">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag warn">Math Insight</span>
            <strong>The core equation as a mathematical object</strong>
          </div>
          <p style="margin:0;">
            In 1D electrostatics with piecewise-constant ε(z), <code>∇·D = 0</code> becomes
            <code>d/dz ( ε(z) dφ/dz ) = 0</code>, a <strong>conservation form</strong> ODE.
            It implies the “flux” <code>D_z = -ε(z) dφ/dz</code> is constant—exactly like steady heat conduction where
            heat flux is constant through layers. This is why series “resistances” (here: <code>t/ε</code>) add.
          </p>
        </div>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part0b">
        <h2>PART 0B — Industry &amp; Applied Physics Perspective</h2>

        <div class="card">
          <h3>Where this shows up (at least 3 concrete areas)</h3>
          <ul>
            <li><strong>High-κ ceramic capacitors (MLCCs):</strong> porosity/voids act like air gaps and reduce effective κ and capacitance.</li>
            <li><strong>Semiconductor gate stacks &amp; thin films:</strong> interfacial layers (native oxides, contamination, microgaps) dominate effective dielectric behavior.</li>
            <li><strong>Polymer dielectrics &amp; insulation systems:</strong> delamination, trapped air, and roughness create series low-ε regions, impacting HV performance.</li>
            <li><strong>Metrology / QA:</strong> dielectric constant measurement fixtures (LCR meters + test cells) are sensitive to contact and surface flatness.</li>
          </ul>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="card">
            <h3>Why engineers care</h3>
            <ul>
              <li><strong>Performance:</strong> capacitance, impedance, energy density (J/m³) scale with effective ε.</li>
              <li><strong>Reliability &amp; safety:</strong> voltage concentrates in air gaps → higher local E → partial discharge and breakdown risk.</li>
              <li><strong>Cost &amp; yield:</strong> tighter flatness/pressure/cleanliness specs may be needed to avoid systematic underestimation of κ.</li>
              <li><strong>Manufacturability:</strong> surface roughness, warpage, and fixture compliance determine microscopic gap formation.</li>
            </ul>
          </div>

          <div class="card">
            <h3>Typical validation methods (brief)</h3>
            <ul>
              <li><strong>LCR meter capacitance</strong> with guarded electrodes to reduce fringing.</li>
              <li><strong>Impedance spectroscopy</strong> to separate interfacial effects (often modeled as series/parallel RC elements).</li>
              <li><strong>Cross-section microscopy</strong> (SEM/optical) to detect voids, porosity, and interfacial layers.</li>
              <li><strong>Surface metrology</strong> (profilometry) to quantify roughness that can produce micro air gaps.</li>
            </ul>
          </div>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag ok">From lab to product</span>
            <strong>How the ideal model is adapted</strong>
          </div>
          <p style="margin:0;">
            Real systems rarely have a single uniform air layer: instead there are <em>distributed micro-voids</em>, roughness peaks,
            and imperfect contact. Engineers often replace “one gap” by an <strong>effective series thickness</strong> (or a distribution of thicknesses),
            and then validate the equivalent circuit against frequency-dependent measurements (where interfacial polarization and losses may appear).
          </p>
        </div>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <div class="card">
          <h3>Problem restatement</h3>
          <p style="margin:0;">
            A parallel-plate capacitor contains a dielectric slab (thickness <code>d</code>, relative permittivity <code>κ</code>)
            but there is also a thin air gap between the slab and one plate with thickness <code>q d</code> (air has <code>κ=1</code>).
            You measure the capacitance and infer an “apparent” dielectric constant as if the full thickness were filled with a single uniform dielectric.
            <strong>Discuss the effect</strong> of the air gap on measuring high κ, and find the <strong>highest apparent κ</strong> possible when <code>q = 10^-3</code>.
          </p>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="card">
            <h3>Given</h3>
            <ul>
              <li>Dielectric thickness: <code>d</code></li>
              <li>Air gap thickness: <code>q d</code>, with <code>q = 10^-3</code></li>
              <li>Dielectric relative permittivity: <code>κ</code> (possibly large)</li>
              <li>Geometry: parallel plates, area <code>A</code> (implicitly large compared to thickness)</li>
            </ul>
          </div>
          <div class="card">
            <h3>Unknowns / to find</h3>
            <ul>
              <li><code>κ_app(κ, q)</code>: apparent relative permittivity inferred from measured C</li>
              <li><code>κ_app,max</code> as <code>κ → ∞</code> for <code>q = 10^-3</code></li>
              <li>Physical discussion: why high-κ measurements are distorted</li>
            </ul>
          </div>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag warn">Relevant principles</span>
            <strong>Why these laws apply (and others don’t)</strong>
          </div>
          <ul>
            <li>Electrostatics applies because we consider DC/low-frequency capacitance: no time-varying magnetic induction needed (<code>∂B/∂t</code> negligible) so <code>∇×E=0</code>.</li>
            <li>We use <code>∇·D=ρ_f</code> and interface conditions because layered dielectrics redistribute field while preserving free charge continuity.</li>
            <li>No need for wave equations (<code>∇²E - (1/c²)∂²E/∂t²</code>) because this is quasistatic capacitance, not propagation.</li>
          </ul>
        </div>

        <div class="card" style="margin-top:12px;">
          <h3>Explicit assumptions</h3>
          <ul>
            <li><strong>1D field:</strong> fringing neglected; E points normal to plates.</li>
            <li><strong>Linear, isotropic media:</strong> <code>D = εE</code> with constant ε in each layer.</li>
            <li><strong>Perfect conductors:</strong> plates are equipotentials; all voltage drops across dielectric/air.</li>
            <li><strong>No free charge</strong> at the internal air–dielectric interface (aside from bound polarization charge).</li>
          </ul>
        </div>

        <div class="card" style="margin-top:12px;">
          <h3>Possible approaches (compare 2–3)</h3>
          <ul>
            <li><strong>Equivalent series capacitors:</strong>
              treat air and dielectric as two capacitors in series. <em>Pros:</em> fast, intuitive. <em>Cons:</em> must justify with field continuity.</li>
            <li><strong>Field/flux derivation from Maxwell equations:</strong>
              solve 1D conservation ODE <code>d/dz(ε dφ/dz)=0</code>. <em>Pros:</em> rigorous; shows why series addition appears. <em>Cons:</em> more steps.</li>
            <li><strong>Energy method:</strong>
              compute stored energy <code>U = (1/2)∫ E·D dV</code> and identify C via <code>U=(1/2)CV²</code>. <em>Pros:</em> robust. <em>Cons:</em> algebra similar to flux method.</li>
          </ul>
          <p style="margin:8px 0 0; color:var(--muted);">
            <strong>Best choice:</strong> the Maxwell + 1D flux method (rigorous) while noting it matches the series-capacitor shortcut.
          </p>
        </div>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>

        <div class="card">
          <ol style="margin:8px 0 0 18px;">
            <li><strong>Set coordinates:</strong> choose z normal to plates; define layer domains (air thickness qd, dielectric thickness d).</li>
            <li><strong>Use electrostatics:</strong> apply <code>∇×E=0</code> and <code>∇·D=0</code in each layer → constant <code>D_z</code>.</li>
            <li><strong>Relate E to D:</strong> in each layer, <code>E = D/ε</code> with ε piecewise constant.</li>
            <li><strong>Add voltage drops:</strong> <code>V = ∫ E dz = E_air(qd) + E_diel(d)</code>.</li>
            <li><strong>Relate D to charge:</strong> <code>Q = D A</code>.</li>
            <li><strong>Compute capacitance:</strong> <code>C = Q/V</code>.</li>
            <li><strong>Define apparent κ:</strong> equate <code>C</code> to a uniform-slab form using total thickness <code>d(1+q)</code>, solve for <code>κ_app</code>.</li>
            <li><strong>Find maximum:</strong> take limit <code>κ→∞</code> (high-κ regime) to get <code>κ_app,max</code>.</li>
            <li><strong>Evaluate for q=10^-3</strong> and interpret physically.</li>
          </ol>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag danger">Common mistakes</span>
            <strong>Quick tips</strong>
          </div>
          <ul>
            <li>Don’t average permittivities directly; for series layers you average <strong>thickness/ε</strong> (harmonic-type averaging).</li>
            <li>Be clear about the thickness used for “apparent κ”: here it’s the <strong>total</strong> thickness <code>d + qd</code>.</li>
            <li>In high-κ limit, expect saturation—not unbounded growth—because the air gap behaves like a bottleneck.</li>
          </ul>
        </div>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <div class="callout">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag ok">Physical intuition first</span>
            <strong>What we expect before calculating</strong>
          </div>
          <p style="margin:0;">
            If the dielectric has very large κ, it can support a given displacement <code>D</code> with a very small field
            (<code>E = D/(ε₀κ)</code>), so its voltage drop becomes small. The air gap (κ≈1) then takes most of the voltage,
            and the total capacitance is limited by the air layer. Therefore, the measured κ should <strong>stop increasing</strong>
            once κ is large enough: the reading <em>saturates</em>.
          </p>
        </div>

        <h3>Mathematical model (variables, domain, coordinates, boundary conditions)</h3>
        <div class="card">
          <ul>
            <li><strong>Coordinate:</strong> z-axis normal to plates, with z=0 at the bottom plate and z = d(1+q) at the top plate.</li>
            <li><strong>Domains:</strong>
              <ul>
                <li>Air region: <code>0 &lt; z &lt; qd</code>, permittivity <code>ε_air = ε₀</code></li>
                <li>Dielectric region: <code>qd &lt; z &lt; qd + d</code>, permittivity <code>ε_d = ε₀ κ</code></li>
              </ul>
            </li>
            <li><strong>Unknown fields:</strong> potential <code>φ(z)</code>, electric field <code>E(z) = -dφ/dz</code>, displacement <code>D(z)</code>.</li>
            <li><strong>Governing equations (electrostatics):</strong>
              <ul>
                <li><code>∇×E = 0</code> ⇒ <code>E = -∇φ</code></li>
                <li><code>∇·D = ρ_f</code>, and in the bulk layers <code>ρ_f=0</code></li>
                <li>Constitutive: <code>D = ε(z) E</code> with piecewise-constant <code>ε(z)</code></li>
              </ul>
            </li>
            <li><strong>Boundary conditions:</strong> plates are equipotential, so
              <code>φ(0)=0</code>, <code>φ(d(1+q))=V</code>.
              At the internal interface (z=qd) with no free charge, <code>D_n</code> is continuous.</li>
          </ul>
        </div>

        <h3>Step 1: Reduce Maxwell’s equations to a 1D conservation ODE</h3>
        <p>
          In each layer, <code>ρ_f=0</code>, so <code>∇·D=0</code>. In 1D (fields depend only on z and point along z),
          this becomes:
        </p>

        <div class="eqblock" data-copy="eq1">
          <div class="eqhead">
            <div class="label"><span class="tag ok">Key equation</span> 1D Gauss law (bulk)</div>
            <button class="btn" data-copy-btn="eq1">Copy equation</button>
          </div>
          <pre id="eq1">∇·D = 0  ⇒  dD_z/dz = 0  ⇒  D_z = constant through both layers</pre>
        </div>

        <p>
          This step is valid because (i) the system is electrostatic (no time-varying magnetic induction), (ii) there is no
          free charge in the bulk, and (iii) symmetry + parallel plates justify 1D dependence.
        </p>

        <h3>Step 2: Express E in each region using the constitutive law</h3>
        <p>
          Since <code>D_z</code> is the same constant in both layers, and <code>D = εE</code>, we have:
        </p>

        <div class="eqblock" data-copy="eq2">
          <div class="eqhead">
            <div class="label"><span class="tag ok">Key equation</span> Fields in each layer</div>
            <button class="btn" data-copy-btn="eq2">Copy equation</button>
          </div>
          <pre id="eq2">Air:      E_air = D/ε0
Dielectric:E_d   = D/(ε0 κ)</pre>
        </div>

        <p>
          Note the <strong>high-κ implication</strong>: for the same D, <code>E_d</code> is reduced by a factor κ compared to air.
        </p>

        <h3>Step 3: Add voltage drops across the two layers</h3>
        <p>
          Because <code>∇×E=0</code>, the potential difference is path-independent and equals the line integral:
          <code>V = ∫ E·dl</code>. Along z:
        </p>

        <div class="eqblock" data-copy="eq3">
          <div class="eqhead">
            <div class="label"><span class="tag ok">Key equation</span> Voltage addition (series)</div>
            <button class="btn" data-copy-btn="eq3">Copy equation</button>
          </div>
          <pre id="eq3">V = ∫_0^{qd} E_air dz + ∫_{qd}^{qd+d} E_d dz
  = E_air (qd) + E_d (d)
  = (D/ε0)(qd) + (D/(ε0 κ))(d)</pre>
        </div>

        <p>
          Substitute and factor:
          <code>V = (D/ε0) d ( q + 1/κ )</code>.
        </p>

        <h3>Step 4: Relate displacement to free charge and compute C</h3>
        <p>
          The free charge on a plate equals flux of D through the plate area:
          <code>Q = ∫ D·n dA = D A</code> (uniform field).
          Therefore:
        </p>

        <div class="eqblock" data-copy="eq4">
          <div class="eqhead">
            <div class="label"><span class="tag ok">Key equation</span> Capacitance with an air gap</div>
            <button class="btn" data-copy-btn="eq4">Copy equation</button>
          </div>
          <pre id="eq4">C = Q/V = (D A) / [ (D/ε0) d ( q + 1/κ ) ]
  = ε0 A / [ d( q + 1/κ ) ]
  = ε0 A / ( d/κ + q d )</pre>
        </div>

        <p>
          <strong>Dimensional check:</strong> denominator has meters; numerator <code>ε0 A</code> has units F·m → F, correct.
        </p>

        <details>
          <summary>Connection to the “series capacitors” shortcut</summary>
          <p>
            If you define <code>C_air = ε0 A / (qd)</code> and <code>C_d = ε0 κ A / d</code>, then
            <code>1/C = 1/C_air + 1/C_d = (qd)/(ε0 A) + d/(ε0 κ A)</code>, which is identical to the derived formula.
            The shortcut is valid because the 1D Maxwell equations enforce constant D and additive voltage drops.
          </p>
        </details>

        <h3>Step 5: Define the “apparent” dielectric constant κ<sub>app</sub></h3>
        <p>
          A common measurement mistake is to treat the capacitor as if the entire <em>total thickness</em>
          <code>t_total = d + qd = d(1+q)</code> were filled with a uniform dielectric of relative permittivity κ<sub>app</sub>:
        </p>

        <div class="eqblock" data-copy="eq5">
          <div class="eqhead">
            <div class="label"><span class="tag warn">Inference model</span> What the measurement assumes</div>
            <button class="btn" data-copy-btn="eq5">Copy equation</button>
          </div>
          <pre id="eq5">Assumed model:  C = ε0 κ_app A / [ d(1+q) ]</pre>
        </div>

        <p>
          Equate this assumed form to the true C found above:
        </p>
        <pre>ε0 κ_app A / [ d(1+q) ]  =  ε0 A / [ d( q + 1/κ ) ]</pre>
        <p>
          Cancel <code>ε0 A / d</code> (valid by linearity and uniform geometry) and solve:
        </p>

        <div class="eqblock" data-copy="eq6">
          <div class="eqhead">
            <div class="label"><span class="tag ok">Result</span> Apparent dielectric constant</div>
            <button class="btn" data-copy-btn="eq6">Copy equation</button>
          </div>
          <pre id="eq6">κ_app = (1+q) / ( q + 1/κ )
      = (1+q)κ / (1 + qκ)</pre>
        </div>

        <h3>Step 6: Highest possible apparent κ (high-κ limit)</h3>
        <p>
          For measuring “high dielectric constants,” the important asymptotic limit is <code>κ → ∞</code>. Take the limit:
        </p>
        <pre>κ_app(κ,q) = (1+q)κ/(1+qκ)
As κ → ∞:  divide numerator and denominator by κ:
κ_app → (1+q)/(q) = 1/q + 1</pre>

        <div class="eqblock" data-copy="finaleq">
          <div class="eqhead">
            <div class="label"><span class="tag danger">Final answer</span> Maximum apparent κ</div>
            <button class="btn secondary" data-copy-btn="finaleq">Copy final answer</button>
          </div>
          <pre id="finaleq">κ_app,max = (1+q)/q = 1/q + 1</pre>
        </div>

        <p>
          Now insert <code>q = 10^-3</code>:
        </p>
        <pre>κ_app,max = 1/(10^-3) + 1 = 1000 + 1 = 1001</pre>

        <div class="callout" style="margin-top:12px;">
          <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
            <span class="tag danger">Interpretation</span>
            <strong>What this means physically</strong>
          </div>
          <p style="margin:0;">
            A gap only <strong>0.1%</strong> as thick as the dielectric slab can impose a hard ceiling:
            the measured dielectric constant cannot exceed about <strong>1001</strong>, even if the true κ is far larger.
            The air layer “steals” most of the voltage because it has the smallest permittivity, so the stack behaves almost like an air capacitor.
          </p>
        </div>

        <h3>One simple static plot (helps learning): κ<sub>app</sub> vs κ for q = 10<sup>-3</sup></h3>
        <figure>
          <canvas id="plot" width="900" height="520" aria-label="Plot of apparent dielectric constant versus true dielectric constant"></canvas>
          <figcaption>
            Example curve using the exact formula <code>κ_app=(1+q)κ/(1+qκ)</code> with <code>q=10^-3</code>.
            Note the saturation near <code>κ_app≈1001</code>.
          </figcaption>
        </figure>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <div class="card">
          <h3>Re-interpreting the final formula</h3>
          <p style="margin:0;">
            The expression
            <code>κ_app = (1+q)κ/(1+qκ)</code>
            is a <strong>saturating rational function</strong> of κ:
          </p>
          <ul>
            <li>For small κ (specifically <code>qκ ≪ 1</code>): <code>κ_app ≈ (1+q)κ</code> (almost proportional; small correction from total thickness).</li>
            <li>For large κ (<code>qκ ≫ 1</code>): <code>κ_app ≈ (1+q)/q</code> (independent of κ; gap-limited).</li>
          </ul>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout">
            <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
              <span class="tag warn">Scaling / nondimensionalization</span>
              <strong>One parameter controls the distortion</strong>
            </div>
            <p style="margin:0;">
              Define the dimensionless product <code>α = qκ</code>. Then
              <code>κ_app = (1+q)κ/(1+α)</code>.
              The crossover occurs around <code>α≈1</code>, i.e. <strong>κ≈1/q</strong>.
              For <code>q=10^-3</code>, distortion becomes severe for κ of order <code>10^3</code> and above.
            </p>
          </div>

          <div class="callout">
            <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px;">
              <span class="tag danger">High-field warning</span>
              <strong>Voltage concentrates in the air gap</strong>
            </div>
            <p style="margin:0;">
              Since <code>E_air/E_d = κ</code>, the air gap can experience a much larger electric field than the dielectric.
              In high-κ measurements this can trigger breakdown or partial discharge in the gap before the dielectric itself fails.
            </p>
          </div>
        </div>

        <details>
          <summary>Alternative derivation idea (energy method)</summary>
          <p>
            Compute energy density <code>u = (1/2)E·D</code> in each region and integrate:
            <code>U = (1/2)A[ E_air D (qd) + E_d D (d) ]</code>.
            Substitute <code>E_air=D/ε0</code> and <code>E_d=D/(ε0κ)</code> to obtain
            <code>U = (1/2)A D^2 (qd/ε0 + d/(ε0κ))</code>.
            With <code>Q=DA</code> and <code>U=(1/2)Q^2/C</code>, you recover
            <code>1/C = qd/(ε0A) + d/(ε0κA)</code>.
          </p>
        </details>

        <div class="card" style="margin-top:12px;">
          <h3>Concept check (self-test with answers)</h3>
          <ul>
            <li><strong>Q:</strong> If κ increases, does capacitance always increase? <br><strong>A:</strong> Only up to a point; with an air gap, C saturates because the air layer limits it.</li>
            <li><strong>Q:</strong> Why do we add thickness/ε rather than ε directly? <br><strong>A:</strong> Because in 1D the conserved quantity is D (flux), and V is an integral of E = D/ε, giving additive contributions proportional to thickness/ε.</li>
            <li><strong>Q:</strong> When does the air gap become “dominant”? <br><strong>A:</strong> When <code>qκ ≳ 1</code> (i.e., κ comparable to 1/q).</li>
            <li><strong>Q:</strong> For q=10^-3 and κ=5000, is κ_app close to 5000? <br><strong>A:</strong> No, it will be near the cap ~1001.</li>
          </ul>
        </div>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>

      <section id="part5">
        <h2>PART 5 — Optional Plot Guide</h2>
        <div class="card">
          <ul>
            <li><strong>What it shows:</strong> The apparent dielectric constant <code>κ_app</code> rising with true <code>κ</code> at first, then saturating.</li>
            <li><strong>Axes:</strong> x-axis = true <code>κ</code> (dimensionless), y-axis = apparent <code>κ_app</code> (dimensionless).</li>
            <li><strong>Example values:</strong> The plot uses <code>q = 10^-3</code> exactly (this is given by the problem).</li>
            <li><strong>Features to notice:</strong>
              <ul>
                <li>A “knee” near <code>κ ≈ 1/q = 1000</code>.</li>
                <li>A horizontal asymptote at <code>κ_app ≈ (1+q)/q ≈ 1001</code>.</li>
              </ul>
            </li>
          </ul>
        </div>

        <div class="eqblock" data-copy="finalplain">
          <div class="eqhead">
            <div class="label"><span class="tag danger">Final (plain text)</span> Copy-friendly</div>
            <button class="btn secondary" data-copy-btn="finalplain">Copy</button>
          </div>
          <pre id="finalplain">Air gap qd in series with dielectric d (relative permittivity κ):
C = ε0 A / ( d/κ + qd )

If one infers κ_app assuming uniform thickness d(1+q):
κ_app = (1+q)κ / (1 + qκ)

Maximum apparent κ occurs as κ → ∞:
κ_app,max = (1+q)/q = 1/q + 1

For q = 10^-3: κ_app,max = 1001</pre>
        </div>

        <a class="backtop" href="#top">Back to top ↑</a>
      </section>
    </article>
  </main>
</div>

<footer>
  <p>
    Notes: This treatment assumes ideal parallel plates (negligible fringing), linear isotropic media, and a uniform air-gap thickness.
    In practice, roughness/voids create spatially varying gaps that can be modeled by effective series layers or mixed series-parallel networks.
  </p>
</footer>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
  // ---------- Copy buttons ----------
  const toast = document.getElementById('toast');
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove('show'), 1400);
  }

  async function copyTextFrom(el){
    const text = el.innerText.trim();
    try{
      await navigator.clipboard.writeText(text);
      showToast('Copied ✓');
    }catch(e){
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      showToast('Copied ✓');
    }
  }

  document.querySelectorAll('[data-copy-btn]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-copy-btn');
      const el = document.getElementById(id);
      if(el) copyTextFrom(el);
    });
  });

  // ---------- Single static plot (canvas) ----------
  const canvas = document.getElementById('plot');
  const ctx = canvas.getContext('2d');

  function dprResize(c){
    const dpr = window.devicePixelRatio || 1;
    const rect = c.getBoundingClientRect();
    const w = Math.max(320, Math.floor(rect.width));
    const h = Math.floor(w * 0.58);
    c.style.height = h + 'px';

    c.width = Math.floor(w * dpr);
    c.height = Math.floor(h * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    return {w, h, dpr};
  }

  function niceTicks(min, max, n){
    const span = max - min;
    if(span <= 0) return [min];
    const raw = span / n;
    const p = Math.pow(10, Math.floor(Math.log10(raw)));
    const m = raw / p;
    let step;
    if(m < 1.5) step = 1*p;
    else if(m < 3.5) step = 2*p;
    else if(m < 7.5) step = 5*p;
    else step = 10*p;

    const t0 = Math.ceil(min/step)*step;
    const ticks = [];
    for(let t=t0; t<=max+1e-9; t+=step) ticks.push(t);
    return ticks;
  }

  function plot(){
    const {w, h} = dprResize(canvas);
    ctx.clearRect(0,0,w,h);

    // Plot settings
    const padL=64, padR=18, padT=32, padB=54;
    const xMin=0, xMax=5000; // true kappa range for illustration (no external data)
    const q = 1e-3;
    const yMin=0, yMax=1050; // show saturation near 1001

    function x2px(x){ return padL + (x - xMin) * (w - padL - padR) / (xMax - xMin); }
    function y2px(y){ return padT + (yMax - y) * (h - padT - padB) / (yMax - yMin); }

    // Background grid
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.12)';
    ctx.fillRect(0,0,w,h);
    ctx.restore();

    const xTicks = niceTicks(xMin, xMax, 6);
    const yTicks = niceTicks(yMin, yMax, 6);

    // Gridlines
    ctx.save();
    ctx.strokeStyle = 'rgba(233,236,255,0.12)';
    ctx.lineWidth = 1;
    xTicks.forEach(t=>{
      const X = x2px(t);
      ctx.beginPath();
      ctx.moveTo(X, padT);
      ctx.lineTo(X, h - padB);
      ctx.stroke();
    });
    yTicks.forEach(t=>{
      const Y = y2px(t);
      ctx.beginPath();
      ctx.moveTo(padL, Y);
      ctx.lineTo(w - padR, Y);
      ctx.stroke();
    });
    ctx.restore();

    // Axes
    ctx.save();
    ctx.strokeStyle = 'rgba(233,236,255,0.55)';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(padL, padT);
    ctx.lineTo(padL, h-padB);
    ctx.lineTo(w-padR, h-padB);
    ctx.stroke();
    ctx.restore();

    // Tick labels
    ctx.save();
    ctx.fillStyle = 'rgba(233,236,255,0.85)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    xTicks.forEach(t=>{
      const X=x2px(t);
      ctx.fillText(String(Math.round(t)), X, h-padB+10);
    });
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    yTicks.forEach(t=>{
      const Y=y2px(t);
      ctx.fillText(String(Math.round(t)), padL-10, Y);
    });
    ctx.restore();

    // Titles/labels
    ctx.save();
    ctx.fillStyle = 'rgba(233,236,255,0.92)';
    ctx.font = '14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('Apparent dielectric constant vs true dielectric constant (q = 10⁻³)', padL, 8);

    ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';
    ctx.fillText('True relative permittivity κ (dimensionless)', (padL + w-padR)/2, h-10);

    ctx.save();
    ctx.translate(18, (padT + h-padB)/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.fillText('Apparent relative permittivity κ_app (dimensionless)', 0, 0);
    ctx.restore();
    ctx.restore();

    // Curve: κ_app = (1+q)κ / (1 + qκ)
    ctx.save();
    ctx.strokeStyle = 'rgba(122,162,255,0.95)';
    ctx.lineWidth = 2.25;
    ctx.beginPath();
    const N=500;
    for(let i=0;i<=N;i++){
      const k = xMin + (xMax-xMin)*i/N;
      const kapp = ((1+q)*k)/(1+q*k);
      const X = x2px(k);
      const Y = y2px(kapp);
      if(i===0) ctx.moveTo(X,Y);
      else ctx.lineTo(X,Y);
    }
    ctx.stroke();
    ctx.restore();

    // Asymptote line at (1+q)/q
    const asym = (1+q)/q; // 1001
    ctx.save();
    ctx.strokeStyle = 'rgba(125,255,203,0.7)';
    ctx.setLineDash([6,5]);
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(padL, y2px(asym));
    ctx.lineTo(w-padR, y2px(asym));
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(125,255,203,0.85)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.textAlign='left';
    ctx.textBaseline='bottom';
    ctx.fillText('Saturation: κ_app,max = (1+q)/q ≈ ' + asym.toFixed(0), padL+8, y2px(asym)-6);
    ctx.restore();

    // Legend
    ctx.save();
    const lx = w - padR - 220, ly = padT + 8;
    ctx.fillStyle = 'rgba(16,26,58,0.75)';
    ctx.strokeStyle = 'rgba(233,236,255,0.18)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(lx, ly, 210, 60, 10);
    ctx.fill();
    ctx.stroke();

    // legend items
    ctx.strokeStyle = 'rgba(122,162,255,0.95)';
    ctx.lineWidth = 2.25;
    ctx.beginPath();
    ctx.moveTo(lx+14, ly+18);
    ctx.lineTo(lx+52, ly+18);
    ctx.stroke();

    ctx.strokeStyle = 'rgba(125,255,203,0.7)';
    ctx.setLineDash([6,5]);
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(lx+14, ly+40);
    ctx.lineTo(lx+52, ly+40);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = 'rgba(233,236,255,0.88)';
    ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign='left';
    ctx.textBaseline='middle';
    ctx.fillText('κ_app = (1+q)κ/(1+qκ)', lx+60, ly+18);
    ctx.fillText('Asymptote', lx+60, ly+40);
    ctx.restore();
  }

  // roundRect polyfill for older browsers
  if(!CanvasRenderingContext2D.prototype.roundRect){
    CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){
      r = Math.min(r, w/2, h/2);
      this.beginPath();
      this.moveTo(x+r, y);
      this.arcTo(x+w, y, x+w, y+h, r);
      this.arcTo(x+w, y+h, x, y+h, r);
      this.arcTo(x, y+h, x, y, r);
      this.arcTo(x, y, x+w, y, r);
      this.closePath();
      return this;
    };
  }

  const ro = new ResizeObserver(()=>plot());
  ro.observe(canvas);
  plot();
</script>
</body>
</html>