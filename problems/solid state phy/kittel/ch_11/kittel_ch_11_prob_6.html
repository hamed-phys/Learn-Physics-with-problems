<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Conduction-Electron Ferromagnetism (Stoner Model) — Derivation, Susceptibility Enhancement, and Instability</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1726;
      --panel2:#0c1422;
      --text:#e9eefc;
      --muted:#b8c3e6;
      --faint:#93a3d6;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,0.10);
      --line2:rgba(255,255,255,0.16);
      --shadow: 0 12px 30px rgba(0,0,0,0.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(900px 500px at 15% 0%, rgba(125,211,252,0.10), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(167,139,250,0.10), transparent 60%),
        linear-gradient(180deg, var(--bg), #070a10 70%);
      color:var(--text);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    header{
      position:relative;
      padding:34px 18px 10px;
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0 16px 56px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
    }

    .hero{
      max-width:1200px;
      margin:0 auto;
      padding:0 16px 8px;
    }

    .titleCard{
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px 18px 14px;
      overflow:hidden;
    }
    .titleCard h1{
      margin:0 0 8px;
      font-size: clamp(1.35rem, 1.1rem + 1.4vw, 2.1rem);
      letter-spacing:0.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:0.98rem;
      max-width:90ch;
    }

    /* Sticky TOC */
    nav.toc{
      position:sticky;
      top:12px;
      align-self:start;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px 14px 12px;
      overflow:hidden;
      min-height: 220px;
    }
    nav.toc .tocTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    nav.toc h2{
      margin:0;
      font-size:0.98rem;
      letter-spacing:0.2px;
    }
    nav.toc ul{
      margin:10px 0 0;
      padding:0 0 0 16px;
      color:var(--muted);
    }
    nav.toc li{ margin: 6px 0; }
    nav.toc a{
      color:var(--muted);
      font-size:0.95rem;
    }
    nav.toc a:hover{color:var(--text)}

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.03);
      border-radius: 999px;
      padding:6px 10px;
      font-size:0.84rem;
      color:var(--muted);
      user-select:none;
    }

    main{
      background: transparent;
    }

    section{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      margin-bottom:16px;
      overflow:hidden;
      transform: translateY(0);
      transition: transform 220ms ease, border-color 220ms ease;
    }
    section:hover{
      border-color: var(--line2);
      transform: translateY(-1px);
    }

    h2{
      margin:0 0 10px;
      font-size: 1.22rem;
      letter-spacing:0.2px;
    }
    h3{
      margin:16px 0 8px;
      font-size: 1.05rem;
      color: var(--text);
    }
    p{ margin: 10px 0; color: var(--text); }
    .muted{ color: var(--muted); }
    .small{ font-size:0.92rem; color:var(--muted); }
    .tight{ margin-top:6px; }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.015));
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px 12px 10px;
    }
    .callout{
      border-left: 4px solid var(--accent);
      background: rgba(125,211,252,0.07);
      padding:12px 12px 10px;
      border-radius: 12px;
      border:1px solid rgba(125,211,252,0.22);
    }
    .callout.warn{
      border-left-color: var(--warn);
      background: rgba(251,191,36,0.08);
      border-color: rgba(251,191,36,0.22);
    }
    .callout.bad{
      border-left-color: var(--bad);
      background: rgba(251,113,133,0.08);
      border-color: rgba(251,113,133,0.22);
    }
    .callout.ok{
      border-left-color: var(--ok);
      background: rgba(52,211,153,0.08);
      border-color: rgba(52,211,153,0.22);
    }

    .eqBox{
      background: rgba(0,0,0,0.25);
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px 12px 10px;
      overflow:auto;
      position:relative;
    }
    .eq{
      font-family: var(--mono);
      font-size: 0.95rem;
      color: #f4f7ff;
      white-space: pre;
      margin:0;
    }

    .btnRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    button.copy{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      border-radius: 999px;
      padding:8px 10px;
      font-size:0.88rem;
      cursor:pointer;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      user-select:none;
    }
    button.copy:hover{
      background: rgba(255,255,255,0.06);
      border-color: var(--line2);
      transform: translateY(-1px);
    }
    button.copy:active{ transform: translateY(0); }

    details{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:10px 12px;
      background: rgba(255,255,255,0.02);
      margin-top:10px;
    }
    summary{
      cursor:pointer;
      color: var(--muted);
      font-weight:600;
    }
    details[open] summary{ color: var(--text); }

    figure{
      margin: 12px 0 0;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(0,0,0,0.25);
      padding:10px;
      overflow:hidden;
    }
    figcaption{
      margin-top:8px;
      color: var(--muted);
      font-size:0.92rem;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius: 10px;
      background: rgba(255,255,255,0.02);
    }

    .backTop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      color: var(--muted);
      font-size:0.92rem;
    }
    .backTop:hover{ color: var(--text); }

    footer{
      max-width:1200px;
      margin: 0 auto;
      padding: 0 16px 30px;
      color: var(--muted);
      font-size:0.9rem;
    }

    /* Print-friendly */
    @media print{
      body{ background:#fff; color:#000; }
      nav.toc{ display:none; }
      .wrap{ grid-template-columns: 1fr; }
      section, .titleCard{ box-shadow:none; border:1px solid #ccc; }
      .eqBox{ background:#fff; }
      .callout, .card{ background:#fff; }
      button.copy{ display:none; }
      a{ color:#000; text-decoration:underline; }
      section{ break-inside: avoid; page-break-inside: avoid; }
      h2{ page-break-after: avoid; }
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      nav.toc{ position:relative; top:auto; }
      canvas{ height:280px; }
      .grid2, .grid3{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body id="top">
<header>
  <div class="hero">
    <div class="titleCard">
      <div class="pill" aria-label="Context pill">
        <span>Physics tutor mode</span>
        <span style="opacity:.6">•</span>
        <span>Applied & industrial lens</span>
        <span style="opacity:.6">•</span>
        <span>Math-rigorous</span>
      </div>
      <h1>Conduction-Electron Ferromagnetism (Stoner Model): Energy Minimization, Enhanced Susceptibility, and the Instability Criterion</h1>
      <p class="subtitle">
        We model exchange among conduction electrons by lowering the energy when spins are parallel (interaction energy −V) and neglecting antiparallel interactions. Using a spin-polarized free-electron gas plus Zeeman coupling, we derive the magnetization response and the <em>Stoner condition</em> for spontaneous ferromagnetism.
      </p>
    </div>
  </div>
</header>

<div class="wrap">
  <nav class="toc" aria-label="Table of contents">
    <div class="tocTitle">
      <h2>Table of Contents</h2>
      <span class="pill" title="Sticky navigation">Sticky</span>
    </div>
    <ul>
      <li><a href="#quick">Quick Summary</a></li>
      <li><a href="#part0">PART 0 — Concept Primer</a></li>
      <li><a href="#part0b">PART 0B — Industry & Applied Physics</a></li>
      <li><a href="#part1">PART 1 — Problem Analysis</a></li>
      <li><a href="#part2">PART 2 — Strategy & Tips</a></li>
      <li><a href="#part3">PART 3 — Full Solution</a></li>
      <li><a href="#part4">PART 4 — Deeper Understanding</a></li>
      <li><a href="#part5">PART 5 — Optional Plot Guide</a></li>
    </ul>
    <a class="backTop" href="#top" title="Back to top">↑ Back to top</a>
  </nav>

  <main>
    <section id="quick">
      <h2>Quick Summary</h2>
      <ul>
        <li><strong>What this is:</strong> A mean-field (Stoner-type) model for <strong>ferromagnetism of conduction electrons</strong> in a metal.</li>
        <li><strong>Key physics idea:</strong> Exchange lowers energy when spins are parallel, so spin polarization can reduce interaction energy, competing with the kinetic-energy cost of splitting two Fermi seas.</li>
        <li><strong>State variable:</strong> Spin polarization parameter <span class="muted">ζ</span> defined by <span class="muted">N± = (N/2)(1±ζ)</span>.</li>
        <li><strong>Governing energy functional:</strong> <span class="muted">E(ζ,B) = E<sub>kin</sub>(ζ) + E<sub>ex</sub>(ζ) + E<sub>Z</sub>(ζ,B)</span>, then minimize: <span class="muted">∂E/∂ζ = 0</span>.</li>
        <li><strong>Main result (linear response):</strong> Magnetization is
          <span class="muted">M = χB</span> with
          <span class="muted">χ = 3Nμ<sup>2</sup> / (2ε<sub>F</sub> − (3/2)VN)</span>,
          showing <strong>exchange enhances susceptibility</strong>.</li>
        <li><strong>Instability (Stoner condition):</strong> At <span class="muted">B=0</span>, the paramagnetic state becomes unstable when
          <span class="muted">V &gt; 4ε<sub>F</sub>/(3N)</span>, implying a spontaneous <span class="muted">ζ ≠ 0</span> state.</li>
        <li><strong>Result type:</strong> Fully <strong>symbolic</strong> (with a small illustrative plot of energy vs ζ using example values only).</li>
        <li><strong>Industrial relevance:</strong> Predicts when itinerant-electron magnetism emerges (materials selection, magnetic device performance, reliability under temperature/composition changes).</li>
      </ul>
    </section>

    <section id="part0">
      <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

      <div class="grid2">
        <div class="card">
          <h3>Core definitions (symbols + SI units)</h3>
          <ul class="tight">
            <li><strong>N</strong>: total number of conduction electrons in the sample (dimensionless count).</li>
            <li><strong>N<sub>+</sub>, N<sub>−</sub></strong>: numbers of spin-up / spin-down electrons (counts).</li>
            <li><strong>ζ</strong>: spin polarization (dimensionless), <span class="muted">ζ = (N<sub>+</sub> − N<sub>−</sub>)/N</span>, so <span class="muted">−1 ≤ ζ ≤ 1</span>.</li>
            <li><strong>ε<sub>F</sub></strong>: Fermi energy of the <em>unpolarized</em> gas (J).</li>
            <li><strong>E<sub>0</sub></strong>: kinetic energy of one spin band when unpolarized (J). (So total unpolarized kinetic energy is <span class="muted">2E<sub>0</sub></span>.)</li>
            <li><strong>V</strong>: effective exchange parameter (J per electron-pair in this simplified model).</li>
            <li><strong>μ</strong> (here μ = μ<sub>B</sub>): Bohr magneton (J/T).</li>
            <li><strong>B</strong>: applied magnetic field magnitude (T).</li>
            <li><strong>M</strong>: magnetization (A·m<sup>2</sup> in total-moment form, or A/m if divided by volume; here we treat <em>total magnetic moment</em> of N electrons: <span class="muted">M = μ(N<sub>+</sub> − N<sub>−</sub>)</span>).</li>
          </ul>
        </div>

        <div class="card">
          <h3>Physical meaning (intuition)</h3>
          <ul class="tight">
            <li><strong>Spin polarization costs kinetic energy:</strong> pushing more electrons into one spin species raises its Fermi level.</li>
            <li><strong>Exchange rewards polarization:</strong> parallel spins reduce energy by −V per interacting pair (in this toy model).</li>
            <li><strong>Zeeman energy biases polarization:</strong> a field lowers the energy of spins aligned with B and raises the opposite spins.</li>
            <li><strong>Ferromagnetism happens when:</strong> the exchange “reward” overcomes the kinetic “penalty,” causing spontaneous ζ ≠ 0 at B=0.</li>
          </ul>
        </div>
      </div>

      <h3>Key laws/principles and validity conditions</h3>
      <div class="callout">
        <ul class="tight">
          <li><strong>Variational/energy-minimization principle:</strong> equilibrium at fixed N and B is obtained by minimizing the thermodynamic potential; at T≈0 here we minimize the total energy <span class="muted">E(ζ,B)</span> w.r.t. ζ.</li>
          <li><strong>Free-electron (Fermi gas) scaling:</strong> for a 3D degenerate Fermi gas, kinetic energy scales like <span class="muted">E<sub>kin</sub> ∝ N<sup>5/3</sup></span> (at fixed volume) because <span class="muted">ε<sub>F</sub> ∝ n<sup>2/3</sup></span>.</li>
          <li><strong>Mean-field exchange:</strong> we encode exchange via a simple pair-counting term ∝ <span class="muted">−V N<sub>σ</sub><sup>2</sup></span> for each spin σ; antiparallel interactions neglected.</li>
          <li><strong>Small-polarization expansion:</strong> parts (b,c) explicitly assume <span class="muted">|ζ| ≪ 1</span>, meaning we keep terms up to O(ζ<sup>2</sup>) and neglect O(ζ<sup>4</sup>).</li>
        </ul>
      </div>

      <h3>Common models/approximations (and why)</h3>
      <div class="grid3">
        <div class="card">
          <h3 class="tight">Itinerant-electron (Stoner) picture</h3>
          <p class="small tight">Magnetism comes from conduction electrons (delocalized), not fixed local moments. Good for many transition metals/alloys in a first approximation.</p>
        </div>
        <div class="card">
          <h3 class="tight">T = 0 degenerate Fermi gas</h3>
          <p class="small tight">The energy is dominated by filled states up to ε<sub>F</sub>. Simplifies integrals and yields clean power laws.</p>
        </div>
        <div class="card">
          <h3 class="tight">Mean-field exchange as −V pairs</h3>
          <p class="small tight">Collapses complex Coulomb + antisymmetry physics into one parameter V capturing “how much” parallel-spin states are favored.</p>
        </div>
      </div>

      <h3>Mini intuition examples (minimal algebra)</h3>
      <ul>
        <li><strong>Example 1 (no exchange):</strong> With V=0, any ζ ≠ 0 only raises kinetic energy, so the ground state is ζ=0 (paramagnetic).</li>
        <li><strong>Example 2 (strong exchange):</strong> If V is huge, the system lowers energy by putting many electrons in one spin band (large |ζ|), indicating ferromagnetic order.</li>
        <li><strong>Example 3 (small B):</strong> A weak field induces a small ζ ∝ B. Exchange makes the slope larger (bigger susceptibility).</li>
      </ul>

      <h3>What to watch for (pitfalls)</h3>
      <div class="callout warn">
        <ul class="tight">
          <li><strong>Bookkeeping:</strong> always enforce <span class="muted">N = N<sub>+</sub> + N<sub>−</sub></span> and <span class="muted">N<sub>±</sub> = (N/2)(1±ζ)</span>.</li>
          <li><strong>Signs:</strong> Zeeman energy is <span class="muted">E<sub>Z</sub> = −μ B (N<sub>+</sub> − N<sub>−</sub>)</span> (lower for aligned spins).</li>
          <li><strong>Small-ζ expansion:</strong> odd powers cancel in <span class="muted">(1+ζ)^{5/3} + (1−ζ)^{5/3}</span>; keep O(ζ<sup>2</sup>) consistently.</li>
          <li><strong>Interpretation of M:</strong> here M is the <em>total moment</em>, not moment density; divide by volume if needed for A/m.</li>
        </ul>
      </div>

      <div class="callout">
        <h3 class="tight">Math Insight (core equation as a mathematical object)</h3>
        <p class="tight small">
          The equilibrium polarization ζ is found by minimizing a one-dimensional energy functional <span class="muted">E(ζ)</span>. Near ζ=0, this becomes a <strong>Landau-type expansion</strong>:
          <span class="muted">E(ζ) ≈ E(0) + a ζ<sup>2</sup> − b B ζ</span>.
          The sign of <span class="muted">a</span> determines stability (convexity) at ζ=0, and the linear term sets the linear response ζ ∝ B.
          Mathematically, stability is determined by <span class="muted">∂²E/∂ζ²</span> at ζ=0.
        </p>
      </div>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>

    <section id="part0b">
      <h2>PART 0B — Industry & Applied Physics Perspective</h2>
      <p>
        Although this problem is presented as a simplified model, the underlying mechanism—competition between band (kinetic) energy and exchange—directly informs how engineers
        think about <strong>magnetic metals, alloys, and spin-polarized transport</strong>.
      </p>

      <div class="grid3">
        <div class="card">
          <h3 class="tight">Where it appears (3+ applications)</h3>
          <ul class="tight small">
            <li><strong>Magnetic recording & sensors:</strong> selecting alloys with strong itinerant magnetism (read heads, MR/AMR sensors).</li>
            <li><strong>Spintronics:</strong> spin polarization controls spin injection, magnetoresistance, and device performance (e.g., spin valves).</li>
            <li><strong>Electrical steel & power devices:</strong> magnetic properties affect losses, heating, and efficiency in transformers/motors.</li>
            <li><strong>Materials engineering:</strong> alloying and heat treatment tune band structure and exchange, shifting ferromagnetic behavior.</li>
          </ul>
        </div>
        <div class="card">
          <h3 class="tight">Why engineers care</h3>
          <ul class="tight small">
            <li><strong>Performance:</strong> susceptibility and spontaneous magnetization set sensor sensitivity and actuation strength.</li>
            <li><strong>Reliability:</strong> magnetism changes with temperature/composition → drift, aging, and tolerance stack-up.</li>
            <li><strong>Cost/manufacturability:</strong> ferromagnetic alloys may require controlled processing to hit target magnetic parameters.</li>
          </ul>
        </div>
        <div class="card">
          <h3 class="tight">How it’s measured/validated</h3>
          <ul class="tight small">
            <li><strong>Magnetometry:</strong> VSM, SQUID for M(B,T).</li>
            <li><strong>Transport:</strong> magnetoresistance gives indirect spin polarization information.</li>
            <li><strong>Band-structure + DFT:</strong> estimates “Stoner parameter” and density of states at ε<sub>F</sub> to assess instability.</li>
          </ul>
        </div>
      </div>

      <h3>Design trade-offs & constraints</h3>
      <div class="callout warn">
        <ul class="tight">
          <li><strong>Real materials are not free-electron gases:</strong> band structure changes ε<sub>F</sub> and the effective exchange strength.</li>
          <li><strong>Finite temperature:</strong> smears the Fermi surface; the instability criterion becomes temperature-dependent.</li>
          <li><strong>Disorder & microstructure:</strong> grain boundaries and impurities affect both exchange and transport.</li>
          <li><strong>Device constraints:</strong> thermal budgets, mechanical stress, and manufacturing variability shift magnetic response.</li>
        </ul>
      </div>

      <details>
        <summary>From lab to product: how this ideal model gets adapted</summary>
        <p class="small">
          In practice, engineers replace the toy “V” by an effective Stoner parameter (or an exchange-correlation functional in DFT),
          and replace the free-electron density of states by the <em>actual</em> density of states near ε<sub>F</sub>.
          Microstructure and temperature are incorporated through empirical fits to M(B,T) and through process controls (annealing, alloy fraction, thin-film strain).
        </p>
      </details>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>

    <section id="part1">
      <h2>PART 1 — Problem Analysis (No solving yet)</h2>

      <h3>Problem restatement (in my own words)</h3>
      <p>
        We consider a metal where conduction electrons experience an effective exchange interaction:
        electrons with <em>parallel spins</em> interact with energy <span class="muted">−V</span> (V&gt;0), while electrons with antiparallel spins do not interact.
        Let the spin polarization be <span class="muted">ζ</span>, so the up/down populations are <span class="muted">N<sub>±</sub> = (N/2)(1±ζ)</span>.
        Using the 3D degenerate Fermi-gas kinetic energy scaling, we:
      </p>
      <ol>
        <li>(a) show the given expression for the up-spin energy <span class="muted">E<sup>+</sup></span> and write the analogous <span class="muted">E<sup>−</sup></span>;</li>
        <li>(b) minimize the total energy <span class="muted">E(ζ)</span> and, for <span class="muted">|ζ|≪1</span>, derive the magnetization
          <span class="muted">M = [3Nμ<sup>2</sup>/(2ε<sub>F</sub> − (3/2)VN)] B</span>;</li>
        <li>(c) set <span class="muted">B=0</span> and show ζ=0 is unstable when <span class="muted">V &gt; 4ε<sub>F</sub>/(3N)</span> (Stoner condition).</li>
      </ol>

      <div class="grid2">
        <div class="card">
          <h3>Given quantities</h3>
          <ul class="tight">
            <li>Exchange parameter <span class="muted">V &gt; 0</span>.</li>
            <li>Total electron number <span class="muted">N</span>.</li>
            <li>Field <span class="muted">B</span> and magnetic moment <span class="muted">μ</span> (μ = μ<sub>B</sub>).</li>
            <li>Reference kinetic-energy scale <span class="muted">E<sub>0</sub></span> and/or <span class="muted">ε<sub>F</sub></span> from the free-electron gas.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Unknowns / targets</h3>
          <ul class="tight">
            <li>Expression for <span class="muted">E<sup>−</sup></span>.</li>
            <li>Equilibrium polarization <span class="muted">ζ(B)</span> for small ζ.</li>
            <li>Magnetization <span class="muted">M(B)</span> (linear susceptibility).</li>
            <li>Instability criterion at <span class="muted">B=0</span>.</li>
          </ul>
        </div>
      </div>

      <h3>Relevant principles (why they apply)</h3>
      <ul>
        <li><strong>Degenerate Fermi gas energetics:</strong> the kinetic energy of each spin band is computed as an integral over occupied k-states up to k<sub>F,σ</sub>. This yields the <span class="muted">(1±ζ)^{5/3}</span> dependence.</li>
        <li><strong>Mean-field pair-counting exchange:</strong> interaction energy depends on the number of same-spin pairs (∝ N<sub>σ</sub><sup>2</sup>), giving a quadratic dependence in <span class="muted">(1±ζ)</span>.</li>
        <li><strong>Energy minimization:</strong> equilibrium ζ is found from <span class="muted">∂E/∂ζ = 0</span> at fixed N and B.</li>
      </ul>

      <h3>Assumptions (explicit)</h3>
      <div class="callout">
        <ul class="tight">
          <li><strong>3D free-electron-like band:</strong> kinetic energy uses the 3D Fermi gas formula (effective mass picture).</li>
          <li><strong>Only parallel-spin interaction:</strong> antiparallel interaction neglected by assumption.</li>
          <li><strong>T ≈ 0:</strong> sharp Fermi surface; no thermal smearing.</li>
          <li><strong>Small polarization in (b,c):</strong> <span class="muted">|ζ|≪1</span>, so we expand in ζ and keep up to O(ζ<sup>2</sup>).</li>
          <li><strong>Uniform system:</strong> no spatial dependence; no need for ∇ operators in the final algebra (but see “model” below).</li>
        </ul>
      </div>

      <h3>2–3 approaches (pros/cons)</h3>
      <div class="grid3">
        <div class="card">
          <h3 class="tight">Approach A: Direct minimization</h3>
          <p class="small tight">Write E(ζ) exactly from E<sup>±</sup> and set ∂E/∂ζ=0. Most straightforward; algebra heavier.</p>
        </div>
        <div class="card">
          <h3 class="tight">Approach B: Small-ζ Landau expansion</h3>
          <p class="small tight">Expand E(ζ) around ζ=0 to O(ζ<sup>2</sup>) and minimize. Best for susceptibility and stability; matches problem’s “ζ≪1” instruction.</p>
        </div>
        <div class="card">
          <h3 class="tight">Approach C: Chemical potentials</h3>
          <p class="small tight">Enforce μ<sub>+</sub>=μ<sub>−</sub> at equilibrium with exchange shifts. Insightful, but requires extra intermediate definitions.</p>
        </div>
      </div>

      <p class="muted">
        We will use <strong>Approach B</strong> for parts (b,c) because the problem explicitly asks for the <span class="muted">ζ≪1</span> limit and stability near ζ=0 is controlled by the quadratic term.
      </p>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>

    <section id="part2">
      <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

      <ol>
        <li><strong>Define polarization:</strong> set <span class="muted">N<sub>±</sub>=(N/2)(1±ζ)</span> and note <span class="muted">M=μ(N<sub>+</sub>−N<sub>−</sub>)=Nμζ</span>.</li>
        <li><strong>Kinetic energy per band:</strong> use 3D Fermi gas scaling <span class="muted">E<sub>kin,±</sub>=E<sub>0</sub>(1±ζ)^{5/3}</span>.</li>
        <li><strong>Exchange energy per band:</strong> count same-spin pairs to get <span class="muted">E<sub>ex,±</sub> = −(1/8)VN^2(1±ζ)^2</span>.</li>
        <li><strong>Zeeman term:</strong> write <span class="muted">E<sub>Z,+</sub>=−(1/2)NμB(1+ζ)</span>, <span class="muted">E<sub>Z,−</sub=+(1/2)NμB(1−ζ)</span>.</li>
        <li><strong>Add the bands:</strong> form <span class="muted">E(ζ,B)=E<sup>+</sup>+E<sup>−</sup></span>.</li>
        <li><strong>Small-ζ expansion:</strong> expand powers: <span class="muted">(1±ζ)^{5/3}</span> and <span class="muted">(1±ζ)^2</span> up to ζ<sup>2</sup>.</li>
        <li><strong>Minimize:</strong> compute <span class="muted">∂E/∂ζ=0</span>, solve ζ(B) to leading order, then convert to M(B).</li>
        <li><strong>Stability at B=0:</strong> inspect the sign of the ζ<sup>2</sup> coefficient (or <span class="muted">∂²E/∂ζ²|<sub>0</sub></span>).</li>
      </ol>

      <div class="callout warn">
        <h3 class="tight">Common mistakes (quick tips)</h3>
        <ul class="tight">
          <li>For the binomial expansion, don’t forget the factor <span class="muted">α(α−1)/2</span> in the ζ<sup>2</sup> term.</li>
          <li>Odd powers of ζ cancel in <span class="muted">(1+ζ)^{5/3}+(1−ζ)^{5/3}</span>; if they don’t, re-check algebra.</li>
          <li>Keep N fixed. The only variable you minimize over is ζ.</li>
          <li>Be consistent: μ in the final formula is μ<sub>B</sub>.</li>
        </ul>
      </div>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>

    <section id="part3">
      <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

      <h3>Qualitative expectation before calculating</h3>
      <p>
        If exchange favors parallel spins, then a small spin imbalance (ζ≠0) can lower interaction energy.
        But creating an imbalance forces one spin band to have a higher Fermi level, which costs kinetic energy.
        Therefore:
      </p>
      <ul>
        <li>For small V, kinetic cost dominates → ζ=0 at B=0, and M is small (Pauli-like paramagnetism).</li>
        <li>As V increases, the system responds more strongly to B (enhanced susceptibility).</li>
        <li>Above a threshold V, ζ=0 becomes unstable even with B=0 → spontaneous ferromagnetism.</li>
      </ul>

      <h3>Mathematical model (variables, domain, and operators)</h3>
      <div class="callout">
        <p class="small tight">
          We consider a spatially uniform electron gas in a volume Ω (not explicitly needed in the final expressions).
          The microscopic degrees of freedom (electron field operators) are averaged into a <strong>mean-field energy functional</strong> of a single scalar order parameter ζ:
        </p>
        <div class="eqBox" style="margin-top:10px">
<pre class="eq">Order parameter:  ζ = (N+ − N−)/N   with   N± = (N/2)(1±ζ),  −1 ≤ ζ ≤ 1.
Energy functional: E(ζ,B) = E+(ζ,B) + E−(ζ,B).
Equilibrium condition (variational): ∂E/∂ζ = 0  at fixed N and B.
Stability: ∂²E/∂ζ² > 0 at the minimum.</pre>
        </div>
        <p class="small tight">
          Since the system is uniform, no spatial differential operators (∇, ∇·, ∇×, ∇²) appear in the reduced model.
          Conceptually, the “operator content” is the variational derivative with respect to ζ (a finite-dimensional analogue of a functional derivative).
        </p>
      </div>

      <h3>(a) Energy of each spin band</h3>
      <p>
        The problem gives the up-spin (spin “+”) energy:
      </p>

      <div class="eqBox" id="eq-a">
<pre class="eq">E+ = E0(1+ζ)^(5/3)  −  (1/8) V N^2 (1+ζ)^2  −  (1/2) N μ B (1+ζ) .</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-a">Copy key equation (plain text)</button>
      </div>

      <p>
        The down-spin (spin “−”) band has the same kinetic and exchange structure, but the Zeeman energy flips sign because spins antiparallel to B are raised in energy:
      </p>

      <div class="eqBox" id="eq-a2">
<pre class="eq">E− = E0(1−ζ)^(5/3)  −  (1/8) V N^2 (1−ζ)^2  +  (1/2) N μ B (1−ζ) .</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-a2">Copy key equation (plain text)</button>
      </div>

      <p class="small muted">
        Why this is valid: (i) the 3D degenerate Fermi-gas kinetic energy scales as N<sub>σ</sub><sup>5/3</sup>,
        hence (1±ζ)<sup>5/3</sup>; (ii) same-spin pairs scale as N<sub>σ</sub><sup>2</sup>,
        and with N<sub>σ</sub> = (N/2)(1±ζ), we get N<sub>σ</sub><sup>2</sup> = (N<sup>2</sup>/4)(1±ζ)<sup>2</sup>,
        which produces the (1/8) prefactor when multiplied by −V/2-type pair counting in this simplified formulation.
      </p>

      <h3>Total energy and simplification</h3>
      <p>
        Add E<sup>+</sup> and E<sup>−</sup>:
      </p>

      <div class="eqBox" id="eq-total">
<pre class="eq">E(ζ,B)
= E0[(1+ζ)^(5/3) + (1−ζ)^(5/3)]
− (1/8) V N^2[(1+ζ)^2 + (1−ζ)^2]
− N μ B ζ.</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-total">Copy key equation (plain text)</button>
      </div>

      <p class="small muted">
        The Zeeman terms combine to −NμBζ because:
        −(1/2)NμB(1+ζ) + (1/2)NμB(1−ζ) = −NμBζ.
      </p>

      <h3>(b) Minimize and solve for ζ in the limit |ζ| ≪ 1</h3>

      <h4 style="margin:10px 0 6px; font-size:1.0rem;">Step 1: Expand the kinetic term to O(ζ²)</h4>
      <p class="small">
        Use the binomial/Taylor expansion for |ζ|≪1:
        <span class="muted">(1+x)^α = 1 + αx + α(α−1)x²/2 + O(x³)</span>.
        Here α = 5/3.
      </p>

      <div class="eqBox" id="eq-expand1">
<pre class="eq">(1±ζ)^(5/3)
= 1 ± (5/3)ζ + [(5/3)(2/3)/2] ζ^2 + O(ζ^3)
= 1 ± (5/3)ζ + (5/9)ζ^2 + O(ζ^3).</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-expand1">Copy expansion (plain text)</button>
      </div>

      <p class="small">
        Summing the + and − expansions cancels the odd term:
      </p>

      <div class="eqBox" id="eq-expand2">
<pre class="eq">(1+ζ)^(5/3) + (1−ζ)^(5/3)
= 2 + (10/9) ζ^2 + O(ζ^4).</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-expand2">Copy sum (plain text)</button>
      </div>

      <p class="small muted">
        Why O(ζ³) becomes O(ζ⁴): the cubic terms are odd in ζ and cancel in the sum; the next surviving term is ζ⁴.
      </p>

      <h4 style="margin:10px 0 6px; font-size:1.0rem;">Step 2: Expand the exchange term to O(ζ²)</h4>
      <div class="eqBox" id="eq-expand3">
<pre class="eq">(1±ζ)^2 = 1 ± 2ζ + ζ^2
⇒ (1+ζ)^2 + (1−ζ)^2 = 2 + 2ζ^2.</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-expand3">Copy expansion (plain text)</button>
      </div>

      <h4 style="margin:10px 0 6px; font-size:1.0rem;">Step 3: Assemble E(ζ,B) to quadratic order</h4>
      <p class="small">
        Insert the expansions into the total energy:
      </p>

      <div class="eqBox" id="eq-landau">
<pre class="eq">E(ζ,B)
= E0[2 + (10/9)ζ^2] − (1/8)VN^2[2 + 2ζ^2] − NμBζ + O(ζ^4)
= const + [ (10/9)E0 − (1/4)VN^2 ] ζ^2  − NμBζ + O(ζ^4).</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-landau">Copy quadratic energy (plain text)</button>
      </div>

      <h4 style="margin:10px 0 6px; font-size:1.0rem;">Step 4: Relate E0 to εF and simplify the coefficient</h4>
      <p class="small">
        For a 3D degenerate free-electron gas, the total kinetic energy (both spins) at ζ=0 is:
        <span class="muted">E<sub>kin</sub>(ζ=0) = (3/5)Nε<sub>F</sub></span>.
        Since <span class="muted">E<sub>kin</sub>(0)=E<sup>+</sup><sub>kin</sub>+E<sup>−</sup><sub>kin</sub>=2E0</span>, we have:
      </p>

      <div class="eqBox" id="eq-e0">
<pre class="eq">2E0 = (3/5)N εF   ⇒   E0 = (3/10)N εF.</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-e0">Copy relation (plain text)</button>
      </div>

      <p class="small">
        Then:
      </p>

      <div class="eqBox" id="eq-coeff">
<pre class="eq">(10/9)E0 = (10/9)*(3/10)NεF = (1/3)NεF.

So the quadratic coefficient becomes:
A ≡ (10/9)E0 − (1/4)VN^2 = (1/3)NεF − (1/4)VN^2
= (N/12)[ 4εF − 3VN ].</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-coeff">Copy coefficient (plain text)</button>
      </div>

      <h4 style="margin:10px 0 6px; font-size:1.0rem;">Step 5: Minimize (set ∂E/∂ζ = 0)</h4>
      <p class="small">
        To quadratic order:
        <span class="muted">E(ζ,B) = const + A ζ² − NμBζ</span>.
        Differentiate:
      </p>

      <div class="eqBox" id="eq-min">
<pre class="eq">∂E/∂ζ = 2Aζ − NμB = 0
⇒ ζ = (NμB)/(2A).</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-min">Copy minimization (plain text)</button>
      </div>

      <p class="small">
        Substitute <span class="muted">A = (N/12)(4εF − 3VN)</span>:
      </p>

      <div class="eqBox" id="eq-zeta">
<pre class="eq">ζ = (NμB) / [ 2*(N/12)(4εF − 3VN) ]
  = (NμB) / [ (N/6)(4εF − 3VN) ]
  = (6μB) / (4εF − 3VN)
  = (3μB) / (2εF − (3/2)VN).</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-zeta">Copy ζ(B) (plain text)</button>
      </div>

      <h4 style="margin:10px 0 6px; font-size:1.0rem;">Step 6: Convert ζ to magnetization M</h4>
      <p class="small">
        The total magnetic moment (magnetization in the “total moment” sense) is:
      </p>
      <div class="eqBox" id="eq-Mdef">
<pre class="eq">M = μ(N+ − N−) = μ(Nζ) = Nμζ.</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-Mdef">Copy M definition (plain text)</button>
      </div>

      <p class="small">Insert ζ(B):</p>
      <div class="eqBox" id="eq-final">
<pre class="eq">M = Nμ * [ (3μB) / (2εF − (3/2)VN) ]
  = [ 3Nμ^2 / (2εF − (3/2)VN) ] B.</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-final">Copy FINAL magnetization (plain text)</button>
        <button class="copy" data-copy-final="true">Copy Final Answer (plain text)</button>
      </div>

      <div class="callout ok" style="margin-top:12px">
        <h3 class="tight">FINAL ANSWER (boxed)</h3>
        <div class="eqBox" id="finalAnswerBox" style="margin-top:8px">
<pre class="eq">E− = E0(1−ζ)^(5/3) − (1/8)VN^2(1−ζ)^2 + (1/2)NμB(1−ζ)

For |ζ|≪1, minimizing E gives:
ζ = (3μB) / (2εF − (3/2)VN)

Magnetization:
M = Nμζ = [3Nμ^2 / (2εF − (3/2)VN)] B

Stability at B=0:
ζ=0 is unstable if V > 4εF/(3N)  (Stoner condition).</pre>
        </div>
      </div>

      <h3>Sanity checks</h3>
      <div class="grid2">
        <div class="card">
          <h3 class="tight">Units / dimensions</h3>
          <ul class="tight small">
            <li>ε<sub>F</sub> is energy (J). VN is also energy (since V multiplies N as a pair-counting scale in this model).</li>
            <li>μ is J/T, so μ²B has units (J²/T). Dividing by energy gives J/T, matching magnetic moment.</li>
            <li>Thus <span class="muted">M ∝ (μ²/energy) B</span> is dimensionally consistent.</li>
          </ul>
        </div>
        <div class="card">
          <h3 class="tight">Limiting cases</h3>
          <ul class="tight small">
            <li><strong>V → 0:</strong> <span class="muted">M → (3Nμ²/2εF)B</span> (Pauli-like scaling).</li>
            <li><strong>V increases:</strong> denominator decreases → susceptibility increases.</li>
            <li><strong>Approach instability:</strong> when <span class="muted">2εF − (3/2)VN → 0+</span>, the linear susceptibility diverges, signaling onset of spontaneous magnetization.</li>
          </ul>
        </div>
      </div>

      <h3>(c) Instability at B = 0 (Stoner criterion)</h3>
      <p class="small">
        Set B=0 in the quadratic expansion:
        <span class="muted">E(ζ,0) = const + A ζ² + O(ζ⁴)</span> with
        <span class="muted">A = (N/12)(4εF − 3VN)</span>.
        The paramagnetic state ζ=0 is stable if <span class="muted">A&gt;0</span> and unstable if <span class="muted">A&lt;0</span>.
      </p>
      <div class="eqBox" id="eq-stoner">
<pre class="eq">A < 0  ⇔  (N/12)(4εF − 3VN) < 0
⇔ 4εF − 3VN < 0
⇔ V > (4εF)/(3N).</pre>
      </div>
      <div class="btnRow">
        <button class="copy" data-copy-target="eq-stoner">Copy Stoner condition (plain text)</button>
      </div>

      <div class="callout bad" style="margin-top:12px">
        <p class="tight">
          If <strong>V &gt; 4ε<sub>F</sub>/(3N)</strong>, the curvature of E(ζ,0) at ζ=0 is negative: ζ=0 is a local maximum, so a <strong>ferromagnetic state (ζ≠0)</strong> has lower energy.
          Because we assumed <span class="muted">|ζ|≪1</span>, this is a <strong>sufficient</strong> condition (Stoner condition), not guaranteed necessary in the full non-expanded model.
        </p>
      </div>

      <figure aria-label="Energy versus polarization plot">
        <canvas id="plot" width="900" height="360"></canvas>
        <figcaption>
          Static illustrative plot (example values): scaled energy difference ΔE(ζ)=E(ζ,0)−E(0,0) for two cases—
          one below the Stoner threshold (stable at ζ=0) and one above (unstable at ζ=0).
          This plot is for intuition only; the solution remains symbolic.
        </figcaption>
      </figure>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>

    <section id="part4">
      <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

      <h3>Re-interpret the final formula</h3>
      <p>
        The magnetization law
        <span class="muted">M = [3Nμ²/(2ε<sub>F</sub> − (3/2)VN)]B</span>
        can be read as:
      </p>
      <ul>
        <li><strong>Kinetic stiffness:</strong> <span class="muted">ε<sub>F</sub></span> measures how costly it is to unbalance the two Fermi seas; bigger ε<sub>F</sub> means smaller susceptibility.</li>
        <li><strong>Exchange softening:</strong> the term <span class="muted">(3/2)VN</span> reduces the effective stiffness; exchange makes it easier to polarize.</li>
        <li><strong>Criticality:</strong> when the denominator approaches zero, the response diverges—mean-field signature of a phase transition.</li>
      </ul>

      <h3>Parameter dependence (qualitative)</h3>
      <div class="grid2">
        <div class="card">
          <h3 class="tight">Increase ε<sub>F</sub></h3>
          <p class="small tight">Denominator increases → smaller M for the same B. Physically: higher density/stronger degeneracy makes polarization harder.</p>
        </div>
        <div class="card">
          <h3 class="tight">Increase V or N</h3>
          <p class="small tight">Denominator decreases → larger M. Physically: stronger exchange (or more electrons contributing) enhances ferromagnetic tendency.</p>
        </div>
      </div>

      <h3>Alternative derivation idea (brief but meaningful)</h3>
      <details>
        <summary>Alternative: balance of spin-dependent chemical potentials</summary>
        <p class="small">
          Define spin-dependent energies and compute the spin-dependent chemical potentials
          <span class="muted">μ<sub>σ</sub> = ∂E/∂N<sub>σ</sub></span> at fixed N.
          Exchange shifts μ<sub>σ</sub> by a term proportional to −VN<sub>σ</sub>, while the kinetic part gives μ<sub>σ</sub> ∝ N<sub>σ</sub><sup>2/3</sup>.
          In a field B, equilibrium requires <span class="muted">μ<sub>+</sub> − μ<sub>−</sub> = 2μB</span>.
          Linearizing around ζ=0 reproduces the same susceptibility and Stoner criterion via the sign of the derivative.
        </p>
      </details>

      <h3>Concept checks (self-test with answers)</h3>
      <ul>
        <li><strong>Q:</strong> Why does kinetic energy scale as (1±ζ)<sup>5/3</sup>? <strong>A:</strong> In 3D, ε<sub>F</sub> ∝ n<sup>2/3</sup> and total kinetic energy ∝ Nε<sub>F</sub> ∝ N·(N/Ω)<sup>2/3</sup> ∝ N<sup>5/3</sup> at fixed Ω.</li>
        <li><strong>Q:</strong> Why do odd powers of ζ cancel in the total kinetic energy? <strong>A:</strong> Because swapping ζ→−ζ exchanges spin labels; the total energy must be even in ζ when B=0, so odd terms cancel in the sum of + and − contributions.</li>
        <li><strong>Q:</strong> What mathematical condition signals instability of ζ=0? <strong>A:</strong> Negative curvature: <span class="muted">∂²E/∂ζ²|<sub>ζ=0</sub> &lt; 0</span>.</li>
        <li><strong>Q:</strong> What does “susceptibility enhancement” mean here? <strong>A:</strong> The slope M/B increases because exchange reduces the effective energy penalty for polarization (smaller denominator).</li>
      </ul>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>

    <section id="part5">
      <h2>PART 5 — Optional Plot Guide</h2>
      <p>
        A plot is useful here because part (c) is fundamentally about <strong>stability</strong>—i.e., the curvature of E(ζ) at ζ=0.
        Seeing ΔE(ζ) change from “bowl-shaped” (stable) to “hill-shaped” (unstable) makes the Stoner criterion intuitive.
      </p>

      <div class="grid2">
        <div class="card">
          <h3 class="tight">What the plot shows</h3>
          <p class="small tight">
            It graphs the <strong>scaled energy difference</strong> ΔE(ζ)=E(ζ,0)−E(0,0) for two example cases:
            one with <span class="muted">V</span> below the threshold and one above.
          </p>
        </div>
        <div class="card">
          <h3 class="tight">Axes and units</h3>
          <ul class="small tight">
            <li><strong>x-axis:</strong> ζ (dimensionless polarization).</li>
            <li><strong>y-axis:</strong> ΔE / (Nε<sub>F</sub>) (dimensionless scaled energy).</li>
          </ul>
        </div>
      </div>

      <div class="callout warn">
        <p class="tight">
          <strong>Example values notice:</strong> The two curves use illustrative parameter ratios (not measured values):
          one case has <span class="muted">VN/ε<sub>F</sub>=0.9</span> (below threshold), the other <span class="muted">VN/ε<sub>F</sub>=1.6</span> (above threshold).
          The symbolic derivation and final formulas do not rely on these numbers.
        </p>
      </div>

      <h3>Features to notice</h3>
      <ul>
        <li><strong>Stable case:</strong> ΔE has a minimum at ζ=0 (positive curvature).</li>
        <li><strong>Unstable case:</strong> ΔE has a maximum at ζ=0 (negative curvature), indicating the system prefers ζ≠0.</li>
        <li><strong>Connection to math:</strong> curvature at ζ=0 corresponds to the sign of the ζ² coefficient in the expansion.</li>
      </ul>

      <a class="backTop" href="#top">↑ Back to top</a>
    </section>
  </main>
</div>

<footer>
  <p>
    Notes: This is a simplified mean-field model intended for conceptual clarity. Real metals require band-structure density-of-states information and more detailed exchange-correlation physics, but the core “competition” logic remains central to itinerant magnetism.
  </p>
</footer>

<script>
  // Copy buttons
  function copyText(text){
    return navigator.clipboard.writeText(text);
  }

  function getPlainTextFromElement(el){
    if(!el) return "";
    return (el.innerText || el.textContent || "").trim();
  }

  document.addEventListener("click", async (e) => {
    const btn = e.target.closest("button.copy");
    if(!btn) return;

    // Copy final answer special
    if(btn.dataset.copyFinal === "true"){
      const box = document.getElementById("finalAnswerBox");
      const text = getPlainTextFromElement(box);
      try{
        await copyText(text);
        btn.textContent = "Copied!";
        setTimeout(()=>btn.textContent="Copy Final Answer (plain text)", 1000);
      }catch(err){
        btn.textContent = "Copy failed";
        setTimeout(()=>btn.textContent="Copy Final Answer (plain text)", 1200);
      }
      return;
    }

    const targetId = btn.dataset.copyTarget;
    const target = document.getElementById(targetId);
    const text = getPlainTextFromElement(target);
    try{
      await copyText(text);
      const old = btn.textContent;
      btn.textContent = "Copied!";
      setTimeout(()=>btn.textContent=old, 1000);
    }catch(err){
      const old = btn.textContent;
      btn.textContent = "Copy failed";
      setTimeout(()=>btn.textContent=old, 1200);
    }
  });

  // Single static plot using canvas (high-DPI crisp)
  (function(){
    const canvas = document.getElementById("plot");
    if(!canvas) return;
    const ctx = canvas.getContext("2d");

    function resize(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const cssW = canvas.clientWidth;
      const cssH = canvas.clientHeight;
      canvas.width = Math.floor(cssW * dpr);
      canvas.height = Math.floor(cssH * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      draw(cssW, cssH);
    }

    // Model for plot (example values only):
    // Use exact expression at B=0:
    // E(ζ)/ (N εF) = (3/10)*[(1+ζ)^(5/3) + (1-ζ)^(5/3)]  -  (1/8)*(V N / εF)*[(1+ζ)^2 + (1-ζ)^2]
    // Plot ΔE = E(ζ)-E(0) in those scaled units.
    function scaledEnergy(z, r){ // r = (V N)/εF
      const termKin = (3/10) * (Math.pow(1+z, 5/3) + Math.pow(1-z, 5/3));
      const termEx  = (1/8) * r * ((1+z)*(1+z) + (1-z)*(1-z));
      return termKin - termEx;
    }

    function draw(w,h){
      ctx.clearRect(0,0,w,h);

      // Layout
      const padL = 58, padR = 18, padT = 26, padB = 48;
      const x0 = padL, y0 = padT;
      const x1 = w - padR, y1 = h - padB;
      const pw = x1 - x0, ph = y1 - y0;

      // Domain
      const zMin = -0.7, zMax = 0.7;

      // Example ratios (below and above Stoner threshold):
      // Threshold from V > 4 εF/(3N) means r > 4/3 ≈ 1.333...
      const rStable = 0.9;
      const rUnstable = 1.6;

      // Sample curves
      const N = 500;
      const zs = new Array(N);
      const dEs1 = new Array(N);
      const dEs2 = new Array(N);
      const E0s1 = scaledEnergy(0, rStable);
      const E0s2 = scaledEnergy(0, rUnstable);

      let yMin = 1e9, yMax = -1e9;
      for(let i=0;i<N;i++){
        const z = zMin + (zMax - zMin) * (i/(N-1));
        zs[i] = z;
        const d1 = scaledEnergy(z, rStable) - E0s1;
        const d2 = scaledEnergy(z, rUnstable) - E0s2;
        dEs1[i] = d1;
        dEs2[i] = d2;
        yMin = Math.min(yMin, d1, d2);
        yMax = Math.max(yMax, d1, d2);
      }

      // Pad y-range a bit
      const yPad = 0.10*(yMax - yMin || 1);
      yMin -= yPad; yMax += yPad;

      function X(z){ return x0 + ( (z - zMin)/(zMax - zMin) )*pw; }
      function Y(v){ return y1 - ( (v - yMin)/(yMax - yMin) )*ph; }

      // Grid
      ctx.save();
      ctx.strokeStyle = "rgba(255,255,255,0.10)";
      ctx.lineWidth = 1;

      const xTicks = 7; // includes endpoints
      for(let i=0;i<xTicks;i++){
        const z = zMin + (zMax - zMin)*(i/(xTicks-1));
        const xx = X(z);
        ctx.beginPath(); ctx.moveTo(xx, y0); ctx.lineTo(xx, y1); ctx.stroke();
      }

      const yTicks = 6;
      for(let i=0;i<yTicks;i++){
        const v = yMin + (yMax - yMin)*(i/(yTicks-1));
        const yy = Y(v);
        ctx.beginPath(); ctx.moveTo(x0, yy); ctx.lineTo(x1, yy); ctx.stroke();
      }
      ctx.restore();

      // Axes
      ctx.save();
      ctx.strokeStyle = "rgba(255,255,255,0.55)";
      ctx.lineWidth = 1.25;
      ctx.beginPath();
      ctx.moveTo(x0, y1);
      ctx.lineTo(x1, y1);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x0, y0);
      ctx.lineTo(x0, y1);
      ctx.stroke();
      ctx.restore();

      // Tick labels
      ctx.save();
      ctx.fillStyle = "rgba(233,238,252,0.85)";
      ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";

      for(let i=0;i<xTicks;i++){
        const z = zMin + (zMax - zMin)*(i/(xTicks-1));
        const xx = X(z);
        ctx.fillText(z.toFixed(2), xx, y1 + 8);
        // tick marks
        ctx.strokeStyle = "rgba(255,255,255,0.55)";
        ctx.beginPath();
        ctx.moveTo(xx, y1);
        ctx.lineTo(xx, y1+5);
        ctx.stroke();
      }

      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      for(let i=0;i<yTicks;i++){
        const v = yMin + (yMax - yMin)*(i/(yTicks-1));
        const yy = Y(v);
        ctx.fillText(v.toFixed(3), x0 - 8, yy);
        ctx.strokeStyle = "rgba(255,255,255,0.55)";
        ctx.beginPath();
        ctx.moveTo(x0-5, yy);
        ctx.lineTo(x0, yy);
        ctx.stroke();
      }
      ctx.restore();

      // Title and axis labels
      ctx.save();
      ctx.fillStyle = "rgba(233,238,252,0.95)";
      ctx.font = "600 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.fillText("ΔE(ζ) = E(ζ,0) − E(0,0), scaled by NεF (example values)", x0, 6);
      ctx.restore();

      ctx.save();
      ctx.fillStyle = "rgba(233,238,252,0.85)";
      ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText("ζ (spin polarization, dimensionless)", x0 + pw/2, h - 10);

      ctx.save();
      ctx.translate(16, y0 + ph/2);
      ctx.rotate(-Math.PI/2);
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText("ΔE / (NεF) (dimensionless)", 0, 0);
      ctx.restore();
      ctx.restore();

      // Draw curves
      function drawCurve(vals, stroke, dash){
        ctx.save();
        ctx.strokeStyle = stroke;
        ctx.lineWidth = 2;
        ctx.setLineDash(dash || []);
        ctx.beginPath();
        for(let i=0;i<N;i++){
          const xx = X(zs[i]);
          const yy = Y(vals[i]);
          if(i===0) ctx.moveTo(xx,yy);
          else ctx.lineTo(xx,yy);
        }
        ctx.stroke();
        ctx.restore();
      }

      drawCurve(dEs1, "rgba(125,211,252,0.95)", []);          // stable
      drawCurve(dEs2, "rgba(251,113,133,0.92)", [6,4]);       // unstable

      // Legend
      const lx = x1 - 250, ly = y0 + 12;
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.35)";
      ctx.strokeStyle = "rgba(255,255,255,0.14)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.roundRect(lx, ly, 235, 56, 10);
      ctx.fill();
      ctx.stroke();

      ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "rgba(233,238,252,0.88)";
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";

      ctx.strokeStyle = "rgba(125,211,252,0.95)";
      ctx.lineWidth = 2;
      ctx.setLineDash([]);
      ctx.beginPath(); ctx.moveTo(lx+12, ly+18); ctx.lineTo(lx+42, ly+18); ctx.stroke();
      ctx.fillText("Stable: VN/εF = 0.9  (< 4/3)", lx+52, ly+18);

      ctx.strokeStyle = "rgba(251,113,133,0.92)";
      ctx.setLineDash([6,4]);
      ctx.beginPath(); ctx.moveTo(lx+12, ly+38); ctx.lineTo(lx+42, ly+38); ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillText("Unstable: VN/εF = 1.6  (> 4/3)", lx+52, ly+38);

      ctx.restore();
    }

    // Polyfill roundRect for older browsers
    if(!CanvasRenderingContext2D.prototype.roundRect){
      CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){
        const rr = Math.min(r, w/2, h/2);
        this.beginPath();
        this.moveTo(x+rr, y);
        this.arcTo(x+w, y, x+w, y+h, rr);
        this.arcTo(x+w, y+h, x, y+h, rr);
        this.arcTo(x, y+h, x, y, rr);
        this.arcTo(x, y, x+w, y, rr);
        this.closePath();
        return this;
      };
    }

    window.addEventListener("resize", resize, {passive:true});
    resize();
  })();
</script>
</body>
</html>
