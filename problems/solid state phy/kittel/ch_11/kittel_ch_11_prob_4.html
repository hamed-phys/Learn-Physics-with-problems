<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Heat Capacity of a Two-Level System (Schottky Anomaly) — Full Derivation</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1621;
      --card:#121c2a;
      --text:#e7eefc;
      --muted:#b8c4dd;
      --faint:#7f90b3;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(125,211,252,.10), transparent 60%),
        radial-gradient(1000px 500px at 85% 15%, rgba(167,139,250,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #070a0f 65%, #05070b);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    header{
      position:relative;
      padding:28px 18px 18px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(18,28,42,.85), rgba(15,22,33,.35));
      overflow:hidden;
    }
    header .wrap{
      max-width:1200px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:start;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    h1{
      margin:0;
      font-size: clamp(1.4rem, 2.4vw, 2.2rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      font-size: clamp(.95rem, 1.35vw, 1.05rem);
      max-width:70ch;
    }
    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:8px;
      color:var(--faint);
      font-size:.9rem;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(255,255,255,.04);
      box-shadow: 0 1px 0 rgba(255,255,255,.05) inset;
      backdrop-filter: blur(6px);
    }
    .pill b{color:var(--text); font-weight:600}
    .heroCard{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(18,28,42,.6);
      box-shadow: var(--shadow);
      padding:14px;
      display:grid;
      gap:10px;
      align-content:start;
    }
    .heroCard h3{
      margin:0;
      font-size:1rem;
      letter-spacing:.2px;
    }
    .heroCard ul{
      margin:0;
      padding-left:18px;
      color:var(--muted);
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:18px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:16px;
      align-items:start;
    }

    nav#toc{
      position:sticky;
      top:14px;
      align-self:start;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(15,22,33,.72);
      box-shadow: var(--shadow);
      padding:14px;
      backdrop-filter: blur(10px);
    }
    #toc h2{
      margin:0 0 10px;
      font-size:1rem;
      letter-spacing:.2px;
    }
    #toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      will-change: transform;
    }
    #toc a:hover{
      background: rgba(125,211,252,.08);
      border-color: rgba(125,211,252,.18);
      transform: translateY(-1px);
      text-decoration:none;
      color:var(--text);
    }
    #toc .small{
      font-size:.88rem;
      color:var(--faint);
      margin-top:10px;
    }

    article{
      display:grid;
      gap:14px;
    }

    section{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(18,28,42,.55);
      box-shadow: var(--shadow);
      padding:16px;
      overflow:hidden;
    }
    section h2{
      margin:0 0 10px;
      font-size:1.25rem;
      letter-spacing:.2px;
    }
    section h3{
      margin:14px 0 8px;
      font-size:1.05rem;
      color: var(--text);
    }
    p{margin:8px 0; color:var(--muted)}
    ul,ol{color:var(--muted)}
    li{margin:6px 0}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      header .wrap{grid-template-columns: 1fr}
      main{grid-template-columns: 1fr}
      nav#toc{position:relative; top:auto}
      .grid2{grid-template-columns: 1fr}
    }

    .callouts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 980px){
      .callouts{grid-template-columns: 1fr}
    }

    .card{
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
      padding:12px;
    }
    .card strong{color:var(--text)}
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:.85rem;
      color: var(--faint);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      margin-bottom:8px;
    }
    .tag.good{border-color: rgba(134,239,172,.25); background: rgba(134,239,172,.08); color: #c9ffe0}
    .tag.warn{border-color: rgba(251,191,36,.25); background: rgba(251,191,36,.08); color: #ffe9b7}
    .tag.bad{border-color: rgba(251,113,133,.25); background: rgba(251,113,133,.08); color: #ffd0d8}
    .tag.math{border-color: rgba(167,139,250,.25); background: rgba(167,139,250,.08); color: #eadfff}

    pre{
      margin:10px 0 0;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(6,10,16,.65);
      overflow:auto;
      position:relative;
    }
    code, pre{font-family:var(--mono); font-size:.92rem; color:#d8e6ff}
    .eqbox{
      position:relative;
      margin-top:10px;
    }
    .copyRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }
    button.copy{
      appearance:none;
      border:1px solid rgba(125,211,252,.28);
      background: rgba(125,211,252,.08);
      color: var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-weight:600;
      font-size:.88rem;
    }
    button.copy:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,.14);
      border-color: rgba(125,211,252,.40);
    }
    button.copy:active{transform: translateY(0)}
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%) translateY(20px);
      background: rgba(10,14,20,.85);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index:50;
      backdrop-filter: blur(10px);
      font-size:.9rem;
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(0)}
    details{
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
      padding:10px 12px;
      margin-top:10px;
    }
    summary{
      cursor:pointer;
      color: var(--text);
      font-weight:700;
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    summary:after{
      content:"▾";
      float:right;
      color: var(--faint);
      transition: transform .15s ease;
    }
    details[open] summary:after{transform: rotate(180deg)}

    figure{
      margin:12px 0 0;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    figure figcaption{
      padding:10px 12px 12px;
      color: var(--muted);
      border-top:1px solid var(--line);
      font-size:.92rem;
    }
    canvas{
      display:block;
      width:100%;
      height:320px;
      background: rgba(6,10,16,.45);
    }

    .backTop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    .backTop:hover{color:var(--text); text-decoration:none; border-color: rgba(125,211,252,.25)}

    footer{
      max-width:1200px;
      margin:0 auto;
      padding:18px;
      color: var(--faint);
      font-size:.9rem;
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      header, nav#toc, .toast, button.copy, .backTop{display:none !important}
      main{display:block; padding:0}
      section{box-shadow:none; background:#fff; border:1px solid #ccc; break-inside:avoid; page-break-inside:avoid}
      pre{background:#f5f5f5; color:#000}
      code{color:#000}
      canvas{display:none}
      figure figcaption{border-top:1px solid #ccc}
      a{color:#000; text-decoration:underline}
    }
  </style>
</head>
<body>
  <a id="top"></a>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>Heat Capacity from Internal Degrees of Freedom: Two-Level System (Schottky Anomaly)</h1>
        <div class="subtitle">
          We derive the heat capacity of an isolated two-level system with energy splitting <span style="color:var(--text);font-weight:700">k<sub>B</sub>&Delta;</span>, show the classic Schottky peak, and obtain the high-temperature asymptotic form
          <span style="color:var(--text);font-weight:700">C &asymp; k<sub>B</sub>(&Delta;/2T)<sup>2</sup></span>.
        </div>
        <div class="meta">
          <span class="pill"><b>Domain</b> Statistical Physics</span>
          <span class="pill"><b>Key tool</b> Partition function Z</span>
          <span class="pill"><b>Output</b> Symbolic formula + asymptotics</span>
          <span class="pill"><b>Engineering lens</b> Cryogenics &amp; materials characterization</span>
        </div>
      </div>
      <aside class="heroCard">
        <h3>Quick Summary</h3>
        <ul>
          <li><b>What:</b> Heat capacity of a two-level system with splitting <b>k<sub>B</sub>&Delta;</b>.</li>
          <li><b>Physics idea:</b> As temperature rises, population redistributes between levels; energy fluctuations peak near <b>T ~ &Delta;</b>.</li>
          <li><b>Governing equations:</b> Canonical ensemble:
            <span style="white-space:nowrap;color:var(--text)"><b>Z = &Sigma; e<sup>-&beta;E</sup></b></span>,
            <span style="white-space:nowrap;color:var(--text)"><b>U = -&part; ln Z / &part;&beta;</b></span>,
            <span style="white-space:nowrap;color:var(--text)"><b>C = (&part;U/&part;T)</b></span>.
          </li>
          <li><b>Result:</b> <b>C = k<sub>B</sub> ( &Delta;/T )<sup>2</sup> e<sup>&Delta;/T</sup> / (1+e<sup>&Delta;/T</sup>)<sup>2</sup></b>.</li>
          <li><b>Meaning:</b> A <b>Schottky anomaly</b> peak in C(T); low at both very low and very high T.</li>
          <li><b>High-T:</b> For <b>T &gg; &Delta;</b>, <b>C &asymp; k<sub>B</sub>(&Delta;/2T)<sup>2</sup></b> (falls like 1/T<sup>2</sup>).</li>
          <li><b>Low-T:</b> For <b>T &ll; &Delta;</b>, <b>C &sim; k<sub>B</sub>(&Delta;/T)<sup>2</sup> e<sup>-&Delta;/T</sup></b> (activated).</li>
        </ul>
      </aside>
    </div>
  </header>

  <main>
    <nav id="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <a href="#part0">PART 0 — Concept Primer</a>
      <a href="#part0b">PART 0B — Industry &amp; Applied Physics Perspective</a>
      <a href="#part1">PART 1 — Problem Analysis</a>
      <a href="#part2">PART 2 — Strategy &amp; Tips</a>
      <a href="#part3">PART 3 — Full Solution</a>
      <a href="#part4">PART 4 — Deeper Understanding</a>
      <a href="#part5">PART 5 — Optional Plot Guide</a>
      <div class="small">Sticky navigation • Click to jump • Print-friendly layout</div>
    </nav>

    <article>
      <section id="part0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <div class="callouts">
          <div class="card">
            <div class="tag math">Core definitions &amp; symbols</div>
            <ul>
              <li><b>T</b> — temperature (K).</li>
              <li><b>k<sub>B</sub></b> — Boltzmann constant (J/K).</li>
              <li><b>&beta; = 1/(k<sub>B</sub>T)</b> — inverse thermal energy (1/J).</li>
              <li><b>Two levels</b>: energies <b>E<sub>1</sub></b> (lower), <b>E<sub>2</sub></b> (upper) with splitting <b>E<sub>2</sub>-E<sub>1</sub> = k<sub>B</sub>&Delta;</b>.</li>
              <li><b>Z</b> — canonical partition function (dimensionless): <b>Z = &Sigma;<sub>states</sub> e<sup>-&beta;E</sup></b>.</li>
              <li><b>U</b> — internal energy (J): <b>U = &langle;E&rangle;</b>.</li>
              <li><b>C</b> — heat capacity at fixed splitting &Delta; (J/K): <b>C = ( &part;U/&part;T )<sub>&Delta;</sub></b>.</li>
            </ul>
          </div>

          <div class="card">
            <div class="tag good">Physical meaning</div>
            <p>
              A two-level system is the simplest model of <b>internal degrees of freedom</b> (e.g., spin-up/spin-down in a field,
              a crystal-field split doublet, a nuclear hyperfine split state).
            </p>
            <p>
              Heat capacity measures how much <b>energy storage changes with temperature</b>.
              Here, energy storage comes from <b>changing populations</b> between the two levels.
            </p>
          </div>
        </div>

        <h3>Key laws/principles (and when valid)</h3>
        <ul>
          <li><b>Canonical ensemble</b> applies when the system exchanges energy with a heat bath at temperature T, and particle number is fixed (or irrelevant for a single localized degree of freedom).</li>
          <li><b>Boltzmann weights</b> assume thermal equilibrium and negligible non-equilibrium pumping.</li>
          <li><b>Independence</b>: “per system” means one such two-level unit (one spin, one impurity center, one nucleus, etc.). For N non-interacting identical units, total C is N times this result.</li>
        </ul>

        <h3>Common models/approximations</h3>
        <ul>
          <li><b>Two-level truncation</b>: only two lowest levels matter; good when higher excited states satisfy E<sub>3</sub> - E<sub>1</sub> &gg; k<sub>B</sub>T.</li>
          <li><b>Fixed splitting</b> &Delta;: the level spacing is treated as temperature-independent (often valid for Zeeman splitting in a fixed magnetic field, or for rigid crystal-field splitting over a narrow T range).</li>
          <li><b>Non-interacting units</b>: ignores cooperative ordering or strong dipole-dipole coupling.</li>
        </ul>

        <h3>Mini intuition examples (minimal algebra)</h3>
        <ul>
          <li><b>T &ll; &Delta;</b>: almost all population in the lower state → energy barely changes with T → C is tiny (activated).</li>
          <li><b>T &gg; &Delta;</b>: populations become nearly equal (1/2, 1/2) → increasing T hardly changes populations → C again becomes small, decaying like 1/T<sup>2</sup>.</li>
          <li><b>T ~ &Delta;</b>: populations are most sensitive to T → U(T) changes rapidly → C peaks (Schottky anomaly).</li>
        </ul>

        <div class="card" style="margin-top:10px">
          <div class="tag warn">What to watch for (pitfalls)</div>
          <ul>
            <li><b>Units:</b> &Delta; in this problem is a <b>temperature-like</b> energy scale because the physical splitting is <b>k<sub>B</sub>&Delta;</b>.</li>
            <li><b>Sign conventions:</b> It’s safest to set E<sub>1</sub>=0 and E<sub>2</sub>=k<sub>B</sub>&Delta; (only differences matter).</li>
            <li><b>Derivative variable:</b> C is computed at fixed splitting: <b>(&part;U/&part;T)<sub>&Delta;</sub></b>.</li>
            <li><b>Degeneracy:</b> If levels have degeneracies g<sub>1</sub>, g<sub>2</sub>, Z changes; here assume both are non-degenerate unless stated otherwise.</li>
          </ul>
        </div>

        <details>
          <summary>Math Insight (interpretation of the core equation)</summary>
          <p>
            In the canonical ensemble, heat capacity is an <b>energy-fluctuation measure</b>:
          </p>
          <div class="eqbox">
            <pre id="eq-fluct"><code>C = (∂U/∂T) = (1/(k_B T^2)) ( ⟨E^2⟩ − ⟨E⟩^2 ).</code></pre>
            <div class="copyRow">
              <button class="copy" data-copy-target="eq-fluct">Copy equation (plain text)</button>
            </div>
          </div>
          <p>
            Mathematically, this says <b>C ≥ 0</b> (variance is nonnegative). The Schottky peak is the temperature where
            the variance of a Bernoulli-like energy variable (0 or k<sub>B</sub>&Delta;) is largest under the Gibbs distribution.
          </p>
        </details>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>

      <section id="part0b">
        <h2>PART 0B — Industry &amp; Applied Physics Perspective</h2>

        <div class="grid2">
          <div class="card">
            <div class="tag good">Where it appears (3+ application areas)</div>
            <ul>
              <li><b>Cryogenic engineering</b>: paramagnetic salts and nuclear contributions can dominate C at mK–K, affecting cooldown time constants and thermal budgets.</li>
              <li><b>Magnetic refrigeration</b> / adiabatic demagnetization: two-level (or few-level) magnetic systems store entropy; Schottky-like anomalies shape performance.</li>
              <li><b>Materials characterization</b>: heat-capacity peaks help extract <b>energy level splittings</b> (crystal-field, hyperfine, Zeeman) in rare-earth/transition-metal compounds.</li>
              <li><b>Quantum devices</b> (applied physics): localized two-level defects (“TLS”) contribute to low-T thermodynamics and noise; understanding their C(T) helps thermal design.</li>
            </ul>
          </div>
          <div class="card">
            <div class="tag warn">Why engineers care</div>
            <ul>
              <li><b>Performance:</b> A Schottky peak can greatly increase heat capacity over a narrow T range, changing thermal response time.</li>
              <li><b>Reliability:</b> Unexpected low-T heat capacity can cause slower cooldown or temperature drift in precision systems.</li>
              <li><b>Cost/efficiency:</b> Thermal mass impacts refrigeration requirements and energy consumption.</li>
              <li><b>Manufacturability:</b> Impurity concentration or dopant levels can introduce two-level centers; controlling them controls low-T C.</li>
            </ul>
          </div>
        </div>

        <h3>Typical measurement/validation methods</h3>
        <ul>
          <li><b>Calorimetry</b> (relaxation or AC calorimetry): measure C(T) and fit to a sum of contributions (phonons ~ T<sup>3</sup>, electrons ~ T, Schottky ~ peak + 1/T<sup>2</sup> tail).</li>
          <li><b>Magneto-heat capacity</b>: vary magnetic field B to tune Zeeman splitting and verify scaling with &Delta;.</li>
          <li><b>Spectroscopy cross-check</b>: ESR/NMR/neutron scattering can independently measure splitting and validate the fitted &Delta;.</li>
        </ul>

        <h3>Design trade-offs and constraints</h3>
        <ul>
          <li><b>Non-idealities:</b> level degeneracy, distributions of splittings (disorder), interactions, and finite relaxation time can broaden/shift the peak.</li>
          <li><b>Constraints:</b> real devices have thermal gradients, finite coupling to bath, and sometimes non-equilibrium populations—so the ideal canonical formula is a baseline, not the whole story.</li>
        </ul>

        <div class="card">
          <div class="tag math">From lab to product</div>
          <p>
            In products, engineers often model the total heat capacity as
            <b>C_total(T) = C_phonon(T) + C_electron(T) + C_Schottky(T; Δ, n_TLS)</b>,
            where <b>n_TLS</b> is an effective density of two-level centers. Fitting C(T) data provides
            actionable parameters for material selection, purity specs, and thermal-control design.
          </p>
        </div>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <h3>Problem restatement</h3>
        <p>
          Consider a <b>two-level system</b> with an energy splitting <b>k<sub>B</sub>&Delta;</b> between the lower and upper states.
          Show that the heat capacity per system is
          <span style="color:var(--text);font-weight:800;white-space:nowrap">
            C = k<sub>B</sub> (Δ/T)<sup>2</sup> e<sup>Δ/T</sup> / (1 + e<sup>Δ/T</sup>)<sup>2</sup>
          </span>,
          and show that for <b>T &gg; &Delta;</b>,
          <span style="color:var(--text);font-weight:800;white-space:nowrap">
            C = k<sub>B</sub>(Δ/2T)<sup>2</sup> + …
          </span>.
        </p>

        <div class="callouts">
          <div class="card">
            <div class="tag">Given</div>
            <ul>
              <li>Two energy levels with separation <b>k<sub>B</sub>&Delta;</b>.</li>
              <li>System is in thermal equilibrium at temperature <b>T</b>.</li>
            </ul>
          </div>
          <div class="card">
            <div class="tag">Unknowns / must prove</div>
            <ul>
              <li>Derive <b>C(T)</b> in closed form.</li>
              <li>Find the <b>high-temperature asymptotic</b> for T &gg; &Delta;.</li>
            </ul>
          </div>
        </div>

        <h3>Mathematical model (explicit)</h3>
        <div class="card">
          <div class="tag math">Model specification</div>
          <ul>
            <li><b>State space:</b> discrete set {1,2}.</li>
            <li><b>Energies:</b> choose reference so <b>E<sub>1</sub>=0</b>, <b>E<sub>2</sub>=k<sub>B</sub>&Delta;</b> (J). Only the difference matters.</li>
            <li><b>Domain:</b> temperature <b>T &gt; 0</b>.</li>
            <li><b>Parameter:</b> splitting &Delta; &gt; 0 fixed (units of K as defined by k<sub>B</sub>&Delta;).</li>
            <li><b>Ensemble:</b> canonical, with probabilities <b>p_i = e<sup>-&beta;E_i</sup>/Z</b>, where <b>Z = &Sigma e<sup>-&beta;E</sup></b>.</li>
            <li><b>Quantity of interest:</b> <b>U(T)=&langle;E&rangle;</b> and <b>C(T) = (∂U/∂T)<sub>&Delta;</sub></b>.</li>
            <li><b>Operator notation:</b> because the system is discrete, the “Hamiltonian operator” is simply
              <b>Ĥ = diag(0, k<sub>B</sub>&Delta;)</b> on a 2D Hilbert space; <b>Z = Tr(e<sup>-βĤ</sup>)</b>.</li>
          </ul>
        </div>

        <h3>Relevant principles (and why they apply)</h3>
        <ul>
          <li><b>Canonical partition function</b> because we assume thermal equilibrium with a heat bath at temperature T.</li>
          <li><b>Energy expectation</b> from probabilities or via derivatives of ln Z (linearity of expectation; differentiation under the sum is valid because it’s a finite sum).</li>
          <li><b>Asymptotics</b> for T &gg; &Delta; using series expansions of the exponential (small parameter x=&Delta;/T).</li>
        </ul>

        <div class="card">
          <div class="tag warn">Assumptions (explicit)</div>
          <ul>
            <li>Two levels only; no higher excited states contribute.</li>
            <li>Levels are non-degenerate (or degeneracy ratio is 1).</li>
            <li>&Delta; does not depend on T over the temperature range (so partial derivative is at fixed &Delta;).</li>
            <li>Equilibrium populations follow Boltzmann statistics (no pumping, no slow relaxation).</li>
          </ul>
        </div>

        <h3>Possible approaches (compare 2–3)</h3>
        <ul>
          <li><b>Approach A: Partition function Z → U → C</b> (best general method; clean; extends to degeneracy and many levels).</li>
          <li><b>Approach B: Direct probability p(T) of excited state</b> (intuitive; U = p E<sub>2</sub>; easy derivatives).</li>
          <li><b>Approach C: Fluctuation formula</b> <span style="white-space:nowrap;color:var(--text)"><b>C = Var(E)/(k<sub>B</sub>T<sup>2</sup>)</b></span> (fast sanity check; highlights positivity and peak as max variance).</li>
        </ul>
        <p>
          We choose <b>Approach A</b> but will connect to B and C for insight and checks.
        </p>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>

        <ol>
          <li><b>Pick a convenient energy zero:</b> set E<sub>1</sub>=0, E<sub>2</sub>=k<sub>B</sub>&Delta; (doesn’t change physics; only differences matter).</li>
          <li><b>Write the partition function:</b> Z = e<sup>-βE1</sup> + e<sup>-βE2</sup>.</li>
          <li><b>Compute internal energy:</b> U = &Sigma p<sub>i</sub>E<sub>i</sub>, or equivalently U = -∂ ln Z/∂β.</li>
          <li><b>Differentiate with respect to T:</b> C = (∂U/∂T)<sub>&Delta;</sub>; use β=1/(k<sub>B</sub>T) and chain rule.</li>
          <li><b>Nondimensionalize:</b> define x=&Delta;/T to simplify and to see scaling.</li>
          <li><b>High-T limit:</b> x small; series expand to obtain C ≈ k<sub>B</sub>x<sup>2</sup>/4 = k<sub>B</sub>(&Delta;/2T)<sup>2</sup>.</li>
          <li><b>Sanity checks:</b> units (J/K), limits T→0 and T→∞, positivity C≥0.</li>
        </ol>

        <div class="callouts">
          <div class="card">
            <div class="tag bad">Common mistakes</div>
            <ul>
              <li>Forgetting that the splitting is <b>k<sub>B</sub>&Delta;</b> (so &Delta;/T appears, not k<sub>B</sub>&Delta;/T).</li>
              <li>Sign error in exponent: use e<sup>-βE</sup>, not e<sup>+βE</sup>.</li>
              <li>Differentiating with respect to T without applying chain rule through β(T).</li>
              <li>Mixing “per system” with “per mole”: multiply by N<sub>A</sub> for molar C.</li>
            </ul>
          </div>
          <div class="card">
            <div class="tag math">Dimensional analysis tip</div>
            <p>
              If the only energy scale is <b>k<sub>B</sub>&Delta;</b>, then per system
              <b>U</b> must scale like <b>k<sub>B</sub>&Delta;</b> times a dimensionless function of <b>&Delta;/T</b>.
              Therefore <b>C</b> must scale like <b>k<sub>B</sub></b> times a dimensionless function of <b>&Delta;/T</b>.
              This is a powerful check against algebra mistakes.
            </p>
          </div>
        </div>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Qualitative expectation (before calculating)</h3>
        <ul>
          <li>At <b>low T</b>, excited state is barely populated → energy nearly constant → <b>C ≈ 0</b>.</li>
          <li>At <b>high T</b>, populations saturate to ~1/2 each → energy changes slowly with T → <b>C decreases</b>.</li>
          <li>So <b>C(T)</b> should have a <b>single peak</b> at intermediate temperature (Schottky anomaly).</li>
        </ul>

        <h3>Step 1 — Choose energies and write Z</h3>
        <p>
          Set the lower level energy as the reference:
          <b>E<sub>1</sub> = 0</b>, <b>E<sub>2</sub> = k<sub>B</sub>&Delta;</b>.
          This is valid because shifting all energies by a constant does not change probabilities (it cancels in Z) and does not change heat capacity (derivative of a constant is zero).
        </p>
        <p>
          With <b>&beta; = 1/(k<sub>B</sub>T)</b>,
        </p>
        <div class="eqbox">
          <pre id="eq-Z"><code>Z = e^{-βE1} + e^{-βE2}
  = e^{0} + e^{-β k_B Δ}
  = 1 + e^{-Δ/T}.</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-Z">Copy equation (plain text)</button>
          </div>
        </div>

        <h3>Step 2 — Compute probabilities and internal energy U</h3>
        <p>
          The canonical probability of level i is <b>p<sub>i</sub> = e<sup>-βE<sub>i</sub></sup>/Z</b>.
          Because the sum is finite, we can compute exactly:
        </p>
        <div class="eqbox">
          <pre id="eq-p"><code>p1 = 1/Z = 1 / (1 + e^{-Δ/T})
p2 = e^{-Δ/T}/Z = e^{-Δ/T} / (1 + e^{-Δ/T}).</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-p">Copy equation (plain text)</button>
          </div>
        </div>
        <p>
          The internal energy (mean energy) is linear in probabilities:
          <b>U = p<sub>1</sub>E<sub>1</sub> + p<sub>2</sub>E<sub>2</sub></b>.
          Since E<sub>1</sub>=0,
        </p>
        <div class="eqbox">
          <pre id="eq-U1"><code>U(T) = p2 · (k_B Δ)
     = k_B Δ · [ e^{-Δ/T} / (1 + e^{-Δ/T}) ].</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-U1">Copy equation (plain text)</button>
          </div>
        </div>
        <p>
          It is often algebraically cleaner to multiply numerator and denominator by e<sup>Δ/T</sup>:
        </p>
        <div class="eqbox">
          <pre id="eq-U2"><code>U(T) = k_B Δ / (1 + e^{Δ/T}).</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-U2">Copy equation (plain text)</button>
          </div>
        </div>

        <h3>Step 3 — Differentiate to get heat capacity C</h3>
        <p>
          By definition at fixed splitting &Delta;,
          <b>C = (∂U/∂T)<sub>Δ</sub></b>.
          Let
          <b>x = Δ/T</b> (dimensionless). Then
          <b>x(T) = Δ T^{-1}</b> and
          <b>dx/dT = -Δ/T^2 = -x/T</b>.
        </p>

        <p>Rewrite U as a function of x:</p>
        <div class="eqbox">
          <pre id="eq-Ux"><code>U(x) = k_B Δ / (1 + e^{x}),  where x = Δ/T.</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-Ux">Copy equation (plain text)</button>
          </div>
        </div>

        <p>
          Differentiate using the chain rule (valid because U is a smooth composition of elementary functions for T&gt;0):
        </p>
        <div class="eqbox">
          <pre id="eq-chain"><code>C = dU/dT = (dU/dx)(dx/dT).</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-chain">Copy equation (plain text)</button>
          </div>
        </div>

        <p>Compute dU/dx explicitly:</p>
        <div class="eqbox">
          <pre id="eq-dUdx"><code>U(x) = k_B Δ (1 + e^{x})^{-1}

dU/dx = k_B Δ · [ -1 · (1 + e^{x})^{-2} · (d/dx)(1 + e^{x}) ]
      = k_B Δ · [ -(e^{x}) / (1 + e^{x})^2 ].</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-dUdx">Copy equation (plain text)</button>
          </div>
        </div>

        <p>Now multiply by dx/dT = -Δ/T^2:</p>
        <div class="eqbox">
          <pre id="eq-Cderive"><code>C = (dU/dx)(dx/dT)
  = [ -k_B Δ · e^{x} / (1 + e^{x})^2 ] · [ -Δ/T^2 ]
  = k_B (Δ^2/T^2) · e^{x} / (1 + e^{x})^2.</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-Cderive">Copy equation (plain text)</button>
          </div>
        </div>

        <div class="card" style="margin-top:10px">
          <div class="tag good">Final result (boxed)</div>
          <div class="eqbox">
            <pre id="eq-final"><code>C(T) = k_B (Δ/T)^2 · e^{Δ/T} / (1 + e^{Δ/T})^2.</code></pre>
            <div class="copyRow">
              <button class="copy" data-copy-target="eq-final">Copy equation (plain text)</button>
            </div>
          </div>
        </div>

        <h3>Sanity checks</h3>
        <div class="callouts">
          <div class="card">
            <div class="tag math">Units / dimensions</div>
            <ul>
              <li>(Δ/T) is dimensionless (both are in K because the physical splitting is k<sub>B</sub>Δ).</li>
              <li>The fraction involving exponentials is dimensionless.</li>
              <li>Therefore C has units of k<sub>B</sub>, i.e. J/K — correct for “per system”.</li>
            </ul>
          </div>
          <div class="card">
            <div class="tag good">Limits</div>
            <ul>
              <li><b>T &rightarrow; 0</b> (x→∞): e<sup>x</sup>/(1+e<sup>x</sup>)<sup>2</sup> ~ e<sup>-x</sup> ⇒ C ~ k<sub>B</sub> x<sup>2</sup> e<sup>-x</sup> → 0.</li>
              <li><b>T &rightarrow; ∞</b> (x→0): fraction → 1/4 ⇒ C ~ k<sub>B</sub> x<sup>2</sup>/4 → 0.</li>
              <li><b>Positivity:</b> all factors are nonnegative ⇒ C ≥ 0.</li>
            </ul>
          </div>
        </div>

        <h3>High-temperature asymptotics (T &gg; Δ)</h3>
        <p>
          Let <b>x = Δ/T</b>. For T &gg; Δ, we have x &ll; 1.
          Expand the dimensionless factor:
          <b>f(x) = e<sup>x</sup>/(1+e<sup>x</sup>)<sup>2</sup></b>.
          A convenient identity is
          <b>f(x) = 1/(2+2cosh x)</b>, because
          <b>(1+e<sup>x</sup>)<sup>2</sup> = e<sup>x</sup>(e<sup>-x</sup> + 2 + e<sup>x</sup>) = e<sup>x</sup>(2+2cosh x)</b>.
          Thus:
        </p>
        <div class="eqbox">
          <pre id="eq-fx"><code>f(x) = e^{x}/(1+e^{x})^2 = 1 / (2 + 2 cosh x).</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-fx">Copy equation (plain text)</button>
          </div>
        </div>

        <p>
          Now expand cosh x = 1 + x<sup>2</sup>/2 + O(x<sup>4</sup>):
        </p>
        <div class="eqbox">
          <pre id="eq-asym1"><code>2 + 2 cosh x = 2 + 2(1 + x^2/2 + O(x^4))
            = 4 + x^2 + O(x^4).

So f(x) = 1/(4 + x^2 + O(x^4))
        = (1/4) · 1/(1 + x^2/4 + O(x^4))
        = (1/4) · [1 - x^2/4 + O(x^4)].</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-asym1">Copy equation (plain text)</button>
          </div>
        </div>

        <p>
          Substitute into <b>C = k<sub>B</sub> x<sup>2</sup> f(x)</b>:
        </p>
        <div class="eqbox">
          <pre id="eq-asym2"><code>C = k_B x^2 · (1/4)[1 - x^2/4 + O(x^4)]
  = k_B (x^2/4) - k_B (x^4/16) + O(x^6).

Leading term:
C ≈ k_B (Δ/T)^2 / 4 = k_B (Δ/2T)^2.</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-asym2">Copy equation (plain text)</button>
          </div>
        </div>

        <div class="card" style="margin-top:10px">
          <div class="tag good">Final answer (plain text, boxed)</div>
          <pre id="final-answer"><code>For a two-level system with energies E1 = 0 and E2 = k_B Δ:

Z = 1 + e^{-Δ/T}
U = k_B Δ / (1 + e^{Δ/T})
C = (∂U/∂T)_Δ = k_B (Δ/T)^2 · e^{Δ/T} / (1 + e^{Δ/T})^2

High-T (T >> Δ):  C = k_B (Δ/2T)^2 + O((Δ/T)^4).</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="final-answer">Copy final answer (plain text)</button>
          </div>
        </div>

        <figure>
          <canvas id="plot" aria-label="Plot of dimensionless heat capacity C/kB vs T/Δ"></canvas>
          <figcaption>
            <b>One key plot (dimensionless):</b> Schottky anomaly for a two-level system.
            We plot <b>C/k<sub>B</sub></b> versus <b>T/Δ</b> using the derived formula (no fitted numbers required).
          </figcaption>
        </figure>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the final formula</h3>
        <p>
          Write the dimensionless form using <b>x = Δ/T</b>:
        </p>
        <div class="eqbox">
          <pre id="eq-dimless"><code>C/k_B = x^2 · e^{x} / (1 + e^{x})^2,  where x = Δ/T.</code></pre>
          <div class="copyRow">
            <button class="copy" data-copy-target="eq-dimless">Copy equation (plain text)</button>
          </div>
        </div>
        <ul>
          <li><b>x^2 = (Δ/T)^2</b> sets an overall scale: bigger splitting pushes the peak to higher temperatures.</li>
          <li>The factor <b>e^{x}/(1+e^{x})^2</b> is exactly <b>p(1-p)</b> for a Bernoulli variable, where <b>p</b> is the excited-state probability (up to a simple rewrite). It maximizes near intermediate temperatures, producing the peak.</li>
        </ul>

        <h3>Parameter dependence (qualitative)</h3>
        <ul>
          <li><b>Increase Δ</b> (stronger field, larger splitting): peak shifts to larger T; low-T activation becomes stronger.</li>
          <li><b>Increase T</b> at fixed Δ: C rises from ~0, reaches a maximum, then falls ~1/T<sup>2</sup>.</li>
          <li><b>Multiple independent units:</b> C scales linearly with count: for N identical non-interacting systems, <b>C_total = N C</b>; for molar heat capacity, <b>C_molar = N_A C</b>.</li>
        </ul>

        <details>
          <summary>Alternative derivation idea (brief but meaningful)</summary>
          <p>
            Use the fluctuation identity (derived from Z and differentiation under the trace/sum):
          </p>
          <div class="eqbox">
            <pre id="eq-alt"><code>C = (1/(k_B T^2)) (⟨E^2⟩ − ⟨E⟩^2).</code></pre>
            <div class="copyRow">
              <button class="copy" data-copy-target="eq-alt">Copy equation (plain text)</button>
            </div>
          </div>
          <p>
            For energies {0, k<sub>B</sub>Δ}, the random variable E takes value k<sub>B</sub>Δ with probability p and 0 with probability (1−p),
            so Var(E) = (k<sub>B</sub>Δ)<sup>2</sup> p(1−p). With p = 1/(1+e<sup>Δ/T</sup>) this reproduces exactly:
            C = k<sub>B</sub>(Δ/T)<sup>2</sup> e<sup>Δ/T</sup>/(1+e<sup>Δ/T</sup>)<sup>2</sup>.
          </p>
        </details>

        <h3>Concept check (self-test with answers)</h3>
        <ul>
          <li><b>Q:</b> Why does C go to zero as T→∞? <b>A:</b> Populations saturate to 1/2 and stop changing appreciably; dU/dT→0, specifically ~1/T<sup>2</sup>.</li>
          <li><b>Q:</b> Why is the peak called an “anomaly”? <b>A:</b> It’s an extra contribution (beyond phonons/electrons) that stands out as a hump/peak.</li>
          <li><b>Q:</b> What sets the peak position? <b>A:</b> The competition between thermal energy k<sub>B</sub>T and the splitting k<sub>B</sub>Δ; maximum sensitivity occurs for T on the order of Δ.</li>
          <li><b>Q:</b> If the excited state were doubly degenerate (g<sub>2</sub>=2), what changes? <b>A:</b> Replace Z by 1 + 2e<sup>-Δ/T</sup>; the shape and peak shift slightly; degeneracy enters as a multiplicative factor in Boltzmann weights.</li>
        </ul>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>

      <section id="part5">
        <h2>PART 5 — Optional Plot Guide</h2>

        <p>
          A plot is useful here because the result is strongly <b>non-monotonic</b> and the key physical feature is the <b>Schottky peak</b>.
          No numerical constants are needed because the curve is naturally dimensionless.
        </p>

        <div class="grid2">
          <div class="card">
            <div class="tag">Axes &amp; units</div>
            <ul>
              <li><b>x-axis:</b> T/Δ (dimensionless).</li>
              <li><b>y-axis:</b> C/k<sub>B</sub> (dimensionless).</li>
              <li>Formula plotted:
                <b>C/k<sub>B</sub> = (Δ/T)<sup>2</sup> e<sup>Δ/T</sup> / (1 + e<sup>Δ/T</sup>)<sup>2</sup></b>.
              </li>
            </ul>
          </div>
          <div class="card">
            <div class="tag warn">What features to notice</div>
            <ul>
              <li><b>Peak:</b> single maximum at intermediate T/Δ (Schottky anomaly).</li>
              <li><b>Low-T tail:</b> rapidly suppressed (activated), ~e<sup>-Δ/T</sup>.</li>
              <li><b>High-T tail:</b> decays like <b>(Δ/2T)<sup>2</sup></b>, i.e. ~1/T<sup>2</sup>.</li>
            </ul>
          </div>
        </div>

        <a class="backTop" href="#top">↑ Back to top</a>
      </section>
    </article>
  </main>

  <footer>
    <p>
      Built as a self-contained learning article: canonical ensemble → partition function → internal energy → heat capacity →
      asymptotics and engineering relevance. No external libraries.
    </p>
  </footer>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // Smooth scrolling for in-page links
    (function(){
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      document.querySelectorAll('a[href^="#"]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          const id = a.getAttribute('href').slice(1);
          const el = document.getElementById(id);
          if(!el) return;
          e.preventDefault();
          el.scrollIntoView({behavior: prefersReduced ? 'auto' : 'smooth', block:'start'});
          history.pushState(null, '', '#'+id);
        });
      });
    })();

    // Copy buttons (plain text)
    (function(){
      const toast = document.getElementById('toast');
      let tHandle = null;

      function showToast(msg){
        toast.textContent = msg;
        toast.classList.add('show');
        clearTimeout(tHandle);
        tHandle = setTimeout(()=>toast.classList.remove('show'), 1400);
      }

      async function copyTextFromElementId(id){
        const el = document.getElementById(id);
        if(!el) return false;
        const text = el.innerText.replace(/\u00a0/g,' ');
        try{
          await navigator.clipboard.writeText(text);
          return true;
        }catch(err){
          // Fallback
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed';
          ta.style.opacity = '0';
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          let ok = false;
          try{ ok = document.execCommand('copy'); }catch(e){ ok=false; }
          document.body.removeChild(ta);
          return ok;
        }
      }

      document.querySelectorAll('button.copy').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          const target = btn.getAttribute('data-copy-target');
          const ok = await copyTextFromElementId(target);
          showToast(ok ? 'Copied.' : 'Copy failed.');
        });
      });
    })();

    // One static plot: C/kB vs T/Δ (dimensionless), rendered crisp on high DPI.
    (function(){
      const canvas = document.getElementById('plot');
      const ctx = canvas.getContext('2d');

      function C_over_kB(T_over_D){
        // C/kB = (D/T)^2 * e^{D/T} / (1 + e^{D/T})^2
        // Here D/T = 1/(T/D) = 1/(T_over_D)
        const x = 1 / Math.max(T_over_D, 1e-6); // x = Δ/T
        const ex = Math.exp(x);
        const denom = (1 + ex);
        return (x*x) * ex / (denom*denom);
      }

      function setupSize(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const rect = canvas.getBoundingClientRect();
        const w = Math.max(320, rect.width);
        const h = rect.height || 320;
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0); // work in CSS pixels
        return {w, h, dpr};
      }

      function draw(){
        const {w, h} = setupSize();

        // Layout
        const padL = 58, padR = 18, padT = 40, padB = 44;
        const pw = w - padL - padR;
        const ph = h - padT - padB;

        // Domain: T/Δ from 0.05 to 6 (like the textbook figure).
        const xmin = 0.05, xmax = 6.0;

        // y-range: compute approximate max on grid
        let ymax = 0;
        for(let i=0;i<=600;i++){
          const x = xmin + (xmax-xmin)*i/600;
          ymax = Math.max(ymax, C_over_kB(x));
        }
        ymax = Math.max(0.45, ymax*1.08); // a little headroom

        function X(x){ return padL + (x - xmin) * pw / (xmax - xmin); }
        function Y(y){ return padT + ph - (y) * ph / ymax; }

        // Background
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = 'rgba(6,10,16,.15)';
        ctx.fillRect(0,0,w,h);

        // Gridlines and ticks
        ctx.lineWidth = 1;

        // grid: x ticks 0..6 step 1; y ticks 0..0.5 step 0.1 (scaled by ymax)
        const xTicks = [0,1,2,3,4,5,6];
        const yTickStep = 0.1;
        const yTicks = [];
        for(let y=0; y<=0.6; y+=yTickStep) yTicks.push(+y.toFixed(1));

        // grid style
        ctx.strokeStyle = 'rgba(255,255,255,.08)';
        ctx.fillStyle = 'rgba(255,255,255,.60)';
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';

        // x grid + labels
        xTicks.forEach(v=>{
          if(v < xmin || v > xmax) return;
          const xx = X(v);
          ctx.beginPath();
          ctx.moveTo(xx, padT);
          ctx.lineTo(xx, padT+ph);
          ctx.stroke();

          ctx.fillStyle = 'rgba(231,238,252,.75)';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'top';
          ctx.fillText(String(v), xx, padT+ph+8);
        });

        // y grid + labels
        yTicks.forEach(v=>{
          if(v > ymax) return;
          const yy = Y(v);
          ctx.beginPath();
          ctx.moveTo(padL, yy);
          ctx.lineTo(padL+pw, yy);
          ctx.stroke();

          ctx.fillStyle = 'rgba(231,238,252,.75)';
          ctx.textAlign = 'right';
          ctx.textBaseline = 'middle';
          ctx.fillText(v.toFixed(1), padL-8, yy);
        });

        // Axes
        ctx.strokeStyle = 'rgba(255,255,255,.22)';
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(padL, padT);
        ctx.lineTo(padL, padT+ph);
        ctx.lineTo(padL+pw, padT+ph);
        ctx.stroke();

        // Title
        ctx.fillStyle = 'rgba(231,238,252,.92)';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'top';
        ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.fillText('Schottky Anomaly: Two-Level Heat Capacity', padL, 12);

        // Axis labels
        ctx.fillStyle = 'rgba(231,238,252,.80)';
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText('T / Δ  (dimensionless)', padL + pw/2, padT+ph+36);

        // y label (rotated)
        ctx.save();
        ctx.translate(16, padT + ph/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText('C / k_B  (dimensionless)', 0, 0);
        ctx.restore();

        // Curve
        ctx.strokeStyle = 'rgba(125,211,252,.95)';
        ctx.lineWidth = 2.0;
        ctx.beginPath();
        for(let i=0;i<=700;i++){
          const t = i/700;
          const x = xmin + (xmax-xmin)*t;
          const y = C_over_kB(x);
          const xx = X(x), yy = Y(y);
          if(i===0) ctx.moveTo(xx,yy);
          else ctx.lineTo(xx,yy);
        }
        ctx.stroke();

        // Legend
        const lx = padL + pw - 180;
        const ly = padT + 10;
        ctx.fillStyle = 'rgba(0,0,0,.25)';
        ctx.strokeStyle = 'rgba(255,255,255,.12)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        roundRect(ctx, lx, ly, 170, 34, 10);
        ctx.fill();
        ctx.stroke();

        ctx.strokeStyle = 'rgba(125,211,252,.95)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(lx+12, ly+18);
        ctx.lineTo(lx+42, ly+18);
        ctx.stroke();

        ctx.fillStyle = 'rgba(231,238,252,.85)';
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText('C/k_B formula', lx+52, ly+18);
      }

      function roundRect(ctx, x, y, w, h, r){
        const rr = Math.min(r, w/2, h/2);
        ctx.moveTo(x+rr, y);
        ctx.arcTo(x+w, y, x+w, y+h, rr);
        ctx.arcTo(x+w, y+h, x, y+h, rr);
        ctx.arcTo(x, y+h, x, y, rr);
        ctx.arcTo(x, y, x+w, y, rr);
        ctx.closePath();
      }

      // Initial draw + resize
      let resizeHandle = null;
      function onResize(){
        clearTimeout(resizeHandle);
        resizeHandle = setTimeout(draw, 80);
      }
      window.addEventListener('resize', onResize, {passive:true});
      draw();
    })();
  </script>
</body>
</html>
