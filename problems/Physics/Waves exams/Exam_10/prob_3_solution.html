<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Transmission Line Junction (Z0–ZL–Z1): Reflections, Transmission, and Currents</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.09);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --faint: rgba(255,255,255,0.55);
      --accent: #7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line: rgba(255,255,255,0.14);
      --shadow: 0 18px 50px rgba(0,0,0,0.45);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    html, body{
      height: 100%;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(125,211,252,0.12), transparent 55%),
                  radial-gradient(1200px 800px at 80% 20%, rgba(167,139,250,0.12), transparent 55%),
                  radial-gradient(900px 700px at 50% 90%, rgba(52,211,153,0.08), transparent 55%),
                  var(--bg);
      color: var(--text);
      font-family: var(--sans);
      margin: 0;
      line-height: 1.55;
      scroll-behavior: smooth;
    }

    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    header.hero{
      padding: 42px 20px 26px;
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid var(--line);
    }
    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
      padding: 18px 16px 44px;
    }
    @media (max-width: 980px){
      .wrap{
        grid-template-columns: 1fr;
      }
    }

    .hero-inner{
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .kicker{
      color: var(--muted);
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    h1{
      font-size: clamp(1.8rem, 2.8vw, 2.65rem);
      margin: 0;
      line-height: 1.2;
    }
    .sub{
      color: var(--muted);
      max-width: 90ch;
      margin-top: 6px;
      font-size: 1.05rem;
    }

    aside.toc{
      position: sticky;
      top: 14px;
      align-self: start;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.05));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 12px;
      backdrop-filter: blur(8px);
    }
    @media (max-width: 980px){
      aside.toc{ position: relative; top: 0; }
    }

    .toc h2{
      font-size: 1rem;
      margin: 0 0 8px;
      color: var(--text);
      letter-spacing: 0.02em;
    }
    .toc nav a{
      display: block;
      padding: 8px 10px;
      margin: 6px 0;
      border-radius: 12px;
      color: var(--muted);
      border: 1px solid transparent;
      transition: transform 160ms ease, background 160ms ease, border-color 160ms ease;
    }
    .toc nav a:hover{
      background: rgba(125,211,252,0.08);
      border-color: rgba(125,211,252,0.25);
      transform: translateY(-1px);
      color: var(--text);
      text-decoration: none;
    }
    .toc .mini{
      margin-top: 10px;
      font-size: 0.92rem;
      color: var(--faint);
      border-top: 1px dashed var(--line);
      padding-top: 10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.06);
      color: var(--muted);
      font-size: 0.92rem;
      margin-right: 8px;
      margin-top: 6px;
    }
    .dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(125,211,252,0.14);
    }

    main{
      display: grid;
      gap: 16px;
    }

    section.card{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.05));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
      animation: riseIn 420ms ease-out both;
    }
    @keyframes riseIn{
      from{ opacity: 0; transform: translateY(10px); }
      to{ opacity: 1; transform: translateY(0); }
    }

    section.card h2{
      margin: 0 0 10px;
      font-size: 1.25rem;
      letter-spacing: 0.01em;
    }
    section.card h3{
      margin: 14px 0 8px;
      font-size: 1.08rem;
      color: var(--text);
    }
    p{ margin: 8px 0; color: var(--muted); }
    ul{ margin: 8px 0 0 18px; color: var(--muted); }
    li{ margin: 6px 0; }

    .grid2{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 780px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .callout{
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 14px 14px 12px;
    }
    .callout strong{ color: var(--text); }
    .callout.good{ border-color: rgba(52,211,153,0.35); background: rgba(52,211,153,0.08); }
    .callout.warn{ border-color: rgba(251,191,36,0.35); background: rgba(251,191,36,0.07); }
    .callout.bad{ border-color: rgba(251,113,133,0.35); background: rgba(251,113,133,0.07); }

    .eq{
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 12px;
      overflow-x: auto;
      position: relative;
    }
    .eq pre{
      margin: 0;
      font-family: var(--mono);
      font-size: 0.95rem;
      color: rgba(255,255,255,0.9);
      white-space: pre;
    }
    .eq .row{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .eq .label{
      color: var(--faint);
      font-size: 0.9rem;
    }
    button.copy{
      appearance: none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor: pointer;
      transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
      font-size: 0.92rem;
      user-select: none;
    }
    button.copy:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,0.10);
      border-color: rgba(125,211,252,0.25);
    }
    button.copy:active{ transform: translateY(0); }

    .boxed{
      border: 1px solid rgba(125,211,252,0.30);
      background: linear-gradient(180deg, rgba(125,211,252,0.12), rgba(125,211,252,0.06));
      padding: 14px;
      border-radius: 16px;
    }

    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      align-items: end;
      margin-top: 12px;
    }
    @media (max-width: 860px){
      .controls{ grid-template-columns: 1fr; }
    }
    label{
      display:block;
      font-size: 0.92rem;
      color: var(--faint);
      margin-bottom: 6px;
    }
    input[type="range"]{
      width: 100%;
      accent-color: var(--accent);
    }
    .pill{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.12);
      font-family: var(--mono);
      font-size: 0.92rem;
      color: rgba(255,255,255,0.88);
    }

    figure.viz{
      margin: 0;
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow: hidden;
      background: rgba(0,0,0,0.25);
    }
    figure.viz figcaption{
      padding: 10px 12px;
      border-top: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size: 0.95rem;
    }
    canvas{
      width: 100%;
      height: 330px;
      display: block;
    }
    .canvasTall canvas{ height: 360px; }
    .canvasShort canvas{ height: 300px; }

    footer{
      max-width: 1180px;
      margin: 0 auto;
      padding: 20px 16px 40px;
      color: var(--faint);
      border-top: 1px solid var(--line);
    }

    /* Print-friendly */
    @media print{
      :root{ --bg: #ffffff; --text:#111; --muted:#333; --faint:#444; }
      body{ background: #fff !important; color:#111; }
      header.hero, .wrap, footer{ box-shadow:none !important; }
      aside.toc{ display:none; }
      section.card{ break-inside: avoid; page-break-inside: avoid; border:1px solid #ddd; background:#fff; box-shadow:none; }
      figure.viz{ display:none; } /* keep math readable */
      button.copy{ display:none; }
      a{ color:#111; text-decoration: underline; }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-inner">
      <div class="kicker">Physics • Transmission Lines • Reflections & Matching</div>
      <h1>Two Transmission Lines Joined by a Lumped Load: Reflection, Transmission, and Currents</h1>
      <p class="sub">
        We analyze a harmonic wave traveling on a line with characteristic impedance <span style="color:var(--text)"><b>Z₀ = 50 Ω</b></span>
        toward a junction at <b>z = 0</b>, where a lumped load <b>Z<sub>L</sub></b> is placed across the line and a second line
        of characteristic impedance <span style="color:var(--text)"><b>Z₁ = 100 Ω</b></span> continues to the right. The far end of line 2 is reflection-free.
      </p>
      <div>
        <span class="badge"><span class="dot"></span>Interactive: sweep Z<sub>L</sub> and see Γ, τ and plots update</span>
        <span class="badge"><span class="dot" style="background:var(--accent2); box-shadow:0 0 0 4px rgba(167,139,250,0.14)"></span>Canvas: diagram + two quantitative plots</span>
      </div>
    </div>
  </header>

  <div class="wrap">
    <aside class="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <nav>
        <a href="#quick">Quick Summary</a>
        <a href="#viz">Interactive Visualizations</a>
        <a href="#part1">PART 1 — Problem Analysis</a>
        <a href="#part2">PART 2 — Strategy & Tips</a>
        <a href="#part3">PART 3 — Full Solution</a>
        <a href="#answers">Final Boxed Answers</a>
      </nav>
      <div class="mini">
        <div><b>Given:</b> Z₀ = 50 Ω, Z₁ = 100 Ω</div>
        <div><b>Junction:</b> z = 0</div>
        <div><b>Wave:</b> V = V₀ cos(ωt)</div>
      </div>
    </aside>

    <main>
      <section class="card" id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li>The left line (Z₀) “sees” a termination at z=0 equal to the <b>parallel combination</b> of the lumped load and the input of line 2: <b>Z<sub>T</sub> = Z<sub>L</sub> ∥ Z₁</b> (because line 2 has no reflection, so it looks like Z₁).</li>
          <li>Reflection coefficient on line 1: <b>Γ = (Z<sub>T</sub> − Z₀)/(Z<sub>T</sub> + Z₀)</b>, and the junction voltage is <b>V(0) = V<sub>i</sub>(1+Γ)</b>.</li>
          <li>For <b>Z<sub>L</sub> = 0</b>: Z<sub>T</sub>=0 ⇒ <b>Γ = −1</b> ⇒ the junction voltage is zero ⇒ <b>no transmitted voltage</b> into line 2.</li>
          <li>For <b>Z<sub>L</sub> = 100 Ω</b>: Z<sub>T</sub>=100∥100=50Ω ⇒ <b>Γ=0</b> ⇒ <b>perfect match</b> (no reflection), and <b>V<sub>t</sub> = V<sub>i</sub></b> at the junction.</li>
          <li>If the maximum conductor current on the left line is 10 A and Γ=0, then V̂ = ÎZ₀ = 500 V; thus <b>Î<sub>load</sub> = 5 A</b> and the right-line conductor currents also have <b>5 A</b> magnitude.</li>
        </ul>
      </section>

      <section class="card" id="viz">
        <h2>Interactive Visualizations</h2>
        <p>
          Use the slider to change <b>Z<sub>L</sub></b>. The diagram and both plots update live using the same formulas used in the solution.
          (For the homework’s later parts, set <b>Z<sub>L</sub> = 100 Ω</b>.)
        </p>

        <div class="controls" aria-label="Interactive controls">
          <div class="callout">
            <label for="zlRange"><b>Control:</b> Load impedance Z<sub>L</sub> (Ω)</label>
            <input id="zlRange" type="range" min="0" max="300" step="1" value="100" />
            <div class="pill" style="margin-top:10px;">
              <span>Z<sub>L</sub></span><span id="zlRead">100 Ω</span>
            </div>
          </div>

          <div class="callout">
            <label><b>Computed termination</b> seen by line 1 at z=0</label>
            <div class="pill"><span>Z<sub>T</sub> = Z<sub>L</sub> ∥ Z₁</span><span id="ztRead">50.00 Ω</span></div>
            <div class="pill" style="margin-top:8px;"><span>Γ = (Z<sub>T</sub>−Z₀)/(Z<sub>T</sub>+Z₀)</span><span id="gRead">0.000</span></div>
          </div>

          <div class="callout">
            <label><b>Transmission (voltage at junction)</b></label>
            <div class="pill"><span>V(0)/V<sub>i</sub> = 1 + Γ</span><span id="v0ratioRead">1.000</span></div>
            <div class="pill" style="margin-top:8px;"><span>I into line 2 / (V(0))</span><span id="i2factorRead">1/Z₁</span></div>
          </div>
        </div>

        <div class="grid2" style="margin-top:14px;">
          <figure class="viz canvasShort">
            <canvas id="setupCanvas" aria-label="Transmission line setup diagram"></canvas>
            <figcaption>
              <b>Diagram:</b> Incident wave on Z₀ approaches z=0; a lumped shunt load Z<sub>L</sub> is at the junction; line 2 (Z₁) carries only a forward wave (no far-end reflection).
            </figcaption>
          </figure>

          <figure class="viz canvasShort">
            <canvas id="plotMain" aria-label="Main plot of reflection coefficient versus load impedance"></canvas>
            <figcaption>
              <b>Main plot:</b> Reflection magnitude |Γ| vs Z<sub>L</sub> (Ω), where Z<sub>T</sub>=Z<sub>L</sub>∥Z₁.
            </figcaption>
          </figure>
        </div>

        <figure class="viz canvasTall" style="margin-top:14px;">
          <canvas id="plotSecondary" aria-label="Secondary plot of transmission ratio versus load impedance"></canvas>
          <figcaption>
            <b>Secondary plot:</b> Junction-voltage ratio V(0)/V<sub>i</sub> = 1+Γ vs Z<sub>L</sub>. This is also the transmitted-line boundary voltage (at z=0).
          </figcaption>
        </figure>
      </section>

      <section class="card" id="part1">
        <h2>PART 1 — Problem Analysis (no solving yet)</h2>

        <h3>1) Restate the problem in my own words</h3>
        <p>
          A sinusoidal source drives a transmission line with characteristic impedance Z₀=50Ω. A forward-traveling voltage wave moves in the +z direction and reaches a junction at z=0.
          At that junction, a lumped load impedance Z<sub>L</sub> is connected across the line, and a second line of characteristic impedance Z₁=100Ω continues for z&gt;0.
          The far end of the second line has no reflection (so it is effectively matched).
          We must write the incident wave, then find reflected and transmitted amplitudes for specific Z<sub>L</sub>, and finally compute currents when Z<sub>L</sub>=100Ω.
        </p>

        <h3>2) Given quantities</h3>
        <ul>
          <li>Characteristic impedances: <b>Z₀ = 50 Ω</b>, <b>Z₁ = 100 Ω</b></li>
          <li>Drive: <b>V = V₀ cos(ωt)</b> (harmonic at angular frequency ω)</li>
          <li>Wave number: <b>k = ω/v</b>, where v is phase velocity</li>
          <li>Junction location: <b>z = 0</b>, z increases to the right</li>
          <li>No reflection from far end of line 2 ⇒ line 2 supports only a <b>forward</b> wave for z&gt;0</li>
          <li>Cases: (b) Z<sub>L</sub>=0; (c–e) Z<sub>L</sub>=100Ω</li>
          <li>In (e): maximum current in the upper wire for z&lt;0 is <b>10 A</b></li>
        </ul>

        <h3>3) Unknowns</h3>
        <ul>
          <li>Incident-wave expression V<sub>i</sub>(z&lt;0,t)</li>
          <li>Reflected voltage amplitude V<sub>r</sub> relative to V<sub>i</sub></li>
          <li>Transmitted voltage amplitude V<sub>t</sub> relative to V<sub>i</sub></li>
          <li>Net terminating impedance seen by line 1 at z=0</li>
          <li>Peak currents in: left-line lower wire, load, right-line upper & lower wires</li>
        </ul>

        <h3>4) What must be found/proved</h3>
        <ul>
          <li>(a) A correct traveling-wave form for the incident voltage wave on z&lt;0.</li>
          <li>(b) Reflection/transmission (voltage) amplitudes for Z<sub>L</sub>=0.</li>
          <li>(c) With Z<sub>L</sub>=100Ω, compute the effective termination Z<sub>T</sub> at z=0.</li>
          <li>(d) With that Z<sub>T</sub>, compute reflected and transmitted voltage amplitudes.</li>
          <li>(e) Using the stated peak current on the left line, compute peak currents in specified conductors and the load.</li>
        </ul>

        <h3>5) Relevant physical principles (and why they apply)</h3>
        <ul>
          <li><b>Telegrapher’s-equation traveling waves:</b> On a uniform lossless transmission line, voltage/current decompose into forward and backward waves with fixed ratio set by the line’s characteristic impedance (V/I = ±Z).</li>
          <li><b>Boundary conditions at a lumped discontinuity:</b> At z=0, the <b>voltage across the conductors is continuous</b>, and <b>currents satisfy Kirchhoff’s current law</b> (current into node splits into load + transmitted-line current). This determines reflection/transmission.</li>
          <li><b>Input impedance of a reflection-free line:</b> If line 2 has no reflection, it behaves like a simple resistor equal to its characteristic impedance Z₁ when viewed from the junction.</li>
        </ul>

        <h3>6) Candidate approaches (2–3) and comparison</h3>
        <ul>
          <li><b>(A) Reflection-coefficient method using effective termination Z<sub>T</sub>:</b> Replace the “load + line 2” by Z<sub>T</sub>, compute Γ and then the junction voltage/transmitted wave. Fast and clean.</li>
          <li><b>(B) Solve by explicit boundary conditions:</b> Write V and I as sums of forward/backward waves on each side, then apply continuity of V and KCL at z=0. More algebra, but very systematic.</li>
          <li><b>(C) Equivalent-circuit viewpoint:</b> Treat the lines as Thevenin/Norton equivalents at the junction. Works, but typically less direct than (A) or (B) for wave amplitudes.</li>
        </ul>

        <h3>7) Best approach (and justification)</h3>
        <p>
          <b>Approach (A)</b> is best here because the problem explicitly says there is no reflection at the far end of the second line,
          so line 2 looks like a pure impedance Z₁. Then the junction reduces to a single effective termination <b>Z<sub>T</sub> = Z<sub>L</sub> ∥ Z₁</b>,
          and the standard reflection formula on line 1 gives the answer with minimal algebra.
        </p>
      </section>

      <section class="card" id="part2">
        <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

        <h3>Minimal plan (5–10 steps)</h3>
        <ol style="color:var(--muted); margin-left:18px;">
          <li>
            <b>Write the incident wave</b> traveling toward +z.
            <div class="callout" style="margin-top:6px;">
              <b>Tool:</b> Traveling-wave form on a lossless line: V(z,t)=V̂ cos(ωt − kz) for +z propagation.
            </div>
          </li>
          <li>
            <b>Replace line 2 by its input impedance</b> at z=0.
            <div class="callout" style="margin-top:6px;">
              <b>Tool:</b> Reflection-free (matched) line presents Z<sub>in</sub>=Z₁.
            </div>
          </li>
          <li>
            <b>Compute the effective termination</b> seen by line 1.
            <div class="callout" style="margin-top:6px;">
              <b>Tool:</b> Parallel combination: Z<sub>T</sub>=Z<sub>L</sub>∥Z₁.
            </div>
          </li>
          <li>
            <b>Compute reflection coefficient</b> on line 1.
            <div class="callout" style="margin-top:6px;">
              <b>Tool:</b> Γ=(Z<sub>T</sub>−Z₀)/(Z<sub>T</sub>+Z₀).
            </div>
          </li>
          <li>
            <b>Get transmitted boundary voltage</b> and relate it to the wave on line 2.
            <div class="callout" style="margin-top:6px;">
              <b>Tool:</b> V(0)=V<sub>i</sub>(0)+V<sub>r</sub>(0)=V<sub>i</sub>(0)(1+Γ), and continuity gives V<sub>t</sub>(0)=V(0).
            </div>
          </li>
          <li>
            <b>Compute currents</b> using I=V/Z for each forward wave (and KCL for the load).
            <div class="callout" style="margin-top:6px;">
              <b>Tool:</b> For a forward wave on a line of impedance Z: Î = V̂/Z.
            </div>
          </li>
        </ol>

        <h3>Common mistakes & quick tips</h3>
        <div class="grid2">
          <div class="callout warn">
            <strong>Mistake:</strong> Treating Z<sub>L</sub> as “the” termination and forgetting line 2 contributes an impedance.<br/>
            <strong>Tip:</strong> Always compute what line 1 “sees”: Z<sub>T</sub>=Z<sub>L</sub>∥Z₁ (here).
          </div>
          <div class="callout warn">
            <strong>Mistake:</strong> Mixing sign conventions for current vs voltage for forward/backward waves.<br/>
            <strong>Tip:</strong> Use the standard: for +z wave, I = +V/Z; for −z wave, I = −V/Z.
          </div>
          <div class="callout warn">
            <strong>Mistake:</strong> Saying “transmitted voltage coefficient is 2Z₁/(Z₀+Z₁)” blindly.<br/>
            <strong>Tip:</strong> That formula is for a simple step discontinuity with no extra shunt load. Here the shunt Z<sub>L</sub> changes the effective termination.
          </div>
          <div class="callout good">
            <strong>Quick check:</strong> If Z<sub>T</sub>=Z₀ then Γ=0 (no reflection). If Z<sub>T</sub>=0 then Γ=−1 (short). If Z<sub>T</sub>→∞ then Γ→+1 (open).
          </div>
        </div>

        <p><i>As requested: no algebraic derivations shown in this section.</i></p>
      </section>

      <section class="card" id="part3">
        <h2>PART 3 — Full Solution</h2>

        <h3>Physical intuition first</h3>
        <p>
          A transmission line carries energy as a wave. When the wave meets a discontinuity (here: a shunt load plus a different line),
          part of the wave reflects if the impedance the wave “sees” is not equal to the line’s characteristic impedance Z₀.
          Because the second line is reflection-free at its far end, it behaves like a simple resistor Z₁ as seen from the junction.
          Therefore, the junction is equivalent to a single termination impedance <b>Z<sub>T</sub>=Z<sub>L</sub>∥Z₁</b> for the first line.
          Once Z<sub>T</sub> is known, reflection and transmission follow from standard boundary conditions.
        </p>

        <article>
          <h3>(a) Incident voltage wave approaching the junction from the left</h3>
          <p>
            The incident wave travels in the +z direction toward z=0. For a harmonic wave on a lossless line:
          </p>

          <div class="eq" id="eq-a">
            <div class="row">
              <div class="label">Key equation (copyable)</div>
              <button class="copy" data-copy="Vi(z,t)=V0 cos(ω t − k z),  for z&lt;0 (wave travels toward +z)">Copy</button>
            </div>
            <pre>Vᵢ(z,t) = V₀ cos(ω t − k z),    for z &lt; 0,   k = ω/v</pre>
          </div>

          <p>
            (Equivalently, in phasor form: Vᵢ(z,t)=Re{V₀ e^{i(ωt−kz)}}.)
          </p>

          <h3>(b) Reflected and transmitted voltage amplitudes for Z<sub>L</sub> = 0</h3>
          <p>
            With Z<sub>L</sub>=0, the load is a short across the conductors at the junction.
            Since the second line is in parallel with that short, the net termination seen by line 1 is:
          </p>

          <div class="eq" id="eq-b1">
            <div class="row">
              <div class="label">Effective termination</div>
              <button class="copy" data-copy="ZT = ZL ∥ Z1. If ZL=0 then ZT=0.">Copy</button>
            </div>
            <pre>Z_T = Z_L ∥ Z₁.   If Z_L = 0  ⇒  Z_T = 0 ∥ Z₁ = 0.</pre>
          </div>

          <p>
            The reflection coefficient on line 1 (characteristic impedance Z₀) is
          </p>

          <div class="eq" id="eq-b2">
            <div class="row">
              <div class="label">Reflection coefficient</div>
              <button class="copy" data-copy="Γ = (ZT − Z0)/(ZT + Z0). If ZT=0 then Γ=−1.">Copy</button>
            </div>
            <pre>Γ = (Z_T − Z₀)/(Z_T + Z₀).  With Z_T=0 ⇒ Γ = (−Z₀)/(+Z₀) = −1.</pre>
          </div>

          <p>
            Therefore, the reflected voltage amplitude is V<sub>r</sub> = Γ V<sub>i</sub> = −V<sub>i</sub>. The junction voltage is
            V(0)=V<sub>i</sub>(0)+V<sub>r</sub>(0)=V<sub>i</sub>(0)(1+Γ)=0, so there is no voltage to launch a forward wave into line 2.
          </p>

          <div class="boxed">
            <p style="margin:0; color:var(--text);">
              <b>Result for (b), relative to V<sub>i</sub>:</b><br/>
              V<sub>r</sub>/V<sub>i</sub> = <b>−1</b>, &nbsp;&nbsp; V<sub>t</sub>/V<sub>i</sub> = <b>0</b>.
            </p>
          </div>

          <h3>(c) For the remaining parts, Z<sub>L</sub> = 100 Ω: net impedance terminating line 1 at z=0</h3>
          <p>
            Because the far end of line 2 is reflection-free, line 2 looks like an impedance Z₁ at the junction.
            The lumped load Z<sub>L</sub> is connected across the same two conductors at z=0, so it is in <b>parallel</b> with Z₁.
          </p>

          <div class="eq" id="eq-c">
            <div class="row">
              <div class="label">Termination seen by line 1</div>
              <button class="copy" data-copy="ZT = ZL ∥ Z1 = (ZL Z1)/(ZL + Z1). For ZL=100Ω and Z1=100Ω, ZT=50Ω.">Copy</button>
            </div>
            <pre>Z_T = Z_L ∥ Z₁ = (Z_L Z₁)/(Z_L + Z₁).
With Z_L=100Ω and Z₁=100Ω:  Z_T = (100·100)/(100+100) = 50 Ω.</pre>
          </div>

          <div class="boxed">
            <p style="margin:0; color:var(--text);">
              <b>Answer (c):</b> Z<sub>T</sub> = <b>50 Ω</b>.
            </p>
          </div>

          <h3>(d) Amplitudes of reflected and transmitted voltages for Z<sub>L</sub> = 100 Ω</h3>
          <p>
            Use the reflection coefficient on line 1:
          </p>

          <div class="eq" id="eq-d1">
            <div class="row">
              <div class="label">Compute Γ</div>
              <button class="copy" data-copy="Γ = (ZT − Z0)/(ZT + Z0). With ZT=50Ω and Z0=50Ω, Γ=0.">Copy</button>
            </div>
            <pre>Γ = (Z_T − Z₀)/(Z_T + Z₀) = (50 − 50)/(50 + 50) = 0.</pre>
          </div>

          <p>
            So there is <b>no reflected wave</b>: V<sub>r</sub>=0. The boundary (junction) voltage is:
          </p>

          <div class="eq" id="eq-d2">
            <div class="row">
              <div class="label">Junction voltage and transmitted boundary condition</div>
              <button class="copy" data-copy="V(0) = Vi(0)(1+Γ). With Γ=0, V(0)=Vi(0). Also Vt(0)=V(0).">Copy</button>
            </div>
            <pre>V(0) = Vᵢ(0) + Vᵣ(0) = Vᵢ(0)(1+Γ).
With Γ=0 ⇒ V(0)=Vᵢ(0).
Voltage continuity ⇒ V_t(0) = V(0) = Vᵢ(0).</pre>
          </div>

          <div class="boxed">
            <p style="margin:0; color:var(--text);">
              <b>Result for (d), relative to V<sub>i</sub>:</b><br/>
              V<sub>r</sub>/V<sub>i</sub> = <b>0</b>, &nbsp;&nbsp; V<sub>t</sub>/V<sub>i</sub> = <b>1</b>.
            </p>
          </div>

          <h3>(e) Peak currents given Î (upper wire, z&lt;0) = 10 A</h3>
          <p>
            For Z<sub>L</sub>=100Ω we found Γ=0, so on the left line there is only a forward wave. On a line of impedance Z,
            a forward wave satisfies (in peak amplitudes) <b>Î = V̂/Z</b>. Here Z=Z₀.
          </p>

          <div class="eq" id="eq-e1">
            <div class="row">
              <div class="label">Convert current to voltage amplitude on line 1</div>
              <button class="copy" data-copy="V̂i = Î Z0 = 10 A × 50 Ω = 500 V (peak).">Copy</button>
            </div>
            <pre>Given Î (upper wire, z&lt;0) = 10 A and Γ=0:
V̂ᵢ = Î Z₀ = (10 A)(50 Ω) = 500 V  (peak, between conductors).</pre>
          </div>

          <p>
            With Γ=0, the junction voltage peak equals the incident peak:
            V̂(0)=V̂ᵢ=500 V. Now compute each requested current (peak magnitudes).
          </p>

          <h3>(e-i) Maximum current in the lower wire for z&lt;0</h3>
          <p>
            In a two-conductor transmission line carrying a TEM wave, the currents in the two conductors are equal in magnitude and opposite in direction.
          </p>
          <div class="boxed">
            <p style="margin:0; color:var(--text);">
              <b>(i)</b> Lower wire (z&lt;0): magnitude <b>10 A</b>, opposite direction to the upper wire.
            </p>
          </div>

          <h3>(e-ii) Maximum current through the load Z<sub>L</sub></h3>
          <p>
            The load is across the conductors at z=0, so it sees the junction voltage V̂(0)=500 V. Thus
            Î<sub>L</sub> = V̂(0)/Z<sub>L</sub>.
          </p>

          <div class="eq" id="eq-e2">
            <div class="row">
              <div class="label">Load current</div>
              <button class="copy" data-copy="ÎL = V̂(0)/ZL = 500 V / 100 Ω = 5 A (peak).">Copy</button>
            </div>
            <pre>Î_L = V̂(0)/Z_L = 500 V / 100 Ω = 5 A  (peak).</pre>
          </div>

          <div class="boxed">
            <p style="margin:0; color:var(--text);"><b>(ii)</b> Load current: <b>5 A</b> (peak).</p>
          </div>

          <h3>(e-iii) Maximum current in the upper wire for z&gt;0 (line 2)</h3>
          <p>
            Line 2 carries only a forward wave (no reflection from its far end). The boundary transmitted voltage peak is V̂<sub>t</sub>=V̂(0)=500 V.
            On a line with characteristic impedance Z₁, the forward-wave current peak is Î₂ = V̂<sub>t</sub>/Z₁.
          </p>

          <div class="eq" id="eq-e3">
            <div class="row">
              <div class="label">Transmitted-line current</div>
              <button class="copy" data-copy="Î2 = V̂t/Z1 = 500 V / 100 Ω = 5 A (peak).">Copy</button>
            </div>
            <pre>Î₂ = V̂_t / Z₁ = 500 V / 100 Ω = 5 A  (peak).</pre>
          </div>

          <div class="boxed">
            <p style="margin:0; color:var(--text);"><b>(iii)</b> Upper wire (z&gt;0): <b>5 A</b> (peak).</p>
          </div>

          <h3>(e-iv) Maximum current in the lower wire for z&gt;0</h3>
          <p>
            Same equal-and-opposite rule for the two conductors:
          </p>
          <div class="boxed">
            <p style="margin:0; color:var(--text);">
              <b>(iv)</b> Lower wire (z&gt;0): magnitude <b>5 A</b>, opposite direction to the upper wire.
            </p>
          </div>

          <h3>Sanity checks (units, limiting cases, interpretation)</h3>
          <div class="grid2">
            <div class="callout good">
              <strong>Units:</strong> Γ is dimensionless. Z<sub>T</sub>, Z₀, Z₁ are in Ω. Current from V/Z gives amperes (A). All consistent.
            </div>
            <div class="callout good">
              <strong>Limiting cases:</strong><br/>
              If Z<sub>L</sub>=0 ⇒ Z<sub>T</sub>=0 ⇒ Γ=−1 (short), V(0)=0, no transmitted voltage. ✔<br/>
              If Z<sub>L</sub>→∞ ⇒ Z<sub>T</sub>→Z₁=100Ω ⇒ Γ=(100−50)/(100+50)=1/3. Reasonable partial reflection. ✔
            </div>
            <div class="callout good">
              <strong>Physical interpretation:</strong> For Z<sub>L</sub>=100Ω, the junction shunt is 100Ω in parallel with a 100Ω “seen” from line 2, giving 50Ω—exactly matching Z₀. Hence no reflection and power splits between the load and the right-going wave.
            </div>
            <div class="callout warn">
              <strong>Power split note (optional insight):</strong> With V̂(0)=500 V, the load and line 2 each draw 5 A peak; at the junction, the left line supplies 10 A peak—consistent with KCL (10 A = 5 A + 5 A).
            </div>
          </div>
        </article>
      </section>

      <section class="card" id="answers">
        <h2>Final Boxed Answers (All Parts)</h2>

        <div class="eq" id="eq-final">
          <div class="row">
            <div class="label">Copy the final answers (plain text)</div>
            <button class="copy" data-copy="(a) Vi(z,t)=V0 cos(ω t − k z), z<0, k=ω/v.
(b) ZL=0: Vr/Vi = −1, Vt/Vi = 0.
(c) ZL=100Ω: ZT = ZL ∥ Z1 = 50Ω.
(d) ZL=100Ω: Γ=0 → Vr/Vi = 0, Vt/Vi = 1.
(e) Given Îupper(z<0)=10 A and Γ=0: V̂=ÎZ0=500 V.
    (i) Îlower(z<0)=10 A (opposite direction).
    (ii) Îload=V̂/ZL=500/100=5 A.
    (iii) Îupper(z>0)=V̂/Z1=500/100=5 A.
    (iv) Îlower(z>0)=5 A (opposite direction).">Copy</button>
          </div>
          <pre>(a) Vᵢ(z,t)=V₀ cos(ωt − kz),   z&lt;0,   k=ω/v.

(b) Z_L=0:
    Z_T = Z_L ∥ Z₁ = 0  ⇒  Γ = −1
    V_r/V_i = −1,   V_t/V_i = 0.

(c) Z_L=100Ω:
    Z_T = Z_L ∥ Z₁ = (100·100)/(100+100) = 50Ω.

(d) Z_L=100Ω:
    Γ = (Z_T−Z₀)/(Z_T+Z₀) = 0
    V_r/V_i = 0,   V_t/V_i = 1.

(e) If max current in upper wire for z&lt;0 is 10 A (and Γ=0):
    V̂ = Î Z₀ = 10·50 = 500 V.
    (i)  Î lower wire (z&lt;0) = 10 A (opposite direction).
    (ii) Î load = 500/100 = 5 A.
    (iii)Î upper wire (z&gt;0) = 500/100 = 5 A.
    (iv) Î lower wire (z&gt;0) = 5 A (opposite direction).</pre>
        </div>
      </section>
    </main>
  </div>

  <footer>
    <p style="margin:0;">
      Built as a self-contained HTML article (no external libraries). Interactive plots are computed from the same formulas used in the solution: Z<sub>T</sub>=Z<sub>L</sub>∥Z₁ and Γ=(Z<sub>T</sub>−Z₀)/(Z<sub>T</sub>+Z₀).
    </p>
  </footer>

  <script>
    // ---------- Helpers ----------
    const clamp = (x, a, b) => Math.max(a, Math.min(b, x));
    const fmt = (x, d=2) => Number.isFinite(x) ? x.toFixed(d) : "∞";

    function parallel(a, b){
      // a||b, allowing for a=0 or very large
      if (a === 0 || b === 0) return 0;
      if (!Number.isFinite(a) && Number.isFinite(b)) return b;
      if (!Number.isFinite(b) && Number.isFinite(a)) return a;
      if (!Number.isFinite(a) && !Number.isFinite(b)) return Infinity;
      return (a*b)/(a+b);
    }

    function fitCanvasToCSS(canvas){
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      const w = Math.max(2, Math.floor(rect.width * dpr));
      const h = Math.max(2, Math.floor(rect.height * dpr));
      if (canvas.width !== w || canvas.height !== h){
        canvas.width = w;
        canvas.height = h;
      }
      return {ctx: canvas.getContext('2d'), dpr, w, h};
    }

    function clear(ctx, w, h){
      ctx.clearRect(0,0,w,h);
    }

    function drawPanelBg(ctx, w, h){
      // subtle background + vignette
      ctx.save();
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "rgba(255,255,255,0.03)");
      g.addColorStop(1, "rgba(0,0,0,0.18)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      const v = ctx.createRadialGradient(w*0.3,h*0.2, 0, w*0.5, h*0.5, Math.max(w,h)*0.7);
      v.addColorStop(0, "rgba(125,211,252,0.08)");
      v.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = v;
      ctx.fillRect(0,0,w,h);
      ctx.restore();
    }

    function drawText(ctx, text, x, y, size, color, align="left"){
      ctx.save();
      ctx.fillStyle = color;
      ctx.font = `${size}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial`;
      ctx.textAlign = align;
      ctx.textBaseline = "alphabetic";
      ctx.fillText(text, x, y);
      ctx.restore();
    }

    function niceTicks(min, max, count){
      // returns array of ticks
      const span = max - min;
      if (span <= 0) return [min];
      const rawStep = span / (count - 1);
      const pow10 = Math.pow(10, Math.floor(Math.log10(rawStep)));
      const norm = rawStep / pow10;
      let step;
      if (norm < 1.5) step = 1 * pow10;
      else if (norm < 3) step = 2 * pow10;
      else if (norm < 7) step = 5 * pow10;
      else step = 10 * pow10;

      const start = Math.ceil(min / step) * step;
      const ticks = [];
      for (let v = start; v <= max + 1e-10; v += step) ticks.push(v);
      return ticks;
    }

    function plotAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel, title){
      const {x, y, w, h, padL, padR, padT, padB} = box;
      const ix0 = x + padL, ix1 = x + w - padR;
      const iy0 = y + padT, iy1 = y + h - padB;

      // Title
      drawText(ctx, title, x + w/2, y + padT - 10, Math.max(12, Math.floor(box.scale*14)), "rgba(255,255,255,0.92)", "center");

      // grid + ticks
      ctx.save();
      ctx.strokeStyle = "rgba(255,255,255,0.12)";
      ctx.lineWidth = 1;

      const xTicks = niceTicks(xMin, xMax, 6);
      const yTicks = niceTicks(yMin, yMax, 6);

      // Gridlines
      ctx.beginPath();
      for (const xt of xTicks){
        const X = ix0 + (xt - xMin) / (xMax - xMin) * (ix1 - ix0);
        ctx.moveTo(X, iy0);
        ctx.lineTo(X, iy1);
      }
      for (const yt of yTicks){
        const Y = iy1 - (yt - yMin) / (yMax - yMin) * (iy1 - iy0);
        ctx.moveTo(ix0, Y);
        ctx.lineTo(ix1, Y);
      }
      ctx.stroke();

      // Axes
      ctx.strokeStyle = "rgba(255,255,255,0.30)";
      ctx.lineWidth = 1.25;
      ctx.beginPath();
      ctx.moveTo(ix0, iy1); ctx.lineTo(ix1, iy1); // x-axis
      ctx.moveTo(ix0, iy0); ctx.lineTo(ix0, iy1); // y-axis
      ctx.stroke();

      // Tick labels
      ctx.fillStyle = "rgba(255,255,255,0.70)";
      ctx.font = `${Math.max(11, Math.floor(box.scale*12))}px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"`;
      ctx.textBaseline = "top";
      ctx.textAlign = "center";
      for (const xt of xTicks){
        const X = ix0 + (xt - xMin) / (xMax - xMin) * (ix1 - ix0);
        ctx.fillText(String(Math.round(xt)), X, iy1 + 6);
      }
      ctx.textBaseline = "middle";
      ctx.textAlign = "right";
      for (const yt of yTicks){
        const Y = iy1 - (yt - yMin) / (yMax - yMin) * (iy1 - iy0);
        ctx.fillText(yt.toFixed(2), ix0 - 8, Y);
      }

      // Axis labels
      drawText(ctx, xLabel, x + w/2, y + h - 8, Math.max(12, Math.floor(box.scale*13)), "rgba(255,255,255,0.78)", "center");
      ctx.save();
      ctx.translate(x + 14, y + h/2);
      ctx.rotate(-Math.PI/2);
      drawText(ctx, yLabel, 0, 0, Math.max(12, Math.floor(box.scale*13)), "rgba(255,255,255,0.78)", "center");
      ctx.restore();

      ctx.restore();

      const mapX = (val) => ix0 + (val - xMin) / (xMax - xMin) * (ix1 - ix0);
      const mapY = (val) => iy1 - (val - yMin) / (yMax - yMin) * (iy1 - iy0);
      return {ix0, ix1, iy0, iy1, mapX, mapY};
    }

    function drawLegend(ctx, x, y, items){
      ctx.save();
      const pad = 10, lineH = 18;
      ctx.font = `12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial`;
      let maxW = 0;
      for (const it of items){
        const m = ctx.measureText(it.label).width;
        maxW = Math.max(maxW, m);
      }
      const boxW = pad*2 + 18 + 8 + maxW;
      const boxH = pad*2 + items.length*lineH;
      ctx.fillStyle = "rgba(0,0,0,0.35)";
      ctx.strokeStyle = "rgba(255,255,255,0.14)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.roundRect(x, y, boxW, boxH, 12);
      ctx.fill(); ctx.stroke();

      items.forEach((it, i) => {
        const yy = y + pad + i*lineH + 12;
        ctx.strokeStyle = it.color;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(x+pad, yy);
        ctx.lineTo(x+pad+18, yy);
        ctx.stroke();
        ctx.fillStyle = "rgba(255,255,255,0.85)";
        ctx.fillText(it.label, x+pad+18+8, yy+4);
      });
      ctx.restore();
    }

    // Polyfill for roundRect in older browsers
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        r = Math.min(r, w/2, h/2);
        this.beginPath();
        this.moveTo(x+r, y);
        this.arcTo(x+w, y, x+w, y+h, r);
        this.arcTo(x+w, y+h, x, y+h, r);
        this.arcTo(x, y+h, x, y, r);
        this.arcTo(x, y, x+w, y, r);
        this.closePath();
        return this;
      }
    }

    // ---------- Physics model ----------
    const params = {
      Z0: 50,
      Z1: 100,
      ZL: 100,
      ZT: 50,
      Gamma: 0,
      V0ratio: 1
    };

    function recompute(){
      params.ZT = parallel(params.ZL, params.Z1);
      params.Gamma = (params.ZT - params.Z0) / (params.ZT + params.Z0);
      params.V0ratio = 1 + params.Gamma; // V(0)/Vi
    }

    // ---------- Draw: setup diagram ----------
    function drawSetup(canvas){
      const {ctx, w, h} = fitCanvasToCSS(canvas);
      clear(ctx, w, h);
      drawPanelBg(ctx, w, h);

      const margin = 18 * (window.devicePixelRatio || 1);
      const x0 = margin, x1 = w - margin, yMid = h*0.5;

      // Geometry
      const railGap = h*0.22;
      const yTop = yMid - railGap/2;
      const yBot = yMid + railGap/2;
      const junctionX = w*0.58;

      ctx.save();
      ctx.lineCap = "round";
      ctx.lineJoin = "round";

      // Left line rails
      ctx.strokeStyle = "rgba(125,211,252,0.95)";
      ctx.lineWidth = Math.max(3, Math.floor(w*0.006));
      ctx.beginPath();
      ctx.moveTo(x0+70, yTop); ctx.lineTo(junctionX, yTop);
      ctx.moveTo(x0+70, yBot); ctx.lineTo(junctionX, yBot);
      ctx.stroke();

      // Right line rails
      ctx.strokeStyle = "rgba(167,139,250,0.95)";
      ctx.beginPath();
      ctx.moveTo(junctionX, yTop); ctx.lineTo(x1-20, yTop);
      ctx.moveTo(junctionX, yBot); ctx.lineTo(x1-20, yBot);
      ctx.stroke();

      // Junction marker
      ctx.strokeStyle = "rgba(255,255,255,0.75)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(junctionX, yTop-22); ctx.lineTo(junctionX, yBot+22);
      ctx.stroke();

      // Load element (shunt)
      const loadW = 22, loadH = railGap*0.55;
      const lx = junctionX - loadW/2, ly = yMid - loadH/2;
      ctx.fillStyle = "rgba(0,0,0,0.30)";
      ctx.strokeStyle = "rgba(255,255,255,0.65)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(lx, ly, loadW, loadH, 6);
      ctx.fill(); ctx.stroke();

      // connectors to rails
      ctx.strokeStyle = "rgba(255,255,255,0.65)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(junctionX, yTop); ctx.lineTo(junctionX, ly);
      ctx.moveTo(junctionX, ly+loadH); ctx.lineTo(junctionX, yBot);
      ctx.stroke();

      // Source symbol on left
      const sx = x0+32, sy = yMid;
      ctx.strokeStyle = "rgba(255,255,255,0.75)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(sx, sy, 20, 0, Math.PI*2);
      ctx.stroke();

      // sine inside
      ctx.strokeStyle = "rgba(125,211,252,0.95)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let i=0;i<=40;i++){
        const xx = sx - 14 + i*(28/40);
        const tt = i/40 * Math.PI*2;
        const yy = sy + Math.sin(tt)*6;
        if (i===0) ctx.moveTo(xx, yy);
        else ctx.lineTo(xx, yy);
      }
      ctx.stroke();

      // Source connects to rails
      ctx.strokeStyle = "rgba(255,255,255,0.65)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(sx+20, sy-12); ctx.lineTo(x0+70, yTop);
      ctx.moveTo(sx+20, sy+12); ctx.lineTo(x0+70, yBot);
      ctx.stroke();

      // Incident arrow
      ctx.strokeStyle = "rgba(125,211,252,0.95)";
      ctx.lineWidth = 3;
      const ax0 = w*0.25, ax1 = w*0.43, ay = yTop - 30;
      ctx.beginPath();
      ctx.moveTo(ax0, ay); ctx.lineTo(ax1, ay);
      ctx.stroke();
      ctx.fillStyle = "rgba(125,211,252,0.95)";
      ctx.beginPath();
      ctx.moveTo(ax1, ay);
      ctx.lineTo(ax1-14, ay-8);
      ctx.lineTo(ax1-14, ay+8);
      ctx.closePath();
      ctx.fill();

      // Reflected arrow magnitude from Gamma
      const g = params.Gamma;
      const mag = Math.abs(g);
      const ry = yBot + 34;
      ctx.strokeStyle = "rgba(251,113,133,0.9)";
      ctx.lineWidth = 3;
      const rx0 = w*0.43, rx1 = w*0.25;
      ctx.globalAlpha = 0.35 + 0.65*clamp(mag,0,1);
      ctx.beginPath();
      ctx.moveTo(rx0, ry); ctx.lineTo(rx1, ry);
      ctx.stroke();
      ctx.fillStyle = "rgba(251,113,133,0.9)";
      ctx.beginPath();
      ctx.moveTo(rx1, ry);
      ctx.lineTo(rx1+14, ry-8);
      ctx.lineTo(rx1+14, ry+8);
      ctx.closePath();
      ctx.fill();
      ctx.globalAlpha = 1;

      // Labels
      const fs = Math.max(12, Math.floor(h*0.05));
      drawText(ctx, "Z₀ = 50 Ω (left line)", w*0.26, yMid-10, fs, "rgba(255,255,255,0.88)", "center");
      drawText(ctx, "Z₁ = 100 Ω (right line)", w*0.82, yMid-10, fs, "rgba(255,255,255,0.88)", "center");
      drawText(ctx, "z = 0", junctionX, yBot+20, Math.max(11, fs-1), "rgba(255,255,255,0.72)", "center");
      drawText(ctx, `ZL = ${params.ZL} Ω`, junctionX+48, yMid+6, Math.max(11, fs-1), "rgba(255,255,255,0.88)", "left");

      drawText(ctx, "incident Vᵢ →", (ax0+ax1)/2, ay-6, Math.max(11, fs-1), "rgba(255,255,255,0.78)", "center");
      drawText(ctx, `reflected Vᵣ ← (|Γ|=${fmt(mag,3)})`, (rx0+rx1)/2, ry-6, Math.max(11, fs-1), "rgba(255,255,255,0.78)", "center");

      ctx.restore();
    }

    // ---------- Plots ----------
    function drawMainPlot(canvas){
      const {ctx, w, h} = fitCanvasToCSS(canvas);
      clear(ctx, w, h);
      drawPanelBg(ctx, w, h);

      const box = {
        x: 0, y: 0, w, h,
        padL: 64*(window.devicePixelRatio||1),
        padR: 18*(window.devicePixelRatio||1),
        padT: 40*(window.devicePixelRatio||1),
        padB: 50*(window.devicePixelRatio||1),
        scale: (window.devicePixelRatio||1)
      };

      const xMin=0, xMax=300;
      const yMin=0, yMax=1;

      const ax = plotAxes(ctx, box, xMin,xMax, yMin,yMax, "ZL (Ω)", "|Γ| (dimensionless)", "Reflection Magnitude vs Load");

      // Curve
      ctx.save();
      ctx.strokeStyle = "rgba(125,211,252,0.95)";
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      const N=301;
      for (let i=0;i<N;i++){
        const zl = xMin + (xMax-xMin)*i/(N-1);
        const zt = parallel(zl, params.Z1);
        const g = (zt - params.Z0)/(zt + params.Z0);
        const yy = Math.abs(g);
        const X = ax.mapX(zl);
        const Y = ax.mapY(yy);
        if (i===0) ctx.moveTo(X,Y);
        else ctx.lineTo(X,Y);
      }
      ctx.stroke();

      // Current point marker
      const ztC = parallel(params.ZL, params.Z1);
      const gC = (ztC - params.Z0)/(ztC + params.Z0);
      const Xc = ax.mapX(params.ZL);
      const Yc = ax.mapY(Math.abs(gC));
      ctx.fillStyle = "rgba(251,191,36,0.95)";
      ctx.strokeStyle = "rgba(0,0,0,0.55)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(Xc, Yc, 6*(window.devicePixelRatio||1), 0, Math.PI*2);
      ctx.fill();
      ctx.stroke();

      drawLegend(ctx, box.padL + 10, box.padT + 10, [
        {label:"|Γ|(ZL)", color:"rgba(125,211,252,0.95)"},
        {label:"current ZL", color:"rgba(251,191,36,0.95)"}
      ]);

      ctx.restore();
    }

    function drawSecondaryPlot(canvas){
      const {ctx, w, h} = fitCanvasToCSS(canvas);
      clear(ctx, w, h);
      drawPanelBg(ctx, w, h);

      const box = {
        x: 0, y: 0, w, h,
        padL: 64*(window.devicePixelRatio||1),
        padR: 18*(window.devicePixelRatio||1),
        padT: 40*(window.devicePixelRatio||1),
        padB: 50*(window.devicePixelRatio||1),
        scale: (window.devicePixelRatio||1)
      };

      const xMin=0, xMax=300;
      // V(0)/Vi can range from 0 (short) up to 2 (open), but with ZT=ZL||Z1 and Z1 finite, it won't reach 2.
      const yMin=0, yMax=2;

      const ax = plotAxes(ctx, box, xMin,xMax, yMin,yMax, "ZL (Ω)", "V(0)/Vi = 1+Γ", "Junction Voltage Ratio vs Load");

      // Curve for 1+Gamma
      ctx.save();
      ctx.strokeStyle = "rgba(167,139,250,0.95)";
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      const N=301;
      for (let i=0;i<N;i++){
        const zl = xMin + (xMax-xMin)*i/(N-1);
        const zt = parallel(zl, params.Z1);
        const g = (zt - params.Z0)/(zt + params.Z0);
        const yy = 1 + g;
        const X = ax.mapX(zl);
        const Y = ax.mapY(yy);
        if (i===0) ctx.moveTo(X,Y);
        else ctx.lineTo(X,Y);
      }
      ctx.stroke();

      // Marker at current ZL
      const ztC = parallel(params.ZL, params.Z1);
      const gC = (ztC - params.Z0)/(ztC + params.Z0);
      const ratio = 1 + gC;
      const Xc = ax.mapX(params.ZL);
      const Yc = ax.mapY(ratio);
      ctx.fillStyle = "rgba(52,211,153,0.95)";
      ctx.strokeStyle = "rgba(0,0,0,0.55)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(Xc, Yc, 6*(window.devicePixelRatio||1), 0, Math.PI*2);
      ctx.fill(); ctx.stroke();

      // Also show a horizontal line at ratio=1 (match)
      ctx.strokeStyle = "rgba(255,255,255,0.22)";
      ctx.setLineDash([8,6]);
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(ax.ix0, ax.mapY(1));
      ctx.lineTo(ax.ix1, ax.mapY(1));
      ctx.stroke();
      ctx.setLineDash([]);

      drawLegend(ctx, box.padL + 10, box.padT + 10, [
        {label:"V(0)/Vi", color:"rgba(167,139,250,0.95)"},
        {label:"current ZL", color:"rgba(52,211,153,0.95)"},
        {label:"ratio = 1 (matched)", color:"rgba(255,255,255,0.55)"}
      ]);

      ctx.restore();
    }

    // ---------- UI: copy buttons ----------
    function setupCopyButtons(){
      document.querySelectorAll("button.copy").forEach(btn => {
        btn.addEventListener("click", async () => {
          const text = btn.getAttribute("data-copy") || "";
          try{
            await navigator.clipboard.writeText(text);
            const old = btn.textContent;
            btn.textContent = "Copied ✓";
            btn.style.borderColor = "rgba(52,211,153,0.45)";
            btn.style.background = "rgba(52,211,153,0.10)";
            setTimeout(()=>{
              btn.textContent = old;
              btn.style.borderColor = "rgba(255,255,255,0.18)";
              btn.style.background = "rgba(255,255,255,0.06)";
            }, 900);
          }catch(e){
            // fallback
            const ta = document.createElement("textarea");
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            document.body.removeChild(ta);
            btn.textContent = "Copied ✓";
            setTimeout(()=>btn.textContent="Copy", 900);
          }
        });
      });
    }

    // ---------- Update readouts ----------
    function updateReadouts(){
      document.getElementById("zlRead").textContent = `${params.ZL} Ω`;
      document.getElementById("ztRead").textContent = `${fmt(params.ZT, 2)} Ω`;
      document.getElementById("gRead").textContent = `${fmt(params.Gamma, 3)}`;
      document.getElementById("v0ratioRead").textContent = `${fmt(params.V0ratio, 3)}`;
      document.getElementById("i2factorRead").textContent = `1/${params.Z1} Ω⁻¹`;
    }

    // ---------- Main render ----------
    function renderAll(){
      recompute();
      updateReadouts();
      drawSetup(document.getElementById("setupCanvas"));
      drawMainPlot(document.getElementById("plotMain"));
      drawSecondaryPlot(document.getElementById("plotSecondary"));
    }

    // ---------- Init ----------
    (function init(){
      setupCopyButtons();
      const zlRange = document.getElementById("zlRange");
      zlRange.addEventListener("input", () => {
        params.ZL = Number(zlRange.value);
        renderAll();
      });

      // initial compute
      params.ZL = Number(zlRange.value);
      renderAll();

      // responsive redraw
      let raf = null;
      window.addEventListener("resize", () => {
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(renderAll);
      });
    })();
  </script>
</body>
</html>
