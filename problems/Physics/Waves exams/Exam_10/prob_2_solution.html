<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dispersive String (Piano String) — Phase/Group Velocity, Time Evolution, and Revival</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.09);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --faint: rgba(255,255,255,0.55);
      --line: rgba(255,255,255,0.14);
      --accent: #9ee7ff;
      --accent2:#b7ffa4;
      --warn:#ffd27a;
      --bad:#ff8aa5;
      --good:#a7ffcf;

      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(158,231,255,0.16), transparent 55%),
        radial-gradient(900px 700px at 85% 18%, rgba(183,255,164,0.14), transparent 60%),
        radial-gradient(1100px 900px at 40% 95%, rgba(255,210,122,0.09), transparent 55%),
        linear-gradient(180deg, #070a14, #0a0e1b 35%, #090d18);
      line-height:1.55;
    }

    a{ color: var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    header{
      padding: 28px 18px 18px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .hero{
      display:grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 16px;
      align-items:stretch;
    }

    .titleCard{
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 18px 18px 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
      overflow:hidden;
      position:relative;
    }

    .titleCard::before{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(600px 240px at 10% 0%, rgba(158,231,255,0.20), transparent 60%),
                  radial-gradient(700px 260px at 90% 0%, rgba(183,255,164,0.15), transparent 62%);
      pointer-events:none;
      opacity:0.9;
    }

    .titleCard > *{ position:relative; }

    h1{
      margin: 0 0 6px;
      font-size: clamp(1.35rem, 2.4vw, 2.1rem);
      letter-spacing: 0.2px;
    }
    .subtitle{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 0.98rem;
    }

    .quickSummary{
      margin-top: 12px;
      display:grid;
      gap:10px;
    }

    .bullets{
      margin:0;
      padding-left: 18px;
      color: var(--muted);
    }
    .bullets li{ margin: 6px 0; }

    .controlCard{
      background: linear-gradient(180deg, rgba(255,255,255,0.085), rgba(255,255,255,0.045));
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 14px 14px 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.28);
    }

    .controlsHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .controlsHeader h2{
      font-size: 1rem;
      margin:0;
      letter-spacing:0.2px;
    }
    .pill{
      font-family: var(--mono);
      font-size: 0.78rem;
      padding: 4px 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      color: var(--muted);
      background: rgba(0,0,0,0.22);
      white-space:nowrap;
    }

    .ctrl{
      border-top: 1px solid var(--line);
      padding-top: 10px;
      margin-top: 10px;
      display:grid;
      gap: 10px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
    }

    label{
      font-size: 0.9rem;
      color: var(--muted);
      display:block;
      margin-bottom: 6px;
    }

    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }

    .val{
      font-family: var(--mono);
      color: var(--text);
      font-size: 0.9rem;
      padding: 6px 8px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: rgba(0,0,0,0.18);
      min-width: 120px;
      text-align:right;
    }

    main{
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 18px 60px;
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 16px;
      align-items:start;
    }

    aside{
      position: sticky;
      top: 12px;
      align-self:start;
      background: rgba(0,0,0,0.22);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px 12px 10px;
      backdrop-filter: blur(8px);
    }

    aside h3{
      margin: 0 0 8px;
      font-size: 0.95rem;
      color: var(--text);
    }

    .toc{
      list-style:none;
      margin:0;
      padding:0;
      display:grid;
      gap: 8px;
    }
    .toc a{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid transparent;
      color: var(--muted);
      background: rgba(255,255,255,0.03);
      transition: transform 200ms ease, background 200ms ease, border-color 200ms ease;
    }
    .toc a:hover{
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.14);
      transform: translateY(-1px);
      text-decoration:none;
    }
    .toc small{
      font-family: var(--mono);
      color: var(--faint);
    }

    article{
      min-width: 0;
      display:grid;
      gap: 16px;
    }

    section{
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 16px 16px 14px;
      box-shadow: 0 10px 36px rgba(0,0,0,0.22);
      position:relative;
      overflow:hidden;
    }

    section::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background: radial-gradient(700px 280px at 0% 0%, rgba(158,231,255,0.10), transparent 60%),
                  radial-gradient(700px 280px at 100% 0%, rgba(183,255,164,0.08), transparent 60%);
      opacity:0.7;
    }

    section > *{ position:relative; }

    h2{
      margin: 0 0 8px;
      font-size: 1.2rem;
      letter-spacing:0.2px;
    }
    h4{
      margin: 14px 0 6px;
      font-size: 1rem;
      color: var(--text);
    }

    p{ margin: 8px 0; color: var(--muted); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .hero{ grid-template-columns:1fr; }
      main{ grid-template-columns:1fr; }
      aside{ position:relative; top:auto; }
      .grid2{ grid-template-columns:1fr; }
    }

    .card{
      background: rgba(0,0,0,0.18);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px 12px 10px;
    }

    .callouts{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .callouts{ grid-template-columns:1fr; }
    }

    .callout{
      border-radius: 16px;
      border: 1px solid var(--line);
      padding: 12px 12px 10px;
      background: rgba(0,0,0,0.18);
      position:relative;
      overflow:hidden;
    }
    .callout::before{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(500px 160px at 20% 0%, rgba(158,231,255,0.16), transparent 60%),
                  radial-gradient(500px 160px at 80% 0%, rgba(183,255,164,0.10), transparent 65%);
      opacity:0.75;
      pointer-events:none;
    }
    .callout > *{ position:relative; }
    .callout b{ color: var(--text); }

    .eqBlock{
      display:grid;
      gap: 8px;
      margin-top: 10px;
    }

    .eq{
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 14px;
      padding: 10px 10px 10px;
      overflow:auto;
      position:relative;
    }
    .eq pre{
      margin:0;
      font-family: var(--mono);
      color: rgba(255,255,255,0.88);
      font-size: 0.92rem;
      white-space: pre-wrap;
      line-height: 1.45;
    }

    .eqTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .btn{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 0.85rem;
      transition: transform 160ms ease, background 160ms ease, border-color 160ms ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .btn:hover{
      background: rgba(255,255,255,0.10);
      border-color: rgba(255,255,255,0.26);
      transform: translateY(-1px);
    }
    .btn:active{ transform: translateY(0px) scale(0.98); }

    .toast{
      position: fixed;
      inset: auto 14px 14px auto;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 14px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 0.9rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      opacity:0;
      transform: translateY(8px);
      transition: opacity 220ms ease, transform 220ms ease;
      pointer-events:none;
      backdrop-filter: blur(8px);
      z-index: 999;
    }
    .toast.show{
      opacity:1;
      transform: translateY(0px);
    }

    figure{
      margin:0;
      display:grid;
      gap: 8px;
    }
    figcaption{
      color: var(--faint);
      font-size: 0.86rem;
    }
    .canvasWrap{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      overflow:hidden;
    }
    canvas{
      width:100%;
      height: 320px;
      display:block;
    }
    .tight canvas{ height: 280px; }
    .short canvas{ height: 260px; }

    .finalBox{
      border: 1px solid rgba(158,231,255,0.35);
      background: linear-gradient(180deg, rgba(158,231,255,0.10), rgba(0,0,0,0.20));
      border-radius: 18px;
      padding: 14px 14px 12px;
      margin-top: 12px;
      position:relative;
      overflow:hidden;
    }
    .finalBox::before{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(700px 220px at 10% 0%, rgba(158,231,255,0.22), transparent 60%),
                  radial-gradient(700px 220px at 90% 0%, rgba(183,255,164,0.14), transparent 60%);
      opacity:0.9;
      pointer-events:none;
    }
    .finalBox > *{ position:relative; }

    .finalTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 8px;
    }
    .finalTitle h3{
      margin:0;
      font-size: 1.05rem;
    }

    .kpiRow{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .kpiRow{ grid-template-columns:1fr; }
    }
    .kpi{
      background: rgba(0,0,0,0.20);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 16px;
      padding: 10px 10px 9px;
    }
    .kpi .k{
      font-family: var(--mono);
      color: var(--faint);
      font-size: 0.78rem;
    }
    .kpi .v{
      font-family: var(--mono);
      color: var(--text);
      font-size: 1.05rem;
      margin-top: 4px;
    }

    footer{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 18px 28px;
      color: var(--faint);
      font-size: 0.88rem;
    }

    /* Subtle reveal animation */
    @media (prefers-reduced-motion: no-preference){
      section{
        animation: rise 520ms ease both;
      }
      @keyframes rise{
        from{ opacity:0; transform: translateY(6px); }
        to{ opacity:1; transform: translateY(0); }
      }
    }

    /* Print-friendly */
    @media print{
      body{ background:#fff; color:#000; }
      header, main, footer{ max-width: none; }
      aside{ display:none; }
      section, .titleCard, .controlCard{ box-shadow:none; background:#fff; border: 1px solid #ccc; }
      .canvasWrap{ border: 1px solid #bbb; }
      .btn{ display:none; }
      .pill{ border-color:#bbb; color:#444; background:#f3f3f3; }
      .eq{ background:#f7f7f7; border-color:#bbb; }
      .finalBox{ border-color:#66a; background:#f7fbff; }
    }
  </style>
</head>
<body>
<header>
  <div class="hero">
    <div class="titleCard">
      <h1>Problem 2 — Dispersive String (Realistic Piano String)</h1>
      <p class="subtitle">
        Dispersion relation: <span style="font-family:var(--mono);">ω(k) = k · √( T/μ + α k² )</span>,
        string clamped at <span style="font-family:var(--mono);">x=0</span> and <span style="font-family:var(--mono);">x=L</span>,
        with an initial multi-mode shape and zero initial velocity.
      </p>

      <div class="quickSummary card" id="quick-summary">
        <h2 style="margin:0 0 8px;font-size:1.05rem;">Quick Summary</h2>
        <ul class="bullets">
          <li>Phase velocity: <span style="font-family:var(--mono);">v_p = ω/k = √(T/μ + α k²)</span>.</li>
          <li>Group velocity: <span style="font-family:var(--mono);">v_g = dω/dk = (T/μ + 2α k²)/√(T/μ + α k²)</span>.</li>
          <li>With clamps, allowed modes are <span style="font-family:var(--mono);">k_n = nπ/L</span> and <span style="font-family:var(--mono);">ω_n = k_n √(T/μ + α k_n²)</span>.</li>
          <li>Zero initial velocity ⇒ time dependence is purely <span style="font-family:var(--mono);">cos(ω_n t)</span> for each mode.</li>
          <li>Exact “same shape” revival requires all <span style="font-family:var(--mono);">cos(ω_n t)=1</span> simultaneously; for α&gt;0 this is generally not possible (frequencies are typically incommensurate).</li>
        </ul>
      </div>
    </div>

    <div class="controlCard" aria-label="Interactive controls">
      <div class="controlsHeader">
        <h2>Interactive Demo</h2>
        <span class="pill">Canvas plots • no libraries</span>
      </div>

      <div class="ctrl">
        <div>
          <label for="alphaRange">Stiffness parameter α (example value, units so that αk² has units of m²/s²)</label>
          <div class="row">
            <input id="alphaRange" type="range" min="0" max="50" step="0.1" value="20" />
            <div class="val" id="alphaVal">20.0</div>
          </div>
          <p style="margin:6px 0 0;color:var(--faint);font-size:0.84rem;">
            Increasing α increases dispersion (higher modes shift upward).
          </p>
        </div>

        <div>
          <label for="timeRange">Time t (s)</label>
          <div class="row">
            <input id="timeRange" type="range" min="0" max="0.5" step="0.001" value="0.0" />
            <div class="val" id="timeVal">0.000</div>
          </div>
          <div class="row" style="margin-top:8px;">
            <button class="btn" id="playBtn" type="button" aria-label="Play or pause animation">
              ▶︎ Play
            </button>
            <div class="pill" id="freqPill">Using example values: L=1 m, μ=0.01 kg/m, T=10 N</div>
          </div>
        </div>
      </div>

      <div class="kpiRow" aria-label="Key computed values">
        <div class="kpi">
          <div class="k">Non-dispersive speed</div>
          <div class="v" id="cVal">—</div>
        </div>
        <div class="kpi">
          <div class="k">ω₁ (rad/s)</div>
          <div class="v" id="w1Val">—</div>
        </div>
        <div class="kpi">
          <div class="k">Revival error E(t)</div>
          <div class="v" id="errVal">—</div>
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <aside aria-label="Table of contents">
    <h3>On this page</h3>
    <ul class="toc">
      <li><a href="#part1">PART 1 — Problem Analysis <small>#1</small></a></li>
      <li><a href="#part2">PART 2 — Strategy &amp; Tips <small>#2</small></a></li>
      <li><a href="#part3">PART 3 — Full Solution <small>#3</small></a></li>
      <li><a href="#visuals">Interactive Visuals <small>Canvas</small></a></li>
      <li><a href="#final">Final Boxed Results <small>Copy</small></a></li>
    </ul>
  </aside>

  <article>
    <section id="part1">
      <h2>PART 1 — Problem Analysis (no solving yet)</h2>

      <h4>1) Restate the problem (in plain words)</h4>
      <p>
        A stretched string of length <span style="font-family:var(--mono);">L</span> is clamped at both ends, so it must have
        <span style="font-family:var(--mono);">y(0,t)=0</span> and <span style="font-family:var(--mono);">y(L,t)=0</span>.
        Unlike an ideal string, it is <b>dispersive</b>: waves with different wavenumber <span style="font-family:var(--mono);">k</span>
        have different phase speeds because the frequency satisfies
        <span style="font-family:var(--mono);">ω = k √(T/μ + α k²)</span>.
        At time <span style="font-family:var(--mono);">t=0</span>, the string is released from rest with a given initial shape:
        a sum of the first three sine modes with amplitudes 1, 4, and 9.
      </p>

      <h4>2) Given quantities</h4>
      <ul class="bullets">
        <li>String length: <span style="font-family:var(--mono);">L</span></li>
        <li>Tension: <span style="font-family:var(--mono);">T</span></li>
        <li>Linear mass density: <span style="font-family:var(--mono);">μ</span></li>
        <li>Dispersion/stiffness constant: <span style="font-family:var(--mono);">α &gt; 0</span></li>
        <li>Dispersion relation: <span style="font-family:var(--mono);">ω(k)=k √(T/μ + α k²)</span></li>
        <li>Boundary conditions: <span style="font-family:var(--mono);">y(0,t)=y(L,t)=0</span> (clamped ends)</li>
        <li>Initial displacement:
          <span style="font-family:var(--mono);">
            y(x,0)=sin(πx/L)+4 sin(2πx/L)+9 sin(3πx/L)
          </span>
        </li>
        <li>Initial velocity: <span style="font-family:var(--mono);">∂y/∂t(x,0)=0</span> (released from rest)</li>
      </ul>

      <h4>3) Unknowns</h4>
      <ul class="bullets">
        <li>(a) Phase velocity <span style="font-family:var(--mono);">v_p(k)</span></li>
        <li>(b) Group velocity <span style="font-family:var(--mono);">v_g(k)</span></li>
        <li>(c) Displacement <span style="font-family:var(--mono);">y(x,t)</span> for all times</li>
        <li>(d) Whether there exists a first time <span style="font-family:var(--mono);">t&gt;0</span> with the exact same shape as at <span style="font-family:var(--mono);">t=0</span></li>
      </ul>

      <h4>4) Relevant principles &amp; why they apply</h4>
      <div class="callouts">
        <div class="callout">
          <b>Wave dispersion concepts</b>
          <p>
            Since <span style="font-family:var(--mono);">ω</span> depends nonlinearly on <span style="font-family:var(--mono);">k</span>,
            the phase velocity <span style="font-family:var(--mono);">v_p=ω/k</span> and group velocity <span style="font-family:var(--mono);">v_g=dω/dk</span>
            differ and depend on <span style="font-family:var(--mono);">k</span>.
          </p>
        </div>
        <div class="callout">
          <b>Normal modes with fixed ends</b>
          <p>
            Clamped endpoints force spatial eigenfunctions to be sine waves:
            <span style="font-family:var(--mono);">sin(nπx/L)</span>. Each allowed mode has wavenumber
            <span style="font-family:var(--mono);">k_n=nπ/L</span>.
          </p>
        </div>
        <div class="callout">
          <b>Superposition + initial conditions</b>
          <p>
            The motion is a sum of independent modes. With zero initial velocity,
            each mode oscillates as <span style="font-family:var(--mono);">cos(ω_n t)</span> rather than <span style="font-family:var(--mono);">sin(ω_n t)</span>.
          </p>
        </div>
      </div>

      <h4>5) Candidate approaches (2–3) &amp; comparison</h4>
      <ul class="bullets">
        <li>
          <b>Mode expansion (standing waves)</b>:
          Expand <span style="font-family:var(--mono);">y(x,t)</span> in the eigenmodes <span style="font-family:var(--mono);">sin(nπx/L)</span>.
          Best for fixed boundaries and the given initial sine-series.
        </li>
        <li>
          <b>Traveling-wave packets</b>:
          Use <span style="font-family:var(--mono);">v_p</span> and <span style="font-family:var(--mono);">v_g</span> to describe envelope motion.
          Great for localized pulses, but here we’re explicitly given discrete modes.
        </li>
        <li>
          <b>Energy/Hamiltonian perspective</b>:
          Useful to reason about reversibility and recurrence, but still requires modal frequencies to decide exact revivals.
        </li>
      </ul>

      <h4>6) Best approach &amp; why</h4>
      <p>
        The <b>mode-expansion approach</b> is optimal because the boundary conditions demand sine eigenmodes and
        the initial displacement is already a sum of the first three such modes. That makes (c) essentially
        “attach the correct time factors” and makes (d) a question about commensurability of the three modal frequencies.
      </p>
    </section>

    <section id="part2">
      <h2>PART 2 — Strategy &amp; Tips (roadmap only)</h2>

      <h4>Minimal step-by-step plan (5–10 steps)</h4>
      <ol class="bullets">
        <li>
          <b>Goal:</b> Extract phase velocity. <br/>
          <b>Tool:</b> Definition <span style="font-family:var(--mono);">v_p = ω/k</span>.
        </li>
        <li>
          <b>Goal:</b> Extract group velocity. <br/>
          <b>Tool:</b> Definition <span style="font-family:var(--mono);">v_g = dω/dk</span>.
        </li>
        <li>
          <b>Goal:</b> Identify allowed <span style="font-family:var(--mono);">k</span> values for a clamped string. <br/>
          <b>Tool:</b> Boundary conditions ⇒ <span style="font-family:var(--mono);">k_n=nπ/L</span>.
        </li>
        <li>
          <b>Goal:</b> Convert dispersion relation into discrete modal frequencies. <br/>
          <b>Tool:</b> Substitute <span style="font-family:var(--mono);">k=k_n</span> into <span style="font-family:var(--mono);">ω(k)</span>.
        </li>
        <li>
          <b>Goal:</b> Build general modal superposition. <br/>
          <b>Tool:</b> <span style="font-family:var(--mono);">y(x,t)=Σ [A_n cos(ω_n t)+B_n sin(ω_n t)] sin(k_n x)</span>.
        </li>
        <li>
          <b>Goal:</b> Apply initial displacement to set <span style="font-family:var(--mono);">A_n</span>. <br/>
          <b>Tool:</b> Match coefficients using orthogonality (here coefficients are already given).
        </li>
        <li>
          <b>Goal:</b> Apply zero initial velocity to set <span style="font-family:var(--mono);">B_n=0</span>. <br/>
          <b>Tool:</b> Differentiate in time and evaluate at <span style="font-family:var(--mono);">t=0</span>.
        </li>
        <li>
          <b>Goal:</b> Decide whether an exact “shape revival” occurs. <br/>
          <b>Tool:</b> Need all phases <span style="font-family:var(--mono);">ω_n t</span> to be integer multiples of <span style="font-family:var(--mono);">2π</span> simultaneously ⇒ check frequency ratios.
        </li>
      </ol>

      <h4>Common mistakes &amp; quick tips</h4>
      <ul class="bullets">
        <li><b>Mixing up phase and group velocity:</b> <span style="font-family:var(--mono);">v_p=ω/k</span> vs <span style="font-family:var(--mono);">v_g=dω/dk</span>.</li>
        <li><b>For fixed ends:</b> use <span style="font-family:var(--mono);">sin(nπx/L)</span>, not cosines (cosine doesn’t satisfy both endpoints).</li>
        <li><b>Zero initial velocity:</b> the sine-in-time coefficients vanish: <span style="font-family:var(--mono);">B_n=0</span>.</li>
        <li><b>Revival condition is strict:</b> “same shape” means the entire function matches, not just energy or amplitude statistics.</li>
      </ul>
      <p><b>As requested:</b> No algebra is shown here beyond naming the tools/definitions.</p>
    </section>

    <section id="part3">
      <h2>PART 3 — Full Solution</h2>

      <h4>Physical intuition (before math)</h4>
      <p>
        For an ideal string, every mode’s frequency is proportional to its mode number (<span style="font-family:var(--mono);">ω_n ∝ n</span>),
        so all modes “line up” again after a common period and the whole shape repeats perfectly.
        A realistic piano string is stiffer: higher-curvature shapes (higher <span style="font-family:var(--mono);">k</span>) feel extra restoring force,
        so their frequencies rise faster than linearly. That breaks the perfect synchrony—modes drift in phase relative to each other,
        and exact revivals generally disappear.
      </p>

      <h4>(a) Phase velocity</h4>
      <div class="eqBlock">
        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">Key equation</div>
            <button class="btn" type="button" data-copy="#eqPhase">⧉ Copy</button>
          </div>
          <pre id="eqPhase">Given ω(k) = k √( T/μ + α k² )

Phase velocity:
v_p(k) = ω/k = √( T/μ + α k² )</pre>
        </div>
      </div>
      <p>
        This is the speed at which a single-frequency sinusoid’s phase fronts move. Because of the <span style="font-family:var(--mono);">α k²</span> term,
        higher-wavenumber components have larger <span style="font-family:var(--mono);">v_p</span>.
      </p>

      <h4>(b) Group velocity</h4>
      <p>
        Start from
        <span style="font-family:var(--mono);">ω(k)=k (T/μ + α k²)^{1/2}</span>.
        Differentiate with respect to <span style="font-family:var(--mono);">k</span>:
      </p>

      <div class="eqBlock">
        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">Step-by-step derivative</div>
            <button class="btn" type="button" data-copy="#eqGroup">⧉ Copy</button>
          </div>
          <pre id="eqGroup">ω(k) = k (T/μ + α k²)^(1/2)

dω/dk = (T/μ + α k²)^(1/2) + k * (1/2)(T/μ + α k²)^(-1/2) * (2αk)
      = √(T/μ + α k²) + (α k²)/√(T/μ + α k²)
      = (T/μ + 2α k²) / √(T/μ + α k²)

Group velocity:
v_g(k) = dω/dk = (T/μ + 2α k²) / √(T/μ + α k²)</pre>
        </div>
      </div>

      <p>
        The group velocity is the speed of a narrow wavepacket’s envelope. In dispersive media,
        <span style="font-family:var(--mono);">v_g</span> and <span style="font-family:var(--mono);">v_p</span> differ and depend on <span style="font-family:var(--mono);">k</span>.
      </p>

      <h4>(c) Displacement y(x,t) for t &gt; 0 (released from rest)</h4>
      <p>
        With fixed ends, the spatial eigenfunctions are:
        <span style="font-family:var(--mono);">sin(nπx/L)</span>.
        Therefore the allowed wavenumbers are
        <span style="font-family:var(--mono);">k_n = nπ/L</span>, for integers <span style="font-family:var(--mono);">n=1,2,3,…</span>.
        The dispersion relation gives each mode’s angular frequency:
      </p>

      <div class="eqBlock">
        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">Discrete modal frequencies</div>
            <button class="btn" type="button" data-copy="#eqWn">⧉ Copy</button>
          </div>
          <pre id="eqWn">Allowed wavenumbers (clamped ends):
k_n = nπ/L

Modal frequencies from ω(k):
ω_n = ω(k_n) = k_n √(T/μ + α k_n²)
    = (nπ/L) √(T/μ + α (nπ/L)²)</pre>
        </div>
      </div>

      <p>
        The most general superposition consistent with fixed ends is
      </p>

      <div class="eqBlock">
        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">General normal-mode expansion</div>
            <button class="btn" type="button" data-copy="#eqGeneral">⧉ Copy</button>
          </div>
          <pre id="eqGeneral">y(x,t) = Σ_{n=1}^∞ [ A_n cos(ω_n t) + B_n sin(ω_n t) ] sin(k_n x)</pre>
        </div>
      </div>

      <p>
        Apply initial conditions:
      </p>
      <ul class="bullets">
        <li>
          Initial displacement at <span style="font-family:var(--mono);">t=0</span> gives
          <span style="font-family:var(--mono);">y(x,0)=Σ A_n sin(k_n x)</span>, because <span style="font-family:var(--mono);">cos(0)=1</span> and <span style="font-family:var(--mono);">sin(0)=0</span>.
        </li>
        <li>
          Initial velocity is
          <span style="font-family:var(--mono);">∂y/∂t = Σ [ -A_n ω_n sin(ω_n t) + B_n ω_n cos(ω_n t) ] sin(k_n x)</span>,
          so at <span style="font-family:var(--mono);">t=0</span>:
          <span style="font-family:var(--mono);">∂y/∂t(x,0)= Σ (B_n ω_n) sin(k_n x)</span>.
          Requiring zero velocity forces <span style="font-family:var(--mono);">B_n=0</span> for all n.
        </li>
      </ul>

      <p>
        In this problem, the initial shape is already expressed in modes 1–3:
        <span style="font-family:var(--mono);">A_1=1</span>, <span style="font-family:var(--mono);">A_2=4</span>, <span style="font-family:var(--mono);">A_3=9</span>, and all other <span style="font-family:var(--mono);">A_n=0</span>.
        Therefore:
      </p>

      <div class="finalBox" id="final">
        <div class="finalTitle">
          <h3>Boxed result for y(x,t)</h3>
          <button class="btn" type="button" data-copy="#eqFinalY">⧉ Copy</button>
        </div>
        <pre id="eqFinalY" style="margin:0;font-family:var(--mono);white-space:pre-wrap;line-height:1.45;color:rgba(255,255,255,0.92);">
Let k_n = nπ/L and ω_n = k_n √(T/μ + α k_n²).

Then, with ẏ(x,0)=0 and y(x,0)=sin(πx/L)+4 sin(2πx/L)+9 sin(3πx/L):

y(x,t) = 1·cos(ω_1 t) sin(πx/L)
       + 4·cos(ω_2 t) sin(2πx/L)
       + 9·cos(ω_3 t) sin(3πx/L).
        </pre>
      </div>

      <h4>(d) Will the string ever have exactly the same shape again?</h4>
      <p>
        “Exactly the same shape as at <span style="font-family:var(--mono);">t=0</span>” means:
        <span style="font-family:var(--mono);">y(x,t)=y(x,0)</span> for <b>all</b> <span style="font-family:var(--mono);">x</span>.
        Since the sine modes are linearly independent, this requires each modal coefficient to match:
      </p>

      <div class="eqBlock">
        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">Exact-shape revival condition</div>
            <button class="btn" type="button" data-copy="#eqRevive">⧉ Copy</button>
          </div>
          <pre id="eqRevive">Need y(x,t)=y(x,0) for all x.

Given y(x,t)=Σ A_n cos(ω_n t) sin(k_n x) and y(x,0)=Σ A_n sin(k_n x),

We require cos(ω_n t) = 1 for every participating n.
Equivalently: ω_n t = 2π m_n, with integers m_n, simultaneously for all n.</pre>
        </div>
      </div>

      <p>
        For an ideal (non-dispersive) string with <span style="font-family:var(--mono);">α=0</span>, we have
        <span style="font-family:var(--mono);">ω_n = k_n √(T/μ) = (nπ/L) √(T/μ)</span>,
        so <span style="font-family:var(--mono);">ω_n/ω_1 = n</span> are integers. Then a common revival time exists:
        choose <span style="font-family:var(--mono);">t = 2π/ω_1 = 2L/√(T/μ) = 2L √(μ/T)</span>,
        and all modes satisfy <span style="font-family:var(--mono);">ω_n t = 2πn</span>.
      </p>

      <p>
        For a dispersive string with <span style="font-family:var(--mono);">α&gt;0</span>,
        <span style="font-family:var(--mono);">ω_n = (nπ/L) √(T/μ + α (nπ/L)²)</span>
        is <b>not proportional to n</b>. The ratios <span style="font-family:var(--mono);">ω_2/ω_1</span> and <span style="font-family:var(--mono);">ω_3/ω_1</span>
        are generally <b>not rational numbers</b> for generic parameter values. If the frequency ratios are irrational (incommensurate),
        there is no finite <span style="font-family:var(--mono);">t&gt;0</span> that makes all <span style="font-family:var(--mono);">ω_n t</span> simultaneously equal to <span style="font-family:var(--mono);">2π ×</span> integers.
        Therefore, in general:
      </p>

      <div class="finalBox">
        <div class="finalTitle">
          <h3>Conclusion for (d)</h3>
          <button class="btn" type="button" data-copy="#eqDfinal">⧉ Copy</button>
        </div>
        <pre id="eqDfinal" style="margin:0;font-family:var(--mono);white-space:pre-wrap;line-height:1.45;color:rgba(255,255,255,0.92);">
If α = 0 (non-dispersive): exact shape revival occurs at t = 2L √(μ/T).

If α > 0 (dispersive): exact revival generally does NOT occur, because the modal frequencies
ω_n are typically incommensurate (ratios not rational). The string can show approximate
“near revivals,” but not an exact first return for generic parameters.</pre>
      </div>

      <h4>Sanity checks</h4>
      <ul class="bullets">
        <li>
          <b>Units:</b> <span style="font-family:var(--mono);">T/μ</span> has units of <span style="font-family:var(--mono);">m²/s²</span>;
          to add <span style="font-family:var(--mono);">α k²</span> inside the square root, <span style="font-family:var(--mono);">α</span> must have units so that
          <span style="font-family:var(--mono);">α k²</span> is also <span style="font-family:var(--mono);">m²/s²</span>. Then <span style="font-family:var(--mono);">v_p</span> and <span style="font-family:var(--mono);">v_g</span> are speeds.
        </li>
        <li>
          <b>Limiting case α→0:</b>
          <span style="font-family:var(--mono);">v_p→√(T/μ)</span> (constant), <span style="font-family:var(--mono);">v_g→√(T/μ)</span>,
          and <span style="font-family:var(--mono);">ω_n∝n</span> ⇒ exact revivals.
        </li>
        <li>
          <b>High-k behavior:</b>
          for very large <span style="font-family:var(--mono);">k</span>, <span style="font-family:var(--mono);">ω≈k√(αk²)=√α k²</span>,
          so <span style="font-family:var(--mono);">v_p≈√α k</span> and <span style="font-family:var(--mono);">v_g≈2√α k</span> — strong dispersion.
        </li>
        <li>
          <b>Physical interpretation:</b>
          stiffness makes higher modes oscillate disproportionately fast, causing phase drift between harmonics.
        </li>
      </ul>
    </section>

    <section id="visuals">
      <h2>Interactive Visuals (Canvas)</h2>
      <p>
        The canvases below use <b>the same symbols</b> as the solution and the same example parameters used in the control panel
        (<span style="font-family:var(--mono);">L=1 m, μ=0.01 kg/m, T=10 N</span>). Adjust <span style="font-family:var(--mono);">α</span> and <span style="font-family:var(--mono);">t</span> to see how dispersion changes the mode frequencies and the shape’s (lack of) revival.
      </p>

      <div class="grid2">
        <figure>
          <div class="canvasWrap short">
            <canvas id="setupCanvas" aria-label="Physical setup diagram"></canvas>
          </div>
          <figcaption>
            Diagram: clamped string with tension T, mass density μ, and standing-wave coordinate x∈[0,L].
          </figcaption>
        </figure>

        <figure>
          <div class="canvasWrap short">
            <canvas id="dispCanvas" aria-label="Dispersion relation plot"></canvas>
          </div>
          <figcaption>
            Main plot: dispersion relation ω(k). Markers show the allowed modes k₁,k₂,k₃ and their ωₙ.
          </figcaption>
        </figure>
      </div>

      <div class="grid2" style="margin-top:12px;">
        <figure>
          <div class="canvasWrap tight">
            <canvas id="shapeCanvas" aria-label="String shape y(x,t) plot"></canvas>
          </div>
          <figcaption>
            Shape plot: y(x,t) vs x (m). Compare with y(x,0) to see phase drift between modes.
          </figcaption>
        </figure>

        <figure>
          <div class="canvasWrap tight">
            <canvas id="errCanvas" aria-label="Revival error vs time plot"></canvas>
          </div>
          <figcaption>
            Secondary plot: normalized revival error E(t)=||y(x,t)−y(x,0)||/||y(x,0)||. Exact revival would mean E(t)=0.
          </figcaption>
        </figure>
      </div>
    </section>

    <section>
      <h2>Copy-Friendly Final Answers</h2>
      <p>Use the buttons to copy the key results as plain text.</p>

      <div class="eqBlock">
        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">(a) Phase velocity</div>
            <button class="btn" type="button" data-copy="#copyA">⧉ Copy</button>
          </div>
          <pre id="copyA">v_p(k) = ω/k = √(T/μ + α k²)</pre>
        </div>

        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">(b) Group velocity</div>
            <button class="btn" type="button" data-copy="#copyB">⧉ Copy</button>
          </div>
          <pre id="copyB">v_g(k) = dω/dk = (T/μ + 2α k²) / √(T/μ + α k²)</pre>
        </div>

        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">(c) Displacement y(x,t)</div>
            <button class="btn" type="button" data-copy="#copyC">⧉ Copy</button>
          </div>
          <pre id="copyC">k_n = nπ/L
ω_n = k_n √(T/μ + α k_n²)

y(x,t) = cos(ω_1 t) sin(πx/L)
       + 4 cos(ω_2 t) sin(2πx/L)
       + 9 cos(ω_3 t) sin(3πx/L)</pre>
        </div>

        <div class="eq">
          <div class="eqTop">
            <div style="color:var(--muted);font-size:0.9rem;">(d) Revival statement</div>
            <button class="btn" type="button" data-copy="#copyD">⧉ Copy</button>
          </div>
          <pre id="copyD">Exact revival requires cos(ω_n t)=1 for all participating n.

α=0: ω_n ∝ n ⇒ exact revival at t = 2L √(μ/T).
α>0: ω_n not proportional to n ⇒ generally no exact revival (incommensurate ω_n), only approximate near revivals.</pre>
        </div>
      </div>
    </section>
  </article>
</main>

<footer>
  <p>
    Built as a self-contained HTML article (vanilla HTML/CSS/JS). Equations are rendered as plain text for maximum portability.
    The interactive plots use example parameters; the symbolic results remain valid for all μ, T, α, and L.
  </p>
</footer>

<div class="toast" id="toast" role="status" aria-live="polite">Copied.</div>

<script>
/* ========= Utilities ========= */
const $ = (sel) => document.querySelector(sel);

function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }
function fmt(x, d=3){
  if (!isFinite(x)) return "—";
  const abs = Math.abs(x);
  if (abs !== 0 && (abs < 1e-3 || abs >= 1e4)) return x.toExponential(d);
  return x.toFixed(d);
}

function toast(msg="Copied."){
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toast._tm);
  toast._tm = setTimeout(()=>t.classList.remove("show"), 900);
}

async function copyText(txt){
  try{
    await navigator.clipboard.writeText(txt);
    toast("Copied to clipboard.");
  }catch(e){
    // fallback
    const ta = document.createElement("textarea");
    ta.value = txt;
    ta.style.position="fixed";
    ta.style.left="-9999px";
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    document.body.removeChild(ta);
    toast("Copied (fallback).");
  }
}

/* ========= Copy buttons ========= */
document.addEventListener("click", (ev)=>{
  const btn = ev.target.closest("[data-copy]");
  if(!btn) return;
  const sel = btn.getAttribute("data-copy");
  const node = $(sel);
  if(!node) return;
  copyText(node.innerText.trim());
});

/* ========= Example parameters for plotting =========
   These are ONLY for the demo visualization.
   Symbolic answers above remain general.
*/
const params = {
  L: 1.0,        // m
  mu: 0.01,      // kg/m
  T: 10.0,       // N
  alpha: 20.0,   // chosen so dispersion is visible for low n
  t: 0.0,        // s
  tMax: 0.5      // s (slider max)
};

function c0(){ return Math.sqrt(params.T/params.mu); }

function k_n(n){ return n*Math.PI/params.L; }
function omega_of_k(k){
  return k*Math.sqrt(params.T/params.mu + params.alpha*k*k);
}
function omega_n(n){
  const k = k_n(n);
  return omega_of_k(k);
}
function v_phase(k){
  return Math.sqrt(params.T/params.mu + params.alpha*k*k);
}
function v_group(k){
  const inside = params.T/params.mu + params.alpha*k*k;
  return (params.T/params.mu + 2*params.alpha*k*k) / Math.sqrt(inside);
}

/* ========= Canvas helper: high-DPI + responsive ========= */
class HiDPICanvas{
  constructor(canvas, drawFn){
    this.canvas = canvas;
    this.ctx = canvas.getContext("2d");
    this.drawFn = drawFn;
    this.resizeObserver = new ResizeObserver(()=>this.resize());
    this.resizeObserver.observe(canvas);
    this.resize();
  }
  resize(){
    const dpr = window.devicePixelRatio || 1;
    const rect = this.canvas.getBoundingClientRect();
    const w = Math.max(2, Math.floor(rect.width * dpr));
    const h = Math.max(2, Math.floor(rect.height * dpr));
    if (this.canvas.width !== w || this.canvas.height !== h){
      this.canvas.width = w;
      this.canvas.height = h;
    }
    this.ctx.setTransform(1,0,0,1,0,0);
    this.ctx.scale(dpr, dpr);
    this.dpr = dpr;
    this.wCSS = rect.width;
    this.hCSS = rect.height;
    this.render();
  }
  render(){
    this.drawFn(this.ctx, this.wCSS, this.hCSS, this.dpr);
  }
}

/* ========= Plotting primitives ========= */
function clear(ctx, w, h){
  ctx.clearRect(0,0,w,h);
  // subtle background tint inside plot
  ctx.fillStyle = "rgba(0,0,0,0.12)";
  ctx.fillRect(0,0,w,h);
}

function drawTitle(ctx, w, title){
  ctx.save();
  ctx.fillStyle = "rgba(255,255,255,0.92)";
  ctx.font = "600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.textAlign="left";
  ctx.textBaseline="top";
  ctx.fillText(title, 12, 10);
  ctx.restore();
}

function plotArea(w,h){
  const padL = 54, padR = 18, padT = 34, padB = 44;
  return {x: padL, y: padT, w: w - padL - padR, h: h - padT - padB, padL, padR, padT, padB};
}

function niceTicks(min, max, count=5){
  const span = max - min;
  if (span <= 0) return {step:1, start:min, stop:max};
  const raw = span / count;
  const pow = Math.pow(10, Math.floor(Math.log10(raw)));
  const norm = raw / pow;
  let step;
  if (norm < 1.5) step = 1*pow;
  else if (norm < 3.5) step = 2*pow;
  else if (norm < 7.5) step = 5*pow;
  else step = 10*pow;

  const start = Math.ceil(min/step)*step;
  const stop = Math.floor(max/step)*step;
  return {step, start, stop};
}

function drawAxes(ctx, w, h, xMin, xMax, yMin, yMax, xLabel, yLabel){
  const A = plotArea(w,h);
  const x0 = A.x, y0 = A.y, pw = A.w, ph = A.h;

  // grid
  const xt = niceTicks(xMin, xMax, 6);
  const yt = niceTicks(yMin, yMax, 5);

  ctx.save();
  ctx.strokeStyle = "rgba(255,255,255,0.10)";
  ctx.lineWidth = 1;

  // vertical gridlines
  for(let x=xt.start; x<=xt.stop+1e-12; x+=xt.step){
    const X = x0 + (x - xMin) / (xMax - xMin) * pw;
    ctx.beginPath();
    ctx.moveTo(X, y0);
    ctx.lineTo(X, y0 + ph);
    ctx.stroke();
  }
  // horizontal gridlines
  for(let y=yt.start; y<=yt.stop+1e-12; y+=yt.step){
    const Y = y0 + ph - (y - yMin) / (yMax - yMin) * ph;
    ctx.beginPath();
    ctx.moveTo(x0, Y);
    ctx.lineTo(x0 + pw, Y);
    ctx.stroke();
  }

  // border
  ctx.strokeStyle = "rgba(255,255,255,0.18)";
  ctx.strokeRect(x0, y0, pw, ph);

  // ticks + labels
  ctx.fillStyle = "rgba(255,255,255,0.72)";
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.textAlign="center";
  ctx.textBaseline="top";
  for(let x=xt.start; x<=xt.stop+1e-12; x+=xt.step){
    const X = x0 + (x - xMin) / (xMax - xMin) * pw;
    ctx.beginPath();
    ctx.moveTo(X, y0+ph);
    ctx.lineTo(X, y0+ph+5);
    ctx.strokeStyle="rgba(255,255,255,0.22)";
    ctx.stroke();
    ctx.fillText(fmt(x, (Math.abs(x)<10?2:1)), X, y0+ph+8);
  }

  ctx.textAlign="right";
  ctx.textBaseline="middle";
  for(let y=yt.start; y<=yt.stop+1e-12; y+=yt.step){
    const Y = y0 + ph - (y - yMin) / (yMax - yMin) * ph;
    ctx.beginPath();
    ctx.moveTo(x0-5, Y);
    ctx.lineTo(x0, Y);
    ctx.strokeStyle="rgba(255,255,255,0.22)";
    ctx.stroke();
    ctx.fillText(fmt(y, (Math.abs(y)<10?2:1)), x0-8, Y);
  }

  // axis labels
  ctx.save();
  ctx.fillStyle = "rgba(255,255,255,0.78)";
  ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.textAlign="center";
  ctx.textBaseline="bottom";
  ctx.fillText(xLabel, x0 + pw/2, h - 10);

  ctx.translate(14, y0 + ph/2);
  ctx.rotate(-Math.PI/2);
  ctx.textBaseline="top";
  ctx.fillText(yLabel, 0, 0);
  ctx.restore();

  ctx.restore();

  return A;
}

function toXY(A, x, y, xMin, xMax, yMin, yMax){
  const X = A.x + (x - xMin) / (xMax - xMin) * A.w;
  const Y = A.y + A.h - (y - yMin) / (yMax - yMin) * A.h;
  return [X,Y];
}

function strokePath(ctx, pts, color="rgba(158,231,255,0.95)", width=2){
  if(pts.length<2) return;
  ctx.save();
  ctx.strokeStyle = color;
  ctx.lineWidth = width;
  ctx.lineJoin="round";
  ctx.lineCap="round";
  ctx.beginPath();
  ctx.moveTo(pts[0][0], pts[0][1]);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i][0], pts[i][1]);
  ctx.stroke();
  ctx.restore();
}

function drawLegend(ctx, items, x, y){
  ctx.save();
  ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.textAlign="left";
  ctx.textBaseline="middle";
  let yy = y;
  items.forEach(it=>{
    ctx.fillStyle = it.color;
    ctx.fillRect(x, yy-5, 14, 10);
    ctx.fillStyle = "rgba(255,255,255,0.78)";
    ctx.fillText(it.label, x+20, yy);
    yy += 18;
  });
  ctx.restore();
}

/* ========= Data for this problem ========= */
const modes = [
  {n:1, A:1},
  {n:2, A:4},
  {n:3, A:9}
];

/* y(x,t) = Σ A_n cos(ω_n t) sin(k_n x) */
function y_xt(x,t){
  let s=0;
  for(const m of modes){
    const k = k_n(m.n);
    const w = omega_n(m.n);
    s += m.A * Math.cos(w*t) * Math.sin(k*x);
  }
  return s;
}
function y_x0(x){
  let s=0;
  for(const m of modes){
    const k = k_n(m.n);
    s += m.A * Math.sin(k*x);
  }
  return s;
}

/* normalized error E(t)=||y(t)-y(0)||/||y(0)|| over x in [0,L] */
function revivalError(t){
  const N = 600;
  let num=0, den=0;
  for(let i=0;i<N;i++){
    const x = (i/(N-1))*params.L;
    const d = y_xt(x,t) - y_x0(x);
    const y0 = y_x0(x);
    num += d*d;
    den += y0*y0;
  }
  return Math.sqrt(num/Math.max(den,1e-12));
}

/* ========= Canvases ========= */
let setupPlot, dispPlot, shapePlot, errPlot;

/* 1) Setup diagram */
function drawSetup(ctx, w, h){
  clear(ctx,w,h);
  drawTitle(ctx,w,"Setup: clamped dispersive string");

  const pad = 18;
  const yMid = h*0.56;
  const xL = pad+20;
  const xR = w - pad - 20;

  // clamps
  ctx.save();
  ctx.fillStyle = "rgba(255,255,255,0.14)";
  ctx.strokeStyle = "rgba(255,255,255,0.30)";
  ctx.lineWidth = 2;

  // left clamp
  ctx.fillRect(xL-18, yMid-60, 14, 120);
  ctx.strokeRect(xL-18, yMid-60, 14, 120);
  // right clamp
  ctx.fillRect(xR+4, yMid-60, 14, 120);
  ctx.strokeRect(xR+4, yMid-60, 14, 120);

  // string shape (a stylized standing wave)
  const amp = Math.min(40, h*0.14);
  ctx.strokeStyle = "rgba(158,231,255,0.95)";
  ctx.lineWidth = 3;
  ctx.beginPath();
  for(let i=0;i<=220;i++){
    const u = i/220;
    const x = xL + u*(xR-xL);
    const y = yMid - amp*(Math.sin(Math.PI*u)*0.75 + 0.25*Math.sin(3*Math.PI*u));
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();

  // axis x
  ctx.strokeStyle = "rgba(255,255,255,0.26)";
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  ctx.moveTo(xL, yMid+70);
  ctx.lineTo(xR, yMid+70);
  ctx.stroke();
  // arrow
  ctx.beginPath();
  ctx.moveTo(xR, yMid+70);
  ctx.lineTo(xR-10, yMid+64);
  ctx.lineTo(xR-10, yMid+76);
  ctx.closePath();
  ctx.fillStyle="rgba(255,255,255,0.26)";
  ctx.fill();

  // labels
  ctx.fillStyle = "rgba(255,255,255,0.86)";
  ctx.font = "600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.textAlign="left";
  ctx.textBaseline="top";
  ctx.fillText("Clamp at x = 0", xL-10, yMid-78);
  ctx.textAlign="right";
  ctx.fillText("Clamp at x = L", xR+10, yMid-78);

  ctx.textAlign="center";
  ctx.textBaseline="top";
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillStyle="rgba(255,255,255,0.70)";
  ctx.fillText("x (m)", (xL+xR)/2, yMid+82);

  // tension arrow
  const ax = xL + (xR-xL)*0.22, ay = yMid-26;
  ctx.strokeStyle="rgba(183,255,164,0.90)";
  ctx.lineWidth=2.5;
  ctx.beginPath();
  ctx.moveTo(ax, ay);
  ctx.lineTo(ax+70, ay);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(ax+70, ay);
  ctx.lineTo(ax+58, ay-6);
  ctx.lineTo(ax+58, ay+6);
  ctx.closePath();
  ctx.fillStyle="rgba(183,255,164,0.90)";
  ctx.fill();
  ctx.fillStyle="rgba(255,255,255,0.80)";
  ctx.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.textAlign="left";
  ctx.textBaseline="bottom";
  ctx.fillText("Tension T", ax, ay-8);

  // dispersion label
  ctx.fillStyle="rgba(255,255,255,0.70)";
  ctx.font="12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.textAlign="left";
  ctx.textBaseline="top";
  ctx.fillText(`Dispersion: ω = k √(T/μ + α k²)`, pad+6, pad+24);
  ctx.fillText(`Example: L=${fmt(params.L,2)} m, μ=${fmt(params.mu,3)} kg/m, T=${fmt(params.T,2)} N, α=${fmt(params.alpha,2)}`, pad+6, pad+42);

  ctx.restore();
}

/* 2) Dispersion plot ω(k) */
function drawDispersion(ctx, w, h){
  clear(ctx,w,h);
  drawTitle(ctx,w,"Main plot: dispersion relation ω(k)");

  // choose range to include k1..k3 clearly
  const k3 = k_n(3);
  const kMax = Math.max(4*k3, 1.0);
  const kMin = 0;

  // compute ω range
  let wMax = omega_of_k(kMax);
  const yMin = 0;
  const yMax = wMax*1.05;

  const A = drawAxes(ctx,w,h,kMin,kMax,yMin,yMax,"k (1/m)","ω (rad/s)");

  // curve ω(k)
  const pts = [];
  const N=400;
  for(let i=0;i<=N;i++){
    const k = kMin + (i/N)*(kMax-kMin);
    const om = omega_of_k(k);
    pts.push(toXY(A,k,om,kMin,kMax,yMin,yMax));
  }
  strokePath(ctx, pts, "rgba(158,231,255,0.95)", 2.5);

  // markers for modes n=1..3
  const colors = ["rgba(183,255,164,0.95)","rgba(255,210,122,0.95)","rgba(255,138,165,0.95)"];
  ctx.save();
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.textAlign="left";
  ctx.textBaseline="bottom";

  modes.forEach((m, idx)=>{
    const k = k_n(m.n);
    const om = omega_n(m.n);
    const [X,Y] = toXY(A,k,om,kMin,kMax,yMin,yMax);
    ctx.fillStyle = colors[idx];
    ctx.beginPath();
    ctx.arc(X,Y,5.2,0,Math.PI*2);
    ctx.fill();
    ctx.strokeStyle="rgba(0,0,0,0.35)";
    ctx.lineWidth=1;
    ctx.stroke();

    ctx.fillStyle="rgba(255,255,255,0.80)";
    ctx.fillText(`n=${m.n}`, X+8, Y-4);
  });

  // show tangent at selected k = k1 (to hint at v_g)
  const k0 = k_n(1);
  const om0 = omega_of_k(k0);
  const vg0 = v_group(k0); // slope dω/dk
  // tangent line: ω = ω0 + vg0 (k-k0)
  const kLeft = clamp(k0 - 0.6*k3, kMin, kMax);
  const kRight = clamp(k0 + 1.0*k3, kMin, kMax);
  const p1 = toXY(A, kLeft, om0 + vg0*(kLeft-k0), kMin,kMax,yMin,yMax);
  const p2 = toXY(A, kRight, om0 + vg0*(kRight-k0), kMin,kMax,yMin,yMax);
  strokePath(ctx,[p1,p2],"rgba(255,255,255,0.45)",1.8);

  drawLegend(ctx,[
    {label:"ω(k)", color:"rgba(158,231,255,0.95)"},
    {label:"Modes k₁,k₂,k₃", color:"rgba(255,255,255,0.45)"},
    {label:"Tangent at k₁ (slope = v_g)", color:"rgba(255,255,255,0.45)"}
  ], A.x+10, A.y+12);

  // small readout box
  const vp0 = v_phase(k0);
  const boxW = 250, boxH = 56;
  ctx.fillStyle="rgba(0,0,0,0.28)";
  ctx.strokeStyle="rgba(255,255,255,0.16)";
  ctx.lineWidth=1;
  ctx.fillRect(w-boxW-14, 46, boxW, boxH);
  ctx.strokeRect(w-boxW-14, 46, boxW, boxH);
  ctx.fillStyle="rgba(255,255,255,0.82)";
  ctx.textAlign="left";
  ctx.textBaseline="top";
  ctx.fillText(`At k₁ = π/L:  v_p = ${fmt(vp0,2)} m/s`, w-boxW-4, 54);
  ctx.fillText(`                 v_g = ${fmt(vg0,2)} m/s`, w-boxW-4, 72);

  ctx.restore();
}

/* 3) Shape plot y(x,t) */
function drawShape(ctx, w, h){
  clear(ctx,w,h);
  drawTitle(ctx,w,"Shape plot: y(x,t) and y(x,0)");

  const xMin=0, xMax=params.L;

  // find y range
  let yMin=Infinity, yMax=-Infinity;
  const N=500;
  for(let i=0;i<N;i++){
    const x = xMin + (i/(N-1))*(xMax-xMin);
    const y0 = y_x0(x);
    const yt = y_xt(x, params.t);
    yMin = Math.min(yMin, y0, yt);
    yMax = Math.max(yMax, y0, yt);
  }
  const pad = 0.15*(yMax-yMin || 1);
  yMin -= pad; yMax += pad;

  const A = drawAxes(ctx,w,h,xMin,xMax,yMin,yMax,"x (m)","y (arb.)");

  // y(x,0)
  const pts0=[];
  for(let i=0;i<=N;i++){
    const x = xMin + (i/N)*(xMax-xMin);
    const y0 = y_x0(x);
    pts0.push(toXY(A,x,y0,xMin,xMax,yMin,yMax));
  }
  strokePath(ctx, pts0, "rgba(255,255,255,0.60)", 2);

  // y(x,t)
  const ptsT=[];
  for(let i=0;i<=N;i++){
    const x = xMin + (i/N)*(xMax-xMin);
    const yt = y_xt(x, params.t);
    ptsT.push(toXY(A,x,yt,xMin,xMax,yMin,yMax));
  }
  strokePath(ctx, ptsT, "rgba(183,255,164,0.95)", 2.6);

  // legend
  drawLegend(ctx,[
    {label:"y(x,0)", color:"rgba(255,255,255,0.60)"},
    {label:"y(x,t)", color:"rgba(183,255,164,0.95)"}
  ], A.x+10, A.y+12);

  // annotate the three cos factors at current time
  ctx.save();
  ctx.font="12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillStyle="rgba(255,255,255,0.78)";
  const c1 = Math.cos(omega_n(1)*params.t);
  const c2 = Math.cos(omega_n(2)*params.t);
  const c3 = Math.cos(omega_n(3)*params.t);
  const txt = `cos(ω₁t)=${fmt(c1,3)}   cos(ω₂t)=${fmt(c2,3)}   cos(ω₃t)=${fmt(c3,3)}`;
  ctx.fillText(txt, A.x, A.y + A.h + 6);
  ctx.restore();
}

/* 4) Error vs time plot */
function drawError(ctx, w, h){
  clear(ctx,w,h);
  drawTitle(ctx,w,"Secondary plot: revival error E(t)");

  const tMin=0, tMax=params.tMax;
  const M=260;

  // compute curve and range
  const E = new Array(M+1);
  let yMin=0, yMax=0;
  for(let i=0;i<=M;i++){
    const t = tMin + (i/M)*(tMax-tMin);
    const e = revivalError(t);
    E[i]=e;
    yMax = Math.max(yMax, e);
  }
  yMax = Math.max(0.2, yMax*1.05);

  const A = drawAxes(ctx,w,h,tMin,tMax,0,yMax,"t (s)","E(t) (dimensionless)");

  // plot error curve
  const pts=[];
  for(let i=0;i<=M;i++){
    const t = tMin + (i/M)*(tMax-tMin);
    pts.push(toXY(A,t,E[i],tMin,tMax,0,yMax));
  }
  strokePath(ctx, pts, "rgba(255,210,122,0.95)", 2.6);

  // vertical marker at current time
  const t = clamp(params.t, tMin, tMax);
  const [X0, Y0] = toXY(A, t, 0, tMin,tMax,0,yMax);
  const [X1, Y1] = toXY(A, t, yMax, tMin,tMax,0,yMax);
  ctx.save();
  ctx.strokeStyle="rgba(255,255,255,0.55)";
  ctx.lineWidth=1.5;
  ctx.setLineDash([6,6]);
  ctx.beginPath();
  ctx.moveTo(X0, A.y);
  ctx.lineTo(X0, A.y + A.h);
  ctx.stroke();
  ctx.setLineDash([]);

  // dot at current E(t)
  const eNow = revivalError(t);
  const [Xd, Yd] = toXY(A, t, eNow, tMin,tMax,0,yMax);
  ctx.fillStyle="rgba(158,231,255,0.95)";
  ctx.beginPath();
  ctx.arc(Xd, Yd, 5.2, 0, Math.PI*2);
  ctx.fill();
  ctx.strokeStyle="rgba(0,0,0,0.35)";
  ctx.lineWidth=1;
  ctx.stroke();

  drawLegend(ctx,[
    {label:"E(t) = ||y(t)-y(0)|| / ||y(0)||", color:"rgba(255,210,122,0.95)"},
    {label:"current time marker", color:"rgba(255,255,255,0.55)"}
  ], A.x+10, A.y+12);

  // note about exact revival
  ctx.fillStyle="rgba(255,255,255,0.78)";
  ctx.font="12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.textAlign="left";
  ctx.textBaseline="top";
  ctx.fillText("Exact revival would require E(t)=0 at some t>0.", A.x, A.y + A.h + 8);
  ctx.restore();
}

/* ========= UI wiring ========= */
const alphaRange = $("#alphaRange");
const timeRange = $("#timeRange");
const alphaVal = $("#alphaVal");
const timeVal = $("#timeVal");
const playBtn = $("#playBtn");

let playing=false;
let lastTS=0;

function updateUI(){
  alphaVal.textContent = fmt(params.alpha,1);
  timeVal.textContent = fmt(params.t,3);

  // KPIs
  $("#cVal").textContent = `${fmt(c0(),2)} m/s`;
  $("#w1Val").textContent = fmt(omega_n(1),2);
  $("#errVal").textContent = fmt(revivalError(params.t),3);

  // plots
  setupPlot.render();
  dispPlot.render();
  shapePlot.render();
  errPlot.render();
}

alphaRange.addEventListener("input", ()=>{
  params.alpha = parseFloat(alphaRange.value);
  updateUI();
});

timeRange.addEventListener("input", ()=>{
  params.t = parseFloat(timeRange.value);
  updateUI();
});

function setPlaying(on){
  playing = on;
  playBtn.textContent = playing ? "⏸ Pause" : "▶︎ Play";
  if(playing){
    lastTS = performance.now();
    requestAnimationFrame(tick);
  }
}

function tick(ts){
  if(!playing) return;
  const dt = (ts - lastTS)/1000;
  lastTS = ts;

  // animate time, wrap around
  params.t += dt;
  if(params.t > params.tMax) params.t = 0;

  // sync slider
  timeRange.value = params.t.toFixed(3);

  updateUI();
  requestAnimationFrame(tick);
}

playBtn.addEventListener("click", ()=> setPlaying(!playing));

/* ========= Initialize canvases ========= */
setupPlot = new HiDPICanvas($("#setupCanvas"), drawSetup);
dispPlot  = new HiDPICanvas($("#dispCanvas"), drawDispersion);
shapePlot = new HiDPICanvas($("#shapeCanvas"), drawShape);
errPlot   = new HiDPICanvas($("#errCanvas"), drawError);

/* ========= Initial values ========= */
(function init(){
  params.alpha = parseFloat(alphaRange.value);
  params.t = parseFloat(timeRange.value);
  updateUI();
})();
</script>
</body>
</html>
