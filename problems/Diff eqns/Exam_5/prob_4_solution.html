<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>First-Order Linear ODEs: Integrating Factor & Sinusoidal Forcing</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --faint: rgba(255,255,255,.55);
      --line: rgba(255,255,255,.16);
      --accent: #7dd3fc;
      --accent2: #a78bfa;
      --good: #86efac;
      --warn: #fbbf24;
      --bad: #fb7185;
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg: #f7f7fb;
        --panel: rgba(0,0,0,.05);
        --panel2: rgba(0,0,0,.07);
        --text: rgba(0,0,0,.86);
        --muted: rgba(0,0,0,.66);
        --faint: rgba(0,0,0,.55);
        --line: rgba(0,0,0,.14);
        --shadow: 0 18px 55px rgba(0,0,0,.12);
      }
    }

    html,body{height:100%;}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 18% 10%, rgba(125,211,252,.16), transparent 55%),
        radial-gradient(1200px 800px at 85% 25%, rgba(167,139,250,.15), transparent 52%),
        radial-gradient(900px 600px at 50% 95%, rgba(134,239,172,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      font-family: var(--sans);
      line-height:1.55;
    }

    a{color:inherit; text-decoration-color: rgba(125,211,252,.5);}
    a:hover{ text-decoration-color: rgba(125,211,252,.9); }

    header{
      padding: 28px 20px 8px;
    }
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 18px 56px;
    }

    .hero{
      display:grid;
      grid-template-columns: 1.6fr .9fr;
      gap: 16px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .hero{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px;
      position: relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(420px 220px at 15% 8%, rgba(125,211,252,.18), transparent 65%),
        radial-gradient(420px 240px at 90% 0%, rgba(167,139,250,.15), transparent 65%);
      pointer-events:none;
      filter: blur(0px);
      opacity:.9;
    }
    .card > *{ position:relative; }

    h1{
      font-size: clamp(1.55rem, 2.2vw, 2.1rem);
      margin: 0 0 8px 0;
      letter-spacing: -0.02em;
    }
    .subtitle{
      color: var(--muted);
      margin: 0;
      font-size: 1rem;
    }

    .kpis{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    .pill{
      background: var(--panel2);
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 10px 12px;
      font-size: .92rem;
      color: var(--muted);
    }
    .pill b{ color: var(--text); font-weight: 650; }

    main{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap: 16px;
      margin-top: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    /* Sticky mini-TOC */
    nav.toc{
      position: sticky;
      top: 12px;
      align-self:start;
      padding: 14px;
    }
    @media (max-width: 980px){
      nav.toc{ position: relative; top: 0; }
    }
    .toc h2{
      font-size: 0.95rem;
      margin: 0 0 10px;
      color: var(--muted);
      letter-spacing:.02em;
      text-transform: uppercase;
    }
    .toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid transparent;
      color: var(--text);
      text-decoration:none;
      font-size:.95rem;
    }
    .toc a:hover{
      background: var(--panel2);
      border-color: var(--line);
    }
    .toc .hint{
      margin-top: 10px;
      font-size: .86rem;
      color: var(--faint);
    }

    section{
      margin-bottom: 16px;
    }
    section .section-title{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    h2{
      margin: 0;
      font-size: 1.25rem;
      letter-spacing: -0.01em;
    }
    .tag{
      font-size: .82rem;
      color: var(--muted);
      border:1px solid var(--line);
      background: var(--panel2);
      padding: 6px 10px;
      border-radius: 999px;
      white-space: nowrap;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 900px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .callout{
      border-left: 4px solid rgba(125,211,252,.85);
      background: linear-gradient(90deg, rgba(125,211,252,.10), transparent 70%);
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
    }
    .callout.warn{ border-left-color: rgba(251,191,36,.9); background: linear-gradient(90deg, rgba(251,191,36,.10), transparent 70%); }
    .callout.good{ border-left-color: rgba(134,239,172,.9); background: linear-gradient(90deg, rgba(134,239,172,.11), transparent 70%); }

    ul{ margin: 8px 0 0 18px; }
    li{ margin: 6px 0; color: var(--muted); }
    li b{ color: var(--text); }

    .eq{
      background: rgba(0,0,0,.18);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      margin: 10px 0;
      position:relative;
      overflow:hidden;
    }
    @media (prefers-color-scheme: light){
      .eq{ background: rgba(255,255,255,.75); }
    }
    .eq pre{
      margin: 0;
      font-family: var(--mono);
      font-size: .95rem;
      white-space: pre-wrap;
      word-break: break-word;
      color: var(--text);
    }
    .copyRow{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 10px;
      align-items:center;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background: var(--panel2);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 600;
      letter-spacing: .01em;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    button:hover{ background: rgba(125,211,252,.12); border-color: rgba(125,211,252,.35); }
    button:active{ transform: translateY(1px) scale(.99); }
    .btn2:hover{ background: rgba(167,139,250,.12); border-color: rgba(167,139,250,.35); }

    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 760px){
      .controls{ grid-template-columns: 1fr; }
    }
    .ctrl{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--panel2), rgba(255,255,255,0));
    }
    .ctrl label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      font-size:.92rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .ctrl output{
      font-family: var(--mono);
      color: var(--text);
      font-size:.92rem;
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    select{
      width:100%;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: var(--panel2);
      color: var(--text);
      font-weight: 600;
    }

    figure{
      margin: 0;
    }
    .canvasWrap{
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(0,0,0,.14);
    }
    @media (prefers-color-scheme: light){
      .canvasWrap{ background: rgba(255,255,255,.7); }
    }
    canvas{
      display:block;
      width:100%;
      height: 320px;
    }
    .canvasSmall canvas{ height: 260px; }

    .figCap{
      padding: 10px 12px 12px;
      color: var(--muted);
      font-size: .92rem;
      border-top: 1px solid var(--line);
    }
    .figCap b{ color: var(--text); }

    .boxFinal{
      border: 1px solid rgba(134,239,172,.35);
      background: linear-gradient(90deg, rgba(134,239,172,.10), transparent 70%);
      border-radius: 16px;
      padding: 14px 14px;
    }
    .boxFinal h3{
      margin: 0 0 8px;
      font-size: 1.05rem;
    }

    footer{
      margin-top: 18px;
      color: var(--faint);
      font-size: .9rem;
      padding: 10px 4px 2px;
    }

    /* Subtle entrance animation */
    @keyframes rise {
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }
    .card, nav.toc{ animation: rise .35s ease both; }

    /* Print-friendly */
    @media print{
      body{ background:#fff; color:#000; }
      .card{ box-shadow:none; background:#fff; }
      nav.toc{ display:none; }
      button, .controls{ display:none !important; }
      .canvasWrap{ break-inside: avoid; }
      a{ text-decoration: none; color: #000; }
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="hero">
        <article class="card">
          <h1>Solving First-Order Linear ODEs: Integrating Factors & Sinusoidal Steady-State</h1>
          <p class="subtitle">
            We solve two linear differential equations: (a) a variable-coefficient ODE using an integrating factor, and (b) a driven first-order system with sinusoidal forcing, extracting the purely sinusoidal (steady-state) response.
          </p>

          <div class="kpis">
            <div class="pill"><b>Topic:</b> Linear ODEs (1st order)</div>
            <div class="pill"><b>Tools:</b> Integrating factor, undetermined coefficients</div>
            <div class="pill"><b>Physics lens:</b> 1-pole “relaxation” system (e.g., RC)</div>
            <div class="pill"><b>What you’ll see:</b> Time response + frequency sweep</div>
          </div>
        </article>

        <aside class="card">
          <div class="section-title">
            <h2 id="quick-summary">Quick Summary</h2>
            <span class="tag">Read first</span>
          </div>
          <ul>
            <li>Rewrite (a) as <b>ẋ + (2/t)x = t</b> and use integrating factor <b>μ(t)=t²</b>.</li>
            <li>Then <b>(t²x)̇ = t³</b> ⇒ integrate ⇒ <b>x(t)=t²/4 + C/t²</b> (for <b>t≠0</b>).</li>
            <li>For (b), guess a sinusoid <b>x_p = A cos(2t)+B sin(2t)</b>.</li>
            <li>Match coefficients to get <b>A=B=1/4</b> ⇒ <b>x_p=(1/4)(cos(2t)+sin(2t))</b>.</li>
            <li>Interactive plots let you vary <b>C</b> (part a) and forcing frequency <b>ω</b> (generalizing part b; set <b>ω=2</b> to match the problem).</li>
          </ul>
          <div class="copyRow">
            <button class="btn2" data-copy="x(t)=t^2/4 + C/t^2  (t≠0)">Copy final (a)</button>
            <button data-copy="x_sin(t)=(1/4)(cos(2t)+sin(2t))">Copy final (b)</button>
          </div>
          <p class="subtitle" style="margin-top:10px;color:var(--faint)">
            Tip: In (b) the <i>general</i> solution adds a decaying transient <span style="font-family:var(--mono)">Ce^{-2t}</span>, but the question asks for a purely sinusoidal solution.
          </p>
        </aside>
      </div>

      <main>
        <nav class="toc card">
          <h2>Table of Contents</h2>
          <a href="#part1">PART 1 — Problem Analysis</a>
          <a href="#part2">PART 2 — Strategy & Tips</a>
          <a href="#part3">PART 3 — Full Solution</a>
          <a href="#viz">Interactive Visualizations</a>
          <div class="hint">Click to jump. Plots update live using the controls.</div>
        </nav>

        <div>
          <!-- PART 1 -->
          <section id="part1">
            <article class="card">
              <div class="section-title">
                <h2>PART 1 — Problem Analysis (no solving yet)</h2>
                <span class="tag">Understand & choose tools</span>
              </div>

              <div class="callout">
                <b>Restatement in plain words.</b><br/>
                (a) Find the most general function <span style="font-family:var(--mono)">x(t)</span> whose derivative satisfies
                <span style="font-family:var(--mono)">t ẋ + 2x = t²</span> (a linear ODE with a variable coefficient <span style="font-family:var(--mono)">t</span>).<br/>
                (b) Find one solution of <span style="font-family:var(--mono)">ẋ + 2x = cos(2t)</span> that is purely sinusoidal (no decaying exponential), and write it as a sum of sine and cosine.
              </div>

              <div class="grid2" style="margin-top:12px">
                <div class="callout good">
                  <b>Given quantities</b>
                  <ul>
                    <li>(a) Differential equation: <b>t ẋ + 2x = t²</b> (no initial condition given).</li>
                    <li>(b) Differential equation: <b>ẋ + 2x = cos(2t)</b> (forcing frequency fixed at <b>2</b>).</li>
                  </ul>
                </div>

                <div class="callout good">
                  <b>Unknowns</b>
                  <ul>
                    <li>The function <b>x(t)</b>.</li>
                    <li>In (a) an arbitrary constant <b>C</b> (because no initial condition).</li>
                    <li>In (b) coefficients <b>A, B</b> in a sinusoidal trial solution.</li>
                  </ul>
                </div>
              </div>

              <div class="callout" style="margin-top:12px">
                <b>What must be found / proved</b>
                <ul>
                  <li>(a) The <b>general solution</b> <span style="font-family:var(--mono)">x(t)</span>.</li>
                  <li>(b) A <b>sinusoidal (steady-state) solution</b> expressed as <span style="font-family:var(--mono)">A cos(2t) + B sin(2t)</span>.</li>
                </ul>
              </div>

              <div class="callout" style="margin-top:12px">
                <b>Relevant principles (and why they apply)</b>
                <ul>
                  <li><b>First-order linear ODE form</b>: Both equations can be written as <span style="font-family:var(--mono)">ẋ + p(t)x = q(t)</span>, so integrating factors apply.</li>
                  <li><b>Steady-state sinusoidal response</b> (physics lens): <span style="font-family:var(--mono)">ẋ + 2x =</span> (input) is a classic <b>single-pole relaxation system</b> (like an RC circuit). A sinusoidal input produces a sinusoidal steady-state output at the same frequency.</li>
                  <li><b>Undetermined coefficients</b>: For constant-coefficient linear ODEs with sinusoidal forcing, guessing a sine/cosine combination is efficient and systematic.</li>
                </ul>
              </div>

              <div class="grid2" style="margin-top:12px">
                <div class="callout warn">
                  <b>Possible approaches</b>
                  <ul>
                    <li><b>Integrating factor</b> (both a & b): Direct, works universally for linear first-order ODEs.</li>
                    <li><b>Separation / substitution</b>: Not natural here because of the <span style="font-family:var(--mono)">x</span> and <span style="font-family:var(--mono)">ẋ</span> mix; you end up reproducing integrating factor steps anyway.</li>
                    <li><b>Phasor/complex method</b> (b): Replace <span style="font-family:var(--mono)">cos</span> by <span style="font-family:var(--mono)">Re(e^{i2t})</span>, solve algebraically for a complex amplitude, then take the real part.</li>
                  </ul>
                </div>

                <div class="callout">
                  <b>Best choice</b><br/>
                  Use <b>integrating factor</b> for (a) because of the variable coefficient <span style="font-family:var(--mono)">2/t</span> after normalization.
                  For (b), <b>undetermined coefficients</b> is fastest for the requested “sum of sines and cosines” form (and it mirrors what steady-state physics predicts).
                </div>
              </div>
            </article>
          </section>

          <!-- PART 2 -->
          <section id="part2">
            <article class="card">
              <div class="section-title">
                <h2>PART 2 — Strategy & Tips (roadmap only)</h2>
                <span class="tag">Plan before algebra</span>
              </div>

              <div class="callout">
                <b>Roadmap (5–10 steps)</b>
                <ol style="margin:8px 0 0 18px;color:var(--muted)">
                  <li><b>Normalize</b> each ODE into <span style="font-family:var(--mono)">ẋ + p(t)x = q(t)</span> by dividing by the coefficient of <span style="font-family:var(--mono)">ẋ</span>.</li>
                  <li><b>(a) Build integrating factor</b> <span style="font-family:var(--mono)">μ(t)=exp(∫p(t)dt)</span>.</li>
                  <li><b>(a) Convert to exact derivative</b>: show <span style="font-family:var(--mono)">(μx)̇ = μq(t)</span>.</li>
                  <li><b>(a) Integrate</b> once to obtain <span style="font-family:var(--mono)">μx</span>, then solve for <span style="font-family:var(--mono)">x</span>.</li>
                  <li><b>(b) Guess sinusoidal particular</b> <span style="font-family:var(--mono)">x_p=A cos(2t)+B sin(2t)</span>.</li>
                  <li><b>(b) Differentiate and substitute</b> into the ODE.</li>
                  <li><b>(b) Match coefficients</b> of <span style="font-family:var(--mono)">cos(2t)</span> and <span style="font-family:var(--mono)">sin(2t)</span> to solve for <span style="font-family:var(--mono)">A,B</span>.</li>
                  <li><b>Sanity checks</b>: verify by substitution; discuss behavior near <span style="font-family:var(--mono)">t=0</span> for (a) and steady-state meaning for (b).</li>
                </ol>
              </div>

              <div class="grid2" style="margin-top:12px">
                <div class="callout warn">
                  <b>Common mistakes</b>
                  <ul>
                    <li>For (a), forgetting to divide by <span style="font-family:var(--mono)">t</span> before identifying <span style="font-family:var(--mono)">p(t)=2/t</span>.</li>
                    <li>Dropping the <b>domain note</b>: the normalized equation uses <span style="font-family:var(--mono)">1/t</span>, so the solution is stated for <b>t≠0</b>.</li>
                    <li>For (b), guessing only <span style="font-family:var(--mono)">A cos(2t)</span> (you need both sine and cosine because the derivative shifts phase).</li>
                  </ul>
                </div>
                <div class="callout good">
                  <b>Quick tips</b>
                  <ul>
                    <li>When <span style="font-family:var(--mono)">p(t)=k/t</span>, the integrating factor often becomes a simple power: <span style="font-family:var(--mono)">μ=t^k</span>.</li>
                    <li>In driven first-order systems, the purely sinusoidal solution is the <b>steady-state</b>; any exponential term is a transient.</li>
                    <li>Always verify by plugging your answer back into the original ODE (fast check, high confidence).</li>
                  </ul>
                </div>
              </div>
            </article>
          </section>

          <!-- PART 3 -->
          <section id="part3">
            <article class="card">
              <div class="section-title">
                <h2>PART 3 — Full Solution</h2>
                <span class="tag">Derivation + checks</span>
              </div>

              <div class="callout">
                <b>Physical intuition (why these shapes make sense)</b>
                <ul>
                  <li>(a) The equation <span style="font-family:var(--mono)">t ẋ + 2x = t²</span> balances a “rate term” scaled by <span style="font-family:var(--mono)">t</span> with a “restoring” term <span style="font-family:var(--mono)">2x</span>. A polynomial forcing (<span style="font-family:var(--mono)">t²</span>) suggests a polynomial part of the solution, plus a decaying/growing homogeneous piece.</li>
                  <li>(b) In <span style="font-family:var(--mono)">ẋ + 2x = cos(2t)</span>, the system relaxes with timescale <span style="font-family:var(--mono)">1/2</span>. A sinusoidal input produces a sinusoidal output with a phase lag and reduced amplitude—exactly what we’ll compute.</li>
                </ul>
              </div>

              <h3 style="margin:14px 0 6px">4(a) Solve <span style="font-family:var(--mono)">t ẋ + 2x = t²</span></h3>

              <div class="eq">
                <pre><b>Step 1: Normalize to standard linear form</b>
Given:   t ẋ + 2x = t²
Divide by t (t≠0):   ẋ + (2/t) x = t</pre>
                <div class="copyRow">
                  <button data-copy="ẋ + (2/t) x = t  (t≠0)">Copy normalized form</button>
                </div>
              </div>

              <div class="eq">
                <pre><b>Step 2: Integrating factor</b>
p(t) = 2/t
μ(t) = exp(∫ p(t) dt) = exp(∫ 2/t dt) = exp(2 ln|t|) = t²   (up to a constant factor)</pre>
                <div class="copyRow">
                  <button class="btn2" data-copy="μ(t)=t^2">Copy integrating factor</button>
                </div>
              </div>

              <div class="eq">
                <pre><b>Step 3: Multiply the ODE by μ(t)=t² and recognize an exact derivative</b>
t² ẋ + 2t x = t³

But (t² x)̇ = t² ẋ + 2t x

So:   (t² x)̇ = t³</pre>
                <div class="copyRow">
                  <button data-copy="(t^2 x)̇ = t^3">Copy exact-derivative form</button>
                </div>
              </div>

              <div class="eq">
                <pre><b>Step 4: Integrate and solve for x(t)</b>
(t² x)̇ = t³
Integrate:  t² x = ∫ t³ dt = t⁴/4 + C
Therefore:  x(t) = t²/4 + C/t²   (t≠0)</pre>
              </div>

              <div class="boxFinal">
                <h3>Final answer (a)</h3>
                <div class="eq" style="margin:0">
                  <pre>x(t) = t^2/4 + C/t^2,   valid for t ≠ 0.</pre>
                </div>
                <div class="copyRow">
                  <button class="btn2" data-copy="x(t)=t^2/4 + C/t^2  (t≠0)">Copy final (a)</button>
                </div>
              </div>

              <h3 style="margin:18px 0 6px">4(b) Find a sinusoidal solution of <span style="font-family:var(--mono)">ẋ + 2x = cos(2t)</span></h3>

              <div class="callout">
                <b>Key idea:</b> A purely sinusoidal (steady-state) response must be a combination of
                <span style="font-family:var(--mono)">cos(2t)</span> and <span style="font-family:var(--mono)">sin(2t)</span>,
                because differentiating shifts phase by 90°.
              </div>

              <div class="eq">
                <pre><b>Step 1: Guess a sinusoidal particular solution</b>
Let   x_p(t) = A cos(2t) + B sin(2t)

Then ẋ_p(t) = -2A sin(2t) + 2B cos(2t)</pre>
              </div>

              <div class="eq">
                <pre><b>Step 2: Substitute into ẋ + 2x = cos(2t)</b>
ẋ_p + 2x_p
= (-2A sin(2t) + 2B cos(2t)) + 2(A cos(2t) + B sin(2t))
= (2B + 2A) cos(2t) + (-2A + 2B) sin(2t)

We need this to equal 1·cos(2t) + 0·sin(2t).</pre>
              </div>

              <div class="eq">
                <pre><b>Step 3: Match coefficients and solve for A, B</b>
Cosine:  2A + 2B = 1
Sine:   -2A + 2B = 0

From sine: 2B = 2A  ⇒  B = A
Plug into cosine: 2A + 2A = 1  ⇒  4A = 1  ⇒  A = 1/4
Thus B = 1/4.</pre>
              </div>

              <div class="eq">
                <pre><b>Step 4: Write the sinusoidal solution</b>
x_sin(t) = x_p(t) = (1/4) cos(2t) + (1/4) sin(2t)
         = (1/4)(cos(2t) + sin(2t))</pre>
              </div>

              <div class="boxFinal">
                <h3>Final answer (b)</h3>
                <div class="eq" style="margin:0">
                  <pre>x_sin(t) = (1/4)cos(2t) + (1/4)sin(2t).</pre>
                </div>
                <div class="copyRow">
                  <button class="btn2" data-copy="x_sin(t)=(1/4)cos(2t) + (1/4)sin(2t)">Copy final (b)</button>
                </div>
              </div>

              <div class="callout" style="margin-top:12px">
                <b>Extra (context): full general solution for (b)</b><br/>
                The homogeneous solution of <span style="font-family:var(--mono)">ẋ + 2x = 0</span> is <span style="font-family:var(--mono)">x_h = Ce^{-2t}</span>.
                So the general solution is <span style="font-family:var(--mono)">x(t)=Ce^{-2t} + x_sin(t)</span>. The question specifically asks for the purely sinusoidal part <span style="font-family:var(--mono)">x_sin</span>.
              </div>

              <div class="grid2" style="margin-top:12px">
                <div class="callout good">
                  <b>Sanity checks</b>
                  <ul>
                    <li><b>Substitution check (a):</b> Differentiate <span style="font-family:var(--mono)">t²/4 + C/t²</span>, plug into <span style="font-family:var(--mono)">t ẋ + 2x</span>, and the <span style="font-family:var(--mono)">C</span> terms cancel, leaving <span style="font-family:var(--mono)">t²</span>.</li>
                    <li><b>Substitution check (b):</b> Plug <span style="font-family:var(--mono)">(1/4)(cos2t+sin2t)</span> into <span style="font-family:var(--mono)">ẋ + 2x</span> to recover <span style="font-family:var(--mono)">cos2t</span>.</li>
                  </ul>
                </div>
                <div class="callout warn">
                  <b>Units, limits, interpretation</b>
                  <ul>
                    <li><b>Units:</b> Here time is dimensionless (as written). If time had units, then “2” would carry <span style="font-family:var(--mono)">1/time</span> units, and consistency would constrain units of <span style="font-family:var(--mono)">x</span>.</li>
                    <li><b>Limit in (a):</b> As <span style="font-family:var(--mono)">|t|→∞</span>, <span style="font-family:var(--mono)">x ~ t²/4</span> dominates; as <span style="font-family:var(--mono)">t→0</span>, the term <span style="font-family:var(--mono)">C/t²</span> can blow up unless <span style="font-family:var(--mono)">C=0</span>.</li>
                    <li><b>Steady-state in (b):</b> The sinusoidal solution is what remains after the transient <span style="font-family:var(--mono)">Ce^{-2t}</span> dies out.</li>
                  </ul>
                </div>
              </div>

            </article>
          </section>

          <!-- VISUALIZATION -->
          <section id="viz">
            <article class="card">
              <div class="section-title">
                <h2>Interactive Visualizations</h2>
                <span class="tag">Canvas + live controls</span>
              </div>

              <div class="callout">
                We keep the symbolic solutions from the math. For plotting we choose <b>example values</b> you can change:
                <ul>
                  <li>Part (a): choose the integration constant <b>C</b> and visualize <span style="font-family:var(--mono)">x(t)=t²/4 + C/t²</span> (for <span style="font-family:var(--mono)">t&gt;0</span>).</li>
                  <li>Part (b): we slightly generalize to <span style="font-family:var(--mono)">ẋ + 2x = cos(ωt)</span> to sweep frequency; set <b>ω=2</b> to match the original problem.</li>
                </ul>
              </div>

              <div class="controls">
                <div class="ctrl">
                  <label>
                    <span>Part (a) constant <b>C</b> (example)</span>
                    <output id="outC">1.00</output>
                  </label>
                  <input id="sliderC" type="range" min="-6" max="6" step="0.01" value="1" />
                  <div style="color:var(--faint);font-size:.86rem;margin-top:6px">
                    Domain shown: <span style="font-family:var(--mono)">t ∈ [0.35, 6]</span> (avoid <span style="font-family:var(--mono)">t=0</span> singularity).
                  </div>
                </div>

                <div class="ctrl">
                  <label>
                    <span>Forcing frequency <b>ω</b> in <span style="font-family:var(--mono)">cos(ωt)</span></span>
                    <output id="outW">2.00</output>
                  </label>
                  <input id="sliderW" type="range" min="0" max="8" step="0.01" value="2" />
                  <div style="color:var(--faint);font-size:.86rem;margin-top:6px">
                    Note: the problem uses <span style="font-family:var(--mono)">ω=2</span>. We sweep ω to visualize amplitude/phase behavior.
                  </div>
                </div>

                <div class="ctrl">
                  <label>
                    <span>Show (b) transient term <span style="font-family:var(--mono)">Ce^{-2t}</span></span>
                    <output id="outTransient">On</output>
                  </label>
                  <select id="selTransient">
                    <option value="on" selected>On (full response)</option>
                    <option value="off">Off (pure sinusoid only)</option>
                  </select>
                  <div style="color:var(--faint);font-size:.86rem;margin-top:6px">
                    Transient amplitude uses the same <b>C</b> slider (example) for convenience.
                  </div>
                </div>

                <div class="ctrl">
                  <label>
                    <span>Time window (seconds, example)</span>
                    <output id="outTmax">12.0</output>
                  </label>
                  <input id="sliderTmax" type="range" min="4" max="24" step="0.1" value="12" />
                  <div style="color:var(--faint);font-size:.86rem;margin-top:6px">
                    Updates both time-series plots.
                  </div>
                </div>
              </div>

              <div class="grid2" style="margin-top:12px">
                <figure class="canvasWrap canvasSmall">
                  <canvas id="diagram"></canvas>
                  <figcaption class="figCap">
                    <b>Diagram:</b> A first-order “relaxation” system (physics analogy).
                    Input drives the state <span style="font-family:var(--mono)">x(t)</span>; the term <span style="font-family:var(--mono)">ẋ + 2x</span> acts like a 1-pole filter.
                  </figcaption>
                </figure>

                <figure class="canvasWrap canvasSmall">
                  <canvas id="freqPlot"></canvas>
                  <figcaption class="figCap">
                    <b>Secondary plot:</b> Frequency sweep for the generalized steady-state solution of
                    <span style="font-family:var(--mono)">ẋ+2x=cos(ωt)</span>.
                    Shows <b>amplitude</b> and <b>phase lag</b> vs ω; the slider picks ω.
                  </figcaption>
                </figure>
              </div>

              <figure class="canvasWrap" style="margin-top:12px">
                <canvas id="timePlot"></canvas>
                <figcaption class="figCap">
                  <b>Main plot:</b> Time-domain solutions.
                  Left axis shows <span style="font-family:var(--mono)">x(t)</span>. We overlay:
                  <span style="font-family:var(--mono)">x_a(t)=t²/4 + C/t²</span> (part a) and
                  <span style="font-family:var(--mono)">x_b(t)</span> for part (b) (pure sinusoid or full response).
                </figcaption>
              </figure>

              <div class="eq" style="margin-top:12px">
                <pre><b>Key equations used in the plots</b>
(a)  x_a(t) = t^2/4 + C/t^2   (t>0 shown)

(b-generalized for sweep)  ẋ + 2x = cos(ω t)

Steady-state sinusoid:  x_s(t) = A(ω) cos(ω t) + B(ω) sin(ω t)
with  A(ω)= 2/(ω^2+4),   B(ω)= ω/(ω^2+4)

For the original problem (ω=2):  A=B=1/4  ⇒  x_s(t)=(1/4)(cos(2t)+sin(2t))</pre>
                <div class="copyRow">
                  <button data-copy="(a) x_a(t)=t^2/4 + C/t^2 (t≠0)">Copy plot eqn (a)</button>
                  <button class="btn2" data-copy="A(ω)=2/(ω^2+4),  B(ω)=ω/(ω^2+4)">Copy A(ω),B(ω)</button>
                </div>
              </div>
            </article>
          </section>

          <footer class="wrap">
            Built with vanilla HTML/CSS/JS. Copy buttons copy plain text. Canvases are high-DPI and responsive.
          </footer>
        </div>
      </main>
    </div>
  </header>

  <script>
    // ---------- Copy buttons ----------
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed';
      t.style.left='50%';
      t.style.bottom='16px';
      t.style.transform='translateX(-50%)';
      t.style.padding='10px 12px';
      t.style.border='1px solid rgba(255,255,255,.18)';
      t.style.background='rgba(0,0,0,.55)';
      t.style.color='white';
      t.style.borderRadius='12px';
      t.style.zIndex='9999';
      t.style.backdropFilter='blur(8px)';
      t.style.boxShadow='0 16px 40px rgba(0,0,0,.25)';
      t.style.fontWeight='650';
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.transition='opacity .25s ease, transform .25s ease'; t.style.opacity='0'; t.style.transform='translateX(-50%) translateY(6px)'; }, 900);
      setTimeout(()=>t.remove(), 1250);
    }

    document.addEventListener('click', async (e)=>{
      const btn = e.target.closest('button[data-copy]');
      if(!btn) return;
      const text = btn.getAttribute('data-copy') || '';
      try{
        await navigator.clipboard.writeText(text);
        toast('Copied ✓');
      }catch(err){
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        toast('Copied ✓');
      }
    });

    // ---------- Canvas utilities ----------
    function setupCanvas(canvas){
      const ctx = canvas.getContext('2d');
      function resize(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const rect = canvas.getBoundingClientRect();
        canvas.width = Math.round(rect.width * dpr);
        canvas.height = Math.round(rect.height * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
        return {w: rect.width, h: rect.height, dpr};
      }
      return {ctx, resize};
    }

    function lerp(a,b,t){ return a + (b-a)*t; }

    function niceStep(range){
      // choose tick spacing ~ range/6 with 1-2-5 scaling
      const raw = Math.abs(range)/6;
      if(raw === 0) return 1;
      const p = Math.pow(10, Math.floor(Math.log10(raw)));
      const m = raw / p;
      let s;
      if(m < 1.5) s = 1;
      else if(m < 3.5) s = 2;
      else if(m < 7.5) s = 5;
      else s = 10;
      return s*p;
    }

    function drawAxes(ctx, box, xMin,xMax,yMin,yMax, opts){
      const {x=0,y=0,w=300,h=200} = box;
      const padL = opts?.padL ?? 54;
      const padR = opts?.padR ?? 16;
      const padT = opts?.padT ?? 28;
      const padB = opts?.padB ?? 44;

      const plot = {x: x+padL, y: y+padT, w: w-padL-padR, h: h-padT-padB};

      // background
      ctx.save();
      ctx.clearRect(x,y,w,h);

      // Title
      if(opts?.title){
        ctx.fillStyle = opts.titleColor || getCSS('--text');
        ctx.font = `600 14px ${getCSS('--sans')}`;
        ctx.fillText(opts.title, x+padL, y+18);
      }

      // frame
      ctx.strokeStyle = getCSS('--line');
      ctx.lineWidth = 1;
      roundRect(ctx, plot.x, plot.y, plot.w, plot.h, 12);
      ctx.stroke();

      // ticks/grid
      const xStep = niceStep(xMax-xMin);
      const yStep = niceStep(yMax-yMin);

      ctx.font = `12px ${getCSS('--mono')}`;
      ctx.fillStyle = getCSS('--muted');

      // gridlines
      ctx.strokeStyle = alpha(getCSS('--line'), 0.85);
      ctx.lineWidth = 1;

      // x ticks
      for(let xv = Math.ceil(xMin/xStep)*xStep; xv <= xMax+1e-9; xv += xStep){
        const px = plot.x + (xv-xMin)/(xMax-xMin)*plot.w;
        ctx.beginPath();
        ctx.moveTo(px, plot.y);
        ctx.lineTo(px, plot.y+plot.h);
        ctx.stroke();

        ctx.fillText(trimNum(xv), px-10, plot.y+plot.h+18);
        ctx.beginPath();
        ctx.moveTo(px, plot.y+plot.h);
        ctx.lineTo(px, plot.y+plot.h+6);
        ctx.stroke();
      }

      // y ticks
      for(let yv = Math.ceil(yMin/yStep)*yStep; yv <= yMax+1e-9; yv += yStep){
        const py = plot.y + plot.h - (yv-yMin)/(yMax-yMin)*plot.h;
        ctx.beginPath();
        ctx.moveTo(plot.x, py);
        ctx.lineTo(plot.x+plot.w, py);
        ctx.stroke();

        ctx.fillText(trimNum(yv), plot.x-44, py+4);
        ctx.beginPath();
        ctx.moveTo(plot.x-6, py);
        ctx.lineTo(plot.x, py);
        ctx.stroke();
      }

      // axis labels
      ctx.fillStyle = getCSS('--muted');
      ctx.font = `600 12px ${getCSS('--sans')}`;
      if(opts?.xLabel){
        ctx.fillText(opts.xLabel, plot.x + plot.w - 10 - ctx.measureText(opts.xLabel).width, plot.y+plot.h+36);
      }
      if(opts?.yLabel){
        ctx.save();
        ctx.translate(plot.x-46, plot.y+14);
        ctx.rotate(-Math.PI/2);
        ctx.fillText(opts.yLabel, 0, 0);
        ctx.restore();
      }

      ctx.restore();

      function xMap(xv){ return plot.x + (xv-xMin)/(xMax-xMin)*plot.w; }
      function yMap(yv){ return plot.y + plot.h - (yv-yMin)/(yMax-yMin)*plot.h; }
      return {plot, xMap, yMap};
    }

    function roundRect(ctx,x,y,w,h,r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    function alpha(color, a){
      // color is "rgba(...)" or "rgb(...)" or hex; handle rgb/rgba
      const m = color.match(/rgba?\(([^)]+)\)/);
      if(m){
        const parts = m[1].split(',').map(s=>s.trim());
        const r = parts[0], g=parts[1], b=parts[2];
        return `rgba(${r},${g},${b},${a})`;
      }
      return color;
    }

    function getCSS(varName){
      return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }

    function trimNum(v){
      const av = Math.abs(v);
      if(av >= 100) return v.toFixed(0);
      if(av >= 10) return v.toFixed(1).replace(/\.0$/,'');
      if(av >= 1) return v.toFixed(2).replace(/0$/,'').replace(/\.0$/,'');
      return v.toFixed(3).replace(/0+$/,'').replace(/\.$/,'');
    }

    function drawLine(ctx, pts, stroke, width){
      ctx.save();
      ctx.strokeStyle = stroke;
      ctx.lineWidth = width;
      ctx.beginPath();
      for(let i=0;i<pts.length;i++){
        const p = pts[i];
        if(i===0) ctx.moveTo(p.x,p.y);
        else ctx.lineTo(p.x,p.y);
      }
      ctx.stroke();
      ctx.restore();
    }

    function drawLegend(ctx, x, y, items){
      ctx.save();
      ctx.font = `12px ${getCSS('--sans')}`;
      const pad = 8;
      const lineH = 18;
      let w = 0;
      for(const it of items){
        const tw = ctx.measureText(it.label).width;
        w = Math.max(w, tw);
      }
      const boxW = w + 62;
      const boxH = items.length*lineH + 2*pad;

      ctx.fillStyle = alpha(getCSS('--panel2'), 1);
      ctx.strokeStyle = getCSS('--line');
      roundRect(ctx, x, y, boxW, boxH, 12);
      ctx.fill();
      ctx.stroke();

      for(let i=0;i<items.length;i++){
        const yy = y + pad + i*lineH + 12;
        ctx.strokeStyle = items[i].color;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(x+12, yy-4);
        ctx.lineTo(x+32, yy-4);
        ctx.stroke();
        ctx.fillStyle = getCSS('--muted');
        ctx.fillText(items[i].label, x+40, yy);
      }
      ctx.restore();
    }

    // ---------- Math models (used by plots) ----------
    // Part (a): x_a(t)=t^2/4 + C/t^2 (for t≠0)
    function x_a(t, C){ return (t*t)/4 + C/(t*t); }

    // Part (b) generalized for visualization:
    // Solve ẋ + 2x = cos(ω t)
    // Particular sinusoid: x_s = A cos(ωt) + B sin(ωt)
    // Matching coefficients gives:
    // A = 2/(ω^2+4), B = ω/(ω^2+4)
    function A_of_w(w){ return 2/(w*w + 4); }
    function B_of_w(w){ return w/(w*w + 4); }
    function x_s(t,w){ return A_of_w(w)*Math.cos(w*t) + B_of_w(w)*Math.sin(w*t); }
    function x_full(t,w,C,showTransient){
      const trans = showTransient ? C*Math.exp(-2*t) : 0;
      return trans + x_s(t,w);
    }
    function amp_of_w(w){
      // amplitude of A cos + B sin is sqrt(A^2+B^2) = sqrt(4+w^2)/(w^2+4) = 1/sqrt(w^2+4)
      return 1/Math.sqrt(w*w + 4);
    }
    function phase_lag_of_w(w){
      // write x_s = R cos(ωt - φ), with φ = atan2(B, A) (because R cos(ωt-φ)=R(cosωt cosφ + sinωt sinφ))
      // so A = R cosφ, B = R sinφ  => φ = atan2(B,A). This φ is the lag relative to cos(ωt).
      return Math.atan2(B_of_w(w), A_of_w(w)); // radians
    }

    // ---------- Draw diagram ----------
    const diagram = setupCanvas(document.getElementById('diagram'));
    function drawDiagram(){
      const {ctx, resize} = diagram;
      const {w,h} = resize();

      // background
      ctx.clearRect(0,0,w,h);

      // Title
      ctx.fillStyle = getCSS('--text');
      ctx.font = `600 14px ${getCSS('--sans')}`;
      ctx.fillText('First-order system analogy (like an RC low-pass)', 16, 20);

      // Node layout
      const x0 = 24, y0 = 62;
      const boxW = Math.min(300, w-48), boxH = 70;

      // Input block
      ctx.strokeStyle = getCSS('--line');
      ctx.fillStyle = alpha(getCSS('--panel2'), 1);
      roundRect(ctx, x0, y0+30, 150, 50, 14);
      ctx.fill(); ctx.stroke();

      ctx.fillStyle = getCSS('--muted');
      ctx.font = `600 12px ${getCSS('--sans')}`;
      ctx.fillText('Input', x0+14, y0+56);
      ctx.font = `12px ${getCSS('--mono')}`;
      ctx.fillText('u(t)=cos(ωt)', x0+14, y0+76);

      // Arrow to system
      const midY = y0+55;
      const ax1 = x0+156, ax2 = x0+220;
      arrow(ctx, ax1, midY, ax2, midY, getCSS('--accent'));

      // System block
      const sx = x0+224, sy = y0+20, sw = Math.min(320, w-(x0+224)-24), sh = 70;
      roundRect(ctx, sx, sy, sw, sh, 16);
      ctx.fillStyle = alpha(getCSS('--panel2'), 1);
      ctx.fill();
      ctx.strokeStyle = getCSS('--line');
      ctx.stroke();

      ctx.fillStyle = getCSS('--muted');
      ctx.font = `600 12px ${getCSS('--sans')}`;
      ctx.fillText('Dynamics', sx+14, sy+24);
      ctx.font = `12px ${getCSS('--mono')}`;
      ctx.fillText('ẋ + 2x = u(t)', sx+14, sy+44);
      ctx.fillStyle = getCSS('--faint');
      ctx.font = `12px ${getCSS('--sans')}`;
      ctx.fillText('(steady-state is sinusoidal)', sx+14, sy+64);

      // Output arrow
      const ox1 = sx+sw+6, ox2 = w-24;
      arrow(ctx, ox1, midY, ox2, midY, getCSS('--accent2'));

      // Output label
      ctx.fillStyle = getCSS('--muted');
      ctx.font = `600 12px ${getCSS('--sans')}`;
      ctx.fillText('Output x(t)', Math.max(ox2-120, sx+sw+10), midY-10);
      ctx.fillStyle = getCSS('--faint');
      ctx.font = `12px ${getCSS('--mono')}`;
      ctx.fillText('~ R cos(ωt − φ)', Math.max(ox2-140, sx+sw+10), midY+10);

      // Small note about part (a)
      ctx.fillStyle = getCSS('--muted');
      ctx.font = `600 12px ${getCSS('--sans')}`;
      ctx.fillText('Part (a) uses integrating factor (variable coefficient)', 16, h-18);

      function arrow(ctx, x1,y1,x2,y2,color){
        ctx.save();
        ctx.strokeStyle = color;
        ctx.fillStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();
        const ang = Math.atan2(y2-y1, x2-x1);
        const L = 10;
        ctx.beginPath();
        ctx.moveTo(x2,y2);
        ctx.lineTo(x2 - L*Math.cos(ang - Math.PI/7), y2 - L*Math.sin(ang - Math.PI/7));
        ctx.lineTo(x2 - L*Math.cos(ang + Math.PI/7), y2 - L*Math.sin(ang + Math.PI/7));
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }
    }

    // ---------- Draw frequency sweep ----------
    const freqPlot = setupCanvas(document.getElementById('freqPlot'));
    function drawFreq(wSel){
      const {ctx, resize} = freqPlot;
      const {w,h} = resize();

      // two stacked "tracks" inside one plot area by using normalized y for amplitude and phase
      // We'll map amplitude to y in top half and phase (degrees) in bottom half.
      // For clean axes, we'll use a single coordinate system with y spanning [-180, 1] by scaling.
      // Instead, keep it simple: draw axes for amplitude (top) and phase (bottom) manually.

      ctx.clearRect(0,0,w,h);

      // Define sub-panels
      const pad = {L:54, R:16, T:28, B:20};
      const gap = 18;
      const panelH = (h - pad.T - pad.B - gap)/2;
      const panelW = w - pad.L - pad.R;
      const x0 = pad.L, y0 = pad.T;

      // Titles
      ctx.fillStyle = getCSS('--text');
      ctx.font = `600 14px ${getCSS('--sans')}`;
      ctx.fillText('Frequency response (steady-state)', pad.L, 18);

      // x range
      const wMin = 0, wMax = 8;

      function xMap(ww){ return x0 + (ww-wMin)/(wMax-wMin)*panelW; }

      // --- Amplitude panel (top) ---
      const aMin = 0, aMax = 0.55; // since 1/sqrt(4)=0.5 at ω=0
      function yMapA(a){ return y0 + panelH - (a-aMin)/(aMax-aMin)*panelH; }

      // frame & grid
      drawFrameAndGrid(ctx, x0, y0, panelW, panelH, wMin,wMax, aMin,aMax, 'ω (rad/s)', 'Amplitude |X|', true);

      // curve
      const ptsA = [];
      const N = 260;
      for(let i=0;i<=N;i++){
        const ww = lerp(wMin,wMax,i/N);
        const a = amp_of_w(ww);
        ptsA.push({x:xMap(ww), y:yMapA(a)});
      }
      drawLine(ctx, ptsA, getCSS('--accent'), 2.6);

      // marker at selected ω
      const aSel = amp_of_w(wSel);
      const xSel = xMap(wSel), ySel = yMapA(aSel);
      dot(ctx, xSel, ySel, getCSS('--accent'), 5);
      label(ctx, xSel+8, ySel-8, `|X|=${trimNum(aSel)}`, getCSS('--muted'));

      // --- Phase panel (bottom) ---
      const y1 = y0 + panelH + gap;
      const pMin = 0, pMax = 90; // φ in degrees: atan(ω/2) goes from 0 to 90
      function yMapP(deg){ return y1 + panelH - (deg-pMin)/(pMax-pMin)*panelH; }

      drawFrameAndGrid(ctx, x0, y1, panelW, panelH, wMin,wMax, pMin,pMax, 'ω (rad/s)', 'Phase lag φ (deg)', false);

      const ptsP = [];
      for(let i=0;i<=N;i++){
        const ww = lerp(wMin,wMax,i/N);
        const deg = phase_lag_of_w(ww) * 180/Math.PI;
        ptsP.push({x:xMap(ww), y:yMapP(deg)});
      }
      drawLine(ctx, ptsP, getCSS('--accent2'), 2.6);

      const pSel = phase_lag_of_w(wSel) * 180/Math.PI;
      const yp = yMapP(pSel);
      dot(ctx, xSel, yp, getCSS('--accent2'), 5);
      label(ctx, xSel+8, yp-8, `φ=${trimNum(pSel)}°`, getCSS('--muted'));

      // legend
      drawLegend(ctx, w-190, 36, [
        {label:'Amplitude |X|', color:getCSS('--accent')},
        {label:'Phase lag φ', color:getCSS('--accent2')}
      ]);

      // helper drawing
      function drawFrameAndGrid(ctx, x,y,w,h, xMin,xMax, yMin,yMax, xLabel,yLabel, showTitleLine){
        ctx.save();
        // frame
        ctx.strokeStyle = getCSS('--line');
        ctx.lineWidth = 1;
        roundRect(ctx, x, y, w, h, 12);
        ctx.stroke();

        // grid
        const xStep = niceStep(xMax-xMin);
        const yStep = niceStep(yMax-yMin);

        ctx.strokeStyle = alpha(getCSS('--line'), 0.85);
        ctx.lineWidth = 1;
        ctx.font = `12px ${getCSS('--mono')}`;
        ctx.fillStyle = getCSS('--muted');

        for(let xv = Math.ceil(xMin/xStep)*xStep; xv<=xMax+1e-9; xv+=xStep){
          const px = x + (xv-xMin)/(xMax-xMin)*w;
          ctx.beginPath(); ctx.moveTo(px,y); ctx.lineTo(px,y+h); ctx.stroke();
          ctx.fillText(trimNum(xv), px-10, y+h+14);
        }
        for(let yv = Math.ceil(yMin/yStep)*yStep; yv<=yMax+1e-9; yv+=yStep){
          const py = y + h - (yv-yMin)/(yMax-yMin)*h;
          ctx.beginPath(); ctx.moveTo(x,py); ctx.lineTo(x+w,py); ctx.stroke();
          ctx.fillText(trimNum(yv), x-44, py+4);
        }

        // labels
        ctx.font = `600 12px ${getCSS('--sans')}`;
        ctx.fillStyle = getCSS('--muted');
        ctx.fillText(xLabel, x+w-ctx.measureText(xLabel).width, y+h+30);
        ctx.save();
        ctx.translate(x-46, y+14);
        ctx.rotate(-Math.PI/2);
        ctx.fillText(yLabel, 0, 0);
        ctx.restore();

        ctx.restore();
      }

      function dot(ctx,x,y,color,r){
        ctx.save();
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x,y,r,0,Math.PI*2);
        ctx.fill();
        ctx.restore();
      }
      function label(ctx,x,y,text,color){
        ctx.save();
        ctx.fillStyle = color;
        ctx.font = `12px ${getCSS('--mono')}`;
        ctx.fillText(text,x,y);
        ctx.restore();
      }
    }

    // ---------- Draw time plot ----------
    const timePlot = setupCanvas(document.getElementById('timePlot'));
    function drawTime(C, wSel, tMax, showTransient){
      const {ctx, resize} = timePlot;
      const {w,h} = resize();

      // Time domain from tMin to tMax. For part (a) avoid 0:
      const tMin = 0.0;

      // sample
      const N = 800;
      const dataA = [];
      const dataB = [];

      // Choose y-range by scanning (robust with clamping)
      let yMin = Infinity, yMax = -Infinity;

      for(let i=0;i<=N;i++){
        const t = lerp(tMin, tMax, i/N);

        // Part (a): only meaningful for t>0; clamp below 0.35
        const ta = Math.max(0.35, t);
        const xa = x_a(ta, C);

        // Part (b): show from 0..tMax
        const xb = x_full(t, wSel, C, showTransient);

        yMin = Math.min(yMin, xa, xb);
        yMax = Math.max(yMax, xa, xb);

        dataA.push({t: t, x: xa});
        dataB.push({t: t, x: xb});
      }

      // pad y range
      const pad = 0.12*(yMax-yMin || 1);
      yMin -= pad; yMax += pad;

      const axes = drawAxes(ctx, {x:0,y:0,w,h}, tMin, tMax, yMin, yMax, {
        title: 'Time-domain solutions (example parameters)',
        xLabel: 't (s)',
        yLabel: 'x(t) (arb. units)'
      });

      // convert to pixel points
      const ptsA = dataA.map(p => ({x: axes.xMap(p.t), y: axes.yMap(p.x)}));
      const ptsB = dataB.map(p => ({x: axes.xMap(p.t), y: axes.yMap(p.x)}));

      // draw curves
      drawLine(ctx, ptsA, getCSS('--accent'), 2.4);
      drawLine(ctx, ptsB, getCSS('--accent2'), 2.4);

      // Legend
      const legItems = [
        {label:'(a) x_a(t)=t²/4 + C/t²', color:getCSS('--accent')},
        {label: showTransient ? '(b) x_b(t)=x_s(t)+C e^{-2t}' : '(b) x_s(t) (pure sinusoid)', color:getCSS('--accent2')}
      ];
      drawLegend(ctx, 14, 36, legItems);

      // annotate ω and C
      ctx.save();
      ctx.fillStyle = getCSS('--muted');
      ctx.font = `12px ${getCSS('--mono')}`;
      const note = `C=${trimNum(C)},  ω=${trimNum(wSel)} rad/s`;
      ctx.fillText(note, axes.plot.x + 10, axes.plot.y + 18);
      ctx.restore();

      // mark a point at t=tMax*0.8 for b
      const tm = 0.8*tMax;
      const xm = x_full(tm, wSel, C, showTransient);
      const px = axes.xMap(tm), py = axes.yMap(xm);
      ctx.save();
      ctx.fillStyle = getCSS('--accent2');
      ctx.beginPath(); ctx.arc(px,py,4.5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = getCSS('--muted');
      ctx.font = `12px ${getCSS('--mono')}`;
      ctx.fillText(`x_b(${trimNum(tm)})=${trimNum(xm)}`, px+8, py-8);
      ctx.restore();
    }

    // ---------- Controls & render loop ----------
    const sliderC = document.getElementById('sliderC');
    const sliderW = document.getElementById('sliderW');
    const sliderTmax = document.getElementById('sliderTmax');
    const selTransient = document.getElementById('selTransient');

    const outC = document.getElementById('outC');
    const outW = document.getElementById('outW');
    const outTmax = document.getElementById('outTmax');
    const outTransient = document.getElementById('outTransient');

    function readState(){
      const C = parseFloat(sliderC.value);
      const wSel = parseFloat(sliderW.value);
      const tMax = parseFloat(sliderTmax.value);
      const showTransient = (selTransient.value === 'on');
      return {C, wSel, tMax, showTransient};
    }

    function updateLabels(state){
      outC.textContent = state.C.toFixed(2);
      outW.textContent = state.wSel.toFixed(2);
      outTmax.textContent = state.tMax.toFixed(1);
      outTransient.textContent = state.showTransient ? 'On' : 'Off';
    }

    function render(){
      const state = readState();
      updateLabels(state);

      drawDiagram();
      drawFreq(state.wSel);
      drawTime(state.C, state.wSel, state.tMax, state.showTransient);
    }

    ['input','change'].forEach(evt=>{
      sliderC.addEventListener(evt, render);
      sliderW.addEventListener(evt, render);
      sliderTmax.addEventListener(evt, render);
      selTransient.addEventListener(evt, render);
    });

    window.addEventListener('resize', render);

    // initial draw
    render();
  </script>
</body>
</html>
