<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>First-Order Linear ODE: ẋ + 3x = e^{2t} and ẋ + 3x = cos(2t)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#101a33;
      --panel2:#0f1830;
      --text:#e9eefc;
      --muted:#b8c2e6;
      --accent:#79d2ff;
      --accent2:#a7ffb3;
      --danger:#ff6b6b;
      --warn:#ffd166;
      --ok:#8cffc1;
      --border:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --radius:18px;
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f9ff;
        --panel:#ffffff;
        --panel2:#ffffff;
        --text:#121629;
        --muted:#42507a;
        --accent:#0b74ff;
        --accent2:#15803d;
        --danger:#c1121f;
        --warn:#b45309;
        --ok:#166534;
        --border:rgba(10,20,40,.12);
        --shadow: 0 10px 30px rgba(18,22,41,.10);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 20% 0%, rgba(121,210,255,.18), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(167,255,179,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
      line-height:1.55;
    }

    header{
      padding:28px 18px 14px;
      max-width:1100px;
      margin:0 auto;
    }
    .title{
      display:grid;
      gap:10px;
      align-items:start;
    }
    h1{
      margin:0;
      font-size:clamp(1.4rem, 2.4vw, 2.1rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      font-size:1rem;
      max-width:78ch;
    }

    main{
      max-width:1100px;
      margin:0 auto;
      padding: 0 18px 40px;
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr;}
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .card .hd h2, .card .hd h3{
      margin:0;
      font-size:1.05rem;
      letter-spacing:.2px;
    }
    .card .bd{
      padding:14px 16px 16px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      font-size:.9rem;
      color:var(--muted);
      background: rgba(255,255,255,.03);
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:9px;height:9px;border-radius:50%;
      background:var(--accent);
      box-shadow: 0 0 0 3px rgba(121,210,255,.15);
    }

    .quick ul{margin:10px 0 0 20px}
    .quick li{margin:6px 0}

    .toc{
      position:sticky;
      top:12px;
      align-self:start;
      padding:14px 14px 10px;
    }
    .toc nav a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid transparent;
      transition: .18s ease;
    }
    .toc nav a:hover{
      color:var(--text);
      border-color: var(--border);
      background: rgba(255,255,255,.03);
      transform: translateX(2px);
    }
    .toc small{color:var(--muted)}
    .toc .mini{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .section{
      scroll-margin-top: 84px;
    }

    .kicker{
      color:var(--muted);
      font-size:.95rem;
      margin:0 0 10px;
    }

    .callout{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius:16px;
      padding:12px 12px;
    }
    .callout strong{color:var(--text)}
    .callout .label{
      display:inline-flex;
      gap:8px; align-items:center;
      font-size:.9rem;
      color:var(--muted);
      margin-bottom:8px;
    }
    .callout .label .dot{background:var(--accent2); box-shadow: 0 0 0 3px rgba(167,255,179,.15);}

    .eq{
      position:relative;
      border:1px dashed rgba(121,210,255,.35);
      background: rgba(121,210,255,.06);
      border-radius:16px;
      padding:12px 44px 12px 12px;
      margin:10px 0;
      overflow:auto;
    }
    .eq code{
      font-family:var(--mono);
      font-size:.95rem;
      color:var(--text);
      white-space:pre;
    }
    .copyBtn{
      position:absolute;
      right:10px; top:10px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:6px 9px;
      border-radius:10px;
      cursor:pointer;
      transition:.18s ease;
      font-size:.85rem;
    }
    .copyBtn:hover{transform: translateY(-1px); border-color: rgba(121,210,255,.55);}
    .copyBtn:active{transform: translateY(0px) scale(.99);}

    .cols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 820px){
      .cols{grid-template-columns:1fr;}
    }

    .controls{
      display:grid;
      gap:10px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    .row{
      display:grid;
      grid-template-columns: 140px 1fr 110px;
      gap:10px;
      align-items:center;
    }
    @media (max-width: 560px){
      .row{grid-template-columns: 1fr; align-items:start;}
    }
    label{color:var(--muted); font-size:.92rem;}
    input[type="range"]{width:100%;}
    select, input[type="number"]{
      width:100%;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
    }
    input[type="number"]{font-family:var(--mono);}
    .val{
      text-align:right;
      color:var(--muted);
      font-family:var(--mono);
      font-size:.9rem;
    }
    @media (max-width: 560px){
      .val{text-align:left;}
    }

    figure{
      margin:0;
      padding:0;
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      background: rgba(0,0,0,.08);
      border-top:1px solid var(--border);
    }

    .steps ol{margin:8px 0 0 20px}
    .steps li{margin:8px 0}
    .muted{color:var(--muted)}
    .boxFinal{
      border:1px solid rgba(167,255,179,.45);
      background: rgba(167,255,179,.08);
      border-radius:16px;
      padding:12px;
      margin:12px 0;
      position:relative;
    }
    .boxFinal .tag{
      position:absolute;
      top:-10px; left:12px;
      background:var(--panel);
      border:1px solid rgba(167,255,179,.45);
      border-radius:999px;
      padding:4px 10px;
      font-size:.82rem;
      color:var(--muted);
    }

    footer{
      max-width:1100px;
      margin:0 auto;
      padding:18px;
      color:var(--muted);
      font-size:.9rem;
    }

    @media print{
      body{background:#fff;}
      .card{box-shadow:none;}
      .toc{display:none;}
      .copyBtn, .controls{display:none;}
      canvas{display:none;}
      a{color:inherit; text-decoration:none;}
    }

    /* subtle animation */
    @keyframes floatIn{
      from{opacity:0; transform: translateY(8px);}
      to{opacity:1; transform: translateY(0px);}
    }
    .card{animation: floatIn .35s ease both;}
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div class="pill"><span class="dot"></span><span>First-order linear system (ODE)</span></div>
      <h1>Solving <span style="font-family:var(--mono)">ẋ + 3x = e^{2t}</span> and <span style="font-family:var(--mono)">ẋ + 3x = cos(2t)</span></h1>
      <p class="subtitle">
        We treat the equation as a standard first-order linear “relaxation” model: a state <span style="font-family:var(--mono)">x(t)</span>
        driven by an input (forcing) with time constant <span style="font-family:var(--mono)">1/3</span>.
        You’ll get symbolic answers for parts (a)–(d) and an interactive visualization that lets you change parameters and see the dynamics.
      </p>
    </div>
  </header>

  <main>
    <div class="grid">
      <article class="card quick">
        <div class="hd">
          <h2>Quick Summary</h2>
          <span class="pill"><span class="dot" style="background:var(--accent2)"></span><span>Copy-ready results below</span></span>
        </div>
        <div class="bd">
          <ul>
            <li>For <span style="font-family:var(--mono)">ẋ + 3x = e^{2t}</span>, a particular solution is <span style="font-family:var(--mono)">x_p(t) = (1/5)e^{2t}</span>.</li>
            <li>General solution: <span style="font-family:var(--mono)">x(t)=Ce^{-3t} + (1/5)e^{2t}</span>.</li>
            <li>With <span style="font-family:var(--mono)">x(0)=1</span>: <span style="font-family:var(--mono)">x(t)= (4/5)e^{-3t} + (1/5)e^{2t}</span>.</li>
            <li>To make <span style="font-family:var(--mono)">cos(2t)</span> the real part: use complex forcing <span style="font-family:var(--mono)">e^{i2t}</span> on the RHS.</li>
            <li>For <span style="font-family:var(--mono)">ẋ + 3x = cos(2t)</span>, a particular solution is
              <span style="font-family:var(--mono)">(3/13)cos(2t) + (2/13)sin(2t)</span>.</li>
          </ul>

          <div class="cols">
            <div class="eq" data-copy="x_p(t) = (1/5) e^{2t}">
              <button class="copyBtn" aria-label="Copy equation">Copy</button>
              <code>ẋ + 3x = e^{2t}  ⇒  x_p(t) = (1/5) e^{2t}</code>
            </div>
            <div class="eq" data-copy="x(t) = (4/5) e^{-3t} + (1/5) e^{2t}">
              <button class="copyBtn" aria-label="Copy final answer">Copy</button>
              <code>x(0)=1  ⇒  x(t) = (4/5) e^{-3t} + (1/5) e^{2t}</code>
            </div>
          </div>

          <div class="eq" data-copy="x_p(t) = (3/13)cos(2t) + (2/13)sin(2t)">
            <button class="copyBtn" aria-label="Copy equation">Copy</button>
            <code>ẋ + 3x = cos(2t)  ⇒  x_p(t) = (3/13)cos(2t) + (2/13)sin(2t)</code>
          </div>
        </div>
      </article>

      <aside class="card toc" aria-label="Table of Contents">
        <div class="hd">
          <h3>Table of Contents</h3>
        </div>
        <div class="bd">
          <small class="muted">Sticky navigation</small>
          <nav>
            <a href="#part1">PART 1 — Problem Analysis</a>
            <a href="#part2">PART 2 — Strategy &amp; Tips</a>
            <a href="#part3">PART 3 — Full Solution</a>
            <a href="#viz">Interactive Visualizations</a>
          </nav>
          <div class="mini">
            <span class="pill"><span class="dot"></span>ODE</span>
            <span class="pill"><span class="dot" style="background:var(--warn)"></span>Forcing</span>
            <span class="pill"><span class="dot" style="background:var(--accent2)"></span>Response</span>
          </div>
        </div>
      </aside>
    </div>

    <section id="part1" class="card section">
      <div class="hd"><h2>PART 1 — Problem Analysis (no solving yet)</h2></div>
      <div class="bd">
        <p class="kicker">
          We are given a linear first-order differential equation. In physics and engineering, this is the canonical model for a
          <em>first-order system</em> (e.g., RC circuit voltage, thermal relaxation, overdamped motion) driven by an external input.
        </p>

        <div class="callout">
          <div class="label"><span class="dot"></span><strong>Rewrite the problem (in words)</strong></div>
          <p>
            (a) Find one specific function <span style="font-family:var(--mono)">x_p(t)</span> that satisfies <span style="font-family:var(--mono)">ẋ + 3x = e^{2t}</span>.
            <br/>
            (b) Find the unique solution of the same equation that also obeys the initial condition <span style="font-family:var(--mono)">x(0)=1</span>.
            <br/>
            (c) Replace <span style="font-family:var(--mono)">cos(2t)</span> by a complex exponential so that its real part reproduces the cosine equation.
            <br/>
            (d) Use that idea to find one particular solution of <span style="font-family:var(--mono)">ẋ + 3x = cos(2t)</span>.
          </p>
        </div>

        <div class="cols" style="margin-top:12px;">
          <div class="callout">
            <div class="label"><span class="dot" style="background:var(--warn)"></span><strong>Given quantities</strong></div>
            <ul>
              <li>ODE form: <span style="font-family:var(--mono)">ẋ + 3x = f(t)</span></li>
              <li>In (a),(b): <span style="font-family:var(--mono)">f(t)=e^{2t}</span></li>
              <li>In (d): <span style="font-family:var(--mono)">f(t)=cos(2t)</span></li>
              <li>Initial condition for (b): <span style="font-family:var(--mono)">x(0)=1</span></li>
            </ul>
          </div>
          <div class="callout">
            <div class="label"><span class="dot" style="background:var(--accent2)"></span><strong>Unknowns / What to find</strong></div>
            <ul>
              <li>(a) Any one particular solution <span style="font-family:var(--mono)">x_p(t)</span></li>
              <li>(b) The unique solution <span style="font-family:var(--mono)">x(t)</span> satisfying <span style="font-family:var(--mono)">x(0)=1</span></li>
              <li>(c) A complex-valued ODE whose real part gives the cosine-driven ODE</li>
              <li>(d) A particular solution for the cosine-driven ODE</li>
            </ul>
          </div>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div class="label"><span class="dot"></span><strong>Relevant principles / laws (and why)</strong></div>
          <ul>
            <li><strong>Linear first-order ODE theory</strong>: <span style="font-family:var(--mono)">ẋ + a x = f(t)</span> has standard solution methods (integrating factor, undetermined coefficients).</li>
            <li><strong>Superposition</strong>: homogeneous + particular gives general solution because the ODE is linear.</li>
            <li><strong>Complex forcing method</strong>: since <span style="font-family:var(--mono)">Re(e^{iωt})=cos(ωt)</span>, solving with <span style="font-family:var(--mono)">e^{iωt}</span> and taking the real part yields a cosine solution (linearity preserves real parts).</li>
          </ul>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div class="label"><span class="dot" style="background:var(--warn)"></span><strong>Possible approaches (compare)</strong></div>
          <ol>
            <li><strong>Integrating factor</strong> (most general): multiply by <span style="font-family:var(--mono)">e^{3t}</span>, integrate, solve for constant using <span style="font-family:var(--mono)">x(0)</span>. Works for any forcing.</li>
            <li><strong>Undetermined coefficients</strong> (fast for simple forcings): guess a form like <span style="font-family:var(--mono)">Ae^{2t}</span> or <span style="font-family:var(--mono)">Acos(2t)+Bsin(2t)</span>. Quick, but tailored to specific RHS forms.</li>
            <li><strong>Complex exponential trick</strong> (clean for sinusoidal forcing): solve once for <span style="font-family:var(--mono)">e^{iωt}</span>, then take real part. Minimizes trig algebra.</li>
          </ol>
          <p class="muted" style="margin:8px 0 0;">
            Best choice here: use <strong>undetermined coefficients</strong> for (a) and the <strong>complex method</strong> for (c),(d),
            with integrating factor as a conceptual backbone (and a good sanity check).
          </p>
        </div>
      </div>
    </section>

    <section id="part2" class="card section steps">
      <div class="hd"><h2>PART 2 — Strategy &amp; Tips (roadmap only)</h2></div>
      <div class="bd">
        <div class="callout">
          <div class="label"><span class="dot"></span><strong>Minimal plan (no algebra yet)</strong></div>
          <ol>
            <li><strong>Identify the homogeneous problem</strong>: set RHS to zero and solve <span style="font-family:var(--mono)">ẋ + 3x = 0</span> (tool: separation of variables).</li>
            <li><strong>Pick a particular-solution ansatz</strong> for (a): match the forcing shape <span style="font-family:var(--mono)">e^{2t}</span> (tool: undetermined coefficients).</li>
            <li><strong>Combine</strong> homogeneous + particular to form the general solution (principle: superposition).</li>
            <li><strong>Apply the initial condition</strong> <span style="font-family:var(--mono)">x(0)=1</span> to fix the constant (tool: evaluation at <span style="font-family:var(--mono)">t=0</span>).</li>
            <li><strong>For cosine forcing</strong>: write <span style="font-family:var(--mono)">cos(2t)</span> as the real part of <span style="font-family:var(--mono)">e^{i2t}</span> (tool: Euler’s formula).</li>
            <li><strong>Solve the complex-driven ODE</strong> with a complex exponential ansatz and then <strong>take the real part</strong> (tool: complex algebra).</li>
            <li><strong>Sanity checks</strong>: plug back (differentiate + substitute), check limiting behavior as <span style="font-family:var(--mono)">t→∞</span>, and confirm dimensions (dimensionless here).</li>
          </ol>
        </div>

        <div class="cols" style="margin-top:12px;">
          <div class="callout">
            <div class="label"><span class="dot" style="background:var(--danger)"></span><strong>Common mistakes</strong></div>
            <ul>
              <li>Forgetting the homogeneous term when asked for the full solution.</li>
              <li>Mixing up <span style="font-family:var(--mono)">e^{-3t}</span> vs <span style="font-family:var(--mono)">e^{+3t}</span> in integrating factors.</li>
              <li>For sine/cosine forcing: omitting the sine term in the trial solution.</li>
              <li>When using complex numbers: forgetting to take the <em>real part</em> at the end.</li>
            </ul>
          </div>
          <div class="callout">
            <div class="label"><span class="dot" style="background:var(--ok)"></span><strong>Quick tips</strong></div>
            <ul>
              <li>For <span style="font-family:var(--mono)">ẋ + a x = e^{αt}</span>, try <span style="font-family:var(--mono)">x_p=Ae^{αt}</span> (works unless resonance <span style="font-family:var(--mono)">α=-a</span>).</li>
              <li>For <span style="font-family:var(--mono)">ẋ + a x = cos(ωt)</span>, the steady-state amplitude is <span style="font-family:var(--mono)">1/√(a²+ω²)</span>.</li>
              <li>Differentiate your proposed <span style="font-family:var(--mono)">x_p</span> and substitute immediately—fastest correctness test.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section id="part3" class="card section">
      <div class="hd"><h2>PART 3 — Full Solution</h2></div>
      <div class="bd">
        <div class="callout">
          <div class="label"><span class="dot"></span><strong>Physical intuition (first-order relaxation)</strong></div>
          <p>
            The equation <span style="font-family:var(--mono)">ẋ + 3x = f(t)</span> says:
            <span style="font-family:var(--mono)">x</span> is continuously “pulled” toward the instantaneous input <span style="font-family:var(--mono)">f(t)/3</span>
            with a relaxation rate <span style="font-family:var(--mono)">3</span> (time constant <span style="font-family:var(--mono)">τ=1/3</span>).
            The solution is always <em>transient</em> (<span style="font-family:var(--mono)">~e^{-3t}</span>) plus a <em>forced response</em>.
          </p>
        </div>

        <h3 style="margin:16px 0 6px;">(a) Particular solution to <span style="font-family:var(--mono)">ẋ + 3x = e^{2t}</span></h3>
        <p>
          Because the forcing is exponential, try a matching exponential:
          <span style="font-family:var(--mono)">x_p(t) = A e^{2t}</span>, where <span style="font-family:var(--mono)">A</span> is a constant.
        </p>

        <div class="eq" data-copy="Assume x_p = A e^{2t}. Then x_p' = 2A e^{2t}. Substitute: (2A+3A)e^{2t} = e^{2t} ⇒ 5A=1 ⇒ A=1/5. Hence x_p(t)=(1/5)e^{2t}.">
          <button class="copyBtn">Copy</button>
          <code>Assume x_p = A e^{2t}.
Then ẋ_p = 2A e^{2t}.
Substitute into ẋ + 3x = e^{2t}:
(2A e^{2t}) + 3(A e^{2t}) = e^{2t}
⇒ (2A + 3A)e^{2t} = e^{2t}
⇒ 5A = 1
⇒ A = 1/5
⇒ x_p(t) = (1/5)e^{2t}.</code>
        </div>

        <div class="boxFinal">
          <div class="tag">Answer (a)</div>
          <div class="eq" style="margin:0;" data-copy="x_p(t) = (1/5)e^{2t}">
            <button class="copyBtn">Copy</button>
            <code>x_p(t) = (1/5)e^{2t}</code>
          </div>
        </div>

        <h3 style="margin:18px 0 6px;">(b) Solve with <span style="font-family:var(--mono)">x(0)=1</span></h3>
        <p>
          First solve the homogeneous equation <span style="font-family:var(--mono)">ẋ + 3x = 0</span>.
          Separate variables: <span style="font-family:var(--mono)">ẋ = -3x</span> gives an exponential decay.
        </p>

        <div class="eq" data-copy="Homogeneous: ẋ+3x=0 ⇒ ẋ=-3x ⇒ x_h=Ce^{-3t}. General: x=Ce^{-3t}+(1/5)e^{2t}. Apply x(0)=1 ⇒ C+1/5=1 ⇒ C=4/5.">
          <button class="copyBtn">Copy</button>
          <code>Homogeneous: ẋ + 3x = 0
⇒ ẋ = -3x
⇒ x_h(t) = C e^{-3t}.

General solution = homogeneous + particular:
x(t) = C e^{-3t} + (1/5)e^{2t}.

Apply x(0)=1:
1 = C e^{0} + (1/5)e^{0}
⇒ 1 = C + 1/5
⇒ C = 4/5.</code>
        </div>

        <div class="boxFinal">
          <div class="tag">Answer (b)</div>
          <div class="eq" style="margin:0;" data-copy="x(t) = (4/5)e^{-3t} + (1/5)e^{2t}">
            <button class="copyBtn">Copy</button>
            <code>x(t) = (4/5)e^{-3t} + (1/5)e^{2t}</code>
          </div>
        </div>

        <h3 style="margin:18px 0 6px;">(c) Complex exponential whose real part is <span style="font-family:var(--mono)">cos(2t)</span></h3>
        <p>
          Euler’s formula gives <span style="font-family:var(--mono)">e^{i2t} = cos(2t) + i sin(2t)</span>, so
          <span style="font-family:var(--mono)">Re(e^{i2t}) = cos(2t)</span>.
          Therefore, if we solve the complex ODE with RHS <span style="font-family:var(--mono)">e^{i2t}</span>, its real part solves the cosine-driven ODE.
        </p>

        <div class="boxFinal">
          <div class="tag">Answer (c)</div>
          <div class="eq" style="margin:0;" data-copy="Complex ODE: ẋ + 3x = e^{i2t}. Then Re(x) satisfies ẋ + 3x = cos(2t).">
            <button class="copyBtn">Copy</button>
            <code>Complex ODE:  ẋ + 3x = e^{i2t}
⇒ taking real parts gives: (Re x)̇ + 3(Re x) = cos(2t).</code>
          </div>
        </div>

        <h3 style="margin:18px 0 6px;">(d) Particular solution to <span style="font-family:var(--mono)">ẋ + 3x = cos(2t)</span></h3>
        <p>
          Solve the complex equation <span style="font-family:var(--mono)">ẋ + 3x = e^{i2t}</span> using an exponential trial:
          <span style="font-family:var(--mono)">x̃_p(t)=A e^{i2t}</span> with complex constant <span style="font-family:var(--mono)">A</span>.
        </p>

        <div class="eq" data-copy="Let x̃_p=Ae^{i2t}. Then x̃_p' = i2 A e^{i2t}. Substitute: (i2A+3A)e^{i2t}=e^{i2t} ⇒ A=1/(3+i2)=(3-i2)/13. Real part: x_p(t)=Re(((3-i2)/13)e^{i2t})=(3/13)cos(2t)+(2/13)sin(2t).">
          <button class="copyBtn">Copy</button>
          <code>Let x̃_p(t) = A e^{i2t}.
Then x̃̇_p = (i2)A e^{i2t}.

Substitute into ẋ + 3x = e^{i2t}:
(i2 A e^{i2t}) + 3(A e^{i2t}) = e^{i2t}
⇒ (3 + i2)A e^{i2t} = e^{i2t}
⇒ (3 + i2)A = 1
⇒ A = 1/(3 + i2) = (3 - i2)/(3^2 + 2^2) = (3 - i2)/13.

Now take the real part:
x_p(t) = Re( A e^{i2t} )
= Re( ((3 - i2)/13)(cos(2t) + i sin(2t)) )
= (3/13)cos(2t) + (2/13)sin(2t).</code>
        </div>

        <div class="boxFinal">
          <div class="tag">Answer (d)</div>
          <div class="eq" style="margin:0;" data-copy="x_p(t) = (3/13)cos(2t) + (2/13)sin(2t)">
            <button class="copyBtn">Copy</button>
            <code>x_p(t) = (3/13)cos(2t) + (2/13)sin(2t)</code>
          </div>
        </div>

        <h3 style="margin:18px 0 6px;">Sanity checks</h3>
        <div class="cols">
          <div class="callout">
            <div class="label"><span class="dot"></span><strong>Units</strong></div>
            <p>
              The problem gives no physical units. Interpreting <span style="font-family:var(--mono)">t</span> as time, the coefficient <span style="font-family:var(--mono)">3</span> has units of <span style="font-family:var(--mono)">1/time</span>,
              and the forcing must share units with <span style="font-family:var(--mono)">ẋ</span> and <span style="font-family:var(--mono)">3x</span>. In pure math, everything is dimensionless.
            </p>
          </div>
          <div class="callout">
            <div class="label"><span class="dot" style="background:var(--warn)"></span><strong>Limiting cases &amp; interpretation</strong></div>
            <ul>
              <li>In (b), as <span style="font-family:var(--mono)">t→∞</span>, the growing forcing term <span style="font-family:var(--mono)">(1/5)e^{2t}</span> dominates; the transient <span style="font-family:var(--mono)">(4/5)e^{-3t}</span> decays away.</li>
              <li>For cosine forcing, the response is a phase-shifted sinusoid with reduced amplitude: gain <span style="font-family:var(--mono)">1/√(3²+2²)=1/√13</span>.</li>
              <li>The time constant is <span style="font-family:var(--mono)">τ=1/3</span>: transients decay like <span style="font-family:var(--mono)">e^{-t/τ}</span>.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section id="viz" class="card section">
      <div class="hd">
        <h2>Interactive Visualizations (diagram + main plot + parameter sweep)</h2>
        <span class="pill"><span class="dot"></span><span>Live updates</span></span>
      </div>
      <div class="bd">
        <p class="muted" style="margin-top:0;">
          The plots below use the same model form <span style="font-family:var(--mono)">ẋ + a x = f(t)</span>.
          For this problem, <span style="font-family:var(--mono)">a=3</span>, but you can vary <span style="font-family:var(--mono)">a</span> to see how the relaxation rate changes.
          These are <strong>example values</strong> for visualization only—the symbolic answers above are the final solutions.
        </p>

        <div class="controls" aria-label="Interactive controls">
          <div class="row">
            <label for="forcing">Forcing f(t)</label>
            <select id="forcing">
              <option value="exp">Exponential: e^{α t}</option>
              <option value="cos">Sinusoidal: cos(ω t)</option>
            </select>
            <div class="val" id="forcingVal">exp</div>
          </div>

          <div class="row">
            <label for="aSlider">System rate a (1/s)</label>
            <input id="aSlider" type="range" min="0.4" max="8" step="0.05" value="3" />
            <div class="val" id="aVal">3.00</div>
          </div>

          <div class="row" id="alphaRow">
            <label for="alphaSlider">α for e^{α t} (1/s)</label>
            <input id="alphaSlider" type="range" min="-2" max="4" step="0.02" value="2" />
            <div class="val" id="alphaVal">2.00</div>
          </div>

          <div class="row" id="omegaRow" style="display:none;">
            <label for="omegaSlider">ω for cos(ω t) (rad/s)</label>
            <input id="omegaSlider" type="range" min="0" max="12" step="0.05" value="2" />
            <div class="val" id="omegaVal">2.00</div>
          </div>

          <div class="row">
            <label for="x0Input">Initial condition x(0)</label>
            <input id="x0Input" type="number" step="0.1" value="1" />
            <div class="val" id="x0Val">1.0</div>
          </div>
        </div>

        <div class="grid" style="margin-top:14px;">
          <figure class="card" style="margin:0;">
            <div class="hd"><h3>Diagram: first-order driven system</h3><span class="pill"><span class="dot" style="background:var(--warn)"></span><span>Setup</span></span></div>
            <canvas id="diag" width="900" height="460" aria-label="Diagram canvas"></canvas>
          </figure>

          <figure class="card" style="margin:0;">
            <div class="hd"><h3>Secondary plot: parameter sweep</h3><span class="pill"><span class="dot" style="background:var(--accent2)"></span><span>Gain/response</span></span></div>
            <canvas id="sweep" width="900" height="460" aria-label="Sweep canvas"></canvas>
          </figure>
        </div>

        <figure class="card" style="margin:0; margin-top:14px;">
          <div class="hd"><h3>Main plot: time response x(t)</h3><span class="pill"><span class="dot"></span><span>Dynamics</span></span></div>
          <canvas id="main" width="1100" height="520" aria-label="Main plot canvas"></canvas>
        </figure>

        <div class="eq" data-copy="Model used in plots: ẋ + a x = f(t). For exp: f(t)=e^{αt}, solution x(t)=(x0-1/(a+α))e^{-at}+e^{αt}/(a+α). For cos: f(t)=cos(ωt), particular x_p=(a cos(ωt)+ω sin(ωt))/(a^2+ω^2).">
          <button class="copyBtn">Copy</button>
          <code>Model used in plots: ẋ + a x = f(t)

Exponential forcing: f(t)=e^{αt}
x(t) = (x0 - 1/(a+α)) e^{-a t} + e^{α t}/(a+α)   (a+α≠0)

Cosine forcing: f(t)=cos(ωt)
x_p(t) = (a cos(ωt) + ω sin(ωt)) / (a^2 + ω^2)</code>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="muted">
      Tip: If you interpret <span style="font-family:var(--mono)">x</span> as the voltage across a capacitor in an RC circuit,
      the equation is analogous to <span style="font-family:var(--mono)">C V̇ + (1/R)V = I(t)</span> after rescaling. The mathematics is the same: transient + forced response.
    </div>
  </footer>

  <script>
    // ---------- Copy buttons ----------
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed';
      t.style.left='50%';
      t.style.bottom='18px';
      t.style.transform='translateX(-50%)';
      t.style.padding='10px 12px';
      t.style.border='1px solid rgba(255,255,255,.18)';
      t.style.background='rgba(0,0,0,.55)';
      t.style.color='white';
      t.style.borderRadius='12px';
      t.style.fontSize='.9rem';
      t.style.zIndex='9999';
      t.style.backdropFilter='blur(6px)';
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.opacity='0'; t.style.transition='opacity .25s ease'; }, 900);
      setTimeout(()=>t.remove(), 1200);
    }

    document.querySelectorAll('.eq .copyBtn').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const eq = btn.closest('.eq');
        const text = eq.getAttribute('data-copy') || eq.innerText;
        try{
          await navigator.clipboard.writeText(text.trim());
          toast('Copied!');
        }catch(e){
          // fallback
          const ta = document.createElement('textarea');
          ta.value = text.trim();
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          ta.remove();
          toast('Copied!');
        }
      });
    });

    // ---------- Smooth TOC scroll ----------
    document.querySelectorAll('.toc a[href^="#"]').forEach(a=>{
      a.addEventListener('click', (ev)=>{
        ev.preventDefault();
        const id = a.getAttribute('href');
        const el = document.querySelector(id);
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    // ---------- Canvas helpers ----------
    function setupHiDPI(canvas){
      const ctx = canvas.getContext('2d');
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = canvas.getBoundingClientRect();
      const cssW = Math.max(320, rect.width);
      const cssH = rect.height || (canvas.height * cssW / canvas.width);

      canvas.style.height = cssH + 'px';
      canvas.width = Math.floor(cssW * dpr);
      canvas.height = Math.floor(cssH * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      return {ctx, w: cssW, h: cssH, dpr};
    }

    function clear(ctx,w,h){
      ctx.clearRect(0,0,w,h);
      // subtle panel background inside canvas
      const g = ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0, 'rgba(255,255,255,0.06)');
      g.addColorStop(1, 'rgba(255,255,255,0.02)');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);
    }

    function drawAxes(ctx, plot){
      const {x0,y0,x1,y1} = plot;
      ctx.save();
      ctx.strokeStyle = 'rgba(255,255,255,0.16)';
      ctx.lineWidth = 1;

      // border
      ctx.strokeRect(x0,y0,x1-x0,y1-y0);

      // grid
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      for(let i=1;i<6;i++){
        const x = x0 + (x1-x0)*i/6;
        ctx.beginPath(); ctx.moveTo(x,y0); ctx.lineTo(x,y1); ctx.stroke();
      }
      for(let i=1;i<5;i++){
        const y = y0 + (y1-y0)*i/5;
        ctx.beginPath(); ctx.moveTo(x0,y); ctx.lineTo(x1,y); ctx.stroke();
      }

      ctx.restore();
    }

    function ticks(ctx, plot, xLabel, yLabel, xUnit, yUnit){
      const {x0,y0,x1,y1} = plot;
      ctx.save();
      ctx.fillStyle = 'rgba(255,255,255,0.85)';
      ctx.font = '12px ui-monospace, Menlo, Consolas, monospace';

      // x ticks
      const xt = 6;
      for(let i=0;i<=xt;i++){
        const x = x0 + (x1-x0)*i/xt;
        ctx.strokeStyle = 'rgba(255,255,255,0.22)';
        ctx.beginPath(); ctx.moveTo(x,y1); ctx.lineTo(x,y1+5); ctx.stroke();
      }

      // y ticks
      const yt = 5;
      for(let i=0;i<=yt;i++){
        const y = y0 + (y1-y0)*i/yt;
        ctx.strokeStyle = 'rgba(255,255,255,0.22)';
        ctx.beginPath(); ctx.moveTo(x0-5,y); ctx.lineTo(x0,y); ctx.stroke();
      }

      // labels
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(`${xLabel} (${xUnit})`, x0 + (x1-x0)/2 - 30, y1 + 32);
      ctx.save();
      ctx.translate(x0 - 36, y0 + (y1-y0)/2 + 40);
      ctx.rotate(-Math.PI/2);
      ctx.fillText(`${yLabel} (${yUnit})`, 0, 0);
      ctx.restore();

      ctx.restore();
    }

    function titleText(ctx, w, t){
      ctx.save();
      ctx.fillStyle = 'rgba(255,255,255,0.92)';
      ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(t, 14, 22);
      ctx.restore();
    }

    function legend(ctx, items, x, y){
      ctx.save();
      ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      items.forEach((it, k)=>{
        const yy = y + k*18;
        ctx.fillStyle = it.color;
        ctx.fillRect(x, yy-9, 12, 3);
        ctx.fillStyle = 'rgba(255,255,255,0.85)';
        ctx.fillText(it.label, x+18, yy-4);
      });
      ctx.restore();
    }

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    // ---------- Model formulas (used by plots) ----------
    function xExp(t, a, alpha, x0){
      // x' + a x = e^{alpha t}; for (a+alpha)=0 would require special form; avoid in UI
      const denom = a + alpha;
      if(Math.abs(denom) < 1e-6){
        // resonance-like case: particular ~ t e^{-a t}; implement safe fallback
        // If alpha = -a, equation x' + a x = e^{-a t} => (e^{a t} x)' = 1 => x = e^{-a t}(x0 + t)
        return Math.exp(-a*t) * (x0 + t);
      }
      return (x0 - 1/denom) * Math.exp(-a*t) + Math.exp(alpha*t)/denom;
    }

    function xCosFull(t, a, w, x0){
      // x' + a x = cos(w t)
      // steady-state particular: (a cos(wt) + w sin(wt)) / (a^2 + w^2)
      // full solution: x = C e^{-a t} + x_p(t), choose C so x(0)=x0
      const denom = a*a + w*w;
      const xp = (a*Math.cos(w*t) + w*Math.sin(w*t))/denom;
      const xp0 = a/denom; // at t=0: (a*1 + w*0)/denom
      const C = x0 - xp0;
      return C*Math.exp(-a*t) + xp;
    }

    function xCosPart(t, a, w){
      const denom = a*a + w*w;
      return (a*Math.cos(w*t) + w*Math.sin(w*t))/denom;
    }

    function ampCos(a,w){
      return 1/Math.sqrt(a*a + w*w);
    }

    function phaseCos(a,w){
      // output relative to cos input for x_p = amp * cos(wt - phi)
      // For transfer 1/(a+i w): magnitude 1/sqrt(a^2+w^2), phase = arctan(w/a)
      return Math.atan2(w,a); // phi
    }

    // ---------- Drawing: Diagram ----------
    function drawDiagram(canvas, state){
      const {ctx,w,h} = setupHiDPI(canvas);
      clear(ctx,w,h);
      titleText(ctx,w, 'Physical/engineering interpretation: driven first-order system');

      const pad = 18;
      const midY = h*0.56;

      // Left: input block u(t)
      ctx.save();
      ctx.fillStyle = 'rgba(255,255,255,0.10)';
      ctx.strokeStyle = 'rgba(255,255,255,0.18)';
      ctx.lineWidth = 1;
      const bx = pad, by = h*0.28, bw = w*0.24, bh = h*0.32;
      roundRect(ctx,bx,by,bw,bh,16,true,true);

      ctx.fillStyle='rgba(255,255,255,0.92)';
      ctx.font='600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Input (forcing)', bx+12, by+22);
      ctx.font='13px ui-monospace, Menlo, Consolas, monospace';
      const fstr = state.mode==='exp' ? `u(t)=e^{αt}, α=${state.alpha.toFixed(2)}` : `u(t)=cos(ωt), ω=${state.omega.toFixed(2)}`;
      ctx.fillText(fstr, bx+12, by+46);

      // Middle: system block
      const sx = w*0.38, sy = h*0.26, sw = w*0.30, sh = h*0.36;
      ctx.fillStyle = 'rgba(121,210,255,0.10)';
      ctx.strokeStyle = 'rgba(121,210,255,0.35)';
      roundRect(ctx,sx,sy,sw,sh,18,true,true);

      ctx.fillStyle='rgba(255,255,255,0.92)';
      ctx.font='600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('First-order system', sx+14, sy+22);
      ctx.font='13px ui-monospace, Menlo, Consolas, monospace';
      ctx.fillText(`ẋ + a x = u(t)`, sx+14, sy+48);
      ctx.fillText(`a = ${state.a.toFixed(2)}  (rate)`, sx+14, sy+70);
      ctx.fillText(`τ = 1/a = ${(1/state.a).toFixed(3)}`, sx+14, sy+92);

      // Right: output block x(t)
      const ox = w*0.76, oy = h*0.28, ow = w*0.22, oh = h*0.32;
      ctx.fillStyle = 'rgba(167,255,179,0.10)';
      ctx.strokeStyle = 'rgba(167,255,179,0.35)';
      roundRect(ctx,ox,oy,ow,oh,16,true,true);

      ctx.fillStyle='rgba(255,255,255,0.92)';
      ctx.font='600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('State (response)', ox+12, oy+22);
      ctx.font='13px ui-monospace, Menlo, Consolas, monospace';
      ctx.fillText(`x(0) = ${state.x0.toFixed(2)}`, ox+12, oy+46);
      ctx.fillText(`transient ~ e^{-a t}`, ox+12, oy+68);

      // Arrows
      ctx.strokeStyle = 'rgba(255,255,255,0.55)';
      ctx.lineWidth = 2;
      arrow(ctx, bx+bw, midY, sx, midY);
      arrow(ctx, sx+sw, midY, ox, midY);

      // Small "physics examples"
      ctx.fillStyle='rgba(255,255,255,0.82)';
      ctx.font='12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Examples: RC circuit, thermal relaxation, overdamped motion, low-pass filter', pad, h-18);

      ctx.restore();
    }

    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr,y);
      ctx.arcTo(x+w,y, x+w,y+h, rr);
      ctx.arcTo(x+w,y+h, x,y+h, rr);
      ctx.arcTo(x,y+h, x,y, rr);
      ctx.arcTo(x,y, x+w,y, rr);
      ctx.closePath();
      if(fill) ctx.fill();
      if(stroke) ctx.stroke();
    }

    function arrow(ctx,x1,y1,x2,y2){
      const head = 10;
      const dx = x2-x1, dy = y2-y1;
      const ang = Math.atan2(dy,dx);
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.lineTo(x2,y2);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x2,y2);
      ctx.lineTo(x2-head*Math.cos(ang-Math.PI/7), y2-head*Math.sin(ang-Math.PI/7));
      ctx.lineTo(x2-head*Math.cos(ang+Math.PI/7), y2-head*Math.sin(ang+Math.PI/7));
      ctx.closePath();
      ctx.fillStyle = 'rgba(255,255,255,0.55)';
      ctx.fill();
    }

    // ---------- Drawing: Main time plot ----------
    function drawMain(canvas, state){
      const {ctx,w,h} = setupHiDPI(canvas);
      clear(ctx,w,h);
      titleText(ctx,w,'Time response x(t) for ẋ + a x = f(t) (example visualization)');

      const plot = {x0: 64, y0: 46, x1: w-18, y1: h-62};
      drawAxes(ctx, plot);

      const T = 6; // seconds (example window)
      const N = 600;

      // compute data
      const xs = [];
      const us = [];
      let yMin = 1e9, yMax = -1e9;

      for(let i=0;i<=N;i++){
        const t = T*i/N;
        let x, u;
        if(state.mode==='exp'){
          x = xExp(t, state.a, state.alpha, state.x0);
          u = Math.exp(state.alpha*t);
        }else{
          x = xCosFull(t, state.a, state.omega, state.x0);
          u = Math.cos(state.omega*t);
        }
        xs.push({t, x});
        us.push({t, u});
        yMin = Math.min(yMin, x, u);
        yMax = Math.max(yMax, x, u);
      }

      // add padding
      const padY = 0.12*(yMax-yMin || 1);
      yMin -= padY; yMax += padY;
      if(!isFinite(yMin) || !isFinite(yMax)){ yMin=-1; yMax=1; }

      // mapping
      const X = t => plot.x0 + (plot.x1-plot.x0)*(t/T);
      const Y = y => plot.y1 - (plot.y1-plot.y0)*((y - yMin)/(yMax - yMin || 1));

      // tick labels (numeric)
      ctx.save();
      ctx.fillStyle='rgba(255,255,255,0.75)';
      ctx.font='12px ui-monospace, Menlo, Consolas, monospace';

      // x numeric ticks
      for(let i=0;i<=6;i++){
        const t = T*i/6;
        ctx.fillText(t.toFixed(1), X(t)-10, plot.y1+20);
      }
      // y numeric ticks
      for(let i=0;i<=5;i++){
        const y = yMax - (yMax-yMin)*i/5;
        ctx.fillText(y.toFixed(2), plot.x0-56, Y(y)+4);
      }
      ctx.restore();

      ticks(ctx, plot, 't', 'value', 's', 'arb.');

      // draw input u(t) as thin line
      ctx.save();
      ctx.strokeStyle='rgba(255,209,102,0.85)';
      ctx.lineWidth=1.5;
      ctx.beginPath();
      us.forEach((p,idx)=>{
        const xx = X(p.t), yy = Y(p.u);
        if(idx===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
      });
      ctx.stroke();

      // draw output x(t) as thicker line
      ctx.strokeStyle='rgba(121,210,255,0.95)';
      ctx.lineWidth=2.6;
      ctx.beginPath();
      xs.forEach((p,idx)=>{
        const xx = X(p.t), yy = Y(p.x);
        if(idx===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
      });
      ctx.stroke();

      // highlight t=0 point
      ctx.fillStyle='rgba(167,255,179,0.95)';
      ctx.beginPath();
      ctx.arc(X(0), Y(xs[0].x), 4, 0, Math.PI*2);
      ctx.fill();

      legend(ctx, [
        {label:'x(t) (response)', color:'rgba(121,210,255,0.95)'},
        {label:'u(t)=f(t) (input)', color:'rgba(255,209,102,0.85)'}
      ], plot.x0+10, plot.y0+24);

      // annotate current theoretical particular for problem params if close
      ctx.save();
      ctx.fillStyle='rgba(255,255,255,0.8)';
      ctx.font='12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';

      let note;
      if(state.mode==='exp'){
        const denom = state.a + state.alpha;
        note = `Exp forcing: x_p(t)=e^{αt}/(a+α) , gain=1/(a+α) ≈ ${ (Math.abs(denom)<1e-6? NaN : (1/denom)).toFixed(3) }`;
      }else{
        const A = ampCos(state.a, state.omega);
        const phi = phaseCos(state.a, state.omega);
        note = `Cos forcing: |H(iω)|=1/√(a²+ω²) ≈ ${A.toFixed(3)}, phase φ≈${(phi*180/Math.PI).toFixed(1)}°`;
      }
      ctx.fillText(note, plot.x0, plot.y0-12);
      ctx.restore();

      ctx.restore();
    }

    // ---------- Drawing: Secondary sweep plot ----------
    function drawSweep(canvas, state){
      const {ctx,w,h} = setupHiDPI(canvas);
      clear(ctx,w,h);

      const plot = {x0: 64, y0: 46, x1: w-18, y1: h-62};
      drawAxes(ctx, plot);

      let title;
      if(state.mode==='cos'){
        title = 'Steady-state amplitude vs frequency for ẋ + a x = cos(ωt)';
      }else{
        title = 'Exponential “gain” vs α for ẋ + a x = e^{αt}';
      }
      titleText(ctx,w,title);

      const X = x => plot.x0 + (plot.x1-plot.x0)*x;
      const Y = y => plot.y1 - (plot.y1-plot.y0)*y;

      // Determine sweep range and compute curve
      const N = 600;
      let xMin, xMax, yMin, yMax, curve = [];
      let markerX = 0, markerY = 0;

      if(state.mode==='cos'){
        xMin = 0; xMax = 12; // ω range
        // amplitude = 1/sqrt(a^2 + ω^2)
        yMin = 0; yMax = 1/Math.max(0.2,state.a); // max at ω=0 is 1/a
        for(let i=0;i<=N;i++){
          const wv = xMin + (xMax-xMin)*i/N;
          const amp = 1/Math.sqrt(state.a*state.a + wv*wv);
          curve.push({x:wv, y:amp});
        }
        markerX = state.omega;
        markerY = ampCos(state.a, state.omega);
      }else{
        xMin = -2; xMax = 4; // α range
        // "gain" = 1/(a+α), show magnitude to avoid sign flips dominating
        // use |1/(a+α)| with cap near singularity
        yMin = 0; yMax = 2.5; // visualization cap
        for(let i=0;i<=N;i++){
          const av = xMin + (xMax-xMin)*i/N;
          let denom = state.a + av;
          let g = 1/Math.max(1e-3, Math.abs(denom));
          g = Math.min(yMax, g);
          curve.push({x:av, y:g});
        }
        markerX = state.alpha;
        let denom = state.a + state.alpha;
        markerY = Math.min(yMax, 1/Math.max(1e-3, Math.abs(denom)));
      }

      // numeric ticks
      ctx.save();
      ctx.fillStyle='rgba(255,255,255,0.75)';
      ctx.font='12px ui-monospace, Menlo, Consolas, monospace';

      for(let i=0;i<=6;i++){
        const xv = xMin + (xMax-xMin)*i/6;
        const xx = X((xv-xMin)/(xMax-xMin));
        ctx.fillText(xv.toFixed(1), xx-10, plot.y1+20);
      }
      for(let i=0;i<=5;i++){
        const yv = yMax - (yMax-yMin)*i/5;
        const yy = Y((yv-yMin)/(yMax-yMin));
        ctx.fillText(yv.toFixed(2), plot.x0-56, yy+4);
      }
      ctx.restore();

      ticks(ctx, plot, (state.mode==='cos'?'ω':'α'), (state.mode==='cos'?'Amplitude |x_p|':'|1/(a+α)| (capped)'), (state.mode==='cos'?'rad/s':'1/s'), 'arb.');

      // curve
      ctx.save();
      ctx.strokeStyle = state.mode==='cos' ? 'rgba(167,255,179,0.92)' : 'rgba(255,209,102,0.9)';
      ctx.lineWidth = 2.2;
      ctx.beginPath();
      curve.forEach((p,idx)=>{
        const xx = X((p.x-xMin)/(xMax-xMin));
        const yy = Y((p.y-yMin)/(yMax-yMin || 1));
        if(idx===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
      });
      ctx.stroke();

      // marker line
      ctx.strokeStyle = 'rgba(121,210,255,0.65)';
      ctx.lineWidth = 1.5;
      const mx = X((markerX-xMin)/(xMax-xMin));
      ctx.beginPath(); ctx.moveTo(mx, plot.y0); ctx.lineTo(mx, plot.y1); ctx.stroke();

      // marker point
      const my = Y((markerY-yMin)/(yMax-yMin || 1));
      ctx.fillStyle = 'rgba(121,210,255,0.95)';
      ctx.beginPath(); ctx.arc(mx, my, 4, 0, Math.PI*2); ctx.fill();

      legend(ctx, [
        {label: state.mode==='cos' ? 'A(ω)=1/√(a²+ω²)' : '|1/(a+α)| (capped)', color: ctx.strokeStyle},
        {label: 'current parameter', color:'rgba(121,210,255,0.95)'}
      ], plot.x0+10, plot.y0+24);

      ctx.restore();
    }

    // ---------- State + UI wiring ----------
    const state = {
      mode: 'exp',
      a: 3,
      alpha: 2,
      omega: 2,
      x0: 1
    };

    const forcingSel = document.getElementById('forcing');
    const aSlider = document.getElementById('aSlider');
    const alphaSlider = document.getElementById('alphaSlider');
    const omegaSlider = document.getElementById('omegaSlider');
    const x0Input = document.getElementById('x0Input');

    const forcingVal = document.getElementById('forcingVal');
    const aVal = document.getElementById('aVal');
    const alphaVal = document.getElementById('alphaVal');
    const omegaVal = document.getElementById('omegaVal');
    const x0Val = document.getElementById('x0Val');

    const alphaRow = document.getElementById('alphaRow');
    const omegaRow = document.getElementById('omegaRow');

    const cDiag = document.getElementById('diag');
    const cMain = document.getElementById('main');
    const cSweep = document.getElementById('sweep');

    function syncUI(){
      forcingVal.textContent = state.mode;
      aVal.textContent = state.a.toFixed(2);
      alphaVal.textContent = state.alpha.toFixed(2);
      omegaVal.textContent = state.omega.toFixed(2);
      x0Val.textContent = state.x0.toFixed(1);

      if(state.mode==='exp'){
        alphaRow.style.display='';
        omegaRow.style.display='none';
      }else{
        alphaRow.style.display='none';
        omegaRow.style.display='';
      }
    }

    function renderAll(){
      syncUI();
      drawDiagram(cDiag, state);
      drawMain(cMain, state);
      drawSweep(cSweep, state);
    }

    forcingSel.addEventListener('change', ()=>{
      state.mode = forcingSel.value;
      renderAll();
    });

    aSlider.addEventListener('input', ()=>{
      state.a = parseFloat(aSlider.value);
      // avoid exact singularity if exp forcing and alpha = -a
      if(state.mode==='exp' && Math.abs(state.a + state.alpha) < 0.02){
        state.alpha = -state.a + 0.05;
        alphaSlider.value = state.alpha;
      }
      renderAll();
    });

    alphaSlider.addEventListener('input', ()=>{
      state.alpha = parseFloat(alphaSlider.value);
      if(Math.abs(state.a + state.alpha) < 0.02){
        state.alpha = -state.a + 0.05;
        alphaSlider.value = state.alpha;
      }
      renderAll();
    });

    omegaSlider.addEventListener('input', ()=>{
      state.omega = parseFloat(omegaSlider.value);
      renderAll();
    });

    x0Input.addEventListener('input', ()=>{
      const v = parseFloat(x0Input.value);
      state.x0 = isFinite(v) ? v : 0;
      renderAll();
    });

    // Re-render on resize for crispness
    let rAF = null;
    window.addEventListener('resize', ()=>{
      if(rAF) cancelAnimationFrame(rAF);
      rAF = requestAnimationFrame(()=>renderAll());
    });

    // init
    renderAll();
  </script>
</body>
</html>
