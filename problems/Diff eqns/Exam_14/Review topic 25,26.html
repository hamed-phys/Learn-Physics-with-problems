<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Separation of Variables Review: Wave (Fixed Ends) & Heat (Insulated Ends)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a33;
      --panel2:#0c162e;
      --text:#e9eefc;
      --muted:#b9c4ea;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 10% 0%, rgba(125,211,252,.18), transparent 55%),
                  radial-gradient(1000px 700px at 90% 10%, rgba(167,139,250,.16), transparent 55%),
                  linear-gradient(180deg, #070b14, var(--bg));
      color:var(--text);
      line-height:1.55;
    }
    header{
      padding: 28px 18px 18px;
      border-bottom:1px solid var(--line);
      position:relative;
      overflow:hidden;
    }
    header .wrap{
      max-width:1200px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:start;
    }
    h1{
      margin:0 0 10px;
      font-size: clamp(1.35rem, 2.6vw, 2.1rem);
      letter-spacing:.2px;
    }
    .sub{
      color:var(--muted);
      margin:0;
      font-size: .98rem;
    }
    .badgeRow{
      margin-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .badge{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      padding:6px 10px;
      border-radius:999px;
      font-size:.85rem;
      color:var(--muted);
      box-shadow: var(--shadow);
    }
    .grid{
      max-width:1200px;
      margin: 18px auto 40px;
      padding: 0 18px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:16px;
      align-items:start;
    }
    nav.toc{
      position: sticky;
      top: 12px;
      align-self:start;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:16px;
      padding:14px 12px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    nav.toc h2{
      margin:0 0 8px;
      font-size: .95rem;
      color:var(--text);
      letter-spacing:.2px;
    }
    nav.toc a{
      display:block;
      padding:7px 10px;
      margin:4px 0;
      border-radius:10px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:.93rem;
    }
    nav.toc a:hover{
      background: rgba(125,211,252,.08);
      border-color: rgba(125,211,252,.18);
      color:var(--text);
      transform: translateX(2px);
    }

    main{
      min-width:0;
    }
    section{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:18px;
      padding: 16px 16px 18px;
      box-shadow: var(--shadow);
      margin-bottom:16px;
      backdrop-filter: blur(8px);
    }
    section h2{
      margin:0 0 10px;
      font-size:1.15rem;
      letter-spacing:.2px;
    }
    section h3{
      margin: 14px 0 8px;
      font-size:1.02rem;
      color: var(--text);
    }
    .muted{color:var(--muted)}
    .cols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      header .wrap{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      nav.toc{position:relative; top:auto}
      .cols{grid-template-columns:1fr}
    }

    .callout{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(52,211,153,.10), rgba(52,211,153,.03));
      border-radius:16px;
      padding:12px 12px 10px;
    }
    .callout.warn{
      background: linear-gradient(180deg, rgba(251,191,36,.12), rgba(251,191,36,.03));
    }
    .callout.bad{
      background: linear-gradient(180deg, rgba(251,113,133,.12), rgba(251,113,133,.03));
    }
    ul{margin:8px 0 0 22px}
    li{margin:6px 0}
    .kpi{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .kpi .card{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px 8px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .kpi .label{color:var(--muted); font-size:.84rem}
    .kpi .val{font-size:1.02rem; margin-top:4px}
    @media (max-width: 650px){
      .kpi{grid-template-columns:1fr}
    }

    .eq{
      position:relative;
      margin:10px 0;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      border-radius:14px;
      padding:12px 44px 12px 12px;
      overflow:auto;
    }
    pre, code{font-family:var(--mono)}
    pre{margin:0; white-space:pre-wrap}
    .copyBtn{
      position:absolute;
      top:10px;
      right:10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:10px;
      padding:6px 9px;
      cursor:pointer;
      font-size:.82rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .copyBtn:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.24);
      transform: translateY(-1px);
    }
    .copyToast{
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.65);
      border: 1px solid rgba(255,255,255,.14);
      padding: 8px 12px;
      border-radius: 999px;
      color: var(--text);
      font-size: .9rem;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 999;
      backdrop-filter: blur(8px);
    }
    .copyToast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }

    .vizWrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .controls{
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr 1fr;
      gap:10px;
      align-items:end;
    }
    .ctrl{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background: rgba(0,0,0,.18);
    }
    .ctrl label{
      display:block;
      font-size:.85rem;
      color:var(--muted);
      margin-bottom:6px;
    }
    .ctrl select, .ctrl input[type="range"], .ctrl input[type="number"]{
      width:100%;
      accent-color: var(--accent);
    }
    .ctrl .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:.9rem;
    }
    .ctrl .val{
      font-family:var(--mono);
      color:var(--text);
      font-size:.9rem;
      white-space:nowrap;
    }
    @media (max-width: 980px){
      .controls{grid-template-columns:1fr 1fr}
    }
    @media (max-width: 520px){
      .controls{grid-template-columns:1fr}
    }

    .canvasCard{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background: rgba(0,0,0,.20);
    }
    .canvasHead{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .canvasHead .title{
      font-size:.95rem;
      color:var(--text);
    }
    .canvasHead .hint{
      font-size:.85rem;
      color:var(--muted);
    }
    canvas{
      width:100%;
      height:360px;
      display:block;
      background: radial-gradient(800px 380px at 30% 10%, rgba(125,211,252,.08), transparent 55%),
                  radial-gradient(700px 380px at 80% 20%, rgba(167,139,250,.07), transparent 55%),
                  rgba(0,0,0,.18);
    }
    .small canvas{height:300px}
    .footer{
      max-width:1200px;
      margin: 0 auto;
      padding: 0 18px 34px;
      color: var(--muted);
      font-size:.92rem;
    }

    .boxFinal{
      border:1px solid rgba(125,211,252,.25);
      background: linear-gradient(180deg, rgba(125,211,252,.12), rgba(125,211,252,.03));
      border-radius:16px;
      padding:12px;
      margin-top:10px;
    }
    .boxFinal .tag{
      display:inline-block;
      font-size:.82rem;
      color: var(--text);
      background: rgba(125,211,252,.15);
      border:1px solid rgba(125,211,252,.25);
      padding:4px 8px;
      border-radius:999px;
      margin-bottom:8px;
    }
    .printOnly{display:none}
    @media print{
      body{background:#fff; color:#000}
      nav.toc, .controls, .copyBtn, .copyToast{display:none !important}
      section{box-shadow:none; background:#fff; border:1px solid #ccc}
      canvas{display:none}
      .printOnly{display:block}
      a{color:#000}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div>
      <h1>Separation of Variables (PDEs): Wave with Fixed Ends & Heat with Insulated Ends</h1>
      <p class="sub">
        We solve two classic 1D PDE boundary-value problems using eigenfunction expansions:
        (1) wave equation on <code>[0,1]</code> with fixed ends; (2) heat equation on <code>[0,π]</code> with Neumann (insulated) ends.
      </p>
      <div class="badgeRow">
        <span class="badge">Method: separation of variables</span>
        <span class="badge">Sine series (Dirichlet BC)</span>
        <span class="badge">Cosine series incl. n=0 mode (Neumann BC)</span>
        <span class="badge">Interactive plots (truncate series)</span>
      </div>
    </div>
    <div class="callout">
      <strong>Quick Summary</strong>
      <ul>
        <li><strong>Wave (L=1):</strong> expand the constant initial shape <code>30</code> in a sine series; time factors are <code>cos(nπt)</code> because initial velocity is zero.</li>
        <li><strong>Wave result:</strong> only <em>odd</em> modes appear: <code>b_n = 120/(nπ)</code> for odd <code>n</code>.</li>
        <li><strong>Heat (0..π):</strong> Neumann BC → cosine series, and the <code>n=0</code> (constant) mode is crucial.</li>
        <li><strong>Heat result:</strong> solution relaxes to the spatial average <code>π/2</code>; only odd cosine modes appear with coefficients <code>a_n = -4/(π n^2)</code> for odd <code>n</code>.</li>
        <li>Interactive plots let you vary <strong>time</strong>, <strong>probe position</strong>, and <strong>number of terms</strong> to see convergence and physics.</li>
      </ul>
      <div class="kpi">
        <div class="card">
          <div class="label">Wave speed</div>
          <div class="val"><code>c = 1</code></div>
        </div>
        <div class="card">
          <div class="label">Thermal diffusivity</div>
          <div class="val"><code>κ = 5</code></div>
        </div>
        <div class="card">
          <div class="label">Key eigenfunctions</div>
          <div class="val"><code>sin(nπx)</code> / <code>cos(nx)</code></div>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="grid">
  <nav class="toc" aria-label="Table of contents">
    <h2>Table of Contents</h2>
    <a href="#part1">PART 1 — Problem Analysis</a>
    <a href="#part2">PART 2 — Strategy & Tips</a>
    <a href="#part3">PART 3 — Full Solution</a>
    <a href="#viz">Interactive Visualizations</a>
    <a href="#checks">Sanity Checks</a>
  </nav>

  <main>
    <section id="part1">
      <h2>PART 1 — Problem Analysis (no solving yet)</h2>

      <article>
        <h3>Rewrite the problems (in my own words)</h3>
        <p class="muted">
          We have two separate PDE initial–boundary value problems in 1D.
        </p>

        <div class="cols">
          <div class="callout">
            <strong>Problem 80 (Wave, fixed ends, L=1)</strong>
            <ul>
              <li>PDE: <code>y_tt = y_xx</code> for <code>0 &lt; x &lt; 1</code>, <code>t &gt; 0</code>.</li>
              <li>Boundary conditions (fixed ends): <code>y(0,t)=0</code>, <code>y(1,t)=0</code>.</li>
              <li>Initial conditions: <code>y(x,0)=30</code> (flat displacement), <code>y_t(x,0)=0</code> (released from rest).</li>
            </ul>
          </div>

          <div class="callout">
            <strong>Problem 81 (Heat, insulated ends)</strong>
            <ul>
              <li>PDE: <code>u_t = 5 u_xx</code> for <code>0 &lt; x &lt; π</code>, <code>t &gt; 0</code>.</li>
              <li>Boundary conditions (insulated): <code>u_x(0,t)=0</code>, <code>u_x(π,t)=0</code>.</li>
              <li>Initial condition: <code>u(x,0)=x</code>.</li>
            </ul>
          </div>
        </div>

        <h3>Given quantities, unknowns, and what must be found</h3>
        <div class="cols">
          <div>
            <ul>
              <li><strong>Given:</strong> PDE form, domain length (<code>1</code> or <code>π</code>), boundary conditions, initial conditions.</li>
              <li><strong>Unknowns:</strong> the fields <code>y(x,t)</code> and <code>u(x,t)</code>.</li>
              <li><strong>Find:</strong> explicit series solutions satisfying PDE + BC + IC.</li>
            </ul>
          </div>
          <div class="callout warn">
            <strong>Important observation</strong>
            <ul>
              <li>Wave with <strong>Dirichlet</strong> BC uses a <strong>sine</strong> basis.</li>
              <li>Heat with <strong>Neumann</strong> BC uses a <strong>cosine</strong> basis, and the <strong>n=0</strong> (constant) mode matters.</li>
            </ul>
          </div>
        </div>

        <h3>Relevant physical principles (and why they apply)</h3>
        <ul>
          <li><strong>Wave equation:</strong> models small transverse vibrations of a taut string. Fixed ends force zero displacement at the boundaries, hence Dirichlet BC.</li>
          <li><strong>Heat equation:</strong> models diffusion of temperature. Insulated ends mean no heat flux through boundaries, i.e., <code>-k u_x = 0</code> ⇒ <code>u_x=0</code> (Neumann BC).</li>
          <li><strong>Linearity:</strong> both PDEs are linear, so we can superpose separated solutions and match initial data via Fourier series.</li>
        </ul>

        <h3>Possible approaches (2–3) and comparison</h3>
        <ul>
          <li><strong>Separation of variables + Fourier series (best here):</strong> directly matches standard homogeneous BCs; gives clean eigenfunction expansions.</li>
          <li><strong>Eigenfunction expansion viewpoint (Sturm–Liouville):</strong> same math as separation, framed as expanding in operator eigenmodes (very systematic).</li>
          <li><strong>Transforms / Green’s functions:</strong> possible, but usually heavier for finite domains with these BCs.</li>
        </ul>

        <p><strong>Chosen approach:</strong> Separation of variables + Fourier series, because the domains are finite, BCs are homogeneous, and initial data can be expanded in the matching eigenfunctions.</p>
      </article>
    </section>

    <section id="part2">
      <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

      <article>
        <h3>Minimal step-by-step plan (applies to both problems)</h3>
        <ol>
          <li><strong>Assume a separated form</strong> (<code>X(x)T(t)</code>) to convert the PDE into ODEs. <span class="muted">Tool: separation of variables</span></li>
          <li><strong>Use the boundary conditions</strong> to quantize eigenvalues and pick eigenfunctions. <span class="muted">Tool: Sturm–Liouville eigenvalue problems</span></li>
          <li><strong>Write the general series solution</strong> as a sum over modes. <span class="muted">Tool: superposition (linearity)</span></li>
          <li><strong>Apply initial conditions</strong> to determine Fourier coefficients. <span class="muted">Tool: sine/cosine orthogonality integrals</span></li>
          <li><strong>Simplify coefficients</strong> (often only odd/even modes survive). <span class="muted">Tool: trig identities, parity</span></li>
          <li><strong>Interpret the physics</strong> (oscillation vs decay; conserved energy vs monotone smoothing). <span class="muted">Tool: qualitative PDE behavior</span></li>
        </ol>

        <div class="cols">
          <div class="callout warn">
            <strong>Common mistakes</strong>
            <ul>
              <li>Using sine series for Neumann BC (should be cosine, including <code>n=0</code>).</li>
              <li>For the wave equation, forgetting the second time-branch: <code>cos(ωt)</code> and <code>sin(ωt)</code>.</li>
              <li>Dropping the <code>n=0</code> mode in the Neumann heat problem (this changes the long-time limit).</li>
              <li>Mixing domains: wave uses <code>sin(nπx)</code> on <code>[0,1]</code>; heat uses <code>cos(nx)</code> on <code>[0,π]</code>.</li>
            </ul>
          </div>
          <div class="callout">
            <strong>Quick tips</strong>
            <ul>
              <li>Dirichlet (fixed ends) → <code>sin</code> basis; Neumann (insulated) → <code>cos</code> basis.</li>
              <li>Wave: IC <code>y_t(x,0)=0</code> usually kills the <code>sin(ωt)</code> time terms.</li>
              <li>Heat: long time limit equals the spatial average of the initial temperature.</li>
              <li>When expanding a constant in a sine series on <code>[0,1]</code>, only odd modes appear.</li>
            </ul>
          </div>
        </div>
      </article>
    </section>

    <section id="part3">
      <h2>PART 3 — Full Solution</h2>

      <article>
        <h3>Physical intuition (before the math)</h3>
        <ul>
          <li><strong>Wave (fixed ends):</strong> the string is pulled into a flat “plateau” at height 30, then released. Because the ends must remain at 0, the string immediately “wants” to bend near the boundaries, which requires a sum of many sine modes. With no initial velocity, each mode oscillates as a cosine in time.</li>
          <li><strong>Heat (insulated ends):</strong> the initial temperature increases linearly from 0 to <code>π</code>. Insulation means no heat leaves, so the average temperature is conserved. Diffusion smooths the profile toward the constant average <code>π/2</code>, with higher modes decaying faster.</li>
        </ul>

        <h3>Problem 80 — Wave equation on <code>[0,1]</code> with fixed ends</h3>

        <p><strong>PDE:</strong> <code>y_tt = y_xx</code>. Assume a separated solution <code>y(x,t)=X(x)T(t)</code>. Then</p>
        <div class="eq">
          <button class="copyBtn" data-copy="(X(x)T(t))_tt = (X(x)T(t))_xx  =>  X T'' = X'' T  =>  T''/T = X''/X = -λ">Copy</button>
          <pre>(X(x)T(t))_tt = (X(x)T(t))_xx
=> X(x) T''(t) = X''(x) T(t)
=> T''/T = X''/X = -λ</pre>
        </div>

        <p>So we solve:</p>
        <ul>
          <li>Spatial ODE: <code>X'' + λ X = 0</code> with <code>X(0)=0</code>, <code>X(1)=0</code>.</li>
          <li>Time ODE: <code>T'' + λ T = 0</code>.</li>
        </ul>

        <p><strong>Eigenvalues/eigenfunctions (Dirichlet):</strong> Nontrivial solutions occur for</p>
        <div class="eq">
          <button class="copyBtn" data-copy="λ_n = (nπ)^2,   X_n(x) = sin(nπ x),   n=1,2,3,...">Copy</button>
          <pre>λ_n = (nπ)^2,
X_n(x) = sin(nπ x),  n = 1,2,3,...</pre>
        </div>

        <p>Then <code>T_n</code> solves <code>T_n'' + (nπ)^2 T_n = 0</code>, so</p>
        <div class="eq">
          <button class="copyBtn" data-copy="T_n(t) = A_n cos(nπ t) + B_n sin(nπ t)">Copy</button>
          <pre>T_n(t) = A_n cos(nπ t) + B_n sin(nπ t)</pre>
        </div>

        <p><strong>Superposition:</strong> the general solution satisfying the BC is</p>
        <div class="eq">
          <button class="copyBtn" data-copy="y(x,t) = Σ_{n=1}^∞ [A_n cos(nπ t) + B_n sin(nπ t)] sin(nπ x)">Copy</button>
          <pre>y(x,t) = Σ_{n=1}^∞ [A_n cos(nπ t) + B_n sin(nπ t)] sin(nπ x)</pre>
        </div>

        <p><strong>Apply IC #1:</strong> <code>y(x,0)=30</code>. Since <code>cos(0)=1</code>, <code>sin(0)=0</code>,</p>
        <div class="eq">
          <button class="copyBtn" data-copy="30 = Σ_{n=1}^∞ A_n sin(nπ x)  (sine series on [0,1])">Copy</button>
          <pre>30 = Σ_{n=1}^∞ A_n sin(nπ x)</pre>
        </div>

        <p>Compute the sine coefficients using orthogonality on <code>[0,1]</code>:</p>
        <div class="eq">
          <button class="copyBtn" data-copy="A_n = 2∫_0^1 30 sin(nπ x) dx = 60 * (1 - cos(nπ)) / (nπ) = 60*(1-(-1)^n)/(nπ)">Copy</button>
          <pre>A_n = 2 ∫_0^1 30 sin(nπ x) dx
    = 60 [ -cos(nπ x)/(nπ) ]_0^1
    = 60 (1 - cos(nπ)) / (nπ)
    = 60 (1 - (-1)^n)/(nπ)</pre>
        </div>

        <p>So only odd <code>n</code> survive:</p>
        <ul>
          <li>If <code>n</code> is even, <code>1-(-1)^n = 0</code> ⇒ <code>A_n=0</code>.</li>
          <li>If <code>n</code> is odd, <code>1-(-1)^n = 2</code> ⇒ <code>A_n = 120/(nπ)</code>.</li>
        </ul>

        <p><strong>Apply IC #2:</strong> <code>y_t(x,0)=0</code>. Differentiate the series:</p>
        <div class="eq">
          <button class="copyBtn" data-copy="y_t(x,t) = Σ_{n=1}^∞ [-A_n (nπ) sin(nπ t) + B_n (nπ) cos(nπ t)] sin(nπ x)">Copy</button>
          <pre>y_t(x,t) = Σ_{n=1}^∞ [-A_n (nπ) sin(nπ t) + B_n (nπ) cos(nπ t)] sin(nπ x)</pre>
        </div>

        <p>At <code>t=0</code>, <code>sin(0)=0</code>, <code>cos(0)=1</code>, giving</p>
        <div class="eq">
          <button class="copyBtn" data-copy="0 = y_t(x,0) = Σ_{n=1}^∞ B_n (nπ) sin(nπ x)  =>  B_n = 0 for all n">Copy</button>
          <pre>0 = y_t(x,0) = Σ_{n=1}^∞ B_n (nπ) sin(nπ x)
=> B_n = 0  for all n</pre>
        </div>

        <div class="boxFinal">
          <div class="tag">Final Answer — Problem 80</div>
          <div class="eq">
            <button class="copyBtn" data-copy="y(x,t) = Σ_{n=1,3,5,...}^∞ (120/(nπ)) cos(nπ t) sin(nπ x),   0≤x≤1, t≥0">Copy</button>
            <pre><strong>y(x,t) = Σ_{n=1,3,5,...}^∞ (120/(nπ)) cos(nπ t) sin(nπ x)</strong>
(0 ≤ x ≤ 1,  t ≥ 0)</pre>
          </div>
        </div>

        <h3>Problem 81 — Heat equation on <code>[0,π]</code> with insulated ends</h3>

        <p><strong>PDE:</strong> <code>u_t = 5 u_xx</code>. Again try <code>u(x,t)=X(x)T(t)</code>. Then</p>
        <div class="eq">
          <button class="copyBtn" data-copy="X T' = 5 X'' T  =>  T'/ (5T) = X''/X = -λ">Copy</button>
          <pre>X(x) T'(t) = 5 X''(x) T(t)
=> T'/(5T) = X''/X = -λ</pre>
        </div>

        <p>So we solve:</p>
        <ul>
          <li>Spatial: <code>X'' + λ X = 0</code> with Neumann BC <code>X'(0)=0</code>, <code>X'(π)=0</code>.</li>
          <li>Time: <code>T' + 5λ T = 0</code> ⇒ exponential decay.</li>
        </ul>

        <p><strong>Eigenvalues/eigenfunctions (Neumann):</strong></p>
        <ul>
          <li><code>λ_0 = 0</code> with <code>X_0(x)=1</code> (the constant mode).</li>
          <li><code>λ_n = n^2</code> with <code>X_n(x)=cos(nx)</code> for <code>n=1,2,3,...</code></li>
        </ul>

        <p>Time factors:</p>
        <div class="eq">
          <button class="copyBtn" data-copy="T_0(t)=constant,  and  T_n(t)=exp(-5 n^2 t) for n≥1">Copy</button>
          <pre>T_0(t) = constant
T_n(t) = e^{-5 n^2 t},  n ≥ 1</pre>
        </div>

        <p><strong>General cosine-series solution:</strong></p>
        <div class="eq">
          <button class="copyBtn" data-copy="u(x,t) = a_0 + Σ_{n=1}^∞ a_n e^{-5 n^2 t} cos(nx)">Copy</button>
          <pre>u(x,t) = a_0 + Σ_{n=1}^∞ a_n e^{-5 n^2 t} cos(nx)</pre>
        </div>

        <p>Use <code>u(x,0)=x</code> to find the cosine coefficients on <code>[0,π]</code>:</p>

        <p><strong>Constant mode:</strong></p>
        <div class="eq">
          <button class="copyBtn" data-copy="a_0 = (1/π)∫_0^π x dx = π/2">Copy</button>
          <pre>a_0 = (1/π) ∫_0^π x dx
    = (1/π) [x^2/2]_0^π
    = π/2</pre>
        </div>

        <p><strong>For n ≥ 1:</strong></p>
        <div class="eq">
          <button class="copyBtn" data-copy="a_n = (2/π)∫_0^π x cos(nx) dx = (2/π)*(((-1)^n - 1)/n^2)">Copy</button>
          <pre>a_n = (2/π) ∫_0^π x cos(nx) dx

Compute the integral:
∫ x cos(nx) dx = x sin(nx)/n + cos(nx)/n^2

Evaluate 0..π:
= [x sin(nx)/n + cos(nx)/n^2]_0^π
= (π sin(nπ))/n + cos(nπ)/n^2 - (0 + 1/n^2)
= ((-1)^n - 1)/n^2

So:
a_n = (2/π) * (( (-1)^n - 1 )/n^2)</pre>
        </div>

        <p>Thus:</p>
        <ul>
          <li>If <code>n</code> is even, <code>((-1)^n - 1)=0</code> ⇒ <code>a_n=0</code>.</li>
          <li>If <code>n</code> is odd, <code>((-1)^n - 1)= -2</code> ⇒ <code>a_n = -4/(π n^2)</code>.</li>
        </ul>

        <div class="boxFinal">
          <div class="tag">Final Answer — Problem 81</div>
          <div class="eq">
            <button class="copyBtn" data-copy="u(x,t) = π/2 - (4/π) Σ_{n=1,3,5,...}^∞ (1/n^2) e^{-5 n^2 t} cos(nx),   0≤x≤π, t≥0">Copy</button>
            <pre><strong>u(x,t) = π/2 - (4/π) Σ_{n=1,3,5,...}^∞ (1/n^2) e^{-5 n^2 t} cos(nx)</strong>
(0 ≤ x ≤ π,  t ≥ 0)</pre>
          </div>
        </div>
      </article>
    </section>

    <section id="checks">
      <h2>Sanity Checks</h2>
      <div class="cols">
        <div class="callout">
          <strong>Wave (Problem 80)</strong>
          <ul>
            <li><strong>BC check:</strong> each term has <code>sin(nπx)</code>, so <code>y(0,t)=y(1,t)=0</code>.</li>
            <li><strong>IC check:</strong> at <code>t=0</code>, the cosine factors become 1 and the sine-time branch is absent, so we recover the sine series for the constant 30.</li>
            <li><strong>Units:</strong> here variables are nondimensionalized; the form is consistent. If <code>x</code> had length units, then wave speed would set time units.</li>
            <li><strong>Physics:</strong> modes oscillate forever (no damping), consistent with ideal wave equation.</li>
          </ul>
        </div>
        <div class="callout">
          <strong>Heat (Problem 81)</strong>
          <ul>
            <li><strong>BC check:</strong> derivative of <code>cos(nx)</code> is <code>-n sin(nx)</code>, zero at <code>0</code> and <code>π</code>.</li>
            <li><strong>Long-time limit:</strong> <code>e^{-5n^2 t} → 0</code>, so <code>u(x,t)→a_0=π/2</code> (the initial average). Good.</li>
            <li><strong>Conservation:</strong> Neumann BC implies no flux at boundaries, so average temperature stays constant.</li>
            <li><strong>Physics:</strong> higher modes decay faster (rate ∝ <code>n^2</code>), so the profile becomes smooth quickly.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="viz">
      <h2>Interactive Visualizations</h2>
      <p class="muted">
        Use the controls to switch between the two problems and to change time <code>t</code>, truncation level <code>N</code>, and probe position <code>x_p</code>.
        The plots are computed from the exact series (truncated for visualization).
      </p>

      <div class="controls" role="group" aria-label="Interactive controls">
        <div class="ctrl">
          <label for="problemSel">Problem / Model</label>
          <select id="problemSel">
            <option value="wave">Problem 80 — Wave (0..1, fixed ends)</option>
            <option value="heat">Problem 81 — Heat (0..π, insulated ends)</option>
          </select>
          <div class="row" style="margin-top:8px;">
            <span class="muted">Domain</span>
            <span class="val" id="domainText">x ∈ [0, 1]</span>
          </div>
        </div>

        <div class="ctrl">
          <label for="timeSlider">Time t</label>
          <input id="timeSlider" type="range" min="0" max="4" step="0.01" value="0.7"/>
          <div class="row">
            <span class="muted">t</span>
            <span class="val" id="timeVal">0.70</span>
          </div>
        </div>

        <div class="ctrl">
          <label for="nSlider">Number of terms N</label>
          <input id="nSlider" type="range" min="1" max="99" step="2" value="21"/>
          <div class="row">
            <span class="muted">odd modes up to</span>
            <span class="val" id="nVal">21</span>
          </div>
        </div>

        <div class="ctrl">
          <label for="xpSlider">Probe position x<sub>p</sub></label>
          <input id="xpSlider" type="range" min="0" max="1" step="0.001" value="0.35"/>
          <div class="row">
            <span class="muted">x<sub>p</sub></span>
            <span class="val" id="xpVal">0.350</span>
          </div>
        </div>
      </div>

      <div class="vizWrap" style="margin-top:12px;">
        <div class="canvasCard small">
          <div class="canvasHead">
            <div class="title">Diagram: 1D domain & boundary type</div>
            <div class="hint">Updates with model selection</div>
          </div>
          <canvas id="canvasDiagram" aria-label="Diagram canvas"></canvas>
        </div>

        <div class="canvasCard">
          <div class="canvasHead">
            <div class="title" id="mainTitle">Main Plot: Field profile vs x</div>
            <div class="hint">Series truncated to N odd modes</div>
          </div>
          <canvas id="canvasMain" aria-label="Main plot canvas"></canvas>
        </div>

        <div class="canvasCard">
          <div class="canvasHead">
            <div class="title" id="secTitle">Secondary Plot: Time trace at probe x_p</div>
            <div class="hint">Shows oscillation (wave) or relaxation (heat)</div>
          </div>
          <canvas id="canvasSecondary" aria-label="Secondary plot canvas"></canvas>
        </div>
      </div>

      <div class="printOnly">
        <p><strong>Print note:</strong> Interactive canvases are hidden in print view.</p>
      </div>
    </section>
  </main>
</div>

<footer class="footer">
  <p>
    Built with vanilla HTML/CSS/JS. Numerical plots use truncated Fourier series to visualize the exact analytical solutions.
    For sharp features (like the wave’s constant initial condition), increasing <code>N</code> improves approximation but also reveals Gibbs oscillations near discontinuities at the boundaries.
  </p>
</footer>

<div id="copyToast" class="copyToast" role="status" aria-live="polite">Copied.</div>

<script>
/* =========================
   Utilities: copy buttons
========================= */
(function(){
  const toast = document.getElementById('copyToast');
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 900);
  }
  async function copyText(txt){
    try{
      await navigator.clipboard.writeText(txt);
      showToast("Copied to clipboard.");
    }catch(e){
      // fallback
      const ta = document.createElement('textarea');
      ta.value = txt;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      showToast("Copied (fallback).");
    }
  }
  document.addEventListener('click', (ev)=>{
    const btn = ev.target.closest('.copyBtn');
    if(!btn) return;
    const txt = btn.getAttribute('data-copy') || '';
    copyText(txt);
  });
})();

/* =========================
   High-DPI canvas helper
========================= */
function setupHiDPICanvas(canvas){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(2, Math.floor(rect.width * dpr));
  const h = Math.max(2, Math.floor(rect.height * dpr));
  if(canvas.width !== w || canvas.height !== h){
    canvas.width = w;
    canvas.height = h;
  }
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  return {ctx, w: rect.width, h: rect.height, dpr};
}

function lerp(a,b,t){ return a + (b-a)*t; }

/* =========================
   Math: series solutions
========================= */

// Problem 80 (Wave) on x in [0,1]:
// y(x,t) = sum_{n odd <= N} (120/(nπ)) cos(nπ t) sin(nπ x)
function yWave(x,t,N){
  let s = 0;
  const pi = Math.PI;
  for(let n=1; n<=N; n+=2){
    s += (120/(n*pi)) * Math.cos(n*pi*t) * Math.sin(n*pi*x);
  }
  return s;
}

// Problem 81 (Heat) on x in [0,π]:
// u(x,t) = π/2 - (4/π) sum_{n odd <= N} (1/n^2) e^{-5 n^2 t} cos(n x)
function uHeat(x,t,N){
  const pi = Math.PI;
  let s = pi/2;
  let sum = 0;
  for(let n=1; n<=N; n+=2){
    sum += (1/(n*n)) * Math.exp(-5*n*n*t) * Math.cos(n*x);
  }
  s -= (4/pi) * sum;
  return s;
}

/* =========================
   Plotting primitives
========================= */
function drawPanelBackground(ctx, W, H){
  // subtle vignette
  ctx.save();
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = "rgba(0,0,0,0)";
  ctx.fillRect(0,0,W,H);
  ctx.restore();
}

function drawAxes(ctx, W, H, box, xLabel, yLabel, title, xTicks, yTicks){
  // box: {l,t,r,b} in px (CSS px)
  const {l,t,r,b} = box;
  ctx.save();

  // Title
  ctx.fillStyle = "rgba(233,238,252,0.95)";
  ctx.font = "600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(title, l, t - 10);

  // Grid
  ctx.strokeStyle = "rgba(255,255,255,0.08)";
  ctx.lineWidth = 1;
  for(const xt of xTicks){
    const x = lerp(l,r,xt.p);
    ctx.beginPath(); ctx.moveTo(x,t); ctx.lineTo(x,b); ctx.stroke();
  }
  for(const yt of yTicks){
    const y = lerp(b,t,yt.p);
    ctx.beginPath(); ctx.moveTo(l,y); ctx.lineTo(r,y); ctx.stroke();
  }

  // Axes
  ctx.strokeStyle = "rgba(255,255,255,0.22)";
  ctx.lineWidth = 1.2;
  ctx.beginPath();
  ctx.moveTo(l,b); ctx.lineTo(r,b);
  ctx.moveTo(l,b); ctx.lineTo(l,t);
  ctx.stroke();

  // Ticks + labels
  ctx.fillStyle = "rgba(185,196,234,0.95)";
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace";

  // X tick labels
  for(const xt of xTicks){
    const x = lerp(l,r,xt.p);
    ctx.strokeStyle = "rgba(255,255,255,0.22)";
    ctx.beginPath(); ctx.moveTo(x,b); ctx.lineTo(x,b+5); ctx.stroke();
    const txt = xt.label;
    const tw = ctx.measureText(txt).width;
    ctx.fillText(txt, x - tw/2, b + 18);
  }

  // Y tick labels
  for(const yt of yTicks){
    const y = lerp(b,t,yt.p);
    ctx.strokeStyle = "rgba(255,255,255,0.22)";
    ctx.beginPath(); ctx.moveTo(l-5,y); ctx.lineTo(l,y); ctx.stroke();
    const txt = yt.label;
    const tw = ctx.measureText(txt).width;
    ctx.fillText(txt, l - 8 - tw, y + 4);
  }

  // Axis labels
  ctx.fillStyle = "rgba(233,238,252,0.9)";
  ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  // x label
  const xw = ctx.measureText(xLabel).width;
  ctx.fillText(xLabel, (l+r)/2 - xw/2, H - 10);
  // y label (rotated)
  ctx.save();
  ctx.translate(14, (t+b)/2);
  ctx.rotate(-Math.PI/2);
  const yw = ctx.measureText(yLabel).width;
  ctx.fillText(yLabel, -yw/2, 0);
  ctx.restore();

  ctx.restore();
}

function clipToPlot(ctx, box){
  ctx.save();
  ctx.beginPath();
  ctx.rect(box.l, box.t, box.r - box.l, box.b - box.t);
  ctx.clip();
}

function unclip(ctx){
  ctx.restore();
}

function mapX(x, xmin, xmax, box){
  return lerp(box.l, box.r, (x - xmin)/(xmax - xmin));
}
function mapY(y, ymin, ymax, box){
  return lerp(box.b, box.t, (y - ymin)/(ymax - ymin));
}

function niceTicks(min, max, count){
  // simple nice ticks
  if(max === min){
    max = min + 1;
  }
  const span = Math.abs(max-min);
  const rawStep = span / Math.max(1, count);
  const pow10 = Math.pow(10, Math.floor(Math.log10(rawStep)));
  const steps = [1,2,5,10];
  let step = steps[0]*pow10;
  for(const s of steps){
    const st = s*pow10;
    if(rawStep <= st){ step = st; break; }
  }
  const start = Math.ceil(min/step)*step;
  const end = Math.floor(max/step)*step;
  const ticks = [];
  for(let v=start; v<=end+1e-12; v+=step){
    ticks.push(v);
  }
  return ticks;
}

function fmt(v){
  // compact formatting
  const av = Math.abs(v);
  if(av >= 1000) return v.toFixed(0);
  if(av >= 100) return v.toFixed(0);
  if(av >= 10) return v.toFixed(1);
  if(av >= 1) return v.toFixed(2);
  return v.toFixed(3);
}

/* =========================
   Drawing: Diagram
========================= */
function drawDiagram(canvas, model){
  const {ctx, w:W, h:H} = setupHiDPICanvas(canvas);
  drawPanelBackground(ctx, W, H);

  // layout
  const pad = 18;
  const x0 = pad, x1 = W - pad;
  const yMid = H*0.56;

  // baseline
  ctx.strokeStyle = "rgba(255,255,255,0.25)";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(x0, yMid);
  ctx.lineTo(x1, yMid);
  ctx.stroke();

  // endpoints
  const endR = 7;
  ctx.fillStyle = "rgba(125,211,252,0.95)";
  ctx.beginPath(); ctx.arc(x0, yMid, endR, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(x1, yMid, endR, 0, Math.PI*2); ctx.fill();

  // boundary icons/text
  ctx.font = "600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillStyle = "rgba(233,238,252,0.92)";

  if(model === "wave"){
    ctx.fillText("Fixed end: y(0,t)=0", x0+12, yMid-14);
    const tw = ctx.measureText("Fixed end: y(1,t)=0").width;
    ctx.fillText("Fixed end: y(1,t)=0", x1-12-tw, yMid-14);

    // initial shape (flat at 30 but must be 0 at ends -> show a conceptual “flat” line with boundary kinks)
    ctx.strokeStyle = "rgba(167,139,250,0.85)";
    ctx.lineWidth = 3;
    const yTop = H*0.28;
    ctx.beginPath();
    ctx.moveTo(x0, yMid);
    ctx.lineTo(x0 + (x1-x0)*0.06, yTop);
    ctx.lineTo(x1 - (x1-x0)*0.06, yTop);
    ctx.lineTo(x1, yMid);
    ctx.stroke();

    ctx.fillStyle = "rgba(185,196,234,0.95)";
    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace";
    ctx.fillText("initial: y(x,0)=30 (conceptual)", x0, H-18);

    // axis label x
    ctx.fillStyle = "rgba(233,238,252,0.85)";
    ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText("x", x1-10, yMid+22);
    ctx.fillText("0", x0-2, yMid+22);
    ctx.fillText("1", x1-6, yMid+22);
  }else{
    ctx.fillText("Insulated: u_x(0,t)=0", x0+12, yMid-14);
    const tw = ctx.measureText("Insulated: u_x(π,t)=0").width;
    ctx.fillText("Insulated: u_x(π,t)=0", x1-12-tw, yMid-14);

    // initial linear temperature profile
    ctx.strokeStyle = "rgba(52,211,153,0.85)";
    ctx.lineWidth = 3;
    const yLow = H*0.70;
    const yHigh = H*0.30;
    ctx.beginPath();
    ctx.moveTo(x0, yLow);
    ctx.lineTo(x1, yHigh);
    ctx.stroke();

    ctx.fillStyle = "rgba(185,196,234,0.95)";
    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace";
    ctx.fillText("initial: u(x,0)=x", x0, H-18);

    // axis label x
    ctx.fillStyle = "rgba(233,238,252,0.85)";
    ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText("x", x1-10, yMid+22);
    ctx.fillText("0", x0-2, yMid+22);
    ctx.fillText("π", x1-6, yMid+22);
  }
}

/* =========================
   Drawing: Main plot y/u vs x
========================= */
function drawMainPlot(canvas, model, t, N){
  const {ctx, w:W, h:H} = setupHiDPICanvas(canvas);
  drawPanelBackground(ctx, W, H);

  const box = {l:70, t:46, r:W-18, b:H-48};

  // data sampling
  const M = 800;
  const xs = new Array(M);
  const ys = new Array(M);
  let xmin, xmax;
  if(model === "wave"){ xmin=0; xmax=1; }
  else { xmin=0; xmax=Math.PI; }

  let yMin = Infinity, yMax = -Infinity;
  for(let i=0;i<M;i++){
    const x = xmin + (xmax-xmin)*i/(M-1);
    let val = (model==="wave") ? yWave(x,t,N) : uHeat(x,t,N);
    xs[i]=x; ys[i]=val;
    if(val<yMin) yMin=val;
    if(val>yMax) yMax=val;
  }

  // padding
  const pad = 0.12*(yMax-yMin || 1);
  yMin -= pad; yMax += pad;

  // ticks
  const xTickCount = 6;
  const yTickCount = 6;
  const xTicks = [];
  for(let k=0;k<=xTickCount;k++){
    const p = k/xTickCount;
    const xv = xmin + (xmax-xmin)*p;
    let lbl;
    if(model==="wave"){
      lbl = (k===0) ? "0" : (k===xTickCount) ? "1" : fmt(xv);
    }else{
      // show 0, π/2, π if close, otherwise numeric
      const pi = Math.PI;
      if(Math.abs(xv-0)<1e-9) lbl="0";
      else if(Math.abs(xv-pi/2)<1e-6) lbl="π/2";
      else if(Math.abs(xv-pi)<1e-6) lbl="π";
      else lbl = fmt(xv);
    }
    xTicks.push({p, label: lbl});
  }
  const yVals = niceTicks(yMin, yMax, yTickCount);
  const yTicks = yVals.map(v=>({p:(v-yMin)/(yMax-yMin), label: fmt(v)}));

  const title = model==="wave"
    ? `Wave: y(x,t) at t = ${t.toFixed(2)} (L=1, fixed ends)`
    : `Heat: u(x,t) at t = ${t.toFixed(2)} (0..π, insulated ends)`;

  const yLabel = model==="wave" ? "y (displacement units)" : "u (temperature units)";
  const xLabel = model==="wave" ? "x (0..1)" : "x (0..π)";

  drawAxes(ctx, W, H, box, xLabel, yLabel, title, xTicks, yTicks);

  // plot line
  clipToPlot(ctx, box);
  ctx.lineWidth = 2.2;
  ctx.strokeStyle = (model==="wave") ? "rgba(167,139,250,0.95)" : "rgba(52,211,153,0.95)";
  ctx.beginPath();
  for(let i=0;i<M;i++){
    const px = mapX(xs[i], xmin, xmax, box);
    const py = mapY(ys[i], yMin, yMax, box);
    if(i===0) ctx.moveTo(px,py);
    else ctx.lineTo(px,py);
  }
  ctx.stroke();

  // reference line: for heat, long-time limit a0=π/2; for wave show y=0 baseline
  ctx.lineWidth = 1.6;
  ctx.setLineDash([6,5]);
  ctx.strokeStyle = "rgba(125,211,252,0.45)";
  ctx.beginPath();
  const yRef = (model==="heat") ? (Math.PI/2) : 0;
  const pyRef = mapY(yRef, yMin, yMax, box);
  ctx.moveTo(box.l, pyRef);
  ctx.lineTo(box.r, pyRef);
  ctx.stroke();
  ctx.setLineDash([]);

  // legend
  ctx.fillStyle = "rgba(233,238,252,0.9)";
  ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(model==="wave" ? "series: odd n modes" : "series: odd n cosine modes", box.l+10, box.t+18);
  ctx.fillStyle = "rgba(185,196,234,0.9)";
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace";
  ctx.fillText(`N = ${N} (odd modes up to N)`, box.l+10, box.t+36);
  ctx.fillText(model==="heat" ? "dashed: π/2 equilibrium" : "dashed: y=0", box.l+10, box.t+54);

  unclip(ctx);
}

/* =========================
   Drawing: Secondary plot (time trace at x_p)
========================= */
function drawSecondaryPlot(canvas, model, tNow, N, xpRaw){
  const {ctx, w:W, h:H} = setupHiDPICanvas(canvas);
  drawPanelBackground(ctx, W, H);

  const box = {l:70, t:46, r:W-18, b:H-48};

  // Map xpRaw slider in [0,1] to actual x domain
  const xmin = 0;
  const xmax = (model==="wave") ? 1 : Math.PI;
  const xp = xmin + (xmax-xmin)*xpRaw;

  // Choose time window:
  // wave: show several periods; heat: show approach; use same slider max but auto window
  const tMax = (model==="wave") ? 4 : 1.2; // keep heat window readable
  const T0 = 0;
  const T1 = tMax;

  // sample
  const M = 700;
  const ts = new Array(M);
  const vs = new Array(M);
  let vMin = Infinity, vMax = -Infinity;
  for(let i=0;i<M;i++){
    const tt = T0 + (T1-T0)*i/(M-1);
    const val = (model==="wave") ? yWave(xp, tt, N) : uHeat(xp, tt, N);
    ts[i]=tt; vs[i]=val;
    if(val<vMin) vMin=val;
    if(val>vMax) vMax=val;
  }
  const pad = 0.12*(vMax-vMin || 1);
  vMin -= pad; vMax += pad;

  // ticks
  const xTicks = [];
  const xTickCount = 6;
  for(let k=0;k<=xTickCount;k++){
    const p = k/xTickCount;
    const tv = T0 + (T1-T0)*p;
    xTicks.push({p, label: fmt(tv)});
  }
  const yVals = niceTicks(vMin, vMax, 6);
  const yTicks = yVals.map(v=>({p:(v-vMin)/(vMax-vMin), label: fmt(v)}));

  const title = model==="wave"
    ? `Wave: y(x_p,t) at x_p = ${xp.toFixed(3)} (showing t in [0, ${T1.toFixed(1)}])`
    : `Heat: u(x_p,t) at x_p = ${xp.toFixed(3)} (showing t in [0, ${T1.toFixed(1)}])`;

  drawAxes(ctx, W, H, box, "t", (model==="wave") ? "y(x_p,t)" : "u(x_p,t)", title, xTicks, yTicks);

  clipToPlot(ctx, box);

  // curve
  ctx.lineWidth = 2.2;
  ctx.strokeStyle = (model==="wave") ? "rgba(167,139,250,0.95)" : "rgba(52,211,153,0.95)";
  ctx.beginPath();
  for(let i=0;i<M;i++){
    const px = mapX(ts[i], T0, T1, box);
    const py = mapY(vs[i], vMin, vMax, box);
    if(i===0) ctx.moveTo(px,py);
    else ctx.lineTo(px,py);
  }
  ctx.stroke();

  // marker at current tNow (clamp into window)
  const tMark = Math.min(Math.max(tNow, T0), T1);
  const vMark = (model==="wave") ? yWave(xp, tMark, N) : uHeat(xp, tMark, N);
  const pxM = mapX(tMark, T0, T1, box);
  const pyM = mapY(vMark, vMin, vMax, box);

  ctx.fillStyle = "rgba(125,211,252,0.95)";
  ctx.beginPath();
  ctx.arc(pxM, pyM, 4.5, 0, Math.PI*2);
  ctx.fill();

  ctx.strokeStyle = "rgba(125,211,252,0.35)";
  ctx.lineWidth = 1.4;
  ctx.setLineDash([6,5]);
  ctx.beginPath();
  ctx.moveTo(pxM, box.t);
  ctx.lineTo(pxM, box.b);
  ctx.stroke();
  ctx.setLineDash([]);

  // reference line: equilibrium for heat, zero for wave
  ctx.lineWidth = 1.6;
  ctx.setLineDash([6,5]);
  ctx.strokeStyle = "rgba(125,211,252,0.45)";
  const vRef = (model==="heat") ? (Math.PI/2) : 0;
  const pyRef = mapY(vRef, vMin, vMax, box);
  ctx.beginPath();
  ctx.moveTo(box.l, pyRef);
  ctx.lineTo(box.r, pyRef);
  ctx.stroke();
  ctx.setLineDash([]);

  // legend text
  ctx.fillStyle = "rgba(185,196,234,0.92)";
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace";
  ctx.fillText(`marker at t = ${tMark.toFixed(2)}; value = ${vMark.toFixed(3)}`, box.l+10, box.t+18);
  ctx.fillText(model==="heat" ? "dashed: π/2 equilibrium" : "dashed: y=0", box.l+10, box.t+36);

  unclip(ctx);
}

/* =========================
   Controller / UI wiring
========================= */
const els = {
  problemSel: document.getElementById('problemSel'),
  timeSlider: document.getElementById('timeSlider'),
  nSlider: document.getElementById('nSlider'),
  xpSlider: document.getElementById('xpSlider'),
  timeVal: document.getElementById('timeVal'),
  nVal: document.getElementById('nVal'),
  xpVal: document.getElementById('xpVal'),
  domainText: document.getElementById('domainText'),
  mainTitle: document.getElementById('mainTitle'),
  secTitle: document.getElementById('secTitle'),
  cDiagram: document.getElementById('canvasDiagram'),
  cMain: document.getElementById('canvasMain'),
  cSec: document.getElementById('canvasSecondary'),
};

function syncUI(model){
  // time slider ranges differ a bit for readability
  if(model === "wave"){
    els.domainText.textContent = "x ∈ [0, 1]";
    els.timeSlider.min = "0";
    els.timeSlider.max = "4";
    els.timeSlider.step = "0.01";
    // xp slider already 0..1 maps to 0..1
  }else{
    els.domainText.textContent = "x ∈ [0, π]";
    els.timeSlider.min = "0";
    els.timeSlider.max = "1.2";
    els.timeSlider.step = "0.005";
  }
  // keep current time but clamp
  const t = parseFloat(els.timeSlider.value);
  const tClamped = Math.min(Math.max(t, parseFloat(els.timeSlider.min)), parseFloat(els.timeSlider.max));
  els.timeSlider.value = String(tClamped);

  // Titles
  els.mainTitle.textContent = (model==="wave")
    ? "Main Plot: y(x,t) profile (wave)"
    : "Main Plot: u(x,t) profile (heat)";
  els.secTitle.textContent = (model==="wave")
    ? "Secondary Plot: y(x_p,t) time trace (oscillation)"
    : "Secondary Plot: u(x_p,t) time trace (relaxation)";
}

function renderAll(){
  const model = els.problemSel.value;
  const t = parseFloat(els.timeSlider.value);
  const N = parseInt(els.nSlider.value, 10); // odd max
  const xpRaw = parseFloat(els.xpSlider.value);

  // Update numeric readouts; map xp to domain for display
  const xmax = (model==="wave") ? 1 : Math.PI;
  const xp = xpRaw * xmax;

  els.timeVal.textContent = t.toFixed( (model==="wave") ? 2 : 3 );
  els.nVal.textContent = String(N);
  els.xpVal.textContent = xp.toFixed(3);

  drawDiagram(els.cDiagram, model);
  drawMainPlot(els.cMain, model, t, N);
  drawSecondaryPlot(els.cSec, model, t, N, xpRaw);
}

// events
els.problemSel.addEventListener('change', ()=>{
  syncUI(els.problemSel.value);
  renderAll();
});
["input","change"].forEach(ev=>{
  els.timeSlider.addEventListener(ev, renderAll);
  els.nSlider.addEventListener(ev, renderAll);
  els.xpSlider.addEventListener(ev, renderAll);
});

// rerender on resize (responsive + crisp)
let resizeTimer = null;
window.addEventListener('resize', ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(renderAll, 80);
});

// init
syncUI(els.problemSel.value);
renderAll();
</script>
</body>
</html>
