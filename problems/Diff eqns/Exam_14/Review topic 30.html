<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Volterra Predator–Prey with Equal Environmental Mortality: Why Sharks Can Increase</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --card2:#0f1730;
      --text:#eaf0ff;
      --muted:#b8c3e6;
      --line:rgba(255,255,255,.12);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --warn:#fde68a;
      --bad:#fca5a5;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 12% 8%, rgba(125,211,252,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(167,139,250,.18), transparent 55%),
        radial-gradient(900px 600px at 60% 105%, rgba(134,239,172,.10), transparent 50%),
        var(--bg);
      line-height:1.55;
    }

    header{
      padding:28px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    .topgrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .topgrid{grid-template-columns:1fr}
    }

    h1{
      margin:0 0 10px;
      font-size:clamp(1.35rem, 2.2vw, 2.05rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      margin:0;
      font-size:1rem;
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:14px 18px 40px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      main{grid-template-columns:1fr}
    }

    nav.toc{
      position:sticky;
      top:12px;
      background:linear-gradient(180deg, rgba(17,26,51,.92), rgba(15,23,48,.88));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px 14px 10px;
      backdrop-filter: blur(10px);
    }
    nav.toc h2{
      font-size:.95rem;
      margin:0 0 8px;
      color:var(--muted);
      font-weight:650;
      letter-spacing:.3px;
    }
    .toc a{
      display:block;
      color:var(--text);
      text-decoration:none;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid transparent;
      transition:transform .15s ease, background .15s ease, border-color .15s ease;
      font-size:.95rem;
    }
    .toc a:hover{
      background:rgba(125,211,252,.10);
      border-color:rgba(125,211,252,.22);
      transform: translateX(2px);
    }
    .toc small{
      display:block;
      color:var(--muted);
      margin-top:10px;
      font-size:.85rem;
    }

    .content{
      display:flex;
      flex-direction:column;
      gap:16px;
      min-width:0;
    }
    section, article{
      background:linear-gradient(180deg, rgba(17,26,51,.92), rgba(15,23,48,.88));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px 16px 14px;
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .quick{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width: 780px){
      .quick{grid-template-columns:1fr}
    }
    .callout{
      background:linear-gradient(180deg, rgba(125,211,252,.12), rgba(125,211,252,.06));
      border:1px solid rgba(125,211,252,.22);
      border-radius:16px;
      padding:12px 12px 10px;
    }
    .callout h3{
      margin:0 0 6px;
      font-size:1rem;
      letter-spacing:.2px;
    }
    .callout ul{
      margin:0;
      padding-left:18px;
      color:var(--muted);
    }
    .callout li{margin:6px 0}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid2{grid-template-columns:1fr}
    }

    h2{
      margin:0 0 10px;
      font-size:1.15rem;
      letter-spacing:.2px;
    }
    h3{
      margin:14px 0 8px;
      font-size:1.02rem;
      color:var(--text);
    }
    p{margin:10px 0; color:var(--muted)}
    ul, ol{color:var(--muted)}
    .muted{color:var(--muted)}
    .badge{
      display:inline-block;
      padding:2px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-size:.85rem;
      margin-right:6px;
      vertical-align:middle;
    }

    .eqbox{
      position:relative;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:12px 12px 10px;
      margin:10px 0;
    }
    pre.eq{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family:var(--mono);
      font-size:.92rem;
      color:#f1f5ff;
      line-height:1.45;
    }
    .copybtn{
      position:absolute;
      top:10px;
      right:10px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.25);
      color:var(--text);
      border-radius:12px;
      padding:7px 10px;
      cursor:pointer;
      font-size:.86rem;
      transition: transform .12s ease, background .12s ease;
      user-select:none;
    }
    .copybtn:hover{background:rgba(125,211,252,.12); transform: translateY(-1px)}
    .copybtn:active{transform: translateY(0px) scale(.99)}

    .note{
      border-left:4px solid rgba(253,230,138,.75);
      background:rgba(253,230,138,.08);
      padding:10px 12px;
      border-radius:12px;
      color:var(--muted);
      margin:10px 0;
    }

    figure{
      margin:0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .canvasWrap{
      background:linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.18));
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:10px;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius:12px;
    }
    .figcap{
      color:var(--muted);
      font-size:.92rem;
      margin:0;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
    }
    .control{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:220px;
      flex: 1 1 260px;
    }
    .control label{
      font-size:.9rem;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:baseline;
    }
    .control input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    .pill{
      font-family:var(--mono);
      font-size:.88rem;
      color:var(--text);
      background:rgba(125,211,252,.12);
      border:1px solid rgba(125,211,252,.22);
      padding:2px 8px;
      border-radius:999px;
      white-space:nowrap;
    }

    .kpiRow{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 780px){
      .kpiRow{grid-template-columns:1fr}
    }
    .kpi{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);
      border-radius:16px;
      padding:10px 12px;
    }
    .kpi .t{color:var(--muted); font-size:.88rem; margin:0 0 4px}
    .kpi .v{font-family:var(--mono); font-size:1.05rem; margin:0; color:#f7fbff}

    .final{
      border:1px solid rgba(134,239,172,.25);
      background:linear-gradient(180deg, rgba(134,239,172,.12), rgba(134,239,172,.06));
      border-radius:16px;
      padding:12px 12px 10px;
      margin-top:12px;
    }
    .final strong{color:#d7ffe7}
    .hr{
      height:1px;
      background:rgba(255,255,255,.10);
      margin:14px 0;
    }

    footer{
      max-width:1200px;
      margin:0 auto;
      padding:14px 18px 32px;
      color:var(--muted);
      font-size:.9rem;
    }

    @media print{
      nav.toc{display:none}
      body{background:white; color:black}
      section, article{box-shadow:none; background:white; border:1px solid #ddd}
      .copybtn{display:none}
      .canvasWrap{border:1px solid #ddd}
      p, ul, ol{color:#111}
      .subtitle,.muted{color:#333}
    }
  </style>
</head>
<body>
<header>
  <div class="topgrid">
    <div>
      <h1>Problem 94 — Volterra Predator–Prey with Equal “Warming-Water” Mortality</h1>
      <p class="subtitle">We modify the Lotka–Volterra system by adding the same per-capita death rate to both species, then compare equilibria to show the shark population increases.</p>
    </div>
    <div class="callout" aria-label="Quick Summary">
      <h3>Quick Summary</h3>
      <ul>
        <li>Base model: <span class="badge">x′ = a x − p x y</span>, <span class="badge">y′ = −b y + q x y</span> with <span class="badge">a,b,p,q &gt; 0</span>.</li>
        <li>“Warming kills 10%/yr” adds <span class="badge">−d x</span> and <span class="badge">−d y</span> (with <span class="badge">d = 0.10 yr⁻¹</span>).</li>
        <li>New coexistence equilibrium: <span class="badge">x* = (b+d)/q</span>, <span class="badge">y* = (a−d)/p</span>.</li>
        <li>Since <span class="badge">(b+d)/q &gt; b/q</span>, the equilibrium shark population <em>increases</em>.</li>
        <li>Plots below simulate trajectories and phase curves; use the slider to vary <span class="badge">d</span> and watch all graphics update.</li>
      </ul>
    </div>
  </div>
</header>

<main>
  <nav class="toc" aria-label="Table of Contents">
    <h2>Table of Contents</h2>
    <a href="#part1">PART 1 — Problem Analysis</a>
    <a href="#part2">PART 2 — Strategy & Tips</a>
    <a href="#part3">PART 3 — Full Solution</a>
    <a href="#viz">Interactive Visualizations</a>
    <a href="#final">Final Result</a>
    <small>Tip: Click any “Copy” button to grab equations or the boxed answer as plain text.</small>
  </nav>

  <div class="content">

    <section id="part1">
      <h2>PART 1 — Problem Analysis (no solving yet)</h2>

      <h3>Rewrite the problem (in my own words)</h3>
      <p>
        We have two interacting populations modeled by the Volterra (Lotka–Volterra) predator–prey equations:
        one population is sharks <span class="badge">x(t)</span> and the other is fish <span class="badge">y(t)</span>.
        After some years, environmental warming starts killing a fixed fraction (10%) of <em>both</em> species per year.
        We must modify the model accordingly and show that, counterintuitively, the shark population will increase.
      </p>

      <div class="grid2">
        <div>
          <h3>Given quantities</h3>
          <ul>
            <li>Populations: <span class="badge">x(t)</span> (sharks), <span class="badge">y(t)</span> (fish).</li>
            <li>Base equations:
              <span class="badge">x′ = a x − p x y</span>,
              <span class="badge">y′ = −b y + q x y</span>.
            </li>
            <li>Parameters: <span class="badge">a, b, p, q &gt; 0</span>.</li>
            <li>Units: time in years; <span class="badge">a</span> and <span class="badge">b</span> have units <span class="badge">yr⁻¹</span>.</li>
            <li>Environmental mortality: “10% per year” for both species → a per-capita death rate <span class="badge">d = 0.10 yr⁻¹</span>.</li>
          </ul>
        </div>
        <div>
          <h3>Unknowns / what must be shown</h3>
          <ul>
            <li>How to modify the ODEs when both species lose a fixed fraction per year.</li>
            <li>Show (prove) that the shark population increases (in the model’s prediction).</li>
            <li>Interpret the result and check it makes mathematical sense (units, limits).</li>
          </ul>

          <h3>Relevant principles and why they apply</h3>
          <ul>
            <li><strong>Per-capita proportional death</strong>: “10% die per year” means the death term is proportional to population size:
              <span class="badge">−d x</span>, <span class="badge">−d y</span>.
            </li>
            <li><strong>Equilibria of autonomous ODEs</strong>: Long-run outcomes are determined by critical points where
              <span class="badge">x′=0</span> and <span class="badge">y′=0</span>.
            </li>
            <li><strong>Parameter comparison</strong>: We can compare new equilibrium values to old ones to see whether sharks rise or fall.</li>
          </ul>
        </div>
      </div>

      <h3>Possible approaches (and comparison)</h3>
      <ol>
        <li><strong>Equilibrium-shift approach (best):</strong> Add mortality terms, solve for the coexistence equilibrium, then compare with the original equilibrium. Fast, symbolic, and directly answers “increase?”.</li>
        <li><strong>Linearization / stability approach:</strong> Linearize around the equilibrium to confirm the system still tends to (or cycles around) it and interpret “increase” as an equilibrium shift. More work than needed for the claim.</li>
        <li><strong>Explicit solution approach:</strong> Lotka–Volterra has a conserved quantity (in the ideal case), but adding mortality breaks the classic invariant. This route is heavy and unnecessary.</li>
      </ol>
      <p class="note"><strong>Chosen approach:</strong> We’ll use the equilibrium-shift method because the question only asks us to show the shark population increases; comparing equilibria gives a clean proof with minimal extra machinery.</p>
    </section>

    <section id="part2">
      <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

      <ol>
        <li>
          <strong>Translate “10% per year die” into a term.</strong><br/>
          <span class="muted">Goal:</span> express warming mortality as ODE terms.<br/>
          <span class="muted">Tool:</span> per-capita decay law → add <span class="badge">−d x</span> and <span class="badge">−d y</span>.
        </li>
        <li>
          <strong>Write the modified system.</strong><br/>
          <span class="muted">Goal:</span> new ODEs with parameters <span class="badge">a,b,p,q,d</span>.<br/>
          <span class="muted">Tool:</span> superposition of growth/interaction + mortality.
        </li>
        <li>
          <strong>Find the coexistence equilibrium.</strong><br/>
          <span class="muted">Goal:</span> solve <span class="badge">x′=0</span>, <span class="badge">y′=0</span> for <span class="badge">x*, y*</span> with both positive.<br/>
          <span class="muted">Tool:</span> algebraic factorization.
        </li>
        <li>
          <strong>Compare to the original equilibrium.</strong><br/>
          <span class="muted">Goal:</span> show new shark equilibrium is larger than old.<br/>
          <span class="muted">Tool:</span> inequalities using <span class="badge">d&gt;0</span>.
        </li>
        <li>
          <strong>Interpret and sanity-check.</strong><br/>
          <span class="muted">Goal:</span> units, limiting cases (e.g., <span class="badge">d→0</span>), and meaning.
        </li>
      </ol>

      <h3>Common mistakes & quick tips</h3>
      <ul>
        <li><strong>Mixing up “10% per year”</strong>: It’s a per-capita rate (units yr⁻¹), so it becomes <span class="badge">−d x</span>, not <span class="badge">−0.10</span> alone.</li>
        <li><strong>Forgetting positivity conditions</strong>: The coexistence equilibrium only makes biological sense if <span class="badge">a−d &gt; 0</span> (otherwise the positive fish equilibrium becomes non-positive).</li>
        <li><strong>Comparing the wrong equilibrium</strong>: The statement “sharks increase” here is about the model’s predicted equilibrium value for <span class="badge">x</span>, not necessarily “every initial condition immediately rises.”</li>
      </ul>
    </section>

    <article id="part3">
      <h2>PART 3 — Full Solution</h2>

      <h3>Physical (model) intuition first</h3>
      <p>
        The original Volterra system balances growth/decay and interaction.
        Adding warming mortality applies the same proportional “tax” to both populations.
        In the modified model, that shifts the balance point (the coexistence equilibrium).
        The surprising outcome comes from the fact that the shark equilibrium depends on the fish’s effective loss parameter in the <span class="badge">y′</span> equation:
        increasing that loss means the equilibrium value of <span class="badge">x</span> must shift upward to keep <span class="badge">y′=0</span>.
      </p>

      <div class="hr"></div>

      <h3>Step 1: Start from the given Volterra system</h3>
      <div class="eqbox">
        <button class="copybtn" data-copy="eq1">Copy</button>
        <pre class="eq" id="eq1">Given (a, b, p, q > 0):
x'(t) = a x - p x y
y'(t) = -b y + q x y

Time is in years, so a and b have units yr^-1.</pre>
      </div>

      <h3>Step 2: Model “10% die per year” as proportional decay</h3>
      <p>
        If a population <span class="badge">N(t)</span> loses a constant fraction per unit time, the instantaneous rate of loss is proportional to the current size:
        <span class="badge">N′ = −d N</span>.
        Here “10% per year” corresponds to <span class="badge">d = 0.10 yr⁻¹</span> (a per-capita death rate).
        Since warming kills both fish and sharks at that same rate, we subtract <span class="badge">d x</span> from <span class="badge">x′</span> and <span class="badge">d y</span> from <span class="badge">y′</span>.
      </p>

      <div class="eqbox">
        <button class="copybtn" data-copy="eq2">Copy</button>
        <pre class="eq" id="eq2">With warming mortality d (per year), the modified system is:
x' = a x - p x y - d x  = (a - d)x - p x y
y' = -b y + q x y - d y = -(b + d)y + q x y

For 10%/yr: d = 0.10 yr^-1.</pre>
      </div>

      <h3>Step 3: Find equilibria (critical points)</h3>
      <p>
        Equilibria satisfy <span class="badge">x′=0</span> and <span class="badge">y′=0</span>.
        Factor each equation:
      </p>

      <div class="eqbox">
        <button class="copybtn" data-copy="eq3">Copy</button>
        <pre class="eq" id="eq3">Set x' = 0:
0 = (a - d)x - p x y
  = x[(a - d) - p y]
So either x = 0  or  y = (a - d)/p.

Set y' = 0:
0 = -(b + d)y + q x y
  = y[-(b + d) + q x]
So either y = 0  or  x = (b + d)/q.</pre>
      </div>

      <p>
        The <strong>coexistence</strong> equilibrium (both populations positive) uses the nonzero branches:
      </p>

      <div class="eqbox">
        <button class="copybtn" data-copy="eq4">Copy</button>
        <pre class="eq" id="eq4">Coexistence equilibrium (x*, y*):

x* = (b + d)/q
y* = (a - d)/p

This requires a - d > 0 to keep y* > 0.</pre>
      </div>

      <h3>Step 4: Compare with the original (no-warming) equilibrium</h3>
      <p>
        Without warming (<span class="badge">d=0</span>), the coexistence equilibrium is:
      </p>

      <div class="eqbox">
        <button class="copybtn" data-copy="eq5">Copy</button>
        <pre class="eq" id="eq5">Original equilibrium (d = 0):

x0* = b/q
y0* = a/p</pre>
      </div>

      <p>
        Now compare sharks (<span class="badge">x</span>) with and without warming:
      </p>

      <div class="eqbox">
        <button class="copybtn" data-copy="eq6">Copy</button>
        <pre class="eq" id="eq6">Compare shark equilibrium:

x* - x0* = (b + d)/q - b/q
         = d/q

Since d > 0 and q > 0, we have d/q > 0, so x* > x0*.</pre>
      </div>

      <div class="final" id="final">
        <div class="eqbox" style="margin:0; background:transparent; border-color:rgba(134,239,172,.25);">
          <button class="copybtn" data-copy="finaltxt">Copy</button>
          <pre class="eq" id="finaltxt">FINAL RESULT (symbolic):
With equal environmental mortality d added to both species,

x' = (a - d)x - pxy
y' = -(b + d)y + qxy

The coexistence equilibrium becomes:
x* = (b + d)/q,  y* = (a - d)/p.

Therefore x* increases by d/q compared to the original b/q:
x* = b/q + d/q  >  b/q.

For d = 0.10 yr^-1, the increase is (0.10)/q.</pre>
        </div>
      </div>

      <h3>Sanity checks</h3>
      <ul>
        <li><strong>Units:</strong> <span class="badge">b</span> and <span class="badge">d</span> have units yr⁻¹, so <span class="badge">(b+d)/q</span> has the same units as <span class="badge">x</span> because <span class="badge">qxy</span> must match <span class="badge">by</span> in units. The difference <span class="badge">d/q</span> is a valid population scale.</li>
        <li><strong>Limiting case <span class="badge">d→0</span>:</strong> We recover the original equilibrium <span class="badge">x*→b/q</span>, <span class="badge">y*→a/p</span>.</li>
        <li><strong>Feasibility:</strong> We need <span class="badge">a-d&gt;0</span> to keep <span class="badge">y*&gt;0</span>. If warming mortality exceeds <span class="badge">a</span>, the positive coexistence equilibrium disappears (fish cannot sustain positive equilibrium in this model).</li>
        <li><strong>Interpretation inside this model:</strong> Even though warming directly kills sharks, it also reduces fish, which reduces the interaction term <span class="badge">−p x y</span> in <span class="badge">x′</span>. The new balance point that makes <span class="badge">y′=0</span> shifts to a larger <span class="badge">x</span>.</li>
      </ul>

      <p class="note">
        <strong>Important modeling note:</strong> The given equations are taken as stated in the problem. In many biology texts, the prey/predator labels are swapped compared to the signs shown here. The conclusion “the shark population increases” follows mathematically from the system exactly as written.
      </p>
    </article>

    <section id="viz">
      <h2>Interactive Visualizations</h2>
      <p>
        The graphics use the <strong>same parameters</strong> as the equations above. If the problem doesn’t specify numbers,
        we choose <em>example values</em> for demonstration (clearly labeled), while keeping the analytical result symbolic.
      </p>

      <div class="controls" aria-label="Interactive Controls">
        <div class="control">
          <label for="dSlider">
            Environmental mortality <span class="badge">d</span> (yr⁻¹)
            <span class="pill" id="dVal">0.10</span>
          </label>
          <input id="dSlider" type="range" min="0" max="0.30" step="0.005" value="0.10" />
          <div class="muted" style="font-size:.88rem;">
            Meaning: same per-capita fraction removed from <span class="badge">x</span> and <span class="badge">y</span> each year.
          </div>
        </div>

        <div class="control">
          <label for="resetBtn">
            Simulation
            <span class="pill" id="simInfo">RK4, 0→40 yr</span>
          </label>
          <button id="resetBtn" class="copybtn" style="position:static; width:max-content; padding:10px 12px;">
            Reset to example initial conditions
          </button>
          <div class="muted" style="font-size:.88rem;">
            Example values: <span class="badge">a=1.2</span>, <span class="badge">b=0.8</span>, <span class="badge">p=0.30</span>, <span class="badge">q=0.20</span>,
            <span class="badge">x(0)=6</span>, <span class="badge">y(0)=5</span>.
          </div>
        </div>
      </div>

      <div class="kpiRow" aria-label="Equilibrium Readouts">
        <div class="kpi">
          <p class="t">Coexistence equilibrium shark level</p>
          <p class="v" id="kpiX">x* = (b+d)/q = 4.50</p>
        </div>
        <div class="kpi">
          <p class="t">Coexistence equilibrium fish level</p>
          <p class="v" id="kpiY">y* = (a-d)/p = 3.67</p>
        </div>
        <div class="kpi">
          <p class="t">Shark equilibrium shift vs d=0</p>
          <p class="v" id="kpiShift">Δx* = d/q = 0.50</p>
        </div>
      </div>

      <div class="grid2" style="margin-top:14px;">
        <figure>
          <div class="canvasWrap">
            <canvas id="cSetup" aria-label="Diagram of system setup"></canvas>
          </div>
          <p class="figcap">
            <strong>Diagram:</strong> How each term affects the populations (growth/interaction/warming mortality).
          </p>
        </figure>

        <figure>
          <div class="canvasWrap">
            <canvas id="cTime" aria-label="Time series plot"></canvas>
          </div>
          <p class="figcap">
            <strong>Main plot:</strong> Example trajectories <span class="badge">x(t)</span>, <span class="badge">y(t)</span> vs time with the chosen <span class="badge">d</span>.
          </p>
        </figure>
      </div>

      <figure style="margin-top:14px;">
        <div class="canvasWrap">
          <canvas id="cPhase" aria-label="Phase portrait plot"></canvas>
        </div>
        <p class="figcap">
          <strong>Secondary plot:</strong> Phase portrait (trajectory in the <span class="badge">(x,y)</span> plane) with the coexistence equilibrium marked.
        </p>
      </figure>
    </section>

  </div>
</main>

<footer>
  <div class="hr"></div>
  <p>
    Built with vanilla HTML/CSS/JS. Plots are numerical demonstrations; the proof that sharks increase is the equilibrium comparison:
    <span class="badge">x* = (b+d)/q &gt; b/q</span>.
  </p>
</footer>

<script>
/* -----------------------------
   Copy buttons (plain text)
--------------------------------*/
(function(){
  function copyText(txt){
    navigator.clipboard.writeText(txt).then(()=>{
      // subtle feedback: temporary change button text
    }).catch(()=>{});
  }
  document.querySelectorAll('.copybtn[data-copy]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-copy');
      const el = document.getElementById(id);
      if(!el) return;
      const txt = el.innerText.replace(/\n+$/,'');
      const old = btn.textContent;
      copyText(txt);
      btn.textContent = 'Copied ✓';
      setTimeout(()=>btn.textContent = old, 900);
    });
  });
})();

/* -----------------------------
   Math / Simulation utilities
--------------------------------*/
function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

function rk4Step(f, t, s, h){
  // s = [x,y]
  const k1 = f(t, s);
  const s2 = [s[0] + 0.5*h*k1[0], s[1] + 0.5*h*k1[1]];
  const k2 = f(t + 0.5*h, s2);
  const s3 = [s[0] + 0.5*h*k2[0], s[1] + 0.5*h*k2[1]];
  const k3 = f(t + 0.5*h, s3);
  const s4 = [s[0] + h*k3[0], s[1] + h*k3[1]];
  const k4 = f(t + h, s4);
  return [
    s[0] + (h/6)*(k1[0] + 2*k2[0] + 2*k3[0] + k4[0]),
    s[1] + (h/6)*(k1[1] + 2*k2[1] + 2*k3[1] + k4[1]),
  ];
}

/* -----------------------------
   Canvas rendering (HiDPI)
--------------------------------*/
function setupHiDPI(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(1, Math.floor(rect.width * dpr));
  const h = Math.max(1, Math.floor(rect.height * dpr));
  if(canvas.width !== w || canvas.height !== h){
    canvas.width = w;
    canvas.height = h;
  }
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // draw in CSS pixels
  return {ctx, wCss: rect.width, hCss: rect.height, dpr};
}

function clear(ctx, w, h){
  ctx.clearRect(0,0,w,h);
}

function drawPanelTitle(ctx, x, y, title){
  ctx.save();
  ctx.font = '600 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillStyle = 'rgba(234,240,255,.95)';
  ctx.fillText(title, x, y);
  ctx.restore();
}

function drawAxes(ctx, box, xLabel, yLabel, xUnits, yUnits, xTicks=6, yTicks=6){
  const {x, y, w, h} = box;
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,.18)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.rect(x, y, w, h);
  ctx.stroke();

  // grid + ticks
  ctx.font = '12px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.strokeStyle = 'rgba(255,255,255,.10)';

  // vertical grid lines
  for(let i=0;i<=xTicks;i++){
    const xi = x + (w*i/xTicks);
    ctx.beginPath();
    ctx.moveTo(xi, y);
    ctx.lineTo(xi, y+h);
    ctx.stroke();
  }
  // horizontal grid lines
  for(let j=0;j<=yTicks;j++){
    const yj = y + (h*j/yTicks);
    ctx.beginPath();
    ctx.moveTo(x, yj);
    ctx.lineTo(x+w, yj);
    ctx.stroke();
  }

  // labels
  ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillStyle = 'rgba(184,195,230,.95)';
  const xl = xLabel + (xUnits ? ` (${xUnits})` : '');
  const yl = yLabel + (yUnits ? ` (${yUnits})` : '');
  ctx.fillText(xl, x + w - ctx.measureText(xl).width, y + h + 22);

  ctx.save();
  ctx.translate(x - 30, y + 10);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yl, 0, 0);
  ctx.restore();

  ctx.restore();
}

function mapX(v, vmin, vmax, x0, w){
  return x0 + (v - vmin) * (w / (vmax - vmin));
}
function mapY(v, vmin, vmax, y0, h){
  return y0 + h - (v - vmin) * (h / (vmax - vmin));
}

function drawLegend(ctx, items, x, y){
  ctx.save();
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  let yy = y;
  items.forEach(it=>{
    ctx.strokeStyle = it.stroke;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(x, yy-4);
    ctx.lineTo(x+18, yy-4);
    ctx.stroke();
    ctx.fillStyle = 'rgba(234,240,255,.92)';
    ctx.fillText(it.label, x+24, yy);
    yy += 18;
  });
  ctx.restore();
}

/* -----------------------------
   Model parameters (example)
--------------------------------*/
const params = {
  a: 1.2,   // yr^-1
  b: 0.8,   // yr^-1
  p: 0.30,  // interaction scale
  q: 0.20,  // interaction scale
  d: 0.10,  // yr^-1 (slider)
  x0: 6.0,
  y0: 5.0,
  tMax: 40.0,
  dt: 0.02
};

function modelODE(t, s){
  const x = s[0], y = s[1];
  const {a,b,p,q,d} = params;
  // Modified system:
  // x' = (a - d)x - p x y
  // y' = -(b + d)y + q x y
  return [
    (a - d)*x - p*x*y,
    -(b + d)*y + q*x*y
  ];
}

function simulate(){
  const n = Math.floor(params.tMax / params.dt) + 1;
  const T = new Array(n);
  const X = new Array(n);
  const Y = new Array(n);
  let t = 0;
  let s = [params.x0, params.y0];
  for(let i=0;i<n;i++){
    T[i] = t;
    X[i] = Math.max(0, s[0]);
    Y[i] = Math.max(0, s[1]);
    s = rk4Step(modelODE, t, s, params.dt);
    // keep numerical drift from going negative too much
    s[0] = Math.max(-1e-9, s[0]);
    s[1] = Math.max(-1e-9, s[1]);
    t += params.dt;
  }
  return {T,X,Y};
}

/* -----------------------------
   Draw: Setup diagram
--------------------------------*/
function drawSetup(){
  const canvas = document.getElementById('cSetup');
  const {ctx, wCss, hCss} = setupHiDPI(canvas);
  clear(ctx, wCss, hCss);

  // Background fade
  const g = ctx.createLinearGradient(0,0,0,hCss);
  g.addColorStop(0,'rgba(255,255,255,.05)');
  g.addColorStop(1,'rgba(0,0,0,.00)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,wCss,hCss);

  drawPanelTitle(ctx, 12, 18, 'Diagram: Terms in the modified Volterra model');

  const cx1 = wCss*0.30, cy = hCss*0.55;
  const cx2 = wCss*0.72;

  // Nodes
  function node(x,y,label,sub){
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,.25)';
    ctx.strokeStyle = 'rgba(255,255,255,.14)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(x-90,y-40,180,80,16);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = 'rgba(234,240,255,.95)';
    ctx.font = '700 14px ui-sans-serif, system-ui';
    ctx.fillText(label, x-70, y-10);
    ctx.fillStyle = 'rgba(184,195,230,.95)';
    ctx.font = '12px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.fillText(sub, x-70, y+14);
    ctx.restore();
  }
  node(cx1, cy, 'Sharks', 'x(t)');
  node(cx2, cy, 'Fish', 'y(t)');

  // Arrow helper
  function arrow(x1,y1,x2,y2,stroke){
    ctx.save();
    ctx.strokeStyle = stroke;
    ctx.fillStyle = stroke;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke();
    // head
    const ang = Math.atan2(y2-y1,x2-x1);
    const L = 10;
    ctx.beginPath();
    ctx.moveTo(x2,y2);
    ctx.lineTo(x2 - L*Math.cos(ang-0.5), y2 - L*Math.sin(ang-0.5));
    ctx.lineTo(x2 - L*Math.cos(ang+0.5), y2 - L*Math.sin(ang+0.5));
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  // Interaction arrows: -p x y affects x, +q x y affects y
  arrow(cx2-95, cy-10, cx1+95, cy-10, 'rgba(252,165,165,.9)'); // fish -> sharks (negative term in x')
  arrow(cx1+95, cy+10, cx2-95, cy+10, 'rgba(134,239,172,.9)'); // sharks -> fish (positive term in y')

  // Labels near arrows
  ctx.save();
  ctx.font = '12px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillStyle = 'rgba(252,165,165,.95)';
  ctx.fillText('x\' has  −p x y', (cx1+cx2)/2 - 70, cy-18);
  ctx.fillStyle = 'rgba(134,239,172,.95)';
  ctx.fillText('y\' has  +q x y', (cx1+cx2)/2 - 70, cy+34);
  ctx.restore();

  // Growth/decay + warming
  ctx.save();
  ctx.fillStyle = 'rgba(253,230,138,.10)';
  ctx.strokeStyle = 'rgba(253,230,138,.22)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.roundRect(12, 34, wCss-24, 70, 16);
  ctx.fill(); ctx.stroke();

  ctx.fillStyle = 'rgba(234,240,255,.95)';
  ctx.font = '600 13px ui-sans-serif, system-ui';
  ctx.fillText('Added warming mortality (same rate to both):  −d x  and  −d y', 24, 58);

  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.font = '12px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  const txt = `x' = (a−d)x − pxy      y' = −(b+d)y + qxy      (d = ${params.d.toFixed(3)} yr⁻¹)`;
  ctx.fillText(txt, 24, 82);
  ctx.restore();

  // Mini equilibrium box
  ctx.save();
  ctx.fillStyle = 'rgba(125,211,252,.09)';
  ctx.strokeStyle = 'rgba(125,211,252,.22)';
  ctx.lineWidth = 1;
  const bx = 12, by = hCss-86, bw = wCss-24, bh = 74;
  ctx.beginPath();
  ctx.roundRect(bx, by, bw, bh, 16);
  ctx.fill(); ctx.stroke();
  ctx.fillStyle = 'rgba(234,240,255,.95)';
  ctx.font = '600 13px ui-sans-serif, system-ui';
  ctx.fillText('Coexistence equilibrium (both positive):', bx+12, by+24);
  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.font = '12px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(`x* = (b+d)/q   ,   y* = (a−d)/p`, bx+12, by+48);
  ctx.restore();
}

/* -----------------------------
   Draw: Time series plot
--------------------------------*/
function drawTime(sim){
  const canvas = document.getElementById('cTime');
  const {ctx, wCss, hCss} = setupHiDPI(canvas);
  clear(ctx, wCss, hCss);

  const padL = 54, padR = 18, padT = 34, padB = 40;
  const box = {x: padL, y: padT, w: wCss - padL - padR, h: hCss - padT - padB};

  // Determine ranges
  const tMin = 0, tMax = params.tMax;
  let yMax = 0;
  for(let i=0;i<sim.X.length;i++){
    yMax = Math.max(yMax, sim.X[i], sim.Y[i]);
  }
  yMax = Math.max(1, yMax * 1.08);

  drawPanelTitle(ctx, 12, 18, 'Main Plot: Populations vs Time');
  drawAxes(ctx, box, 'time', 'population', 'years', 'arb. units', 8, 6);

  // tick labels
  ctx.save();
  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.font = '11px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  // x ticks
  for(let i=0;i<=8;i++){
    const t = tMin + (tMax-tMin)*(i/8);
    const x = mapX(t, tMin, tMax, box.x, box.w);
    ctx.fillText(t.toFixed(0), x-6, box.y+box.h+16);
  }
  // y ticks
  for(let j=0;j<=6;j++){
    const v = (yMax)*(j/6);
    const y = mapY(v, 0, yMax, box.y, box.h);
    ctx.fillText(v.toFixed(1), box.x-44, y+4);
  }
  ctx.restore();

  // Draw curves
  function plot(arr, stroke){
    ctx.save();
    ctx.strokeStyle = stroke;
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    for(let i=0;i<arr.length;i++){
      const x = mapX(sim.T[i], tMin, tMax, box.x, box.w);
      const y = mapY(arr[i], 0, yMax, box.y, box.h);
      if(i===0) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    }
    ctx.stroke();
    ctx.restore();
  }

  plot(sim.X, 'rgba(125,211,252,.95)'); // sharks x(t)
  plot(sim.Y, 'rgba(167,139,250,.95)'); // fish y(t)

  // Equilibrium lines
  const xStar = (params.b + params.d)/params.q;
  const yStar = (params.a - params.d)/params.p;

  ctx.save();
  ctx.setLineDash([6,6]);
  ctx.strokeStyle = 'rgba(125,211,252,.55)';
  ctx.lineWidth = 1.5;
  let yy = mapY(xStar, 0, yMax, box.y, box.h);
  ctx.beginPath();
  ctx.moveTo(box.x, yy); ctx.lineTo(box.x+box.w, yy); ctx.stroke();

  ctx.strokeStyle = 'rgba(167,139,250,.55)';
  yy = mapY(yStar, 0, yMax, box.y, box.h);
  ctx.beginPath();
  ctx.moveTo(box.x, yy); ctx.lineTo(box.x+box.w, yy); ctx.stroke();
  ctx.setLineDash([]);
  ctx.restore();

  // Legend
  drawLegend(ctx, [
    {label:'x(t) sharks', stroke:'rgba(125,211,252,.95)'},
    {label:'y(t) fish', stroke:'rgba(167,139,250,.95)'},
    {label:'equilibrium levels', stroke:'rgba(255,255,255,.45)'}
  ], box.x + 10, box.y + 18);

  // annotate equilibrium values
  ctx.save();
  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.font = '11px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(`x*=${xStar.toFixed(2)}`, box.x + box.w - 90, mapY(xStar,0,yMax,box.y,box.h)-6);
  ctx.fillText(`y*=${yStar.toFixed(2)}`, box.x + box.w - 90, mapY(yStar,0,yMax,box.y,box.h)-6);
  ctx.restore();
}

/* -----------------------------
   Draw: Phase portrait
--------------------------------*/
function drawPhase(sim){
  const canvas = document.getElementById('cPhase');
  const {ctx, wCss, hCss} = setupHiDPI(canvas);
  clear(ctx, wCss, hCss);

  const padL = 62, padR = 18, padT = 34, padB = 46;
  const box = {x: padL, y: padT, w: wCss - padL - padR, h: hCss - padT - padB};

  // Range from data + equilibrium
  const xStar = (params.b + params.d)/params.q;
  const yStar = (params.a - params.d)/params.p;

  let xMax = xStar, yMax = yStar;
  for(let i=0;i<sim.X.length;i++){
    xMax = Math.max(xMax, sim.X[i]);
    yMax = Math.max(yMax, sim.Y[i]);
  }
  xMax = Math.max(1, xMax*1.10);
  yMax = Math.max(1, yMax*1.10);

  drawPanelTitle(ctx, 12, 18, 'Secondary Plot: Phase Portrait (x vs y)');
  drawAxes(ctx, box, 'x (sharks)', 'y (fish)', 'arb. units', 'arb. units', 8, 6);

  // tick labels
  ctx.save();
  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.font = '11px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  for(let i=0;i<=8;i++){
    const v = xMax*(i/8);
    const x = mapX(v, 0, xMax, box.x, box.w);
    ctx.fillText(v.toFixed(1), x-10, box.y+box.h+16);
  }
  for(let j=0;j<=6;j++){
    const v = yMax*(j/6);
    const y = mapY(v, 0, yMax, box.y, box.h);
    ctx.fillText(v.toFixed(1), box.x-52, y+4);
  }
  ctx.restore();

  // Nullclines: x' = 0 => y = (a-d)/p and y' = 0 => x = (b+d)/q
  ctx.save();
  ctx.setLineDash([6,6]);
  ctx.lineWidth = 1.5;
  // vertical line x = xStar
  ctx.strokeStyle = 'rgba(125,211,252,.55)';
  let xx = mapX(xStar, 0, xMax, box.x, box.w);
  ctx.beginPath();
  ctx.moveTo(xx, box.y); ctx.lineTo(xx, box.y+box.h); ctx.stroke();
  // horizontal line y = yStar
  ctx.strokeStyle = 'rgba(167,139,250,.55)';
  let yy = mapY(yStar, 0, yMax, box.y, box.h);
  ctx.beginPath();
  ctx.moveTo(box.x, yy); ctx.lineTo(box.x+box.w, yy); ctx.stroke();
  ctx.setLineDash([]);
  ctx.restore();

  // Trajectory
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,.88)';
  ctx.lineWidth = 2.2;
  ctx.beginPath();
  for(let i=0;i<sim.X.length;i++){
    const x = mapX(sim.X[i], 0, xMax, box.x, box.w);
    const y = mapY(sim.Y[i], 0, yMax, box.y, box.h);
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }
  ctx.stroke();
  ctx.restore();

  // Equilibrium point
  ctx.save();
  const ex = mapX(xStar, 0, xMax, box.x, box.w);
  const ey = mapY(yStar, 0, yMax, box.y, box.h);
  ctx.fillStyle = 'rgba(134,239,172,.95)';
  ctx.beginPath();
  ctx.arc(ex, ey, 4.5, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = 'rgba(184,195,230,.95)';
  ctx.font = '12px ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(`(x*,y*)=(${xStar.toFixed(2)}, ${yStar.toFixed(2)})`, ex+10, ey-10);
  ctx.restore();

  drawLegend(ctx, [
    {label:'trajectory', stroke:'rgba(255,255,255,.88)'},
    {label:'x = (b+d)/q (y\'=0)', stroke:'rgba(125,211,252,.55)'},
    {label:'y = (a−d)/p (x\'=0)', stroke:'rgba(167,139,250,.55)'}
  ], box.x + 10, box.y + 18);
}

/* -----------------------------
   UI updates
--------------------------------*/
function updateKPIs(){
  const d = params.d, a=params.a, b=params.b, p=params.p, q=params.q;
  const xStar = (b+d)/q;
  const yStar = (a-d)/p;
  const shift = d/q;

  document.getElementById('dVal').textContent = d.toFixed(3);
  document.getElementById('kpiX').textContent = `x* = (b+d)/q = ${xStar.toFixed(2)}`;
  document.getElementById('kpiY').textContent = `y* = (a-d)/p = ${yStar.toFixed(2)}`;
  document.getElementById('kpiShift').textContent = `Δx* = d/q = ${shift.toFixed(2)}`;
}

let lastSim = null;

function renderAll(){
  updateKPIs();
  lastSim = simulate();
  drawSetup();
  drawTime(lastSim);
  drawPhase(lastSim);
}

/* -----------------------------
   Events: slider + resize
--------------------------------*/
const dSlider = document.getElementById('dSlider');
dSlider.addEventListener('input', ()=>{
  params.d = parseFloat(dSlider.value);
  renderAll();
});

document.getElementById('resetBtn').addEventListener('click', ()=>{
  params.x0 = 6.0;
  params.y0 = 5.0;
  renderAll();
});

let resizeTimer = null;
window.addEventListener('resize', ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=>renderAll(), 80);
});

// initial render
renderAll();
</script>
</body>
</html>
