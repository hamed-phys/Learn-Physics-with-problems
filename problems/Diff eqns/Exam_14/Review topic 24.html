<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fourier Forcing of ODEs: Triangle Waves & Resonance (Problems 77–79)</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1624;
      --card:#111b2d;
      --ink:#e9eefc;
      --muted:#b7c2e6;
      --faint:#7f8bb3;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 20% -10%, rgba(125,211,252,.12), transparent 60%),
                  radial-gradient(1000px 700px at 110% 20%, rgba(167,139,250,.10), transparent 55%),
                  linear-gradient(180deg, var(--bg), #070a10 65%, #060810);
      color:var(--ink);
      line-height:1.55;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding: 28px 18px 8px;
      position:relative;
      overflow:hidden;
    }
    .wrap{max-width:1120px; margin:0 auto; padding:0 14px 28px;}
    .hero{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:16px;
      align-items:stretch;
    }
    .titleCard{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:18px 18px 16px;
      box-shadow: var(--shadow);
      position:relative;
    }
    .titleCard h1{
      font-size: clamp(22px, 3.2vw, 34px);
      margin:0 0 8px;
      letter-spacing:.2px;
    }
    .subtitle{color:var(--muted); margin:0 0 12px; font-size: 14.5px}
    .pillRow{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      white-space:nowrap;
    }

    .toc{
      background: linear-gradient(180deg, rgba(125,211,252,.08), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
      position:sticky;
      top:12px;
      align-self:start;
      max-height: calc(100vh - 24px);
      overflow:auto;
    }
    .toc h2{
      font-size:14px;
      margin:0 0 8px;
      color:var(--ink);
      letter-spacing:.3px;
    }
    .toc nav a{
      display:block;
      padding:7px 10px;
      border-radius:12px;
      color:var(--muted);
      border:1px solid transparent;
      margin:4px 0;
      font-size:13px;
    }
    .toc nav a:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.08);
      color:var(--ink);
    }
    main{padding: 6px 18px 44px;}
    section{
      background: rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      margin: 14px 0;
    }
    section h2{
      margin:0 0 10px;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 920px){
      .hero{grid-template-columns: 1fr}
      .toc{position:relative; top:auto}
      .grid2{grid-template-columns:1fr}
      .grid3{grid-template-columns:1fr}
    }
    .callout{
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      padding:12px 12px;
      border-radius: 16px;
    }
    .callout.good{border-color: rgba(52,211,153,.35)}
    .callout.warn{border-color: rgba(251,191,36,.35)}
    .callout.bad{border-color: rgba(251,113,133,.35)}
    .kvs{
      margin:0; padding-left:18px; color:var(--muted)
    }
    .eq{
      position:relative;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      padding: 12px 12px 12px;
      overflow:auto;
    }
    .eq pre{
      margin:0;
      font-family: var(--mono);
      font-size: 13px;
      color: #eaf0ff;
      white-space: pre-wrap;
    }
    .btnRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top:10px;
    }
    button.copyBtn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-size: 12.5px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    button.copyBtn:hover{background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.22)}
    button.copyBtn:active{transform: translateY(1px)}
    .small{font-size:13px; color:var(--muted)}
    .muted{color:var(--muted)}
    .faint{color:var(--faint)}
    .divider{height:1px; background: var(--line); margin:14px 0;}
    figure{
      margin:0;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      background: rgba(0,0,0,.20);
    }
    figcaption{
      padding:10px 12px;
      font-size: 12.8px;
      color: var(--muted);
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    canvas{display:block; width:100%; height:360px;}
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      align-items:end;
    }
    @media (max-width: 920px){
      .controls{grid-template-columns:1fr}
    }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    select, input[type="range"]{
      width:100%;
      border-radius: 12px;
    }
    select{
      padding:10px 10px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.28);
      color: var(--ink);
      outline:none;
    }
    input[type="range"]{
      accent-color: var(--accent);
    }
    .val{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--ink);
      opacity:.95;
      margin-top:6px;
    }
    .tag{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      display:inline-block;
    }

    .finalBox{
      border:1px solid rgba(125,211,252,.35);
      background: linear-gradient(180deg, rgba(125,211,252,.10), rgba(255,255,255,.03));
      padding: 14px;
      border-radius: 18px;
    }
    .finalBox h3{margin:0 0 8px; font-size:16px}
    .finalBox pre{margin:0; font-family:var(--mono); font-size:13px; white-space:pre-wrap}

    footer{
      padding: 18px 18px 36px;
      color: var(--faint);
      font-size: 12.5px;
    }

    /* subtle motion */
    @media (prefers-reduced-motion: no-preference){
      section{animation: pop .45s ease both}
      @keyframes pop{
        from{transform: translateY(6px); opacity:.0}
        to{transform: translateY(0); opacity:1}
      }
    }

    /* print */
    @media print{
      body{background:#fff; color:#000}
      header, main, section{box-shadow:none}
      .toc{position:relative; max-height:none}
      canvas{height:260px}
      .pill,.copyBtn,.controls{display:none !important}
      section{break-inside: avoid}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap hero">
    <div class="titleCard">
      <h1>Fourier Forcing of Linear ODEs: Triangle Waves & Resonance (Problems 77–79)</h1>
      <p class="subtitle">
        We solve three classic “Fourier + ODE” problems by expanding periodic inputs into cosine series,
        solving each harmonic through the system’s frequency response, and handling resonance correctly.
      </p>

      <div class="callout good">
        <strong>Quick Summary</strong>
        <ul class="kvs">
          <li>Triangle waves are even ⇒ cosine-only Fourier series (no sine terms in the forcing).</li>
          <li>Linear ODEs respond to each harmonic independently; add responses by superposition.</li>
          <li>Problem 77: first-order filter, steady periodic solution + decaying transient.</li>
          <li>Problem 78: second-order damped oscillator, steady periodic solution via harmonic balance.</li>
          <li>Problem 79: resonance at <span class="tag">n = 4</span> produces a growing <span class="tag">t·sin(4t)</span> term.</li>
        </ul>
      </div>

      <div class="pillRow">
        <span class="pill">Vanilla HTML/CSS/JS</span>
        <span class="pill">Fourier series</span>
        <span class="pill">LTI frequency response</span>
        <span class="pill">Resonance handled</span>
        <span class="pill">Interactive plots</span>
      </div>
    </div>

    <aside class="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <nav>
        <a href="#viz">Interactive Visuals</a>
        <a href="#part1">PART 1 — Problem Analysis</a>
        <a href="#part2">PART 2 — Strategy & Tips</a>
        <a href="#part3">PART 3 — Full Solution</a>
        <a href="#p77">Problem 77</a>
        <a href="#p78">Problem 78</a>
        <a href="#p79">Problem 79</a>
        <a href="#checks">Sanity Checks</a>
      </nav>
    </aside>
  </div>
</header>

<main>
  <div class="wrap">

    <section id="viz">
      <h2>Interactive Visuals (System Diagram + Two Plots + Live Controls)</h2>
      <p class="muted small">
        Use the selector to switch between Problems 77–79. The slider changes a meaningful parameter and
        updates <em>all</em> canvases live. (Example values are used only for visualization.)
      </p>

      <div class="controls" role="group" aria-label="Interactive controls">
        <div class="callout">
          <label for="problemSel">Choose problem</label>
          <select id="problemSel">
            <option value="77">Problem 77: x' + kx = triangle f(t), period 2π</option>
            <option value="78">Problem 78: x'' + x' + 8x = triangle g(t), period 2</option>
            <option value="79">Problem 79: x'' + 16x = Σ cos(nt)/[n²(n²−2)²] (resonance)</option>
          </select>
          <div class="val" id="problemNote">Mode: 77</div>
        </div>

        <div class="callout">
          <label for="paramSlider" id="paramLabel">Parameter k (Problem 77)</label>
          <input id="paramSlider" type="range" min="0.2" max="6" step="0.05" value="1.5" />
          <div class="val" id="paramVal">k = 1.50</div>
          <div class="small faint" id="paramHint">Meaning: decay rate / “stiffness” of the first-order filter.</div>
        </div>

        <div class="callout">
          <label for="nSlider">Fourier truncation N (harmonics used in plots)</label>
          <input id="nSlider" type="range" min="1" max="60" step="1" value="20" />
          <div class="val" id="nVal">N = 20</div>
          <div class="small faint">Higher N ≈ sharper corners; lower N ≈ smoother approximation.</div>
        </div>
      </div>

      <div class="grid2" style="margin-top:12px">
        <figure>
          <canvas id="cDiagram" aria-label="System diagram"></canvas>
          <figcaption><strong>Diagram:</strong> Interpreting the ODE as a linear dynamical system mapping forcing → response.</figcaption>
        </figure>

        <figure>
          <canvas id="cMain" aria-label="Main quantitative plot"></canvas>
          <figcaption><strong>Main plot:</strong> Forcing (triangle/Fourier) and the computed response x(t) over time.</figcaption>
        </figure>
      </div>

      <div class="grid2" style="margin-top:12px">
        <figure>
          <canvas id="cSecondary" aria-label="Secondary plot"></canvas>
          <figcaption><strong>Secondary plot:</strong> Harmonic magnitude response |H(iω)| at the used harmonic frequencies.</figcaption>
        </figure>

        <div class="callout warn">
          <strong>Note on initial conditions for plots</strong>
          <p class="small muted" style="margin:8px 0 0">
            The textbook problems do not specify initial conditions, so the plots use an <em>example</em> choice:
            <span class="tag">x(0)=0</span> (and <span class="tag">x'(0)=0</span> for second order).
            The analytical solutions below are given in full generality as “transient + steady periodic”.
          </p>
        </div>
      </div>
    </section>

    <section id="part1">
      <h2>PART 1 — Problem Analysis (no solving yet)</h2>

      <div class="grid2">
        <div class="callout">
          <strong>Rewrite the problems (in words)</strong>
          <ul class="kvs">
            <li><strong>(77)</strong> A first-order linear system is driven by a <em>2π-periodic triangle wave</em> \(f(t)\) defined by \(f(t)=|t|\) on \([-\pi,\pi]\). Solve \(x' + kx = f(t)\).</li>
            <li><strong>(78)</strong> A damped second-order system is driven by a <em>2-periodic triangle wave</em> \(g(t)\) defined by \(g(t)=|t|\) on \([-1,1]\). Solve \(x'' + x' + 8x = g(t)\).</li>
            <li><strong>(79)</strong> An undamped oscillator \(x''+16x\) is driven by an infinite cosine series. Solve and <em>watch for resonance</em>.</li>
          </ul>
        </div>

        <div class="callout">
          <strong>Given / unknown / what to find</strong>
          <ul class="kvs">
            <li><strong>Given:</strong> linear ODE(s), periodic forcing, parameters \(k>0\) (77) and fixed coefficients (78,79).</li>
            <li><strong>Unknown:</strong> \(x(t)\) (general solution).</li>
            <li><strong>Find:</strong> closed-form series expressions for \(x(t)\) (steady periodic part + transient), and the resonant term in (79).</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="callout good">
          <strong>Relevant principles (and why they apply)</strong>
          <ul class="kvs">
            <li><strong>Superposition:</strong> linear ODEs respond to sums of inputs by summing outputs.</li>
            <li><strong>Fourier series:</strong> periodic triangle waves can be expanded into cosines; each cosine is easy to handle.</li>
            <li><strong>Steady-state sinusoidal response:</strong> for LTI systems, a cosine input produces a cosine/sine output at the same frequency with phase shift.</li>
            <li><strong>Resonance:</strong> for \(x''+\omega_0^2 x = A\cos(\omega_0 t)\), the particular grows like \(t\sin(\omega_0 t)\).</li>
          </ul>
        </div>

        <div class="callout">
          <strong>Possible approaches (compare)</strong>
          <ol class="kvs">
            <li><strong>Integrating factor / Green’s function:</strong> direct convolution with periodic input. Works, but messy for triangle waves.</li>
            <li><strong>Fourier-series harmonic method:</strong> expand input, solve per harmonic, sum. Cleanest and matches the hint.</li>
            <li><strong>Laplace transform:</strong> great with initial conditions, but periodic forcing still pushes you toward Fourier-like expansions.</li>
          </ol>
          <p class="small muted" style="margin:8px 0 0">
            <strong>Best choice:</strong> Fourier-series harmonic method—fast, systematic, and it exposes resonance immediately.
          </p>
        </div>
      </div>
    </section>

    <section id="part2">
      <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

      <div class="callout">
        <strong>Plan (5–10 steps)</strong>
        <ol class="kvs">
          <li><strong>Goal:</strong> write the forcing as a Fourier series. <em>Tool:</em> known cosine series for even triangle wave.</li>
          <li><strong>Goal:</strong> solve the homogeneous ODE. <em>Tool:</em> characteristic equation.</li>
          <li><strong>Goal:</strong> solve for a constant (DC) particular term. <em>Tool:</em> set derivatives to zero.</li>
          <li><strong>Goal:</strong> solve for a single harmonic \(A\cos(\omega t)\). <em>Tool:</em> trial \(B\cos(\omega t)+C\sin(\omega t)\) (or complex impedance).</li>
          <li><strong>Goal:</strong> sum over harmonics to build the steady periodic solution. <em>Tool:</em> superposition.</li>
          <li><strong>Goal:</strong> add the transient and (optionally) fit constants to initial conditions. <em>Tool:</em> evaluate at \(t=0\).</li>
          <li><strong>(79) Goal:</strong> detect resonance (\(\omega = \omega_0\)). <em>Tool:</em> denominator \(16-\omega^2\) and special resonant ansatz.</li>
        </ol>
      </div>

      <div class="grid2" style="margin-top:12px">
        <div class="callout warn">
          <strong>Common mistakes</strong>
          <ul class="kvs">
            <li>Forgetting triangle waves here are <strong>even</strong> ⇒ cosine-only series.</li>
            <li>Dropping the <strong>DC term</strong> (the average value) in the Fourier series.</li>
            <li>Mixing up the <strong>fundamental frequency</strong>: period \(2\pi\) ⇒ \(\omega_0=1\); period \(2\) ⇒ \(\omega_0=\pi\).</li>
            <li>In (79), using the non-resonant formula at \(n=4\) (division by zero).</li>
          </ul>
        </div>

        <div class="callout good">
          <strong>Quick tips</strong>
          <ul class="kvs">
            <li>Use the “frequency response” viewpoint: output amplitude is input amplitude times \(|H(i\omega)|\).</li>
            <li>Keep symbols consistent: \(k\) is only for Problem 77; use \(\omega=n\) or \(\omega=n\pi\) carefully.</li>
            <li>Write the final answer as: <span class="tag">x(t) = x_h(t) + x_p(t)</span> with \(x_p\) given by a convergent series.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="part3">
      <h2>PART 3 — Full Solution</h2>

      <div class="callout">
        <strong>Physical intuition (all three)</strong>
        <p class="muted" style="margin:8px 0 0">
          A triangle wave is built from many cosine harmonics. A linear system acts like a frequency-dependent filter:
          each harmonic is attenuated and phase-shifted. First-order systems strongly suppress high frequencies; second-order
          systems can amplify near their natural frequency; undamped systems blow up under exact resonance.
        </p>
      </div>

      <div class="divider"></div>

      <article id="p77">
        <h2>Problem 77 — Solve <span class="tag">x' + kx = f(t)</span>, with <span class="tag">f(t)=|t|</span> on <span class="tag">[-π,π]</span> and period <span class="tag">2π</span></h2>

        <div class="grid2">
          <div class="callout">
            <strong>Step 1: Fourier series for the 2π-periodic triangle wave</strong>
            <p class="muted small" style="margin:8px 0 0">
              The function \(f(t)=|t|\) on \([-\pi,\pi]\) is even, so
              \(f(t)=a_0/2+\sum_{n\ge1} a_n\cos(nt)\).
              A known series is:
            </p>
            <div class="eq" id="eq77f">
<pre>f(t)=|t| (period 2π):
f(t) = π/2  -  (4/π) Σ_{m=1..∞} cos((2m−1)t)/(2m−1)^2</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq77f">Copy forcing series</button>
            </div>
          </div>

          <div class="callout">
            <strong>Step 2: Solve the ODE with integrating factor (structure)</strong>
            <p class="muted small" style="margin:8px 0 0">
              For \(x'+kx=f(t)\), integrating factor \(e^{kt}\) gives:
            </p>
            <div class="eq" id="eq77IF">
<pre>x' + kx = f(t)
d/dt (e^{kt} x) = e^{kt} f(t)
x(t) = e^{-kt} [ C + ∫ e^{ks} f(s) ds ]</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq77IF">Copy integrating-factor form</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="callout good">
          <strong>Step 3: Harmonic-by-harmonic particular solution</strong>
          <p class="muted" style="margin:8px 0 0">
            Because the ODE is linear, we can solve separately for:
            (i) the constant term \(π/2\), and (ii) each cosine term \(\cos(\omega t)\) with \(\omega = 2m-1\).
          </p>
        </div>

        <div class="grid2" style="margin-top:12px">
          <div class="callout">
            <strong>DC (constant) response</strong>
            <p class="muted small" style="margin:8px 0 0">
              If \(f(t)=F_0\) constant, then \(x_p\) constant gives \(k x_p = F_0\).
            </p>
            <div class="eq" id="eq77dc"><pre>F0 = π/2  ⇒  x_dc = (π/2)/k = π/(2k)</pre></div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq77dc">Copy DC result</button>
            </div>
          </div>

          <div class="callout">
            <strong>Single cosine response</strong>
            <p class="muted small" style="margin:8px 0 0">
              For \(x'+kx=A\cos(\omega t)\), try \(x_p=B\cos(\omega t)+C\sin(\omega t)\).
              Compute \(x_p' = -B\omega\sin(\omega t)+C\omega\cos(\omega t)\) and match coefficients:
            </p>
            <div class="eq" id="eq77harm">
<pre>Match cos and sin:
cos:   kB + ωC = A
sin:   kC − ωB = 0

Solve:
B = A k/(k^2+ω^2)
C = A ω/(k^2+ω^2)

So:
x_p(t)= A [ k cos(ωt) + ω sin(ωt) ]/(k^2+ω^2)</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq77harm">Copy harmonic response</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="finalBox" id="final77">
          <h3>Final result (Problem 77)</h3>
<pre>General solution:
x(t) = C e^{−kt} + x_ss(t)

Steady periodic (steady-state) part:
x_ss(t) = π/(2k)  −  (4/π) Σ_{m=1..∞} 1/(2m−1)^2 · [ k cos((2m−1)t) + (2m−1) sin((2m−1)t) ] / (k^2 + (2m−1)^2)</pre>
          <div class="btnRow">
            <button class="copyBtn" data-copy-target="final77">Copy final answer (77)</button>
          </div>
        </div>
      </article>

      <div class="divider"></div>

      <article id="p78">
        <h2>Problem 78 — Solve <span class="tag">x'' + x' + 8x = g(t)</span>, with <span class="tag">g(t)=|t|</span> on <span class="tag">[-1,1]</span> and period <span class="tag">2</span></h2>

        <div class="grid2">
          <div class="callout">
            <strong>Step 1: Fourier series for period-2 triangle wave</strong>
            <p class="muted small" style="margin:8px 0 0">
              Period \(2\) means fundamental frequency \(\omega_0=\pi\). The even function \(g(t)=|t|\) on \([-1,1]\)
              has cosine series:
            </p>
            <div class="eq" id="eq78g">
<pre>g(t)=|t| (period 2, fundamental ω0=π):
g(t) = 1/2  −  (4/π^2) Σ_{m=1..∞} cos((2m−1)π t)/(2m−1)^2</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq78g">Copy forcing series</button>
            </div>
          </div>

          <div class="callout">
            <strong>Step 2: Homogeneous solution</strong>
            <p class="muted small" style="margin:8px 0 0">
              Solve \(r^2 + r + 8 = 0\):
            </p>
            <div class="eq" id="eq78hom">
<pre>r = [−1 ± sqrt(1−32)]/2 = (−1 ± i√31)/2

x_h(t) = e^{−t/2}[ C1 cos( (√31/2) t ) + C2 sin( (√31/2) t ) ]</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq78hom">Copy homogeneous solution</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <div class="callout">
            <strong>Step 3: DC particular</strong>
            <p class="muted small" style="margin:8px 0 0">
              For constant input \(g(t)=G_0\), take constant \(x_p\): then \(8x_p=G_0\).
              Here \(G_0=1/2\).
            </p>
            <div class="eq" id="eq78dc"><pre>G0 = 1/2  ⇒  x_dc = (1/2)/8 = 1/16</pre></div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq78dc">Copy DC result</button>
            </div>
          </div>

          <div class="callout">
            <strong>Step 4: Single harmonic response</strong>
            <p class="muted small" style="margin:8px 0 0">
              For \(x''+x'+8x = A\cos(\omega t)\), try \(x_p=B\cos(\omega t)+C\sin(\omega t)\).
              Substitute and match cos/sin:
            </p>
            <div class="eq" id="eq78harm">
<pre>Compute:
x'  = −Bω sin(ωt) + Cω cos(ωt)
x'' = −Bω^2 cos(ωt) − Cω^2 sin(ωt)

Plug into x''+x'+8x = A cos(ωt):
cos: (8−ω^2)B + ωC = A
sin: −ωB + (8−ω^2)C = 0

Solve:
B = A(8−ω^2)/[(8−ω^2)^2 + ω^2]
C = Aω/[(8−ω^2)^2 + ω^2]</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq78harm">Copy harmonic response</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="finalBox" id="final78">
          <h3>Final result (Problem 78)</h3>
<pre>General solution:
x(t) = x_h(t) + x_ss(t)

Homogeneous:
x_h(t) = e^{−t/2}[ C1 cos( (√31/2) t ) + C2 sin( (√31/2) t ) ]

Steady periodic part (use ω = (2m−1)π and A_m = −(4/π^2)·1/(2m−1)^2):
x_ss(t) = 1/16  +  Σ_{m=1..∞} A_m [ B(ω) cos(ω t) + C(ω) sin(ω t) ]

where
B(ω) = (8−ω^2)/[(8−ω^2)^2 + ω^2]
C(ω) = ω/[(8−ω^2)^2 + ω^2]</pre>
          <div class="btnRow">
            <button class="copyBtn" data-copy-target="final78">Copy final answer (78)</button>
          </div>
        </div>
      </article>

      <div class="divider"></div>

      <article id="p79">
        <h2>Problem 79 — Solve <span class="tag">x'' + 16x = Σ cos(nt)/[n²(n²−2)²]</span>, and look out for resonance</h2>

        <div class="callout">
          <strong>Step 1: Identify the natural frequency and resonance condition</strong>
          <p class="muted" style="margin:8px 0 0">
            The homogeneous equation \(x''+16x=0\) has natural frequency \(\omega_0=4\).
            Any forcing term with frequency \(n=4\) (i.e., \(\cos(4t)\)) is exactly resonant.
          </p>
        </div>

        <div class="grid2" style="margin-top:12px">
          <div class="callout">
            <strong>Step 2: Homogeneous solution</strong>
            <div class="eq" id="eq79hom"><pre>x_h(t) = C1 cos(4t) + C2 sin(4t)</pre></div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq79hom">Copy homogeneous solution</button>
            </div>
          </div>

          <div class="callout">
            <strong>Step 3: Non-resonant cosine forcing</strong>
            <p class="muted small" style="margin:8px 0 0">
              For \(x''+\omega_0^2 x = A\cos(\omega t)\) with \(\omega\neq\omega_0\),
              a particular is \(x_p = \dfrac{A}{\omega_0^2-\omega^2}\cos(\omega t)\).
              Here \(\omega_0^2=16\) and \(\omega=n\).
            </p>
            <div class="eq" id="eq79nr">
<pre>For n ≠ 4:
A_n = 1/[ n^2 (n^2−2)^2 ]
x_n(t) = A_n/(16−n^2) · cos(nt)</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq79nr">Copy non-resonant term</button>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="callout bad">
          <strong>Step 4: Resonant term (n = 4)</strong>
          <p class="muted" style="margin:8px 0 0">
            When \(\omega=\omega_0\), the usual cosine particular divides by zero.
            Use the resonant ansatz \(x_{res}(t)=\alpha\, t\sin(4t)\).
          </p>
        </div>

        <div class="grid2" style="margin-top:12px">
          <div class="callout">
            <strong>Compute the resonant coefficient</strong>
            <p class="muted small" style="margin:8px 0 0">
              The resonant forcing amplitude is
              \(A_4 = \dfrac{1}{4^2(4^2-2)^2} = \dfrac{1}{16\cdot 14^2}=\dfrac{1}{3136}\).
              For \(x''+16x=A_4\cos(4t)\), the standard resonant particular is:
              \[
                x_{res}(t) = \frac{A_4}{2\omega_0} t\sin(\omega_0 t) = \frac{A_4}{8} t\sin(4t).
              \]
            </p>
            <div class="eq" id="eq79res">
<pre>A4 = 1/3136
x_res(t) = (A4/8) t sin(4t) = t sin(4t) / 25088</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq79res">Copy resonant term</button>
            </div>
          </div>

          <div class="callout">
            <strong>Assemble the full particular (series)</strong>
            <div class="eq" id="eq79fullp">
<pre>x_p(t) =
  Σ_{n=1, n≠4..∞}  [ cos(nt) / ( n^2 (n^2−2)^2 (16−n^2) ) ]
  +  t sin(4t)/25088</pre>
            </div>
            <div class="btnRow">
              <button class="copyBtn" data-copy-target="eq79fullp">Copy particular series</button>
            </div>
          </div>
        </div>

        <div class="finalBox" id="final79" style="margin-top:12px">
          <h3>Final result (Problem 79)</h3>
<pre>x(t) = C1 cos(4t) + C2 sin(4t)
     + Σ_{n=1, n≠4..∞}  cos(nt) / [ n^2 (n^2−2)^2 (16−n^2) ]
     + t sin(4t)/25088</pre>
          <div class="btnRow">
            <button class="copyBtn" data-copy-target="final79">Copy final answer (79)</button>
          </div>
        </div>
      </article>

      <div class="divider"></div>

      <article id="checks">
        <h2>Sanity Checks (units, limiting cases, interpretation)</h2>

        <div class="grid3">
          <div class="callout good">
            <strong>Units</strong>
            <p class="muted small" style="margin:8px 0 0">
              These are math-form ODEs with dimensionless time as written (typical for Fourier chapters).
              If time had units, then frequencies \(n\) or \(n\pi\) would carry 1/time, and coefficients
              like \(k\) would also have 1/time, keeping each term consistent.
            </p>
          </div>

          <div class="callout">
            <strong>Limiting cases</strong>
            <ul class="kvs">
              <li><strong>Problem 77:</strong> as \(k\to\infty\), \(x\approx f/k\) (small output, strong damping).</li>
              <li><strong>Problem 77:</strong> as \(k\to0^+\), the equation becomes \(x'\approx f(t)\) so no periodic steady state unless mean is handled; the transient dominates.</li>
              <li><strong>Problem 78:</strong> damping term \(x'\) prevents unbounded growth even if a forcing harmonic is near the natural frequency.</li>
              <li><strong>Problem 79:</strong> no damping ⇒ exact resonance produces linear-in-time growth.</li>
            </ul>
          </div>

          <div class="callout warn">
            <strong>Physical interpretation</strong>
            <p class="muted small" style="margin:8px 0 0">
              View each ODE as a “filter” with transfer function:
              <span class="tag">H(iω)=1/(k+iω)</span> (77),
              <span class="tag">H(iω)=1/(8−ω^2+iω)</span> (78),
              <span class="tag">H(iω)=1/(16−ω^2)</span> (79, undamped).
              High-frequency harmonics are suppressed unless you are near resonance.
            </p>
          </div>
        </div>
      </article>

    </section>
  </div>
</main>

<footer>
  <div class="wrap">
    Built as a self-contained article with interactive, high-DPI canvas plots. Copy buttons copy plain text (no formatting).
  </div>
</footer>

<script>
/* =========================
   Utilities
========================= */
function $(id){ return document.getElementById(id); }
function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

async function copyFromElement(el){
  const text = el.innerText.replace(/\n{3,}/g,"\n\n").trim();
  try{
    await navigator.clipboard.writeText(text);
    return true;
  }catch(e){
    // fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position='fixed';
    ta.style.left='-9999px';
    document.body.appendChild(ta);
    ta.select();
    let ok=false;
    try{ ok=document.execCommand('copy'); }catch(_){}
    document.body.removeChild(ta);
    return ok;
  }
}

document.addEventListener('click', async (ev)=>{
  const btn = ev.target.closest('button.copyBtn');
  if(!btn) return;
  const targetId = btn.getAttribute('data-copy-target');
  const el = $(targetId);
  if(!el) return;
  const old = btn.textContent;
  const ok = await copyFromElement(el);
  btn.textContent = ok ? 'Copied!' : 'Copy failed';
  setTimeout(()=>btn.textContent = old, 900);
});

/* =========================
   Fourier + ODE helpers
========================= */

// Problem 77 forcing Fourier (period 2π): f(t)=π/2 - (4/π) Σ_{odd j} cos(j t)/j^2
function f77_series(t, N){
  let s = Math.PI/2;
  for(let m=1; m<=N; m++){
    const j = 2*m-1;
    s -= (4/Math.PI) * Math.cos(j*t)/(j*j);
  }
  return s;
}

// Problem 78 forcing Fourier (period 2): g(t)=1/2 - (4/π^2) Σ_{odd j} cos(j π t)/j^2
function g78_series(t, N){
  let s = 0.5;
  for(let m=1; m<=N; m++){
    const j = 2*m-1;
    s -= (4/(Math.PI*Math.PI)) * Math.cos(j*Math.PI*t)/(j*j);
  }
  return s;
}

// Problem 79 forcing partial sum
function rhs79_series(t, N){
  let s = 0;
  for(let n=1; n<=N; n++){
    const An = 1/(n*n * (n*n-2)*(n*n-2));
    s += An * Math.cos(n*t);
  }
  return s;
}

// Steady-state for Problem 77 from series (no transient)
function x77_steady(t, k, N){
  let s = Math.PI/(2*k);
  for(let m=1; m<=N; m++){
    const j = 2*m-1;
    const A = -(4/Math.PI) * 1/(j*j); // coefficient multiplying cos(jt)
    // For input A cos(jt): x_p = A [k cos(jt) + j sin(jt)]/(k^2 + j^2)
    s += A * (k*Math.cos(j*t) + j*Math.sin(j*t)) / (k*k + j*j);
  }
  return s;
}

// Steady-state for Problem 78: x''+x'+8x with cosine forcing coefficients from g(t)
function x78_steady(t, N){
  let s = 1/16; // DC
  for(let m=1; m<=N; m++){
    const j = 2*m-1;
    const w = j*Math.PI;
    const A = -(4/(Math.PI*Math.PI)) * 1/(j*j); // coefficient for cos(w t)
    const denom = (8 - w*w)*(8 - w*w) + w*w;
    const B = A*(8 - w*w)/denom;
    const C = A*w/denom;
    s += B*Math.cos(w*t) + C*Math.sin(w*t);
  }
  return s;
}

// Transient for Problem 78 to satisfy example ICs x(0)=0, x'(0)=0 (for plots)
function x78_with_exampleIC(t, N){
  const beta = Math.sqrt(31)/2;
  // steady
  const xs = x78_steady(t, N);
  const xs0 = x78_steady(0, N);

  // compute x_s'(0)
  let xsp0 = 0;
  for(let m=1; m<=N; m++){
    const j = 2*m-1;
    const w = j*Math.PI;
    const A = -(4/(Math.PI*Math.PI)) * 1/(j*j);
    const denom = (8 - w*w)*(8 - w*w) + w*w;
    const B = A*(8 - w*w)/denom;
    const C = A*w/denom;
    // derivative of B cos(wt)+C sin(wt) at t=0:
    xsp0 += -B*w*Math.sin(0) + C*w*Math.cos(0);
  }
  // DC derivative is 0, so:
  // x_h(t) = e^{-t/2}(C1 cos(beta t) + C2 sin(beta t))
  // x(0)=0 => C1 + xs0 = 0 => C1 = -xs0
  const C1 = -xs0;

  // x_h'(0) = (-1/2)C1 + beta*C2
  // x'(0)=0 => x_h'(0) + x_s'(0)=0 => (-1/2)C1 + beta*C2 + xsp0 = 0
  const C2 = ( (0.5*C1) - xsp0 ) / beta;

  const xh = Math.exp(-t/2) * (C1*Math.cos(beta*t) + C2*Math.sin(beta*t));
  return xh + xs;
}

// Problem 77 with example IC x(0)=0 for plot: x = xs + C e^{-kt}, C = -xs(0)
function x77_with_exampleIC(t, k, N){
  const xs = x77_steady(t, k, N);
  const xs0 = x77_steady(0, k, N);
  const C = -xs0;
  return xs + C*Math.exp(-k*t);
}

// Problem 79: compute x(t) with example ICs x(0)=0, x'(0)=0 using partial sum + resonance
function x79_with_exampleIC(t, N){
  // particular sum:
  let xp = 0;
  let xpp = 0; // derivative at 0 for IC fit
  for(let n=1; n<=N; n++){
    const An = 1/(n*n * (n*n-2)*(n*n-2));
    if(n === 4){
      // resonant particular: (A4/8) t sin(4t)
      const A4 = An;
      xp += (A4/8)*t*Math.sin(4*t);
      // derivative: d/dt[(A4/8)t sin(4t)] = (A4/8)[sin(4t) + 4t cos(4t)]
      // at t=0 => 0
      // so contributes 0 to xpp at 0
    }else{
      const coeff = An/(16 - n*n);
      xp += coeff*Math.cos(n*t);
      // derivative at 0: -coeff*n*sin(0)=0
    }
  }

  // For ICs, add homogeneous: C1 cos(4t) + C2 sin(4t)
  // x(0)=0 => C1 + xp(0)=0 => C1=-xp(0)
  // x'(0)=0 => 4*C2 + xp'(0)=0; xp'(0)=0 for our truncated cosine+res form => C2=0
  // Need xp(0):
  let xp0 = 0;
  for(let n=1; n<=N; n++){
    const An = 1/(n*n * (n*n-2)*(n*n-2));
    if(n === 4){
      // resonant term is 0 at t=0
    }else{
      xp0 += (An/(16 - n*n))*Math.cos(0);
    }
  }
  const C1 = -xp0;
  const C2 = 0;

  return C1*Math.cos(4*t) + C2*Math.sin(4*t) + xp;
}

/* =========================
   Canvas plotting
========================= */
function setupCanvas(canvas){
  const ctx = canvas.getContext('2d');
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.max(2, Math.floor(rect.width * dpr));
    canvas.height = Math.max(2, Math.floor(rect.height * dpr));
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  return {ctx, resize};
}

function drawPanelBackground(ctx, w, h){
  ctx.clearRect(0,0,w,h);
  // soft gradient
  const g = ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0, 'rgba(255,255,255,0.04)');
  g.addColorStop(1, 'rgba(0,0,0,0.10)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,w,h);
}

function drawAxes(ctx, box, xLabel, yLabel, title){
  const {x,y,w,h} = box;
  // title
  ctx.save();
  ctx.fillStyle = 'rgba(233,238,252,0.95)';
  ctx.font = '600 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText(title, x+8, y+18);

  // axes
  ctx.strokeStyle = 'rgba(255,255,255,0.18)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(x+52, y+h-38);
  ctx.lineTo(x+w-14, y+h-38);
  ctx.moveTo(x+52, y+30);
  ctx.lineTo(x+52, y+h-38);
  ctx.stroke();

  // labels
  ctx.fillStyle = 'rgba(183,194,230,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText(xLabel, x+w-54, y+h-16);

  ctx.save();
  ctx.translate(x+16, y+50);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yLabel, 0, 0);
  ctx.restore();

  ctx.restore();
}

function niceTicks(min, max, count){
  if(max===min) return {min, max, step:1};
  const span = Math.abs(max-min);
  const raw = span / Math.max(1,count);
  const pow = Math.pow(10, Math.floor(Math.log10(raw)));
  const norm = raw / pow;
  let step;
  if(norm < 1.5) step = 1*pow;
  else if(norm < 3) step = 2*pow;
  else if(norm < 7) step = 5*pow;
  else step = 10*pow;
  const tmin = Math.floor(min/step)*step;
  const tmax = Math.ceil(max/step)*step;
  return {min:tmin, max:tmax, step};
}

function plotLines(ctx, box, series, xMin, xMax, yMin, yMax, options){
  const {x,y,w,h} = box;
  const left = x+52, right = x+w-14, top = y+30, bottom = y+h-38;
  const pw = right-left, ph = bottom-top;

  // grid
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 1;

  const xt = niceTicks(xMin, xMax, 6);
  const yt = niceTicks(yMin, yMax, 5);

  // vertical grid + x ticks
  ctx.fillStyle = 'rgba(183,194,230,0.85)';
  ctx.font = '11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace';

  for(let xv=xt.min; xv<=xt.max+0.5*xt.step; xv+=xt.step){
    const u = (xv-xMin)/(xMax-xMin);
    const X = left + u*pw;
    ctx.beginPath(); ctx.moveTo(X, top); ctx.lineTo(X, bottom); ctx.stroke();
    ctx.fillText((Math.abs(xv) < 1e-9 ? "0" : xv.toFixed(2)), X-14, bottom+14);
    // tick mark
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.beginPath(); ctx.moveTo(X, bottom); ctx.lineTo(X, bottom+4); ctx.stroke();
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  }

  // horizontal grid + y ticks
  for(let yv=yt.min; yv<=yt.max+0.5*yt.step; yv+=yt.step){
    const v = (yv-yMin)/(yMax-yMin);
    const Y = bottom - v*ph;
    ctx.beginPath(); ctx.moveTo(left, Y); ctx.lineTo(right, Y); ctx.stroke();
    ctx.fillText((Math.abs(yv) < 1e-9 ? "0" : yv.toFixed(2)), x+10, Y+4);
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.beginPath(); ctx.moveTo(left-4, Y); ctx.lineTo(left, Y); ctx.stroke();
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  }
  ctx.restore();

  // lines (no custom colors: use subtle automatic palette by varying alpha + dash)
  const styles = [
    {stroke:'rgba(233,238,252,0.95)', dash:[]},
    {stroke:'rgba(125,211,252,0.95)', dash:[6,4]},
    {stroke:'rgba(167,139,250,0.95)', dash:[2,4]},
    {stroke:'rgba(52,211,153,0.95)', dash:[10,4,2,4]}
  ];

  series.forEach((s, idx)=>{
    const sty = styles[idx % styles.length];
    ctx.save();
    ctx.strokeStyle = sty.stroke;
    ctx.lineWidth = 2;
    ctx.setLineDash(sty.dash);
    ctx.beginPath();
    for(let i=0;i<s.x.length;i++){
      const u = (s.x[i]-xMin)/(xMax-xMin);
      const v = (s.y[i]-yMin)/(yMax-yMin);
      const X = left + u*pw;
      const Y = bottom - v*ph;
      if(i===0) ctx.moveTo(X,Y);
      else ctx.lineTo(X,Y);
    }
    ctx.stroke();
    ctx.restore();
  });

  // legend
  if(options && options.legend){
    ctx.save();
    ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
    const pad = 8;
    let lx = x+58, ly = y+38;
    series.forEach((s, idx)=>{
      const sty = styles[idx % styles.length];
      ctx.strokeStyle = sty.stroke;
      ctx.lineWidth = 3;
      ctx.setLineDash(sty.dash);
      ctx.beginPath();
      ctx.moveTo(lx, ly);
      ctx.lineTo(lx+26, ly);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = 'rgba(233,238,252,0.95)';
      ctx.fillText(s.label || `Series ${idx+1}`, lx+32, ly+4);
      ly += 16;
    });
    ctx.restore();
  }
}

function plotBars(ctx, box, xs, ys, xMin, xMax, yMin, yMax, title, xLabel, yLabel){
  const {x,y,w,h} = box;
  drawAxes(ctx, box, xLabel, yLabel, title);
  const left = x+52, right = x+w-14, top = y+30, bottom = y+h-38;
  const pw = right-left, ph = bottom-top;

  // grid + ticks
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 1;
  const xt = niceTicks(xMin, xMax, 6);
  const yt = niceTicks(yMin, yMax, 5);

  ctx.fillStyle = 'rgba(183,194,230,0.85)';
  ctx.font = '11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace';

  for(let xv=xt.min; xv<=xt.max+0.5*xt.step; xv+=xt.step){
    const u = (xv-xMin)/(xMax-xMin);
    const X = left + u*pw;
    ctx.beginPath(); ctx.moveTo(X, top); ctx.lineTo(X, bottom); ctx.stroke();
    ctx.fillText((Math.abs(xv) < 1e-9 ? "0" : xv.toFixed(2)), X-14, bottom+14);
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.beginPath(); ctx.moveTo(X, bottom); ctx.lineTo(X, bottom+4); ctx.stroke();
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  }
  for(let yv=yt.min; yv<=yt.max+0.5*yt.step; yv+=yt.step){
    const v = (yv-yMin)/(yMax-yMin);
    const Y = bottom - v*ph;
    ctx.beginPath(); ctx.moveTo(left, Y); ctx.lineTo(right, Y); ctx.stroke();
    ctx.fillText((Math.abs(yv) < 1e-9 ? "0" : yv.toFixed(2)), x+10, Y+4);
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.beginPath(); ctx.moveTo(left-4, Y); ctx.lineTo(left, Y); ctx.stroke();
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  }
  ctx.restore();

  // bars
  ctx.save();
  ctx.fillStyle = 'rgba(125,211,252,0.75)';
  ctx.strokeStyle = 'rgba(233,238,252,0.25)';
  const barW = pw / Math.max(1, xs.length) * 0.65;

  for(let i=0;i<xs.length;i++){
    const u = (xs[i]-xMin)/(xMax-xMin);
    const X = left + u*pw;
    const v = (ys[i]-yMin)/(yMax-yMin);
    const Y = bottom - v*ph;
    const hh = bottom - Y;
    ctx.fillRect(X-barW/2, Y, barW, hh);
    ctx.strokeRect(X-barW/2, Y, barW, hh);
  }
  ctx.restore();
}

function drawDiagram(ctx, w, h, modeLabel, paramLabel, paramValue){
  drawPanelBackground(ctx, w, h);
  // Simple block diagram: forcing -> system -> x(t)
  ctx.save();
  ctx.fillStyle = 'rgba(233,238,252,0.95)';
  ctx.font = '600 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('LTI System View (ODE as a filter)', 14, 20);

  // nodes
  const midY = h*0.55;
  const x0 = 40, x1 = w*0.42, x2 = w*0.78;

  // forcing box
  ctx.strokeStyle = 'rgba(255,255,255,0.18)';
  ctx.fillStyle = 'rgba(255,255,255,0.04)';
  ctx.lineWidth = 1.5;

  function roundRect(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  roundRect(x0, midY-40, 160, 76, 14);
  ctx.fill(); ctx.stroke();

  ctx.fillStyle = 'rgba(233,238,252,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('Input forcing', x0+16, midY-12);
  ctx.fillStyle = 'rgba(183,194,230,0.95)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace';
  ctx.fillText(modeLabel.includes('77') ? 'f(t)' : (modeLabel.includes('78') ? 'g(t)' : 'r(t)'), x0+16, midY+14);

  // system block
  ctx.strokeStyle = 'rgba(125,211,252,0.35)';
  ctx.fillStyle = 'rgba(125,211,252,0.06)';
  roundRect(x1, midY-55, 220, 106, 18);
  ctx.fill(); ctx.stroke();

  ctx.fillStyle = 'rgba(233,238,252,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('System (ODE)', x1+16, midY-22);
  ctx.fillStyle = 'rgba(183,194,230,0.95)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace';

  let eq;
  if(modeLabel.includes('77')) eq = "x' + kx = f(t)";
  else if(modeLabel.includes('78')) eq = "x'' + x' + 8x = g(t)";
  else eq = "x'' + 16x = Σ ...";
  ctx.fillText(eq, x1+16, midY+6);

  ctx.fillStyle = 'rgba(183,194,230,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText(paramLabel + ': ' + paramValue, x1+16, midY+32);

  // output box
  ctx.strokeStyle = 'rgba(167,139,250,0.35)';
  ctx.fillStyle = 'rgba(167,139,250,0.06)';
  roundRect(x2, midY-40, 160, 76, 14);
  ctx.fill(); ctx.stroke();

  ctx.fillStyle = 'rgba(233,238,252,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('Output response', x2+16, midY-12);
  ctx.fillStyle = 'rgba(183,194,230,0.95)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace';
  ctx.fillText('x(t)', x2+16, midY+14);

  // arrows
  function arrow(ax,ay,bx,by){
    const dx=bx-ax, dy=by-ay;
    const L=Math.hypot(dx,dy) || 1;
    const ux=dx/L, uy=dy/L;
    ctx.beginPath();
    ctx.moveTo(ax,ay); ctx.lineTo(bx,by); ctx.stroke();
    // head
    const s=8;
    ctx.beginPath();
    ctx.moveTo(bx,by);
    ctx.lineTo(bx - s*(ux) - s*0.55*(uy), by - s*(uy) + s*0.55*(ux));
    ctx.lineTo(bx - s*(ux) + s*0.55*(uy), by - s*(uy) - s*0.55*(ux));
    ctx.closePath();
    ctx.fill();
  }

  ctx.strokeStyle='rgba(233,238,252,0.25)';
  ctx.fillStyle='rgba(233,238,252,0.25)';
  ctx.lineWidth=2;
  arrow(x0+160, midY-2, x1, midY-2);
  arrow(x1+220, midY-2, x2, midY-2);

  // note about resonance for 79
  if(modeLabel.includes('79')){
    ctx.fillStyle='rgba(251,191,36,0.95)';
    ctx.font='12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
    ctx.fillText('⚠ Resonance at n=4 (ω=4): growth ~ t·sin(4t)', 14, h-18);
  }else{
    ctx.fillStyle='rgba(183,194,230,0.8)';
    ctx.font='12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
    ctx.fillText('Superposition: solve each harmonic, then add.', 14, h-18);
  }

  ctx.restore();
}

/* =========================
   App state + render
========================= */
const canvases = {
  diagram: setupCanvas($('cDiagram')),
  main: setupCanvas($('cMain')),
  secondary: setupCanvas($('cSecondary')),
};

function currentConfig(){
  const mode = $('problemSel').value;
  const N = parseInt($('nSlider').value,10);

  // param slider meaning changes per mode:
  let param = parseFloat($('paramSlider').value);

  return {mode, N, param};
}

function updateControlsUI(){
  const mode = $('problemSel').value;
  $('problemNote').textContent = `Mode: ${mode}`;

  if(mode === '77'){
    $('paramLabel').textContent = 'Parameter k (Problem 77)';
    $('paramHint').textContent = 'Meaning: decay rate / “stiffness” of the first-order filter.';
    $('paramSlider').min = '0.2';
    $('paramSlider').max = '6';
    $('paramSlider').step = '0.05';
    if(parseFloat($('paramSlider').value) < 0.2) $('paramSlider').value = '1.5';
    $('paramVal').textContent = `k = ${parseFloat($('paramSlider').value).toFixed(2)}`;
  }else if(mode === '78'){
    $('paramLabel').textContent = 'Amplitude scale A (Problem 78, plotting only)';
    $('paramHint').textContent = 'Meaning: multiplies g(t) and thus multiplies the steady-state response.';
    $('paramSlider').min = '0.2';
    $('paramSlider').max = '3';
    $('paramSlider').step = '0.05';
    if(parseFloat($('paramSlider').value) > 3) $('paramSlider').value = '1.0';
    $('paramVal').textContent = `A = ${parseFloat($('paramSlider').value).toFixed(2)}`;
  }else{
    $('paramLabel').textContent = 'Time window T (Problem 79, plotting only)';
    $('paramHint').textContent = 'Meaning: shows how resonance-driven growth appears over longer time.';
    $('paramSlider').min = '6';
    $('paramSlider').max = '60';
    $('paramSlider').step = '1';
    if(parseFloat($('paramSlider').value) < 6) $('paramSlider').value = '24';
    $('paramVal').textContent = `T = ${parseFloat($('paramSlider').value).toFixed(0)} s (dimensionless t)`;
  }

  $('nVal').textContent = `N = ${$('nSlider').value}`;
}

function renderAll(){
  // resize canvases
  for(const k in canvases) canvases[k].resize();

  const {mode, N, param} = currentConfig();

  // diagram
  {
    const ctx = canvases.diagram.ctx;
    const w = $('cDiagram').getBoundingClientRect().width;
    const h = $('cDiagram').getBoundingClientRect().height;
    const label = `Problem ${mode}`;
    let pLabel = 'param';
    let pVal = '';
    if(mode==='77'){ pLabel='k'; pVal = param.toFixed(2); }
    else if(mode==='78'){ pLabel='A (scale)'; pVal = param.toFixed(2); }
    else { pLabel='T (window)'; pVal = param.toFixed(0); }
    drawDiagram(ctx, w, h, label, pLabel, pVal);
  }

  // main plot: forcing + response
  {
    const ctx = canvases.main.ctx;
    const rect = $('cMain').getBoundingClientRect();
    const W = rect.width, H = rect.height;
    drawPanelBackground(ctx, W, H);

    const box = {x:0, y:0, w:W, h:H};
    let xLabel='t (dimensionless)', yLabel='value', title='Forcing and Response';

    let tMin, tMax, nPts;
    if(mode==='77'){
      // show 2 periods
      tMin = -Math.PI; tMax = 3*Math.PI; nPts = 900;
      title = "Problem 77: f(t) (triangle) and x(t) for x' + kx = f(t)";
      drawAxes(ctx, box, xLabel, yLabel, title);

      const xs = [], f = [], x = [];
      for(let i=0;i<nPts;i++){
        const t = tMin + (tMax-tMin)*i/(nPts-1);
        xs.push(t);
        f.push(f77_series(t, N));
        x.push(x77_with_exampleIC(t, param, N));
      }
      // bounds
      const all = f.concat(x);
      let ymin = Math.min(...all), ymax = Math.max(...all);
      const pad = 0.10*(ymax-ymin || 1);
      ymin -= pad; ymax += pad;

      plotLines(ctx, box,
        [{x:xs,y:f,label:'forcing f(t) (Fourier approx)'},{x:xs,y:x,label:'response x(t) (example ICs)'}],
        tMin,tMax,ymin,ymax,{legend:true});

    }else if(mode==='78'){
      tMin = -2; tMax = 6; nPts = 900;
      title = "Problem 78: g(t) (triangle) and x(t) for x'' + x' + 8x = A·g(t)";
      drawAxes(ctx, box, xLabel, yLabel, title);

      const xs=[], g=[], x=[];
      for(let i=0;i<nPts;i++){
        const t = tMin + (tMax-tMin)*i/(nPts-1);
        xs.push(t);
        const gt = g78_series(t, N);
        g.push(param*gt);
        x.push(param*x78_with_exampleIC(t, N)); // scale solution linearly for plotting
      }
      const all = g.concat(x);
      let ymin = Math.min(...all), ymax = Math.max(...all);
      const pad = 0.10*(ymax-ymin || 1);
      ymin -= pad; ymax += pad;

      plotLines(ctx, box,
        [{x:xs,y:g,label:'forcing A·g(t) (Fourier approx)'},{x:xs,y:x,label:'response x(t) (example ICs)'}],
        tMin,tMax,ymin,ymax,{legend:true});

    }else{
      // mode 79
      tMin = 0; tMax = param; nPts = 1100;
      title = "Problem 79: r(t) and x(t) for x'' + 16x = r(t) (resonance at n=4)";
      drawAxes(ctx, box, xLabel, yLabel, title);

      const xs=[], r=[], x=[];
      for(let i=0;i<nPts;i++){
        const t = tMin + (tMax-tMin)*i/(nPts-1);
        xs.push(t);
        r.push(rhs79_series(t, N));
        x.push(x79_with_exampleIC(t, N));
      }
      const all = r.concat(x);
      let ymin = Math.min(...all), ymax = Math.max(...all);
      const pad = 0.10*(ymax-ymin || 1);
      ymin -= pad; ymax += pad;

      plotLines(ctx, box,
        [{x:xs,y:r,label:'forcing r(t) (partial sum)'},{x:xs,y:x,label:'response x(t) (includes resonance)'}],
        tMin,tMax,ymin,ymax,{legend:true});
    }
  }

  // secondary plot: |H(iω)| evaluated at harmonic frequencies used
  {
    const ctx = canvases.secondary.ctx;
    const rect = $('cSecondary').getBoundingClientRect();
    const W = rect.width, H = rect.height;
    drawPanelBackground(ctx, W, H);

    const box = {x:0,y:0,w:W,h:H};

    let xs=[], ys=[], title='', xLabel='ω (rad/s, dimensionless)', yLabel='|H(iω)|';
    if(mode==='77'){
      title = "Problem 77: Magnitude response |H(iω)| for H(iω)=1/(k+iω), ω=odd integers";
      const k = param;
      for(let m=1;m<=Math.min(N,30);m++){
        const j=2*m-1;
        const mag = 1/Math.sqrt(k*k + j*j);
        xs.push(j);
        ys.push(mag);
      }
      plotBars(ctx, box, xs, ys, 0, xs[xs.length-1], 0, Math.max(...ys)*1.15, title, xLabel, yLabel);

    }else if(mode==='78'){
      title = "Problem 78: Magnitude response |H(iω)| for H(iω)=1/(8−ω²+iω), ω=(odd)π";
      for(let m=1;m<=Math.min(N,25);m++){
        const j=2*m-1;
        const w=j*Math.PI;
        const mag = 1/Math.sqrt((8-w*w)*(8-w*w) + w*w);
        xs.push(w);
        ys.push(mag);
      }
      plotBars(ctx, box, xs, ys, 0, xs[xs.length-1], 0, Math.max(...ys)*1.15, title, xLabel, yLabel);

    }else{
      title = "Problem 79: Undamped response factor |1/(16−ω²)| at ω=n (resonance at ω=4)";
      for(let n=1;n<=Math.min(N,30);n++){
        const denom = Math.abs(16 - n*n);
        const mag = (n===4) ? Math.max(...ys, 2) : 1/(denom || 1e-9);
        xs.push(n);
        ys.push(n===4 ? Math.max(ys.length?Math.max(...ys)*1.25:2, 2) : mag);
      }
      // scale view: clip large values by plotting a capped bar for resonance
      const yMax = Math.max(...ys)*1.15;
      plotBars(ctx, box, xs, ys, 0, xs[xs.length-1], 0, yMax, title, xLabel, yLabel);

      // annotate resonance bar
      ctx.save();
      ctx.fillStyle = 'rgba(251,191,36,0.95)';
      ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('Resonance at ω=4 (bar capped)', 60, 52);
      ctx.restore();
    }
  }
}

function onChange(){
  updateControlsUI();
  renderAll();
}

window.addEventListener('resize', ()=>renderAll());
$('problemSel').addEventListener('change', onChange);
$('paramSlider').addEventListener('input', onChange);
$('nSlider').addEventListener('input', onChange);

// init
updateControlsUI();
renderAll();
</script>
</body>
</html>
