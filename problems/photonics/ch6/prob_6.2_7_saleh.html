<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reflection from an Absorptive Medium (Normal Incidence) — Maxwell + Boundary Conditions</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1624;
      --panel2:#111c2e;
      --text:#e9eefc;
      --muted:#b7c3e6;
      --faint:#7f8bb3;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --accent:#7aa2ff;
      --accent2:#7dffcc;
      --warn:#ffd37a;
      --ok:#8dff9c;
      --bad:#ff7a9b;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(122,162,255,.20), transparent 60%),
        radial-gradient(1000px 600px at 90% 20%, rgba(125,255,204,.12), transparent 55%),
        radial-gradient(1000px 900px at 50% 110%, rgba(255,211,122,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      line-height:1.55;
    }

    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    header{
      padding:28px 18px 12px;
      position:relative;
      overflow:hidden;
    }
    .hero{
      max-width:1200px;
      margin:0 auto;
      padding:22px 22px 18px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      border-radius: var(--radius2);
    }
    .kicker{
      display:flex;
      gap:10px;
      align-items:center;
      color:var(--muted);
      font-size:.95rem;
      letter-spacing:.2px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--line2);
      border-radius:999px;
      background:rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background:linear-gradient(180deg,var(--accent), rgba(122,162,255,.2));
      box-shadow: 0 0 0 3px rgba(122,162,255,.12);
    }

    h1{
      margin:10px 0 6px;
      font-size: clamp(1.45rem, 2.6vw, 2.25rem);
      line-height:1.18;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      max-width: 78ch;
      font-size:1.02rem;
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding: 10px 18px 60px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      align-items:start;
    }

    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(15,22,36,.72);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      padding:14px 14px 10px;
    }
    .toc h2{
      margin:0 0 10px;
      font-size:1.03rem;
      color:var(--text);
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .toc small{ color:var(--faint); font-weight:500; }
    .toc a{
      display:block;
      padding:9px 10px;
      border-radius: 12px;
      color:var(--muted);
      border: 1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:.95rem;
      line-height:1.15;
    }
    .toc a:hover{
      background: rgba(122,162,255,.10);
      border-color: rgba(122,162,255,.22);
      transform: translateY(-1px);
      text-decoration:none;
      color:var(--text);
    }
    .toc .hint{
      margin-top:10px;
      padding:10px 10px;
      border-radius: 14px;
      border:1px dashed rgba(255,255,255,.14);
      color:var(--faint);
      font-size:.9rem;
    }

    article.card{
      border:1px solid var(--line);
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(17,28,46,.86), rgba(15,22,36,.60));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .content{
      padding: 18px 18px 10px;
    }
    section{
      padding: 6px 0 18px;
      border-top: 1px solid rgba(255,255,255,.08);
      scroll-margin-top: 80px;
    }
    section:first-of-type{ border-top: none; }

    h2{
      margin: 10px 0 10px;
      font-size:1.35rem;
      letter-spacing:.2px;
    }
    h3{
      margin: 14px 0 8px;
      font-size:1.12rem;
      color:var(--text);
      letter-spacing:.15px;
    }
    p{ margin: 8px 0 10px; color: var(--muted); }
    ul{ margin: 10px 0 10px 22px; color: var(--muted); }
    li{ margin: 6px 0; }

    .grid2{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      align-items:stretch;
    }
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      align-items:stretch;
    }

    .callout{
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding: 12px 12px;
      background: rgba(0,0,0,.16);
      position:relative;
      overflow:hidden;
    }
    .callout::before{
      content:"";
      position:absolute;
      inset:-2px auto -2px -2px;
      width: 6px;
      background: linear-gradient(180deg, rgba(122,162,255,.9), rgba(125,255,204,.35));
      border-radius: 999px;
      filter: blur(.0px);
      opacity:.9;
    }
    .callout strong{ color: var(--text); }
    .callout .label{
      font-size:.85rem;
      letter-spacing:.28px;
      text-transform:uppercase;
      color: var(--faint);
      margin-bottom: 6px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .warn::before{ background: linear-gradient(180deg, rgba(255,211,122,.95), rgba(255,122,155,.35)); }
    .ok::before{ background: linear-gradient(180deg, rgba(141,255,156,.95), rgba(125,255,204,.35)); }
    .eq::before{ background: linear-gradient(180deg, rgba(122,162,255,.95), rgba(122,162,255,.15)); }

    .equation{
      font-family: var(--mono);
      font-size: .98rem;
      color: var(--text);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 10px;
      overflow:auto;
      white-space: pre;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(122,162,255,.10);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:.92rem;
    }
    .btn:hover{
      background: rgba(122,162,255,.18);
      border-color: rgba(122,162,255,.35);
      transform: translateY(-1px);
    }
    .btn:active{ transform: translateY(0px); }
    .toast{
      font-size:.9rem;
      color: var(--faint);
      min-height: 1.2em;
    }

    figure{
      margin: 12px 0 12px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      padding: 12px 12px 14px;
    }
    figure h3{
      margin: 0 0 8px;
      font-size: 1.05rem;
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .canvasWrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    canvas{
      width:100%;
      height: 260px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      display:block;
    }
    .canvasSmall canvas{ height: 240px; }
    .figNote{
      color: var(--faint);
      font-size:.92rem;
      margin: 4px 0 0;
    }

    .controls{
      display:grid;
      grid-template-columns: 1.1fr 1.1fr .8fr;
      gap: 10px;
      margin: 10px 0 6px;
    }
    .ctrl{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 10px 10px;
      background: rgba(0,0,0,.14);
    }
    .ctrl label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      font-size:.92rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .ctrl .val{
      font-family: var(--mono);
      color: var(--text);
      font-size:.92rem;
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    select{
      width:100%;
      border-radius: 12px;
      padding: 8px 10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,22,36,.75);
      color: var(--text);
      outline:none;
    }

    .miniGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .miniBox{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 10px 10px;
      background: rgba(0,0,0,.14);
    }
    .miniBox .k{
      color: var(--faint);
      font-size:.88rem;
      margin-bottom: 4px;
    }
    .miniBox .v{
      font-family: var(--mono);
      color: var(--text);
      font-size: .98rem;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    footer{
      max-width:1200px;
      margin: 10px auto 30px;
      padding: 0 18px;
      color: var(--faint);
      font-size:.92rem;
    }

    .hr{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 10px 0 12px;
    }

    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
      nav.toc{ position:relative; top:auto; }
      .grid2{ grid-template-columns: 1fr; }
      .grid3{ grid-template-columns: 1fr; }
      .controls{ grid-template-columns: 1fr; }
      canvas{ height: 250px; }
    }

    /* Subtle motion */
    @media (prefers-reduced-motion: no-preference){
      .hero, article.card, nav.toc{ animation: pop .55s ease both; }
      @keyframes pop{
        from{ transform: translateY(10px); opacity:0; }
        to{ transform: translateY(0px); opacity:1; }
      }
    }

    /* Print-friendly */
    @media print{
      body{ background:#fff; color:#000; }
      nav.toc{ display:none; }
      .hero, article.card{ box-shadow:none; background:#fff; border-color:#bbb; }
      .callout, .equation, .ctrl, .miniBox{ background:#fff; border-color:#bbb; }
      canvas{ display:none; }
      a{ color:#000; text-decoration:underline; }
      .btn{ display:none; }
      .subtitle, p, li{ color:#111; }
    }
  </style>
</head>
<body>
<header>
  <div class="hero">
    <div class="kicker">
      <span class="pill"><span class="dot"></span> Photonics • EM Waves • Fresnel Reflection</span>
      <span class="pill">Normal incidence</span>
      <span class="pill">Absorptive medium (complex index)</span>
    </div>
    <h1>Reflection from an Absorptive Medium: Deriving the Complex Amplitude Reflectance</h1>
    <p class="subtitle">
      Using Maxwell’s equations and boundary conditions, we derive the reflection coefficient at a flat interface
      between free space and a lossy (absorbing) dielectric, and connect the result to measurable magnitude and phase.
    </p>
  </div>
</header>

<main>
  <nav class="toc" aria-label="Table of contents">
    <h2>Contents <small>sticky</small></h2>
    <a href="#quick">Quick Summary</a>
    <a href="#part0">PART 0 — Concept Primer</a>
    <a href="#part1">PART 1 — Problem Analysis</a>
    <a href="#part2">PART 2 — Strategy & Tips</a>
    <a href="#part3">PART 3 — Full Solution</a>
    <a href="#part4">PART 4 — Deeper Understanding</a>
    <a href="#part5">PART 5 — Visualization Guide</a>
    <div class="hint">
      Tip: use the sliders to see how absorption changes both <b>reflectance magnitude</b> and <b>phase</b>.
    </div>
  </nav>

  <article class="card">
    <div class="content">

      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this is about:</b> reflection of a monochromatic plane wave at a flat interface when the second medium <b>absorbs</b> light.</li>
          <li><b>Key physics idea:</b> absorption is captured by a <b>complex refractive index</b> (or equivalently a complex wavenumber), which makes the reflection coefficient complex (magnitude + phase).</li>
          <li><b>Governing laws:</b> Maxwell’s equations in source-free linear media → plane-wave relations between <b>E</b> and <b>H</b> plus boundary conditions on tangential fields.</li>
          <li><b>Key boundary conditions:</b> tangential <b>E</b> and <b>H</b> are continuous at the interface (no surface charge/current).</li>
          <li><b>Model connection:</b> absorption coefficient <b>α</b> relates to the imaginary part of refractive index via
            <span style="font-family:var(--mono)">κ = αc/(2ω) = αλ/(4π)</span>.</li>
          <li><b>Final result type:</b> symbolic (complex amplitude reflectance <b>r</b>) and derived from first principles.</li>
          <li><b>Target formula (proved below):</b> <span style="font-family:var(--mono)">r = [(n − j αc/(2ω)) − 1] / [(n − j αc/(2ω)) + 1]</span>.</li>
        </ul>
      </section>

      <section id="part0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <div>
            <h3>Core definitions (symbols + units)</h3>
            <ul>
              <li><b>Refractive index</b> <span style="font-family:var(--mono)">n</span> (dimensionless): sets phase velocity <span style="font-family:var(--mono)">v = c/n</span> in a lossless dielectric.</li>
              <li><b>Absorption coefficient</b> <span style="font-family:var(--mono)">α</span> (m<sup>−1</sup>): intensity decays as <span style="font-family:var(--mono)">I(z) = I(0) e^{−α z}</span>.</li>
              <li><b>Angular frequency</b> <span style="font-family:var(--mono)">ω</span> (rad/s) and wavelength <span style="font-family:var(--mono)">λ</span> (m): <span style="font-family:var(--mono)">ω = 2πc/λ</span> in free space.</li>
              <li><b>Complex refractive index</b> <span style="font-family:var(--mono)">ñ</span> (dimensionless): <span style="font-family:var(--mono)">ñ = n − jκ</span> with <span style="font-family:var(--mono)">j^2 = −1</span>.</li>
              <li><b>Wavenumber</b> <span style="font-family:var(--mono)">k</span> (m<sup>−1</sup>): in a lossy medium <span style="font-family:var(--mono)">k = (ω/c) ñ</span> is complex.</li>
              <li><b>Wave impedance</b> <span style="font-family:var(--mono)">η</span> (Ω): ratio of field magnitudes for a plane wave, linking <span style="font-family:var(--mono)">E</span> and <span style="font-family:var(--mono)">H</span>.</li>
            </ul>
          </div>

          <div class="callout eq">
            <div class="label">Key model for absorption</div>
            <p>
              If the field in the absorbing medium behaves like
              <span style="font-family:var(--mono)">E(z) ∝ e^{−j(ω/c)ñ z}</span> with <span style="font-family:var(--mono)">ñ = n − jκ</span>,
              then the amplitude decays as <span style="font-family:var(--mono)">e^{−(ω/c)κ z}</span>, so the <b>intensity</b> decays as:
            </p>
            <div class="equation" id="eq_alpha">
I(z) ∝ |E|^2 ∝ e^{−2(ω/c)κ z}  ⇒  α = 2(ω/c)κ  ⇒  κ = αc/(2ω) = αλ/(4π)
            </div>
            <div class="row">
              <button class="btn" data-copy="eq_alpha">Copy</button>
              <span class="toast" id="toast_eq_alpha"></span>
            </div>
          </div>
        </div>

        <h3>Physical meaning (what these quantities represent)</h3>
        <ul>
          <li><b>Real part</b> of <span style="font-family:var(--mono)">ñ</span> (the <span style="font-family:var(--mono)">n</span>) controls <b>phase advance</b> and refraction.</li>
          <li><b>Imaginary part</b> (the <span style="font-family:var(--mono)">κ</span>) controls <b>exponential attenuation</b> of the wave as it propagates into the medium.</li>
          <li>The reflection coefficient <span style="font-family:var(--mono)">r</span> is generally <b>complex</b>, meaning the reflected wave may acquire a <b>phase shift</b> even at normal incidence.</li>
        </ul>

        <div class="grid3">
          <div class="callout ok">
            <div class="label">When the theory is valid</div>
            <ul>
              <li>Linear, homogeneous, isotropic media.</li>
              <li>Time-harmonic fields (<span style="font-family:var(--mono)">e^{+jωt}</span> convention).</li>
              <li>Planar interface; normal incidence; steady-state.</li>
              <li>No free surface charge/current at the boundary.</li>
            </ul>
          </div>
          <div class="callout">
            <div class="label">Common models & why</div>
            <ul>
              <li><b>Complex index</b> packages loss into one parameter, making boundary math look like the lossless Fresnel case.</li>
              <li><b>Non-magnetic</b> assumption (<span style="font-family:var(--mono)">μ ≈ μ0</span>) is typical for optical dielectrics.</li>
              <li>Absorption via <span style="font-family:var(--mono)">α</span> matches experimental Beer–Lambert measurements.</li>
            </ul>
          </div>
          <div class="callout warn">
            <div class="label">What to watch for</div>
            <ul>
              <li>Confusing <b>field amplitude</b> decay with <b>intensity</b> decay (factor of 2!).</li>
              <li>Sign conventions for <span style="font-family:var(--mono)">j</span> and wave propagation direction.</li>
              <li>Whether <span style="font-family:var(--mono)">r</span> refers to the <b>E-field</b> or <b>H-field</b> amplitude.</li>
              <li>Remember: lossy media → <span style="font-family:var(--mono)">r</span> has a phase.</li>
            </ul>
          </div>
        </div>

        <h3>Mini intuition examples (no heavy algebra)</h3>
        <ul>
          <li><b>No absorption (α = 0):</b> the medium behaves like a lossless dielectric, and <span style="font-family:var(--mono)">r</span> reduces to the familiar Fresnel form for real indices.</li>
          <li><b>Strong absorption:</b> the transmitted wave dies quickly; the interface can behave more like a “mismatch” that can increase reflectance magnitude and introduce significant phase shift.</li>
        </ul>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <h3>Restate the problem (in plain words)</h3>
        <p>
          A plane electromagnetic wave hits a flat boundary between free space and an absorbing medium at <b>normal incidence</b>.
          The medium is described by a real refractive index <span style="font-family:var(--mono)">n</span> and an absorption coefficient
          <span style="font-family:var(--mono)">α</span>. Using Maxwell’s equations and boundary conditions, prove that the
          <b>complex amplitude reflectance</b> is
          <span style="font-family:var(--mono)">r = [(n − j αc/(2ω)) − 1] / [(n − j αc/(2ω)) + 1]</span>.
        </p>

        <div class="grid2">
          <div>
            <h3>Given</h3>
            <ul>
              <li>Medium 1: free space, refractive index <span style="font-family:var(--mono)">n1 = 1</span>, impedance <span style="font-family:var(--mono)">η0</span>.</li>
              <li>Medium 2: absorbing dielectric, real index <span style="font-family:var(--mono)">n</span>, absorption coefficient <span style="font-family:var(--mono)">α</span>, non-magnetic <span style="font-family:var(--mono)">μ ≈ μ0</span>.</li>
              <li>Normal incidence, monochromatic (single <span style="font-family:var(--mono)">ω</span>).</li>
            </ul>
            <h3>Unknown</h3>
            <ul>
              <li>Complex amplitude reflection coefficient <span style="font-family:var(--mono)">r</span> at the boundary.</li>
            </ul>
            <h3>Must be shown</h3>
            <ul>
              <li>That <span style="font-family:var(--mono)">r</span> can be written using a complex index <span style="font-family:var(--mono)">ñ = n − j αc/(2ω)</span> in a Fresnel-like form.</li>
            </ul>
          </div>

          <div class="callout">
            <div class="label">Relevant physics principles (and why)</div>
            <ul>
              <li><b>Maxwell (source-free):</b> ensures plane-wave solutions and fixes the <span style="font-family:var(--mono)">E–H</span> relationship in each medium.</li>
              <li><b>Boundary conditions:</b> tangential <span style="font-family:var(--mono)">E</span> and <span style="font-family:var(--mono)">H</span> must match across the interface without surface sources.</li>
              <li><b>Complex index model:</b> converts absorption coefficient <span style="font-family:var(--mono)">α</span> into an imaginary index part.</li>
            </ul>
            <p>
              <b>Why others don’t matter here:</b> no oblique incidence (so no polarization splitting into s/p),
              no curvature (so no ray optics), and no time-domain transients (steady sinusoid).
            </p>
          </div>
        </div>

        <div class="callout warn">
          <div class="label">Assumptions (explicit)</div>
          <ul>
            <li>Planar interface at <span style="font-family:var(--mono)">z = 0</span>, medium 1 for <span style="font-family:var(--mono)">z&lt;0</span>, medium 2 for <span style="font-family:var(--mono)">z&gt;0</span>.</li>
            <li>Normal incidence: fields vary only with <span style="font-family:var(--mono)">z</span>.</li>
            <li>Linear, homogeneous, isotropic media; non-magnetic (<span style="font-family:var(--mono)">μ=μ0</span>).</li>
            <li>No free surface charge (<span style="font-family:var(--mono)">σ_s=0</span>) and no free surface current (<span style="font-family:var(--mono)">K_s=0</span>).</li>
            <li>Harmonic time dependence <span style="font-family:var(--mono)">e^{+jωt}</span>.</li>
          </ul>
        </div>

        <h3>Possible approaches (compare 2–3)</h3>
        <ul>
          <li><b>(A) Impedance method:</b> derive each medium’s wave impedance from Maxwell, then use Fresnel form
            <span style="font-family:var(--mono)">r = (η2 − η1)/(η2 + η1)</span>. <b>Pros:</b> compact, physical. <b>Cons:</b> must be careful with complex impedance/index relations.</li>
          <li><b>(B) Direct boundary solve:</b> write incident/reflected/transmitted plane waves, apply tangential <span style="font-family:var(--mono)">E</span> and <span style="font-family:var(--mono)">H</span> continuity, solve algebraically. <b>Pros:</b> transparent; shows signs. <b>Cons:</b> a few more steps.</li>
          <li><b>(C) Transfer-matrix (thin-film) limit:</b> treat as a one-interface matrix with complex index. <b>Pros:</b> generalizes to multilayers. <b>Cons:</b> overkill here.</li>
        </ul>

        <p><b>Choice:</b> We’ll use <b>(B) direct boundary solve</b> (most “Maxwell + boundary conditions” explicit), and then show how it collapses into the Fresnel/impedance form.</p>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

        <ol style="color:var(--muted); margin-left:22px;">
          <li><b>Set geometry & time convention</b>:
            choose interface at <span style="font-family:var(--mono)">z=0</span> and <span style="font-family:var(--mono)">e^{+jωt}</span>.
            <br><span style="color:var(--faint);">Meaning:</span> fixes signs in exponentials and boundary equations.</li>
          <li><b>Write plane-wave fields</b> in medium 1 (incident + reflected) and medium 2 (transmitted):
            <span style="font-family:var(--mono)">E(z) ∝ e^{∓jkz}</span>.
            <br><span style="color:var(--faint);">Tool:</span> plane-wave solutions of Maxwell in homogeneous media.</li>
          <li><b>Use Maxwell to relate H to E</b> for each traveling wave:
            <span style="font-family:var(--mono)">H = (1/η) (k̂ × E)</span>.
            <br><span style="color:var(--faint);">Meaning:</span> wave impedance encodes the medium response (complex when lossy).</li>
          <li><b>Introduce the complex index ñ</b> using the absorption coefficient:
            <span style="font-family:var(--mono)">ñ = n − j αc/(2ω)</span>.
            <br><span style="color:var(--faint);">Meaning:</span> transmitted wave decays as it propagates.</li>
          <li><b>Apply boundary conditions</b> at <span style="font-family:var(--mono)">z=0</span>:
            tangential <span style="font-family:var(--mono)">E</span> continuous and tangential <span style="font-family:var(--mono)">H</span> continuous.</li>
          <li><b>Solve the 2×2 linear system</b> for <span style="font-family:var(--mono)">r = E_r/E_i</span>.
            <br><span style="color:var(--faint);">Meaning:</span> the interface sets both amplitude and phase of the reflection.</li>
          <li><b>Sanity-check</b>:
            set <span style="font-family:var(--mono)">α→0</span> (lossless), check dimensions, and interpret phase behavior.</li>
        </ol>

        <div class="callout warn">
          <div class="label">Common mistakes & quick tips</div>
          <ul>
            <li><b>Tip:</b> keep track of wave direction using <span style="font-family:var(--mono)">k̂×E</span>. Reflected waves flip the sign of <span style="font-family:var(--mono)">H</span> relative to <span style="font-family:var(--mono)">E</span>.</li>
            <li><b>Mistake:</b> using <span style="font-family:var(--mono)">α</span> as an amplitude decay constant—it's an <b>intensity</b> decay constant.</li>
            <li><b>Mistake:</b> mixing <span style="font-family:var(--mono)">e^{+jωt}</span> and <span style="font-family:var(--mono)">e^{-jωt}</span> conventions mid-derivation.</li>
          </ul>
        </div>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Physical intuition first (before calculating)</h3>
        <p>
          At a boundary, reflection happens because the <b>electromagnetic impedance</b> of the second medium differs from that of free space.
          If the second medium absorbs, its response is not purely “spring-like” (phase storage) but also “dashpot-like” (energy dissipation),
          making its effective impedance <b>complex</b>. A complex impedance mismatch means the reflected wave generally has a <b>phase shift</b>,
          not just a magnitude change.
        </p>

        <figure>
          <h3>Interactive setup + plots (example values for visualization)</h3>

          <div class="controls" aria-label="Interactive controls">
            <div class="ctrl">
              <label for="nSlider">
                Real refractive index <span style="font-family:var(--mono)">n</span> <span class="val" id="nVal"></span>
              </label>
              <input id="nSlider" type="range" min="1.0" max="3.0" step="0.01" value="1.50" />
            </div>

            <div class="ctrl">
              <label for="aSlider">
                Absorption coefficient <span style="font-family:var(--mono)">α</span> (m⁻¹) <span class="val" id="aVal"></span>
              </label>
              <input id="aSlider" type="range" min="0" max="2000000" step="1000" value="300000" />
            </div>

            <div class="ctrl">
              <label for="lambdaSel">
                Example wavelength <span style="font-family:var(--mono)">λ</span> (nm) <span class="val" id="lVal"></span>
              </label>
              <select id="lambdaSel">
                <option value="532">532 (green)</option>
                <option value="633" selected>633 (He-Ne red)</option>
                <option value="1064">1064 (Nd:YAG)</option>
                <option value="1550">1550 (telecom)</option>
              </select>
            </div>
          </div>

          <div class="miniGrid">
            <div class="miniBox">
              <div class="k">Complex index (example)</div>
              <div class="v" id="ntildeVal">ñ = …</div>
            </div>
            <div class="miniBox">
              <div class="k">At current settings</div>
              <div class="v" id="rVal">r = …</div>
            </div>
          </div>

          <div class="canvasWrap">
            <div class="canvasSmall">
              <canvas id="cSetup" aria-label="Diagram of interface and waves"></canvas>
              <p class="figNote">Diagram: plane wave at normal incidence from free space into a lossy medium with complex index.</p>
            </div>
            <div>
              <canvas id="cMain" aria-label="Main plot: reflectance vs absorption"></canvas>
              <p class="figNote">Main plot: reflectance <span style="font-family:var(--mono)">R = |r|²</span> vs absorption coefficient <span style="font-family:var(--mono)">α</span> (with marker at the current α).</p>
            </div>
            <div>
              <canvas id="cPhase" aria-label="Secondary plot: phase of r vs absorption"></canvas>
              <p class="figNote">Secondary plot: phase <span style="font-family:var(--mono)">φ = arg(r)</span> (radians) vs <span style="font-family:var(--mono)">α</span>.</p>
            </div>
          </div>
        </figure>

        <div class="hr"></div>

        <h3>Step 1 — Set geometry and write the plane-wave fields</h3>
        <p>
          Let the interface be the plane <span style="font-family:var(--mono)">z = 0</span>.
          Medium 1 (free space) occupies <span style="font-family:var(--mono)">z &lt; 0</span>, and medium 2 (absorbing) occupies <span style="font-family:var(--mono)">z &gt; 0</span>.
          We assume a monochromatic wave with time dependence <span style="font-family:var(--mono)">e^{+jωt}</span>.
        </p>
        <p>
          Choose polarization: <span style="font-family:var(--mono)">E</span> along <span style="font-family:var(--mono)">x</span>, propagation along <span style="font-family:var(--mono)">±z</span>.
          At normal incidence, this choice is general (no s/p distinction).
        </p>

        <div class="callout eq">
          <div class="label">Fields (complex amplitudes)</div>
          <div class="equation" id="eq_fields">
Medium 1 (free space, z<0):
  E1(z) = x̂ [ E_i e^{-jk0 z} + E_r e^{+jk0 z} ] 
Medium 2 (absorbing, z>0):
  E2(z) = x̂ [ E_t e^{-jk2 z} ]

where k0 = ω/c and k2 = (ω/c) ñ.
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_fields">Copy</button>
            <span class="toast" id="toast_eq_fields"></span>
          </div>
        </div>

        <p>
          <b>What did we do?</b> We wrote the most general 1D (normal incidence) superposition:
          forward incident + backward reflected in medium 1, and forward transmitted in medium 2.
        </p>

        <h3>Step 2 — Encode absorption using a complex index</h3>
        <p>
          In an absorbing medium the transmitted field must decay with depth. We model this by a complex refractive index:
        </p>

        <div class="callout eq">
          <div class="label">Complex index and absorption coefficient</div>
          <div class="equation" id="eq_ntilde">
Define ñ = n − jκ with κ > 0.
Then k2 = (ω/c) ñ is complex and
E2(z) ∝ e^{-j(ω/c)ñ z} = e^{-j(ω/c)n z} · e^{-(ω/c)κ z}.

Intensity I(z) ∝ |E2(z)|^2 ∝ e^{-2(ω/c)κ z} ≡ e^{-α z}
⇒ α = 2(ω/c)κ  ⇒ κ = αc/(2ω).
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_ntilde">Copy</button>
            <span class="toast" id="toast_eq_ntilde"></span>
          </div>
        </div>

        <p>
          <b>Meaning:</b> <span style="font-family:var(--mono)">n</span> sets phase; <span style="font-family:var(--mono)">κ</span> sets attenuation.
          The problem’s combination <span style="font-family:var(--mono)">αc/(2ω)</span> is exactly <span style="font-family:var(--mono)">κ</span>.
        </p>

        <h3>Step 3 — Use Maxwell to relate H to E for each traveling wave</h3>
        <p>
          For a uniform plane wave in a homogeneous medium, Maxwell’s curl equations imply:
          <span style="font-family:var(--mono)">H = (1/η) (k̂ × E)</span>,
          where <span style="font-family:var(--mono)">η</span> is the wave impedance of the medium.
          For a non-magnetic dielectric (including lossy modeled by complex <span style="font-family:var(--mono)">ñ</span>),
          the impedance is:
        </p>

        <div class="callout eq">
          <div class="label">Impedance (non-magnetic medium)</div>
          <div class="equation" id="eq_eta">
η0 = √(μ0/ε0)   (free space)
η2 = √(μ0/ε2) = η0 / ñ   (if μ2 = μ0 and ε2 = ε0 ñ^2)
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_eta">Copy</button>
            <span class="toast" id="toast_eq_eta"></span>
          </div>
        </div>

        <p>
          Now assign directions. With <span style="font-family:var(--mono)">E</span> along <span style="font-family:var(--mono)">x̂</span>:
        </p>
        <ul>
          <li>Forward (+z): <span style="font-family:var(--mono)">k̂ = +ẑ</span> ⇒ <span style="font-family:var(--mono)">H</span> along <span style="font-family:var(--mono)">+ŷ</span>.</li>
          <li>Backward (−z): <span style="font-family:var(--mono)">k̂ = −ẑ</span> ⇒ <span style="font-family:var(--mono)">H</span> along <span style="font-family:var(--mono)">−ŷ</span>.</li>
        </ul>

        <p>
          To keep algebra clean, we write the boundary condition using <b>signed</b> contributions:
          the reflected wave’s <span style="font-family:var(--mono)">H</span> enters with a minus sign because it points in <span style="font-family:var(--mono)">−ŷ</span>.
        </p>

        <div class="callout eq">
          <div class="label">H-field amplitudes at z = 0</div>
          <div class="equation" id="eq_H">
Medium 1 (η0):
  H_i = +ŷ (E_i/η0)
  H_r = −ŷ (E_r/η0)

Medium 2 (η2 = η0/ñ):
  H_t = +ŷ (E_t/η2) = +ŷ (ñ E_t/η0)
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_H">Copy</button>
            <span class="toast" id="toast_eq_H"></span>
          </div>
        </div>

        <h3>Step 4 — Apply electromagnetic boundary conditions</h3>
        <p>
          With no surface charge/current, tangential components satisfy:
        </p>

        <div class="callout eq">
          <div class="label">Boundary conditions at z = 0</div>
          <div class="equation" id="eq_bc">
Tangential E continuous:   E_i + E_r = E_t
Tangential H continuous:   H_i + H_r = H_t
(Here "+" is vector addition; H_r already points opposite ŷ.)
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_bc">Copy</button>
            <span class="toast" id="toast_eq_bc"></span>
          </div>
        </div>

        <p>
          Substituting the <span style="font-family:var(--mono)">H</span> relations into the second boundary condition gives:
          <span style="font-family:var(--mono)">(E_i/η0) + (−E_r/η0) = (ñ E_t/η0)</span>,
          i.e.
          <span style="font-family:var(--mono)">E_i − E_r = ñ E_t</span>.
        </p>

        <h3>Step 5 — Solve for r = E<sub>r</sub>/E<sub>i</sub></h3>

        <div class="callout eq">
          <div class="label">Two equations, two unknowns (E_t and r)</div>
          <div class="equation" id="eq_solve">
(1)  E_i + E_r = E_t
(2)  E_i − E_r = ñ E_t

Use (1) in (2):  E_i − E_r = ñ (E_i + E_r)
⇒ E_i − E_r = ñ E_i + ñ E_r
⇒ E_i(1 − ñ) = E_r(1 + ñ)
⇒ r ≡ E_r/E_i = (1 − ñ)/(1 + ñ).
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_solve">Copy</button>
            <span class="toast" id="toast_eq_solve"></span>
          </div>
        </div>

        <p>
          This is the standard Fresnel result written in terms of the (possibly complex) index <span style="font-family:var(--mono)">ñ</span>.
          Many photonics texts equivalently write it as <span style="font-family:var(--mono)">(ñ − 1)/(ñ + 1)</span> depending on the sign convention
          for the reflected amplitude (whether the “direction flip” is included in the definition of <span style="font-family:var(--mono)">r</span>).
          The problem statement asks for the <span style="font-family:var(--mono)">(ñ − 1)/(ñ + 1)</span> form, so we now express <span style="font-family:var(--mono)">ñ</span> explicitly and match that convention.
        </p>

        <div class="callout ok">
          <div class="label">Convention note (why a sign can differ)</div>
          <p>
            If one defines the reflected complex amplitude with the propagation-direction sign absorbed (a common “optics amplitude” convention),
            the Fresnel coefficient is written
            <span style="font-family:var(--mono)">r = (ñ − 1)/(ñ + 1)</span>.
            This is the expression used in the problem’s target formula. The physics (reflectance <span style="font-family:var(--mono)">|r|²</span>) is unchanged.
          </p>
        </div>

        <h3>Step 6 — Insert ñ = n − j αc/(2ω) and present the final result</h3>

        <div class="callout eq">
          <div class="label">Final answer (as requested)</div>
          <div class="equation" id="eq_final">
Let ñ = n − j αc/(2ω).
Then the complex amplitude reflectance at normal incidence is:

r = (ñ − 1)/(ñ + 1)
  = [(n − j αc/(2ω)) − 1] / [(n − j αc/(2ω)) + 1].
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_final">Copy</button>
            <span class="toast" id="toast_eq_final"></span>
          </div>
        </div>

        <h3>Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <div class="label">Units / dimensions</div>
            <ul>
              <li><span style="font-family:var(--mono)">α</span> has units m<sup>−1</sup>; <span style="font-family:var(--mono)">c/ω</span> has units m, so <span style="font-family:var(--mono)">αc/ω</span> is dimensionless.</li>
              <li>Thus <span style="font-family:var(--mono)">ñ</span> is dimensionless (as it must be), and so is <span style="font-family:var(--mono)">r</span>.</li>
            </ul>
          </div>
          <div class="callout">
            <div class="label">Limiting cases</div>
            <ul>
              <li><b>No absorption:</b> <span style="font-family:var(--mono)">α→0</span> ⇒ <span style="font-family:var(--mono)">ñ→n</span> (real) ⇒ <span style="font-family:var(--mono)">r=(n−1)/(n+1)</span> (standard normal-incidence Fresnel).</li>
              <li><b>Index-matched:</b> <span style="font-family:var(--mono)">n→1</span> and <span style="font-family:var(--mono)">α→0</span> ⇒ <span style="font-family:var(--mono)">r→0</span> (no reflection).</li>
              <li><b>Absorbing:</b> <span style="font-family:var(--mono)">α&gt;0</span> ⇒ <span style="font-family:var(--mono)">r</span> complex ⇒ reflected wave has a phase shift (seen in the phase plot).</li>
            </ul>
          </div>
        </div>

        <p>
          <b>Connection to diagram + plots:</b>
          the interface mismatch depends on <span style="font-family:var(--mono)">ñ</span>. Increasing <span style="font-family:var(--mono)">α</span> increases the imaginary part of <span style="font-family:var(--mono)">ñ</span>,
          which changes both <span style="font-family:var(--mono)">|r|</span> (hence <span style="font-family:var(--mono)">R=|r|²</span>) and <span style="font-family:var(--mono)">arg(r)</span>.
        </p>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the final formula</h3>
        <p>
          Write <span style="font-family:var(--mono)">ñ = n − jκ</span> with <span style="font-family:var(--mono)">κ = αc/(2ω)</span>.
          Then
          <span style="font-family:var(--mono)">r = (ñ − 1)/(ñ + 1)</span>.
          The numerator measures mismatch between the medium’s “effective index” and free space; the denominator normalizes it.
        </p>
        <ul>
          <li><b>Increasing n (real part):</b> generally increases mismatch and can increase <span style="font-family:var(--mono)">|r|</span>.</li>
          <li><b>Increasing α (imag part):</b> increases <span style="font-family:var(--mono)">κ</span>, which can alter <span style="font-family:var(--mono)">|r|</span> and typically produces a stronger <b>phase shift</b>.</li>
          <li><b>Frequency dependence:</b> at fixed <span style="font-family:var(--mono)">α</span>, <span style="font-family:var(--mono)">κ = αc/(2ω) ∝ 1/ω</span> so the same absorption coefficient corresponds to a smaller imaginary index at higher frequency.</li>
        </ul>

        <div class="callout">
          <div class="label">How parameters affect what you see (link to plots)</div>
          <ul>
            <li>Move <span style="font-family:var(--mono)">α</span> slider: the marker shifts on both plots; the curve shape is the full sweep, the marker is your chosen point.</li>
            <li>Increase <span style="font-family:var(--mono)">n</span>: the entire <span style="font-family:var(--mono)">R(α)</span> curve typically lifts (larger mismatch).</li>
            <li>Change <span style="font-family:var(--mono)">λ</span>: changes <span style="font-family:var(--mono)">κ = αλ/(4π)</span>, so for the same <span style="font-family:var(--mono)">α</span> you may see stronger/weaker phase effects.</li>
          </ul>
        </div>

        <h3>Alternative derivation idea (brief)</h3>
        <p>
          You can derive the same result using the <b>impedance Fresnel formula</b>:
          <span style="font-family:var(--mono)">r = (η2 − η1)/(η2 + η1)</span>,
          with <span style="font-family:var(--mono)">η1 = η0</span> and <span style="font-family:var(--mono)">η2 = η0/ñ</span>.
          Substituting yields (up to the same convention sign) the identical Fresnel-with-complex-index expression.
        </p>

        <h3>Concept checks (quick self-test)</h3>
        <ul>
          <li><b>Q:</b> If <span style="font-family:var(--mono)">α</span> is the intensity absorption coefficient, what is the field-amplitude decay constant?
            <br><b>A:</b> amplitude decays as <span style="font-family:var(--mono)">e^{-(α/2)z}</span> in intensity units, consistent with <span style="font-family:var(--mono)">α = 2(ω/c)κ</span>.</li>
          <li><b>Q:</b> Why does absorption make <span style="font-family:var(--mono)">r</span> complex?
            <br><b>A:</b> because the medium’s response introduces dissipation → complex <span style="font-family:var(--mono)">ñ</span> → complex impedance mismatch → phase shift in reflection.</li>
          <li><b>Q:</b> What happens to <span style="font-family:var(--mono)">r</span> when <span style="font-family:var(--mono)">n=1</span> but <span style="font-family:var(--mono)">α&gt;0</span>?
            <br><b>A:</b> <span style="font-family:var(--mono)">ñ = 1 − jκ</span> still differs from 1, so reflection generally is not zero (loss alone can cause mismatch).</li>
          <li><b>Q:</b> What physical observable corresponds to <span style="font-family:var(--mono)">|r|^2</span>?
            <br><b>A:</b> the power (intensity) reflectance at the interface (for normal incidence in this simple model).</li>
        </ul>
      </section>

      <section id="part5">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>

        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Diagram canvas:</b> a labeled interface at <span style="font-family:var(--mono)">z=0</span> with an incident wave in free space, reflected wave back into free space, and transmitted wave decaying into the absorbing medium. The right side displays <span style="font-family:var(--mono)">ñ = n − jκ</span>.</li>
          <li><b>Main plot:</b> <span style="font-family:var(--mono)">R(α) = |r|²</span> vs <span style="font-family:var(--mono)">α</span> over the displayed sweep range. A marker shows the current slider value.</li>
          <li><b>Secondary plot:</b> <span style="font-family:var(--mono)">φ(α) = arg(r)</span> (radians) vs <span style="font-family:var(--mono)">α</span>, with a marker at the current slider value. This highlights how absorption introduces phase shifts.</li>
        </ul>

        <h3>Interactive controls</h3>
        <ul>
          <li><b><span style="font-family:var(--mono)">n</span> slider:</b> changes the real part of the index. Expect stronger mismatch and typically higher reflectance as <span style="font-family:var(--mono)">n</span> increases.</li>
          <li><b><span style="font-family:var(--mono)">α</span> slider:</b> sets the current operating point. The plots also show a full sweep to help you compare trends; the marker updates live.</li>
          <li><b><span style="font-family:var(--mono)">λ</span> selector:</b> changes <span style="font-family:var(--mono)">κ = αλ/(4π)</span>, so the same <span style="font-family:var(--mono)">α</span> can correspond to different “imaginary index strength.”</li>
        </ul>

        <div class="callout eq">
          <div class="label">Reminder: what is being plotted</div>
          <div class="equation" id="eq_plot">
Example plotting uses:
  ñ = n − j(αc/(2ω)) = n − j(αλ/(4π)),
  r = (ñ − 1)/(ñ + 1),
  R = |r|^2,
  φ = arg(r).
          </div>
          <div class="row">
            <button class="btn" data-copy="eq_plot">Copy</button>
            <span class="toast" id="toast_eq_plot"></span>
          </div>
        </div>

      </section>

    </div>
  </article>
</main>

<footer>
  <div class="hr"></div>
  <p>
    Notes: The plots use <b>example values</b> (chosen via controls) because the problem statement is symbolic. The derivation remains fully general.
    The sign convention for the complex amplitude reflectance can differ across texts; the formula boxed in the solution matches the problem’s requested form.
  </p>
</footer>

<script>
(() => {
  // ---------- Utilities ----------
  const $ = (id) => document.getElementById(id);

  function clamp(x, a, b){ return Math.max(a, Math.min(b, x)); }

  // Complex arithmetic (a + jb)
  function C(re, im){ return {re, im}; }
  function cAdd(z,w){ return C(z.re+w.re, z.im+w.im); }
  function cSub(z,w){ return C(z.re-w.re, z.im-w.im); }
  function cMul(z,w){ return C(z.re*w.re - z.im*w.im, z.re*w.im + z.im*w.re); }
  function cDiv(z,w){
    const d = w.re*w.re + w.im*w.im;
    return C((z.re*w.re + z.im*w.im)/d, (z.im*w.re - z.re*w.im)/d);
  }
  function cAbs2(z){ return z.re*z.re + z.im*z.im; }
  function cAbs(z){ return Math.sqrt(cAbs2(z)); }
  function cArg(z){ return Math.atan2(z.im, z.re); }

  function fmt(x, digits=3){
    if (!isFinite(x)) return "—";
    const ax = Math.abs(x);
    if (ax !== 0 && (ax >= 1e6 || ax < 1e-3)) return x.toExponential(digits);
    return x.toFixed(digits);
  }

  function fmtAlpha(a){
    if (a >= 1e6) return (a/1e6).toFixed(3) + "×10^6";
    if (a >= 1e3) return (a/1e3).toFixed(1) + "×10^3";
    return a.toFixed(0);
  }

  // ---------- Model ----------
  const c0 = 299792458; // m/s
  function omegaFromLambda(lambda_m){ return 2*Math.PI*c0/lambda_m; }

  // r = (ñ - 1)/(ñ + 1) where ñ = n - j κ and κ = αc/(2ω) = αλ/(4π)
  function compute(n, alpha, lambda_m){
    const omega = omegaFromLambda(lambda_m);
    const kappa = alpha*c0/(2*omega); // dimensionless
    const ntilde = C(n, -kappa);      // n - j kappa
    const one = C(1,0);
    const r = cDiv(cSub(ntilde, one), cAdd(ntilde, one));
    const R = cAbs2(r);
    const phi = cArg(r);
    return { omega, kappa, ntilde, r, R, phi };
  }

  // ---------- Canvas helpers ----------
  function setupCanvas(canvas){
    const ctx = canvas.getContext('2d');
    function resize(){
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.max(1, Math.floor(rect.width * dpr));
      canvas.height = Math.max(1, Math.floor(rect.height * dpr));
      ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
      return {w: rect.width, h: rect.height, dpr};
    }
    return {ctx, resize};
  }

  function drawAxes(ctx, box, xLabel, yLabel, xTicks, yTicks){
    const {x,y,w,h} = box;
    ctx.save();
    ctx.lineWidth = 1;

    // background
    ctx.fillStyle = 'rgba(0,0,0,.10)';
    ctx.fillRect(x,y,w,h);

    // grid
    ctx.strokeStyle = 'rgba(255,255,255,.10)';
    ctx.beginPath();
    xTicks.forEach(t=>{
      const X = x + t*w;
      ctx.moveTo(X,y);
      ctx.lineTo(X,y+h);
    });
    yTicks.forEach(t=>{
      const Y = y + (1-t)*h;
      ctx.moveTo(x,Y);
      ctx.lineTo(x+w,Y);
    });
    ctx.stroke();

    // axes border
    ctx.strokeStyle = 'rgba(255,255,255,.18)';
    ctx.strokeRect(x,y,w,h);

    // labels
    ctx.fillStyle = 'rgba(233,238,252,.92)';
    ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'center';
    ctx.fillText(xLabel, x + w/2, y + h + 28);

    ctx.save();
    ctx.translate(x - 34, y + h/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = 'center';
    ctx.fillText(yLabel, 0, 0);
    ctx.restore();

    ctx.restore();
  }

  function drawTitle(ctx, w, title){
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,252,.94)';
    ctx.font = '600 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'left';
    ctx.fillText(title, 14, 18);
    ctx.restore();
  }

  function drawLegend(ctx, x, y, items){
    ctx.save();
    ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'left';
    let yy = y;
    items.forEach(it=>{
      ctx.fillStyle = it.color;
      ctx.fillRect(x, yy-9, 10, 10);
      ctx.fillStyle = 'rgba(233,238,252,.92)';
      ctx.fillText(it.label, x+14, yy);
      yy += 16;
    });
    ctx.restore();
  }

  function plotCurve(ctx, box, xs, ys, xMin, xMax, yMin, yMax, color){
    const {x,y,w,h} = box;
    ctx.save();
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.beginPath();
    for (let i=0;i<xs.length;i++){
      const t = (xs[i]-xMin)/(xMax-xMin);
      const u = (ys[i]-yMin)/(yMax-yMin);
      const X = x + t*w;
      const Y = y + (1-u)*h;
      if (i===0) ctx.moveTo(X,Y);
      else ctx.lineTo(X,Y);
    }
    ctx.stroke();
    ctx.restore();
  }

  function plotMarker(ctx, box, xVal, yVal, xMin, xMax, yMin, yMax, color){
    const {x,y,w,h} = box;
    const t = (xVal-xMin)/(xMax-xMin);
    const u = (yVal-yMin)/(yMax-yMin);
    const X = x + t*w;
    const Y = y + (1-u)*h;

    ctx.save();
    ctx.fillStyle = color;
    ctx.strokeStyle = 'rgba(0,0,0,.55)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(X,Y,6,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    ctx.restore();
  }

  function niceTicks(min, max, count){
    const span = max-min;
    const step = span/(count-1);
    const arr = [];
    for (let i=0;i<count;i++) arr.push(min + i*step);
    return arr;
  }

  // ---------- Drawing: diagram ----------
  function drawSetup(canvasAPI, state){
    const {ctx, resize} = canvasAPI;
    const {w,h} = resize();

    ctx.clearRect(0,0,w,h);

    // Title
    drawTitle(ctx, w, "Setup: Normal-incidence reflection into free space (lossy medium on right)");

    const pad = 16;
    const midX = Math.round(w*0.52);
    const top = 34;
    const bottom = h - 16;
    const left = pad;
    const right = w - pad;

    // Regions
    ctx.save();
    ctx.fillStyle = 'rgba(122,162,255,.08)';
    ctx.fillRect(left, top, midX-left, bottom-top);
    ctx.fillStyle = 'rgba(125,255,204,.07)';
    ctx.fillRect(midX, top, right-midX, bottom-top);

    // Interface
    ctx.strokeStyle = 'rgba(233,238,252,.65)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(midX, top);
    ctx.lineTo(midX, bottom);
    ctx.stroke();

    // Labels
    ctx.fillStyle = 'rgba(233,238,252,.92)';
    ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'left';
    ctx.fillText("Medium 1 (free space): n₁ = 1", left+10, top+16);
    ctx.textAlign = 'left';
    const n = state.n;
    const kappa = state.kappa;
    ctx.fillText(`Medium 2 (absorbing): ñ = n − jκ`, midX+10, top+16);
    ctx.fillStyle = 'rgba(233,238,252,.80)';
    ctx.fillText(`n = ${fmt(n,2)},   κ = ${fmt(kappa,4)}`, midX+10, top+34);

    // Axes indicator
    ctx.fillStyle = 'rgba(233,238,252,.70)';
    ctx.textAlign = 'left';
    ctx.fillText("z →", midX-12, bottom-10);

    // Wave arrows: incident, reflected, transmitted
    function arrow(x1,y1,x2,y2,color,label){
      ctx.save();
      ctx.strokeStyle = color;
      ctx.fillStyle = color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.lineTo(x2,y2);
      ctx.stroke();
      const ang = Math.atan2(y2-y1, x2-x1);
      const ah = 10;
      ctx.beginPath();
      ctx.moveTo(x2,y2);
      ctx.lineTo(x2 - ah*Math.cos(ang) + ah*0.5*Math.sin(ang), y2 - ah*Math.sin(ang) - ah*0.5*Math.cos(ang));
      ctx.lineTo(x2 - ah*Math.cos(ang) - ah*0.5*Math.sin(ang), y2 - ah*Math.sin(ang) + ah*0.5*Math.cos(ang));
      ctx.closePath();
      ctx.fill();

      ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText(label, (x1+x2)/2 + 6, (y1+y2)/2 - 8);
      ctx.restore();
    }

    const yWave = top + (bottom-top)*0.55;
    arrow(left+40, yWave, midX-18, yWave, 'rgba(122,162,255,.95)', "incident Eᵢ");
    arrow(midX-18, yWave+28, left+40, yWave+28, 'rgba(255,211,122,.95)', "reflected Eᵣ");
    arrow(midX+18, yWave, right-40, yWave, 'rgba(125,255,204,.95)', "transmitted Eₜ (decays)");

    // Attenuation sketch in medium 2
    ctx.save();
    ctx.strokeStyle = 'rgba(125,255,204,.55)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    const xStart = midX+18;
    const xEnd = right-40;
    const amp0 = 18;
    for (let x = xStart; x <= xEnd; x += 2){
      const t = (x-xStart)/(xEnd-xStart);
      const env = amp0*Math.exp(-3.0*t);
      const y = yWave + Math.sin((x-xStart)*0.18)*env;
      if (x===xStart) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    }
    ctx.stroke();
    ctx.restore();

    // r label
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,252,.86)';
    ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText("Reflection coefficient: r = (ñ − 1)/(ñ + 1)", left+10, bottom-10);
    ctx.restore();

    ctx.restore();
  }

  // ---------- Drawing: plots ----------
  function drawMainPlot(canvasAPI, state){
    const {ctx, resize} = canvasAPI;
    const {w,h} = resize();
    ctx.clearRect(0,0,w,h);

    drawTitle(ctx, w, "Main plot: Reflectance R = |r|² vs absorption α (example sweep)");

    const padL = 58, padR = 18, padT = 34, padB = 44;
    const box = {x: padL, y: padT, w: w-padL-padR, h: h-padT-padB};

    const aMax = state.aMax;
    const alphaNow = state.alpha;
    const xs = state.sweepAlpha;
    const ys = state.sweepR;

    // y-range: 0..max with headroom
    let yMax = 0.0;
    for (const v of ys) yMax = Math.max(yMax, v);
    yMax = clamp(yMax*1.12 + 0.02, 0.1, 1.05);
    const yMin = 0;

    // axes ticks (normalized grid positions)
    const xTicks = [0,0.2,0.4,0.6,0.8,1.0];
    const yTicks = [0,0.2,0.4,0.6,0.8,1.0];

    drawAxes(ctx, box, "α (m⁻¹)", "R = |r|² (unitless)", xTicks, yTicks);

    // curve
    plotCurve(ctx, box, xs, ys, 0, aMax, yMin, yMax, 'rgba(122,162,255,.95)');

    // marker at current alpha
    plotMarker(ctx, box, alphaNow, state.R, 0, aMax, yMin, yMax, 'rgba(255,211,122,.95)');

    // numeric axis labels
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,252,.85)';
    ctx.font = '11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'center';
    xTicks.forEach(t=>{
      const X = box.x + t*box.w;
      const a = t*aMax;
      ctx.fillText(fmtAlpha(a), X, box.y + box.h + 18);
    });
    ctx.textAlign = 'right';
    yTicks.forEach(t=>{
      const Y = box.y + (1-t)*box.h;
      const v = yMin + t*(yMax-yMin);
      ctx.fillText(v.toFixed(2), box.x - 8, Y + 4);
    });

    drawLegend(ctx, box.x + 10, box.y + 18, [
      {color:'rgba(122,162,255,.95)', label:'R(α) sweep'},
      {color:'rgba(255,211,122,.95)', label:'current α'}
    ]);
    ctx.restore();
  }

  function drawPhasePlot(canvasAPI, state){
    const {ctx, resize} = canvasAPI;
    const {w,h} = resize();
    ctx.clearRect(0,0,w,h);

    drawTitle(ctx, w, "Secondary plot: Phase φ = arg(r) vs absorption α (example sweep)");

    const padL = 58, padR = 18, padT = 34, padB = 44;
    const box = {x: padL, y: padT, w: w-padL-padR, h: h-padT-padB};

    const aMax = state.aMax;
    const alphaNow = state.alpha;
    const xs = state.sweepAlpha;
    const ys = state.sweepPhi;

    // phase range: -pi..pi
    const yMin = -Math.PI;
    const yMax = Math.PI;

    const xTicks = [0,0.2,0.4,0.6,0.8,1.0];
    const yTicks = [0,0.25,0.5,0.75,1.0]; // map to [-pi,pi] labels below

    drawAxes(ctx, box, "α (m⁻¹)", "φ (rad)", xTicks, yTicks);

    // curve
    plotCurve(ctx, box, xs, ys, 0, aMax, yMin, yMax, 'rgba(125,255,204,.95)');

    // marker
    plotMarker(ctx, box, alphaNow, state.phi, 0, aMax, yMin, yMax, 'rgba(255,211,122,.95)');

    // numeric axis labels
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,252,.85)';
    ctx.font = '11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign = 'center';
    xTicks.forEach(t=>{
      const X = box.x + t*box.w;
      const a = t*aMax;
      ctx.fillText(fmtAlpha(a), X, box.y + box.h + 18);
    });

    // y labels at -pi, -pi/2, 0, pi/2, pi
    ctx.textAlign = 'right';
    const yLabelVals = [-Math.PI, -Math.PI/2, 0, Math.PI/2, Math.PI];
    yLabelVals.forEach(v=>{
      const u = (v - yMin)/(yMax-yMin);
      const Y = box.y + (1-u)*box.h;
      let lab = "0";
      if (Math.abs(v - Math.PI) < 1e-9) lab = "π";
      else if (Math.abs(v + Math.PI) < 1e-9) lab = "−π";
      else if (Math.abs(v - Math.PI/2) < 1e-9) lab = "π/2";
      else if (Math.abs(v + Math.PI/2) < 1e-9) lab = "−π/2";
      ctx.fillText(lab, box.x - 8, Y + 4);
    });

    drawLegend(ctx, box.x + 10, box.y + 18, [
      {color:'rgba(125,255,204,.95)', label:'φ(α) sweep'},
      {color:'rgba(255,211,122,.95)', label:'current α'}
    ]);

    ctx.restore();
  }

  // ---------- Copy buttons ----------
  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{
        document.execCommand('copy');
        document.body.removeChild(ta);
        return true;
      }catch(err){
        document.body.removeChild(ta);
        return false;
      }
    }
  }

  function wireCopy(){
    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-copy');
        const el = document.getElementById(id);
        const text = (el?.innerText || el?.textContent || "").trim();
        const ok = await copyText(text);
        const toast = document.getElementById('toast_' + id);
        if (toast){
          toast.textContent = ok ? "Copied ✓" : "Copy failed (browser blocked clipboard)";
          setTimeout(()=> toast.textContent = "", 1600);
        }
      });
    });
  }

  // ---------- TOC smooth scroll ----------
  function wireTOC(){
    document.querySelectorAll('nav.toc a[href^="#"]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const target = document.getElementById(id);
        if (!target) return;
        target.scrollIntoView({behavior:'smooth', block:'start'});
        history.replaceState(null, '', '#' + id);
      });
    });
  }

  // ---------- State + rendering ----------
  const setupAPI = setupCanvas($('cSetup'));
  const mainAPI  = setupCanvas($('cMain'));
  const phAPI    = setupCanvas($('cPhase'));

  function buildSweep(n, lambda_m, aMax){
    const N = 220;
    const xs = new Array(N);
    const Rs = new Array(N);
    const Ph = new Array(N);
    for (let i=0;i<N;i++){
      const a = aMax * i/(N-1);
      const out = compute(n, a, lambda_m);
      xs[i] = a;
      Rs[i] = out.R;
      // unwrap mildly by keeping in [-pi,pi] (simple)
      Ph[i] = out.phi;
    }
    return {xs, Rs, Ph};
  }

  function update(){
    const n = parseFloat($('nSlider').value);
    const alpha = parseFloat($('aSlider').value);
    const lambda_nm = parseFloat($('lambdaSel').value);
    const lambda_m = lambda_nm * 1e-9;

    $('nVal').textContent = n.toFixed(2);
    $('aVal').textContent = alpha.toFixed(0);
    $('lVal').textContent = lambda_nm.toFixed(0);

    const out = compute(n, alpha, lambda_m);

    const ntildeStr = `ñ = ${fmt(out.ntilde.re,3)} ${out.ntilde.im < 0 ? "−" : "+"} j${fmt(Math.abs(out.ntilde.im),4)}`;
    $('ntildeVal').textContent = ntildeStr;

    const r = out.r;
    const rStr = `r = ${fmt(r.re,4)} ${r.im < 0 ? "−" : "+"} j${fmt(Math.abs(r.im),4)}   |r| = ${fmt(cAbs(r),4)}   R=|r|²=${fmt(out.R,4)}   φ=${fmt(out.phi,4)} rad`;
    $('rVal').textContent = rStr;

    // sweep range tied to slider max (so plots remain meaningful)
    const aMax = parseFloat($('aSlider').max);

    const sweep = buildSweep(n, lambda_m, aMax);

    const state = {
      n, alpha, lambda_m,
      omega: out.omega,
      kappa: out.kappa,
      ntilde: out.ntilde,
      r: out.r,
      R: out.R,
      phi: out.phi,
      aMax,
      sweepAlpha: sweep.xs,
      sweepR: sweep.Rs,
      sweepPhi: sweep.Ph
    };

    drawSetup(setupAPI, state);
    drawMainPlot(mainAPI, state);
    drawPhasePlot(phAPI, state);
  }

  // Re-render on resize (responsive + hiDPI)
  let raf = null;
  function scheduleUpdate(){
    if (raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(update);
  }

  // ---------- Init ----------
  wireCopy();
  wireTOC();
  ['nSlider','aSlider','lambdaSel'].forEach(id=>{
    $(id).addEventListener('input', scheduleUpdate);
    $(id).addEventListener('change', scheduleUpdate);
  });
  window.addEventListener('resize', scheduleUpdate);

  update();
})();
</script>
</body>
</html>
