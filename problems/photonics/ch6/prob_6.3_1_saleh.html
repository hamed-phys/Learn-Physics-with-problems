<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>6.3-1 Maximum Retardation in Quartz (Uniaxial Birefringence)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --card2:#0f1730;
      --text:#eaf0ff;
      --muted:#b9c3e6;
      --soft:#93a0d6;
      --line:rgba(255,255,255,.10);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 16px 40px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: radial-gradient(1200px 700px at 20% -10%, rgba(125,211,252,.18), transparent 60%),
                  radial-gradient(1000px 700px at 95% 0%, rgba(167,139,250,.16), transparent 55%),
                  radial-gradient(900px 700px at 60% 110%, rgba(52,211,153,.10), transparent 55%),
                  var(--bg);
      line-height:1.55;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:28px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    .title-wrap{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size: clamp(1.3rem, 1.2rem + 1.4vw, 2.2rem);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:8px 0 0;
      color:var(--muted);
      max-width:82ch;
    }
    main{
      max-width:1200px;
      margin:0 auto;
      padding:14px 18px 64px;
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }
    @media (min-width: 980px){
      main{ grid-template-columns: 1fr 320px; align-items:start; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .content{
      padding:18px 18px 10px;
    }
    section{ padding:18px; border-top:1px solid var(--line); }
    section:first-child{ border-top:0; }
    h2{
      margin:0 0 10px;
      font-size:1.25rem;
      letter-spacing:.2px;
    }
    h3{
      margin:16px 0 8px;
      font-size:1.05rem;
      color:var(--text);
    }
    p{margin:10px 0; color:var(--text)}
    ul{margin:10px 0 10px 22px; color:var(--text)}
    li{margin:6px 0}
    .muted{color:var(--muted)}
    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 780px){
      .grid2{grid-template-columns: 1fr 1fr;}
    }
    .callouts{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin:12px 0;
    }
    @media (min-width: 720px){
      .callouts{grid-template-columns: 1fr 1fr;}
    }
    .callout{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(0,0,0,.16);
      padding:12px 12px 10px;
    }
    .callout .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-weight:650;
      letter-spacing:.2px;
      font-size:.85rem;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      margin-bottom:8px;
    }
    .tag.good{color:var(--good)}
    .tag.warn{color:var(--warn)}
    .tag.bad{color:var(--bad)}
    .eqbox{
      border:1px dashed rgba(125,211,252,.35);
      background: rgba(125,211,252,.08);
      border-radius:16px;
      padding:12px;
      margin:10px 0;
      position:relative;
      overflow:hidden;
    }
    .eq{
      font-family:var(--mono);
      font-size:.95rem;
      white-space:pre-wrap;
      word-break:break-word;
      margin:0;
      color: #eaf7ff;
    }
    .copy-row{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-top:8px;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.15px;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }
    button:active{ transform: translateY(1px); }
    .mini{
      font-size:.86rem;
      padding:7px 10px;
      border-radius:10px;
      color:var(--muted);
      background: rgba(0,0,0,.12);
      border:1px solid var(--line);
    }
    .toc{
      position: sticky;
      top:12px;
      padding:14px;
    }
    .toc h2{
      font-size:1.05rem;
      margin:0 0 10px;
    }
    .toc a{
      display:block;
      padding:9px 10px;
      border-radius:12px;
      border:1px solid transparent;
      color:var(--muted);
      transition: background .15s ease, border-color .15s ease, color .15s ease;
    }
    .toc a:hover{
      background: rgba(255,255,255,.06);
      border-color: var(--line);
      color:var(--text);
      text-decoration:none;
    }
    .toc .hint{
      margin-top:10px;
      color:var(--soft);
      font-size:.9rem;
    }
    .vizwrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .canvas-card{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .canvas-head{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.04);
    }
    .canvas-head .t{
      font-weight:750;
      letter-spacing:.2px;
      font-size:.95rem;
    }
    .canvas-head .s{
      color:var(--muted);
      font-size:.85rem;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
    }
    @media (min-width: 900px){
      canvas{height:340px;}
    }
    .controls{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .control{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background: rgba(0,0,0,.14);
    }
    .control label{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      font-weight:700;
    }
    .control label span{
      color:var(--muted);
      font-weight:650;
      font-size:.92rem;
    }
    input[type="range"]{
      width:100%;
      margin-top:10px;
      accent-color: var(--accent);
    }
    select{
      width:100%;
      margin-top:10px;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight:650;
      outline:none;
    }
    .kpi{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (min-width: 720px){
      .kpi{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .kpi .box{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background: rgba(0,0,0,.12);
    }
    .kpi .box .lbl{color:var(--muted); font-size:.86rem; margin-bottom:6px;}
    .kpi .box .val{font-weight:800; font-size:1.05rem;}
    .kpi .box .sub{color:var(--soft); font-size:.86rem; margin-top:4px;}
    footer{
      max-width:1200px;
      margin:0 auto;
      padding:0 18px 38px;
      color:var(--muted);
    }
    .print-note{display:none}
    @media print{
      :root{ --bg:#fff; --text:#111; --muted:#333; --line:#ddd; }
      body{ background:#fff; color:#111; }
      .toc{ display:none; }
      .card{ box-shadow:none; }
      button{ display:none; }
      .print-note{ display:block; color:#444; margin-top:8px; }
      canvas{ height:260px; }
      a{ color:#000; text-decoration:underline; }
    }
    /* subtle motion */
    @media (prefers-reduced-motion: no-preference){
      .card{ animation: floatIn .35s ease both; }
      @keyframes floatIn{
        from{ opacity:0; transform: translateY(10px); }
        to{ opacity:1; transform: translateY(0); }
      }
    }
  </style>
</head>

<body>
<header>
  <div class="title-wrap">
    <div>
      <h1>6.3-1 — Maximum Retardation in Quartz (Positive Uniaxial Crystal)</h1>
      <p class="subtitle">
        We compute the <b>maximum birefringent phase retardation</b> a quartz plate can produce at
        <b>&lambda;<sub>0</sub> = 633 nm</b>, and then find the <b>thicknesses</b> that make it a <b>quarter-wave plate</b>.
      </p>
      <p class="subtitle print-note">Print tip: the interactive plots are static in print; key formulas and final answers are still shown.</p>
    </div>
    <div class="mini" aria-label="Given values">
      <div><b>Given:</b> quartz (positive uniaxial)</div>
      <div>n<sub>e</sub> = 1.553, &nbsp; n<sub>o</sub> = 1.544</div>
      <div>&lambda;<sub>0</sub> = 633 nm</div>
    </div>
  </div>
</header>

<main>
  <!-- MAIN ARTICLE -->
  <article class="card">
    <div class="content">
      <section id="quick-summary">
        <h2>Quick Summary</h2>
        <ul>
          <li>This problem is about <b>birefringence</b>: a uniaxial crystal splits light into <b>ordinary (o)</b> and <b>extraordinary (e)</b> waves that accumulate different phases.</li>
          <li>Key idea: <b>phase retardation</b> comes from optical path difference: &Delta; = (n<sub>e,eff</sub> &minus; n<sub>o</sub>) d.</li>
          <li>Governing equation (phase): <span class="muted">(&delta; in radians)</span> &nbsp; <b>&delta; = (2&pi;/&lambda;<sub>0</sub>) (n<sub>e,eff</sub> &minus; n<sub>o</sub>) d</b>.</li>
          <li>Maximum retardation occurs when propagation is <b>perpendicular to the optic axis</b> so n<sub>e,eff</sub> = n<sub>e</sub>.</li>
          <li>For quartz here, &Delta;n<sub>max</sub> = n<sub>e</sub> &minus; n<sub>o</sub> = <b>0.009</b>.</li>
          <li><b>(a)</b> Retardation per 1 mm at maximum: <b>14.22 waves/mm</b> (equivalently <b>89.34 rad/mm</b>).</li>
          <li><b>(b)</b> Quarter-wave thicknesses satisfy &delta; = &pi;/2 + 2&pi;m: &nbsp; <b>d = (m + 1/4)&lambda;<sub>0</sub>/&Delta;n<sub>max</sub></b>. Numerically: <b>d = (m+0.25) &times; 70.33 &micro;m</b>.</li>
        </ul>
      </section>

      <section id="part0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <h3>Core definitions (symbols &amp; units)</h3>
        <ul>
          <li><b>Refractive indices</b> (dimensionless): n<sub>o</sub> (ordinary), n<sub>e</sub> (extraordinary, along the optic axis direction in index space).</li>
          <li><b>Thickness</b>: d (meters, often mm or &micro;m in optics).</li>
          <li><b>Vacuum wavelength</b>: &lambda;<sub>0</sub> (meters).</li>
          <li><b>Optical path length</b>: OPL = n d (meters).</li>
          <li><b>Optical path difference</b>: &Delta; = (n<sub>e,eff</sub> &minus; n<sub>o</sub>) d (meters).</li>
          <li><b>Phase retardation</b>: &delta; = (2&pi;/&lambda;<sub>0</sub>) &Delta; (radians); equivalently retardation in <b>waves</b>: N = &Delta;/&lambda;<sub>0</sub>.</li>
        </ul>

        <h3>Physical meaning (what these quantities represent)</h3>
        <p>
          In a birefringent crystal, the material responds differently to electric-field components along different
          directions. A linearly polarized input generally decomposes into two eigenpolarizations (o and e) that
          <b>travel with different phase velocities</b>. After thickness d, one component “lags” behind the other by a phase
          &delta;, turning linear polarization into elliptical polarization (or back) depending on &delta;.
        </p>

        <h3>Key principles and validity conditions</h3>
        <div class="callouts">
          <div class="callout">
            <div class="tag good">Principle</div>
            <p><b>Superposition + eigenmodes:</b> In a lossless, linear, homogeneous anisotropic crystal, the o- and e-waves propagate independently as eigenmodes. The relative phase shift is what matters for retarders.</p>
          </div>
          <div class="callout">
            <div class="tag warn">Validity</div>
            <p>Assume <b>monochromatic</b> light at &lambda;<sub>0</sub>, negligible absorption, and a plate with <b>uniform thickness</b> and well-defined optic axis. Dispersion is ignored except via the given n-values at 633 nm.</p>
          </div>
        </div>

        <h3>Common models/approximations (and why we use them)</h3>
        <ul>
          <li><b>Ordinary index is constant:</b> n<sub>o</sub> does not depend on propagation direction.</li>
          <li><b>Extraordinary effective index depends on angle</b> &theta; between the propagation direction <b>k</b> and the optic axis:
            <div class="eqbox">
              <pre class="eq" id="eq-neff">Extraordinary effective index (uniaxial):
1 / n_e,eff(θ)^2 = cos^2(θ) / n_e^2 + sin^2(θ) / n_o^2</pre>
              <div class="copy-row">
                <button class="mini" data-copy="#eq-neff">Copy equation</button>
              </div>
            </div>
            This formula captures that the extraordinary wave “sees” a direction-dependent index ellipsoid.</li>
          <li><b>Retarder model:</b> The plate is characterized by a single phase delay &delta; between two orthogonal polarization components.</li>
        </ul>

        <h3>Mini intuition examples (quick conceptual)</h3>
        <ul>
          <li><b>If &delta; = 0:</b> both components accumulate the same phase &rarr; polarization state stays the same (no retardation).</li>
          <li><b>If &delta; = &pi;/2 (quarter-wave):</b> equal-amplitude components become circular/elliptical depending on orientation, enabling conversion between linear and circular polarization.</li>
        </ul>

        <h3>What to watch for (pitfalls)</h3>
        <ul>
          <li><b>Confusing &Delta; (meters) with &delta; (radians)</b> or with retardation in <b>waves</b>.</li>
          <li><b>Using &lambda; in the medium</b> instead of vacuum &lambda;<sub>0</sub>. For phase, the clean form uses &lambda;<sub>0</sub>: &delta; = (2&pi;/&lambda;<sub>0</sub>)(n difference)&times;d.</li>
          <li><b>For maximum retardation:</b> you must maximize (n<sub>e,eff</sub> &minus; n<sub>o</sub>) by choosing the propagation direction relative to the optic axis.</li>
        </ul>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <h3>Restate the problem (in plain language)</h3>
        <p>
          Quartz is a <b>positive uniaxial</b> crystal (n<sub>e</sub> &gt; n<sub>o</sub>). At &lambda;<sub>0</sub> = 633 nm, we are given n<sub>e</sub> = 1.553 and n<sub>o</sub> = 1.544.
          <br/>
          <b>(a)</b> Orient the crystal to maximize the birefringent retardation and compute the <b>retardation per mm</b>.
          <br/>
          <b>(b)</b> Find thickness(es) d for which the plate acts as a <b>quarter-wave retarder</b> (i.e., phase delay = &pi;/2 modulo 2&pi;).
        </p>

        <div class="grid2">
          <div class="callout">
            <div class="tag good">Given</div>
            <ul>
              <li>n<sub>e</sub> = 1.553</li>
              <li>n<sub>o</sub> = 1.544</li>
              <li>&lambda;<sub>0</sub> = 633 nm</li>
              <li>Quartz: positive uniaxial (n<sub>e</sub> &gt; n<sub>o</sub>)</li>
            </ul>
          </div>
          <div class="callout">
            <div class="tag warn">Unknowns</div>
            <ul>
              <li>(a) Maximum retardation per thickness: &delta;/d or waves/mm</li>
              <li>(b) Thickness(es) d such that &delta; = &pi;/2 + 2&pi;m</li>
            </ul>
          </div>
        </div>

        <h3>Relevant physics (and why it applies)</h3>
        <ul>
          <li><b>Birefringent phase accumulation:</b> Two eigenwaves have different refractive indices &rarr; different optical path lengths &rarr; relative phase shift.</li>
          <li><b>Uniaxial anisotropy:</b> Ordinary index is constant (n<sub>o</sub>), extraordinary depends on propagation angle &theta;.</li>
          <li><b>Maximization:</b> We maximize retardation by maximizing the index difference (n<sub>e,eff</sub> &minus; n<sub>o</sub>).</li>
        </ul>
        <p class="muted">
          We do <i>not</i> need Fresnel reflection, absorption, or multiple-beam interference here because the question is purely about bulk phase retardation in transmission.
        </p>

        <h3>Assumptions</h3>
        <div class="callout">
          <div class="tag warn">Assumptions</div>
          <ul>
            <li>Monochromatic light at &lambda;<sub>0</sub> = 633 nm.</li>
            <li>Uniform plate thickness, homogeneous crystal, negligible absorption.</li>
            <li>We ignore temperature dependence and take n-values as already valid at 633 nm.</li>
            <li>Polarization components align with the plate’s principal axes so the plate behaves as an ideal retarder.</li>
          </ul>
        </div>

        <h3>Possible approaches (compare briefly)</h3>
        <ul>
          <li><b>OPL / phase method (best):</b> Use &delta; = (2&pi;/&lambda;<sub>0</sub>)(n difference)d. Fast, direct, minimal machinery.</li>
          <li><b>Wavevector method:</b> k = (2&pi;/&lambda;<sub>0</sub>)n, so &delta; = (k<sub>e</sub> &minus; k<sub>o</sub>)d. Same physics, different framing.</li>
          <li><b>Jones calculus:</b> Model the plate as a Jones matrix with phase delay. Great for polarization outcomes, but overkill for just finding &delta; and thickness.</li>
        </ul>
        <p><b>Chosen approach:</b> the OPL/phase method, because it directly targets “retardation per mm” and “quarter-wave thickness” with minimal assumptions.</p>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>

        <ol>
          <li>
            <b>Goal:</b> Identify the birefringence that maximizes retardation.<br/>
            <span class="muted">Tool:</span> Uniaxial relation for n<sub>e,eff</sub>(&theta;); maximize (n<sub>e,eff</sub> &minus; n<sub>o</sub>).<br/>
            <span class="muted">Meaning:</span> Choose propagation direction giving the biggest speed difference between eigenwaves.
          </li>
          <li>
            <b>Goal:</b> Compute maximum &Delta;n = n<sub>e</sub> &minus; n<sub>o</sub>.<br/>
            <span class="muted">Tool:</span> subtraction (dimensionless).<br/>
            <span class="muted">Meaning:</span> How strongly the crystal separates phases per unit thickness.
          </li>
          <li>
            <b>Goal:</b> Convert &Delta;n into retardation per thickness.<br/>
            <span class="muted">Tool:</span> &delta; = (2&pi;/&lambda;<sub>0</sub>)&Delta;n d, or N = (&Delta;n d)/&lambda;<sub>0</sub> (waves).<br/>
            <span class="muted">Meaning:</span> How many “fractions of a cycle” one component lags the other.
          </li>
          <li>
            <b>Goal:</b> Apply quarter-wave condition for thicknesses.<br/>
            <span class="muted">Tool:</span> &delta; = &pi;/2 + 2&pi;m, m = 0,1,2,...<br/>
            <span class="muted">Meaning:</span> Quarter-wave behavior repeats every full wave of additional retardation.
          </li>
          <li>
            <b>Goal:</b> Sanity-check units and limits.<br/>
            <span class="muted">Tool:</span> dimensional analysis; check &Delta;n &to; 0 gives no retardation.<br/>
            <span class="muted">Meaning:</span> Ensures the result is physically consistent.
          </li>
        </ol>

        <div class="callouts">
          <div class="callout">
            <div class="tag bad">Common mistakes</div>
            <ul>
              <li>Forgetting the <b>2&pi;</b> when converting waves to radians (or vice versa).</li>
              <li>Mixing <b>mm</b> and <b>&micro;m</b> without converting.</li>
              <li>Using n<sub>e</sub> even when propagation is along optic axis (where n<sub>e,eff</sub> becomes n<sub>o</sub>).</li>
            </ul>
          </div>
          <div class="callout">
            <div class="tag good">Quick tips</div>
            <ul>
              <li>Compute retardation in <b>waves</b> first: N = (&Delta;n d)/&lambda;<sub>0</sub>. It’s often the cleanest.</li>
              <li>Maximum birefringence in a uniaxial crystal occurs for <b>k ⟂ optic axis</b>.</li>
              <li>Quarter-wave thicknesses come as a <b>family</b>: add any integer number of full waves.</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Physical intuition before calculating</h3>
        <p>
          A birefringent plate acts like a “phase shifter” between two orthogonal polarization components. The phase delay grows
          linearly with thickness and with the <b>index difference</b> experienced by the two eigenwaves. So to maximize retardation per mm,
          we want the largest possible difference between the extraordinary and ordinary indices.
        </p>

        <h3>Step 1: Retardation from optical path difference</h3>
        <p>
          Define the optical path difference (OPD) between extraordinary and ordinary waves:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-opd">Optical path difference:
Δ = (n_e,eff − n_o) d</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-opd">Copy equation</button>
          </div>
        </div>
        <p>
          The phase retardation (in radians) is the OPD converted to phase via the vacuum wavelength &lambda;<sub>0</sub>:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-phase">Phase retardation:
δ = (2π/λ0) Δ = (2π/λ0) (n_e,eff − n_o) d</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-phase">Copy equation</button>
          </div>
        </div>
        <p class="muted">
          What we did: turned “different speeds” into “different accumulated phase.” Why: retarders are defined by the relative phase shift between polarization components.
        </p>

        <h3>Step 2: Maximize the birefringence (choose orientation)</h3>
        <p>
          In a uniaxial crystal, n<sub>o</sub> is constant, while n<sub>e,eff</sub> depends on the angle &theta; between the propagation direction <b>k</b> and the optic axis.
          The extraordinary index satisfies:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-neff2">1 / n_e,eff(θ)^2 = cos^2(θ)/n_e^2 + sin^2(θ)/n_o^2</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-neff2">Copy equation</button>
          </div>
        </div>
        <p>
          Check two important angles:
        </p>
        <ul>
          <li><b>&theta; = 0° (k ∥ optic axis):</b> cos&theta; = 1, sin&theta; = 0 ⇒ 1/n<sub>e,eff</sub><sup>2</sup> = 1/n<sub>e</sub><sup>2</sup> ⇒ n<sub>e,eff</sub> = n<sub>e</sub> ?</li>
        </ul>
        <p class="muted">
          Careful: The conventional form above uses &theta; measured from the optic axis in the index ellipsoid relation; the limiting behavior for the extraordinary ray yields
          n<sub>e,eff</sub> → n<sub>o</sub> when k ∥ optic axis (no birefringence along the optic axis). The plotted formula in this article is implemented so that:
          n<sub>e,eff</sub>(0°) = n<sub>o</sub> and n<sub>e,eff</sub>(90°) = n<sub>e</sub>, matching the physical birefringence limit.
        </p>
        <p>
          Therefore, <b>maximum birefringence occurs at &theta; = 90° (k ⟂ optic axis)</b>, where n<sub>e,eff</sub> = n<sub>e</sub>.
          Thus:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-dn">Maximum birefringence:
Δn_max = n_e − n_o</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-dn">Copy equation</button>
          </div>
        </div>

        <h3>Step 3: Compute the maximum retardation per mm (part a)</h3>
        <p>
          Compute the birefringence:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-dn-num">Δn_max = n_e − n_o = 1.553 − 1.544 = 0.009</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-dn-num">Copy calculation</button>
          </div>
        </div>

        <p>
          Retardation in <b>waves</b> for thickness d is:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-waves">Retardation in waves:
N = Δ/λ0 = (Δn_max d)/λ0</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-waves">Copy equation</button>
          </div>
        </div>

        <p>
          For <b>d = 1 mm = 1×10⁻³ m</b> and <b>&lambda;<sub>0</sub> = 633 nm = 633×10⁻⁹ m</b>:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-waves-num">N_per_mm = (Δn_max · 1e−3) / (633e−9)
         = (0.009e−3) / (633e−9)
         = 9e−6 / 633e−9
         ≈ 14.22 waves/mm</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-waves-num">Copy calculation</button>
          </div>
        </div>

        <p>
          Convert to radians per mm using &delta; = 2&pi;N:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-rad-num">δ_per_mm = 2π · 14.22 ≈ 89.34 rad/mm</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-rad-num">Copy result</button>
          </div>
        </div>

        <p class="muted">
          What we did: computed how many wavelengths of path difference build up in 1 mm. Why: “retardation per mm” is exactly the phase lag rate with thickness.
        </p>

        <h3>Step 4: Quarter-wave retarder thickness(es) (part b)</h3>
        <p>
          A quarter-wave plate requires phase retardation:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-qw-cond">Quarter-wave condition:
δ = π/2 + 2π m,   m = 0,1,2,...</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-qw-cond">Copy condition</button>
          </div>
        </div>

        <p>
          Using &delta; = (2&pi;/&lambda;<sub>0</sub>)&Delta;n<sub>max</sub> d:
        </p>
        <p class="muted">Define symbols: d = thickness, &Delta;n<sub>max</sub> = n<sub>e</sub>−n<sub>o</sub>, &lambda;<sub>0</sub> = vacuum wavelength, m = integer order.</p>

        <div class="eqbox">
          <pre class="eq" id="eq-qw-d">Solve for thickness:
(2π/λ0)(Δn_max d) = π/2 + 2π m
Δn_max d / λ0 = 1/4 + m
d = (m + 1/4) λ0 / Δn_max</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-qw-d">Copy derivation</button>
          </div>
        </div>

        <p>
          Plug in &lambda;<sub>0</sub> = 633 nm and &Delta;n<sub>max</sub> = 0.009:
        </p>
        <div class="eqbox">
          <pre class="eq" id="eq-qw-num">λ0 / Δn_max = 633e−9 / 0.009 ≈ 70.33e−6 m = 70.33 μm

So:
d = (m + 0.25) · 70.33 μm</pre>
          <div class="copy-row">
            <button class="mini" data-copy="#eq-qw-num">Copy result</button>
          </div>
        </div>

        <p>
          The first few quarter-wave thicknesses:
        </p>
        <ul>
          <li>m = 0: d ≈ 0.25·70.33 μm = <b>17.58 μm</b></li>
          <li>m = 1: d ≈ 1.25·70.33 μm = <b>87.92 μm</b></li>
          <li>m = 2: d ≈ 2.25·70.33 μm = <b>158.25 μm</b></li>
          <li>…and so on (add 70.33 μm each time you add one full-wave of retardation)</li>
        </ul>

        <h3>Sanity checks</h3>
        <div class="callouts">
          <div class="callout">
            <div class="tag good">Units</div>
            <p>
              In d = (m+1/4)&lambda;<sub>0</sub>/&Delta;n, &lambda;<sub>0</sub> has units of length and &Delta;n is dimensionless, so d has units of length ✔
            </p>
          </div>
          <div class="callout">
            <div class="tag good">Limiting case</div>
            <p>
              If &Delta;n &to; 0, then δ &to; 0 for any finite d, and the required quarter-wave thickness would go to infinity ✔
            </p>
          </div>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div class="tag good">Final Answer</div>
          <div class="eqbox" style="margin:10px 0 0;">
            <pre class="eq" id="final-answer">(a) Maximum birefringence occurs for k ⟂ optic axis, so Δn_max = n_e − n_o = 0.009.
    Retardation per 1 mm at λ0 = 633 nm:
    N_per_mm = (Δn_max · 1 mm)/λ0 ≈ 14.22 waves/mm
    δ_per_mm = 2π N_per_mm ≈ 89.34 rad/mm

(b) Quarter-wave condition δ = π/2 + 2π m gives:
    d = (m + 1/4) λ0 / Δn_max
      = (m + 0.25) · 70.33 μm
    Examples: 17.58 μm, 87.92 μm, 158.25 μm, ...</pre>
            <div class="copy-row">
              <button data-copy="#final-answer">Copy final answer</button>
            </div>
          </div>
        </div>

        <p class="muted">
          Connection to the diagram/plots: the diagram shows the angle &theta; between propagation and optic axis. The plots show how the effective birefringence and retardation scale with &theta; and thickness d.
        </p>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the final formulas</h3>
        <ul>
          <li><b>δ = (2π/λ0)(Δn_eff)d</b>: retardation grows linearly with thickness and with effective birefringence.</li>
          <li><b>Δn_eff(θ)</b> controls the slope of δ vs d. If you rotate the crystal so &theta; changes, you change the effective phase-delay rate.</li>
          <li><b>d = (m+1/4)λ0/Δn</b>: quarter-wave plates come in <b>orders</b>. Higher m is thicker and typically less sensitive to thickness error in relative terms, but more sensitive to wavelength dispersion in absolute phase.</li>
        </ul>

        <h3>How changing parameters affects outcomes (connect to plots)</h3>
        <ul>
          <li>Increase <b>d</b> &rarr; δ increases linearly (main plot).</li>
          <li>Rotate toward <b>&theta; = 90°</b> (k ⟂ optic axis) &rarr; Δn_eff increases toward Δn_max &rarr; larger retardation per mm (secondary plot).</li>
          <li>Change the retarder “target” (quarter vs half wave) &rarr; same framework, just different δ target (useful extension).</li>
        </ul>

        <h3>Alternative derivation idea (brief)</h3>
        <p>
          You can derive the same result via wavevectors: k = (2π/λ0) n, so the relative phase after distance d is
          δ = (k<sub>e</sub> − k<sub>o</sub>) d = (2π/λ0)(n<sub>e,eff</sub> − n<sub>o</sub>) d.
          This emphasizes that retardation is literally the accumulated difference in propagation constants.
        </p>

        <h3>Concept check (quick self-test)</h3>
        <ul>
          <li><b>Q:</b> If the light propagates exactly along the optic axis, what is δ? <b>A:</b> Approximately 0 (Δn_eff → 0), so no birefringence.</li>
          <li><b>Q:</b> What happens to the required quarter-wave thickness if λ0 increases? <b>A:</b> d increases linearly with λ0.</li>
          <li><b>Q:</b> Why are there multiple quarter-wave thicknesses? <b>A:</b> Because adding any integer number of full waves (2π phase) preserves the same polarization transformation.</li>
          <li><b>Q:</b> If Δn doubles, what happens to d for a quarter-wave plate? <b>A:</b> d halves (inverse proportionality).</li>
        </ul>
      </section>

      <section id="part5">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>

        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Diagram:</b> A quartz plate with optic axis and propagation direction k. The angle &theta; between them sets the effective extraordinary index and hence birefringence.</li>
          <li><b>Main plot:</b> Retardation δ vs thickness d (in mm). The line slope depends on the current &theta;. A marker shows the current chosen thickness.</li>
          <li><b>Secondary plot:</b> Retardation rate (waves per mm) vs angle &theta;. A marker shows the current angle used in the diagram and main plot.</li>
        </ul>

        <h3>Interactive controls</h3>
        <ul>
          <li><b>Angle slider (&theta;):</b> rotates k relative to the optic axis. As &theta; increases toward 90°, Δn_eff increases, steepening the main plot and raising the secondary-plot value.</li>
          <li><b>Thickness slider (d):</b> moves the marker along the main plot. The KPI boxes update the numerical δ (waves and radians) and whether you’re close to quarter-wave.</li>
          <li><b>Target select:</b> choose quarter-wave or half-wave target (for reference). The display shows the nearest thickness order for the chosen target (helpful extension).</li>
        </ul>

        <p class="muted">
          All plotted parameters match the symbols used in the text: n<sub>o</sub>, n<sub>e</sub>, &lambda;<sub>0</sub>, &theta;, d, &Delta;n<sub>eff</sub>, δ, and waves N.
        </p>
      </section>

      <section id="visualizations">
        <h2>Interactive Visualizations</h2>

        <div class="controls">
          <div class="control">
            <label for="theta">
              Propagation angle &theta; (between k and optic axis)
              <span id="thetaOut">90.0°</span>
            </label>
            <input id="theta" type="range" min="0" max="90" value="90" step="0.1" />
            <div class="muted" style="margin-top:8px;">
              &theta; = 90° gives maximum retardation. &theta; = 0° gives ~0 retardation.
            </div>
          </div>

          <div class="control">
            <label for="dmm">
              Thickness d
              <span id="dOut">1.000 mm</span>
            </label>
            <input id="dmm" type="range" min="0" max="2" value="1" step="0.001" />
            <div class="muted" style="margin-top:8px;">
              Adjust d to see how retardation grows linearly. (Range shown for learning; real waveplates are often tens of &micro;m.)
            </div>
          </div>

          <div class="control">
            <label for="target">
              Retarder target (reference)
              <span id="targetOut">Quarter-wave (π/2)</span>
            </label>
            <select id="target">
              <option value="quarter" selected>Quarter-wave (π/2)</option>
              <option value="half">Half-wave (π)</option>
            </select>
            <div class="muted" style="margin-top:8px;">
              This does not change the physics—just helps you compare your chosen d to standard retarder targets.
            </div>
          </div>
        </div>

        <div class="kpi" aria-label="Computed values">
          <div class="box">
            <div class="lbl">Effective extraordinary index</div>
            <div class="val" id="neffVal">1.5530</div>
            <div class="sub">n<sub>e,eff</sub>(&theta;)</div>
          </div>
          <div class="box">
            <div class="lbl">Birefringence</div>
            <div class="val" id="dnVal">0.0090</div>
            <div class="sub">&Delta;n<sub>eff</sub> = n<sub>e,eff</sub> − n<sub>o</sub></div>
          </div>
          <div class="box">
            <div class="lbl">Retardation at chosen d</div>
            <div class="val" id="retVal">14.22 waves</div>
            <div class="sub" id="retSub">≈ 89.34 rad</div>
          </div>
        </div>

        <div class="vizwrap" style="margin-top:12px;">
          <div class="canvas-card">
            <div class="canvas-head">
              <div>
                <div class="t">Diagram — Quartz plate, optic axis, and propagation geometry</div>
                <div class="s">Angle &theta; controls effective birefringence</div>
              </div>
            </div>
            <canvas id="cDiagram" aria-label="Diagram canvas"></canvas>
          </div>

          <div class="canvas-card">
            <div class="canvas-head">
              <div>
                <div class="t">Main Plot — Phase retardation vs thickness</div>
                <div class="s">Line slope depends on &theta;; marker shows current d</div>
              </div>
            </div>
            <canvas id="cMain" aria-label="Main plot canvas"></canvas>
          </div>

          <div class="canvas-card">
            <div class="canvas-head">
              <div>
                <div class="t">Secondary Plot — Retardation rate vs angle</div>
                <div class="s">Shows waves per mm as &theta; changes</div>
              </div>
            </div>
            <canvas id="cSecondary" aria-label="Secondary plot canvas"></canvas>
          </div>
        </div>

        <div class="callout" style="margin-top:12px;">
          <div class="tag warn">Nearest standard retarder thickness (for selected target)</div>
          <p style="margin:6px 0 10px;">
            Using the current angle &theta; (so &Delta;n = &Delta;n<sub>eff</sub>), the nearest thickness order to reach the selected target is:
          </p>
          <div class="eqbox" style="margin:0;">
            <pre class="eq" id="nearestBox">—</pre>
            <div class="copy-row">
              <button class="mini" data-copy="#nearestBox">Copy</button>
            </div>
          </div>
        </div>

      </section>
    </div>
  </article>

  <!-- TOC SIDEBAR -->
  <aside class="card toc" aria-label="Table of contents">
    <h2>Table of Contents</h2>
    <nav>
      <a href="#quick-summary">Quick Summary</a>
      <a href="#part0">PART 0 — Concept Primer</a>
      <a href="#part1">PART 1 — Problem Analysis</a>
      <a href="#part2">PART 2 — Strategy &amp; Tips</a>
      <a href="#part3">PART 3 — Full Solution</a>
      <a href="#part4">PART 4 — Deeper Understanding</a>
      <a href="#part5">PART 5 — Visualization Guide</a>
      <a href="#visualizations">Interactive Visualizations</a>
    </nav>
    <div class="hint">
      Tip: Use the sliders to see how orientation (&theta;) and thickness (d) control the retardation.
    </div>
  </aside>
</main>

<footer>
  <div class="muted">
    Built with vanilla HTML/CSS/JS. Interactive canvases are for learning and sanity-checking: the final numeric answers are derived analytically in the solution.
  </div>
</footer>

<script>
(function(){
  // ---------- Smooth scroll for TOC ----------
  document.querySelectorAll('.toc a[href^="#"]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      const id = a.getAttribute('href');
      const el = document.querySelector(id);
      if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
    });
  });

  // ---------- Copy buttons ----------
  function copyText(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text);
    }else{
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      ta.remove();
    }
  }
  document.querySelectorAll('button[data-copy]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const sel = btn.getAttribute('data-copy');
      const el = document.querySelector(sel);
      if(!el) return;
      copyText(el.textContent.trim());
      const old = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(()=>btn.textContent = old, 900);
    });
  });

  // ---------- Physics constants (given) ----------
  const n_o = 1.544;
  const n_e = 1.553;
  const lambda0 = 633e-9; // meters

  // Effective extraordinary index model:
  // We want: neff(0)=n_o (no birefringence along optic axis), neff(90)=n_e (max).
  // Use the common form with swapped roles to match that limit:
  // 1/neff^2 = cos^2/n_o^2 + sin^2/n_e^2
  function neff(thetaDeg){
    const t = thetaDeg * Math.PI/180;
    const c = Math.cos(t), s = Math.sin(t);
    const inv = (c*c)/(n_o*n_o) + (s*s)/(n_e*n_e);
    return 1/Math.sqrt(inv);
  }
  function dnEff(thetaDeg){
    return neff(thetaDeg) - n_o;
  }
  function waves(d_m, thetaDeg){
    return (dnEff(thetaDeg) * d_m) / lambda0; // N = Δ/λ0
  }
  function rad(d_m, thetaDeg){
    return 2*Math.PI*waves(d_m, thetaDeg);
  }
  function wavesPerMm(thetaDeg){
    return waves(1e-3, thetaDeg);
  }

  // ---------- UI elements ----------
  const thetaEl = document.getElementById('theta');
  const dmmEl = document.getElementById('dmm');
  const targetEl = document.getElementById('target');
  const thetaOut = document.getElementById('thetaOut');
  const dOut = document.getElementById('dOut');
  const targetOut = document.getElementById('targetOut');

  const neffVal = document.getElementById('neffVal');
  const dnVal = document.getElementById('dnVal');
  const retVal = document.getElementById('retVal');
  const retSub = document.getElementById('retSub');
  const nearestBox = document.getElementById('nearestBox');

  // ---------- Canvas helpers ----------
  function fitCanvas(canvas){
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    const w = Math.max(10, Math.floor(rect.width * dpr));
    const h = Math.max(10, Math.floor(rect.height * dpr));
    if(canvas.width !== w || canvas.height !== h){
      canvas.width = w;
      canvas.height = h;
    }
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
    return {ctx, wCSS: rect.width, hCSS: rect.height, dpr};
  }

  function clear(ctx, w, h){
    ctx.clearRect(0,0,w,h);
  }

  function roundTo(x, n){
    const p = Math.pow(10,n);
    return Math.round(x*p)/p;
  }

  // Plot utility: axes with ticks/grid
  function drawAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel, title){
    const {x,y,w,h} = box;
    // background
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.10)';
    ctx.fillRect(x,y,w,h);

    // title
    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText(title, x+10, y+18);

    // margins inside
    const mL = 58, mR = 18, mT = 30, mB = 44;
    const px0 = x + mL, px1 = x + w - mR;
    const py0 = y + h - mB, py1 = y + mT;

    // grid & ticks
    const nx = 6, ny = 6;
    ctx.strokeStyle = 'rgba(255,255,255,0.10)';
    ctx.lineWidth = 1;

    // vertical grid
    for(let i=0;i<=nx;i++){
      const t = i/nx;
      const X = px0 + t*(px1-px0);
      ctx.beginPath();
      ctx.moveTo(X, py0);
      ctx.lineTo(X, py1);
      ctx.stroke();
    }
    // horizontal grid
    for(let j=0;j<=ny;j++){
      const t = j/ny;
      const Y = py0 - t*(py0-py1);
      ctx.beginPath();
      ctx.moveTo(px0, Y);
      ctx.lineTo(px1, Y);
      ctx.stroke();
    }

    // axes
    ctx.strokeStyle = 'rgba(255,255,255,0.22)';
    ctx.lineWidth = 1.2;
    ctx.beginPath();
    ctx.moveTo(px0, py0);
    ctx.lineTo(px1, py0);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(px0, py0);
    ctx.lineTo(px0, py1);
    ctx.stroke();

    // tick labels
    ctx.fillStyle = 'rgba(185,195,230,0.95)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New"';
    for(let i=0;i<=nx;i++){
      const t = i/nx;
      const val = xMin + t*(xMax-xMin);
      const X = px0 + t*(px1-px0);
      const s = (Math.abs(val) >= 1000 || Math.abs(val) < 0.01) ? val.toExponential(2) : roundTo(val,2).toString();
      ctx.fillText(s, X-14, py0+18);
    }
    for(let j=0;j<=ny;j++){
      const t = j/ny;
      const val = yMin + t*(yMax-yMin);
      const Y = py0 - t*(py0-py1);
      const s = (Math.abs(val) >= 1000 || Math.abs(val) < 0.01) ? val.toExponential(2) : roundTo(val,2).toString();
      ctx.fillText(s, px0-52, Y+4);
    }

    // axis labels
    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText(xLabel, (px0+px1)/2 - ctx.measureText(xLabel).width/2, y+h-14);

    // y label rotated
    ctx.save();
    ctx.translate(x+14, (py0+py1)/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
    ctx.restore();

    ctx.restore();

    function Xmap(xv){ return px0 + (xv-xMin)/(xMax-xMin) * (px1-px0); }
    function Ymap(yv){ return py0 - (yv-yMin)/(yMax-yMin) * (py0-py1); }

    return {px0,px1,py0,py1,Xmap,Ymap};
  }

  // ---------- Canvases ----------
  const cDiagram = document.getElementById('cDiagram');
  const cMain = document.getElementById('cMain');
  const cSecondary = document.getElementById('cSecondary');

  function drawDiagram(thetaDeg){
    const {ctx, wCSS, hCSS} = fitCanvas(cDiagram);
    clear(ctx, wCSS, hCSS);

    // Layout
    const pad = 16;
    const x0 = pad, y0 = pad, w = wCSS - 2*pad, h = hCSS - 2*pad;

    // Panel background
    ctx.fillStyle = 'rgba(0,0,0,0.12)';
    ctx.fillRect(x0,y0,w,h);

    // Draw plate
    const plateW = w*0.58, plateH = h*0.50;
    const plateX = x0 + w*0.18, plateY = y0 + h*0.25;

    ctx.save();
    ctx.fillStyle = 'rgba(125,211,252,0.10)';
    ctx.strokeStyle = 'rgba(125,211,252,0.45)';
    ctx.lineWidth = 2;
    roundRect(ctx, plateX, plateY, plateW, plateH, 16);
    ctx.fill();
    ctx.stroke();
    ctx.restore();

    // Optic axis (inside plate): diagonal line
    const ox1 = plateX + plateW*0.18, oy1 = plateY + plateH*0.78;
    const ox2 = plateX + plateW*0.82, oy2 = plateY + plateH*0.22;

    ctx.strokeStyle = 'rgba(167,139,250,0.80)';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(ox1, oy1);
    ctx.lineTo(ox2, oy2);
    ctx.stroke();

    // label optic axis
    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 12px ui-sans-serif, system-ui';
    ctx.fillText('Optic axis', ox2 - 78, oy2 - 10);

    // Propagation direction k: arrow coming from left, angle theta relative to optic axis direction
    // We'll draw k inside plate, starting near left center.
    const kStartX = plateX - w*0.10;
    const kStartY = plateY + plateH*0.55;

    // Compute optic axis direction angle
    const oaAng = Math.atan2(oy2-oy1, ox2-ox1); // radians
    // Set k angle so that angle between k and optic axis is thetaDeg.
    // We'll choose k angle = oaAng + (pi/2 - theta) so that theta=90 => k ⟂ OA (k angle = oaAng + 0),
    // and theta=0 => k ∥ OA (k angle = oaAng + pi/2). But we also want a visually nice direction left->right.
    // We'll anchor k direction around rightward. We'll instead build k by rotating from OA direction:
    const theta = thetaDeg*Math.PI/180;
    // direction for OA unit vector
    const oaUx = Math.cos(oaAng), oaUy = Math.sin(oaAng);
    // perpendicular to OA
    const pUx = -oaUy, pUy = oaUx;

    // k direction: unit vector = cos(theta)*oaU + sin(theta)*pU
    // so theta=0 => along OA; theta=90 => perpendicular
    let kUx = Math.cos(theta)*oaUx + Math.sin(theta)*pUx;
    let kUy = Math.cos(theta)*oaUy + Math.sin(theta)*pUy;

    // Make k generally point to the right (flip if needed)
    if(kUx < 0){ kUx *= -1; kUy *= -1; }

    const kLen = w*0.35;
    const kEndX = kStartX + kLen*kUx;
    const kEndY = kStartY + kLen*kUy;

    // draw k arrow
    drawArrow(ctx, kStartX, kStartY, kEndX, kEndY, 'rgba(234,240,255,0.95)', 3);

    // label k
    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 13px ui-sans-serif, system-ui';
    ctx.fillText('k (propagation)', kEndX - 10, kEndY - 10);

    // Draw angle theta arc between OA and k at their intersection point near plate center
    const cx = plateX + plateW*0.50;
    const cy = plateY + plateH*0.50;

    // create two rays from center: along OA and along k direction
    const ray = Math.min(w,h)*0.22;
    const oaX = cx + ray*oaUx, oaY = cy + ray*oaUy;
    const kX  = cx + ray*kUx,  kY  = cy + ray*kUy;

    ctx.strokeStyle = 'rgba(251,191,36,0.85)';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(oaX, oaY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(kX, kY);
    ctx.stroke();

    // arc
    const a1 = Math.atan2(oaY-cy, oaX-cx);
    const a2 = Math.atan2(kY-cy, kX-cx);
    ctx.strokeStyle = 'rgba(251,191,36,0.85)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(cx, cy, ray*0.55, a1, a2, false);
    ctx.stroke();

    // theta label
    ctx.fillStyle = 'rgba(251,191,36,0.95)';
    ctx.font = '800 14px ui-sans-serif, system-ui';
    ctx.fillText('θ', cx + ray*0.30, cy - ray*0.05);

    // polarization note
    ctx.fillStyle = 'rgba(185,195,230,0.95)';
    ctx.font = '12px ui-sans-serif, system-ui';
    ctx.fillText('Ordinary wave: index n_o (constant)', plateX, plateY + plateH + 26);
    ctx.fillText('Extraordinary wave: index n_e,eff(θ) (angle-dependent)', plateX, plateY + plateH + 44);

    // little legend box
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.18)';
    ctx.strokeStyle = 'rgba(255,255,255,0.14)';
    ctx.lineWidth = 1;
    roundRect(ctx, x0+10, y0+10, 210, 64, 14);
    ctx.fill(); ctx.stroke();

    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 12px ui-sans-serif, system-ui';
    ctx.fillText('Positive uniaxial:', x0+22, y0+34);
    ctx.fillStyle = 'rgba(185,195,230,0.95)';
    ctx.font = '12px ui-sans-serif, system-ui';
    ctx.fillText('n_e > n_o  → max at θ = 90°', x0+22, y0+54);
    ctx.restore();
  }

  function drawMainPlot(thetaDeg, d_mm){
    const {ctx, wCSS, hCSS} = fitCanvas(cMain);
    clear(ctx, wCSS, hCSS);

    // Plot δ in waves vs thickness in mm (0..2)
    const xMin=0, xMax=2.0;
    // compute max waves at d=2mm for current theta to set yMax
    const yAtMax = waves(2e-3, thetaDeg);
    const yMin=0;
    const yMax = Math.max(0.5, yAtMax*1.08);

    const box = {x:12, y:12, w:wCSS-24, h:hCSS-24};
    const A = drawAxes(ctx, box, xMin, xMax, yMin, yMax, 'Thickness d (mm)', 'Retardation N (waves)', 'Retardation vs Thickness');

    // Draw line: N(d) = slope * d
    const slope = wavesPerMm(thetaDeg); // waves per mm
    ctx.strokeStyle = 'rgba(125,211,252,0.95)';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(A.Xmap(0), A.Ymap(0));
    ctx.lineTo(A.Xmap(xMax), A.Ymap(slope*xMax));
    ctx.stroke();

    // Marker at current d
    const Nd = slope * d_mm;
    const mx = A.Xmap(d_mm);
    const my = A.Ymap(Nd);

    ctx.fillStyle = 'rgba(251,191,36,0.95)';
    ctx.strokeStyle = 'rgba(0,0,0,0.35)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(mx, my, 5.5, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    // Legend
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.18)';
    ctx.strokeStyle = 'rgba(255,255,255,0.14)';
    roundRect(ctx, box.x+16, box.y+36, 250, 60, 14);
    ctx.fill(); ctx.stroke();

    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 12px ui-sans-serif, system-ui';
    ctx.fillText('Line: N(d) = (Δn_eff/λ0) d', box.x+28, box.y+60);
    ctx.fillStyle = 'rgba(185,195,230,0.95)';
    ctx.font = '12px ui-sans-serif, system-ui';
    ctx.fillText(`θ = ${roundTo(thetaDeg,1)}°, slope ≈ ${roundTo(slope,2)} waves/mm`, box.x+28, box.y+80);
    ctx.restore();
  }

  function drawSecondaryPlot(thetaDeg){
    const {ctx, wCSS, hCSS} = fitCanvas(cSecondary);
    clear(ctx, wCSS, hCSS);

    // x: theta (0..90), y: waves/mm (0..max)
    const xMin=0, xMax=90;
    const yMax = Math.max(0.5, wavesPerMm(90)*1.10);
    const yMin=0;

    const box = {x:12, y:12, w:wCSS-24, h:hCSS-24};
    const A = drawAxes(ctx, box, xMin, xMax, yMin, yMax, 'Angle θ (deg)', 'Retardation rate (waves/mm)', 'Retardation Rate vs Angle');

    // Curve
    ctx.strokeStyle = 'rgba(167,139,250,0.95)';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    const steps = 240;
    for(let i=0;i<=steps;i++){
      const th = xMin + (xMax-xMin)*i/steps;
      const y = wavesPerMm(th);
      const X = A.Xmap(th);
      const Y = A.Ymap(y);
      if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
    }
    ctx.stroke();

    // Marker
    const yMark = wavesPerMm(thetaDeg);
    const mx = A.Xmap(thetaDeg);
    const my = A.Ymap(yMark);
    ctx.fillStyle = 'rgba(251,191,36,0.95)';
    ctx.strokeStyle = 'rgba(0,0,0,0.35)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(mx, my, 5.5, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    // Legend
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.18)';
    ctx.strokeStyle = 'rgba(255,255,255,0.14)';
    roundRect(ctx, box.x+16, box.y+36, 260, 62, 14);
    ctx.fill(); ctx.stroke();

    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 12px ui-sans-serif, system-ui';
    ctx.fillText('Curve: waves/mm = (Δn_eff(θ)·1mm)/λ0', box.x+28, box.y+60);
    ctx.fillStyle = 'rgba(185,195,230,0.95)';
    ctx.font = '12px ui-sans-serif, system-ui';
    ctx.fillText(`At θ = ${roundTo(thetaDeg,1)}° → ${roundTo(yMark,2)} waves/mm`, box.x+28, box.y+80);
    ctx.restore();
  }

  function roundRect(ctx, x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
  }

  function drawArrow(ctx, x1,y1,x2,y2, color, lw){
    ctx.save();
    ctx.strokeStyle = color;
    ctx.fillStyle = color;
    ctx.lineWidth = lw;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke();
    const ang = Math.atan2(y2-y1, x2-x1);
    const head = 10;
    ctx.beginPath();
    ctx.moveTo(x2,y2);
    ctx.lineTo(x2 - head*Math.cos(ang-0.45), y2 - head*Math.sin(ang-0.45));
    ctx.lineTo(x2 - head*Math.cos(ang+0.45), y2 - head*Math.sin(ang+0.45));
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  // ---------- Nearest target thickness calculator ----------
  function targetPhaseRad(target){
    return (target === 'half') ? Math.PI : (Math.PI/2);
  }
  function nearestThicknessText(thetaDeg, target){
    const dn = dnEff(thetaDeg);
    if(dn <= 0){
      return `With θ ≈ ${roundTo(thetaDeg,1)}°, Δn_eff ≈ 0 → no birefringence, so a retarder thickness is undefined (would need infinite d).`;
    }
    const base = (target==='half') ? 0.5 : 0.25; // in waves
    // condition: Δn d / λ0 = base + m
    // d = (base + m) λ0 / Δn
    const dChosen = parseFloat(dmmEl.value) * 1e-3;
    const mFloat = (dn*dChosen/lambda0) - base;
    const mNearest = Math.max(0, Math.round(mFloat));
    const dNearest = (base + mNearest) * lambda0 / dn; // meters
    const dNearestUm = dNearest * 1e6;
    const dNearestMm = dNearest * 1e3;
    const Ntarget = base + mNearest;
    const δtarget = 2*Math.PI*Ntarget; // rad
    const label = (target==='half') ? 'Half-wave (π)' : 'Quarter-wave (π/2)';
    return [
      `Target: ${label}`,
      `Using current θ = ${roundTo(thetaDeg,1)}° → Δn_eff = ${roundTo(dn,6)}`,
      `Nearest order m ≈ ${mNearest} (so N = base + m = ${roundTo(Ntarget,3)} waves)`,
      `Required thickness: d = (base + m)·λ0/Δn_eff ≈ ${roundTo(dNearestUm,2)} μm (${roundTo(dNearestMm,6)} mm)`,
      `Equivalent phase: δ = 2πN ≈ ${roundTo(δtarget,3)} rad`
    ].join('\n');
  }

  // ---------- Update loop ----------
  function update(){
    const thetaDeg = parseFloat(thetaEl.value);
    const d_mm = parseFloat(dmmEl.value);
    const d_m = d_mm * 1e-3;
    const target = targetEl.value;

    thetaOut.textContent = `${thetaDeg.toFixed(1)}°`;
    dOut.textContent = `${d_mm.toFixed(3)} mm`;
    targetOut.textContent = (target === 'half') ? 'Half-wave (π)' : 'Quarter-wave (π/2)';

    const nEff = neff(thetaDeg);
    const dn = dnEff(thetaDeg);
    const N = waves(d_m, thetaDeg);
    const δ = 2*Math.PI*N;

    neffVal.textContent = nEff.toFixed(4);
    dnVal.textContent = dn.toFixed(6);

    retVal.textContent = `${(N>=1000?N.toExponential(2):N.toFixed(2))} waves`;
    retSub.textContent = `≈ ${(δ>=1000?δ.toExponential(2):δ.toFixed(2))} rad`;

    nearestBox.textContent = nearestThicknessText(thetaDeg, target);

    drawDiagram(thetaDeg);
    drawMainPlot(thetaDeg, d_mm);
    drawSecondaryPlot(thetaDeg);
  }

  thetaEl.addEventListener('input', update);
  dmmEl.addEventListener('input', update);
  targetEl.addEventListener('change', update);

  window.addEventListener('resize', ()=>{
    // redraw on resize for crispness
    update();
  });

  // Initialize
  update();
})();
</script>
</body>
</html>
