<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Single Photon in a Fabry–Perot Resonator (Standing-Wave Mode & Uncertainty)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1733;
      --card:#121c3d;
      --muted:#9fb0d0;
      --text:#e9efff;
      --accent:#76e4ff;
      --accent2:#b7ff7a;
      --warn:#ffd36e;
      --danger:#ff7aa2;
      --line:rgba(255,255,255,.10);
      --shadow: 0 16px 40px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 900px at 20% 0%, rgba(118,228,255,.13), transparent 55%),
        radial-gradient(1000px 800px at 100% 20%, rgba(183,255,122,.10), transparent 52%),
        radial-gradient(800px 800px at 50% 100%, rgba(255,122,162,.09), transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.55;
      overflow-x:hidden;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    header{
      position:relative;
      padding: 28px 18px 10px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .wrap{
      width:min(1180px, 100%);
      margin:0 auto;
      padding:0 10px 22px;
    }
    .title{
      display:grid;
      gap:10px;
      align-items:start;
    }
    .title h1{
      margin:0;
      font-size:clamp(1.3rem, 2.2vw, 2.05rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      max-width:78ch;
      font-size:clamp(.95rem, 1.4vw, 1.02rem);
    }

    main{
      width:min(1180px, 100%);
      margin:0 auto;
      padding: 18px 10px 60px;
      display:grid;
      grid-template-columns: 300px 1fr;
      gap:18px;
      align-items:start;
    }

    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      background: rgba(18,28,61,.75);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:14px 12px;
      overflow:hidden;
    }
    nav.toc .toc-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    nav.toc h2{
      margin:0;
      font-size: .98rem;
      letter-spacing:.2px;
    }
    .pill{
      font-family:var(--mono);
      font-size:.72rem;
      color:rgba(233,239,255,.85);
      border:1px solid var(--line);
      padding:4px 8px;
      border-radius:999px;
      background:rgba(255,255,255,.04);
      user-select:none;
      white-space:nowrap;
    }

    nav.toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:rgba(233,239,255,.9);
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:.92rem;
    }
    nav.toc a:hover{
      background:rgba(118,228,255,.08);
      border-color:rgba(118,228,255,.20);
      transform: translateY(-1px);
      text-decoration:none;
    }
    nav.toc .small{
      color:var(--muted);
      font-size:.83rem;
      padding:10px 10px 6px;
    }

    article{
      display:grid;
      gap:16px;
      min-width:0;
    }

    section{
      background: rgba(18,28,61,.72);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    section .sec-inner{
      padding: 16px 16px 18px;
    }
    section h2{
      margin:0 0 10px;
      font-size:1.15rem;
      letter-spacing:.15px;
    }
    section h3{
      margin:14px 0 8px;
      font-size:1.02rem;
      color: rgba(233,239,255,.95);
    }
    p{margin:10px 0; color:rgba(233,239,255,.92)}
    ul{margin:10px 0 10px 22px}
    li{margin:6px 0; color:rgba(233,239,255,.90)}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      main{grid-template-columns: 1fr}
      nav.toc{position:relative; top:0}
      .grid2{grid-template-columns:1fr}
    }

    .callouts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 720px){
      .callouts{grid-template-columns:1fr}
    }
    .box{
      border-radius: 16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      padding:12px 12px 12px;
      position:relative;
      overflow:hidden;
    }
    .box::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(600px 160px at 0% 0%, rgba(118,228,255,.12), transparent 55%);
      pointer-events:none;
    }
    .box.warn::before{background: radial-gradient(600px 160px at 0% 0%, rgba(255,211,110,.14), transparent 55%);}
    .box.danger::before{background: radial-gradient(600px 160px at 0% 0%, rgba(255,122,162,.14), transparent 55%);}
    .box.good::before{background: radial-gradient(600px 160px at 0% 0%, rgba(183,255,122,.12), transparent 55%);}

    .box h4{
      margin:0 0 8px;
      font-size:.95rem;
      letter-spacing:.15px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .tag{
      font-family:var(--mono);
      font-size:.72rem;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: rgba(233,239,255,.86);
      user-select:none;
    }

    .eq{
      font-family:var(--mono);
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      padding:8px 10px;
      border-radius:14px;
      overflow:auto;
      color: rgba(233,239,255,.95);
      margin:8px 0;
      position:relative;
    }
    .eqrow{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .copybtn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      color: rgba(233,239,255,.9);
      border-radius: 12px;
      padding:8px 10px;
      font-size:.84rem;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .copybtn:hover{
      transform: translateY(-1px);
      background: rgba(118,228,255,.10);
      border-color: rgba(118,228,255,.22);
    }
    .copybtn:active{transform: translateY(0px) scale(.99)}
    .kpi{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 960px){ .kpi{grid-template-columns: repeat(2,1fr);} }
    @media (max-width: 520px){ .kpi{grid-template-columns: 1fr;} }

    .k{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(255,255,255,.04);
      padding:12px;
      position:relative;
      overflow:hidden;
    }
    .k::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(500px 160px at 0% 0%, rgba(118,228,255,.11), transparent 60%);
      pointer-events:none;
    }
    .k .label{color:var(--muted); font-size:.82rem}
    .k .val{font-family:var(--mono); font-size:1.02rem; margin-top:6px}

    figure{
      margin:0;
      padding: 12px 12px 16px;
      border-top:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.08));
    }
    .figgrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .canvasCard{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(0,0,0,.18);
      overflow:hidden;
      box-shadow: 0 12px 26px rgba(0,0,0,.25);
    }
    canvas{
      display:block;
      width:100%;
      height:auto;
      aspect-ratio: 16/7;
      background: rgba(0,0,0,.10);
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin: 10px 0 4px;
      padding: 10px 12px;
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.04);
    }
    .ctrl{
      display:flex;
      gap:10px;
      align-items:center;
      flex: 1 1 320px;
      min-width: 260px;
    }
    .ctrl label{
      color:rgba(233,239,255,.9);
      font-size:.9rem;
      white-space:nowrap;
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    .readout{
      font-family:var(--mono);
      font-size:.86rem;
      color:rgba(233,239,255,.92);
      padding:6px 10px;
      border:1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      background: rgba(0,0,0,.20);
      min-width: 168px;
      text-align:center;
      user-select:none;
    }
    .btnrow{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .btn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      color: rgba(233,239,255,.9);
      border-radius: 12px;
      padding:8px 10px;
      font-size:.86rem;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(183,255,122,.10);
      border-color: rgba(183,255,122,.22);
    }
    .btn:active{transform: translateY(0px) scale(.99)}
    footer{
      padding: 18px 10px 26px;
      width:min(1180px, 100%);
      margin:0 auto;
      color:var(--muted);
      border-top:1px solid var(--line);
    }

    @media print{
      body{background:white; color:black}
      header, nav.toc, .controls, .copybtn, .btn{display:none !important}
      section{box-shadow:none; background:white; border:1px solid #ddd}
      .eq{background:#f6f6f6; color:#111}
      canvas{border:1px solid #ddd}
      footer{color:#444}
    }

    /* subtle entrance */
    .fadeIn{
      animation: fadeIn .45s ease both;
    }
    @keyframes fadeIn{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0)}
    }
  </style>
</head>

<body>
<header>
  <div class="wrap title">
    <h1>Single Photon in a Fabry–Perot Resonator: Mode Wavelength, Energy, and Uncertainty</h1>
    <div class="subtitle">
      A perfectly reflecting Fabry–Perot cavity of length <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">d = 1&nbsp;cm</span> filled with a nonabsorbing dielectric <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">n = 1.5</span>. One photon occupies the standing-wave mode
      <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(10<sup>5</sup>πx/d)</span>.
    </div>
  </div>
</header>

<main>
  <nav class="toc fadeIn" aria-label="Table of contents">
    <div class="toc-head">
      <h2>Contents</h2>
      <span class="pill">scroll ▾</span>
    </div>
    <div class="small">Jump to a section:</div>
    <a href="#quick">Quick Summary</a>
    <a href="#part0">PART 0 — Concept Primer</a>
    <a href="#part1">PART 1 — Problem Analysis</a>
    <a href="#part2">PART 2 — Strategy & Tips</a>
    <a href="#part3">PART 3 — Full Solution</a>
    <a href="#part4">PART 4 — Deeper Understanding</a>
    <a href="#part5">PART 5 — Visualization Guide</a>
    <div class="small">Interactive canvases are embedded in the article section panels.</div>
  </nav>

  <article class="fadeIn">

    <section id="quick">
      <div class="sec-inner">
        <h2>Quick Summary</h2>
        <ul>
          <li>This problem is about a <b>Fabry–Perot cavity</b> mode in a dielectric and what a <b>single photon</b> in that mode implies for wavelength, energy, and uncertainties.</li>
          <li>The given standing wave <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(mπx/d)</span> identifies the <b>mode number</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">m = 10<sup>5</sup></span>.</li>
          <li>Perfect mirrors enforce <b>nodes</b> at the ends: allowed wavelengths in the dielectric satisfy <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ = 2d/m</span>.</li>
          <li>Frequency is set by the medium phase velocity: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ω = (c/n)k</span> with <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = mπ/d</span>.</li>
          <li>Photon energy: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E = ħω = hc/λ<sub>0</sub></span>, where <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub> = nλ</span> is the vacuum wavelength.</li>
          <li>For the standing-wave state, <b>mean momentum is zero</b> but momentum is uncertain: two directions ±x contribute.</li>
          <li>Final results are mainly <b>numerical</b> (with clear symbolic formulas first) and compared to the bound <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub> ≥ ħ/2</span>.</li>
        </ul>

        <div class="callouts">
          <div class="box good">
            <h4><span class="tag">Key results</span> What you will compute</h4>
            <ul>
              <li>In-medium wavelength <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ</span> and vacuum wavelength <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub></span></li>
              <li>Photon energy <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E</span> in eV</li>
              <li>Position spread <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span>, momentum spread <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub></span>, and direction info</li>
            </ul>
          </div>
          <div class="box warn">
            <h4><span class="tag">Big idea</span> Standing wave = superposition</h4>
            <p>
              A cavity standing wave is not “a photon moving right” or “left” — it is a coherent superposition of <b>two traveling-wave momenta</b>, so <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨p⟩=0</span> but <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub> ≠ 0</span>.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="part0">
      <div class="sec-inner">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <h3>Core definitions (symbols & units)</h3>
        <ul>
          <li><b>Cavity length</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">d</span> (meters): mirror separation (1D along x).</li>
          <li><b>Refractive index</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">n</span> (dimensionless): phase velocity in medium is <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">v = c/n</span>.</li>
          <li><b>Wave number</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k</span> (rad/m): spatial oscillation rate; for a standing wave in a cavity, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = mπ/d</span>.</li>
          <li><b>Wavelength in the medium</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ</span> (m): related by <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = 2π/λ</span>.</li>
          <li><b>Vacuum wavelength</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub></span> (m): <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub> = nλ</span>.</li>
          <li><b>Photon energy</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E</span> (J or eV): <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E = ħω = hc/λ<sub>0</sub></span>.</li>
          <li><b>Photon momentum magnitude</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">p</span> (kg·m/s): in 1D wave picture, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">p = ħk = h/λ</span> (direction ±x).</li>
          <li><b>Uncertainty (standard deviation)</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>, σ<sub>p</sub></span>: spreads of measurement outcomes for position and momentum.</li>
        </ul>

        <h3>Physical meaning</h3>
        <ul>
          <li><span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(mπx/d)</span> means the field has <b>nodes</b> at x=0 and x=d and <b>m half-wavelengths</b> fit inside the cavity.</li>
          <li>The index <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">n</span> changes the <b>frequency</b> for a given spatial mode, because waves propagate slower inside the medium.</li>
          <li>A <b>standing wave</b> is (conceptually) the sum of two traveling waves with wavevectors ±k, hence momentum has <b>two opposite directions</b>.</li>
        </ul>

        <h3>Key laws & when they are valid</h3>
        <div class="callouts">
          <div class="box">
            <h4><span class="tag">Cavity boundary condition</span> Perfect mirrors</h4>
            <p>
              Perfect reflectors enforce zero field at the mirrors (nodes), giving allowed spatial dependence:
              <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E(x) ∝ sin(mπx/d)</span>, with integer mode number m.
            </p>
          </div>
          <div class="box">
            <h4><span class="tag">Dispersion in a simple dielectric</span> Nonabsorbing, nondispersive model</h4>
            <p>
              Assuming constant n (no dispersion over the band), the angular frequency is
              <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ω = (c/n)k</span>.
              This is accurate when absorption is negligible and n varies slowly with frequency.
            </p>
          </div>
        </div>

        <h3>Common models/approximations (and why)</h3>
        <ul>
          <li><b>1D cavity model</b>: treat the mode as varying only along x (good for a long cavity with a single longitudinal mode considered).</li>
          <li><b>Perfect reflectors</b>: simplifies boundary conditions to exact nodes, making the standing-wave form exact.</li>
          <li><b>Photon in a mode</b>: energy is quantized as <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E = ħω</span> for one photon (ignoring the constant zero-point offset that doesn’t affect photon counting).</li>
        </ul>

        <h3>Mini intuition examples</h3>
        <ul>
          <li>If the cavity length doubles while m stays fixed, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ</span> doubles and energy halves.</li>
          <li>If the index n increases (with the same spatial mode), the frequency decreases, so the photon energy decreases.</li>
        </ul>

        <div class="box warn">
          <h4><span class="tag">What to watch for</span> Typical pitfalls</h4>
          <ul>
            <li>Mixing the <b>in-medium wavelength</b> λ with the <b>vacuum wavelength</b> λ<sub>0</sub>.</li>
            <li>Forgetting that a standing wave has <b>two momentum directions</b> even though it has a single k magnitude.</li>
            <li>Assuming the Heisenberg product must equal <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ/2</span>; that is only the <b>minimum possible</b>, not typical.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="part1">
      <div class="sec-inner">
        <h2>PART 1 — Problem Analysis (No solving yet)</h2>

        <h3>Problem restatement</h3>
        <p>
          We have a Fabry–Perot resonator of length <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">d = 1&nbsp;cm</span> filled with a lossless dielectric of refractive index <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">n = 1.5</span>.
          The mirrors are perfectly reflecting. Exactly one photon occupies the standing-wave mode
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(10<sup>5</sup>πx/d)</span>.
          (a) Find the photon wavelength and energy (in eV). (b) Estimate uncertainties in position and momentum (magnitude and direction) and compare with
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub> = ħ/2</span>.
        </p>

        <div class="grid2">
          <div class="box">
            <h4><span class="tag">Given</span></h4>
            <ul>
              <li><span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">d = 1.0×10<sup>−2</sup>&nbsp;m</span></li>
              <li><span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">n = 1.5</span> (assume nondispersive)</li>
              <li>Mode shape: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(10<sup>5</sup>πx/d)</span> ⇒ <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">m = 10<sup>5</sup></span></li>
              <li>Perfect mirrors (ideal boundary conditions)</li>
              <li>Exactly one photon in this mode</li>
            </ul>
          </div>
          <div class="box">
            <h4><span class="tag">Unknowns</span></h4>
            <ul>
              <li>Wavelength in medium <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ</span> and/or vacuum wavelength <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub></span></li>
              <li>Photon energy <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E</span> in eV</li>
              <li>Position uncertainty <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span></li>
              <li>Momentum uncertainty <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub></span> and direction statement</li>
              <li>Heisenberg product comparison <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub></span> vs <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ/2</span></li>
            </ul>
          </div>
        </div>

        <h3>Relevant physical principles (and why)</h3>
        <ul>
          <li><b>Standing-wave boundary quantization</b>: perfect mirrors fix nodes, so the spatial form directly encodes the allowed wave number.</li>
          <li><b>Wave dispersion in a dielectric</b>: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ω = (c/n)k</span> relates k to ω, giving energy.</li>
          <li><b>Quantum uncertainties</b>: treat the photon’s longitudinal mode as a 1D wavefunction-like pattern on 0…d to estimate <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span> and <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub></span>.</li>
        </ul>
        <p>
          We do <b>not</b> need mirror reflectivity phase shifts (perfect mirrors), mode linewidth/Q (no losses), nor transverse mode structure (not asked).
        </p>

        <div class="box">
          <h4><span class="tag">Assumptions</span></h4>
          <ul>
            <li>1D longitudinal mode; field exactly zero at mirrors.</li>
            <li>Dielectric is lossless and approximately nondispersive (constant n).</li>
            <li>Photon energy is <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E = ħω</span> for the mode frequency.</li>
            <li>For uncertainty estimates, we use the standard deviation computed from the mode shape over 0…d.</li>
          </ul>
        </div>

        <h3>Possible approaches (pros/cons)</h3>
        <ul>
          <li><b>Mode-matching (best here)</b>: read off <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k</span> from <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(mπx/d)</span>, then get λ, ω, E. Fast, direct, minimal assumptions.</li>
          <li><b>Round-trip phase condition</b>: impose <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">2nd = mλ<sub>0</sub></span>. Equivalent, good for optical intuition; slightly more bookkeeping with λ vs λ<sub>0</sub>.</li>
          <li><b>Full EM quantization</b>: quantize cavity field operators. Powerful but overkill for wavelength/energy and basic uncertainties.</li>
        </ul>
        <p><b>Chosen approach:</b> Use the standing-wave form to identify the longitudinal mode number and wave number, then compute wavelength/energy and uncertainties with standard integrals.</p>
      </div>
    </section>

    <section id="part2">
      <div class="sec-inner">
        <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

        <ol>
          <li><b>Identify the mode number</b> from <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(mπx/d)</span>.
            <br><span style="color:var(--muted)">Tool:</span> pattern match.
            <br><span style="color:var(--muted)">Meaning:</span> how many half-wavelengths fit in the cavity.</li>

          <li><b>Compute wave number</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = mπ/d</span>.
            <br><span style="color:var(--muted)">Tool:</span> boundary condition for perfect mirrors.
            <br><span style="color:var(--muted)">Meaning:</span> spatial oscillation rate inside the dielectric.</li>

          <li><b>Convert k to wavelength</b> in medium: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ = 2π/k = 2d/m</span>.
            <br><span style="color:var(--muted)">Meaning:</span> distance between phase repeats in the medium.</li>

          <li><b>Relate to vacuum wavelength</b>: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub> = nλ</span>.
            <br><span style="color:var(--muted)">Meaning:</span> the wavelength the same frequency would have in vacuum.</li>

          <li><b>Compute frequency</b> using dielectric phase velocity: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ω=(c/n)k</span>, then energy <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E=ħω</span> (or directly <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E=hc/λ<sub>0</sub></span>).
            <br><span style="color:var(--muted)">Meaning:</span> photon energy set by mode frequency.</li>

          <li><b>Estimate position uncertainty</b> from the probability density
            <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">P(x)=|ψ(x)|<sup>2</sup></span> with <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ψ(x)=√(2/d) sin(mπx/d)</span>.
            <br><span style="color:var(--muted)">Tool:</span> compute <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨x⟩</span>, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨x<sup>2</sup>⟩</span>.
            <br><span style="color:var(--muted)">Meaning:</span> spatial spread of detection outcomes inside the cavity.</li>

          <li><b>Estimate momentum uncertainty</b>: for a standing wave, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨p⟩=0</span> but
            <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨p<sup>2</sup>⟩=ħ<sup>2</sup>k<sup>2</sup></span> ⇒ <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub>=ħk</span>.
            <br><span style="color:var(--muted)">Meaning:</span> magnitude is well-defined-ish, direction is ambiguous (±x).</li>

          <li><b>Compare</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub></span> with the lower bound <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ/2</span>.
            <br><span style="color:var(--muted)">Meaning:</span> the cavity eigenmode is not a minimum-uncertainty state.</li>
        </ol>

        <div class="callouts">
          <div class="box danger">
            <h4><span class="tag">Common mistakes</span></h4>
            <ul>
              <li>Using <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ=2d/m</span> as the vacuum wavelength (it’s the <b>in-medium</b> wavelength).</li>
              <li>Setting <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub>=0</span> because “it’s one mode”. A standing wave has two directions.</li>
              <li>Expecting <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span> to be tiny for large m. The position distribution remains spread across the cavity (it oscillates rapidly, but it still fills 0…d).</li>
            </ul>
          </div>
          <div class="box good">
            <h4><span class="tag">Quick tips</span></h4>
            <ul>
              <li>Read the mode number directly: compare the argument of sine to <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">mπx/d</span>.</li>
              <li>Use <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E(eV) ≈ 1240 / λ<sub>0</sub>(nm)</span> for fast sanity checks.</li>
              <li>For high m, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub> ≈ d/√12</span> (almost the same as a uniform distribution on 0…d).</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section id="part3">
      <div class="sec-inner">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Physical intuition first</h3>
        <p>
          Perfect mirrors force the field to vanish at both ends, so the standing wave must have nodes at x=0 and x=d.
          The function <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">sin(mπx/d)</span> has exactly that property and fits <b>m half-wavelengths</b> across the cavity.
          A large mode number <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">m=10<sup>5</sup></span> means a very short wavelength and therefore a relatively high photon energy (in the near-UV here).
          Because the pattern is a standing wave, the photon’s momentum direction is not fixed: right-moving and left-moving components are both present.
        </p>

        <h3>(a) Wavelength and energy</h3>

        <div class="eq">
          <div class="eqrow">
            <div>
              Compare the given mode: <b>sin(10<sup>5</sup>πx/d)</b> with the general form <b>sin(mπx/d)</b>.
              <br>Therefore: <b>m = 10<sup>5</sup></b>.
            </div>
            <button class="copybtn" data-copy="Mode identification: sin(mπx/d) → m = 10^5">Copy</button>
          </div>
        </div>

        <p>
          The wave number inside the cavity (in the dielectric) is
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = mπ/d</span>.
          Using <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = 2π/λ</span>, the wavelength in the medium is
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>λ = 2π/k = 2π / (mπ/d) = 2d/m</b>
            </div>
            <button class="copybtn" data-copy="λ (in medium) = 2d/m">Copy</button>
          </div>
        </div>

        <p>
          Now insert numbers:
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">d = 1.0×10<sup>−2</sup> m</span>, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">m = 1.0×10<sup>5</sup></span>.
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>λ = 2(1.0×10<sup>−2</sup> m) / (1.0×10<sup>5</sup>) = 2.0×10<sup>−7</sup> m = 200 nm</b> (in the dielectric)
            </div>
            <button class="copybtn" data-copy="λ = 2d/m = 2.0e-7 m = 200 nm (in medium)">Copy</button>
          </div>
        </div>

        <p>
          The corresponding vacuum wavelength (same frequency, but in vacuum) is
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub> = nλ</span>.
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>λ<sub>0</sub> = nλ = (1.5)(200 nm) = 300 nm</b>
            </div>
            <button class="copybtn" data-copy="λ0 = nλ = 300 nm">Copy</button>
          </div>
        </div>

        <p>
          Photon energy is <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">E = hc/λ<sub>0</sub></span>.
          In convenient units, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">hc ≈ 1240 eV·nm</span>, so:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>E ≈ 1240 / 300 eV = 4.13 eV</b>
            </div>
            <button class="copybtn" data-copy="E(eV) = 1240/λ0(nm) ≈ 1240/300 = 4.13 eV">Copy</button>
          </div>
        </div>

        <div class="box good">
          <h4><span class="tag">Sanity checks</span></h4>
          <ul>
            <li><b>Units:</b> λ in meters/nm, λ<sub>0</sub> in nm, E in eV via 1240 eV·nm.</li>
            <li><b>Magnitude:</b> 300 nm is near-UV, consistent with ~4 eV photons.</li>
            <li><b>Limiting case:</b> If n → 1, then λ<sub>0</sub> → λ and E increases (higher frequency for same k if the medium is removed).</li>
          </ul>
        </div>

        <h3>(b) Uncertainty in position and momentum (magnitude and direction)</h3>

        <p>
          To estimate uncertainties, treat the longitudinal mode as a normalized “wavefunction-like” spatial pattern on <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">0 ≤ x ≤ d</span>:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>ψ(x) = √(2/d) sin(mπx/d)</b>, &nbsp; so &nbsp; <b>P(x)=|ψ(x)|² = (2/d) sin²(mπx/d)</b>
            </div>
            <button class="copybtn" data-copy="ψ(x)=sqrt(2/d) sin(mπx/d);  P(x)=(2/d) sin^2(mπx/d)">Copy</button>
          </div>
        </div>

        <p>
          The mean position is
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨x⟩ = ∫₀ᵈ x P(x) dx</span>.
          For this symmetric standing wave in a symmetric interval, the probability density is symmetric about the center, so:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>⟨x⟩ = d/2</b>
            </div>
            <button class="copybtn" data-copy="<x> = d/2">Copy</button>
          </div>
        </div>

        <p>
          Next compute <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨x²⟩</span>. The standard result for
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ψ(x)=√(2/d) sin(mπx/d)</span> on 0…d is:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>⟨x²⟩ = d²( 1/3 − 1/(2π²m²) )</b>
              <br>
              Therefore, variance:
              <b>σ<sub>x</sub>² = ⟨x²⟩ − ⟨x⟩² = d²( 1/12 − 1/(2π²m²) )</b>
            </div>
            <button class="copybtn" data-copy="⟨x²⟩=d²(1/3−1/(2π²m²));  σx²=d²(1/12−1/(2π²m²))">Copy</button>
          </div>
        </div>

        <p>
          So the position uncertainty is:
        </p>
        <div class="eq">
          <div class="eqrow">
            <div>
              <b>σ<sub>x</sub> = d √( 1/12 − 1/(2π²m²) )</b>
            </div>
            <button class="copybtn" data-copy="σx = d * sqrt(1/12 − 1/(2π² m²))">Copy</button>
          </div>
        </div>

        <p>
          For <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">m = 10<sup>5</sup></span>, the correction term <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">1/(2π²m²)</span> is tiny, so
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub> ≈ d/√12</span>.
          Numerically:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>σ<sub>x</sub> ≈ (1.0×10<sup>−2</sup> m)/√12 = 2.89×10<sup>−3</sup> m = 2.89 mm</b>
            </div>
            <button class="copybtn" data-copy="σx ≈ d/√12 = 2.89×10^-3 m = 2.89 mm">Copy</button>
          </div>
        </div>

        <p>
          Now momentum. For a 1D wave, the momentum operator is <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">p̂ = −iħ d/dx</span>.
          A standing wave is not an eigenstate of <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">p̂</span> (because it contains both ±k),
          so <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨p⟩ = 0</span>.
          However, it <i>is</i> an eigenstate of <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">p̂² = −ħ² d²/dx²</span>, because:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              If <b>ψ(x) ∝ sin(kx)</b>, then <b>d²ψ/dx² = −k²ψ</b> ⇒
              <br><b>p̂²ψ = (ħ²k²)ψ</b> so <b>⟨p²⟩ = ħ²k²</b>.
            </div>
            <button class="copybtn" data-copy="Standing wave: <p>=0, but <p²>=ħ²k² ⇒ σp=ħk">Copy</button>
          </div>
        </div>

        <p>
          Therefore,
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub> = √(⟨p²⟩ − ⟨p⟩²) = ħk</span>,
          with <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = mπ/d</span>.
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>σ<sub>p</sub> = ħ (mπ/d)</b>
            </div>
            <button class="copybtn" data-copy="σp = ħ mπ/d">Copy</button>
          </div>
        </div>

        <p>
          Numerically: <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ = 1.055×10<sup>−34</sup> J·s</span>,
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">mπ/d = 10<sup>5</sup>π / (10<sup>−2</sup>) = π×10<sup>7</sup> m<sup>−1</sup></span>.
          So:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>σ<sub>p</sub> ≈ (1.055×10<sup>−34</sup>)(3.1416×10<sup>7</sup>) = 3.31×10<sup>−27</sup> kg·m/s</b>
            </div>
            <button class="copybtn" data-copy="σp ≈ 3.31×10^-27 kg·m/s">Copy</button>
          </div>
        </div>

        <div class="box warn">
          <h4><span class="tag">Direction of momentum</span> What does “uncertainty in direction” mean here?</h4>
          <p>
            The standing wave can be viewed as a superposition of two traveling waves with momenta
            <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">+ħk</span> and <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">−ħk</span>.
            Thus, the <b>magnitude</b> is set by k (so momentum outcomes cluster near |p| ≈ ħk), but the <b>direction</b> is fundamentally ambiguous:
            measurements of momentum along x yield <b>either +x or −x</b> (approximately equally likely in this idealized standing-wave state).
          </p>
        </div>

        <h3>Heisenberg product comparison</h3>
        <p>
          Multiply the uncertainties:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>σ<sub>x</sub>σ<sub>p</sub> = [ d √( 1/12 − 1/(2π²m²) ) ] · [ ħ (mπ/d) ]</b>
              <br>
              <b>σ<sub>x</sub>σ<sub>p</sub> = ħ mπ √( 1/12 − 1/(2π²m²) )</b>
            </div>
            <button class="copybtn" data-copy="σxσp = ħ mπ * sqrt(1/12 − 1/(2π²m²))">Copy</button>
          </div>
        </div>

        <p>
          For large m, the small correction is negligible, so
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub> ≈ ħ mπ / √12</span>,
          which grows linearly with mode number (because the momentum scale grows with k).
          Using the numeric values above:
        </p>

        <div class="eq">
          <div class="eqrow">
            <div>
              <b>σ<sub>x</sub>σ<sub>p</sub> ≈ (2.89×10<sup>−3</sup>)(3.31×10<sup>−27</sup>) = 9.55×10<sup>−30</sup> J·s</b>
              <br>
              Compare with <b>ħ/2 = 5.27×10<sup>−35</sup> J·s</b>.
            </div>
            <button class="copybtn" data-copy="σxσp ≈ 9.55×10^-30 J·s;  ħ/2 ≈ 5.27×10^-35 J·s">Copy</button>
          </div>
        </div>

        <div class="box good" id="finalAnswerBox">
          <h4><span class="tag">Final Answer</span> (with numbers)</h4>
          <div class="eq" style="margin-top:10px">
            <div class="eqrow">
              <div>
                (a) Mode number <b>m = 10<sup>5</sup></b>.
                <br>
                In-medium wavelength: <b>λ = 2d/m = 2.0×10<sup>−7</sup> m = 200 nm</b>.
                <br>
                Vacuum wavelength: <b>λ<sub>0</sub> = nλ = 300 nm</b>.
                <br>
                Photon energy: <b>E = hc/λ<sub>0</sub> ≈ 4.13 eV</b>.
                <br><br>
                (b) <b>σ<sub>x</sub> = d √(1/12 − 1/(2π²m²)) ≈ 2.89 mm</b>.
                <br>
                <b>⟨p⟩ = 0</b> but <b>σ<sub>p</sub> = ħ(mπ/d) ≈ 3.31×10<sup>−27</sup> kg·m/s</b>.
                <br>
                Momentum direction: outcomes are approximately <b>±x</b> (standing-wave superposition).
                <br>
                Uncertainty product: <b>σ<sub>x</sub>σ<sub>p</sub> ≈ 9.55×10<sup>−30</sup> J·s ≫ ħ/2</b>.
              </div>
              <button class="copybtn" data-copy="(a) m=1e5; λ=2d/m=2.0e-7 m=200 nm (in medium); λ0=nλ=300 nm; E=hc/λ0≈4.13 eV. (b) σx=d*sqrt(1/12−1/(2π^2 m^2))≈2.89 mm; <p>=0; σp=ħ mπ/d≈3.31e-27 kg·m/s; momentum direction ≈ ±x; σxσp≈9.55e-30 J·s ≫ ħ/2.">Copy</button>
            </div>
          </div>
        </div>

        <h3>Connecting to the diagram and plots</h3>
        <p>
          In the diagram below, the mirrors at x=0 and x=d enforce nodes, so the standing-wave intensity
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">I(x) ∝ sin²(mπx/d)</span>
          oscillates rapidly for large m. Even so, the photon’s detection probability spans the whole cavity,
          giving <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span> on the millimeter scale.
          Meanwhile, the huge k value makes <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub>=ħk</span> large, so the Heisenberg product is far above the minimum bound.
        </p>

        <figure aria-label="Interactive visualizations">
          <div class="controls" role="group" aria-label="Interactive controls">
            <div class="ctrl">
              <label for="mSlider"><b>Mode number</b> m (log scale)</label>
              <input id="mSlider" type="range" min="1" max="5" step="0.01" value="5" />
              <div class="readout" id="mReadout">m = 1.00e5</div>
            </div>
            <div class="ctrl" style="flex:1 1 240px; min-width:240px;">
              <label for="zoomSel"><b>Plot view</b></label>
              <select id="zoomSel" class="readout" style="text-align:left; padding:8px 10px;">
                <option value="full" selected>Intensity: full cavity (0 → d)</option>
                <option value="local">Intensity: zoom near center (± 5 λ)</option>
              </select>
            </div>
            <div class="btnrow">
              <button class="btn" id="resetBtn" title="Reset to the problem's given mode m=1e5">Reset m = 10^5</button>
            </div>
          </div>

          <div class="kpi" aria-label="Live computed values">
            <div class="k">
              <div class="label">In-medium wavelength λ</div>
              <div class="val" id="kpiLambda">200.0 nm</div>
            </div>
            <div class="k">
              <div class="label">Vacuum wavelength λ₀</div>
              <div class="val" id="kpiLambda0">300.0 nm</div>
            </div>
            <div class="k">
              <div class="label">Photon energy E</div>
              <div class="val" id="kpiE">4.13 eV</div>
            </div>
            <div class="k">
              <div class="label">Uncertainty product σxσp</div>
              <div class="val" id="kpiHeis">1.81e-29 J·s</div>
            </div>
          </div>

          <div class="figgrid">
            <div class="canvasCard">
              <canvas id="diagram" aria-label="Fabry–Perot cavity diagram"></canvas>
            </div>
            <div class="canvasCard">
              <canvas id="plot1" aria-label="Main plot: intensity versus position"></canvas>
            </div>
            <div class="canvasCard">
              <canvas id="plot2" aria-label="Secondary plot: uncertainty product versus mode number"></canvas>
            </div>
          </div>
        </figure>
      </div>
    </section>

    <section id="part4">
      <div class="sec-inner">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the final formulas</h3>
        <ul>
          <li><b>Spatial quantization:</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ = 2d/m</span> says the cavity holds exactly m half-wavelengths. Larger m → shorter λ.</li>
          <li><b>Medium effect:</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">λ<sub>0</sub>=nλ</span> implies the same spatial mode corresponds to a longer vacuum wavelength (lower frequency) when n is larger.</li>
          <li><b>Momentum scale:</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub>=ħk=ħmπ/d</span> grows with m because the wave oscillates more rapidly in space.</li>
          <li><b>Position spread:</b> <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span> approaches <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">d/√12</span> for large m: the photon is not “localized” by being in a high-order standing wave; it still fills the cavity.</li>
          <li><b>Heisenberg product:</b> for large m,
            <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub> ≈ ħmπ/√12</span>
            which becomes huge for large m. The inequality is satisfied, but not saturated.</li>
        </ul>

        <h3>How changing parameters affects outcomes (connect to the interactive plots)</h3>
        <ul>
          <li>Increasing m (slider) makes the intensity oscillate faster and reduces λ and λ₀. Energy rises roughly ∝ m.</li>
          <li>As m increases, <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub></span> barely changes (stays near d/√12), but <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>p</sub></span> increases ∝ m, so <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub></span> increases ∝ m. That trend is what the secondary plot shows.</li>
          <li>The “zoom” view helps you see the oscillations when m is large: the full-cavity plot becomes too dense to resolve individual fringes.</li>
        </ul>

        <h3>An alternative derivation idea (brief)</h3>
        <p>
          Instead of reading off k from the sine, you can use the Fabry–Perot resonance condition that a round trip must accumulate an integer multiple of 2π:
          <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">2k d = 2mπ</span> ⇒ <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k=mπ/d</span>.
          Then use <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">k = n(2π/λ<sub>0</sub>)</span> to connect directly to λ<sub>0</sub>.
        </p>

        <h3>Concept check (self-test)</h3>
        <ul>
          <li><b>Q:</b> Why is <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">⟨p⟩=0</span> for a standing wave?
            <br><b>A:</b> Because it is an equal superposition of +k and −k traveling components; their average cancels.</li>
          <li><b>Q:</b> Does a larger m localize the photon near nodes/antinodes?
            <br><b>A:</b> No. The pattern oscillates faster, but the probability still spans the whole cavity, giving <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>≈d/√12</span>.</li>
          <li><b>Q:</b> If n increased while the mode shape stayed the same, what happens to energy?
            <br><b>A:</b> Energy decreases because <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ω=(c/n)k</span>.</li>
          <li><b>Q:</b> Must <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub></span> equal <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ/2</span>?
            <br><b>A:</b> No. <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ/2</span> is a lower bound; most states have larger products.</li>
        </ul>
      </div>
    </section>

    <section id="part5">
      <div class="sec-inner">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>

        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Diagram canvas:</b> A 1D Fabry–Perot cavity from x=0 to x=d with perfect mirrors, plus a sketch of the standing-wave envelope and labeled quantities (d, n, λ, ±p).</li>
          <li><b>Main plot (Intensity vs position):</b> Plots <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">I(x) ∝ sin²(mπx/d)</span> with axes, grid, ticks, and a title. It uses the same d, n, and m as the text.</li>
          <li><b>Secondary plot (Uncertainty product vs mode number):</b> Plots <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">σ<sub>x</sub>σ<sub>p</sub></span> as a function of m and overlays the line <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">ħ/2</span> for comparison.</li>
        </ul>

        <h3>Interactive controls</h3>
        <ul>
          <li><b>Mode number slider (log scale):</b> Changes m from 10¹ to 10⁵. Increasing m decreases λ and increases energy and σ<sub>p</sub>. All plots and live numbers update together.</li>
          <li><b>Plot view selector:</b> Switches the main intensity plot between the full cavity and a zoomed-in view around the center showing only ±5 wavelengths (useful for large m).</li>
          <li><b>Reset button:</b> Returns to the problem’s given mode m=10⁵.</li>
        </ul>

        <div class="box">
          <h4><span class="tag">Reading tip</span></h4>
          <p>
            For large m, the full-cavity intensity becomes visually dense because there are many oscillations.
            The zoom view keeps the physics clear: nodes/antinodes spacing is set by λ/2, and λ changes exactly as <span class="eq" style="display:inline-block;padding:2px 6px;border-radius:10px;">2d/m</span>.
          </p>
        </div>
      </div>
    </section>

  </article>
</main>

<footer>
  <div class="wrap">
    <div style="font-family:var(--mono); font-size:.86rem;">
      Constants used: c = 2.99792458×10<sup>8</sup> m/s, h = 6.62607015×10<sup>−34</sup> J·s, ħ = h/(2π), 1 eV = 1.602176634×10<sup>−19</sup> J.
    </div>
  </div>
</footer>

<script>
(() => {
  // ---------- constants ----------
  const C = 2.99792458e8;
  const H = 6.62607015e-34;
  const HBAR = H / (2*Math.PI);
  const EV = 1.602176634e-19;

  // Problem parameters (kept consistent with text)
  const d = 1e-2;   // m
  const nMed = 1.5; // dimensionless

  // ---------- utilities ----------
  const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
  const fmtSci = (x, sig=3) => {
    if (!isFinite(x)) return "—";
    if (x === 0) return "0";
    const exp = Math.floor(Math.log10(Math.abs(x)));
    const mant = x / Math.pow(10, exp);
    const m = mant.toFixed(Math.max(0, sig-1));
    return `${m}e${exp>=0?'+':''}${exp}`;
  };
  const fmtEng = (x, unit, sig=3) => {
    if (!isFinite(x)) return `— ${unit}`;
    const abs = Math.abs(x);
    if (abs === 0) return `0 ${unit}`;
    const prefixes = [
      {p:-12, s:"p"},
      {p:-9, s:"n"},
      {p:-6, s:"µ"},
      {p:-3, s:"m"},
      {p:0, s:""},
      {p:3, s:"k"},
      {p:6, s:"M"},
      {p:9, s:"G"}
    ];
    const exp3 = Math.floor(Math.log10(abs)/3)*3;
    const ex = clamp(exp3, -12, 9);
    const scale = Math.pow(10, ex);
    const val = x/scale;
    const pref = prefixes.find(o=>o.p===ex)?.s ?? "";
    const digits = Math.max(0, sig-1 - Math.floor(Math.log10(Math.abs(val))));
    return `${val.toFixed(digits)} ${pref}${unit}`;
  };

  function copyText(text){
    if (!navigator.clipboard){
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand('copy'); } catch(e){}
      document.body.removeChild(ta);
      return;
    }
    navigator.clipboard.writeText(text).catch(()=>{});
  }

  document.querySelectorAll('.copybtn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const t = btn.getAttribute('data-copy') || '';
      copyText(t);
      const old = btn.textContent;
      btn.textContent = "Copied ✓";
      setTimeout(()=>btn.textContent = old, 850);
    });
  });

  // ---------- model computations ----------
  function computeAll(m){
    const k = m*Math.PI/d;          // rad/m
    const lambda = 2*Math.PI/k;     // m (in medium) = 2d/m
    const lambda0 = nMed*lambda;    // m
    const E = (H*C)/lambda0;        // J
    const EeV = E/EV;               // eV

    // Position uncertainty for psi = sqrt(2/d) sin(mπx/d)
    const sigx = d*Math.sqrt(1/12 - 1/(2*Math.PI*Math.PI*m*m)); // m

    // Momentum uncertainty: <p>=0, <p^2>=ħ^2 k^2
    const sigp = HBAR*k;            // kg m/s

    const heis = sigx*sigp;         // J*s
    return {m,k,lambda,lambda0,EeV,sigx,sigp,heis};
  }

  // ---------- canvas helpers ----------
  function setupCanvas(canvas){
    const ctx = canvas.getContext('2d');
    function resize(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(2, Math.floor(rect.width * dpr));
      const h = Math.max(2, Math.floor(rect.height * dpr));
      if (canvas.width !== w || canvas.height !== h){
        canvas.width = w;
        canvas.height = h;
      }
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
      return {w: rect.width, h: rect.height, dpr};
    }
    return {ctx, resize};
  }

  function clear(ctx, w, h){
    ctx.clearRect(0,0,w,h);
  }

  function drawPanelTitle(ctx, w, title){
    ctx.save();
    ctx.fillStyle = "rgba(233,239,255,.92)";
    ctx.font = "600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.fillText(title, 14, 22);
    ctx.restore();
  }

  function drawAxes(ctx, box, xLabel, yLabel, xTicks, yTicks){
    const {x,y,w,h} = box;
    ctx.save();
    // background subtle
    ctx.fillStyle = "rgba(255,255,255,.02)";
    ctx.fillRect(x,y,w,h);

    // grid
    ctx.strokeStyle = "rgba(255,255,255,.10)";
    ctx.lineWidth = 1;
    for (let i=0;i<xTicks;i++){
      const xx = x + (i/(xTicks-1))*w;
      ctx.beginPath(); ctx.moveTo(xx,y); ctx.lineTo(xx,y+h); ctx.stroke();
    }
    for (let j=0;j<yTicks;j++){
      const yy = y + (j/(yTicks-1))*h;
      ctx.beginPath(); ctx.moveTo(x,yy); ctx.lineTo(x+w,yy); ctx.stroke();
    }

    // axis border
    ctx.strokeStyle = "rgba(255,255,255,.20)";
    ctx.strokeRect(x,y,w,h);

    // labels
    ctx.fillStyle = "rgba(233,239,255,.86)";
    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
    ctx.fillText(xLabel, x + w - ctx.measureText(xLabel).width, y + h + 18);

    ctx.save();
    ctx.translate(x - 32, y + h/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
    ctx.restore();

    ctx.restore();
  }

  function drawTicks(ctx, box, xMin, xMax, yMin, yMax, xTickCount=6, yTickCount=5){
    const {x,y,w,h} = box;
    ctx.save();
    ctx.fillStyle = "rgba(233,239,255,.82)";
    ctx.font = "11px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";

    for (let i=0;i<xTickCount;i++){
      const t = i/(xTickCount-1);
      const xx = x + t*w;
      const val = xMin + t*(xMax-xMin);
      const s = (Math.abs(val) >= 1e-3 && Math.abs(val) <= 1e3) ? val.toPrecision(3) : fmtSci(val,3);
      ctx.fillText(s, xx - ctx.measureText(s).width/2, y + h + 34);
    }
    for (let j=0;j<yTickCount;j++){
      const t = j/(yTickCount-1);
      const yy = y + (1-t)*h;
      const val = yMin + t*(yMax-yMin);
      const s = (Math.abs(val) >= 1e-3 && Math.abs(val) <= 1e3) ? val.toPrecision(3) : fmtSci(val,3);
      ctx.fillText(s, x - 10 - ctx.measureText(s).width, yy + 4);
    }
    ctx.restore();
  }

  function polyline(ctx, pts){
    if (pts.length < 2) return;
    ctx.beginPath();
    ctx.moveTo(pts[0].x, pts[0].y);
    for (let i=1;i<pts.length;i++) ctx.lineTo(pts[i].x, pts[i].y);
    ctx.stroke();
  }

  function mapToBox(xv, yv, xMin, xMax, yMin, yMax, box){
    const {x,y,w,h} = box;
    const X = x + (xv - xMin)/(xMax-xMin)*w;
    const Y = y + (1 - (yv - yMin)/(yMax-yMin))*h;
    return {x:X, y:Y};
  }

  // ---------- canvases ----------
  const diag = setupCanvas(document.getElementById('diagram'));
  const p1 = setupCanvas(document.getElementById('plot1'));
  const p2 = setupCanvas(document.getElementById('plot2'));

  // ---------- controls ----------
  const mSlider = document.getElementById('mSlider');
  const mReadout = document.getElementById('mReadout');
  const zoomSel = document.getElementById('zoomSel');
  const resetBtn = document.getElementById('resetBtn');

  const kpiLambda = document.getElementById('kpiLambda');
  const kpiLambda0 = document.getElementById('kpiLambda0');
  const kpiE = document.getElementById('kpiE');
  const kpiHeis = document.getElementById('kpiHeis');

  function sliderToM(v){
    // v is log10(m)
    const m = Math.pow(10, parseFloat(v));
    // show as rounded to 3 sig digits
    return m;
  }

  function formatM(m){
    // show like 1.00e5
    const exp = Math.floor(Math.log10(m));
    const mant = m / Math.pow(10, exp);
    return `m = ${mant.toFixed(2)}e${exp}`;
  }

  // ---------- drawing: diagram ----------
  function drawDiagram(state){
    const {ctx, resize} = diag;
    const {w,h} = resize();
    clear(ctx, w, h);
    drawPanelTitle(ctx, w, "Diagram: Fabry–Perot cavity (perfect mirrors) and standing-wave mode");

    const pad = 18;
    const top = 36;
    const boxW = w - 2*pad;
    const boxH = h - top - 18;

    // cavity line
    const x0 = pad + 18;
    const x1 = pad + boxW - 18;
    const yC = top + boxH*0.58;

    // mirrors
    ctx.save();
    ctx.strokeStyle = "rgba(255,255,255,.85)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0, yC-46); ctx.lineTo(x0, yC+46);
    ctx.moveTo(x1, yC-46); ctx.lineTo(x1, yC+46);
    ctx.stroke();

    // mirror hatch
    ctx.strokeStyle = "rgba(255,255,255,.30)";
    ctx.lineWidth = 1;
    for (let i=0;i<10;i++){
      const yy = yC-46 + i*(92/9);
      ctx.beginPath();
      ctx.moveTo(x0-10, yy); ctx.lineTo(x0, yy+8);
      ctx.moveTo(x1, yy); ctx.lineTo(x1+10, yy+8);
      ctx.stroke();
    }

    // cavity axis
    ctx.strokeStyle = "rgba(255,255,255,.30)";
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(x0, yC); ctx.lineTo(x1, yC);
    ctx.stroke();

    // labels
    ctx.fillStyle = "rgba(233,239,255,.92)";
    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
    ctx.fillText("x = 0", x0-10, yC+66);
    ctx.fillText(`x = d = ${fmtEng(d,"m",3)}`, x1-90, yC+66);

    // length arrow
    const yA = yC+30;
    ctx.strokeStyle = "rgba(118,228,255,.85)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0+8, yA); ctx.lineTo(x1-8, yA);
    ctx.stroke();
    // arrowheads
    ctx.beginPath();
    ctx.moveTo(x0+8, yA); ctx.lineTo(x0+18, yA-5); ctx.lineTo(x0+18, yA+5); ctx.closePath();
    ctx.fillStyle = "rgba(118,228,255,.85)";
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(x1-8, yA); ctx.lineTo(x1-18, yA-5); ctx.lineTo(x1-18, yA+5); ctx.closePath();
    ctx.fill();

    ctx.fillStyle = "rgba(118,228,255,.95)";
    ctx.fillText("d", (x0+x1)/2 - 4, yA-10);

    // dielectric label
    ctx.fillStyle = "rgba(183,255,122,.90)";
    ctx.fillText(`dielectric: n = ${nMed.toFixed(2)}`, x0+14, yC-58);

    // standing wave sketch (scaled)
    const yW = yC - 18;
    const amp = 26;
    const mSketch = Math.min(state.m, 40); // don't draw 1e5 oscillations; show conceptual
    ctx.strokeStyle = "rgba(255,211,110,.95)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    for (let i=0;i<=240;i++){
      const t = i/240;
      const x = x0 + t*(x1-x0);
      const phase = mSketch*Math.PI*t;
      const y = yW - amp*Math.sin(phase);
      if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();
    ctx.fillStyle = "rgba(255,211,110,.95)";
    ctx.fillText("standing wave (schematic)", x0+14, yW-34);

    // momentum note
    ctx.fillStyle = "rgba(233,239,255,.86)";
    ctx.fillText("momentum outcomes:", x0+14, yC+98);
    ctx.fillStyle = "rgba(233,239,255,.92)";
    ctx.fillText("≈ +ħk or −ħk (two directions)", x0+14, yC+116);

    ctx.restore();
  }

  // ---------- drawing: plot 1 (intensity) ----------
  function drawPlot1(state){
    const {ctx, resize} = p1;
    const {w,h} = resize();
    clear(ctx, w, h);

    drawPanelTitle(ctx, w, "Main plot: normalized intensity I(x) ∝ sin²(mπx/d)");

    const box = {x:62, y:38, w:w-82, h:h-92};
    const view = zoomSel.value;

    let xMin=0, xMax=d;
    const lambda = state.lambda;
    if (view === "local"){
      const span = 10*lambda; // ±5λ around center
      xMin = d/2 - span/2;
      xMax = d/2 + span/2;
      // keep inside [0,d]
      if (xMin < 0){ xMax -= xMin; xMin = 0; }
      if (xMax > d){ xMin -= (xMax-d); xMax = d; xMin = Math.max(0,xMin); }
    }
    const yMin=0, yMax=1.05;

    drawAxes(ctx, box, "x (m)", "I (arb.)", 8, 6);
    drawTicks(ctx, box, xMin, xMax, yMin, yMax, 6, 5);

    // curve
    const N = 1400;
    const pts = [];
    for (let i=0;i<N;i++){
      const t = i/(N-1);
      const x = xMin + t*(xMax-xMin);
      const I = Math.pow(Math.sin(state.m*Math.PI*x/d), 2); // normalized to [0,1]
      pts.push(mapToBox(x, I, xMin, xMax, yMin, yMax, box));
    }
    ctx.save();
    ctx.strokeStyle = "rgba(118,228,255,.95)";
    ctx.lineWidth = 2;
    polyline(ctx, pts);
    ctx.restore();

    // legend
    ctx.save();
    ctx.fillStyle = "rgba(233,239,255,.90)";
    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
    const leg = `m=${state.m.toPrecision(3)} | λ=${fmtEng(state.lambda,"m",3)} | view=${view}`;
    ctx.fillText(leg, box.x + 10, box.y + 18);
    ctx.restore();
  }

  // ---------- drawing: plot 2 (uncertainty product vs m) ----------
  function drawPlot2(state){
    const {ctx, resize} = p2;
    const {w,h} = resize();
    clear(ctx, w, h);

    drawPanelTitle(ctx, w, "Secondary plot: Heisenberg product σxσp vs mode number m (compare to ħ/2)");

    const box = {x:62, y:38, w:w-82, h:h-92};

    // We plot over m range from 10^1..10^5 (same as slider)
    const mMin = 1e1, mMax = 1e5;

    // Use log-x scale; y is in J*s
    // Compute y-range by sampling
    const sampleN = 240;
    let yLo = Infinity, yHi = -Infinity;
    const data = [];
    for (let i=0;i<sampleN;i++){
      const t = i/(sampleN-1);
      const logm = Math.log10(mMin) + t*(Math.log10(mMax)-Math.log10(mMin));
      const m = Math.pow(10, logm);
      const s = computeAll(m);
      data.push({m, heis:s.heis});
      yLo = Math.min(yLo, s.heis);
      yHi = Math.max(yHi, s.heis);
    }
    const yRef = HBAR/2;
    yLo = Math.min(yLo, yRef);
    yHi = Math.max(yHi, yRef*1.2);

    // Add padding
    yLo *= 0.85;
    yHi *= 1.15;

    // Draw axes with custom tick labels (log-x)
    drawAxes(ctx, box, "m (dimensionless, log scale)", "σxσp (J·s)", 8, 6);

    // grid already, but place ticks ourselves
    ctx.save();
    ctx.fillStyle = "rgba(233,239,255,.82)";
    ctx.font = "11px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";

    // x ticks at decades
    const decades = [1e1,1e2,1e3,1e4,1e5];
    decades.forEach(mv=>{
      const t = (Math.log10(mv)-Math.log10(mMin)) / (Math.log10(mMax)-Math.log10(mMin));
      const xx = box.x + t*box.w;
      const s = `1e${Math.round(Math.log10(mv))}`;
      ctx.fillText(s, xx - ctx.measureText(s).width/2, box.y + box.h + 34);
    });

    // y ticks (linear in J*s but displayed as sci)
    const yTicks = 5;
    for (let j=0;j<yTicks;j++){
      const t = j/(yTicks-1);
      const yy = box.y + (1-t)*box.h;
      const val = yLo + t*(yHi-yLo);
      const s = fmtSci(val,3);
      ctx.fillText(s, box.x - 10 - ctx.measureText(s).width, yy + 4);
    }
    ctx.restore();

    // Helper: map log-x
    function mapLogX(mv){
      const t = (Math.log10(mv)-Math.log10(mMin)) / (Math.log10(mMax)-Math.log10(mMin));
      return box.x + t*box.w;
    }
    function mapY(yv){
      return box.y + (1 - (yv - yLo)/(yHi-yLo))*box.h;
    }

    // Plot σxσp curve
    ctx.save();
    ctx.strokeStyle = "rgba(183,255,122,.95)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    data.forEach((pt, i)=>{
      const xx = mapLogX(pt.m);
      const yy = mapY(pt.heis);
      if (i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
    });
    ctx.stroke();

    // Plot ħ/2 reference line
    ctx.strokeStyle = "rgba(255,122,162,.85)";
    ctx.lineWidth = 2;
    ctx.setLineDash([6,6]);
    const yLine = mapY(yRef);
    ctx.beginPath();
    ctx.moveTo(box.x, yLine);
    ctx.lineTo(box.x+box.w, yLine);
    ctx.stroke();
    ctx.setLineDash([]);

    // Mark current m
    const xxM = mapLogX(state.m);
    const yyM = mapY(state.heis);
    ctx.fillStyle = "rgba(118,228,255,.95)";
    ctx.beginPath();
    ctx.arc(xxM, yyM, 5.5, 0, Math.PI*2);
    ctx.fill();

    // legend
    ctx.fillStyle = "rgba(233,239,255,.90)";
    ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
    ctx.fillText("σxσp (mode state)", box.x+10, box.y+18);
    ctx.fillStyle = "rgba(255,122,162,.9)";
    ctx.fillText("ħ/2 (lower bound)", box.x+10, box.y+36);
    ctx.fillStyle = "rgba(118,228,255,.95)";
    ctx.fillText("current m", box.x+10, box.y+54);

    ctx.restore();
  }

  // ---------- UI updates ----------
  function updateKPIs(state){
    kpiLambda.textContent  = `${(state.lambda*1e9).toFixed(1)} nm`;
    kpiLambda0.textContent = `${(state.lambda0*1e9).toFixed(1)} nm`;
    kpiE.textContent       = `${state.EeV.toFixed(2)} eV`;
    kpiHeis.textContent    = `${fmtSci(state.heis,3)} J·s`;
  }

  function render(){
    const m = sliderToM(mSlider.value);
    const state = computeAll(m);

    mReadout.textContent = formatM(m);
    updateKPIs(state);

    drawDiagram(state);
    drawPlot1(state);
    drawPlot2(state);
  }

  // events
  mSlider.addEventListener('input', render);
  zoomSel.addEventListener('change', render);
  resetBtn.addEventListener('click', ()=>{
    mSlider.value = "5"; // log10(1e5)
    zoomSel.value = "full";
    render();
  });

  // resize handling
  let resizeTimer = null;
  window.addEventListener('resize', ()=>{
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(render, 60);
  });

  // initial
  render();
})();
</script>
</body>
</html>
