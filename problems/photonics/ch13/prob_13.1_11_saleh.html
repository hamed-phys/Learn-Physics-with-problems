<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Single-Photon Beating (Time Interference): Detection-Time Probability from Two Frequencies</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1833;
      --card:#121e3d;
      --ink:#eaf0ff;
      --muted:#b9c4e6;
      --faint:#7f8bb7;
      --accent:#76b7ff;
      --accent2:#7dffbf;
      --warn:#ffcc66;
      --danger:#ff6b7a;
      --ok:#7dffbf;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:26px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(118,183,255,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(125,255,191,.12), transparent 55%),
        radial-gradient(900px 700px at 70% 85%, rgba(255,204,102,.10), transparent 60%),
        linear-gradient(180deg, #070a14, var(--bg));
      color:var(--ink);
      line-height:1.55;
      overflow-x:hidden;
    }

    header{
      padding: 36px 18px 20px;
      position:relative;
    }
    .wrap{
      max-width: 1150px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 330px 1fr;
      gap: 18px;
      padding: 0 18px 40px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr;}
      .toc{position:relative; top:auto;}
    }

    .hero{
      max-width:1150px;
      margin:0 auto;
      padding: 0 18px 14px;
      display:grid;
      gap:14px;
    }
    .titleCard{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 20px 20px 18px;
      overflow:hidden;
      position:relative;
    }
    .titleCard:before{
      content:"";
      position:absolute; inset:-2px -2px auto auto;
      width:220px; height:220px;
      background: radial-gradient(circle at 35% 35%, rgba(118,183,255,.26), transparent 60%);
      filter: blur(0px);
      opacity:.9;
      transform: translate(30px,-45px);
      pointer-events:none;
    }
    h1{
      margin:0 0 6px;
      letter-spacing:.2px;
      line-height:1.15;
      font-size: clamp(26px, 2.5vw, 40px);
    }
    .subtitle{
      color: var(--muted);
      margin:0;
      font-size: 15.5px;
      max-width: 80ch;
    }

    .badgeRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 14px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 12.5px;
      backdrop-filter: blur(6px);
    }
    .dot{
      width:9px; height:9px;
      border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(118,183,255,.12);
    }
    .dot.g{background: var(--accent2); box-shadow:0 0 0 4px rgba(125,255,191,.10);}
    .dot.y{background: var(--warn); box-shadow:0 0 0 4px rgba(255,204,102,.10);}

    .toc{
      position: sticky;
      top: 14px;
      align-self:start;
      background: rgba(18,30,61,.72);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 10px;
      backdrop-filter: blur(10px);
    }
    .toc h2{
      font-size: 13px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin: 2px 0 10px;
    }
    .toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--ink);
      text-decoration:none;
      border:1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      font-size: 14px;
      line-height:1.25;
      margin-bottom: 6px;
    }
    .toc a:hover{
      background: rgba(118,183,255,.08);
      border-color: rgba(118,183,255,.22);
      transform: translateX(2px);
    }
    .toc .small{
      color: var(--faint);
      font-size: 12.5px;
      margin-top: 6px;
      padding: 8px 10px;
      border-top: 1px solid var(--line);
    }

    main{
      display:grid;
      gap: 16px;
      min-width: 0;
    }

    section{
      background: rgba(18,30,61,.65);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
      min-width:0;
    }
    section h2{
      margin: 0 0 10px;
      font-size: 18px;
      letter-spacing:.2px;
    }
    section h3{
      margin: 16px 0 10px;
      font-size: 15.5px;
      color: var(--ink);
    }
    p{margin: 10px 0; color: var(--muted);}
    ul{margin: 10px 0 10px 20px; color: var(--muted);}
    li{margin: 7px 0;}

    .grid2{
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid2{grid-template-columns: 1fr;}
    }

    .callouts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 680px){
      .callouts{grid-template-columns: 1fr;}
    }
    .callout{
      border-radius: 18px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.035);
      padding: 12px 12px 10px;
      position:relative;
      overflow:hidden;
    }
    .callout strong{color: var(--ink);}
    .callout .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color: var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
      margin-bottom:8px;
    }
    .pill{
      width:9px; height:9px; border-radius:50%;
      background: var(--accent2);
      box-shadow: 0 0 0 4px rgba(125,255,191,.12);
    }
    .pill.warn{background: var(--warn); box-shadow:0 0 0 4px rgba(255,204,102,.12);}
    .pill.bad{background: var(--danger); box-shadow:0 0 0 4px rgba(255,107,122,.12);}

    .eqCard{
      border-radius: 18px;
      border: 1px solid rgba(118,183,255,.22);
      background: linear-gradient(180deg, rgba(118,183,255,.08), rgba(255,255,255,.02));
      padding: 12px 12px 10px;
      margin: 10px 0;
      overflow:auto;
    }
    .eq{
      font-family: var(--mono);
      font-size: 13.5px;
      color: var(--ink);
      white-space: pre-wrap;
    }
    .copyRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }
    button.copyBtn{
      cursor:pointer;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      color: var(--ink);
      padding: 8px 11px;
      font-size: 12.5px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    button.copyBtn:hover{
      transform: translateY(-1px);
      background: rgba(118,183,255,.10);
      border-color: rgba(118,183,255,.22);
    }
    .copied{
      font-size: 12.5px;
      color: var(--accent2);
      opacity:0;
      transform: translateY(2px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .copied.show{
      opacity:1;
      transform: translateY(0px);
    }

    .vizGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    .vizRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .vizRow{grid-template-columns: 1fr;}
    }
    .canvasCard{
      border-radius: 18px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.03);
      padding: 10px;
      overflow:hidden;
    }
    .canvasTitle{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      margin: 4px 4px 8px;
    }
    .canvasTitle .t{
      font-size: 13.5px;
      letter-spacing:.08em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .canvasTitle .hint{
      font-size: 12px;
      color: var(--faint);
    }
    canvas{
      width:100%;
      height: 320px;
      display:block;
      border-radius: 14px;
      background: rgba(9,14,29,.55);
      border: 1px solid rgba(255,255,255,.08);
    }
    canvas.small{height: 260px;}
    canvas.diagram{height: 300px;}

    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 980px){
      .controls{grid-template-columns: 1fr;}
    }
    .ctrl{
      border-radius: 18px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.03);
      padding: 12px 12px 10px;
    }
    .ctrl label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .ctrl label span.val{
      font-family: var(--mono);
      color: var(--ink);
      font-size: 12.5px;
    }
    input[type="range"]{
      width: 100%;
      accent-color: var(--accent);
    }
    .note{
      margin-top: 8px;
      color: var(--faint);
      font-size: 12.5px;
    }

    .finalBox{
      border-radius: 20px;
      border: 1px solid rgba(125,255,191,.24);
      background: linear-gradient(180deg, rgba(125,255,191,.08), rgba(255,255,255,.02));
      padding: 14px 14px 12px;
      margin-top: 10px;
    }
    .finalBox h3{margin:0 0 8px; color: var(--ink);}
    .finalBox .eq{font-size: 13.8px;}
    .kicker{
      font-size: 12px;
      color: var(--faint);
      letter-spacing:.14em;
      text-transform:uppercase;
      margin:0 0 6px;
    }

    footer{
      max-width: 1150px;
      margin: 0 auto;
      padding: 0 18px 32px;
      color: var(--faint);
      font-size: 12.5px;
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000;}
      .toc{display:none;}
      section, .titleCard{box-shadow:none; background:#fff; border-color:#ddd;}
      canvas{border-color:#ccc; background:#fff;}
      .badge, button.copyBtn{display:none;}
      p, ul{color:#111;}
      .eqCard, .finalBox{background:#f7f7f7; border-color:#ddd;}
    }

    /* Subtle motion */
    @media (prefers-reduced-motion: no-preference){
      section{animation: floatIn .35s ease both;}
      @keyframes floatIn{
        from{opacity:0; transform: translateY(6px);}
        to{opacity:1; transform: translateY(0);}
      }
    }
  </style>
</head>

<body>
<header>
  <div class="hero">
    <div class="titleCard">
      <h1>Single-Photon Beating (Time Interference)</h1>
      <p class="subtitle">
        Two monochromatic plane waves of slightly different frequencies illuminate a detector. Even if only <em>one</em> photon arrives during one beat period,
        the <strong>time of detection</strong> is not uniform — it follows a probability density proportional to the classical beating intensity.
      </p>
      <div class="badgeRow">
        <span class="badge"><span class="dot"></span>Time interference</span>
        <span class="badge"><span class="dot g"></span>Born rule: probability ∝ intensity</span>
        <span class="badge"><span class="dot y"></span>Complementarity: energy resolution vs interference</span>
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <nav class="toc" aria-label="Table of contents">
    <h2>Contents</h2>
    <a href="#qs">Quick Summary</a>
    <a href="#p0">PART 0 — Concept Primer</a>
    <a href="#p1">PART 1 — Problem Analysis</a>
    <a href="#p2">PART 2 — Strategy & Tips</a>
    <a href="#p3">PART 3 — Full Solution</a>
    <a href="#p4">PART 4 — Deeper Understanding</a>
    <a href="#p5">PART 5 — Visualization Guide</a>
    <div class="small">
      Tip: the sliders change the beat frequency, relative phase, intensity ratio, and a “which-frequency” energy-resolution knob.
    </div>
  </nav>

  <main>
    <section id="qs">
      <h2>Quick Summary</h2>
      <ul>
        <li><strong>What this is about:</strong> a detector is illuminated by two superposed plane waves (frequencies <span class="eq">ν₁</span>, <span class="eq">ν₂</span>) traveling in the same direction.</li>
        <li><strong>Key physics idea:</strong> in weak light (single-photon regime), the detection-time probability density <span class="eq">p(t)</span> is proportional to the instantaneous intensity <span class="eq">I(t)</span> (Born rule for photodetection).</li>
        <li><strong>Beating intensity:</strong> for complex fields <span class="eq">U₁(t)=√I₁ e^{j2πν₁t}</span>, <span class="eq">U₂(t)=√I₂ e^{j2πν₂t}</span>,
          <span class="eq">I(t)=I₁+I₂+2√(I₁I₂) cos[2π(ν₂−ν₁)t + φ]</span>.</li>
        <li><strong>Given:</strong> equal intensities <span class="eq">I₁=I₂</span> and only one photon arrives during <span class="eq">T = 1/|ν₂−ν₁|</span>.</li>
        <li><strong>Main result type:</strong> symbolic, normalized <span class="eq">p(t)</span> on <span class="eq">0≤t≤T</span>, and the time(s) where <span class="eq">p(t)=0</span>.</li>
        <li><strong>Final answer (core):</strong> for <span class="eq">I₁=I₂</span> and (taking φ=0), <span class="eq">p(t)= [1+cos(2πΔν t)]/T = (2/T) cos²(πΔν t)</span>, with <span class="eq">Δν=|ν₂−ν₁|</span>.</li>
        <li><strong>Zero probability time within one beat:</strong> <span class="eq">t = T/2</span> (the middle of the beat period, when destructive interference makes the intensity zero).</li>
      </ul>
    </section>

    <section id="p0">
      <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

      <div class="grid2">
        <article>
          <h3>Core definitions (symbols + units)</h3>
          <ul>
            <li><span class="eq">ν</span> (Hz): optical frequency. Two components: <span class="eq">ν₁</span>, <span class="eq">ν₂</span>.</li>
            <li><span class="eq">Δν = |ν₂−ν₁|</span> (Hz): beat frequency difference.</li>
            <li><span class="eq">I</span> (W/m²): intensity (time-averaged power per area) at the detector.</li>
            <li><span class="eq">U(t)</span> (complex field amplitude): a convenient phasor-like representation; here <span class="eq">|U|² = I</span> in the chosen normalization.</li>
            <li><span class="eq">p(t)</span> (1/s): probability density to detect the photon at time <span class="eq">t</span>.</li>
            <li><span class="eq">T = 1/Δν</span> (s): one beat period (given by the problem).</li>
            <li><span class="eq">E = hν</span> (J): photon energy; <span class="eq">h</span> is Planck’s constant.</li>
            <li><span class="eq">σ_E</span> (J): energy-measurement uncertainty (resolution).</li>
          </ul>

          <h3>Physical meaning</h3>
          <p>
            Superposing two nearby frequencies produces a slowly varying envelope (“beating”).
            In classical optics you see intensity oscillate at <span class="eq">Δν</span>.
            In the single-photon regime you don’t get a continuous intensity trace — you get <em>random click times</em>.
            The deep point is: the click-time statistics still follow the interference pattern,
            i.e. <span class="eq">p(t) ∝ I(t)</span>, as long as the detector cannot distinguish which frequency (which “color”) the photon had.
          </p>

          <h3>Key laws/principles (validity + assumptions)</h3>
          <ul>
            <li><strong>Field superposition (linearity):</strong> total field <span class="eq">U=U₁+U₂</span>. Valid in linear media and weak fields.</li>
            <li><strong>Intensity from complex field:</strong> <span class="eq">I(t)=|U(t)|²</span> (up to a constant). Here normalization is chosen so that <span class="eq">|U|²</span> equals intensity.</li>
            <li><strong>Photodetection (Born rule analogue):</strong> detection rate is proportional to intensity (or normally ordered intensity in full quantum theory). In this problem, you’re told to use the classical <span class="eq">I(t)</span> as the probability weight.</li>
            <li><strong>Fourier/time–frequency resolution idea:</strong> distinguishing <span class="eq">ν₁</span> from <span class="eq">ν₂</span> requires an observation time on the order of <span class="eq">1/Δν</span>. This is the intuition behind complementarity here.</li>
          </ul>
        </article>

        <aside>
          <div class="callouts">
            <div class="callout">
              <div class="tag"><span class="pill"></span>Common model</div>
              <p>
                Treat the two components as coherent (fixed phase relationship) so the cross term
                <span class="eq">2√(I₁I₂)cos(...)</span> exists. If phases randomize, the cosine term averages to zero.
              </p>
            </div>
            <div class="callout">
              <div class="tag"><span class="pill warn"></span>Mini intuition</div>
              <p>
                If <span class="eq">I(t)</span> is twice as large at some time, clicks are twice as likely there.
                Over one beat, you sample a sinusoid-shaped probability density.
              </p>
            </div>
            <div class="callout">
              <div class="tag"><span class="pill bad"></span>Watch for</div>
              <ul>
                <li>For probability density, you must <strong>normalize</strong> over <span class="eq">0..T</span>.</li>
                <li>The beat period is <span class="eq">T=1/Δν</span>, not <span class="eq">2π/Δω</span> unless you switch to angular frequency.</li>
                <li>Equal intensities give perfect visibility and can produce <span class="eq">I(t)=0</span> at some times.</li>
              </ul>
            </div>
            <div class="callout">
              <div class="tag"><span class="pill"></span>Why single-photon still “interferes”</div>
              <p>
                Interference is about amplitudes adding before detection. A single quantum can have multiple indistinguishable alternatives (here: two frequencies) that add coherently.
              </p>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section id="p1">
      <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

      <h3>Problem restatement (in plain words)</h3>
      <p>
        A detector is illuminated by a poly-chromatic plane wave that is the sum of two monochromatic waves traveling in the same direction.
        The complex wavefunctions are <span class="eq">U₁(t)=√I₁ e^{j2πν₁t}</span> and <span class="eq">U₂(t)=√I₂ e^{j2πν₂t}</span>.
        The intensity at the detector is given (from interference) as
        <span class="eq">I(t)=I₁+I₂+2√(I₁I₂)cos[2π(ν₂−ν₁)t]</span>.
        Assume <span class="eq">I₁=I₂</span> and the field is so weak that only <em>one</em> photon reaches the detector during the interval
        <span class="eq">T=1/|ν₂−ν₁|</span>.
        (a) Sketch and determine the normalized detection-time probability density <span class="eq">p(t)</span> on <span class="eq">0≤t≤T</span> and find when it is zero.
        (b) Explain how trying to learn which constituent wave the photon came from requires an energy measurement with precision better than
        <span class="eq">σ_E &lt; h|ν₂−ν₁|</span>, and what that implies for observing the time-interference pattern.
      </p>

      <h3>Given quantities</h3>
      <ul>
        <li>Frequencies: <span class="eq">ν₁</span>, <span class="eq">ν₂</span></li>
        <li>Intensities: <span class="eq">I₁</span>, <span class="eq">I₂</span> with <span class="eq">I₁=I₂</span></li>
        <li>Beat interval: <span class="eq">T = 1/|ν₂−ν₁|</span></li>
        <li>Intensity formula: <span class="eq">I(t)=I₁+I₂+2√(I₁I₂)\,cos[2π(ν₂−ν₁)t]</span></li>
      </ul>

      <h3>Unknowns / what to find</h3>
      <ul>
        <li><span class="eq">p(t)</span> on <span class="eq">0≤t≤T</span>, properly normalized (area = 1).</li>
        <li>Time(s) within <span class="eq">T</span> at which <span class="eq">p(t)=0</span>.</li>
        <li>Interpretation of the energy-resolution condition in part (b) and its connection to interference.</li>
      </ul>

      <h3>Relevant principles (and why they apply)</h3>
      <ul>
        <li><strong>Superposition and interference:</strong> fields add; intensity contains cross term giving cosine beating. Applies because waves are coherent and collinear.</li>
        <li><strong>Photodetection as a stochastic process:</strong> in weak light, detection events are random, but their rate follows intensity. Applies because the problem explicitly frames the single-photon regime and references the intensity formula.</li>
        <li><strong>Complementarity / distinguishability:</strong> distinguishing frequencies demands high energy resolution, which tends to erase interference in time. Applies because “which constituent wave” is “which frequency”, an information-vs-interference trade-off.</li>
      </ul>

      <div class="callouts">
        <div class="callout">
          <div class="tag"><span class="pill"></span>Assumptions</div>
          <ul>
            <li>Two components are phase-coherent (fixed relative phase during the interval).</li>
            <li>Detector response is proportional to intensity (no saturation, linear regime).</li>
            <li>Exactly one photon arrives within <span class="eq">T</span> (so <span class="eq">p(t)</span> can be normalized over <span class="eq">0..T</span>).</li>
            <li>Plane-wave geometry → no spatial fringes; only time beating matters.</li>
          </ul>
        </div>
        <div class="callout">
          <div class="tag"><span class="pill warn"></span>Approaches</div>
          <ul>
            <li><strong>Classical-to-probability mapping:</strong> compute <span class="eq">I(t)</span>, then set <span class="eq">p(t)=I(t)/∫₀ᵀ I(t')dt'</span>. Fast and matches problem statement.</li>
            <li><strong>Quantum amplitude approach:</strong> treat two frequency amplitudes and compute detection probability from <span class="eq">|ψ(t)|²</span>. More fundamental, same final <span class="eq">p(t)</span> here.</li>
            <li><strong>Fourier/time-frequency analysis for (b):</strong> use resolution-time trade-off (<span class="eq">Δν ~ 1/τ</span>) to argue which-frequency info suppresses beating.</li>
          </ul>
          <p class="note"><strong>Best choice:</strong> the first approach (normalize intensity) because the problem explicitly provides <span class="eq">I(t)</span> and asks for <span class="eq">p(t)</span> in a single-photon window.</p>
        </div>
      </div>
    </section>

    <section id="p2">
      <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>
      <ol style="color:var(--muted); margin:10px 0 10px 20px;">
        <li>
          <strong>Goal:</strong> write <span class="eq">I(t)</span> for equal intensities.<br/>
          <span class="eq">Tool:</span> substitute <span class="eq">I₁=I₂</span> into the given intensity formula.<br/>
          <span class="eq">Meaning:</span> see the beat envelope explicitly (often becomes a <span class="eq">cos²</span>).
        </li>
        <li>
          <strong>Goal:</strong> convert intensity to a probability density <span class="eq">p(t)</span>.<br/>
          <span class="eq">Tool:</span> normalize: <span class="eq">p(t)=I(t)/∫₀ᵀ I(t')dt'</span>.<br/>
          <span class="eq">Meaning:</span> ensures total probability of the single click in <span class="eq">0..T</span> is 1.
        </li>
        <li>
          <strong>Goal:</strong> find when <span class="eq">p(t)=0</span> within <span class="eq">0..T</span>.<br/>
          <span class="eq">Tool:</span> solve for destructive interference times (cosine equals −1 or <span class="eq">cos²=0</span>).<br/>
          <span class="eq">Meaning:</span> moments when the two amplitudes cancel exactly at the detector.
        </li>
        <li>
          <strong>Goal:</strong> interpret the “which wave?” energy resolution condition.<br/>
          <span class="eq">Tool:</span> frequency discrimination requires energy precision <span class="eq">σ_E &lt; hΔν</span> and an observation time <span class="eq">τ ≳ 1/Δν = T</span> (Fourier limit).<br/>
          <span class="eq">Meaning:</span> gaining which-frequency information tends to wash out time-interference.
        </li>
      </ol>

      <div class="callouts">
        <div class="callout">
          <div class="tag"><span class="pill warn"></span>Common mistakes</div>
          <ul>
            <li>Forgetting to normalize <span class="eq">p(t)</span> (so it doesn’t integrate to 1).</li>
            <li>Mixing frequency <span class="eq">ν</span> and angular frequency <span class="eq">ω=2πν</span> (factor of <span class="eq">2π</span> errors).</li>
            <li>Assuming the probability is proportional to field amplitude instead of intensity (<span class="eq">|U|²</span>).</li>
          </ul>
        </div>
        <div class="callout">
          <div class="tag"><span class="pill"></span>Quick tips</div>
          <ul>
            <li>Over one full beat period, the cosine averages to zero, so <span class="eq">∫₀ᵀ I(t)dt</span> is just the constant part times <span class="eq">T</span>.</li>
            <li>For equal intensities, the modulation depth (visibility) is 1, so zeros are possible.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="p3">
      <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

      <h3>Physical intuition first (before math)</h3>
      <p>
        Two close frequencies create a slow beat: sometimes the waves add (high intensity), sometimes they cancel (low intensity).
        If only one photon arrives in a beat period, you cannot predict exactly <em>when</em> it arrives — but you can predict that clicks cluster near beat maxima
        and are rare near beat minima. With equal intensities and stable phase, you can even get a time where the intensity goes to zero,
        meaning <em>no chance</em> of a click at that instant.
      </p>

      <h3>Step 1 — Start from the given intensity formula</h3>
      <p>We are given (define <span class="eq">Δν = ν₂−ν₁</span>; the beat depends only on the difference):</p>
      <div class="eqCard">
        <div class="eq" id="eq1">I(t) = I₁ + I₂ + 2√(I₁ I₂) cos[2π(ν₂ − ν₁)t]</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eq1">Copy equation</button>
          <span class="copied" id="copied-eq1">Copied ✓</span>
        </div>
      </div>
      <p>
        This comes directly from <span class="eq">I=|U₁+U₂|²</span>, where the cross term produces the cosine interference.
      </p>

      <h3>Step 2 — Apply equal intensities (<span class="eq">I₁ = I₂</span>)</h3>
      <p>Let <span class="eq">I₁=I₂=I₀</span>. Then <span class="eq">√(I₁I₂)=I₀</span> and:</p>
      <div class="eqCard">
        <div class="eq" id="eq2">I(t) = 2I₀ + 2I₀ cos(2πΔν t) = 2I₀[1 + cos(2πΔν t)].</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eq2">Copy equation</button>
          <span class="copied" id="copied-eq2">Copied ✓</span>
        </div>
      </div>
      <p>
        Using the identity <span class="eq">1+cos(2x)=2cos²(x)</span>, we can also write:
      </p>
      <div class="eqCard">
        <div class="eq" id="eq3">I(t) = 4I₀ cos²(πΔν t).</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eq3">Copy equation</button>
          <span class="copied" id="copied-eq3">Copied ✓</span>
        </div>
      </div>
      <p>
        This form makes zeros obvious: <span class="eq">I(t)=0</span> whenever the cosine is zero.
      </p>

      <h3>Step 3 — Convert intensity into a normalized detection-time probability density</h3>
      <p>
        In this single-photon-in-the-window setup, the photon is guaranteed to be detected somewhere in <span class="eq">0≤t≤T</span>.
        The standard modeling step is:
      </p>
      <div class="eqCard">
        <div class="eq" id="eq4">p(t) = I(t) / ∫₀ᵀ I(t') dt'   ,   with   ∫₀ᵀ p(t) dt = 1.</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eq4">Copy equation</button>
          <span class="copied" id="copied-eq4">Copied ✓</span>
        </div>
      </div>

      <h3>Step 4 — Compute the normalization integral over one beat period <span class="eq">T = 1/Δν</span></h3>
      <p>Compute <span class="eq">∫₀ᵀ I(t)dt</span> using the cosine form:</p>
      <div class="eqCard">
        <div class="eq">
∫₀ᵀ I(t) dt
= ∫₀ᵀ 2I₀[1 + cos(2πΔν t)] dt
= 2I₀ ∫₀ᵀ dt + 2I₀ ∫₀ᵀ cos(2πΔν t) dt.
        </div>
      </div>
      <p>Evaluate each part:</p>
      <div class="eqCard">
        <div class="eq">
2I₀ ∫₀ᵀ dt = 2I₀ T.

2I₀ ∫₀ᵀ cos(2πΔν t) dt
= 2I₀ [ (1/(2πΔν)) sin(2πΔν t) ]₀ᵀ
= (2I₀/(2πΔν)) [sin(2πΔν T) - sin(0)].
        </div>
      </div>
      <p>
        Since <span class="eq">T=1/Δν</span>, we have <span class="eq">2πΔνT = 2π</span>, so <span class="eq">sin(2π)=0</span>.
        Therefore the cosine term contributes zero:
      </p>
      <div class="eqCard">
        <div class="eq">∫₀ᵀ I(t) dt = 2I₀ T.</div>
      </div>
      <p><strong>Interpretation:</strong> over one full beat, the oscillatory part averages away, leaving only the mean intensity.</p>

      <h3>Step 5 — Write the final normalized <span class="eq">p(t)</span></h3>
      <p>Insert into <span class="eq">p(t)=I(t)/(2I₀T)</span>:</p>
      <div class="finalBox">
        <div class="kicker">Final result (part a)</div>
        <div class="eq" id="finalA">p(t) = [1 + cos(2πΔν t)] / T = (2/T) cos²(πΔν t),   0 ≤ t ≤ T,   where Δν = |ν₂−ν₁|.</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="finalA">Copy final (a)</button>
          <span class="copied" id="copied-finalA">Copied ✓</span>
        </div>
      </div>

      <h3>Step 6 — When is the probability density zero?</h3>
      <p>
        Using <span class="eq">p(t)=(2/T)cos²(πΔν t)</span>, we have <span class="eq">p(t)=0</span> exactly when the cosine is zero:
      </p>
      <div class="eqCard">
        <div class="eq">
cos(πΔν t) = 0  ⟺  πΔν t = (π/2) + kπ  ⟺  t = (2k+1)/(2Δν),  for integer k.
        </div>
      </div>
      <p>
        In the interval <span class="eq">0≤t≤T=1/Δν</span>, the only such time is obtained by <span class="eq">k=0</span>:
      </p>
      <div class="finalBox">
        <div class="kicker">Zero-probability instant</div>
        <div class="eq" id="finalZero">t = 1/(2Δν) = T/2.</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="finalZero">Copy zero time</button>
          <span class="copied" id="copied-finalZero">Copied ✓</span>
        </div>
      </div>

      <h3>Sanity checks</h3>
      <ul>
        <li><strong>Units:</strong> <span class="eq">p(t)</span> has units 1/s because it is something divided by <span class="eq">T</span> (seconds). Good.</li>
        <li><strong>Normalization:</strong> <span class="eq">∫₀ᵀ p(t) dt = 1</span> by construction. Good.</li>
        <li><strong>Limiting cases:</strong>
          If <span class="eq">Δν → 0</span> (nearly same frequency), the beat period <span class="eq">T→∞</span> and the oscillation becomes very slow; within a short time window you’d see nearly constant probability.
        </li>
        <li><strong>Physical meaning:</strong> <span class="eq">t=T/2</span> is the time of perfect destructive interference for equal amplitudes and zero relative phase, so a click is impossible at that instant.</li>
      </ul>

      <h3>Part (b) — Why “which constituent wave?” requires high energy precision, and what happens to interference</h3>
      <p>
        The two constituents correspond to two different photon energies:
        <span class="eq">E₁=hν₁</span>, <span class="eq">E₂=hν₂</span>.
        To tell “which wave” the photon came from, the measurement must be able to resolve the energy difference
        <span class="eq">ΔE = |E₂−E₁| = h|ν₂−ν₁| = hΔν</span>.
        That is why the condition
        <span class="eq">σ_E &lt; hΔν</span>
        appears: your uncertainty must be smaller than the separation to reliably discriminate the two cases.
      </p>

      <div class="eqCard">
        <div class="eq" id="eqB1">ΔE = hΔν, so distinguishing ν₁ vs ν₂ requires σ_E ≲ ΔE = hΔν.</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eqB1">Copy key (b)</button>
          <span class="copied" id="copied-eqB1">Copied ✓</span>
        </div>
      </div>

      <p>
        Now connect this to time interference. Any frequency (energy) measurement has an effective observation time <span class="eq">τ</span>:
        to resolve a small frequency split <span class="eq">Δν</span>, you need to “watch” long enough to see enough phase accumulation.
        A standard Fourier-resolution rule of thumb is:
      </p>
      <div class="eqCard">
        <div class="eq" id="eqB2">frequency resolution  Δν_res  ~ 1/τ.</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eqB2">Copy equation</button>
          <span class="copied" id="copied-eqB2">Copied ✓</span>
        </div>
      </div>
      <p>
        Therefore, to distinguish the two frequencies separated by <span class="eq">Δν</span>, you typically need <span class="eq">τ ≳ 1/Δν = T</span>.
        But the interference pattern we are trying to observe <em>also varies on the timescale</em> <span class="eq">T</span>.
        When a measurement extracts which-frequency information (high energy resolution), it effectively destroys the coherence between the two alternatives,
        and the cross term (the cosine) is suppressed. In the extreme “fully distinguishable” limit, the detection-time probability becomes flat:
      </p>
      <div class="eqCard">
        <div class="eq" id="eqB3">If which-frequency info is obtained (coherence lost), then I(t) → I₁ + I₂ (no cosine term), so p(t) → 1/T.</div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eqB3">Copy statement</button>
          <span class="copied" id="copied-eqB3">Copied ✓</span>
        </div>
      </div>
      <p>
        <strong>Plain-language takeaway:</strong> you can have sharp time interference (beating in <span class="eq">p(t)</span>) or you can learn which frequency it was,
        but not both at full strength.
      </p>

      <div class="callouts">
        <div class="callout">
          <div class="tag"><span class="pill"></span>Connection to the diagram & plots</div>
          <p>
            The diagram shows two frequency components arriving at one detector.
            The main plot shows <span class="eq">p(t)</span> over one beat. When the energy-resolution slider is turned toward “which-frequency known,”
            the plotted probability smoothly approaches a flat line (interference erased).
          </p>
        </div>
        <div class="callout">
          <div class="tag"><span class="pill warn"></span>Important nuance</div>
          <p>
            The problem’s <span class="eq">σ_E &lt; hΔν</span> is about <em>distinguishability</em> (can you tell <span class="eq">E₁</span> from <span class="eq">E₂</span>?). The detailed quantitative relation between visibility and measurement strength depends on detector physics.
            In the visualization, we use a simple illustrative complementarity model to show the trend.
          </p>
        </div>
      </div>
    </section>

    <section id="p4">
      <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

      <h3>Re-interpreting the final formula</h3>
      <p>
        The normalized probability density
        <span class="eq">p(t)= [1+cos(2πΔν t)]/T</span>
        tells you three key controls:
      </p>
      <ul>
        <li><strong>Beat frequency difference <span class="eq">Δν</span>:</strong> sets how fast the probability oscillates in time.</li>
        <li><strong>Relative phase (more general case):</strong> a phase offset <span class="eq">φ</span> would shift the oscillation in time:
          <span class="eq">p(t)∝ 1+cos(2πΔν t + φ)</span>.</li>
        <li><strong>Intensity ratio:</strong> if <span class="eq">I₁≠I₂</span>, the modulation depth reduces; minima may no longer reach zero.</li>
      </ul>

      <div class="eqCard">
        <div class="eq" id="eqGen">
General (useful) form:
I(t)=I₁+I₂+2√(I₁I₂) cos(2πΔν t + φ),
p(t)= I(t) / ∫₀ᵀ I(t')dt'.
Visibility V = (I_max - I_min)/(I_max + I_min) = 2√(I₁I₂)/(I₁+I₂).
        </div>
        <div class="copyRow">
          <button class="copyBtn" data-copy-target="eqGen">Copy general set</button>
          <span class="copied" id="copied-eqGen">Copied ✓</span>
        </div>
      </div>

      <h3>How parameters change outcomes (connect to sliders)</h3>
      <ul>
        <li><strong>Increase <span class="eq">Δν</span>:</strong> beat period <span class="eq">T=1/Δν</span> shrinks; oscillations squeeze in time.</li>
        <li><strong>Change intensity ratio <span class="eq">r=I₂/I₁</span>:</strong> visibility becomes
          <span class="eq">V=2√r/(1+r)</span>.
          When <span class="eq">r=1</span>, <span class="eq">V=1</span> and the minimum can reach zero.
        </li>
        <li><strong>Change phase <span class="eq">φ</span>:</strong> shifts where maxima/minima occur, moving the zero-probability point away from <span class="eq">T/2</span> if <span class="eq">φ≠0</span>.</li>
        <li><strong>Energy-resolution knob (which-frequency info):</strong> as <span class="eq">σ_E/(hΔν)</span> becomes small (good resolution), interference is suppressed and <span class="eq">p(t)</span> tends toward <span class="eq">1/T</span>.</li>
      </ul>

      <h3>Alternative derivation idea (brief)</h3>
      <p>
        Instead of starting from classical intensity, you can write a two-frequency quantum state
        <span class="eq">|ψ⟩ = (|ν₁⟩ + |ν₂⟩)/√2</span>.
        The detection amplitude at time <span class="eq">t</span> contains phase factors <span class="eq">e^{-j2πνt}</span>,
        so <span class="eq">ψ(t) ∝ e^{-j2πν₁ t} + e^{-j2πν₂ t}</span>,
        and the probability is <span class="eq">|ψ(t)|² ∝ 1+cos(2πΔν t)</span>, matching the result after normalization.
      </p>

      <h3>Concept checks (self-test)</h3>
      <ul>
        <li><strong>Q:</strong> If <span class="eq">I₂→0</span>, what happens to beating? <strong>A:</strong> The cosine term vanishes, <span class="eq">p(t)</span> becomes uniform (no interference with only one component).</li>
        <li><strong>Q:</strong> Why can <span class="eq">p(t)</span> be zero at an instant? <strong>A:</strong> Equal-amplitude destructive interference makes <span class="eq">I(t)=0</span>, and detection rate ∝ intensity.</li>
        <li><strong>Q:</strong> If you randomize the relative phase from trial to trial, what do you observe? <strong>A:</strong> The averaged <span class="eq">cos</span> term cancels and <span class="eq">p(t)→1/T</span>.</li>
        <li><strong>Q:</strong> What does <span class="eq">σ_E &lt; hΔν</span> physically mean? <strong>A:</strong> Your measurement can resolve the two photon energies, providing which-frequency information and reducing interference.</li>
      </ul>
    </section>

    <section id="p5">
      <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>

      <div class="vizGrid">
        <div class="canvasCard">
          <div class="canvasTitle">
            <div class="t">Diagram: two-frequency illumination</div>
            <div class="hint">Shows geometry + labels</div>
          </div>
          <canvas id="cDiagram" class="diagram" aria-label="Diagram canvas"></canvas>
        </div>

        <div class="vizRow">
          <div class="canvasCard">
            <div class="canvasTitle">
              <div class="t">Main plot: detection-time probability density p(t)</div>
              <div class="hint">0 ≤ t ≤ T = 1/Δν</div>
            </div>
            <canvas id="cMain" aria-label="Main plot canvas"></canvas>
          </div>

          <div class="canvasCard">
            <div class="canvasTitle">
              <div class="t">Secondary plot: visibility & distinguishability vs energy resolution</div>
              <div class="hint">Illustrative complementarity model</div>
            </div>
            <canvas id="cSecondary" class="small" aria-label="Secondary plot canvas"></canvas>
          </div>
        </div>

        <div class="controls" role="group" aria-label="Interactive controls">
          <div class="ctrl">
            <label>
              <span>Beat frequency difference Δν (MHz)</span>
              <span class="val" id="valDnu">5.00</span>
            </label>
            <input id="slDnu" type="range" min="0.5" max="20" step="0.1" value="5.0"/>
            <div class="note">Changes the beat period <span class="eq">T = 1/Δν</span> and rescales the time axis.</div>
          </div>

          <div class="ctrl">
            <label>
              <span>Intensity ratio r = I₂ / I₁</span>
              <span class="val" id="valR">1.00</span>
            </label>
            <input id="slR" type="range" min="0.05" max="3" step="0.01" value="1.0"/>
            <div class="note">Controls classical visibility <span class="eq">V = 2√r/(1+r)</span>. Only when r=1 can the minimum reach zero.</div>
          </div>

          <div class="ctrl">
            <label>
              <span>Relative phase φ (rad)</span>
              <span class="val" id="valPhi">0.00</span>
            </label>
            <input id="slPhi" type="range" min="0" max="6.283185307" step="0.01" value="0"/>
            <div class="note">Shifts the beat in time: <span class="eq">cos(2πΔν t + φ)</span>.</div>
          </div>

          <div class="ctrl">
            <label>
              <span>Energy resolution factor k = σ_E / (hΔν)</span>
              <span class="val" id="valK">5.00</span>
            </label>
            <input id="slK" type="range" min="0.05" max="8" step="0.01" value="5.0"/>
            <div class="note">
              Small k → good energy resolution (which-frequency info) → interference suppressed → <span class="eq">p(t)</span> flattens.
              Large k → poor energy resolution → interference survives.
            </div>
          </div>
        </div>

        <div class="callouts">
          <div class="callout">
            <div class="tag"><span class="pill"></span>What each canvas shows</div>
            <ul>
              <li><strong>Diagram:</strong> two collinear plane waves with frequencies <span class="eq">ν₁</span>, <span class="eq">ν₂</span> impinging on a detector; beat period labeled.</li>
              <li><strong>Main plot:</strong> normalized <span class="eq">p(t)</span> over one beat window <span class="eq">[0,T]</span>.</li>
              <li><strong>Secondary plot:</strong> classical visibility <span class="eq">V</span> and an illustrative distinguishability curve <span class="eq">D</span> vs <span class="eq">k=σ_E/(hΔν)</span>.</li>
            </ul>
          </div>
          <div class="callout">
            <div class="tag"><span class="pill warn"></span>How sliders affect all plots</div>
            <ul>
              <li><span class="eq">Δν</span> rescales time and changes where oscillations sit.</li>
              <li><span class="eq">r</span> changes fringe depth (minima lift above zero if <span class="eq">r≠1</span>).</li>
              <li><span class="eq">φ</span> shifts the location of the minimum/maximum (time origin shift).</li>
              <li><span class="eq">k</span> suppresses the interference term, moving from oscillatory to flat probability.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<footer>
  <p>
    This article used the problem’s stated intensity formula and the standard single-photon photodetection assumption
    that detection probability density is proportional to intensity and then normalized over the given window.
    The complementarity curve in the secondary plot is an illustrative model (trend-correct), not a unique law of nature.
  </p>
</footer>

<script>
/* ---------- Utilities ---------- */
function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

function copyTextFromElement(id, copiedId){
  const el = document.getElementById(id);
  const text = el ? el.textContent.trim() : "";
  if(!text) return;
  navigator.clipboard.writeText(text).then(()=>{
    const c = document.getElementById(copiedId);
    if(c){
      c.classList.add('show');
      setTimeout(()=>c.classList.remove('show'), 900);
    }
  }).catch(()=>{});
}

document.querySelectorAll('.copyBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const target = btn.getAttribute('data-copy-target');
    const copiedId = 'copied-' + target;
    copyTextFromElement(target, copiedId);
  });
});

/* ---------- Model (physics) ---------- */
/*
We allow more general parameters for visualization:
I(t) = I1 + I2 + 2 sqrt(I1 I2) * Veff * cos(2π Δν t + φ)
where Veff = V_classical * S(k), S(k) is a suppression factor depending on energy resolution.
- Classical visibility V_classical = 2 sqrt(r)/(1+r), with r=I2/I1
- Suppression S(k): k = σ_E/(hΔν). Small k => strong which-frequency => suppress interference => S→0.
  We'll use S(k) = k / sqrt(1 + k^2). (Trend-correct, simple, smooth.)
Then p(t) = I(t) / ∫_0^T I(t) dt with T = 1/Δν.
Over exactly one period, integral of cos term is 0, so normalization is (I1+I2)T.
Thus p(t) = [1 + (2 sqrt(I1 I2)/(I1+I2)) S(k) cos(...)] / T
         = [1 + V_classical S(k) cos(2π t/T + φ)] / T, with t in [0,T].
We set I1=1, I2=r for convenience.
*/

function Vclassical(r){
  const sr = Math.sqrt(r);
  return (2*sr)/(1+r);
}

function suppression(k){
  // k = σE/(hΔν)
  // small k -> 0, large k -> 1
  return k / Math.sqrt(1 + k*k);
}

function distinguishability(k){
  // complementary illustrative curve: small k => D~1, large k=>0
  return 1 / Math.sqrt(1 + k*k);
}

function pOfT(t, T, r, phi, k){
  const V = Vclassical(r);
  const S = suppression(k);
  // normalized over [0,T]
  const val = (1 + V*S*Math.cos(2*Math.PI*t/T + phi)) / T;
  return Math.max(0, val); // guard against tiny negatives from rounding
}

/* ---------- Canvas plotting ---------- */
function setupCanvas(canvas){
  const ctx = canvas.getContext('2d');
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    const w = Math.max(320, rect.width);
    const h = rect.height;
    canvas.width = Math.round(w * dpr);
    canvas.height = Math.round(h * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    return {w, h, dpr};
  }
  return {ctx, resize};
}

function drawAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel, title, ticksX=6, ticksY=5){
  const {x,y,w,h} = box;

  // Background
  ctx.save();
  ctx.fillStyle = 'rgba(9,14,29,0.25)';
  ctx.fillRect(x,y,w,h);

  // Title
  ctx.fillStyle = 'rgba(255,255,255,0.88)';
  ctx.font = '600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText(title, x+10, y+18);

  // Plot area
  const padL=56, padR=18, padT=30, padB=48;
  const px = x + padL, py = y + padT, pw = w - padL - padR, ph = h - padT - padB;

  // Gridlines
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 1;

  for(let i=0;i<=ticksX;i++){
    const gx = px + pw*(i/ticksX);
    ctx.beginPath(); ctx.moveTo(gx, py); ctx.lineTo(gx, py+ph); ctx.stroke();
  }
  for(let j=0;j<=ticksY;j++){
    const gy = py + ph*(j/ticksY);
    ctx.beginPath(); ctx.moveTo(px, gy); ctx.lineTo(px+pw, gy); ctx.stroke();
  }

  // Axes border
  ctx.strokeStyle = 'rgba(255,255,255,0.18)';
  ctx.strokeRect(px,py,pw,ph);

  // Ticks + labels
  ctx.fillStyle = 'rgba(255,255,255,0.72)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';

  function fmt(v){
    const av = Math.abs(v);
    if(av >= 1000) return v.toFixed(0);
    if(av >= 10) return v.toFixed(2);
    if(av >= 1) return v.toFixed(3);
    return v.toFixed(4);
  }

  for(let i=0;i<=ticksX;i++){
    const t = i/ticksX;
    const gx = px + pw*t;
    const v = xMin + (xMax-xMin)*t;
    ctx.beginPath();
    ctx.moveTo(gx, py+ph);
    ctx.lineTo(gx, py+ph+5);
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.stroke();
    ctx.fillText(fmt(v), gx-10, py+ph+18);
  }

  for(let j=0;j<=ticksY;j++){
    const t = 1 - j/ticksY;
    const gy = py + ph*(j/ticksY);
    const v = yMin + (yMax-yMin)*t;
    ctx.beginPath();
    ctx.moveTo(px-5, gy);
    ctx.lineTo(px, gy);
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.stroke();
    ctx.fillText(fmt(v), x+8, gy+4);
  }

  // Axis labels
  ctx.fillStyle = 'rgba(255,255,255,0.78)';
  ctx.font = '600 12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText(xLabel, px + pw/2 - ctx.measureText(xLabel).width/2, py+ph+40);

  ctx.save();
  ctx.translate(x+16, py + ph/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yLabel, 0 - ctx.measureText(yLabel).width/2, 0);
  ctx.restore();

  ctx.restore();

  function xToPx(v){ return px + (v-xMin)/(xMax-xMin)*pw; }
  function yToPx(v){ return py + (1-(v-yMin)/(yMax-yMin))*ph; }

  return {px,py,pw,ph, xToPx, yToPx};
}

function strokePath(ctx, points, strokeStyle, lineWidth=2){
  if(points.length<2) return;
  ctx.save();
  ctx.strokeStyle = strokeStyle;
  ctx.lineWidth = lineWidth;
  ctx.lineJoin = 'round';
  ctx.lineCap = 'round';
  ctx.beginPath();
  ctx.moveTo(points[0].x, points[0].y);
  for(let i=1;i<points.length;i++) ctx.lineTo(points[i].x, points[i].y);
  ctx.stroke();
  ctx.restore();
}

function drawLegend(ctx, x, y, items){
  // items: [{label, color}]
  ctx.save();
  const pad=10;
  const lineH=16;
  ctx.font = '12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  let w=0;
  items.forEach(it=> w = Math.max(w, ctx.measureText(it.label).width));
  const boxW = w + 62;
  const boxH = pad*2 + items.length*lineH;
  ctx.fillStyle = 'rgba(0,0,0,0.22)';
  ctx.strokeStyle = 'rgba(255,255,255,0.14)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.roundRect(x, y, boxW, boxH, 12);
  ctx.fill();
  ctx.stroke();

  items.forEach((it, idx)=>{
    const yy = y + pad + idx*lineH + 10;
    ctx.strokeStyle = it.color;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(x+12, yy-4);
    ctx.lineTo(x+34, yy-4);
    ctx.stroke();
    ctx.fillStyle = 'rgba(255,255,255,0.86)';
    ctx.fillText(it.label, x+40, yy);
  });

  ctx.restore();
}

// Polyfill for roundRect (older browsers)
if (!CanvasRenderingContext2D.prototype.roundRect) {
  CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r){
    const rr = Math.min(r, w/2, h/2);
    this.beginPath();
    this.moveTo(x+rr, y);
    this.arcTo(x+w, y, x+w, y+h, rr);
    this.arcTo(x+w, y+h, x, y+h, rr);
    this.arcTo(x, y+h, x, y, rr);
    this.arcTo(x, y, x+w, y, rr);
    this.closePath();
    return this;
  };
}

/* ---------- Draw diagram ---------- */
function drawDiagram(ctx, W, H, params){
  ctx.clearRect(0,0,W,H);

  // Panel
  ctx.save();
  ctx.fillStyle = 'rgba(9,14,29,0.35)';
  ctx.fillRect(0,0,W,H);

  // Title
  ctx.fillStyle = 'rgba(255,255,255,0.88)';
  ctx.font = '600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('Two coherent frequency components illuminate one detector', 12, 18);

  const midY = H*0.55;
  const detX = W*0.78;

  // Detector block
  ctx.fillStyle = 'rgba(255,255,255,0.08)';
  ctx.strokeStyle = 'rgba(118,183,255,0.35)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.roundRect(detX, midY-65, 90, 130, 18);
  ctx.fill(); ctx.stroke();

  ctx.fillStyle = 'rgba(255,255,255,0.82)';
  ctx.font = '700 12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('Detector', detX+16, midY-75);

  // Incoming waves arrows
  function drawWave(y0, color, label){
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.3;

    // wavy line
    ctx.beginPath();
    const x0 = W*0.08, x1 = detX;
    const A = 10;
    const k = 2*Math.PI / 46;
    for(let x=x0; x<=x1; x+=2){
      const yy = y0 + A*Math.sin(k*(x-x0));
      if(x===x0) ctx.moveTo(x,yy);
      else ctx.lineTo(x,yy);
    }
    ctx.stroke();

    // arrow head
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(detX, y0);
    ctx.lineTo(detX-12, y0-7);
    ctx.lineTo(detX-12, y0+7);
    ctx.closePath();
    ctx.fill();

    ctx.fillStyle = 'rgba(255,255,255,0.84)';
    ctx.font = '12.5px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
    ctx.fillText(label, W*0.10, y0-16);
  }

  drawWave(midY-30, 'rgba(118,183,255,0.95)', 'U₁(t)=√I₁ e^{j2πν₁ t}');
  drawWave(midY+30, 'rgba(125,255,191,0.95)', 'U₂(t)=√I₂ e^{j2πν₂ t}');

  // Beat label
  const dnuMHz = params.dnuMHz;
  const Tns = (1/(dnuMHz*1e6))*1e9;
  ctx.fillStyle = 'rgba(255,255,255,0.74)';
  ctx.font = '600 12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  const beatText = `Beat period: T = 1/Δν = ${Tns.toFixed(1)} ns (example, from Δν slider)`;
  ctx.fillText(beatText, 12, H-16);

  // Small note about p(t)
  ctx.fillStyle = 'rgba(185,196,230,0.88)';
  ctx.font = '12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial';
  ctx.fillText('Single-photon regime: click-time PDF p(t) ∝ I(t)', 12, 38);

  ctx.restore();
}

/* ---------- Draw main plot p(t) ---------- */
function drawMainPlot(ctx, W, H, params){
  ctx.clearRect(0,0,W,H);

  const dnu = params.dnuMHz * 1e6; // Hz
  const T = 1/dnu;                // s
  const r = params.r;
  const phi = params.phi;
  const k = params.k;

  // y-range: p(t) ranges from (1 - V*S)/T to (1 + V*S)/T.
  const V = Vclassical(r);
  const S = suppression(k);
  const pMin = (1 - V*S)/T;
  const pMax = (1 + V*S)/T;

  // Make a nice y-span
  const yMin = Math.max(0, pMin - 0.12*(pMax-pMin));
  const yMax = pMax + 0.18*(pMax-pMin);

  const ax = drawAxes(
    ctx,
    {x:0,y:0,w:W,h:H},
    0, T*1e9,  // x in ns
    yMin*1e-9, yMax*1e-9, // scale so y axis shows 1/ns (since p has 1/s)
    't (ns)',
    'p(t) (1/ns)',
    'Detection-time probability density over one beat period'
  );

  // Plot p(t)
  const N = 600;
  const pts = [];
  for(let i=0;i<=N;i++){
    const t = T*i/N;
    const p = pOfT(t,T,r,phi,k);
    pts.push({x: ax.xToPx(t*1e9), y: ax.yToPx(p*1e-9)});
  }
  strokePath(ctx, pts, 'rgba(118,183,255,0.95)', 2.6);

  // Plot "flat" reference 1/T when interference erased
  const pFlat = (1/T);
  const yFlat = ax.yToPx(pFlat*1e-9);
  ctx.save();
  ctx.strokeStyle = 'rgba(255,204,102,0.85)';
  ctx.setLineDash([6,5]);
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(ax.px, yFlat);
  ctx.lineTo(ax.px+ax.pw, yFlat);
  ctx.stroke();
  ctx.restore();

  // Mark predicted zero (if any) within [0,T]
  // Zero exists only if V*S >= 1 and phi aligns so minimum hits 0.
  // In our normalized model p(t) reaches zero if 1 + V*S cos(...) = 0 has solution with cos=-1 and V*S=1.
  // For equal intensities r=1 and S=1, this happens; with phi=0 the zero is at t=T/2.
  ctx.save();
  const VS = V*S;
  if(Math.abs(VS-1) < 1e-3){
    // Solve for t where cos(2π t/T + phi) = -1 => 2π t/T + phi = π + 2πm
    // choose m so t in [0,T]
    let t0 = ((Math.PI - phi) / (2*Math.PI)) * T;
    // Wrap to [0,T)
    t0 = ((t0 % T) + T) % T;
    const x0 = ax.xToPx(t0*1e9);
    const y0 = ax.yToPx(0);
    ctx.strokeStyle = 'rgba(125,255,191,0.95)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0, ax.py);
    ctx.lineTo(x0, ax.py+ax.ph);
    ctx.stroke();

    ctx.fillStyle = 'rgba(125,255,191,0.95)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
    const label = `p(t)=0 at t≈${(t0*1e9).toFixed(2)} ns`;
    ctx.fillText(label, clamp(x0-60, ax.px+6, ax.px+ax.pw-180), ax.py+18);
  }
  ctx.restore();

  // Legend
  drawLegend(ctx, ax.px+10, ax.py+10, [
    {label:'p(t) (with interference)', color:'rgba(118,183,255,0.95)'},
    {label:'1/T (no interference)', color:'rgba(255,204,102,0.85)'}
  ]);

  // Annotation: show V and S
  ctx.save();
  ctx.fillStyle = 'rgba(255,255,255,0.78)';
  ctx.font = '12.5px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
  const txt = `V=2√r/(1+r)=${V.toFixed(3)}   S(k)=${S.toFixed(3)}   V_eff=V·S=${(V*S).toFixed(3)}`;
  ctx.fillText(txt, ax.px+10, ax.py+ax.ph+30);
  ctx.restore();
}

/* ---------- Draw secondary plot (V_eff and D vs k) ---------- */
function drawSecondaryPlot(ctx, W, H, params){
  ctx.clearRect(0,0,W,H);

  const r = params.r;
  const V = Vclassical(r);

  const kMin = 0;
  const kMax = 8;

  // y from 0 to 1
  const ax = drawAxes(
    ctx,
    {x:0,y:0,w:W,h:H},
    kMin, kMax,
    0, 1.05,
    'k = σ_E/(hΔν) (dimensionless)',
    'Value (0..1)',
    'Visibility vs which-frequency information (illustrative)'
  );

  const N = 500;
  const ptsVeff = [];
  const ptsD = [];
  for(let i=0;i<=N;i++){
    const k = kMax*i/N;
    const S = suppression(k);
    const De = distinguishability(k);
    const Veff = V * S;

    ptsVeff.push({x: ax.xToPx(k), y: ax.yToPx(Veff)});
    ptsD.push({x: ax.xToPx(k), y: ax.yToPx(De)});
  }

  strokePath(ctx, ptsVeff, 'rgba(118,183,255,0.95)', 2.6);
  strokePath(ctx, ptsD, 'rgba(255,107,122,0.90)', 2.4);

  // Marker at current k
  const kNow = params.k;
  const SNow = suppression(kNow);
  const DNow = distinguishability(kNow);
  const VeffNow = V * SNow;

  const xNow = ax.xToPx(kNow);
  ctx.save();
  ctx.fillStyle = 'rgba(255,255,255,0.85)';
  ctx.strokeStyle = 'rgba(255,255,255,0.22)';
  ctx.lineWidth = 1.5;

  // vertical line
  ctx.beginPath();
  ctx.moveTo(xNow, ax.py);
  ctx.lineTo(xNow, ax.py+ax.ph);
  ctx.stroke();

  // points
  function dot(x,y,color){
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x,y,4.6,0,2*Math.PI);
    ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,0.35)';
    ctx.stroke();
  }
  dot(xNow, ax.yToPx(VeffNow), 'rgba(118,183,255,0.95)');
  dot(xNow, ax.yToPx(DNow), 'rgba(255,107,122,0.90)');

  // legend
  drawLegend(ctx, ax.px+10, ax.py+10, [
    {label:`V_eff = V·S(k) (here V=${V.toFixed(3)})`, color:'rgba(118,183,255,0.95)'},
    {label:'D(k) (distinguishability)', color:'rgba(255,107,122,0.90)'}
  ]);

  // annotation text
  ctx.fillStyle = 'rgba(255,255,255,0.78)';
  ctx.font = '12.5px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
  const note = `At k=${kNow.toFixed(2)}:  V_eff=${VeffNow.toFixed(3)}   D=${DNow.toFixed(3)}`;
  ctx.fillText(note, ax.px+10, ax.py+ax.ph+30);

  ctx.restore();
}

/* ---------- Wiring & live update ---------- */
const cDiagram = document.getElementById('cDiagram');
const cMain = document.getElementById('cMain');
const cSecondary = document.getElementById('cSecondary');

const d1 = setupCanvas(cDiagram);
const d2 = setupCanvas(cMain);
const d3 = setupCanvas(cSecondary);

const slDnu = document.getElementById('slDnu');
const slR = document.getElementById('slR');
const slPhi = document.getElementById('slPhi');
const slK = document.getElementById('slK');

const valDnu = document.getElementById('valDnu');
const valR = document.getElementById('valR');
const valPhi = document.getElementById('valPhi');
const valK = document.getElementById('valK');

function getParams(){
  return {
    dnuMHz: parseFloat(slDnu.value),
    r: parseFloat(slR.value),
    phi: parseFloat(slPhi.value),
    k: parseFloat(slK.value)
  };
}

function render(){
  const p = getParams();
  valDnu.textContent = p.dnuMHz.toFixed(2);
  valR.textContent = p.r.toFixed(2);
  valPhi.textContent = p.phi.toFixed(2);
  valK.textContent = p.k.toFixed(2);

  const r1 = d1.resize();
  const r2 = d2.resize();
  const r3 = d3.resize();

  drawDiagram(d1.ctx, r1.w, r1.h, p);
  drawMainPlot(d2.ctx, r2.w, r2.h, p);
  drawSecondaryPlot(d3.ctx, r3.w, r3.h, p);
}

[slDnu, slR, slPhi, slK].forEach(el=>{
  el.addEventListener('input', render);
});

window.addEventListener('resize', ()=>{
  // debounce a bit
  clearTimeout(window.__rz);
  window.__rz = setTimeout(render, 80);
});

render();
</script>
</body>
</html>
