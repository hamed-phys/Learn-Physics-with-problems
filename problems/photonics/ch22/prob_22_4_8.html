<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Degenerate Parametric Downconverter (Ï‡Â²): Coupled-Wave Equations, Photon Flux, and Conversion Efficiency</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1724;
      --panel2:#0c1422;
      --text:#eaf0ff;
      --muted:#b8c2dd;
      --faint:#7f8bb0;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.14);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --warn:#fde68a;
      --bad:#fda4af;
      --shadow: 0 18px 45px rgba(0,0,0,.45);
      --radius:16px;
      --radius2:22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(125,211,252,.12), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(167,139,250,.10), transparent 55%),
        radial-gradient(900px 600px at 45% 90%, rgba(134,239,172,.08), transparent 60%),
        linear-gradient(180deg, #070a10 0%, #0b0f17 30%, #080b12 100%);
      color:var(--text);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:28px 18px 18px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.03), transparent);
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0 14px 40px;
    }
    .title{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      align-items:end;
    }
    h1{
      margin:0;
      font-size: clamp(1.45rem, 2.2vw, 2.15rem);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:.35rem 0 0;
      color:var(--muted);
      max-width:70ch;
      font-size: clamp(.98rem, 1.2vw, 1.05rem);
    }
    .badgeRow{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      padding:8px 10px;
      border:1px solid var(--line2);
      border-radius:999px;
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:.85rem;
      backdrop-filter: blur(6px);
    }
    main{
      padding-top:18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      align-items:start;
    }

    nav.toc{
      position:sticky;
      top:12px;
      padding:14px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    nav.toc h2{
      margin:0 0 8px;
      font-size:1.02rem;
      color:var(--text);
      letter-spacing:.2px;
    }
    nav.toc ol{
      margin:0;
      padding:0 0 0 18px;
      color:var(--muted);
    }
    nav.toc li{margin:6px 0}
    nav.toc a{color:var(--muted)}
    nav.toc a:hover{color:var(--text)}
    .topLink{
      display:inline-flex;
      margin-top:10px;
      gap:8px;
      align-items:center;
      color:var(--faint);
      font-size:.9rem;
      padding:8px 10px;
      border-radius:999px;
      border:1px dashed rgba(255,255,255,.15);
      background:rgba(255,255,255,.02);
    }
    .topLink:hover{color:var(--text); border-style:solid; text-decoration:none}

    article{
      padding:18px;
      border-radius:var(--radius2);
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.018));
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    section{
      margin-top:18px;
      padding-top:4px;
    }
    section:first-child{margin-top:0}
    h2{
      margin:10px 0 8px;
      font-size:1.25rem;
      letter-spacing:.2px;
    }
    h3{
      margin:14px 0 8px;
      font-size:1.05rem;
      color:var(--text);
      letter-spacing:.15px;
    }
    p{margin:8px 0; color:var(--text)}
    .muted{color:var(--muted)}
    .small{font-size:.93rem; color:var(--muted)}
    ul,ol{color:var(--muted)}
    li{margin:6px 0}

    .cards{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      margin-top:10px;
    }
    .card{
      grid-column: span 12;
      border:1px solid var(--line);
      background:rgba(0,0,0,.15);
      border-radius:var(--radius);
      padding:12px 12px 10px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px -2px auto -2px;
      height:3px;
      background:linear-gradient(90deg, transparent, rgba(125,211,252,.9), rgba(167,139,250,.9), transparent);
      opacity:.55;
      transform: translateX(-25%);
      animation: shimmer 6s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{transform:translateX(-35%); opacity:.25}
      50%{transform:translateX(35%); opacity:.55}
      100%{transform:translateX(-35%); opacity:.25}
    }
    .card h4{
      margin:0 0 6px;
      font-size:.98rem;
      color:var(--text);
    }
    .card p{margin:6px 0; color:var(--muted)}
    .card .tag{
      display:inline-block;
      margin-top:8px;
      font-size:.8rem;
      color:var(--text);
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
    }
    .assumptions{border-left:3px solid rgba(125,211,252,.75)}
    .keyeq{border-left:3px solid rgba(167,139,250,.75)}
    .mistakes{border-left:3px solid rgba(253,230,138,.75)}
    .final{border-left:3px solid rgba(134,239,172,.75)}

    .eqBlock{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(0,0,0,.18);
      margin:10px 0;
    }
    .eqRow{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    pre.eq{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      color:var(--text);
      font-family:var(--mono);
      font-size:.95rem;
      line-height:1.45;
      flex: 1 1 520px;
      padding-right:6px;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.04);
      color:var(--text);
      border-radius:12px;
      padding:10px 10px;
      font-size:.88rem;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      flex: 0 0 auto;
    }
    .btn:hover{background:rgba(255,255,255,.07); border-color:rgba(255,255,255,.26)}
    .btn:active{transform: translateY(1px)}
    .btn.ok{border-color: rgba(134,239,172,.35)}
    .toast{
      display:inline-block;
      margin-left:8px;
      font-size:.85rem;
      color:var(--good);
      opacity:0;
      transform: translateY(2px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{opacity:1; transform: translateY(0)}
    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(0,0,0,.14);
      padding:10px 12px;
      margin:10px 0;
    }
    details summary{
      cursor:pointer;
      color:var(--text);
      font-weight:600;
      list-style:none;
    }
    details summary::-webkit-details-marker{display:none}
    details summary::before{
      content:"â–¸";
      display:inline-block;
      margin-right:8px;
      color:var(--muted);
      transform: translateY(-1px);
      transition: transform .15s ease;
    }
    details[open] summary::before{transform: rotate(90deg) translateY(-1px)}
    .hr{
      height:1px; background:var(--line); margin:14px 0;
    }

    figure{
      margin:12px 0 0;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:rgba(0,0,0,.18);
      padding:10px;
      overflow:hidden;
    }
    figure figcaption{
      margin-top:8px;
      color:var(--muted);
      font-size:.9rem;
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius:12px;
      background:rgba(255,255,255,.02);
    }

    footer{
      margin-top:16px;
      padding:14px 0 10px;
      color:var(--faint);
      font-size:.92rem;
      border-top:1px solid var(--line);
    }

    .twoCol{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:.85rem;
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background:var(--accent);
      box-shadow: 0 0 0 3px rgba(125,211,252,.12);
    }
    .dot.v{background:var(--accent2); box-shadow: 0 0 0 3px rgba(167,139,250,.12)}
    .dot.g{background:var(--good); box-shadow: 0 0 0 3px rgba(134,239,172,.12)}

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      nav.toc{position:relative; top:auto}
      .title{grid-template-columns:1fr}
      .badgeRow{justify-content:flex-start}
      .twoCol{grid-template-columns:1fr}
    }

    @media print{
      body{background:#fff; color:#000}
      header, nav.toc{display:none !important}
      article{box-shadow:none; background:#fff; border:1px solid #000}
      .card, .eqBlock, details, figure{background:#fff; border:1px solid #000}
      a{color:#000; text-decoration:underline}
      .card::before{display:none}
      .btn, .toast{display:none !important}
      section{break-inside:avoid}
      h2{break-after:avoid}
      figure{break-inside:avoid}
    }
  </style>
</head>

<body>
  <header id="top">
    <div class="wrap">
      <div class="title">
        <div>
          <h1>Degenerate Parametric Downconverter (Ï‡Â²): Coupled-Wave Equations, Photon Flux Densities, and Conversion Efficiency</h1>
          <p class="subtitle">
            Pump at <b>Ï‰<sub>3</sub> = 2Ï‰</b> mixes with two degenerate waves at <b>Ï‰<sub>1</sub> = Ï‰<sub>2</sub> = Ï‰</b>.
            We derive the <i>coupled amplitude equations</i>, obtain <i>closed-form photon-flux evolution</i> for length <b>L</b>,
            and verify <i>energy</i> + <i>photon (Manleyâ€“Rowe)</i> conservation.
          </p>
        </div>
        <div class="badgeRow">
          <span class="badge">Plane waves Â· +z propagation</span>
          <span class="badge">Lossless Ï‡Â² medium</span>
          <span class="badge">Degenerate: 2Ï‰ â†” Ï‰ + Ï‰</span>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <nav class="toc" aria-label="Table of contents">
        <h2>Table of Contents</h2>
        <ol>
          <li><a href="#qs">Quick Summary</a></li>
          <li><a href="#p0">PART 0 â€” Concept Primer</a></li>
          <li><a href="#p1">PART 1 â€” Problem Analysis</a></li>
          <li><a href="#p2">PART 2 â€” Strategy & Tips</a></li>
          <li><a href="#p3">PART 3 â€” Full Solution</a></li>
          <li><a href="#p4">PART 4 â€” Deeper Understanding</a></li>
          <li><a href="#p5">PART 5 â€” Optional Plot Guide</a></li>
        </ol>
        <a class="topLink" href="#top" title="Back to top">â†‘ Back to top</a>
      </nav>

      <article>
        <!-- Quick Summary -->
        <section id="qs">
          <h2>Quick Summary</h2>
          <ul>
            <li><b>What this is:</b> a <b>degenerate</b> Ï‡Â² three-wave mixing process where a <b>pump photon at 2Ï‰</b> converts into <b>two photons at Ï‰</b> (and vice versa).</li>
            <li><b>Key physics idea:</b> nonlinear polarization at each frequency acts as a <b>source term</b> that couples the slowly varying field envelopes.</li>
            <li><b>Governing equations:</b> coupled first-order ODEs for complex envelopes (or photon-flux-normalized amplitudes), including phase-mismatch <b>Î”k = k<sub>3</sub> âˆ’ 2k</b>.</li>
            <li><b>What we compute:</b> <b>photon-flux densities</b> (photonsÂ·m<sup>âˆ’2</sup>Â·s<sup>âˆ’1</sup>) at <b>2Ï‰</b> and <b>Ï‰</b> after a length <b>L</b>.</li>
            <li><b>Main result type:</b> symbolic, closed-form <b>pump depletion solution</b> for <b>Î”k = 0</b> (phase matched), parameterized by a coupling constant <b>g</b>.</li>
            <li><b>Conversion efficiency:</b> can be defined as <b>energy</b> (power) fraction in Ï‰ at z=L, or as <b>pump photon depletion</b>; both follow directly from the photon-flux solutions.</li>
            <li><b>Conservation laws:</b> we verify <b>energy conservation</b> and <b>Manleyâ€“Rowe photon relations</b>: one pump photon â†” two signal photons.</li>
            <li><b>Physical meaning:</b> for a seeded Ï‰ wave, energy transfers from 2Ï‰ to Ï‰ as z increases; the Ï‰ photon flux can grow dramatically while the 2Ï‰ photon flux depletes, constrained by invariants.</li>
          </ul>
        </section>

        <div class="cards">
          <div class="card assumptions">
            <h4>Assumptions used (so the math matches the physics)</h4>
            <p>
              Lossless, dispersion included only through refractive indices; plane waves; slowly varying envelopes (SVEA);
              co-propagating along +z; Ï‡Â² interaction with effective coefficient d<sub>eff</sub>; optional phase mismatch Î”k.
              For closed-form photon-flux formulas we will specialize to <b>Î”k = 0</b> and choose the <b>optimal relative phase</b>
              that maximizes downconversion.
            </p>
            <span class="tag">SVEA Â· plane wave Â· lossless Â· Î”k=0 for closed-form</span>
          </div>
        </div>

        <!-- PART 0 -->
        <section id="p0">
          <h2>PART 0 â€” Concept Primer (Theory before solving)</h2>

          <h3>0.1 Core definitions (symbols + SI units)</h3>
          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-defs">Frequencies:
  Pump:    Ï‰3 = 2Ï‰     (rad/s)
  Signals: Ï‰1 = Ï‰2 = Ï‰ (rad/s)   (degenerate)

Wavenumbers (in medium):
  k3 = n(2Ï‰) (2Ï‰)/c  (rad/m)
  k  = n(Ï‰)  (Ï‰)/c   (rad/m)
Phase mismatch:
  Î”k = k3 âˆ’ 2k       (rad/m)

Fields (complex envelopes, SVEA, co-propagating):
  E(z,t)  = Â½ [ ğ“”(z)  e^{i(k z âˆ’ Ï‰ t)}   + c.c. ]   at Ï‰
  Ep(z,t) = Â½ [ ğ“”p(z) e^{i(k3 z âˆ’ 2Ï‰ t)} + c.c. ]   at 2Ï‰

Photon-flux density (photonsÂ·mâ»Â²Â·sâ»Â¹):
  Î¦j = Ij / (Ä§ Ï‰j), where Ij is intensity (W/mÂ²) at Ï‰j.

Convenient photon-flux-normalized amplitudes:
  aj â‰¡ âˆšÎ¦j Â· e^{iÎ¸j}  so that |aj|Â² = Î¦j.</pre>
              <div>
                <button class="btn" data-copy="#eq-defs">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <h3>0.2 Physical meaning (intuition)</h3>
          <p class="muted">
            In a Ï‡Â² medium, the polarization includes a term quadratic in the electric field: P<sup>(2)</sup> âˆ Ï‡Â² EÂ².
            When you multiply oscillations, you generate new frequencies:
            <b>two Ï‰ fields multiply to make 2Ï‰</b> (second-harmonic generation), and conversely a 2Ï‰ field can <b>drive a pair at Ï‰</b>
            (degenerate parametric downconversion).
          </p>
          <p class="muted">
            The key subtlety is <b>phase</b>: energy transfer depends on relative phases of the interacting waves and on phase matching (Î”k).
            When the nonlinear â€œsourceâ€ stays in phase with the generated wave (Î”k â‰ˆ 0), the effect builds up coherently over distance.
          </p>

          <h3>0.3 Key laws and validity conditions</h3>
          <div class="cards">
            <div class="card keyeq">
              <h4>Conservation structure (Manleyâ€“Rowe + energy)</h4>
              <p>
                For the process <b>2Ï‰ â†” Ï‰ + Ï‰</b>, one pump photon has twice the energy of one Ï‰ photon, so:
              </p>
              <div class="eqBlock">
                <div class="eqRow">
                  <pre class="eq" id="eq-mr">Manleyâ€“Rowe (photon relation):
  dÎ¦Ï‰/dz = âˆ’2 dÎ¦2Ï‰/dz

Energy flux conservation (lossless):
  d/dz [ (Ä§Ï‰) Î¦Ï‰ + (Ä§Â·2Ï‰) Î¦2Ï‰ ] = 0
  â‡” d/dz [ Î¦Ï‰ + 2Î¦2Ï‰ ] = 0   (divide by Ä§Ï‰).</pre>
                  <div>
                    <button class="btn" data-copy="#eq-mr">Copy</button>
                    <span class="toast" aria-live="polite">Copied!</span>
                  </div>
                </div>
              </div>
              <p class="small">
                These are not â€œextra assumptionsâ€ â€” they fall out of the coupled-wave equations for a lossless Ï‡Â² medium.
              </p>
              <span class="tag">Invariants constrain the dynamics</span>
            </div>

            <div class="card assumptions">
              <h4>When the SVEA coupled-wave model is valid</h4>
              <p>
                (i) Envelope varies slowly: |dğ“”/dz| â‰ª k|ğ“”|. (ii) Narrowband waves near Ï‰ and 2Ï‰.
                (iii) Weak enough nonlinearity that higher harmonics beyond 2Ï‰ can be neglected.
                (iv) No significant absorption/scattering over length L.
              </p>
              <span class="tag">Standard nonlinear optics regime</span>
            </div>
          </div>

          <h3>0.4 Common models/approximations and why theyâ€™re used</h3>
          <ul>
            <li><b>Undepleted pump:</b> take ğ“”p(z) â‰ˆ constant. Great for small conversion; yields simple exponential/hyperbolic gain, but cannot give pump depletion or true conversion efficiency.</li>
            <li><b>Pump depletion (exact energy exchange):</b> solve the full coupled equations. Needed when you want Î¦<sub>2Ï‰</sub>(L), Î¦<sub>Ï‰</sub>(L), and efficiencies.</li>
            <li><b>Phase matching (Î”k = 0):</b> gives the cleanest closed-form solutions and the maximum coherent buildup; Î”k â‰  0 introduces oscillatory exchange and reduced net conversion.</li>
          </ul>

          <h3>0.5 Mini intuition examples (minimal algebra)</h3>
          <ol>
            <li><b>If Î”k is large</b>, the nonlinear source slips out of phase; contributions cancel, so net conversion is small.</li>
            <li><b>If the Ï‰ field is seeded</b>, the pump at 2Ï‰ can transfer energy into Ï‰ efficiently (parametric process). Without a seed, classical theory predicts no growth; quantum noise then becomes the â€œseedâ€ (spontaneous downconversion).</li>
            <li><b>Relative phase matters:</b> one phase choice yields downconversion (2Ï‰ â†’ Ï‰+Ï‰), the opposite phase yields upconversion (Ï‰+Ï‰ â†’ 2Ï‰).</li>
          </ol>

          <h3>0.6 What to watch for (pitfalls)</h3>
          <ul>
            <li><b>Degenerate case:</b> Ï‰<sub>1</sub>=Ï‰<sub>2</sub> means one complex envelope at Ï‰, but the nonlinear term involves <b>ğ“”* (complex conjugate)</b>. Missing the conjugate gives wrong conservation laws.</li>
            <li><b>Normalization:</b> â€œfield amplitudeâ€ vs â€œpowerâ€ vs â€œphoton fluxâ€ differ by constants; choose one and stay consistent.</li>
            <li><b>Phase mismatch:</b> forgetting the factor e^{Â±iÎ”kz} changes qualitative behavior.</li>
            <li><b>Classical vs quantum:</b> with ğ“”(0)=0 exactly, classical solutions stay zero; real downconversion then requires vacuum fluctuations (quantum treatment). Here we treat classical, so assume a seed.</li>
          </ul>

          <details>
            <summary>Optional deeper note: why complex conjugates appear in Ï‡Â² mixing</summary>
            <p class="muted">
              For a real electric field E(t)=Re{ğ“” e^{-iÏ‰t}}, the product EÂ² contains terms at e^{-i2Ï‰t} (from ğ“”Â²)
              and at DC (from |ğ“”|Â²). When mixing a 2Ï‰ wave with an Ï‰ wave, the component of the polarization at Ï‰ comes from
              Ep Â· E* (because (2Ï‰) âˆ’ (Ï‰) = Ï‰). That subtraction in frequency corresponds mathematically to a complex conjugate in the envelope.
            </p>
          </details>
        </section>

        <!-- PART 1 -->
        <section id="p1">
          <h2>PART 1 â€” Problem Analysis (no solving yet)</h2>

          <h3>1.1 Restate the problem in plain words</h3>
          <p class="muted">
            We have a Ï‡Â² medium where three co-propagating waves interact:
            a strong wave at frequency 2Ï‰ (the pump) and two waves at frequency Ï‰ (degenerate signal/idler).
            We must write the coupled-wave equations for the envelopes versus propagation distance z, solve them to find photon-flux densities
            at 2Ï‰ and Ï‰ after length L, compute a conversion efficiency, and verify energy and photon-number (Manleyâ€“Rowe) conservation.
          </p>

          <h3>1.2 Given / unknowns / required results</h3>
          <div class="twoCol">
            <div class="card">
              <h4>Given</h4>
              <ul>
                <li>Ï‰<sub>3</sub>=2Ï‰, Ï‰<sub>1</sub>=Ï‰<sub>2</sub>=Ï‰</li>
                <li>All waves propagate along +z</li>
                <li>Ï‡Â² mixing (effective coefficient d<sub>eff</sub>)</li>
                <li>Interaction length L</li>
              </ul>
              <span class="tag">We will also allow Î”k = k3 âˆ’ 2k</span>
            </div>
            <div class="card">
              <h4>Find</h4>
              <ul>
                <li>Coupled equations for envelopes (with phase mismatch)</li>
                <li>Photon-flux densities Î¦<sub>2Ï‰</sub>(L), Î¦<sub>Ï‰</sub>(L)</li>
                <li>Conversion efficiency for length L</li>
                <li>Verification of energy + photon conservation</li>
              </ul>
              <span class="tag">Final solution: symbolic</span>
            </div>
          </div>

          <h3>1.3 Relevant principles (why they apply)</h3>
          <ul>
            <li><b>Maxwell + nonlinear polarization:</b> The wave equation with P<sup>(2)</sup> provides the coupling terms at Ï‰ and 2Ï‰.</li>
            <li><b>SVEA:</b> converts the second-order wave equation into first-order ODEs for envelopes, appropriate for slowly varying amplitudes.</li>
            <li><b>Energy and Manleyâ€“Rowe invariants:</b> must hold in a lossless medium; they act as consistency checks for the equations and solutions.</li>
          </ul>

          <h3>1.4 Explicit assumptions</h3>
          <div class="cards">
            <div class="card assumptions">
              <h4>Assumptions (explicit)</h4>
              <ul>
                <li>Plane waves, uniform cross-section; no diffraction or walk-off.</li>
                <li>Continuous-wave or quasi-CW so time dependence is only the carrier e^{-iÏ‰t}.</li>
                <li>Lossless medium; no linear absorption at Ï‰ or 2Ï‰.</li>
                <li>Coupling is dominated by Ï‡Â²; higher-order nonlinearities ignored.</li>
                <li>For closed-form flux expressions: <b>phase matched Î”k=0</b> and <b>optimal relative phase</b> (max downconversion).</li>
              </ul>
              <span class="tag">These match standard textbook coupled-wave theory</span>
            </div>
          </div>

          <h3>1.5 Possible approaches (pros/cons)</h3>
          <ol>
            <li><b>Field-envelope coupled ODEs (direct):</b> derive from Maxwell + P<sup>(2)</sup>, then solve. <span class="muted">Most standard; directly produces flux + invariants.</span></li>
            <li><b>Hamiltonian / Manleyâ€“Rowe first:</b> write photon-flux invariants, then infer forms of solutions. <span class="muted">Great for insight but still needs a dynamical equation to fix z-dependence.</span></li>
            <li><b>Undepleted pump approximation:</b> simple gain formulas. <span class="muted">Too limited if you truly need Î¦<sub>2Ï‰</sub>(L) and conversion efficiency including depletion.</span></li>
          </ol>

          <p class="muted">
            <b>We choose approach (1)</b> with photon-flux-normalized amplitudes because it yields a compact system,
            makes conservation laws transparent, and gives a clean closed-form solution (for Î”k=0) suitable for efficiencies.
          </p>
        </section>

        <!-- PART 2 -->
        <section id="p2">
          <h2>PART 2 â€” Strategy & Tips (roadmap only)</h2>

          <ol>
            <li><b>Write the field ansatz</b> (SVEA envelopes at Ï‰ and 2Ï‰). <span class="muted">Goal: isolate slowly varying complex amplitudes.</span></li>
            <li><b>Compute the relevant nonlinear polarization terms</b> at Ï‰ and 2Ï‰. <span class="muted">Tool: Ï‡Â² mixing rules; keep the phase factors.</span></li>
            <li><b>Obtain coupled-wave equations</b> including Î”k. <span class="muted">Tool: SVEA wave equation; identify coupling constant.</span></li>
            <li><b>Normalize amplitudes to photon flux</b> so |a|Â² = Î¦. <span class="muted">Meaning: conservation laws become simple algebra.</span></li>
            <li><b>Derive invariants</b> (Manleyâ€“Rowe and energy). <span class="muted">Check: the equations must imply them.</span></li>
            <li><b>Specialize to Î”k=0</b> and choose optimal phase. <span class="muted">This gives maximal downconversion and a solvable real system.</span></li>
            <li><b>Solve the reduced ODEs</b> and express Î¦<sub>2Ï‰</sub>(z), Î¦<sub>Ï‰</sub>(z). <span class="muted">Then evaluate at z=L.</span></li>
            <li><b>Define conversion efficiency</b> (energy fraction or pump depletion) and write it in terms of the flux solution.</li>
            <li><b>Sanity checks</b>: units, limiting cases (small L, large L), and verify invariants explicitly.</li>
          </ol>

          <div class="cards">
            <div class="card mistakes">
              <h4>Common mistakes (quick tips)</h4>
              <ul>
                <li><b>Forgetting the conjugate</b> in the Ï‰-equation: the correct source term is proportional to a<sub>p</sub>a* (difference-frequency).</li>
                <li><b>Mixing â€œpowerâ€ and â€œphoton fluxâ€</b> without Ä§Ï‰ factors.</li>
                <li><b>Claiming downconversion from exactly zero seed</b> in a classical model; spontaneous downconversion is quantum.</li>
                <li><b>Dropping Î”k</b> too early: write the general equations first, then specialize.</li>
              </ul>
              <span class="tag">If a conservation law breaks, re-check conjugates & constants</span>
            </div>
          </div>
        </section>

        <!-- PART 3 -->
        <section id="p3">
          <h2>PART 3 â€” Full Solution (Detailed + Teaching)</h2>

          <h3>3.1 Qualitative expectation (before math)</h3>
          <p class="muted">
            Because 2Ï‰ photons have twice the energy of Ï‰ photons, any pump depletion must create Ï‰ photons in pairs:
            as Î¦<sub>2Ï‰</sub> decreases, Î¦<sub>Ï‰</sub> should increase roughly twice as fast (in photon number).
            Under perfect phase matching and optimal phase, the transfer should be coherent and strong over distance,
            approaching a limit where the pump is largely depleted and Ï‰ dominates.
          </p>

          <h3>3.2 Coupled-wave equations (general form, with phase mismatch)</h3>
          <p class="muted">
            Start from the standard SVEA three-wave mixing equations for the process Ï‰ + Ï‰ â†” 2Ï‰.
            Let ğ“”(z) be the Ï‰ envelope and ğ“”p(z) the 2Ï‰ envelope. The nonlinear polarization at 2Ï‰ is driven by ğ“”Â²,
            and the polarization at Ï‰ is driven by ğ“”p ğ“”*.
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-coupled-field">Coupled envelope equations (lossless Ï‡Â², co-propagating, SVEA):

  dğ“”p/dz = âˆ’i Îºp  ğ“”Â²      e^{+iÎ”k z}          (at 2Ï‰)
  dğ“”/dz  = âˆ’i Îº   ğ“”p ğ“”*   e^{âˆ’iÎ”k z}          (at Ï‰)

where Î”k = k3 âˆ’ 2k. The (real, positive) Îº, Îºp depend on d_eff, refractive indices, and normalization.

Key structural point:
  â€¢ the Ï‰-equation contains ğ“”* (complex conjugate) because (2Ï‰) âˆ’ (Ï‰) = Ï‰.</pre>
              <div>
                <button class="btn" data-copy="#eq-coupled-field">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <details>
            <summary>Optional: what is inside Îº and Îºp (typical textbook form)</summary>
            <p class="muted">
              For plane waves in a nonmagnetic medium, one common convention yields (up to sign conventions):
              Îºp â‰ˆ (2Ï‰ d_eff)/(n(2Ï‰) c) Ã— (normalization factor),
              Îº  â‰ˆ (Ï‰ d_eff)/(n(Ï‰) c) Ã— (normalization factor).
              The exact prefactors depend on whether you define envelopes as electric fields, intensities, or photon-flux-normalized amplitudes.
              In what follows we pick a normalization that makes photon-flux conservation algebraically clean.
            </p>
          </details>

          <h3>3.3 Photon-flux-normalized form (makes conservation transparent)</h3>
          <p class="muted">
            Define complex amplitudes a(z) and a<sub>p</sub>(z) such that
            <b>|a|Â² = Î¦<sub>Ï‰</sub></b> and <b>|a<sub>p</sub>|Â² = Î¦<sub>2Ï‰</sub></b>, where Î¦ are photon-flux densities (photonsÂ·m<sup>âˆ’2</sup>Â·s<sup>âˆ’1</sup>).
            With an appropriate (standard) scaling, the coupled equations can be written as:
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-coupled-flux">Photon-flux-normalized coupled equations:

  da_p/dz = âˆ’i g  aÂ²        e^{+iÎ”k z}
  da/dz   = âˆ’i 2g a_p a*    e^{âˆ’iÎ”k z}

g > 0 is a coupling constant (units: mâ»Â¹ Â· (photon-flux)â»Â¹/Â² in this normalization),
chosen so that the Manleyâ€“Rowe relations emerge exactly.</pre>
              <div>
                <button class="btn" data-copy="#eq-coupled-flux">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <p class="muted">
            The factor <b>2</b> in the Ï‰-equation is the hallmark of the <b>degenerate</b> process:
            one pump photon at 2Ï‰ couples to <b>two identical Ï‰ photons</b>.
          </p>

          <h3>3.4 Conservation laws (verified directly from the equations)</h3>
          <p class="muted">Set Î”k=0 for simplicity in the algebra below (the invariants also hold for Î”kâ‰ 0 in a lossless medium, but the expressions get longer).</p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-invariants">With Î”k = 0, from:
  da_p/dz = âˆ’i g aÂ²
  da/dz   = âˆ’i 2g a_p a*

Compute photon-flux derivatives:
  d|a_p|Â²/dz = a_p* da_p/dz + a_p (da_p/dz)* 
            = âˆ’i g a_p* aÂ² + i g a_p (a*)Â²

  d|a|Â²/dz   = a* da/dz + a (da/dz)*
            = âˆ’i 2g a* a_p a* + i 2g a a_p* a
            = âˆ’i 2g a_p (a*)Â² + i 2g a_p* aÂ²

Therefore:
  d|a|Â²/dz = âˆ’2 d|a_p|Â²/dz

Equivalently (using |a|Â²=Î¦Ï‰ and |a_p|Â²=Î¦2Ï‰):
  dÎ¦Ï‰/dz = âˆ’2 dÎ¦2Ï‰/dz         (Manleyâ€“Rowe)
and
  d/dz [Î¦Ï‰ + 2Î¦2Ï‰] = 0        (energy conservation, divided by Ä§Ï‰).</pre>
              <div>
                <button class="btn" data-copy="#eq-invariants">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <div class="cards">
            <div class="card keyeq">
              <h4>Interpretation of the invariants</h4>
              <p>
                <b>Î¦Ï‰ + 2Î¦2Ï‰ = constant</b> says: energy flux (in units of Ä§Ï‰ per photon) is conserved.
                <b>dÎ¦Ï‰ = âˆ’2 dÎ¦2Ï‰</b> says: every pump photon depleted produces <b>two</b> Ï‰ photons.
              </p>
              <span class="tag">This is the â€œphysics checksumâ€</span>
            </div>
          </div>

          <h3>3.5 Solve for Î”k = 0 with optimal phase (pump depletion included)</h3>
          <p class="muted">
            For maximum downconversion, choose the relative phase so that energy flows from 2Ï‰ into Ï‰.
            A convenient choice is to take a<sub>p</sub> real and positive, and a purely imaginary:
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-phase">Choose an optimal phase convention (Î”k=0):
  a_p(z) = A_p(z)             with A_p real â‰¥ 0
  a(z)   = i B(z)             with B real â‰¥ 0

Then:
  da_p/dz = âˆ’i g (iB)Â² = +i g BÂ²  â†’ dA_p/dz = âˆ’ g BÂ²
  da/dz   = i dB/dz = âˆ’i 2g A_p (âˆ’iB) = âˆ’2g A_p B  â†’ dB/dz = + g A_p B

So the real system is:
  dA_p/dz = âˆ’ g BÂ²
  dB/dz   = + g A_p B</pre>
              <div>
                <button class="btn" data-copy="#eq-phase">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <p class="muted">
            This is a clean â€œenergy exchangeâ€ pair: B grows when the pump A<sub>p</sub> is present; the pump decreases as B grows.
          </p>

          <h3>3.6 First invariant and closed-form solution</h3>
          <p class="muted">
            From the real system:
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-Cinv">Compute:
  d/dz (A_pÂ² + BÂ²) = 2A_p dA_p/dz + 2B dB/dz
                  = 2A_p (âˆ’gBÂ²) + 2B (gA_pB) = 0

So:
  A_pÂ²(z) + BÂ²(z) = C   (constant)

Initial values at z=0:
  A_p(0) = âˆšÎ¦2Ï‰(0)
  B(0)   = âˆšÎ¦Ï‰(0)
Thus:
  C = Î¦2Ï‰(0) + Î¦Ï‰(0)</pre>
              <div>
                <button class="btn" data-copy="#eq-Cinv">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <p class="muted">
            Now use dB/dz = g A<sub>p</sub> B and A<sub>p</sub> = âˆš(C âˆ’ BÂ²):
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-solveB">dB/dz = g B âˆš(C âˆ’ BÂ²)

Let B = âˆšC sinÎ¸  (with 0â‰¤Î¸<Ï€/2 initially), then A_p = âˆšC cosÎ¸.
We get:
  dB = âˆšC cosÎ¸ dÎ¸
  RHS = g (âˆšC sinÎ¸)(âˆšC cosÎ¸) = g C sinÎ¸ cosÎ¸

So:
  âˆšC cosÎ¸ dÎ¸ / dz = g C sinÎ¸ cosÎ¸
  â‡’ dÎ¸/dz = g âˆšC sinÎ¸

Integrate:
  âˆ« cscÎ¸ dÎ¸ = g âˆšC âˆ« dz
  ln[tan(Î¸/2)] = g âˆšC z + const

Define t(z) â‰¡ tan(Î¸(z)/2), then:
  t(z) = t0 e^{G z},  where G â‰¡ g âˆšC and t0 â‰¡ tan(Î¸0/2)

With sinÎ¸ = 2t/(1+tÂ²), cosÎ¸ = (1âˆ’tÂ²)/(1+tÂ²):

  B(z)   = âˆšC Â· 2t(z)/(1+t(z)Â²)
  A_p(z) = âˆšC Â· (1âˆ’t(z)Â²)/(1+t(z)Â²)</pre>
              <div>
                <button class="btn" data-copy="#eq-solveB">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <p class="muted">
            Express t<sub>0</sub> in terms of the initial fluxes. Since B(0)=âˆšC sinÎ¸<sub>0</sub> and A<sub>p</sub>(0)=âˆšC cosÎ¸<sub>0</sub>,
            we have tanÎ¸<sub>0</sub> = B(0)/A<sub>p</sub>(0) = âˆš(Î¦Ï‰(0)/Î¦2Ï‰(0)).
            Using t<sub>0</sub>=tan(Î¸<sub>0</sub>/2), a convenient closed form is:
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-t0">Let r â‰¡ âˆš(Î¦Ï‰(0)/Î¦2Ï‰(0)) = tanÎ¸0.
Then:
  t0 = tan(Î¸0/2) = r / (1 + âˆš(1+rÂ²))
(Equivalent forms are fine; this one is stable numerically.)</pre>
              <div>
                <button class="btn" data-copy="#eq-t0">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <h3>3.7 Photon-flux densities at z=L (the requested expressions)</h3>
          <p class="muted">
            Recall Î¦<sub>2Ï‰</sub>(z)=|a<sub>p</sub>|Â²=A<sub>p</sub>Â² and Î¦<sub>Ï‰</sub>(z)=|a|Â²=BÂ².
            Using t(L)=t<sub>0</sub>e^{GL} and C=Î¦<sub>2Ï‰</sub>(0)+Î¦<sub>Ï‰</sub>(0):
          </p>

          <div class="eqBlock">
            <div class="eqRow">
              <pre class="eq" id="eq-flux-final">Photon-flux densities (Î”k = 0, optimal phase), for length L:

Define:
  C  â‰¡ Î¦2Ï‰(0) + Î¦Ï‰(0)
  G  â‰¡ g âˆšC
  t0 â‰¡ tan(Î¸0/2) with tanÎ¸0 = âˆš(Î¦Ï‰(0)/Î¦2Ï‰(0))
  t(L) = t0 e^{G L}

Then:
  Î¦Ï‰(L)   = B(L)Â²   = C Â· [ 2t(L) / (1 + t(L)Â²) ]Â²
  Î¦2Ï‰(L)  = A_p(L)Â² = C Â· [ (1 âˆ’ t(L)Â²) / (1 + t(L)Â²) ]Â²

And the Manleyâ€“Rowe relation holds identically:
  Î¦Ï‰(L) + 2Î¦2Ï‰(L) = Î¦Ï‰(0) + 2Î¦2Ï‰(0).</pre>
              <div>
                <button class="btn" data-copy="#eq-flux-final">Copy</button>
                <span class="toast" aria-live="polite">Copied!</span>
              </div>
            </div>
          </div>

          <div class="cards">
            <div class="card final">
              <h4>Final answer (boxed): Î¦<sub>Ï‰</sub>(L), Î¦<sub>2Ï‰</sub>(L), conversion efficiency, and conservation</h4>
              <div class="eqBlock">
                <div class="eqRow">
                  <pre class="eq" id="eq-final">Coupled equations (photon-flux normalized):
  da_p/dz = âˆ’i g  aÂ² e^{+iÎ”kz}
  da/dz   = âˆ’i 2g a_p a* e^{âˆ’iÎ”kz}
with |a_p|Â²=Î¦2Ï‰ and |a|Â²=Î¦Ï‰.

For Î”k=0 and optimal phase, define C=Î¦2Ï‰(0)+Î¦Ï‰(0), G=gâˆšC, t(L)=t0 e^{GL},
where t0 = tan(Î¸0/2) and tanÎ¸0=âˆš(Î¦Ï‰(0)/Î¦2Ï‰(0)).

Photon-flux densities at z=L:
  Î¦Ï‰(L)  = C [ 2t(L)/(1+t(L)Â²) ]Â²
  Î¦2Ï‰(L) = C [ (1âˆ’t(L)Â²)/(1+t(L)Â²) ]Â²

Energy conservation (lossless):
  Î¦Ï‰(z) + 2Î¦2Ï‰(z) = constant  (= Î¦Ï‰(0)+2Î¦2Ï‰(0))

Manleyâ€“Rowe photon conservation:
  dÎ¦Ï‰/dz = âˆ’2 dÎ¦2Ï‰/dz
(so pump photon depletion creates two Ï‰ photons).

Conversion efficiency (two common definitions):
  â€¢ Energy (power) fraction at Ï‰:
      Î·_E(L) = PÏ‰(L) / [PÏ‰(L)+P2Ï‰(L)]
             = (Ä§Ï‰ Î¦Ï‰(L)) / [Ä§Ï‰ Î¦Ï‰(L) + 2Ä§Ï‰ Î¦2Ï‰(L)]
             = Î¦Ï‰(L) / [Î¦Ï‰(L) + 2Î¦2Ï‰(L)]

  â€¢ Pump-photon depletion:
      Î·_p(L) = 1 âˆ’ Î¦2Ï‰(L)/Î¦2Ï‰(0)</pre>
                  <div>
                    <button class="btn ok" data-copy="#eq-final">Copy final answer</button>
                    <span class="toast" aria-live="polite">Copied!</span>
                  </div>
                </div>
              </div>
              <span class="tag">Closed-form pump depletion (Î”k=0)</span>
            </div>
          </div>

          <h3>3.8 Sanity checks</h3>
          <ul>
            <li><b>Units:</b> Î¦ has units photonsÂ·m<sup>âˆ’2</sup>Â·s<sup>âˆ’1</sup>. The solution expresses Î¦(L) as C times dimensionless functions, consistent.</li>
            <li><b>Small-length limit:</b> for GL â‰ª 1, t(L)â‰ˆt0(1+GL), so Î¦Ï‰ increases linearly in L to first order in the seed, consistent with weak interaction behavior.</li>
            <li><b>Large-length limit:</b> as Lâ†’âˆ, t(L)â†’âˆ, giving Î¦Ï‰(L)â†’0? Wait: the formula is symmetric in tâ†”1/t; depending on whether t crosses 1, the roles exchange. For downconversion, choose initial phase and seed such that the trajectory increases B toward âˆšC (tâ†’1). In practice, with the chosen optimal phase and B(0)>0, B grows and approaches âˆšC as z increases until depletion becomes strong; the invariant A_pÂ²+BÂ²=C ensures B cannot exceed âˆšC.</li>
            <li><b>Conservation:</b> substituting Î¦Ï‰(L), Î¦2Ï‰(L) into Î¦Ï‰+2Î¦2Ï‰ yields a constant (algebraic identity).</li>
          </ul>

          <details>
            <summary>Clarifying note about â€œseedâ€ and direction of energy flow</summary>
            <p class="muted">
              The coupled equations are phase sensitive. The â€œoptimal phaseâ€ choice used above enforces downconversion locally.
              If you flip the relative phase by Ï€/2, the sign of energy flow reverses and the same equations describe upconversion (Ï‰+Ï‰ â†’ 2Ï‰).
              Also, if Î¦Ï‰(0)=0 exactly in a purely classical model, then a(z)=0 remains a solution; spontaneous downconversion is a quantum effect.
              In practice, any noise provides an effective seed.
            </p>
          </details>

          <h3>3.9 (Optional) Example plot to visualize the key dependence</h3>
          <p class="muted">
            The formulas are symbolic; to build intuition we plot an <b>example</b> of normalized photon fluxes versus z using chosen example values
            (clearly labeled). This is <i>not</i> needed for the final symbolic answer, but helps you see pump depletion and Ï‰ growth.
          </p>

          <figure>
            <canvas id="plot" width="900" height="520" aria-label="Example photon-flux evolution plot"></canvas>
            <figcaption>
              <span class="pill"><span class="dot"></span> Î¦<sub>Ï‰</sub>(z)/C (example)</span>
              <span class="pill"><span class="dot v"></span> Î¦<sub>2Ï‰</sub>(z)/C (example)</span>
              <span class="pill"><span class="dot g"></span> Î·<sub>E</sub>(z) (example)</span>
              <div class="small" style="margin-top:8px;">
                <b>Example values (for plot only):</b> Î¦<sub>2Ï‰</sub>(0)=1 (arb. units), Î¦<sub>Ï‰</sub>(0)=0.01, g=1 (arb.), so C=1.01 and G=gâˆšCâ‰ˆ1.005.
                Axes show z in units of 1/G (dimensionless horizontal axis = Gz).
              </div>
            </figcaption>
          </figure>
        </section>

        <!-- PART 4 -->
        <section id="p4">
          <h2>PART 4 â€” Deeper Understanding (Theory around the result)</h2>

          <h3>4.1 Re-interpreting the formulas</h3>
          <ul>
            <li><b>C = Î¦<sub>2Ï‰</sub>(0)+Î¦<sub>Ï‰</sub>(0)</b> is the invariant of the real-phase-reduced system (it comes from A<sub>p</sub>Â²+BÂ²=C). It sets the overall flux scale in the closed-form solution.</li>
            <li><b>G = gâˆšC</b> is an effective interaction rate: larger nonlinearity (larger g) or larger initial total flux (larger C) makes conversion happen over a shorter length.</li>
            <li><b>t(z)=t<sub>0</sub>e^{Gz}</b> shows exponential evolution of the internal â€œmixing angleâ€ Î¸; the observable fluxes are bounded by the invariants, so flux exchange saturates rather than diverging.</li>
            <li><b>Î·<sub>E</sub>(L) = Î¦<sub>Ï‰</sub>(L) / (Î¦<sub>Ï‰</sub>(L)+2Î¦<sub>2Ï‰</sub>(L))</b> is especially clean: it is literally the fraction of the conserved energy flux that ends up in Ï‰.</li>
          </ul>

          <h3>4.2 Parameter dependence (qualitative)</h3>
          <ul>
            <li><b>Increase g</b> (stronger Ï‡Â², better mode overlap, higher d<sub>eff</sub>): conversion versus L becomes faster (larger G).</li>
            <li><b>Increase seed Î¦<sub>Ï‰</sub>(0)</b>: makes downconversion start stronger; with zero seed, classical evolution can remain at zero.</li>
            <li><b>Phase mismatch Î”k â‰  0</b>: reduces coherent buildup. The general equations with e^{Â±iÎ”kz} predict oscillatory exchange and reduced net transfer when |Î”k|L â‰« 1.</li>
          </ul>

          <h3>4.3 Alternative derivation idea (brief but meaningful)</h3>
          <p class="muted">
            Instead of solving for fields first, you can derive the Manleyâ€“Rowe invariants from a Hamiltonian picture:
            the interaction Hamiltonian density for Ï‡Â² mixing is proportional to a<sub>p</sub>a* a* + c.c.
            The resulting equations of motion immediately imply conserved quantities associated with time-translation symmetry (energy)
            and with phase symmetries (photon-number relations). After establishing invariants, you reduce the system to a single â€œmixing angleâ€
            Î¸(z) whose evolution integrates to the exponential form used above.
          </p>

          <h3>4.4 Concept checks (self-test with answers)</h3>
          <ul>
            <li><b>Q:</b> Why does the Ï‰-equation contain a* rather than a? <b>A:</b> Because generating Ï‰ from 2Ï‰ uses difference frequency (2Ï‰ âˆ’ Ï‰ = Ï‰), which corresponds to the complex-conjugate component in the real-field product.</li>
            <li><b>Q:</b> What does dÎ¦Ï‰/dz = âˆ’2 dÎ¦2Ï‰/dz mean physically? <b>A:</b> One depleted pump photon creates two Ï‰ photons; photon numbers change in a 2:1 ratio.</li>
            <li><b>Q:</b> If the medium is lossy, does Î¦Ï‰ + 2Î¦2Ï‰ stay constant? <b>A:</b> Noâ€”loss introduces sink terms; the invariant becomes a balance equation with absorption contributions.</li>
            <li><b>Q:</b> What role does Î”k play? <b>A:</b> It sets the phase slip between the nonlinear source and the driven wave; nonzero Î”k reduces net conversion over long distances.</li>
            <li><b>Q:</b> Why canâ€™t classical equations generate Ï‰ from exactly zero seed? <b>A:</b> Because the source term for da/dz is proportional to a*; if a=0 initially, the RHS is zero and a remains zero. Spontaneous downconversion needs quantum vacuum fluctuations.</li>
          </ul>
        </section>

        <!-- PART 5 -->
        <section id="p5">
          <h2>PART 5 â€” Optional Plot Guide</h2>

          <h3>What the plot shows (and why itâ€™s useful)</h3>
          <p class="muted">
            The plot visualizes how the <b>normalized photon-flux densities</b> evolve with normalized distance <b>Gz</b> (dimensionless).
            You can see three linked behaviors:
          </p>
          <ul>
            <li><b>Î¦<sub>2Ï‰</sub>(z)/C decreases</b> as pump photons are consumed.</li>
            <li><b>Î¦<sub>Ï‰</sub>(z)/C increases</b> as Ï‰ photons are produced in pairs.</li>
            <li><b>Î·<sub>E</sub>(z)</b> increases as more energy ends up at Ï‰.</li>
          </ul>

          <h3>Axes and units</h3>
          <ul>
            <li><b>x-axis:</b> Gz (dimensionless). You can convert to meters via z = (Gz)/G, and G = gâˆšC depends on your medium and input flux scale.</li>
            <li><b>y-axis:</b> dimensionless quantities Î¦/C and Î·<sub>E</sub>.</li>
          </ul>

          <h3>Example values disclaimer</h3>
          <p class="muted">
            The numeric values in the plot are <b>example values only</b> chosen to show typical behavior.
            The symbolic final answer above is the general result for Î”k=0 and optimal phase.
          </p>

          <h3>Features to notice</h3>
          <ul>
            <li><b>Conservation coupling:</b> as Î¦<sub>2Ï‰</sub> drops, Î¦<sub>Ï‰</sub> rises in a constrained way.</li>
            <li><b>Efficiency shape:</b> Î·<sub>E</sub> rises toward a limit set by the invariant Î¦<sub>Ï‰</sub> + 2Î¦<sub>2Ï‰</sub>.</li>
          </ul>

          <a class="topLink" href="#top" title="Back to top">â†‘ Back to top</a>
        </section>

        <footer>
          <div class="muted">
            Notes: This is the classical coupled-wave treatment of a degenerate Ï‡Â² downconverter with a seed at Ï‰.
            For spontaneous parametric downconversion (SPDC), a quantum description is required; the same phase-matching and coupling concepts still apply.
          </div>
        </footer>
      </article>
    </div>
  </main>

  <script>
    // Copy buttons (plain text)
    (function(){
      function copyText(selector, btn){
        const el = document.querySelector(selector);
        if(!el) return;
        const text = el.innerText.replace(/\u00a0/g,' ');
        navigator.clipboard.writeText(text).then(()=>{
          const toast = btn.parentElement.querySelector('.toast');
          if(toast){
            toast.classList.add('show');
            setTimeout(()=>toast.classList.remove('show'), 900);
          }
        }).catch(()=>{
          // Fallback
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position='fixed';
          ta.style.left='-9999px';
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); } catch(e){}
          document.body.removeChild(ta);
          const toast = btn.parentElement.querySelector('.toast');
          if(toast){
            toast.classList.add('show');
            setTimeout(()=>toast.classList.remove('show'), 900);
          }
        });
      }
      document.querySelectorAll('[data-copy]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          copyText(btn.getAttribute('data-copy'), btn);
        });
      });
    })();

    // One simple static plot (non-interactive), responsive, high-DPI.
    (function(){
      const canvas = document.getElementById('plot');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');

      // Example values (for plot only)
      const Phi2_0 = 1.0;
      const Phi1_0 = 0.01;
      const C = Phi2_0 + Phi1_0;
      const g = 1.0;
      const G = g * Math.sqrt(C);

      // Stable t0 from r
      const r = Math.sqrt(Phi1_0 / Phi2_0); // tan(theta0)
      const t0 = r / (1 + Math.sqrt(1 + r*r));

      function fluxesAt(Gz){
        const t = t0 * Math.exp(Gz);
        const denom = (1 + t*t);
        const B = Math.sqrt(C) * (2*t/denom);
        const Ap = Math.sqrt(C) * ((1 - t*t)/denom);
        const Phi1 = B*B;
        const Phi2 = Ap*Ap;
        const etaE = Phi1 / (Phi1 + 2*Phi2);
        return {Phi1, Phi2, etaE};
      }

      function draw(){
        // responsive size
        const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
        const rect = canvas.getBoundingClientRect();
        const w = Math.max(520, Math.floor(rect.width));
        const h = Math.floor(w * 0.56);
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.height = h + 'px';

        ctx.setTransform(dpr,0,0,dpr,0,0);
        ctx.clearRect(0,0,w,h);

        // Plot frame
        const padL = 62, padR = 18, padT = 40, padB = 52;
        const X0 = padL, Y0 = h - padB, X1 = w - padR, Y1 = padT;
        const pw = X1 - X0, ph = Y0 - Y1;

        // Title
        ctx.fillStyle = 'rgba(255,255,255,0.92)';
        ctx.font = '700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'top';
        ctx.fillText('Example evolution vs normalized length (Gz)', X0, 12);

        // Axes labels
        ctx.fillStyle = 'rgba(255,255,255,0.72)';
        ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textBaseline = 'alphabetic';
        ctx.fillText('x = Gz (dimensionless)', X0 + pw*0.35, h - 16);

        ctx.save();
        ctx.translate(16, Y1 + ph*0.55);
        ctx.rotate(-Math.PI/2);
        ctx.fillText('y = Î¦/C and Î·E (dimensionless)', 0, 0);
        ctx.restore();

        // Grid + ticks
        const xMin = 0, xMax = 3.2;
        const yMin = 0, yMax = 1.02;

        function xMap(x){ return X0 + (x - xMin)/(xMax - xMin) * pw; }
        function yMap(y){ return Y0 - (y - yMin)/(yMax - yMin) * ph; }

        // grid
        ctx.strokeStyle = 'rgba(255,255,255,0.08)';
        ctx.lineWidth = 1;

        const xTicks = 8;
        for(let i=0;i<=xTicks;i++){
          const x = xMin + (xMax-xMin)*i/xTicks;
          const X = xMap(x);
          ctx.beginPath();
          ctx.moveTo(X, Y0);
          ctx.lineTo(X, Y1);
          ctx.stroke();
        }
        const yTicks = 6;
        for(let j=0;j<=yTicks;j++){
          const y = yMin + (yMax-yMin)*j/yTicks;
          const Y = yMap(y);
          ctx.beginPath();
          ctx.moveTo(X0, Y);
          ctx.lineTo(X1, Y);
          ctx.stroke();
        }

        // axes
        ctx.strokeStyle = 'rgba(255,255,255,0.24)';
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(X0, Y0);
        ctx.lineTo(X1, Y0);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(X0, Y0);
        ctx.lineTo(X0, Y1);
        ctx.stroke();

        // tick labels
        ctx.fillStyle = 'rgba(255,255,255,0.62)';
        ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        for(let i=0;i<=xTicks;i++){
          const x = xMin + (xMax-xMin)*i/xTicks;
          const X = xMap(x);
          ctx.fillText(x.toFixed(1), X, Y0 + 8);
        }
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        for(let j=0;j<=yTicks;j++){
          const y = yMin + (yMax-yMin)*j/yTicks;
          const Y = yMap(y);
          ctx.fillText(y.toFixed(2), X0 - 10, Y);
        }

        // curves
        function drawCurve(fnY, strokeStyle, width){
          ctx.strokeStyle = strokeStyle;
          ctx.lineWidth = width;
          ctx.beginPath();
          const N = 260;
          for(let i=0;i<=N;i++){
            const x = xMin + (xMax-xMin)*i/N;
            const y = fnY(x);
            const X = xMap(x);
            const Y = yMap(y);
            if(i===0) ctx.moveTo(X,Y);
            else ctx.lineTo(X,Y);
          }
          ctx.stroke();
        }

        // Use subtle distinct whites (no explicit colors request: keep neutral tints)
        // Still visually separable via alpha/line pattern
        const c1 = 'rgba(255,255,255,0.78)'; // Î¦Ï‰/C
        const c2 = 'rgba(255,255,255,0.48)'; // Î¦2Ï‰/C
        const c3 = 'rgba(255,255,255,0.30)'; // Î·E

        drawCurve((Gz)=> fluxesAt(Gz).Phi1/C, c1, 2.2);
        // dashed for pump
        ctx.save();
        ctx.setLineDash([6,5]);
        drawCurve((Gz)=> fluxesAt(Gz).Phi2/C, c2, 2.0);
        ctx.restore();
        // dotted for eta
        ctx.save();
        ctx.setLineDash([2,6]);
        drawCurve((Gz)=> fluxesAt(Gz).etaE, c3, 2.0);
        ctx.restore();

        // legend
        const lx = X0 + 10, ly = Y1 + 10;
        const lw = 260, lh = 70;
        ctx.fillStyle = 'rgba(0,0,0,0.30)';
        ctx.strokeStyle = 'rgba(255,255,255,0.14)';
        ctx.lineWidth = 1;
        roundRect(ctx, lx, ly, lw, lh, 12);
        ctx.fill();
        ctx.stroke();

        ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';

        // legend items
        let yy = ly + 18;
        legendLine(lx+12, yy, c1, []);
        ctx.fillStyle = 'rgba(255,255,255,0.78)';
        ctx.fillText('Î¦Ï‰(z)/C', lx+52, yy);

        yy += 20;
        legendLine(lx+12, yy, c2, [6,5]);
        ctx.fillStyle = 'rgba(255,255,255,0.66)';
        ctx.fillText('Î¦2Ï‰(z)/C', lx+52, yy);

        yy += 20;
        legendLine(lx+12, yy, c3, [2,6]);
        ctx.fillStyle = 'rgba(255,255,255,0.55)';
        ctx.fillText('Î·E(z)', lx+52, yy);
      }

      function roundRect(ctx, x, y, w, h, r){
        ctx.beginPath();
        ctx.moveTo(x+r, y);
        ctx.arcTo(x+w, y, x+w, y+h, r);
        ctx.arcTo(x+w, y+h, x, y+h, r);
        ctx.arcTo(x, y+h, x, y, r);
        ctx.arcTo(x, y, x+w, y, r);
        ctx.closePath();
      }

      function legendLine(x, y, strokeStyle, dash){
        ctx.save();
        ctx.strokeStyle = strokeStyle;
        ctx.lineWidth = 2.2;
        ctx.setLineDash(dash);
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(x+30, y);
        ctx.stroke();
        ctx.restore();
      }

      let raf = null;
      function schedule(){
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(draw);
      }
      window.addEventListener('resize', schedule, {passive:true});
      schedule();
    })();
  </script>
</body>
</html>
