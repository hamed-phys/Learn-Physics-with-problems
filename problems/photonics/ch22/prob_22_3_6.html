<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Opto-Optic Phase Modulator (Kerr Cell): Power for a œÄ Phase Shift</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel2:#0f1730;
      --text:#e9eefc;
      --muted:#b8c2e6;
      --faint:#91a0d6;
      --accent:#77a7ff;
      --accent2:#7dffcc;
      --warn:#ffcc66;
      --ok:#7dffcc;
      --bad:#ff6b8a;
      --line:rgba(255,255,255,.10);
      --shadow: 0 14px 40px rgba(0,0,0,.38);
      --radius:18px;
      --radius2:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 15% 5%, rgba(119,167,255,.18), transparent 60%),
        radial-gradient(1000px 650px at 85% 12%, rgba(125,255,204,.10), transparent 62%),
        radial-gradient(900px 600px at 60% 95%, rgba(255,204,102,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      line-height:1.55;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding:32px 18px 12px;
      max-width:1160px;
      margin:0 auto;
    }
    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      align-items:stretch;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hero .card{
      padding:18px 18px 16px;
      position:relative;
    }
    .hero h1{
      margin:0 0 10px;
      font-size: clamp(22px, 2.2vw, 34px);
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size: 14.5px;
      max-width:70ch;
    }
    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:14px;
    }
    .pill{
      padding:7px 10px;
      border-radius:999px;
      background: rgba(119,167,255,.10);
      border:1px solid rgba(119,167,255,.22);
      color: var(--text);
      font-size:12.5px;
      white-space:nowrap;
    }
    .pill b{color:var(--accent2); font-weight:700}
    .rightbox{
      padding:16px 16px 14px;
      display:grid;
      gap:10px;
    }
    .rightbox .k{
      padding:12px 12px;
      border-radius:var(--radius2);
      background: rgba(0,0,0,.18);
      border:1px solid var(--line);
    }
    .rightbox h2{
      margin:0 0 6px;
      font-size:14.5px;
      color: var(--muted);
      font-weight:700;
      letter-spacing:.3px;
      text-transform:uppercase;
    }
    .rightbox .big{
      font-size:20px;
      font-weight:800;
      letter-spacing:.2px;
      margin:0;
    }
    .rightbox .small{
      margin:4px 0 0;
      color: var(--muted);
      font-size:13px;
    }

    main{
      max-width:1160px;
      margin:0 auto;
      padding:10px 18px 56px;
    }

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      align-items:start;
    }

    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      padding:14px 14px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(17,26,51,.92), rgba(15,23,48,.84));
      box-shadow: 0 10px 30px rgba(0,0,0,.30);
      backdrop-filter: blur(8px);
    }
    .toc h3{
      margin:0 0 10px;
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.35px;
    }
    .toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid transparent;
      color:var(--text);
      font-size:13.5px;
      line-height:1.25;
    }
    .toc a:hover{
      background: rgba(119,167,255,.10);
      border-color: rgba(119,167,255,.18);
      text-decoration:none;
    }
    .toc .mini{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed rgba(255,255,255,.14);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btnTop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size:12.5px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select:none;
    }
    .btnTop:hover{ transform: translateY(-1px); border-color: rgba(119,167,255,.30); background: rgba(119,167,255,.08);}
    .btnTop:active{ transform: translateY(0px) scale(.99);}

    article{
      padding:0;
    }
    section.block{
      margin-bottom:16px;
    }
    .panel{
      padding:18px 18px 16px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(17,26,51,.85), rgba(15,23,48,.78));
      box-shadow: 0 12px 34px rgba(0,0,0,.25);
    }
    h2{
      margin:0 0 10px;
      font-size:18px;
      letter-spacing:.2px;
    }
    h3{
      margin:18px 0 8px;
      font-size:15.5px;
      color:var(--muted);
      letter-spacing:.2px;
    }
    p{margin:10px 0; color:var(--text)}
    ul{margin:10px 0 0 18px; color:var(--text)}
    li{margin:7px 0}
    .muted{color:var(--muted)}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .callout{
      border-radius:var(--radius2);
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      padding:12px 12px 10px;
      position:relative;
      overflow:hidden;
    }
    .callout:before{
      content:"";
      position:absolute;
      inset:-2px -2px auto -2px;
      height:3px;
      background: linear-gradient(90deg, rgba(119,167,255,.85), rgba(125,255,204,.75));
      opacity:.9;
    }
    .callout.warn:before{ background: linear-gradient(90deg, rgba(255,204,102,.9), rgba(255,107,138,.78));}
    .callout.ok:before{ background: linear-gradient(90deg, rgba(125,255,204,.9), rgba(119,167,255,.75));}
    .callout h4{
      margin:0 0 6px;
      font-size:13.3px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.35px;
    }
    .eq{
      font-family:var(--mono);
      font-size:13.25px;
      line-height:1.45;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      overflow:auto;
      white-space:pre-wrap;
    }
    .eqRow{
      display:flex;
      gap:10px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .copyBtn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(119,167,255,.10);
      color: var(--text);
      border-radius:12px;
      padding:9px 10px;
      font-size:12.5px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      height: fit-content;
    }
    .copyBtn:hover{transform:translateY(-1px); background: rgba(119,167,255,.14); border-color: rgba(119,167,255,.28);}
    .copyBtn:active{transform:translateY(0px) scale(.99);}
    .copyBtn .dot{
      width:9px; height:9px; border-radius:99px; background: rgba(125,255,204,.9);
      box-shadow: 0 0 0 3px rgba(125,255,204,.12);
    }
    .copyBtn.bad .dot{background: rgba(255,107,138,.9); box-shadow: 0 0 0 3px rgba(255,107,138,.12);}
    .copyBtn.warn .dot{background: rgba(255,204,102,.9); box-shadow: 0 0 0 3px rgba(255,204,102,.12);}
    .note{
      font-size:13px;
      color: var(--muted);
      margin-top:8px;
    }
    details{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      border-radius:14px;
      padding:10px 10px;
      margin-top:10px;
    }
    summary{
      cursor:pointer;
      font-weight:700;
      color: var(--text);
      list-style:none;
      outline:none;
    }
    summary::-webkit-details-marker{display:none}
    summary:after{
      content:"‚ñæ";
      float:right;
      color: var(--muted);
      transition: transform .15s ease;
    }
    details[open] summary:after{ transform: rotate(180deg);}
    .hr{
      height:1px;
      background: rgba(255,255,255,.10);
      margin:14px 0;
    }
    figure{
      margin:10px 0 0;
      padding:12px 12px 10px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
    }
    figcaption{
      margin-top:8px;
      color:var(--muted);
      font-size:13px;
    }
    canvas{ width:100%; height:auto; display:block; border-radius:14px; }

    footer{
      max-width:1160px;
      margin:0 auto;
      padding:0 18px 44px;
      color: var(--muted);
      font-size:13px;
    }

    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
      .layout{grid-template-columns:1fr}
      nav.toc{position:relative; top:auto}
      .grid2{grid-template-columns:1fr}
    }

    @media (prefers-reduced-motion: no-preference){
      .panel, .card, nav.toc, figure{
        animation: pop .35s ease both;
      }
      @keyframes pop{
        from{ transform: translateY(6px); opacity:.0;}
        to{ transform: translateY(0); opacity:1;}
      }
    }

    @media print{
      body{ background:#fff; color:#000;}
      header, main, footer{max-width: 100%;}
      nav.toc{display:none}
      .card, .panel, figure, .callout, details{
        background:#fff !important;
        color:#000 !important;
        box-shadow:none !important;
        border-color:#ccc !important;
      }
      a{color:#000; text-decoration:underline}
      .copyBtn{display:none}
      .pill{border-color:#ccc; background:#f6f6f6}
      .eq{background:#f7f7f7; border-color:#ccc}
      section{break-inside:avoid-page}
      h2, h3{break-after:avoid}
    }
  </style>
</head>
<body>
<header id="top">
  <div class="hero">
    <div class="card">
      <h1>Opto-Optic Phase Modulator Using a CS<sub>2</sub> Kerr Cell: Power Needed for a œÄ Phase Shift</h1>
      <p class="sub">
        We design an <b>all-optical (opto-optic)</b> phase modulator: a strong <b>controlling</b> beam changes the refractive index of CS<sub>2</sub>
        via the <b>optical Kerr effect</b>, imposing a phase shift on a weaker <b>controlled</b> beam.
      </p>
      <div class="meta">
        <span class="pill"><b>Given</b>: Œª<sub>controlled</sub> = 546 nm</span>
        <span class="pill"><b>Control</b>: Œª<sub>control</sub> = 694 nm</span>
        <span class="pill"><b>Cell</b>: L = 10 cm</span>
        <span class="pill"><b>Beam width</b>: W = 0.1 mm</span>
        <span class="pill"><b>Material</b>: n = 1.6, œá<sup>(3)</sup> given</span>
      </div>
    </div>

    <div class="card rightbox" aria-label="Result preview">
      <div class="k">
        <h2>Target</h2>
        <p class="big">ŒîœÜ = œÄ</p>
        <p class="small">Phase shift on the controlled beam (546 nm).</p>
      </div>
      <div class="k">
        <h2>Main idea</h2>
        <p class="big">Œîn = n<sub>2</sub> I</p>
        <p class="small">Kerr index change proportional to control intensity.</p>
      </div>
      <div class="k">
        <h2>Answer scale</h2>
        <p class="big">~ tens of kW</p>
        <p class="small">Reasonable for pulsed control beams with small area.</p>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="layout">
    <nav class="toc" aria-label="Table of contents">
      <h3>Table of Contents</h3>
      <a href="#qs">Quick Summary</a>
      <a href="#p0">PART 0 ‚Äî Concept Primer</a>
      <a href="#p1">PART 1 ‚Äî Problem Analysis</a>
      <a href="#p2">PART 2 ‚Äî Strategy & Tips</a>
      <a href="#p3">PART 3 ‚Äî Full Solution</a>
      <a href="#p4">PART 4 ‚Äî Deeper Understanding</a>
      <a href="#p5">PART 5 ‚Äî Optional Plot Guide</a>
      <div class="mini">
        <button class="btnTop" type="button" onclick="document.getElementById('top').scrollIntoView({behavior:'smooth'})">‚Üë Back to top</button>
        <button class="btnTop" type="button" onclick="window.print()">üñ® Print</button>
      </div>
    </nav>

    <article aria-label="Learning article">
      <section class="block panel" id="qs">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this problem is about:</b> an all-optical phase modulator (Kerr cell) where a control pulse changes the medium‚Äôs refractive index and thus the phase of a second beam.</li>
          <li><b>Key physics idea:</b> the <b>optical Kerr effect</b> makes the refractive index increase with control-beam intensity: Œîn = n<sub>2</sub>I.</li>
          <li><b>Phase accumulation:</b> the controlled beam picks up extra phase ŒîœÜ = (2œÄ/Œª) Œîn L.</li>
          <li><b>œÄ-phase condition:</b> ŒîœÜ = œÄ ‚áí Œîn = Œª/(2L) for the controlled wavelength.</li>
          <li><b>Link to œá<sup>(3)</sup>:</b> n<sub>2</sub> is determined by œá<sup>(3)</sup> (third-order nonlinearity) and the linear index n.</li>
          <li><b>Result type:</b> numeric estimate (power) with a small geometry-dependent factor (square vs circular beam area).</li>
          <li><b>Physical meaning:</b> required power is high because Kerr nonlinearity is weak; using a <b>short pulse</b> makes high peak power feasible.</li>
        </ul>
      </section>

      <section class="block panel" id="p0">
        <h2>PART 0 ‚Äî Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <div class="callout">
            <h4>Core definitions (symbols + SI units)</h4>
            <div class="eq" id="eq_defs">I  = optical intensity (W/m^2)
P  = optical power (W)
A  = beam cross-sectional area (m^2)
E  = electric field amplitude (V/m)
n  = linear refractive index (dimensionless)
Œîn = Kerr-induced index change (dimensionless)
n2 = Kerr coefficient (m^2/W)
œá(3) = third-order susceptibility (units depend on convention)
Œª  = wavelength of the controlled beam in vacuum (m)
L  = Kerr cell length (m)
ŒîœÜ = phase shift (radians)</div>
            <div class="eqRow" style="margin-top:10px;">
              <button class="copyBtn" type="button" data-copy="#eq_defs"><span class="dot"></span>Copy definitions</button>
            </div>
          </div>

          <div class="callout ok">
            <h4>Physical meaning (intuition)</h4>
            <p class="muted" style="margin:0">
              In a Kerr medium, the refractive index responds to optical intensity. A strong control pulse creates a transient
              index bump, so the controlled beam travels a slightly different optical path length. Phase is essentially
              ‚Äúoptical path / wavelength‚Äù, so even a tiny Œîn can matter over a long enough length L.
            </p>
            <details>
              <summary>Mini intuition examples (no heavy algebra)</summary>
              <ul class="muted">
                <li><b>Longer L helps:</b> doubling the cell length doubles the phase shift for the same Œîn.</li>
                <li><b>Shorter Œª helps:</b> shorter controlled wavelength increases phase sensitivity (more cycles per meter).</li>
                <li><b>Tighter focusing helps:</b> smaller area A increases intensity I for fixed power P, so Œîn grows.</li>
              </ul>
            </details>
          </div>
        </div>

        <h3>Key laws / principles and validity conditions</h3>
        <div class="callout">
          <h4>Optical Kerr effect (instantaneous, isotropic model)</h4>
          <div class="eq" id="eq_kerr">Œîn = n2 I_control</div>
          <div class="eqRow" style="margin-top:10px;">
            <button class="copyBtn" type="button" data-copy="#eq_kerr"><span class="dot"></span>Copy equation</button>
          </div>
          <p class="note">
            Valid when the nonlinearity is dominated by third-order response and the index change is small: |Œîn| ‚â™ n.
            For many liquids (including CS<sub>2</sub>) the Kerr effect can be strong but still typically requires high intensity.
          </p>
        </div>

        <div class="callout">
          <h4>Phase accumulation in a uniform medium</h4>
          <div class="eq" id="eq_phase">ŒîœÜ = (2œÄ/Œª_controlled) ¬∑ (Œîn) ¬∑ L</div>
          <div class="eqRow" style="margin-top:10px;">
            <button class="copyBtn" type="button" data-copy="#eq_phase"><span class="dot"></span>Copy equation</button>
          </div>
          <p class="note">
            This is the extra phase relative to propagation with the unperturbed refractive index.
            We assume Œîn is approximately uniform across the controlled beam and along the interaction length.
          </p>
        </div>

        <h3>Common models / approximations (and why used)</h3>
        <ul class="muted">
          <li><b>Scalar Kerr law:</b> Œîn = n<sub>2</sub>I (simple, accurate for order-of-magnitude design).</li>
          <li><b>Uniform-intensity (‚Äútop-hat‚Äù) beam:</b> lets us write I = P/A directly. Real beams are Gaussian, which changes the exact numerical factor but not the scaling.</li>
          <li><b>Neglect absorption and dispersion:</b> because the question targets the required Kerr strength for a œÄ phase shift, not losses or bandwidth.</li>
        </ul>

        <div class="callout warn" style="margin-top:12px;">
          <h4>What to watch for (pitfalls)</h4>
          <ul class="muted">
            <li><b>œá<sup>(3)</sup> units/convention:</b> some texts quote Œµ<sub>0</sub>œá<sup>(3)</sup> rather than œá<sup>(3)</sup> itself. You must match the formula to the convention.</li>
            <li><b>Area ambiguity:</b> ‚Äúwidth W‚Äù might mean a square beam (A=W¬≤) or a circular beam with diameter W (A=œÄ(W/2)¬≤). That changes power by ~27%.</li>
            <li><b>Peak vs average power:</b> with pulsed control light, the Kerr effect is driven by <b>peak</b> power (and peak intensity), not average.</li>
          </ul>
        </div>

        <details>
          <summary>Deeper note: linking n<sub>2</sub> to œá<sup>(3)</sup> (why it works)</summary>
          <p class="muted">
            In a third-order nonlinear dielectric, the nonlinear polarization contains a term cubic in the electric field.
            This modifies the effective permittivity and thus the refractive index. For a monochromatic wave, the intensity is
            proportional to |E|¬≤, so the index shift becomes proportional to intensity: Œîn ‚àù œá<sup>(3)</sup>|E|¬≤ ‚àù œá<sup>(3)</sup>I.
            The proportionality constant includes Œµ<sub>0</sub>, c, and n because those connect field amplitude to intensity in SI.
          </p>
        </details>
      </section>

      <section class="block panel" id="p1">
        <h2>PART 1 ‚Äî Problem Analysis (No Solving Yet)</h2>

        <h3>Restate the problem in plain words</h3>
        <p>
          We have a CS<sub>2</sub> Kerr cell of length <b>L = 10 cm</b>. A <b>controlled</b> optical beam at <b>Œª = 546 nm</b>
          passes through the cell. A separate <b>controlling</b> pulsed laser beam at <b>694 nm</b> illuminates the same region and,
          via the Kerr effect, changes the refractive index experienced by the controlled beam. The beam width is <b>W = 0.1 mm</b>.
          Given CS<sub>2</sub> has <b>n = 1.6</b> and <b>œá<sup>(3)</sup> = 4.4 √ó 10<sup>‚àí32</sup> C¬∑m/V<sup>3</sup></b>,
          estimate the <b>optical power</b> of the control light needed to impose a <b>œÄ phase shift</b> on the controlled beam.
        </p>

        <div class="grid2">
          <div class="callout">
            <h4>Given</h4>
            <div class="eq" id="eq_given">Œª_controlled = 546 nm = 546√ó10^-9 m
W = 0.1 mm = 1.0√ó10^-4 m
L = 10 cm = 0.10 m
Œª_control = 694 nm (controls Kerr index, not the phase formula directly)
n = 1.6
œá(3)_given = 4.4√ó10^-32 C¬∑m/V^3</div>
            <div class="eqRow" style="margin-top:10px;">
              <button class="copyBtn" type="button" data-copy="#eq_given"><span class="dot"></span>Copy givens</button>
            </div>
          </div>

          <div class="callout ok">
            <h4>Unknowns / target</h4>
            <div class="eq" id="eq_unknowns">Find: P_pi = control-beam optical power required so that ŒîœÜ = œÄ for the controlled beam.</div>
            <div class="eqRow" style="margin-top:10px;">
              <button class="copyBtn" type="button" data-copy="#eq_unknowns"><span class="dot"></span>Copy target</button>
            </div>
            <p class="note">
              The key chain is: <b>P ‚Üí I ‚Üí Œîn ‚Üí ŒîœÜ</b>. Once we know n<sub>2</sub>, the rest is geometry and phase accumulation.
            </p>
          </div>
        </div>

        <h3>Relevant principles (why they apply)</h3>
        <ul class="muted">
          <li><b>Kerr index change:</b> CS<sub>2</sub> has third-order nonlinearity, so Œîn is proportional to control intensity.</li>
          <li><b>Optical phase through a medium:</b> phase depends on optical path length nL; a small change Œîn adds extra phase proportional to L.</li>
        </ul>
        <p class="muted">
          We do <b>not</b> need electro-optic (Pockels) effect (second-order) because CS<sub>2</sub> is centrosymmetric (liquid), so œá<sup>(2)</sup> ‚âà 0.
          We also do <b>not</b> need interference or cavity enhancement because the problem states a single-pass Kerr cell design.
        </p>

        <div class="callout warn">
          <h4>Assumptions (explicit)</h4>
          <ul class="muted">
            <li>Instantaneous Kerr response and negligible absorption over L.</li>
            <li>Control and controlled beams overlap uniformly over area A and length L.</li>
            <li>‚ÄúWidth W‚Äù defines the interaction cross-section; we estimate A as either W¬≤ (square) or œÄ(W/2)¬≤ (circular).</li>
            <li>Small-signal approximation: Œîn ‚â™ n, so we can use linearized phase shift.</li>
          </ul>
        </div>

        <h3>Possible approaches (compare 2‚Äì3)</h3>
        <div class="grid2">
          <div class="callout">
            <h4>Approach A: n<sub>2</sub> route (recommended)</h4>
            <ul class="muted">
              <li>Convert œá<sup>(3)</sup> ‚Üí n<sub>2</sub>.</li>
              <li>Use ŒîœÜ = (2œÄ/Œª) n<sub>2</sub> I L and I = P/A.</li>
              <li><b>Pros:</b> short, standard design formula. <b>Cons:</b> must handle œá<sup>(3)</sup> convention carefully.</li>
            </ul>
          </div>
          <div class="callout">
            <h4>Approach B: field-amplitude route</h4>
            <ul class="muted">
              <li>Relate nonlinear polarization to effective permittivity, then to n(E).</li>
              <li>Convert E to intensity using I = (1/2)nŒµ<sub>0</sub>c|E|¬≤.</li>
              <li><b>Pros:</b> conceptually fundamental. <b>Cons:</b> easy to lose factors (1/2, 3/4) and conventions.</li>
            </ul>
          </div>
        </div>

        <p class="muted">
          We choose <b>Approach A</b> because it is robust for engineering estimates and matches how Kerr media are commonly specified for phase modulation.
        </p>
      </section>

      <section class="block panel" id="p2">
        <h2>PART 2 ‚Äî Strategy & Tips (Roadmap Only)</h2>

        <ol class="muted" style="margin:10px 0 0 18px;">
          <li><b>Set the goal:</b> impose ŒîœÜ = œÄ on the controlled beam.</li>
          <li><b>Connect phase to index:</b> use ŒîœÜ = (2œÄ/Œª) Œîn L to find required Œîn.</li>
          <li><b>Use Kerr law:</b> Œîn = n<sub>2</sub> I<sub>control</sub> to get required control intensity.</li>
          <li><b>Compute n<sub>2</sub> from œá<sup>(3)</sup>:</b> apply the SI relation (with the correct convention).</li>
          <li><b>Convert intensity to power:</b> P = I¬∑A with A from W.</li>
          <li><b>Do sanity checks:</b> units, scaling with L and W, and typical Kerr magnitudes.</li>
        </ol>

        <div class="callout warn" style="margin-top:12px;">
          <h4>Common mistakes (quick tips)</h4>
          <ul class="muted">
            <li>Using Œª of the <b>control</b> beam inside the phase formula (the phase shift target is for the <b>controlled</b> beam at 546 nm).</li>
            <li>Forgetting that the Kerr effect depends on <b>intensity</b>, so beam area matters strongly.</li>
            <li>Mixing œá<sup>(3)</sup> conventions (whether Œµ<sub>0</sub> is included in the quoted number).</li>
            <li>Reporting average power for a pulsed system when the Kerr effect needs peak intensity (unless pulse format is specified).</li>
          </ul>
        </div>
      </section>

      <section class="block panel" id="p3">
        <h2>PART 3 ‚Äî Full Solution (Detailed + Teaching)</h2>

        <h3>Qualitative expectation (before calculating)</h3>
        <p class="muted">
          Kerr nonlinearities are typically weak: Œîn is usually on the order of 10<sup>‚àí6</sup> to 10<sup>‚àí4</sup> only at very high intensities.
          A œÄ phase shift over 10 cm at visible wavelength needs Œîn of only a few √ó10<sup>‚àí6</sup>, which sounds small‚Äîbut achieving it still
          demands very large intensity (often GW/cm¬≤ range). With a tiny beam area, this translates to tens of kW peak power, consistent with pulsed lasers.
        </p>

        <div class="hr"></div>

        <h3>Step 1 ‚Äî Required index change for a œÄ phase shift</h3>
        <p>
          The extra phase accumulated by the <b>controlled</b> beam due to an index change Œîn over length L is:
        </p>
        <div class="eq" id="eq_step1">ŒîœÜ = (2œÄ/Œª_controlled) ¬∑ Œîn ¬∑ L</div>
        <p>
          Set ŒîœÜ = œÄ. Solve for Œîn:
        </p>
        <div class="eq" id="eq_step1b">œÄ = (2œÄ/Œª) Œîn L  ‚áí  Œîn = Œª/(2L)</div>
        <div class="eqRow" style="margin-top:10px;">
          <button class="copyBtn" type="button" data-copy="#eq_step1b"><span class="dot"></span>Copy œÄ-condition</button>
        </div>
        <p class="muted">
          Interpretation: the required index change is the amount that alters the optical path by half a wavelength over the cell length.
        </p>

        <p>
          Plug in Œª = 546 nm and L = 0.10 m:
        </p>
        <div class="eq" id="eq_dn_num">Œîn_required = (546√ó10^-9 m)/(2√ó0.10 m) = 2.73√ó10^-6</div>

        <div class="hr"></div>

        <h3>Step 2 ‚Äî Kerr law: connect Œîn to control intensity</h3>
        <p>
          For an isotropic Kerr medium:
        </p>
        <div class="eq" id="eq_step2">Œîn = n2 ¬∑ I_control  ‚áí  I_control = Œîn_required / n2</div>

        <div class="hr"></div>

        <h3>Step 3 ‚Äî Compute n<sub>2</sub> from œá<sup>(3)</sup> (handle conventions carefully)</h3>
        <p>
          A commonly used SI relation between the Kerr coefficient n<sub>2</sub> (m¬≤/W) and the third-order susceptibility œá<sup>(3)</sup> (m¬≤/V¬≤) is:
        </p>
        <div class="eq" id="eq_n2">n2 = (3 œá(3)) / (4 n^2 Œµ0 c)</div>
        <div class="eqRow" style="margin-top:10px;">
          <button class="copyBtn" type="button" data-copy="#eq_n2"><span class="dot"></span>Copy n2‚Äìœá(3)</button>
        </div>

        <div class="callout warn" style="margin-top:12px;">
          <h4>Important: convert the given œá<sup>(3)</sup> to the œá<sup>(3)</sup> used in the formula</h4>
          <p class="muted" style="margin:0">
            The problem gives œá<sup>(3)</sup> in units <b>C¬∑m/V¬≥</b>. Since Œµ<sub>0</sub> has units <b>C/(V¬∑m)</b>, the quantity
            (œá<sup>(3)</sup><sub>given</sub>/Œµ<sub>0</sub>) has units <b>m¬≤/V¬≤</b>, matching the formula above. So we use:
          </p>
          <div class="eq" id="eq_conv">œá(3)_formula = œá(3)_given / Œµ0</div>
        </div>

        <p>
          Numerical evaluation:
        </p>
        <div class="eq" id="eq_chi_num">Œµ0 = 8.854√ó10^-12 C/(V¬∑m)
œá(3)_formula = (4.4√ó10^-32 C¬∑m/V^3) / (8.854√ó10^-12 C/(V¬∑m))
            = 4.97√ó10^-21 m^2/V^2</div>

        <p>
          Now compute n<sub>2</sub> with n = 1.6 and c = 3.00√ó10^8 m/s:
        </p>
        <div class="eq" id="eq_n2_num">n2 = (3√ó4.97√ó10^-21) / (4√ó(1.6)^2√ó(8.854√ó10^-12)√ó(3.00√ó10^8))
   ‚âà 5.48√ó10^-19 m^2/W</div>

        <div class="hr"></div>

        <h3>Step 4 ‚Äî Required control intensity</h3>
        <p>
          Using I = Œîn / n<sub>2</sub>:
        </p>
        <div class="eq" id="eq_I_num">I_control = (2.73√ó10^-6) / (5.48√ó10^-19)
          ‚âà 4.98√ó10^12 W/m^2</div>
        <p class="muted">
          This is about 5√ó10^8 W/cm¬≤ (hundreds of MW/cm¬≤), a typical ‚Äúhigh but plausible‚Äù pulsed-laser intensity scale for Kerr switching.
        </p>

        <div class="hr"></div>

        <h3>Step 5 ‚Äî Convert intensity to optical power</h3>
        <p>
          Intensity is power per area: I = P/A ‚áí P = I¬∑A. The problem gives a beam <b>width</b> W = 0.1 mm.
          Two common estimates for the cross-section are:
        </p>

        <div class="grid2">
          <div class="callout">
            <h4>Estimate 1: square ‚Äútop-hat‚Äù beam</h4>
            <div class="eq" id="eq_area_sq">A ‚âà W^2 = (1.0√ó10^-4 m)^2 = 1.0√ó10^-8 m^2
P_pi ‚âà I_control ¬∑ A ‚âà (4.98√ó10^12)(1.0√ó10^-8)
     ‚âà 4.98√ó10^4 W ‚âà 5.0√ó10^4 W</div>
          </div>
          <div class="callout">
            <h4>Estimate 2: circular beam (diameter = W)</h4>
            <div class="eq" id="eq_area_circ">A ‚âà œÄ (W/2)^2 = œÄ(0.5√ó10^-4 m)^2 = 7.85√ó10^-9 m^2
P_pi ‚âà (4.98√ó10^12)(7.85√ó10^-9)
     ‚âà 3.91√ó10^4 W ‚âà 3.9√ó10^4 W</div>
          </div>
        </div>

        <div class="callout ok" style="margin-top:12px;">
          <h4>Final Answer (order-of-magnitude estimate)</h4>
          <div class="eq" id="eq_final">Required control-beam power for a œÄ phase shift:
P_pi ‚âà 4√ó10^4 to 5√ó10^4 W  (‚âà 40‚Äì50 kW peak power)

(using W = 0.1 mm, L = 10 cm, Œª_controlled = 546 nm, n = 1.6, œá(3) as given)</div>
          <div class="eqRow" style="margin-top:10px;">
            <button class="copyBtn" type="button" data-copy="#eq_final"><span class="dot"></span>Copy final answer</button>
          </div>
          <p class="note">
            In pulsed operation, interpret this as <b>peak optical power</b> during the pulse overlap.
          </p>
        </div>

        <h3>Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <h4>Units / dimensions</h4>
            <ul class="muted">
              <li>Œîn is dimensionless; Œª/(2L) is dimensionless ‚úî</li>
              <li>n<sub>2</sub> has units m¬≤/W; multiplying by I (W/m¬≤) gives Œîn ‚úî</li>
              <li>P = I¬∑A gives W ‚úî</li>
            </ul>
          </div>
          <div class="callout">
            <h4>Limiting cases (scaling)</h4>
            <ul class="muted">
              <li>Longer cell: P<sub>œÄ</sub> ‚àù 1/L (double L ‚Üí half the required power).</li>
              <li>Smaller beam: P<sub>œÄ</sub> ‚àù A (tight focus lowers needed power).</li>
              <li>Shorter wavelength: P<sub>œÄ</sub> ‚àù Œª (shorter Œª needs less Œîn and less power).</li>
            </ul>
          </div>
        </div>

        <details>
          <summary>Compact symbolic result (useful as a design formula)</summary>
          <div class="eq" id="eq_symbolic">From ŒîœÜ = (2œÄ/Œª) (n2 I) L and I = P/A:
ŒîœÜ = (2œÄ/Œª) (n2 (P/A)) L

Set ŒîœÜ = œÄ:
P_pi = (A Œª) / (2 n2 L)

with n2 = (3 œá(3)) / (4 n^2 Œµ0 c)  (after matching œá(3) convention).</div>
          <div class="eqRow" style="margin-top:10px;">
            <button class="copyBtn" type="button" data-copy="#eq_symbolic"><span class="dot"></span>Copy symbolic design formula</button>
          </div>
        </details>

      </section>

      <section class="block panel" id="p4">
        <h2>PART 4 ‚Äî Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpret the final formula: what controls the required power?</h3>
        <div class="callout">
          <h4>Key dependence</h4>
          <div class="eq" id="eq_dependence">P_pi = (A Œª) / (2 n2 L)</div>
          <p class="muted" style="margin:10px 0 0">
            Each factor has a clear ‚Äúengineering lever‚Äù:
          </p>
          <ul class="muted">
            <li><b>A (area):</b> smaller overlap area ‚Üí higher intensity for the same power ‚Üí lower P<sub>œÄ</sub>.</li>
            <li><b>Œª (controlled wavelength):</b> shorter wavelength ‚Üí fewer meters needed to accumulate œÄ phase ‚Üí lower P<sub>œÄ</sub>.</li>
            <li><b>L (interaction length):</b> longer cell ‚Üí more phase per Œîn ‚Üí lower P<sub>œÄ</sub>.</li>
            <li><b>n<sub>2</sub> (material Kerr strength):</b> larger n<sub>2</sub> means stronger index change per intensity ‚Üí lower P<sub>œÄ</sub>.</li>
          </ul>
        </div>

        <h3>Alternative derivation idea (brief but meaningful)</h3>
        <details>
          <summary>Field-based route (same physics, different starting point)</summary>
          <p class="muted">
            You can begin from the nonlinear polarization term P<sup>(3)</sup> ‚àù œá<sup>(3)</sup>|E|¬≤E, treat it as a correction to the
            material‚Äôs permittivity, then compute the resulting correction to the refractive index n(E). Finally, use
            I = (1/2) n Œµ<sub>0</sub> c |E|¬≤ to replace |E|¬≤ by intensity. This route reproduces Œîn = n<sub>2</sub>I and yields the same
            P<sub>œÄ</sub> scaling, but it is easier to drop numerical factors if you mix conventions.
          </p>
        </details>

        <h3>Concept check (self-test)</h3>
        <ul class="muted">
          <li><b>Q:</b> If you double the beam width W (keeping square area A=W¬≤), what happens to P<sub>œÄ</sub>? <b>A:</b> It increases by 4√ó.</li>
          <li><b>Q:</b> If you double the cell length L, what happens to P<sub>œÄ</sub>? <b>A:</b> It decreases by 2√ó.</li>
          <li><b>Q:</b> Which wavelength goes into ŒîœÜ = (2œÄ/Œª)ŒînL? <b>A:</b> The wavelength of the beam whose phase you are modulating (the controlled beam).</li>
          <li><b>Q:</b> Why can pulsed control light help? <b>A:</b> It provides very high <b>peak</b> power (thus intensity) while keeping average power manageable.</li>
        </ul>

        <div class="callout ok" style="margin-top:12px;">
          <h4>Optional single plot (helpful here)</h4>
          <p class="muted" style="margin:0 0 10px">
            The Kerr phase shift is <b>linear</b> in control power for fixed geometry (ŒîœÜ ‚àù P). A simple line plot makes that relationship immediate and
            highlights where the œÄ point sits.
          </p>
          <figure>
            <canvas id="plot" width="900" height="460" aria-label="Plot of phase shift versus control power"></canvas>
            <figcaption>
              Phase shift on the <b>controlled</b> beam vs <b>control</b> power for this problem‚Äôs parameters (square area A=W¬≤).
              The relationship is linear: ŒîœÜ = (2œÄ/Œª)(n<sub>2</sub> L/A) P.
            </figcaption>
          </figure>
        </div>
      </section>

      <section class="block panel" id="p5">
        <h2>PART 5 ‚Äî Optional Plot Guide</h2>

        <p class="muted">
          This plot is included because it reinforces a key learning point: <b>for a Kerr cell in single-pass geometry, phase shift scales linearly with control power</b>
          (as long as Œîn remains small and overlap is constant).
        </p>

        <div class="callout">
          <h4>What the plot shows</h4>
          <ul class="muted">
            <li><b>Horizontal axis:</b> control-beam power P (kW).</li>
            <li><b>Vertical axis:</b> induced phase shift ŒîœÜ (radians) on the <b>controlled</b> beam.</li>
            <li><b>Line:</b> ŒîœÜ(P) from the derived formula using the problem‚Äôs numbers.</li>
            <li><b>Marker:</b> the point where ŒîœÜ = œÄ, i.e., P = P<sub>œÄ</sub>.</li>
          </ul>
        </div>

        <div class="callout warn" style="margin-top:12px;">
          <h4>Example values vs final result</h4>
          <p class="muted" style="margin:0">
            The plotted line uses the same numerical parameters as the solution and assumes a <b>square</b> interaction area A=W¬≤.
            The final answer is still best reported as an estimate range (square vs circular area), i.e., <b>~40‚Äì50 kW</b>.
          </p>
        </div>

        <p class="muted">
          <a href="#top" onclick="document.getElementById('top').scrollIntoView({behavior:'smooth'}); return false;">Back to top</a>
        </p>
      </section>
    </article>
  </div>
</main>

<footer>
  <div class="panel" style="padding:14px 16px;">
    <b>Note on pulsed operation:</b> The Kerr effect follows the instantaneous intensity (within the material response time), so the computed power
    should be interpreted as <b>peak power during the pulse overlap</b>. Average power depends on repetition rate and pulse duration, which are not specified here.
  </div>
</footer>

<script>
  // ---------- Copy buttons ----------
  (function(){
    function setBtnState(btn, state){
      btn.classList.remove("bad","warn");
      if(state==="ok"){
        btn.innerHTML = '<span class="dot"></span>Copied!';
        setTimeout(()=>{ btn.innerHTML = '<span class="dot"></span>' + (btn.getAttribute("data-label") || 'Copy'); }, 1100);
      }else if(state==="fail"){
        btn.classList.add("bad");
        btn.innerHTML = '<span class="dot"></span>Copy failed';
        setTimeout(()=>{ btn.classList.remove("bad"); btn.innerHTML = '<span class="dot"></span>' + (btn.getAttribute("data-label") || 'Copy'); }, 1300);
      }
    }

    document.querySelectorAll(".copyBtn").forEach(btn=>{
      const targetSel = btn.getAttribute("data-copy");
      const defaultLabel = btn.textContent.trim().replace(/^‚óè\s*/,'');
      btn.setAttribute("data-label", defaultLabel);

      btn.addEventListener("click", async ()=>{
        try{
          const el = document.querySelector(targetSel);
          const text = (el ? el.textContent : "").trim();
          if(!text) throw new Error("No text");
          await navigator.clipboard.writeText(text);
          setBtnState(btn, "ok");
        }catch(e){
          // Fallback
          try{
            const el = document.querySelector(targetSel);
            const text = (el ? el.textContent : "").trim();
            const ta = document.createElement("textarea");
            ta.value = text;
            ta.style.position="fixed";
            ta.style.left="-9999px";
            document.body.appendChild(ta);
            ta.select();
            const ok = document.execCommand("copy");
            document.body.removeChild(ta);
            if(ok) setBtnState(btn, "ok");
            else setBtnState(btn, "fail");
          }catch(_){
            setBtnState(btn, "fail");
          }
        }
      });
    });
  })();

  // ---------- Single static plot (canvas), crisp on high-DPI ----------
  (function(){
    const canvas = document.getElementById("plot");
    const parent = canvas.parentElement;
    const ctx = canvas.getContext("2d");

    // Problem parameters used for plot (square area assumption)
    const lambda = 546e-9;     // m (controlled)
    const L = 0.10;            // m
    const W = 1.0e-4;          // m
    const A = W*W;             // m^2 (square)
    const n2 = 5.48e-19;       // m^2/W (computed)

    // Linear relationship: ŒîœÜ(P) = (2œÄ/Œª)(n2 L/A) P
    const slope = (2*Math.PI/lambda) * (n2*L/A); // rad/W
    const Ppi = Math.PI / slope;                 // W

    function niceTicks(min, max, count){
      const span = max - min;
      if(span<=0) return [min];
      const rawStep = span / Math.max(1, count);
      const pow = Math.pow(10, Math.floor(Math.log10(rawStep)));
      const steps = [1,2,5,10].map(s=>s*pow);
      let step = steps[0];
      for(const s of steps){ if(Math.abs(rawStep - s) < Math.abs(rawStep - step)) step = s; }
      const start = Math.ceil(min/step)*step;
      const arr = [];
      for(let v=start; v<=max+1e-12; v+=step) arr.push(v);
      return arr;
    }

    function draw(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = parent.getBoundingClientRect();
      const cssW = Math.max(320, rect.width);
      const cssH = Math.max(260, Math.min(520, rect.width*0.52));
      canvas.style.width = cssW + "px";
      canvas.style.height = cssH + "px";
      canvas.width = Math.round(cssW*dpr);
      canvas.height = Math.round(cssH*dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);

      const w = cssW, h = cssH;
      const padL = 64, padR = 20, padT = 38, padB = 54;
      const plotW = w - padL - padR;
      const plotH = h - padT - padB;

      const Pmax = Math.max(1.15*Ppi, 6.0e4);
      const PhMaxkW = Pmax/1000;
      const yMax = slope*Pmax;
      const yTop = Math.max(1.15*Math.PI, yMax);

      function xMap(P){ return padL + (P/Pmax)*plotW; }
      function yMap(phi){ return padT + (1 - (phi/yTop))*plotH; }

      ctx.clearRect(0,0,w,h);

      const g = ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0, "rgba(255,255,255,0.05)");
      g.addColorStop(1, "rgba(255,255,255,0.02)");
      ctx.fillStyle = g;
      roundRect(ctx, 0, 0, w, h, 14);
      ctx.fill();

      ctx.fillStyle = "rgba(233,238,252,0.95)";
      ctx.font = "700 14px " + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      ctx.fillText("Kerr Phase Shift vs Control Power (square area A = W¬≤)", padL, 12);

      ctx.fillStyle = "rgba(184,194,230,0.95)";
      ctx.font = "600 12.5px " + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = "center";
      ctx.textBaseline = "alphabetic";
      ctx.fillText("Control power P (kW)", padL + plotW/2, h - 18);

      ctx.save();
      ctx.translate(18, padT + plotH/2);
      ctx.rotate(-Math.PI/2);
      ctx.textAlign = "center";
      ctx.textBaseline = "alphabetic";
      ctx.fillText("Phase shift ŒîœÜ (rad)", 0, 0);
      ctx.restore();

      const xTicks = niceTicks(0, PhMaxkW, 6);
      const yTicks = niceTicks(0, yTop, 6);

      ctx.strokeStyle = "rgba(255,255,255,0.08)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      xTicks.forEach(v=>{
        const x = xMap(v*1000);
        ctx.moveTo(x, padT);
        ctx.lineTo(x, padT+plotH);
      });
      yTicks.forEach(v=>{
        const y = yMap(v);
        ctx.moveTo(padL, y);
        ctx.lineTo(padL+plotW, y);
      });
      ctx.stroke();

      ctx.strokeStyle = "rgba(255,255,255,0.18)";
      ctx.lineWidth = 1.25;
      ctx.beginPath();
      ctx.moveTo(padL, padT);
      ctx.lineTo(padL, padT+plotH);
      ctx.lineTo(padL+plotW, padT+plotH);
      ctx.stroke();

      ctx.fillStyle = "rgba(184,194,230,0.95)";
      ctx.font = "12px " + getComputedStyle(document.body).fontFamily;

      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      xTicks.forEach(v=>{
        const x = xMap(v*1000);
        ctx.fillText(fmt(v), x, padT+plotH+8);
      });

      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      yTicks.forEach(v=>{
        const y = yMap(v);
        ctx.fillText(fmt(v), padL-8, y);
      });

      ctx.strokeStyle = "rgba(125,255,204,0.92)";
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      const N = 240;
      for(let i=0;i<=N;i++){
        const P = (i/N)*Pmax;
        const phi = slope*P;
        const x = xMap(P);
        const y = yMap(phi);
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.stroke();

      const yPi = yMap(Math.PI);
      ctx.strokeStyle = "rgba(255,204,102,0.80)";
      ctx.lineWidth = 1.8;
      ctx.setLineDash([6,6]);
      ctx.beginPath();
      ctx.moveTo(padL, yPi);
      ctx.lineTo(padL+plotW, yPi);
      ctx.stroke();
      ctx.setLineDash([]);

      const xPi = xMap(Ppi);
      const yPiPt = yMap(Math.PI);
      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.beginPath();
      ctx.arc(xPi, yPiPt, 4.6, 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = "rgba(233,238,252,0.92)";
      ctx.font = "600 12px " + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = "left";
      ctx.textBaseline = "bottom";
      const label = "ŒîœÜ = œÄ at P ‚âà " + fmt(Ppi/1000) + " kW";
      const lx = Math.min(padL+plotW-10, xPi+10);
      const ly = Math.max(padT+18, yPiPt-10);
      const m = 6;
      const wText = ctx.measureText(label).width;
      ctx.fillStyle = "rgba(0,0,0,0.45)";
      roundRect(ctx, lx-m, ly-16-m, wText+2*m, 18+2*m, 10);
      ctx.fill();
      ctx.fillStyle = "rgba(233,238,252,0.94)";
      ctx.fillText(label, lx, ly-6);

      const legendX = padL + 10;
      const legendY = padT + 8;
      ctx.fillStyle = "rgba(0,0,0,0.28)";
      roundRect(ctx, legendX, legendY, 250, 44, 12);
      ctx.fill();

      ctx.font = "600 12px " + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";

      ctx.strokeStyle = "rgba(125,255,204,0.92)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(legendX+12, legendY+14);
      ctx.lineTo(legendX+42, legendY+14);
      ctx.stroke();
      ctx.fillStyle = "rgba(233,238,252,0.92)";
      ctx.fillText("ŒîœÜ(P) from Kerr effect", legendX+52, legendY+14);

      ctx.strokeStyle = "rgba(255,204,102,0.80)";
      ctx.lineWidth = 2;
      ctx.setLineDash([6,6]);
      ctx.beginPath();
      ctx.moveTo(legendX+12, legendY+32);
      ctx.lineTo(legendX+42, legendY+32);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = "rgba(233,238,252,0.92)";
      ctx.fillText("Reference: ŒîœÜ = œÄ", legendX+52, legendY+32);
    }

    function fmt(x){
      const ax = Math.abs(x);
      if(ax >= 1000) return (x/1000).toFixed(0) + "k";
      if(ax >= 100) return x.toFixed(0);
      if(ax >= 10) return x.toFixed(0);
      if(ax >= 1) return x.toFixed(1).replace(/\.0$/,'');
      if(ax >= 0.1) return x.toFixed(2).replace(/0$/,'').replace(/\.0$/,'');
      return x.toExponential(1);
    }

    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    let raf = null;
    function requestRedraw(){
      if(raf) cancelAnimationFrame(raf);
      raf = requestAnimationFrame(draw);
    }

    window.addEventListener("resize", requestRedraw, {passive:true});
    requestRedraw();
  })();
</script>
</body>
</html>
