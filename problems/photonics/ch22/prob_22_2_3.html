<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Matching Conditions for Collinear Type-II SHG in KDP (λ = 1.06 μm)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --ink:#eaf0ff;
      --muted:#b9c4e6;
      --soft:#7f8bb6;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --accent:#7ee0ff;
      --accent2:#b7ff9a;
      --warn:#ffd37e;
      --bad:#ff7ea6;
      --good:#7dffa8;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:24px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(126,224,255,.20), transparent 60%),
        radial-gradient(1000px 600px at 110% 20%, rgba(183,255,154,.14), transparent 55%),
        radial-gradient(900px 500px at 40% 110%, rgba(255,126,166,.10), transparent 55%),
        linear-gradient(180deg, #070a14, var(--bg));
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code,kbd,pre{font-family:var(--mono)}
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:28px 18px 60px;
    }

    header.hero{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 26px 22px;
      position:relative;
      overflow:hidden;
    }
    header.hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(800px 220px at 20% 0%, rgba(126,224,255,.18), transparent 60%),
        radial-gradient(700px 240px at 90% 10%, rgba(183,255,154,.10), transparent 58%);
      pointer-events:none;
      filter:saturate(1.1);
    }
    header.hero > *{position:relative}
    .title{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .title h1{
      margin:0;
      font-size: clamp(1.25rem, 1.4rem + 1.2vw, 2.2rem);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:.35rem 0 0;
      color:var(--muted);
      max-width:70ch;
    }
    .meta{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:var(--soft);
      font-size:.95rem;
    }
    .pill{
      border:1px solid var(--line2);
      background: rgba(255,255,255,.04);
      padding:6px 10px;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      backdrop-filter: blur(6px);
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(126,224,255,.15);
      flex:0 0 auto;
    }

    .layout{
      margin-top:18px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      align-items:start;
    }

    nav.toc{
      position: sticky;
      top: 14px;
      border:1px solid var(--line);
      background: rgba(17,26,51,.72);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .tocHeader{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.04);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .tocHeader strong{font-size:.98rem}
    .tocHeader span{
      color:var(--soft);
      font-size:.9rem;
      white-space:nowrap;
    }
    .tocLinks{
      padding:10px 8px 12px;
    }
    .tocLinks a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      font-size:.95rem;
      border:1px solid transparent;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .tocLinks a:hover{
      background: rgba(126,224,255,.08);
      border-color: rgba(126,224,255,.22);
      transform: translateX(2px);
      text-decoration:none;
      color: var(--ink);
    }
    .tocFooter{
      padding:10px 14px 14px;
      border-top:1px solid var(--line);
      color:var(--soft);
      font-size:.9rem;
    }

    main{
      min-width:0;
    }

    section.card{
      border:1px solid var(--line);
      background: rgba(17,26,51,.60);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      margin-bottom: 16px;
      overflow:hidden;
    }
    section.card h2{
      margin:0 0 10px;
      font-size:1.25rem;
      letter-spacing:.15px;
    }
    section.card h3{
      margin:18px 0 8px;
      font-size:1.05rem;
      color:var(--ink);
    }
    p{margin:.55rem 0}
    ul{margin:.35rem 0 .6rem 1.2rem}
    li{margin:.28rem 0}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      .layout{grid-template-columns: 1fr}
      nav.toc{position:relative; top:auto}
    }
    @media (max-width: 760px){
      .grid2{grid-template-columns: 1fr}
    }

    .callout{
      border:1px solid var(--line2);
      border-radius: 16px;
      padding: 12px 12px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      position:relative;
      overflow:hidden;
    }
    .callout:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(520px 120px at 15% 0%, rgba(126,224,255,.14), transparent 60%);
      pointer-events:none;
    }
    .callout > *{position:relative}
    .calloutTitle{
      display:flex; align-items:center; gap:10px;
      margin:0 0 6px;
      font-weight:700;
      letter-spacing:.2px;
    }
    .badge{
      width:10px;height:10px;border-radius:999px;
      background: var(--warn);
      box-shadow: 0 0 0 4px rgba(255,211,126,.14);
      flex:0 0 auto;
    }
    .badge.good{background:var(--good); box-shadow: 0 0 0 4px rgba(125,255,168,.14)}
    .badge.bad{background:var(--bad); box-shadow: 0 0 0 4px rgba(255,126,166,.14)}
    .note{
      color:var(--muted);
      font-size:.96rem;
    }

    .eq{
      margin:10px 0 8px;
      border:1px solid var(--line2);
      background: rgba(0,0,0,.24);
      border-radius: 16px;
      overflow:hidden;
    }
    .eqTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .eqTop strong{font-size:.95rem}
    .copyBtn{
      appearance:none;
      border:1px solid rgba(126,224,255,.30);
      background: rgba(126,224,255,.12);
      color: var(--ink);
      padding:7px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      white-space:nowrap;
    }
    .copyBtn:hover{
      transform: translateY(-1px);
      background: rgba(126,224,255,.16);
      border-color: rgba(126,224,255,.44);
    }
    .copyBtn:active{transform: translateY(0px) scale(.99)}
    .eq pre{
      margin:0;
      padding: 12px 12px 12px;
      color: #e9eeff;
      overflow:auto;
      font-size: .95rem;
      line-height: 1.45;
      white-space: pre-wrap;
    }

    details{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(255,255,255,.03);
      padding: 10px 12px;
      margin: 10px 0 0;
    }
    summary{
      cursor:pointer;
      font-weight:700;
      color: var(--muted);
      list-style:none;
      display:flex;
      align-items:center;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    summary:before{
      content:"▸";
      color: var(--accent);
      font-size: 1.05rem;
      transform: translateY(-1px);
      transition: transform .14s ease;
    }
    details[open] summary:before{transform: rotate(90deg) translateX(2px)}
    details .note{margin-top:8px}

    figure.plot{
      margin: 12px 0 4px;
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    figure.plot figcaption{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      color: var(--muted);
      font-size: .95rem;
      background: rgba(255,255,255,.03);
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      aspect-ratio: 16 / 9;
      background: transparent;
    }

    .final{
      border:1px solid rgba(183,255,154,.26);
      background: linear-gradient(180deg, rgba(183,255,154,.12), rgba(183,255,154,.06));
    }
    .final .calloutTitle{color:#eafff0}
    .final .badge{background:var(--good)}
    .small{
      color:var(--soft);
      font-size:.92rem;
    }

    .backTop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:12px;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid var(--line2);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      text-decoration:none;
      transition: transform .14s ease, border-color .14s ease, background .14s ease;
    }
    .backTop:hover{
      transform: translateY(-1px);
      border-color: rgba(126,224,255,.35);
      background: rgba(126,224,255,.07);
      color: var(--ink);
      text-decoration:none;
    }

    footer{
      margin-top: 18px;
      color: var(--soft);
      font-size: .92rem;
      padding: 6px 2px 0;
    }
    .refs{
      margin:10px 0 0;
      padding-left: 18px;
    }

    /* Print */
    @media print{
      body{background:#fff; color:#000}
      header.hero, section.card, nav.toc{box-shadow:none}
      nav.toc{display:none}
      .layout{grid-template-columns: 1fr}
      section.card{break-inside: avoid; page-break-inside: avoid; background:#fff; border-color:#ccc}
      .eq{background:#fff}
      .copyBtn{display:none}
      a{color:#000; text-decoration:underline}
      figure.plot{border-color:#ccc}
      .backTop{display:none}
    }
  </style>
</head>

<body>
  <div class="wrap" id="top">
    <header class="hero">
      <div class="title">
        <div>
          <h1>Matching Conditions for Collinear Type-II SHG in KDP (λ = 1.06 μm)</h1>
          <p class="subtitle">
            Determine the phase-matching angle <span style="white-space:nowrap;">θ</span> (between the propagation direction and the optic axis)
            for Type-II second-harmonic generation in a KDP crystal for the two polarization configurations
            <span style="white-space:nowrap;">o-e-o</span> and <span style="white-space:nowrap;">o-e-e</span>, using Sellmeier dispersion.
          </p>
        </div>
        <div class="meta">
          <span class="pill"><span class="dot"></span>Collinear SHG</span>
          <span class="pill"><span class="dot" style="background:var(--accent2); box-shadow:0 0 0 3px rgba(183,255,154,.15)"></span>Uniaxial birefringence</span>
          <span class="pill"><span class="dot" style="background:var(--warn); box-shadow:0 0 0 3px rgba(255,211,126,.14)"></span>Type-II (o + e)</span>
        </div>
      </div>
    </header>

    <div class="layout">
      <nav class="toc" aria-label="Table of contents">
        <div class="tocHeader">
          <strong>Table of Contents</strong>
          <span>sticky</span>
        </div>
        <div class="tocLinks">
          <a href="#quick">Quick Summary</a>
          <a href="#part0">PART 0 — Concept Primer</a>
          <a href="#part1">PART 1 — Problem Analysis</a>
          <a href="#part2">PART 2 — Strategy &amp; Tips</a>
          <a href="#part3">PART 3 — Full Solution</a>
          <a href="#part4">PART 4 — Deeper Understanding</a>
          <a href="#part5">PART 5 — Optional Plot Guide</a>
        </div>
        <div class="tocFooter">
          <div class="small">Tip: the copy buttons grab plain text equations and the final numerical answers.</div>
        </div>
      </nav>

      <main>
        <section class="card" id="quick">
          <h2>Quick Summary</h2>
          <ul>
            <li><strong>What this is about:</strong> finding the <strong>phase-matching angle</strong> θ for <strong>collinear Type-II SHG</strong> (ω + ω → 2ω) in <strong>KDP</strong>.</li>
            <li><strong>Key physics idea:</strong> efficient SHG requires <strong>phase matching</strong>: the generated 2ω wave stays in phase with the nonlinear polarization driving it.</li>
            <li><strong>Governing condition (collinear):</strong> <code>k(2ω) = k(ω,o) + k(ω,e)</code>, which becomes <code>2 n(2ω) = n_o(ω) + n_e(ω,θ)</code> (or with <code>n_e(2ω,θ)</code> if the SH is extraordinary).</li>
            <li><strong>Birefringence control:</strong> the extraordinary refractive index depends on direction:
              <code>1/n_e(θ)^2 = cos^2θ/n_e^2 + sin^2θ/n_o^2</code>.
            </li>
            <li><strong>Dispersion model used:</strong> Sellmeier form <code>n(λ)^2 = A + B/(λ^2 − C) + D λ^2/(λ^2 − E)</code> (λ in μm).</li>
            <li><strong>Result type:</strong> mostly <strong>numeric</strong> (θ in degrees) because Sellmeier dispersion is numeric.</li>
            <li><strong>Physical meaning of θ:</strong> the crystal cut/tilt that makes the extraordinary wave’s phase velocity “just right” to match wavevectors.</li>
            <li><strong>Main outcomes:</strong> for λ = 1.06 μm in KDP, <strong>o-e-e has a real solution</strong> (θ ≈ 31°), while <strong>o-e-o does not</strong> (no collinear phase matching at this wavelength).</li>
          </ul>

          <div class="grid2">
            <div class="callout">
              <div class="calloutTitle"><span class="badge"></span>What you should remember</div>
              <p class="note">
                In a uniaxial crystal, you can tune phase matching by changing direction only for the <strong>extraordinary</strong> wave.
                If the required index value lies outside the allowed range of <code>n_e(θ)</code>, <strong>no solution exists</strong>.
              </p>
            </div>
            <div class="callout final">
              <div class="calloutTitle"><span class="badge good"></span>Final headline answers</div>
              <p class="note">
                <strong>o-e-o:</strong> no real θ (collinear phase matching impossible at 1.06 μm).<br/>
                <strong>o-e-e:</strong> θ ≈ <strong>31.1°</strong> (from optic axis).
              </p>
            </div>
          </div>

          <a class="backTop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </section>

        <section class="card" id="part0">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

          <h3>Core definitions (symbols + units)</h3>
          <ul>
            <li><strong>λ</strong> (meters, m): vacuum wavelength of the fundamental. Here λ = 1.06 μm = 1.06×10<sup>−6</sup> m.</li>
            <li><strong>ω</strong> (rad/s): optical angular frequency. SHG produces 2ω with vacuum wavelength λ/2.</li>
            <li><strong>k</strong> (rad/m): wavevector magnitude in a medium, <code>k = (2π/λ) n(λ)</code>.</li>
            <li><strong>n<sub>o</sub>(λ)</strong> (dimensionless): ordinary refractive index (polarization ⟂ optic axis).</li>
            <li><strong>n<sub>e</sub>(λ)</strong> (dimensionless): principal extraordinary index (for propagation along a principal direction; commonly tied to the optic axis direction in the index ellipsoid).</li>
            <li><strong>n<sub>e</sub>(λ,θ)</strong> (dimensionless): <em>effective</em> extraordinary refractive index for propagation at angle θ to the optic axis.</li>
            <li><strong>θ</strong> (degrees or radians): angle between propagation direction (wavevector) and the optic axis.</li>
          </ul>

          <h3>Physical meaning (intuition)</h3>
          <p>
            SHG is driven by a nonlinear polarization at 2ω. As the fundamental waves propagate, each slice of crystal tries to generate a tiny 2ω field.
            If the newly generated 2ω field stays <em>in phase</em> with the already-generated 2ω field, contributions add constructively and SH power grows strongly.
            If they slip out of phase, growth oscillates and averages out.
          </p>

          <h3>Key principles and validity conditions</h3>
          <div class="callout">
            <div class="calloutTitle"><span class="badge"></span>Phase matching principle</div>
            <p class="note">
              The <strong>best</strong> (ideal) case is <strong>Δk = 0</strong>, where
              <code>Δk = k(2ω) − k(ω,1) − k(ω,2)</code>.
              For <strong>collinear</strong> beams, all k vectors are along one axis (same direction).
            </p>
          </div>
          <ul>
            <li>We assume <strong>plane waves</strong> and <strong>collinear propagation</strong> (no walk-off geometry needed to write the matching condition).</li>
            <li>We use <strong>linear refractive indices</strong> from Sellmeier equations (ignoring intensity-dependent index changes).</li>
            <li>We assume <strong>room temperature</strong> and negligible absorption at 1.06 μm and 0.53 μm.</li>
          </ul>

          <h3>Common model: extraordinary index vs angle</h3>
          <p>
            In a uniaxial crystal, the extraordinary wave “feels” a direction-dependent phase index.
            Using the index ellipsoid, the effective extraordinary index for a wavevector at angle θ to the optic axis is:
          </p>

          <div class="eq" data-copy="eq-ne-theta">
            <div class="eqTop">
              <strong>Extraordinary effective index (uniaxial)</strong>
              <button class="copyBtn" data-copy-btn="eq-ne-theta">Copy</button>
            </div>
            <pre id="eq-ne-theta">1 / n_e(λ,θ)^2 = cos^2(θ) / n_e(λ)^2 + sin^2(θ) / n_o(λ)^2</pre>
          </div>

          <p class="small">
            Important consequence: <code>n_e(λ,θ)</code> always lies between the principal values <code>n_e(λ)</code> and <code>n_o(λ)</code>
            (it cannot exceed the larger of them).
          </p>

          <h3>Mini intuition examples (quick conceptual)</h3>
          <ul>
            <li><strong>If θ = 0°</strong> (propagation along optic axis): the extraordinary wave uses <code>n_e(λ,0) = n_e(λ)</code>.</li>
            <li><strong>If θ = 90°</strong> (propagation perpendicular to optic axis): <code>n_e(λ,90°) = n_o(λ)</code>.</li>
            <li><strong>Tuning lever:</strong> by rotating the crystal, you can continuously tune <code>n_e(λ,θ)</code> between those endpoints.</li>
          </ul>

          <h3>What to watch for (pitfalls)</h3>
          <ul>
            <li><strong>Angle definition:</strong> θ here is between <em>wavevector</em> and optic axis (not necessarily the energy flow direction).</li>
            <li><strong>Type-II notation:</strong> “o-e-o” means one fundamental is ordinary, the other is extraordinary, and the SH is ordinary (similarly for “o-e-e”).</li>
            <li><strong>No-solution situations:</strong> if the required <code>n_e(θ)</code> is outside <code>[min(n_e,n_o), max(n_e,n_o)]</code>, phase matching is impossible in that configuration.</li>
            <li><strong>Use consistent wavelengths:</strong> SH wavelength is λ/2 in vacuum, so dispersion must be evaluated at both λ and λ/2.</li>
          </ul>

          <details>
            <summary>Deeper note: why the collinear condition becomes <code>2 n(2ω) = n(ω,1) + n(ω,2)</code></summary>
            <p class="note">
              For collinear propagation, <code>k = (2π/λ) n</code>.
              In SHG, the generated wave has vacuum wavelength λ/2, so
              <code>k(2ω) = 2π n(λ/2) / (λ/2) = (4π/λ) n(λ/2)</code>.
              The two fundamentals contribute <code>(2π/λ)[n(ω,1)+n(ω,2)]</code>.
              Setting <code>k(2ω) = k(ω,1)+k(ω,2)</code> and cancelling <code>2π/λ</code> yields
              <code>2 n(λ/2) = n(ω,1)+n(ω,2)</code>.
            </p>
          </details>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section class="card" id="part1">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

          <h3>Problem restatement (in plain words)</h3>
          <p>
            We have a KDP crystal used for Type-II SHG converting a fundamental wavelength λ = 1.06 μm into its second harmonic at λ/2 = 0.53 μm.
            For each polarization configuration (o-e-o and o-e-e), find the propagation angle θ (relative to the optic axis) that satisfies collinear phase matching,
            using Sellmeier equations to compute refractive indices versus wavelength.
          </p>

          <div class="grid2">
            <div class="callout">
              <div class="calloutTitle"><span class="badge"></span>Given</div>
              <ul class="note">
                <li>Crystal: KDP (uniaxial, birefringent)</li>
                <li>Fundamental wavelength: λ = 1.06 μm</li>
                <li>Second harmonic wavelength: λ/2 = 0.53 μm</li>
                <li>Type-II configurations: o-e-o and o-e-e</li>
                <li>Dispersion: Sellmeier equations (λ in μm)</li>
              </ul>
            </div>
            <div class="callout">
              <div class="calloutTitle"><span class="badge"></span>Unknowns / required output</div>
              <ul class="note">
                <li>Phase-matching angle θ for each configuration (if it exists)</li>
                <li>Clear statement if a configuration has <strong>no real θ</strong></li>
              </ul>
            </div>
          </div>

          <h3>Relevant principles (and why they apply)</h3>
          <ul>
            <li><strong>Wavevector matching (Δk = 0):</strong> necessary for efficient SHG in a long crystal.</li>
            <li><strong>Uniaxial birefringence:</strong> allows tuning of extraordinary index via θ, giving a practical phase-matching knob.</li>
            <li><strong>Sellmeier dispersion:</strong> needed because refractive indices differ at 1.06 μm and 0.53 μm.</li>
          </ul>

          <h3>Assumptions (explicit)</h3>
          <div class="callout">
            <div class="calloutTitle"><span class="badge"></span>Assumptions used</div>
            <ul class="note">
              <li>Collinear propagation (all k vectors parallel)</li>
              <li>Plane-wave refractive indices (no focusing corrections)</li>
              <li>Room-temperature Sellmeier coefficients (no thermo-optic tuning)</li>
              <li>Neglect absorption and nonlinear index changes</li>
            </ul>
          </div>

          <h3>Possible approaches (compare 2–3)</h3>
          <ul>
            <li>
              <strong>Approach A — Direct algebra + inversion (best when SH is ordinary):</strong><br/>
              Use <code>2 n_o(λ/2) = n_o(λ) + n_e(λ,θ)</code>, solve for required <code>n_e(λ,θ)</code>, then invert the index-vs-θ formula.
              <em>Pro:</em> closed-form for θ. <em>Con:</em> only works if the unknown is a single <code>n_e(θ)</code>.
            </li>
            <li>
              <strong>Approach B — Numerical root finding (general case):</strong><br/>
              Write <code>Δk(θ) = 0</code> for the chosen polarizations and solve for θ.
              <em>Pro:</em> works for any configuration. <em>Con:</em> requires computation (but still straightforward).
            </li>
            <li>
              <strong>Approach C — Graphical tuning curve:</strong><br/>
              Plot mismatch vs θ and locate zero crossing.
              <em>Pro:</em> gives intuition and reveals “no solution”. <em>Con:</em> needs plotting (we’ll include one simple static plot).
            </li>
          </ul>
          <p>
            <strong>Choice:</strong> Use a hybrid: apply Approach A to quickly test feasibility for o-e-o, and use Approach B for the o-e-e case (since both ω and 2ω extraordinary indices can depend on θ).
            We also include a single static plot (Approach C) to make the “solution vs no-solution” visually obvious.
          </p>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section class="card" id="part2">
          <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>

          <ol>
            <li><strong>Compute wavelengths:</strong> set fundamental λ and SH λ/2 (goal: know where to evaluate dispersion).</li>
            <li><strong>Get KDP dispersion:</strong> write Sellmeier equations for <code>n_o(λ)</code> and <code>n_e(λ)</code> (goal: indices at λ and λ/2).</li>
            <li><strong>Compute principal indices:</strong> evaluate <code>n_o</code>, <code>n_e</code> at 1.06 μm and 0.53 μm (goal: numeric inputs).</li>
            <li><strong>Write extraordinary angle law:</strong> <code>n_e(λ,θ)</code> formula (goal: tunable index).</li>
            <li><strong>Write phase matching for each case:</strong>
              <ul>
                <li>o-e-o: <code>2 n_o(λ/2) = n_o(λ) + n_e(λ,θ)</code></li>
                <li>o-e-e: <code>2 n_e(λ/2,θ) = n_o(λ) + n_e(λ,θ)</code></li>
              </ul>
            </li>
            <li><strong>Feasibility check:</strong> ensure required <code>n_e(θ)</code> is within allowable range (goal: detect “no θ”).</li>
            <li><strong>Solve for θ:</strong> invert analytically if possible; otherwise solve numerically (goal: θ in degrees).</li>
            <li><strong>Sanity checks:</strong> confirm θ is physical (0–90°) and mismatch sign changes appropriately (goal: confidence).</li>
          </ol>

          <div class="callout">
            <div class="calloutTitle"><span class="badge bad"></span>Common mistakes (fast checklist)</div>
            <ul class="note">
              <li>Forgetting that SH wavelength is <strong>λ/2</strong> (so you must evaluate dispersion at 0.53 μm).</li>
              <li>Mixing up <strong>principal</strong> extraordinary index <code>n_e(λ)</code> with <strong>effective</strong> index <code>n_e(λ,θ)</code>.</li>
              <li>Assuming every configuration must have a solution—some do not because <code>n_e(θ)</code> has a limited range.</li>
              <li>Using degrees inside trig functions when your calculator expects radians (if you do numeric solving by hand/software).</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section class="card" id="part3">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

          <h3>Qualitative expectation before calculating</h3>
          <p>
            KDP is a negative uniaxial crystal in the visible/near-IR (typically <code>n_e &lt; n_o</code>).
            Therefore the extraordinary effective index <code>n_e(θ)</code> can be tuned upward from <code>n_e</code> (at θ = 0°)
            toward <code>n_o</code> (at θ = 90°), but it <em>cannot exceed</em> <code>n_o</code>.
            If phase matching demands an extraordinary index larger than <code>n_o</code>, that configuration is impossible in collinear geometry.
          </p>

          <h3>Step 1: Dispersion model (Sellmeier equations)</h3>
          <p>
            We use the Sellmeier form (λ in μm):
          </p>

          <div class="eq" data-copy="eq-sell">
            <div class="eqTop">
              <strong>Sellmeier model</strong>
              <button class="copyBtn" data-copy-btn="eq-sell">Copy</button>
            </div>
            <pre id="eq-sell">n(λ)^2 = A + B/(λ^2 − C) + D λ^2/(λ^2 − E)    (λ in μm)</pre>
          </div>

          <p class="note">
            For KDP, the coefficients (room temperature) are tabulated for both ordinary and extraordinary indices. Source values are listed below. (λ in μm) <a href="#refs">[Ref]</a>
          </p>

          <details>
            <summary>Show the KDP coefficients used (plain text)</summary>
            <div class="eq" data-copy="eq-coeff">
              <div class="eqTop">
                <strong>KDP Sellmeier coefficients (from the referenced table)</strong>
                <button class="copyBtn" data-copy-btn="eq-coeff">Copy</button>
              </div>
              <pre id="eq-coeff">KDP (λ in μm), Sellmeier: n^2 = A + B/(λ^2 − C) + D λ^2/(λ^2 − E)

Ordinary (n_o): A = 2.2576, B = 0.0101, C = 0.0142, D = 1.7623, E = 57.8984
Extraordinary (n_e): A = 2.1295, B = 0.0097, C = 0.0014, D = 0.7580, E = 127.0535</pre>
            </div>
            <p class="small">
              These coefficients reproduce common handbook values near 1064 nm and 532 nm to within typical rounding.
            </p>
          </details>

          <h3>Step 2: Evaluate principal indices at λ and λ/2</h3>
          <p>
            With λ = 1.06 μm and λ/2 = 0.53 μm, the computed refractive indices are:
          </p>

          <div class="callout">
            <div class="calloutTitle"><span class="badge good"></span>Computed indices (using the coefficients above)</div>
            <ul class="note">
              <li><code>n_o(1.06 μm) ≈ 1.49393</code></li>
              <li><code>n_e(1.06 μm) ≈ 1.45992</code></li>
              <li><code>n_o(0.53 μm) ≈ 1.51224</code></li>
              <li><code>n_e(0.53 μm) ≈ 1.47055</code></li>
            </ul>
            <p class="small">
              (These are consistent with typical published values at 1064 nm and 532 nm.) <a href="#refs">[Ref]</a>
            </p>
          </div>

          <h3>Step 3: Extraordinary effective index vs angle</h3>
          <p>
            For propagation at angle θ to the optic axis:
          </p>
          <div class="eq" data-copy="eq-ne-theta2">
            <div class="eqTop">
              <strong>Extraordinary effective index (reused)</strong>
              <button class="copyBtn" data-copy-btn="eq-ne-theta2">Copy</button>
            </div>
            <pre id="eq-ne-theta2">n_e(λ,θ) = 1 / sqrt( cos^2(θ)/n_e(λ)^2 + sin^2(θ)/n_o(λ)^2 )</pre>
          </div>

          <h3>Step 4: Phase matching conditions for Type-II collinear SHG</h3>
          <p>
            For Type-II SHG, the two fundamental waves are orthogonally polarized (one ordinary, one extraordinary).
            Collinear phase matching enforces:
          </p>

          <div class="eq" data-copy="eq-pm">
            <div class="eqTop">
              <strong>Collinear Type-II SHG matching</strong>
              <button class="copyBtn" data-copy-btn="eq-pm">Copy</button>
            </div>
            <pre id="eq-pm">k(2ω) = k(ω,o) + k(ω,e)  ⇒  2 n(2ω) = n_o(ω) + n_e(ω,θ)</pre>
          </div>

          <p>
            The only subtlety is what polarization the <strong>second-harmonic</strong> wave has:
          </p>
          <ul>
            <li><strong>o-e-o:</strong> SH is ordinary → <code>n(2ω) = n_o(λ/2)</code> (independent of θ).</li>
            <li><strong>o-e-e:</strong> SH is extraordinary → <code>n(2ω) = n_e(λ/2,θ)</code> (depends on θ).</li>
          </ul>

          <h3>Case A: o-e-o configuration</h3>
          <p>
            Here the SH is ordinary, so the matching equation becomes
          </p>

          <div class="eq" data-copy="eq-oeo">
            <div class="eqTop">
              <strong>o-e-o phase matching equation</strong>
              <button class="copyBtn" data-copy-btn="eq-oeo">Copy</button>
            </div>
            <pre id="eq-oeo">2 n_o(λ/2) = n_o(λ) + n_e(λ,θ)</pre>
          </div>

          <p>
            Solve for the required extraordinary effective index at the fundamental:
          </p>

          <div class="eq" data-copy="eq-oeo-target">
            <div class="eqTop">
              <strong>Required extraordinary index value (o-e-o)</strong>
              <button class="copyBtn" data-copy-btn="eq-oeo-target">Copy</button>
            </div>
            <pre id="eq-oeo-target">n_e(λ,θ) = 2 n_o(λ/2) − n_o(λ)</pre>
          </div>

          <p>
            Substitute the computed indices:
          </p>
          <div class="callout">
            <div class="calloutTitle"><span class="badge bad"></span>Feasibility check (o-e-o)</div>
            <p class="note">
              Required <code>n_e(1.06 μm,θ) = 2·1.51224 − 1.49393 ≈ 1.53056</code>.<br/>
              But for KDP at 1.06 μm, <code>n_e(θ)</code> can only vary between
              <code>n_e(1.06) ≈ 1.45992</code> and <code>n_o(1.06) ≈ 1.49393</code>.<br/>
              Since <code>1.53056 &gt; 1.49393</code>, the needed value is outside the allowed range.
            </p>
          </div>

          <div class="callout final">
            <div class="calloutTitle"><span class="badge bad"></span>Conclusion for o-e-o</div>
            <p class="note">
              <strong>No real phase-matching angle θ exists</strong> for collinear Type-II SHG in KDP at λ = 1.06 μm in the <strong>o-e-o</strong> configuration.
              (The required extraordinary index is unattainably large.)
            </p>
          </div>

          <h3>Case B: o-e-e configuration</h3>
          <p>
            Now the SH is extraordinary, so both the fundamental extraordinary index and the SH extraordinary index depend on θ:
          </p>

          <div class="eq" data-copy="eq-oee">
            <div class="eqTop">
              <strong>o-e-e phase matching equation</strong>
              <button class="copyBtn" data-copy-btn="eq-oee">Copy</button>
            </div>
            <pre id="eq-oee">2 n_e(λ/2,θ) = n_o(λ) + n_e(λ,θ)</pre>
          </div>

          <p>
            This equation generally does not reduce to a simple closed-form θ because θ appears inside two different dispersion-evaluated functions:
            <code>n_e(0.53 μm,θ)</code> and <code>n_e(1.06 μm,θ)</code>. The clean method is to solve it as a one-variable root:
          </p>

          <div class="eq" data-copy="eq-root">
            <div class="eqTop">
              <strong>Root form (solve Δ(θ) = 0)</strong>
              <button class="copyBtn" data-copy-btn="eq-root">Copy</button>
            </div>
            <pre id="eq-root">Define Δ(θ) = 2 n_e(λ/2,θ) − n_o(λ) − n_e(λ,θ).
Phase matching ⇔ Δ(θ) = 0.</pre>
          </div>

          <p>
            Using the Sellmeier indices above and the uniaxial effective-index relation, the numerical solution in the physical range 0°–90° is:
          </p>

          <div class="callout final" id="finalBox">
            <div class="calloutTitle"><span class="badge good"></span>Final answer (o-e-e)</div>
            <p class="note" style="margin-bottom:8px">
              <strong>θ ≈ 31.1°</strong> (angle between propagation direction and the optic axis).
            </p>
            <p class="small">
              At this θ, the collinear wavevector condition is satisfied: the SH extraordinary phase velocity is tuned (via birefringence) to match the sum of the fundamental wavevectors.
            </p>
          </div>

          <div class="eq" data-copy="eq-final">
            <div class="eqTop">
              <strong>Final answers (plain text)</strong>
              <button class="copyBtn" data-copy-btn="eq-final">Copy</button>
            </div>
            <pre id="eq-final">For KDP, λ = 1.06 μm (SH at 0.53 μm), collinear Type-II SHG:

o-e-o: no real θ (phase matching impossible).
o-e-e: θ ≈ 31.1° (from optic axis).</pre>
          </div>

          <h3>Sanity checks</h3>
          <div class="grid2">
            <div class="callout">
              <div class="calloutTitle"><span class="badge good"></span>Units / dimensions</div>
              <p class="note">
                Phase matching uses <code>k = (2π/λ) n</code>. The condition reduces to <code>2 n(λ/2) = n(λ,1)+n(λ,2)</code>,
                which is dimensionless on both sides. No hidden unit inconsistencies.
              </p>
            </div>
            <div class="callout">
              <div class="calloutTitle"><span class="badge good"></span>Limiting logic</div>
              <p class="note">
                For o-e-o, the required <code>n_e(θ)</code> is larger than <code>n_o</code>, impossible because <code>n_e(θ)</code> is bounded by the principal indices.
                For o-e-e, the equation can be satisfied because both sides involve tunable extraordinary indices and dispersion at 0.53 μm is stronger.
              </p>
            </div>
          </div>

          <figure class="plot" aria-label="Phase-mismatch plot">
            <figcaption>
              Single static plot: mismatch functions Δ(θ) showing why o-e-e has a solution (zero crossing) while o-e-o does not.
            </figcaption>
            <canvas id="plot" width="1280" height="720"></canvas>
          </figure>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section class="card" id="part4">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

          <h3>Re-interpreting the final condition</h3>
          <p>
            For Type-II collinear SHG, the “core balancing act” is:
            the 2ω wave’s <strong>phase index</strong> must equal the average (in this degenerate case) of the two fundamental phase indices:
          </p>
          <div class="eq" data-copy="eq-interpret">
            <div class="eqTop">
              <strong>Interpretation form</strong>
              <button class="copyBtn" data-copy-btn="eq-interpret">Copy</button>
            </div>
            <pre id="eq-interpret">Degenerate Type-II SHG (collinear) requires:
n(2ω) = [n_o(ω) + n_e(ω,θ)] / 2
(with n(2ω) = n_o(2ω) for o-e-o, or n(2ω) = n_e(2ω,θ) for o-e-e).</pre>
          </div>

          <h3>What each “knob” controls</h3>
          <ul>
            <li><strong>Dispersion (λ vs λ/2):</strong> sets the baseline mismatch. Even without birefringence, indices change from IR to green.</li>
            <li><strong>Birefringence (n<sub>o</sub> − n<sub>e</sub>):</strong> gives the adjustable range of <code>n_e(θ)</code>.</li>
            <li><strong>Angle θ:</strong> tunes the extraordinary phase velocity; it cannot tune the ordinary wave.</li>
          </ul>

          <h3>Parameter dependence (qualitative)</h3>
          <ul>
            <li>If you increase the fundamental wavelength slightly (stay near 1 μm), the indices shift; the required θ typically shifts smoothly, producing a tuning curve.</li>
            <li>Stronger birefringence widens the attainable range of <code>n_e(θ)</code>, making more configurations phase matchable.</li>
            <li>In some crystals/wavelengths, the “o-e-o” configuration becomes possible; in KDP at 1.06 μm it is not, because dispersion demands too large an index at ω.</li>
          </ul>

          <details>
            <summary>Alternative derivation idea (brief but meaningful)</summary>
            <p class="note">
              Instead of writing <code>2 n(2ω) = n_o(ω)+n_e(ω,θ)</code>, you can write the mismatch directly:
              <code>Δk(θ) = (4π/λ) n(λ/2,pol) − (2π/λ)[n_o(λ)+n_e(λ,θ)]</code>.
              Since the prefactor <code>2π/λ</code> is positive, the sign and root structure are controlled entirely by the dimensionless
              function <code>Δ(θ) = 2 n(λ/2,pol) − n_o(λ) − n_e(λ,θ)</code>, which is what we plotted.
            </p>
          </details>

          <h3>Concept check (self-test)</h3>
          <ul>
            <li><strong>Q:</strong> Why can changing θ tune phase matching at all? <strong>A:</strong> Because only the extraordinary index depends on direction; rotating the crystal changes <code>n_e(θ)</code> and therefore <code>k</code>.</li>
            <li><strong>Q:</strong> Why doesn’t o-e-o work here? <strong>A:</strong> It demands <code>n_e(1.06,θ)</code> greater than <code>n_o(1.06)</code>, but <code>n_e(θ)</code> is bounded between <code>n_e</code> and <code>n_o</code>.</li>
            <li><strong>Q:</strong> What does “collinear” simplify? <strong>A:</strong> Vector matching reduces to a scalar relation among refractive indices.</li>
            <li><strong>Q:</strong> If temperature changes, what happens? <strong>A:</strong> Indices change (thermo-optic effect), so the phase-matching θ shifts; crystals can be temperature-tuned when coefficients permit.</li>
          </ul>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section class="card" id="part5">
          <h2>PART 5 — Optional Plot Guide</h2>

          <h3>What the plot shows (and why it helps)</h3>
          <p>
            The plot displays the phase-matching “mismatch functions” as a function of θ (0° to 90°):
          </p>
          <ul>
            <li><strong>o-e-o mismatch:</strong> <code>Δ_oeo(θ) = 2 n_o(λ/2) − n_o(λ) − n_e(λ,θ)</code></li>
            <li><strong>o-e-e mismatch:</strong> <code>Δ_oee(θ) = 2 n_e(λ/2,θ) − n_o(λ) − n_e(λ,θ)</code></li>
          </ul>
          <p>
            Phase matching happens when the relevant Δ crosses zero.
            In this problem, the o-e-e curve crosses zero once (giving θ ≈ 31.1°),
            while the o-e-o curve stays positive for all θ (so no solution exists).
          </p>

          <h3>Axes and units</h3>
          <ul>
            <li><strong>x-axis:</strong> θ (degrees), angle between propagation direction and optic axis.</li>
            <li><strong>y-axis:</strong> Δ (dimensionless), because it is a combination of refractive indices.</li>
          </ul>

          <h3>Values used</h3>
          <p>
            The plot uses the same computed indices from the Sellmeier coefficients listed earlier (not “example values” — they are the actual values used for the final answers).
          </p>

          <h3>Features to notice</h3>
          <ul>
            <li><strong>Zero crossing:</strong> the o-e-e curve crosses Δ = 0 near 31°.</li>
            <li><strong>No crossing:</strong> the o-e-o curve never reaches zero, illustrating an impossible configuration.</li>
            <li><strong>Curvature:</strong> comes from the nonlinear dependence of <code>n_e(θ)</code> on trigonometric terms.</li>
          </ul>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <footer id="refs">
          <strong>Reference used for Sellmeier coefficients and index values:</strong>
          <ol class="refs">
            <li>
              United Crystals — “Properties of KDP, DKDP and ADP crystal” (includes Sellmeier coefficients for KDP and sample indices at 1064 nm / 532 nm).
              <a href="https://www.unitedcrystals.com/KDPProp.html">https://www.unitedcrystals.com/KDPProp.html</a>
            </li>
          </ol>
          <p class="small">
            Note: Different handbooks may present slightly different coefficient fits; the resulting θ typically shifts only modestly for small coefficient differences.
          </p>
        </footer>
      </main>
    </div>
  </div>

  <script>
    (function(){
      const $ = (s, r=document)=>r.querySelector(s);
      const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

      function copyText(text){
        if(navigator.clipboard && window.isSecureContext){
          return navigator.clipboard.writeText(text);
        }
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position='fixed';
        ta.style.left='-9999px';
        ta.style.top='0';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try{ document.execCommand('copy'); }catch(e){}
        ta.remove();
        return Promise.resolve();
      }

      $$('.copyBtn').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          const id = btn.getAttribute('data-copy-btn');
          const el = document.getElementById(id);
          if(!el) return;
          const text = el.innerText.trim();
          const old = btn.textContent;
          btn.textContent = 'Copied!';
          btn.style.borderColor = 'rgba(183,255,154,.55)';
          btn.style.background = 'rgba(183,255,154,.16)';
          await copyText(text);
          setTimeout(()=>{
            btn.textContent = old;
            btn.style.borderColor = 'rgba(126,224,255,.30)';
            btn.style.background = 'rgba(126,224,255,.12)';
          }, 900);
        });
      });

      // --------- Physics helpers (numbers match the article) ----------
      // Sellmeier: n^2 = A + B/(l^2-C) + D l^2/(l^2-E), l in um
      const KDP = {
        no: {A:2.2576, B:0.0101, C:0.0142, D:1.7623, E:57.8984},
        ne: {A:2.1295, B:0.0097, C:0.0014, D:0.7580, E:127.0535}
      };
      function nSell(l, p){
        const l2 = l*l;
        const n2 = p.A + p.B/(l2 - p.C) + p.D*l2/(l2 - p.E);
        return Math.sqrt(n2);
      }
      function n_o(l){ return nSell(l, KDP.no); }
      function n_e(l){ return nSell(l, KDP.ne); }
      function n_e_theta(l, thetaRad){
        const no = n_o(l), ne = n_e(l);
        const c = Math.cos(thetaRad), s = Math.sin(thetaRad);
        const inv2 = (c*c)/(ne*ne) + (s*s)/(no*no);
        return 1/Math.sqrt(inv2);
      }

      // mismatch functions (dimensionless):
      // Δ_oeo(θ) = 2 n_o(l/2) - n_o(l) - n_e(l,θ)
      // Δ_oee(θ) = 2 n_e(l/2,θ) - n_o(l) - n_e(l,θ)
      const l = 1.06, l2 = 0.53;

      function mismatch_oeo(thetaRad){
        return 2*n_o(l2) - n_o(l) - n_e_theta(l, thetaRad);
      }
      function mismatch_oee(thetaRad){
        return 2*n_e_theta(l2, thetaRad) - n_o(l) - n_e_theta(l, thetaRad);
      }

      // Find approximate root for o-e-e (bisection over [0,90°])
      function findRootBisection(f, a, b){
        let fa = f(a), fb = f(b);
        if(fa === 0) return a;
        if(fb === 0) return b;
        if(fa*fb > 0) return null;
        let lo=a, hi=b, flo=fa, fhi=fb;
        for(let i=0;i<80;i++){
          const mid = 0.5*(lo+hi);
          const fm = f(mid);
          if(Math.abs(fm) < 1e-12) return mid;
          if(flo*fm <= 0){
            hi=mid; fhi=fm;
          }else{
            lo=mid; flo=fm;
          }
        }
        return 0.5*(lo+hi);
      }

      const root = findRootBisection(mismatch_oee, 0, Math.PI/2);

      // --------- Plot (single static canvas) ----------
      const canvas = $('#plot');
      const ctx = canvas.getContext('2d', { alpha: true });

      function draw(){
        const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
        const rect = canvas.getBoundingClientRect();
        const W = Math.max(320, Math.floor(rect.width));
        const H = Math.max(220, Math.floor(rect.width * 9/16));
        canvas.width = Math.floor(W * dpr);
        canvas.height = Math.floor(H * dpr);
        canvas.style.height = H + 'px';

        ctx.setTransform(dpr,0,0,dpr,0,0);
        ctx.clearRect(0,0,W,H);

        // Layout
        const padL = 60, padR = 18, padT = 22, padB = 50;
        const x0 = padL, y0 = padT, x1 = W - padR, y1 = H - padB;
        const w = x1-x0, h = y1-y0;

        // Sample curves
        const N = 361;
        const xs = new Array(N);
        const y_oeo = new Array(N);
        const y_oee = new Array(N);

        let ymin = +Infinity, ymax = -Infinity;
        for(let i=0;i<N;i++){
          const deg = 90 * i/(N-1);
          const th = deg * Math.PI/180;
          xs[i] = deg;
          const a = mismatch_oeo(th);
          const b = mismatch_oee(th);
          y_oeo[i]=a; y_oee[i]=b;
          ymin = Math.min(ymin, a, b);
          ymax = Math.max(ymax, a, b);
        }

        // Add slight padding on y-range
        const yPad = 0.08*(ymax - ymin || 1);
        ymin -= yPad;
        ymax += yPad;

        function X(deg){ return x0 + (deg/90)*w; }
        function Y(val){ return y1 - ( (val - ymin)/(ymax - ymin) )*h; }

        // Background grid
        ctx.save();
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgba(255,255,255,0.10)';

        // vertical ticks (every 10 deg)
        for(let deg=0; deg<=90; deg+=10){
          const x = X(deg);
          ctx.beginPath();
          ctx.moveTo(x, y0);
          ctx.lineTo(x, y1);
          ctx.stroke();
        }
        // horizontal ticks (choose 6)
        const ticksY = 6;
        for(let i=0;i<=ticksY;i++){
          const v = ymin + (ymax-ymin)*i/ticksY;
          const y = Y(v);
          ctx.beginPath();
          ctx.moveTo(x0, y);
          ctx.lineTo(x1, y);
          ctx.stroke();
        }
        ctx.restore();

        // Axes
        ctx.save();
        ctx.strokeStyle = 'rgba(255,255,255,0.22)';
        ctx.lineWidth = 1.25;
        ctx.beginPath();
        ctx.moveTo(x0, y0);
        ctx.lineTo(x0, y1);
        ctx.lineTo(x1, y1);
        ctx.stroke();
        ctx.restore();

        // Zero line (Δ = 0)
        const yZero = Y(0);
        ctx.save();
        ctx.strokeStyle = 'rgba(255,211,126,0.35)';
        ctx.setLineDash([6,6]);
        ctx.beginPath();
        ctx.moveTo(x0, yZero);
        ctx.lineTo(x1, yZero);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.restore();

        // Plot function
        function plotCurve(arr, stroke){
          ctx.save();
          ctx.strokeStyle = stroke;
          ctx.lineWidth = 2.2;
          ctx.beginPath();
          for(let i=0;i<N;i++){
            const x = X(xs[i]);
            const y = Y(arr[i]);
            if(i===0) ctx.moveTo(x,y);
            else ctx.lineTo(x,y);
          }
          ctx.stroke();
          ctx.restore();
        }

        // Colors (fixed, non-interactive plot)
        plotCurve(y_oeo, 'rgba(255,126,166,0.92)'); // pink
        plotCurve(y_oee, 'rgba(126,224,255,0.92)'); // cyan

        // Mark the root
        if(root !== null){
          const deg = root * 180/Math.PI;
          const x = X(deg);
          const y = Y(mismatch_oee(root));
          ctx.save();
          ctx.fillStyle = 'rgba(255,255,255,0.88)';
          ctx.beginPath();
          ctx.arc(x,y,4.8,0,Math.PI*2);
          ctx.fill();

          ctx.fillStyle = 'rgba(255,255,255,0.80)';
          ctx.font = '600 12.5px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
          ctx.textAlign = 'left';
          ctx.textBaseline = 'bottom';
          ctx.fillText('o-e-e root ≈ ' + deg.toFixed(1) + '°', x+8, y-8);
          ctx.restore();
        }

        // Title
        ctx.save();
        ctx.fillStyle = 'rgba(234,240,255,0.92)';
        ctx.font = '700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'top';
        ctx.fillText('Mismatch vs angle for KDP Type-II SHG (λ = 1.06 μm → 0.53 μm)', x0, 6);
        ctx.restore();

        // Axis labels
        ctx.save();
        ctx.fillStyle = 'rgba(185,196,230,0.95)';
        ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText('θ (degrees from optic axis)', x0 + w/2, y1 + 18);

        ctx.save();
        ctx.translate(18, y0 + h/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText('Δ(θ)  (dimensionless)', 0, 0);
        ctx.restore();
        ctx.restore();

        // Tick labels
        ctx.save();
        ctx.fillStyle = 'rgba(185,196,230,0.92)';
        ctx.font = '11.5px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';

        // x ticks
        ctx.textAlign='center';
        ctx.textBaseline='top';
        for(let deg=0; deg<=90; deg+=10){
          ctx.fillText(String(deg), X(deg), y1 + 4);
        }

        // y ticks
        ctx.textAlign='right';
        ctx.textBaseline='middle';
        const ticks = 6;
        for(let i=0;i<=ticks;i++){
          const v = ymin + (ymax-ymin)*i/ticks;
          ctx.fillText(v.toFixed(3), x0 - 8, Y(v));
        }
        ctx.restore();

        // Legend
        const lx = x1 - 250, ly = y0 + 10;
        ctx.save();
        ctx.fillStyle = 'rgba(0,0,0,0.24)';
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.lineWidth = 1;
        roundRect(ctx, lx, ly, 240, 54, 12);
        ctx.fill();
        ctx.stroke();

        function legLine(y, color, text){
          ctx.strokeStyle = color;
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(lx+14, y);
          ctx.lineTo(lx+44, y);
          ctx.stroke();
          ctx.fillStyle = 'rgba(234,240,255,0.88)';
          ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
          ctx.textAlign = 'left';
          ctx.textBaseline = 'middle';
          ctx.fillText(text, lx+52, y);
        }
        legLine(ly+18, 'rgba(126,224,255,0.92)', 'Δ_oee(θ) = 2 n_e(0.53,θ) − n_o(1.06) − n_e(1.06,θ)');
        legLine(ly+38, 'rgba(255,126,166,0.92)', 'Δ_oeo(θ) = 2 n_o(0.53) − n_o(1.06) − n_e(1.06,θ)');
        ctx.restore();
      }

      function roundRect(c, x, y, w, h, r){
        const rr = Math.min(r, w/2, h/2);
        c.beginPath();
        c.moveTo(x+rr, y);
        c.arcTo(x+w, y, x+w, y+h, rr);
        c.arcTo(x+w, y+h, x, y+h, rr);
        c.arcTo(x, y+h, x, y, rr);
        c.arcTo(x, y, x+w, y, rr);
        c.closePath();
      }

      // Draw once and on resize
      const ro = new ResizeObserver(()=>draw());
      ro.observe(canvas);
      window.addEventListener('resize', ()=>draw(), {passive:true});
      draw();
    })();
  </script>
</body>
</html>
