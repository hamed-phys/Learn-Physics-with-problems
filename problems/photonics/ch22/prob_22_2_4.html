<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Phase Matching in a Degenerate Parametric Downconverter (KDP): Direction & Polarizations</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1733;
      --card:#121c3f;
      --text:#eaf0ff;
      --muted:#b9c3e6;
      --soft:#7f8cc5;
      --line:rgba(255,255,255,0.12);
      --line2:rgba(255,255,255,0.18);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --warn:#fde68a;
      --bad:#fca5a5;
      --shadow: 0 12px 35px rgba(0,0,0,0.38);
      --radius: 18px;
      --radius2: 24px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(167,139,250,0.18), transparent 55%),
        radial-gradient(900px 700px at 80% 20%, rgba(125,211,252,0.14), transparent 58%),
        radial-gradient(900px 900px at 70% 90%, rgba(134,239,172,0.10), transparent 60%),
        linear-gradient(180deg, #070a16 0%, #0b1020 38%, #070a16 100%);
      line-height:1.55;
    }

    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    header{
      padding: clamp(18px, 4vw, 34px) 18px 18px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), transparent);
      position:relative;
      overflow:hidden;
    }
    header::after{
      content:"";
      position:absolute;
      inset:-40px -80px auto -80px;
      height:220px;
      background: radial-gradient(closest-side, rgba(125,211,252,0.18), transparent 70%);
      filter: blur(2px);
      pointer-events:none;
      transform: rotate(-6deg);
    }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 18px 34px;
    }

    .title{
      display:grid;
      gap:10px;
      align-items:start;
    }
    h1{
      margin: 6px 0 0;
      font-size: clamp(1.45rem, 2.8vw, 2.25rem);
      line-height:1.15;
      letter-spacing:-0.02em;
    }
    .subtitle{
      color:var(--muted);
      margin:0;
      max-width: 80ch;
    }

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
      align-items:start;
      margin-top: 18px;
    }

    nav.toc{
      position: sticky;
      top: 14px;
      background: rgba(18,28,63,0.72);
      border:1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .toc .toc-head{
      padding: 14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .toc h2{
      font-size: 0.98rem;
      margin:0;
      letter-spacing:0.02em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .toc .pill{
      font-size: 0.78rem;
      color: var(--soft);
      border:1px solid var(--line);
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      user-select:none;
    }
    .toc ul{
      list-style:none;
      padding: 10px 10px 12px;
      margin:0;
      display:grid;
      gap: 6px;
    }
    .toc a{
      display:block;
      padding: 9px 10px;
      border-radius: 12px;
      color: var(--text);
      border:1px solid transparent;
      background: transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .toc a:hover{
      background: rgba(255,255,255,0.05);
      border-color: var(--line);
      transform: translateY(-1px);
      text-decoration:none;
    }

    main{
      min-width: 0;
      display:grid;
      gap: 16px;
    }

    section, article{
      background: rgba(18,28,63,0.72);
      border:1px solid var(--line);
      border-radius: var(--radius2);
      padding: 16px 16px 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    section h2, article h2{
      margin: 4px 0 10px;
      font-size: clamp(1.1rem, 1.6vw, 1.4rem);
      letter-spacing:-0.01em;
    }
    h3{
      margin: 14px 0 8px;
      font-size: 1.05rem;
      letter-spacing:-0.01em;
      color: var(--text);
    }
    p{ margin: 8px 0; color: var(--text); }
    .muted{ color: var(--muted); }
    .small{ font-size: 0.95rem; color: var(--muted); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
      nav.toc{ position:relative; top:0; }
      .grid2{ grid-template-columns:1fr; }
    }

    .card{
      background: rgba(15,23,51,0.72);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 12px 12px 10px;
    }

    .callouts{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .callout{
      border:1px solid var(--line);
      background: rgba(255,255,255,0.04);
      border-radius: var(--radius);
      padding: 12px;
      position:relative;
      overflow:hidden;
    }
    .callout::before{
      content:"";
      position:absolute;
      inset:0 auto 0 0;
      width:4px;
      background: linear-gradient(180deg, rgba(125,211,252,0.9), rgba(167,139,250,0.8));
      opacity:0.9;
    }
    .callout.good::before{ background: linear-gradient(180deg, rgba(134,239,172,0.95), rgba(125,211,252,0.7)); }
    .callout.warn::before{ background: linear-gradient(180deg, rgba(253,230,138,0.95), rgba(167,139,250,0.65)); }
    .callout.bad::before{ background: linear-gradient(180deg, rgba(252,165,165,0.95), rgba(125,211,252,0.55)); }

    .callout h3{ margin:0 0 6px; }
    .callout p{ margin: 6px 0; color: var(--muted); }
    ul{ margin: 8px 0 8px 18px; color: var(--muted); }
    li{ margin: 4px 0; }

    .eq{
      margin: 10px 0;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(8,12,26,0.55);
      padding: 10px 10px 8px;
      overflow:auto;
      position:relative;
    }
    pre, code{
      font-family: var(--mono);
      font-size: 0.92rem;
      color: #e9f2ff;
      margin:0;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .eqbar{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .tag{
      font-size: 0.78rem;
      color: var(--soft);
      border:1px solid var(--line);
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      user-select:none;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line2);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      padding: 6px 10px;
      border-radius: 12px;
      font-size: 0.86rem;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,0.08);
      border-color: rgba(125,211,252,0.35);
    }
    .btn:active{ transform: translateY(0px) scale(0.99); }
    .btn:focus{ outline: 2px solid rgba(125,211,252,0.55); outline-offset:2px; }

    details{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,0.03);
      padding: 10px 10px 8px;
      margin: 10px 0 0;
    }
    summary{
      cursor:pointer;
      color: var(--text);
      font-weight: 650;
      letter-spacing: -0.01em;
      list-style: none;
      display:flex;
      align-items:center;
      gap:8px;
    }
    summary::-webkit-details-marker{ display:none; }
    summary::before{
      content:"▸";
      color: var(--accent);
      transform: translateY(-1px);
      transition: transform .18s ease;
      display:inline-block;
    }
    details[open] summary::before{
      transform: rotate(90deg) translateX(1px);
    }
    details .content{ margin-top: 8px; color: var(--muted); }

    figure{
      margin: 10px 0 0;
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(8,12,26,0.45);
      padding: 10px;
      overflow:hidden;
    }
    figcaption{
      margin-top: 8px;
      color: var(--muted);
      font-size: 0.92rem;
    }
    canvas{
      width:100%;
      height: 280px;
      display:block;
      border-radius: 14px;
      background: rgba(255,255,255,0.02);
    }

    .backtop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      width: fit-content;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .backtop:hover{
      transform: translateY(-1px);
      border-color: rgba(167,139,250,0.35);
      background: rgba(255,255,255,0.06);
      text-decoration:none;
    }

    footer{
      margin-top: 16px;
      padding: 14px 0 26px;
      color: var(--muted);
      text-align:center;
    }

    .print-note{ display:none; }
    @media print{
      body{ background:#fff; color:#000; }
      header, nav.toc, .btn, .backtop{ display:none !important; }
      section, article, figure, .callout, details, .eq{
        background:#fff !important;
        color:#000 !important;
        border: 1px solid #000 !important;
        box-shadow:none !important;
        break-inside: avoid;
      }
      .muted, ul, li, figcaption{ color:#000 !important; }
      pre, code{ color:#000 !important; }
      .print-note{ display:block; margin: 0 0 8px; }
      a{ color:#000; text-decoration:underline; }
      .layout{ grid-template-columns: 1fr; }
    }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; scroll-behavior:auto !important; }
    }
  </style>
</head>
<body>
  <header id="top">
    <div class="wrap">
      <div class="title">
        <p class="print-note"><strong>Print note:</strong> This page is formatted to print cleanly (high contrast, page-break friendly).</p>
        <h1>Phase Matching in a Degenerate Parametric Downconverter (KDP): Direction &amp; Polarizations</h1>
        <p class="subtitle">
          We downconvert <strong>0.6&nbsp;µm</strong> light to <strong>1.2&nbsp;µm</strong> in a uniaxial KDP crystal.
          With collinear propagation, we find the <em>angle to the optic axis</em> and the <em>ordinary/extraordinary polarizations</em>
          that satisfy the phase-matching condition.
        </p>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="layout">
      <nav class="toc" aria-label="Table of contents">
        <div class="toc-head">
          <h2>Contents</h2>
          <span class="pill">sticky</span>
        </div>
        <ul>
          <li><a href="#quick">Quick Summary</a></li>
          <li><a href="#primer">PART 0 — Concept Primer</a></li>
          <li><a href="#analysis">PART 1 — Problem Analysis</a></li>
          <li><a href="#strategy">PART 2 — Strategy &amp; Tips</a></li>
          <li><a href="#solution">PART 3 — Full Solution</a></li>
          <li><a href="#deeper">PART 4 — Deeper Understanding</a></li>
          <li><a href="#plotguide">PART 5 — Optional Plot Guide</a></li>
        </ul>
      </nav>

      <main>
        <section id="quick">
          <h2>Quick Summary</h2>
          <ul>
            <li><strong>What this is about:</strong> birefringent phase matching for <em>degenerate</em> parametric downconversion in KDP.</li>
            <li><strong>Key physics idea:</strong> momentum conservation (phase matching) requires <code>k_p = k_s + k_i</code>; for degenerate output <code>k_s = k_i</code>.</li>
            <li><strong>Collinear simplification:</strong> with <code>λ_s = λ_i = 2λ_p</code>, the condition reduces to matching refractive indices: <code>n_p = n_s</code> (for suitable polarization choices).</li>
            <li><strong>Crystal type:</strong> KDP is <em>uniaxial</em> and here <em>negative</em> (<code>n_o &gt; n_e</code>), so an extraordinary wave can “tune” its effective index by changing propagation angle.</li>
            <li><strong>Best phase-matching type:</strong> <strong>Type I</strong>: pump is <strong>extraordinary</strong> (e), signal/idler are <strong>ordinary</strong> (o).</li>
            <li><strong>Governing equations:</strong> <code>k = 2π n / λ0</code> and <code>1/n_e(θ)^2 = cos^2θ/n_e^2 + sin^2θ/n_o^2</code>.</li>
            <li><strong>Numeric result:</strong> choose propagation at about <strong>θ ≈ 47.7°</strong> to the optic axis so that <code>n_e,p(θ) = n_o,s</code>.</li>
            <li><strong>Physical meaning:</strong> at this angle the pump phase velocity matches the downconverted waves’ combined phase advance, so the nonlinear polarization stays in phase and energy builds coherently.</li>
          </ul>

          <div class="callouts">
            <div class="callout good">
              <h3>Final takeaway (one sentence)</h3>
              <p>
                Send the <strong>0.6&nbsp;µm pump as an extraordinary wave</strong> at <strong>~48° to the optic axis</strong>, and let the <strong>1.2&nbsp;µm signal/idler be ordinary waves</strong>
                (polarized perpendicular to the principal plane), achieving collinear birefringent phase matching.
              </p>
            </div>
          </div>
        </section>

        <article id="primer">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

          <div class="grid2">
            <div class="card">
              <h3>Core definitions (symbols &amp; SI units)</h3>
              <ul>
                <li><strong>Vacuum wavelength</strong> <code>λ0</code> (m): wavelength in vacuum; here given in µm.</li>
                <li><strong>Refractive index</strong> <code>n</code> (dimensionless): relates phase velocity <code>vφ = c/n</code>.</li>
                <li><strong>Wavevector magnitude</strong> <code>k</code> (rad/m): <code>k = 2πn/λ0</code>.</li>
                <li><strong>Angular frequency</strong> <code>ω</code> (rad/s): energy per photon <code>ħω</code>.</li>
                <li><strong>Optic axis</strong>: special crystal direction defining ordinary (o) and extraordinary (e) behavior.</li>
                <li><strong>Angle</strong> <code>θ</code> (rad or deg): between propagation direction <code>k</code> and the optic axis.</li>
              </ul>
            </div>

            <div class="card">
              <h3>Physical meaning (intuition)</h3>
              <ul>
                <li><strong>Phase matching</strong> means the generated nonlinear polarization and the generated field keep the same phase relationship as they propagate, so growth is coherent (constructive).</li>
                <li><strong>Birefringent tuning</strong>: in a uniaxial crystal, an extraordinary wave has an angle-dependent effective index <code>n_e(θ)</code>, letting you “dial in” the needed phase velocity.</li>
                <li><strong>Collinear geometry</strong> is the simplest: all waves share the same direction, so vectors reduce to scalar magnitudes.</li>
              </ul>
            </div>
          </div>

          <h3>Key laws/principles and validity conditions</h3>
          <div class="callouts">
            <div class="callout">
              <h3>Energy conservation (parametric process)</h3>
              <p class="muted">
                A pump photon at <code>ω_p</code> splits into a signal and idler with <code>ω_s + ω_i = ω_p</code>.
                For <strong>degenerate</strong> downconversion, <code>ω_s = ω_i = ω_p/2</code>, hence <code>λ_s = λ_i = 2λ_p</code> in vacuum.
              </p>
              <div class="eq" data-copy>
                <div class="eqbar">
                  <span class="tag">Key equation</span>
                  <button class="btn copybtn" type="button" aria-label="Copy equation">Copy</button>
                </div>
                <pre><code>ωp = ωs + ωi,  degenerate: ωs = ωi = ωp/2  ⇒  λs = λi = 2λp</code></pre>
              </div>
            </div>

            <div class="callout">
              <h3>Momentum conservation (phase matching)</h3>
              <p class="muted">
                In a uniform crystal (no grating), the interacting waves must satisfy
                <code>kp = ks + ki</code>. If they are collinear, this becomes a scalar equation for magnitudes.
              </p>
              <div class="eq" data-copy>
                <div class="eqbar">
                  <span class="tag">Key equation</span>
                  <button class="btn copybtn" type="button" aria-label="Copy equation">Copy</button>
                </div>
                <pre><code>Vector phase matching:  k⃗p = k⃗s + k⃗i  (collinear ⇒ kp = ks + ki)</code></pre>
              </div>
            </div>

            <div class="callout">
              <h3>Uniaxial birefringence (ordinary vs extraordinary)</h3>
              <p class="muted">
                For a uniaxial crystal:
              </p>
              <ul>
                <li><strong>Ordinary wave (o):</strong> sees constant index <code>n_o(λ)</code> independent of direction.</li>
                <li><strong>Extraordinary wave (e):</strong> sees an <em>effective</em> index <code>n_e(θ,λ)</code> depending on angle <code>θ</code>.</li>
              </ul>
              <div class="eq" data-copy>
                <div class="eqbar">
                  <span class="tag">Key equation</span>
                  <button class="btn copybtn" type="button" aria-label="Copy equation">Copy</button>
                </div>
                <pre><code>k = (2π/λ0) n

Extraordinary effective index (uniaxial):
1 / n_e(θ)^2 = cos^2θ / n_e^2 + sin^2θ / n_o^2</code></pre>
              </div>
              <details>
                <summary>Polarization geometry (what “ordinary” and “extraordinary” mean)</summary>
                <div class="content">
                  <p>
                    Define the <strong>principal plane</strong> as the plane containing the propagation direction <code>k⃗</code> and the optic axis.
                    Then:
                  </p>
                  <ul>
                    <li><strong>Ordinary wave:</strong> electric field <code>E⃗</code> is perpendicular to the principal plane (so its index is direction-independent).</li>
                    <li><strong>Extraordinary wave:</strong> <code>E⃗</code> lies in the principal plane (its index depends on angle).</li>
                  </ul>
                </div>
              </details>
            </div>
          </div>

          <h3>Common models/approximations (why we use them)</h3>
          <ul>
            <li><strong>Plane-wave model:</strong> treat each field as a monochromatic plane wave; valid when beams are not tightly focused over the interaction length.</li>
            <li><strong>Collinear approximation:</strong> simplifies vector matching to scalar matching; consistent with the problem statement.</li>
            <li><strong>Neglect walk-off and bandwidth:</strong> the problem asks only for the phase-matching direction and polarizations, not efficiency or acceptance angles.</li>
          </ul>

          <h3>Mini intuition examples (quick)</h3>
          <ul>
            <li><strong>Example 1 (why birefringence helps):</strong> If material dispersion makes <code>n(λp) ≠ n(λs)</code>, you can still match by making one wave extraordinary so its effective index shifts with angle.</li>
            <li><strong>Example 2 (degenerate simplification):</strong> When <code>λs = 2λp</code>, the factor of 2 in <code>kp = 2ks</code> cancels the wavelength change, often leaving a clean index-matching condition.</li>
          </ul>

          <div class="callout warn">
            <h3>What to watch for (pitfalls)</h3>
            <ul>
              <li><strong>Using the wrong wavelength:</strong> phase matching uses vacuum wavelengths <code>λ0</code> in <code>k = 2πn/λ0</code>.</li>
              <li><strong>Mixing “ordinary/extraordinary” with “TE/TM”:</strong> in crystals, the definitions are relative to the optic axis and principal plane.</li>
              <li><strong>Assuming the same index at both wavelengths:</strong> dispersion means <code>n_o(0.6µm) ≠ n_o(1.2µm)</code>.</li>
              <li><strong>Forgetting angle dependence:</strong> only the extraordinary wave can be tuned via <code>θ</code>.</li>
            </ul>
          </div>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </article>

        <article id="analysis">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

          <h3>Restate the problem (in plain words)</h3>
          <p class="muted">
            A degenerate parametric downconverter in KDP converts light from <strong>0.6&nbsp;µm</strong> (pump) to <strong>1.2&nbsp;µm</strong> (signal and idler at the same wavelength).
            The waves are collinear. We must choose (1) the propagation direction relative to the optic axis and (2) which waves are ordinary vs extraordinary (i.e., their polarizations) so that the phase-matching condition holds.
          </p>

          <div class="grid2">
            <div class="card">
              <h3>Given</h3>
              <ul>
                <li>Pump wavelength: <code>λp = 0.6 µm</code></li>
                <li>Degenerate output: <code>λs = λi = 1.2 µm</code></li>
                <li>Uniaxial KDP indices:</li>
                <li>At <code>0.6 µm</code>: <code>n_o,p = 1.509</code>, <code>n_e,p = 1.468</code></li>
                <li>At <code>1.2 µm</code>: <code>n_o,s = 1.490</code>, <code>n_e,s = 1.459</code></li>
                <li>Geometry: collinear propagation</li>
              </ul>
            </div>

            <div class="card">
              <h3>Unknowns (what we must find)</h3>
              <ul>
                <li>The propagation angle <code>θ</code> between the beam direction and the optic axis.</li>
                <li>The polarization/type assignment (which waves are ordinary vs extraordinary).</li>
                <li>A clear physical description of the “proper direction” (e.g., “~48° off the optic axis”).</li>
              </ul>
            </div>
          </div>

          <h3>Relevant principles (and why they apply)</h3>
          <ul>
            <li><strong>Energy conservation:</strong> ensures <code>λs = 2λp</code> for degenerate downconversion (already built into the problem).</li>
            <li><strong>Phase matching:</strong> <code>k⃗p = k⃗s + k⃗i</code> determines the direction/polarization choice.</li>
            <li><strong>Uniaxial birefringence:</strong> provides the tuning knob: <code>n_e(θ)</code> depends on <code>θ</code>, while <code>n_o</code> does not.</li>
          </ul>
          <p class="muted">
            We do <em>not</em> need nonlinear coefficients, pump intensity, focusing, or bandwidth because the question is purely about satisfying the phase-matching condition.
          </p>

          <div class="callout">
            <h3>Assumptions (explicit)</h3>
            <ul>
              <li>Plane-wave, monochromatic fields at the stated wavelengths.</li>
              <li>Collinear propagation: all wavevectors share one direction.</li>
              <li>Temperature, stress, and higher-order dispersion effects neglected (indices are taken as given).</li>
              <li>No quasi-phase matching (no periodic poling); only birefringent phase matching.</li>
            </ul>
          </div>

          <h3>Possible approaches (2–3) and comparison</h3>
          <div class="grid2">
            <div class="callout">
              <h3>Approach A: Try all-ordinary (o→o+o)</h3>
              <p class="muted">
                Fast check: use <code>n_o</code> at each wavelength and see if collinear matching holds.
                <br><strong>Pro:</strong> simplest.
                <br><strong>Con:</strong> usually fails due to dispersion (and here it does).
              </p>
            </div>
            <div class="callout">
              <h3>Approach B: Type I birefringent matching (e→o+o)</h3>
              <p class="muted">
                Use extraordinary pump so <code>n_p</code> can be tuned with <code>θ</code> until it matches the ordinary downconverted index.
                <br><strong>Pro:</strong> one scalar equation, one unknown angle.
                <br><strong>Con:</strong> requires correct polarization geometry (principal plane).
              </p>
            </div>
          </div>

          <div class="callout">
            <h3>Approach C: Type II (pump → o+e at 1.2 µm)</h3>
            <p class="muted">
              One generated wave ordinary and the other extraordinary, leading to <code>kp = ko + ke</code>.
              <br><strong>Pro:</strong> sometimes needed when Type I cannot match.
              <br><strong>Con:</strong> more bookkeeping; not necessary if Type I already matches.
            </p>
          </div>

          <p>
            <strong>Best choice here:</strong> <strong>Approach B (Type I, e→o+o)</strong>, because we can tune the pump’s effective extraordinary index to equal the fixed ordinary index at 1.2 µm, while other simple choices are impossible.
          </p>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </article>

        <article id="strategy">
          <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>

          <ol class="muted">
            <li><strong>Use degeneracy:</strong> set <code>λs = λi = 2λp</code> (energy conservation).</li>
            <li><strong>Write phase matching:</strong> collinear <code>kp = ks + ki = 2ks</code>.</li>
            <li><strong>Insert k–n relation:</strong> <code>k = 2πn/λ0</code> to convert phase matching into an index condition.</li>
            <li><strong>Test polarization options:</strong> try (o→o+o), (o→e+e), (e→o+o), etc., using the given indices.</li>
            <li><strong>Select viable type:</strong> identify which option can satisfy the required index equality/range.</li>
            <li><strong>Solve for θ:</strong> for an extraordinary wave, apply <code>1/n_e(θ)^2 = cos^2θ/n_e^2 + sin^2θ/n_o^2</code> at the appropriate wavelength.</li>
            <li><strong>Translate to “direction and polarizations”:</strong> state θ relative to optic axis and describe ordinary vs extraordinary polarization directions.</li>
            <li><strong>Sanity check:</strong> confirm the computed effective index lies within the allowed birefringent range and the equation is dimensionally consistent.</li>
          </ol>

          <div class="callout bad">
            <h3>Common mistakes (quick tips)</h3>
            <ul>
              <li>Forgetting that the extraordinary index is <em>angle-dependent</em> but the ordinary index is not.</li>
              <li>Trying pump ordinary and output extraordinary here: the needed index value exceeds the extraordinary range at 1.2 µm.</li>
              <li>Using the wrong extraordinary formula (be consistent: <code>1/n^2</code> form is the safest).</li>
              <li>Confusing θ (angle to optic axis) with angle to a crystal face or laboratory axis.</li>
            </ul>
          </div>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </article>

        <article id="solution">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

          <h3>Qualitative expectation (before calculating)</h3>
          <p class="muted">
            Because KDP is birefringent (<code>n_o &gt; n_e</code>), an extraordinary wave can have an effective index between <code>n_e</code> (along the optic axis) and <code>n_o</code> (perpendicular to it).
            The ordinary index at 1.2 µm is <code>n_o,s = 1.490</code>. The pump extraordinary index at 0.6 µm ranges from <code>1.468</code> to <code>1.509</code>, so it should be possible to tune it to <code>1.490</code> at some intermediate angle.
          </p>

          <h3>Step 1: Write the collinear phase-matching condition</h3>
          <p class="muted">
            For parametric downconversion (three-wave mixing),
            momentum conservation requires:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Phase matching</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>k⃗p = k⃗s + k⃗i
(collinear) ⇒ kp = ks + ki</code></pre>
          </div>
          <p class="muted">
            For <strong>degenerate</strong> downconversion, the two generated waves have the same wavelength and index type (in Type I), so <code>ks = ki</code>, giving:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Degenerate collinear</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>kp = 2 ks</code></pre>
          </div>

          <h3>Step 2: Convert to refractive indices using k = 2πn/λ0</h3>
          <p class="muted">
            For each wave,
            <code>k = (2π/λ0) n</code>, where <code>λ0</code> is the vacuum wavelength.
            Substitute into <code>kp = 2ks</code>:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Index form</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>(2π/λp) np = 2 (2π/λs) ns</code></pre>
          </div>
          <p class="muted">
            Cancel <code>2π</code>:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Simplify</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>np/λp = 2 ns/λs</code></pre>
          </div>

          <h3>Step 3: Use degeneracy relation λs = 2λp</h3>
          <p class="muted">
            Energy conservation at degeneracy gives <code>λs = 2λp</code>.
            Insert it:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Degeneracy substitution</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>np/λp = 2 ns/(2λp)  ⇒  np = ns</code></pre>
          </div>
          <p class="muted">
            <strong>Big result:</strong> in collinear degenerate downconversion, the phase-matching condition reduces to matching the effective refractive index of the pump to that of the signal/idler:
            <strong><code>n_p (chosen polarization, θ) = n_s (chosen polarization, θ)</code></strong>.
          </p>

          <h3>Step 4: Determine which polarization assignment can satisfy np = ns</h3>
          <p class="muted">
            We test plausible combinations using the given KDP indices.
          </p>
          <div class="callout">
            <h3>Try all-ordinary (o → o + o)</h3>
            <p class="muted">
              <code>np = n_o(0.6µm) = 1.509</code>, <code>ns = n_o(1.2µm) = 1.490</code>.
              They are not equal, and no angle tuning exists for ordinary waves.
              <strong>So o→o+o cannot phase match.</strong>
            </p>
          </div>

          <div class="callout">
            <h3>Try pump ordinary, output extraordinary (o → e + e)</h3>
            <p class="muted">
              This would require <code>n_o,p = n_e,s(θ)</code>.
              But <code>n_e,s(θ)</code> ranges only between <code>n_e,s = 1.459</code> and <code>n_o,s = 1.490</code>,
              never reaching <code>1.509</code>.
              <strong>So this is impossible.</strong>
            </p>
          </div>

          <div class="callout good">
            <h3>Type I that can work: pump extraordinary, outputs ordinary (e → o + o)</h3>
            <p class="muted">
              Choose signal and idler as ordinary at 1.2 µm: <code>ns = n_o,s = 1.490</code> (fixed).
              Choose pump as extraordinary at 0.6 µm so <code>np = n_e,p(θ)</code> is tunable between <code>1.468</code> and <code>1.509</code>.
              Since <code>1.490</code> lies in that interval, there exists a θ such that:
              <strong><code>n_e,p(θ) = 1.490</code></strong>.
            </p>
          </div>

          <h3>Step 5: Solve for the required angle θ using the extraordinary index formula</h3>
          <p class="muted">
            For the pump (0.6 µm), we use:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Extraordinary index (pump)</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>1 / n_e,p(θ)^2 = cos^2θ / n_e,p^2 + sin^2θ / n_o,p^2</code></pre>
          </div>

          <p class="muted">
            We need <code>n_e,p(θ) = n_o,s = 1.490</code>, with
            <code>n_e,p = 1.468</code>, <code>n_o,p = 1.509</code>.
            Solve:
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Equation to solve</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>1 / (1.490)^2 = cos^2θ / (1.468)^2 + sin^2θ / (1.509)^2</code></pre>
          </div>

          <p class="muted">
            Rearranging in terms of <code>cos^2θ</code> (let <code>c = cos^2θ</code>, <code>sin^2θ = 1 - c</code>):
          </p>
          <div class="eq" data-copy>
            <div class="eqbar">
              <span class="tag">Linear in cos²θ</span>
              <button class="btn copybtn" type="button">Copy</button>
            </div>
            <pre><code>1 / n^2 = c / n_e^2 + (1 - c) / n_o^2
⇒ c = (1/n^2 - 1/n_o^2) / (1/n_e^2 - 1/n_o^2)</code></pre>
          </div>

          <p class="muted">
            Plugging numbers (<code>n = 1.490</code>, <code>n_e = 1.468</code>, <code>n_o = 1.509</code>) gives:
            <strong><code>θ ≈ 47.7°</code></strong>.
            (Any equivalent angle that yields the same <code>cos²θ</code> works; physically we take <code>0° ≤ θ ≤ 90°</code>.)
          </p>

          <div class="callout good" id="finalbox">
            <h3>Final Answer (direction + polarizations)</h3>
            <div class="eq" data-copy>
              <div class="eqbar">
                <span class="tag">Copy-ready final answer</span>
                <button class="btn copybtn" type="button">Copy</button>
              </div>
              <pre><code>Choose Type-I birefringent phase matching in KDP:

• Propagation direction: make the (collinear) waves propagate at θ ≈ 47.7° to the optic axis.

• Polarizations:
  - Pump at 0.6 µm: extraordinary (e) polarization (E lies in the principal plane formed by k and the optic axis),
    so its effective index is n_e,p(θ) ≈ 1.490.
  - Signal and idler at 1.2 µm (degenerate): ordinary (o) polarization (E ⟂ principal plane),
    with n_o,s = 1.490.

This satisfies collinear degenerate phase matching because kp = 2ks reduces to n_p = n_s, and n_e,p(θ) is tuned to n_o,s.</code></pre>
            </div>
          </div>

          <h3>Sanity checks</h3>
          <div class="grid2">
            <div class="callout">
              <h3>1) Dimensional check</h3>
              <p class="muted">
                <code>k = 2πn/λ0</code> has units rad/m, and the phase-matching equation compares wavevectors, so it is dimensionally consistent.
                The reduced condition <code>n_p = n_s</code> is dimensionless on both sides.
              </p>
            </div>
            <div class="callout">
              <h3>2) Range/limiting check</h3>
              <p class="muted">
                For the pump at 0.6 µm, <code>n_e,p(θ)</code> must lie between <code>n_e,p = 1.468</code> (θ=0°) and <code>n_o,p = 1.509</code> (θ=90°).
                The target <code>1.490</code> lies inside this range, so a real solution for θ must exist. Our θ ≈ 47.7° is plausible (mid-range).
              </p>
            </div>
          </div>

          <div class="callout">
            <h3>3) Physical interpretation (plain language)</h3>
            <p class="muted">
              At θ ≈ 47.7°, the pump extraordinary wave’s phase advance per unit length matches that required for two ordinary 1.2 µm waves to build coherently.
              That means the nonlinear polarization that drives the 1.2 µm fields stays “in step” with them, enabling efficient energy transfer.
            </p>
          </div>

          <figure>
            <canvas id="plot" aria-label="Plot of pump extraordinary refractive index vs angle"></canvas>
            <figcaption>
              <strong>One helpful picture:</strong> the pump extraordinary effective index <code>n_e,p(θ)</code> increases from <code>n_e,p</code> (θ=0°) toward <code>n_o,p</code> (θ=90°).
              Phase matching occurs where it meets the horizontal line <code>n_o,s = 1.490</code>.
            </figcaption>
          </figure>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </article>

        <article id="deeper">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

          <h3>Re-interpret the result: what controls phase matching?</h3>
          <ul class="muted">
            <li><strong>Dispersion control:</strong> the mismatch between <code>n(0.6µm)</code> and <code>n(1.2µm)</code> is what you must compensate.</li>
            <li><strong>Birefringent control:</strong> only the extraordinary wave provides a tunable index via angle: <code>n_e(θ)</code>.</li>
            <li><strong>Geometry control:</strong> because the waves are collinear, the vector condition collapses to matching magnitudes, giving the especially simple <code>n_p = n_s</code> at degeneracy.</li>
          </ul>

          <h3>Parameter dependence (qualitative)</h3>
          <div class="callout">
            <h3>How would θ change if indices changed?</h3>
            <ul class="muted">
              <li>If the target downconverted index <code>n_s</code> were larger, you would need a larger <code>n_e,p(θ)</code>, which generally means a <strong>larger θ</strong> (closer to 90°) for negative uniaxial crystals like KDP.</li>
              <li>If the pump birefringence were smaller (i.e., <code>n_o,p - n_e,p</code> decreases), the tuning range shrinks and matching might become impossible.</li>
              <li>In real experiments, changing temperature can shift indices slightly, moving the required θ (temperature tuning is a common practical knob).</li>
            </ul>
          </div>

          <h3>Alternative derivation idea (brief but meaningful)</h3>
          <p class="muted">
            Instead of directly solving for θ, you can view the problem as an <em>index-surface intersection</em>:
            for a fixed propagation direction, the pump’s extraordinary phase index is read off from the extraordinary refractive-index ellipsoid,
            while the 1.2 µm ordinary index is a sphere of radius <code>n_o,s</code>.
            Phase matching occurs when the pump’s ellipsoid “radius” in that direction equals the signal’s spherical radius.
            The algebra used here is the analytic version of that geometric construction.
          </p>

          <h3>Concept checks (self-test, with answers)</h3>
          <ul class="muted">
            <li><strong>Q:</strong> Why does the degenerate collinear condition reduce to <code>n_p = n_s</code>?<br>
                <strong>A:</strong> Because <code>k_p = 2k_s</code> and <code>λ_s = 2λ_p</code> make the factors of 2 cancel when you substitute <code>k = 2πn/λ</code>.</li>
            <li><strong>Q:</strong> Why can’t pump ordinary match signal extraordinary here?<br>
                <strong>A:</strong> The pump ordinary index is 1.509, but the signal extraordinary effective index at 1.2 µm cannot exceed the signal ordinary index 1.490.</li>
            <li><strong>Q:</strong> What does “ordinary polarization” mean geometrically?<br>
                <strong>A:</strong> The electric field is perpendicular to the principal plane (the plane containing the optic axis and the propagation direction).</li>
            <li><strong>Q:</strong> If θ → 0°, what is the pump extraordinary index?<br>
                <strong>A:</strong> It approaches the principal extraordinary index <code>n_e,p</code> (here 1.468).</li>
          </ul>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </article>

        <article id="plotguide">
          <h2>PART 5 — Optional Plot Guide</h2>
          <p class="muted">
            This single static plot is useful because it visualizes the only “tuning knob” in the problem:
            the pump extraordinary effective index <code>n_e,p(θ)</code>.
          </p>
          <ul class="muted">
            <li><strong>x-axis:</strong> propagation angle <code>θ</code> to the optic axis (degrees).</li>
            <li><strong>y-axis:</strong> pump extraordinary effective refractive index <code>n_e,p(θ)</code> (dimensionless).</li>
            <li><strong>Horizontal line:</strong> the target <code>n_o,s = 1.490</code> (given, not an example value).</li>
            <li><strong>Feature to notice:</strong> the intersection occurs near <code>θ ≈ 47.7°</code>, which is the phase-matching angle.</li>
          </ul>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </article>

        <footer>
          <p>
            Built as a self-contained learning article (vanilla HTML/CSS/JS). Copy buttons copy plain text equations and the final result.
          </p>
        </footer>
      </main>
    </div>
  </div>

  <script>
    (function(){
      function copyText(text){
        if (navigator.clipboard && navigator.clipboard.writeText) {
          return navigator.clipboard.writeText(text);
        }
        return new Promise(function(resolve, reject){
          try{
            var ta = document.createElement('textarea');
            ta.value = text;
            ta.setAttribute('readonly','');
            ta.style.position='fixed';
            ta.style.top='-1000px';
            ta.style.left='-1000px';
            document.body.appendChild(ta);
            ta.select();
            var ok = document.execCommand('copy');
            document.body.removeChild(ta);
            ok ? resolve() : reject(new Error('execCommand failed'));
          }catch(e){ reject(e); }
        });
      }

      function attachCopyButtons(){
        var blocks = document.querySelectorAll('.eq[data-copy]');
        blocks.forEach(function(block){
          var btn = block.querySelector('.copybtn');
          var code = block.querySelector('pre code');
          if(!btn || !code) return;
          btn.addEventListener('click', function(){
            var original = btn.textContent;
            btn.textContent = 'Copying…';
            btn.disabled = true;
            copyText(code.innerText.trim()).then(function(){
              btn.textContent = 'Copied ✓';
              setTimeout(function(){
                btn.textContent = original;
                btn.disabled = false;
              }, 950);
            }).catch(function(){
              btn.textContent = 'Copy failed';
              setTimeout(function(){
                btn.textContent = original;
                btn.disabled = false;
              }, 1200);
            });
          });
        });
      }

      function neTheta(thetaRad, ne, no){
        var c = Math.cos(thetaRad);
        var s = Math.sin(thetaRad);
        var inv = (c*c)/(ne*ne) + (s*s)/(no*no);
        return 1/Math.sqrt(inv);
      }

      function drawPlot(){
        var canvas = document.getElementById('plot');
        if(!canvas) return;
        var ctx = canvas.getContext('2d');

        var dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
        var cssW = canvas.clientWidth;
        var cssH = canvas.clientHeight;
        canvas.width = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);

        var no_p = 1.509, ne_p = 1.468;
        var n_target = 1.490;

        var best = {theta:0, err:1e9, n:0};
        for(var i=0;i<=2000;i++){
          var th = (Math.PI/2) * (i/2000);
          var n = neTheta(th, ne_p, no_p);
          var e = Math.abs(n - n_target);
          if(e < best.err){
            best = {theta: th, err:e, n:n};
          }
        }

        var padL=56, padR=14, padT=34, padB=44;
        var W=cssW, H=cssH;
        var x0=padL, y0=H-padB, x1=W-padR, y1=padT;
        var plotW=x1-x0, plotH=y0-y1;

        var xmin=0, xmax=90;
        var ymin=1.466, ymax=1.512;

        function xMap(x){ return x0 + (x - xmin) * plotW / (xmax - xmin); }
        function yMap(y){ return y0 - (y - ymin) * plotH / (ymax - ymin); }

        ctx.clearRect(0,0,W,H);

        ctx.fillStyle = "rgba(255,255,255,0.02)";
        ctx.fillRect(8,8,W-16,H-16);

        ctx.lineWidth = 1;
        ctx.strokeStyle = "rgba(255,255,255,0.08)";
        ctx.beginPath();
        var xticks = [0,15,30,45,60,75,90];
        xticks.forEach(function(t){
          var X = xMap(t);
          ctx.moveTo(X, y1);
          ctx.lineTo(X, y0);
        });
        var yticks = [1.47,1.48,1.49,1.50,1.51];
        yticks.forEach(function(t){
          var Y = yMap(t);
          ctx.moveTo(x0, Y);
          ctx.lineTo(x1, Y);
        });
        ctx.stroke();

        ctx.strokeStyle = "rgba(255,255,255,0.25)";
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(x0, y1);
        ctx.lineTo(x0, y0);
        ctx.lineTo(x1, y0);
        ctx.stroke();

        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.font = "700 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("Pump extraordinary index nₑ,p(θ) vs angle θ (KDP, λp=0.6 µm)", x0, 10);

        ctx.fillStyle = "rgba(255,255,255,0.80)";
        ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        ctx.fillText("θ to optic axis (degrees)", (x0+x1)/2, H-26);

        ctx.save();
        ctx.translate(18, (y0+y1)/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        ctx.fillText("Refractive index (dimensionless)", 0, 0);
        ctx.restore();

        ctx.fillStyle = "rgba(255,255,255,0.65)";
        ctx.font = "500 11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        xticks.forEach(function(t){
          ctx.fillText(String(t), xMap(t), y0 + 8);
        });
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        yticks.forEach(function(t){
          ctx.fillText(t.toFixed(2), x0 - 10, yMap(t));
        });

        ctx.strokeStyle = "rgba(125,211,252,0.95)";
        ctx.lineWidth = 2.2;
        ctx.beginPath();
        for(var i=0;i<=700;i++){
          var thDeg = xmin + (xmax-xmin)*i/700;
          var th = thDeg * Math.PI/180;
          var n = neTheta(th, ne_p, no_p);
          var X = xMap(thDeg);
          var Y = yMap(n);
          if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
        }
        ctx.stroke();

        ctx.strokeStyle = "rgba(134,239,172,0.85)";
        ctx.lineWidth = 1.8;
        var Yt = yMap(n_target);
        ctx.beginPath();
        ctx.moveTo(x0, Yt);
        ctx.lineTo(x1, Yt);
        ctx.stroke();

        var thBestDeg = best.theta * 180/Math.PI;
        var Xb = xMap(thBestDeg);
        var Yb = yMap(best.n);
        ctx.fillStyle = "rgba(255,255,255,0.90)";
        ctx.beginPath();
        ctx.arc(Xb, Yb, 4.4, 0, Math.PI*2);
        ctx.fill();

        var label = "Match at θ ≈ " + thBestDeg.toFixed(1) + "° (nₑ,p ≈ " + best.n.toFixed(3) + ")";
        ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "bottom";
        var tx = Math.min(x1-6, Xb + 10);
        var ty = Math.max(y1+18, Yb - 10);
        var metrics = ctx.measureText(label);
        var bw = metrics.width + 12;
        var bh = 22;
        ctx.fillStyle = "rgba(10,14,30,0.75)";
        ctx.strokeStyle = "rgba(255,255,255,0.16)";
        ctx.lineWidth = 1;
        roundRect(ctx, tx, ty-bh, bw, bh, 10, true, true);
        ctx.fillStyle = "rgba(255,255,255,0.88)";
        ctx.fillText(label, tx + 6, ty - 6);

        var lx = x1 - 250, ly = y1 + 8;
        ctx.fillStyle = "rgba(10,14,30,0.62)";
        ctx.strokeStyle = "rgba(255,255,255,0.16)";
        roundRect(ctx, lx, ly, 240, 44, 12, true, true);
        ctx.font = "600 11.5px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";

        ctx.strokeStyle = "rgba(125,211,252,0.95)";
        ctx.lineWidth = 2.2;
        ctx.beginPath(); ctx.moveTo(lx+12, ly+14); ctx.lineTo(lx+42, ly+14); ctx.stroke();
        ctx.fillStyle = "rgba(255,255,255,0.82)";
        ctx.fillText("nₑ,p(θ) (pump, extraordinary)", lx+50, ly+14);

        ctx.strokeStyle = "rgba(134,239,172,0.85)";
        ctx.lineWidth = 1.8;
        ctx.beginPath(); ctx.moveTo(lx+12, ly+30); ctx.lineTo(lx+42, ly+30); ctx.stroke();
        ctx.fillStyle = "rgba(255,255,255,0.82)";
        ctx.fillText("Target nₒ,s = 1.490 (signal/idler, ordinary)", lx+50, ly+30);

        function roundRect(c, x, y, w, h, r, fill, stroke){
          if(w < 2*r) r = w/2;
          if(h < 2*r) r = h/2;
          c.beginPath();
          c.moveTo(x+r, y);
          c.arcTo(x+w, y, x+w, y+h, r);
          c.arcTo(x+w, y+h, x, y+h, r);
          c.arcTo(x, y+h, x, y, r);
          c.arcTo(x, y, x+w, y, r);
          c.closePath();
          if(fill) c.fill();
          if(stroke) c.stroke();
        }
      }

      attachCopyButtons();
      drawPlot();

      var resizeTimer = null;
      window.addEventListener('resize', function(){
        if(resizeTimer) clearTimeout(resizeTimer);
        resizeTimer = setTimeout(drawPlot, 120);
      }, {passive:true});
    })();
  </script>
</body>
</html>
