<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Collinear Type-II (o–e–e) Three-Wave Mixing in a 3m Crystal (BBO): Deriving d_eff = d_22 cos²θ cos 3φ</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1730;
      --card:#101b3a;
      --ink:#e9eefc;
      --muted:#b9c4e6;
      --faint:#7f8ab3;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(233,238,252,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:24px;
      --max:1100px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background:
        radial-gradient(1200px 650px at 20% -10%, rgba(125,211,252,.18), transparent 55%),
        radial-gradient(900px 520px at 90% 0%, rgba(167,139,250,.18), transparent 52%),
        radial-gradient(900px 520px at 50% 120%, rgba(52,211,153,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #070a14 70%);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre, .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    header{
      padding:28px 18px 14px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.05), transparent);
      position:relative;
      overflow:hidden;
    }
    header::before{
      content:"";
      position:absolute;
      inset:-200px -200px auto -200px;
      height:360px;
      background: radial-gradient(closest-side, rgba(125,211,252,.12), transparent 70%);
      transform: rotate(-8deg);
      pointer-events:none;
    }

    .wrap{
      width:min(var(--max), calc(100% - 32px));
      margin:0 auto;
      position:relative;
      z-index:1;
    }

    .title{
      display:grid;
      gap:10px;
      align-items:start;
    }
    h1{
      margin:0;
      font-size:clamp(1.45rem, 1.15rem + 1.4vw, 2.35rem);
      letter-spacing:.2px;
      line-height:1.18;
    }
    .subtitle{
      margin:0;
      max-width:72ch;
      color:var(--muted);
      font-size:clamp(.98rem, .92rem + .3vw, 1.08rem);
    }

    main{
      padding:18px 18px 44px;
    }

    .layout{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }

    /* Sticky mini ToC */
    .toc{
      position:sticky;
      top:12px;
      align-self:start;
      background:rgba(16,27,58,.78);
      border:1px solid var(--line);
      border-radius:var(--radius2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding:14px 14px 10px;
    }
    .toc h2{
      margin:0 0 8px;
      font-size:1rem;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .toc h2::before{
      content:"";
      width:10px;height:10px;border-radius:3px;
      background:linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow:0 0 0 3px rgba(125,211,252,.14);
    }
    .toc a{
      display:block;
      padding:7px 10px;
      border-radius:12px;
      color:var(--muted);
      border:1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .toc a:hover{
      background:rgba(125,211,252,.08);
      border-color:rgba(125,211,252,.18);
      transform: translateX(2px);
      text-decoration:none;
      color:var(--ink);
    }
    .toc .small{
      margin-top:8px;
      padding-top:10px;
      border-top:1px dashed rgba(233,238,252,.15);
      font-size:.92rem;
      color:var(--faint);
    }

    @media (min-width: 980px){
      .layout{
        grid-template-columns: 320px 1fr;
        gap:18px;
      }
    }

    section{
      background:rgba(16,27,58,.58);
      border:1px solid var(--line);
      border-radius:var(--radius2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      padding:18px;
      overflow:hidden;
    }
    section + section{margin-top:14px}

    h2{
      margin:0 0 10px;
      font-size:1.22rem;
      letter-spacing:.2px;
    }
    h3{
      margin:16px 0 8px;
      font-size:1.05rem;
      color:var(--ink);
      letter-spacing:.15px;
    }
    p{margin:10px 0}
    ul{margin:10px 0 10px 22px}
    li{margin:6px 0}
    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 820px){
      .grid2{grid-template-columns: 1fr 1fr}
    }

    .callout{
      border-radius:18px;
      border:1px solid rgba(233,238,252,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .callout::after{
      content:"";
      position:absolute;
      inset:auto -20% -40% -20%;
      height:160px;
      background: radial-gradient(closest-side, rgba(125,211,252,.10), transparent 70%);
      transform: rotate(8deg);
      pointer-events:none;
    }
    .callout .label{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:.88rem;
      letter-spacing:.2px;
      border:1px solid rgba(233,238,252,.16);
      background:rgba(16,27,58,.55);
      margin-bottom:8px;
    }
    .label.good{color:var(--good)}
    .label.warn{color:var(--warn)}
    .label.bad{color:var(--bad)}
    .label.key{color:var(--accent)}
    .label.note{color:var(--muted)}

    .eq{
      margin:10px 0;
      padding:12px 12px 10px;
      border-radius:16px;
      border:1px solid rgba(125,211,252,.20);
      background:rgba(125,211,252,.06);
      overflow:auto;
      position:relative;
    }
    .eq .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .eq pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      color:var(--ink);
      font-size:.98rem;
      line-height:1.4;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(233,238,252,.18);
      background:rgba(16,27,58,.65);
      color:var(--ink);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      font-size:.9rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      background:rgba(125,211,252,.10);
      border-color:rgba(125,211,252,.22);
      transform: translateY(-1px);
    }
    .btn:active{transform: translateY(0)}
    .btn.small{padding:6px 9px; font-size:.86rem}

    details{
      border-radius:18px;
      border:1px solid rgba(233,238,252,.14);
      background:rgba(16,27,58,.45);
      padding:10px 12px;
      margin:10px 0;
    }
    details summary{
      cursor:pointer;
      font-weight:700;
      color:var(--muted);
      list-style:none;
      display:flex;
      align-items:center;
      gap:10px;
    }
    details summary::-webkit-details-marker{display:none}
    details summary::before{
      content:"▸";
      display:inline-block;
      transform: translateY(-1px);
      transition: transform .16s ease;
      color:var(--accent);
      font-weight:900;
    }
    details[open] summary::before{transform: rotate(90deg) translateX(1px)}
    details .content{margin-top:8px; color:var(--muted)}
    .hr{
      height:1px;
      background:linear-gradient(90deg, transparent, rgba(233,238,252,.18), transparent);
      margin:14px 0;
    }

    figure{
      margin:10px 0 0;
      border-radius:18px;
      border:1px solid rgba(233,238,252,.14);
      background:rgba(10,14,28,.55);
      overflow:hidden;
    }
    figcaption{
      padding:10px 12px;
      color:var(--muted);
      font-size:.95rem;
      border-top:1px solid rgba(233,238,252,.10);
    }
    canvas{display:block; width:100%; height:auto}

    .backtop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(233,238,252,.16);
      background:rgba(16,27,58,.55);
      color:var(--muted);
      font-weight:650;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .backtop:hover{
      transform: translateY(-1px);
      background:rgba(125,211,252,.10);
      border-color:rgba(125,211,252,.22);
      color:var(--ink);
      text-decoration:none;
    }

    footer{
      padding:18px;
      color:var(--faint);
      border-top:1px solid var(--line);
      background:rgba(255,255,255,.02);
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      header, footer{background:#fff; border-color:#ccc}
      section, .toc{box-shadow:none; backdrop-filter:none; background:#fff; border-color:#ccc}
      a{color:#000; text-decoration:underline}
      .btn, .backtop{display:none !important}
      .layout{grid-template-columns:1fr !important}
      .toc{position:static !important}
      details{break-inside:avoid}
      section{break-inside:avoid; page-break-inside:avoid}
      h2, h3{page-break-after:avoid}
    }

    /* Subtle entry animation */
    @media (prefers-reduced-motion: no-preference){
      section{
        animation: rise .35s ease both;
      }
      @keyframes rise{
        from{transform: translateY(6px); opacity:.92}
        to{transform: translateY(0); opacity:1}
      }
    }
  </style>
</head>
<body>
  <a id="top"></a>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>Collinear Type-II (o–e–e) Three-Wave Mixing in a <span class="mono">3m</span> Crystal (BBO): Derive <span class="mono">d<sub>eff</sub> = d<sub>22</sub> cos²θ cos 3φ</span></h1>
        <p class="subtitle">
          We show—step by step—how crystal symmetry and polarization geometry combine to produce the angular dependence
          of the effective nonlinear coefficient for collinear Type-II <span class="mono">o–e–e</span> mixing in a uniaxial <span class="mono">3m</span> crystal such as BBO.
        </p>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="layout">
        <nav class="toc" aria-label="Mini table of contents">
          <h2>Table of Contents</h2>
          <a href="#qs">Quick Summary</a>
          <a href="#p0">PART 0 — Concept Primer</a>
          <a href="#p1">PART 1 — Problem Analysis</a>
          <a href="#p2">PART 2 — Strategy & Tips</a>
          <a href="#p3">PART 3 — Full Solution</a>
          <a href="#p4">PART 4 — Deeper Understanding</a>
          <a href="#p5">PART 5 — Optional Plot Guide</a>
          <div class="small">
            Tip: Use the “Copy” buttons to grab equations as plain text.
          </div>
        </nav>

        <article>
          <section id="qs">
            <h2>Quick Summary</h2>
            <ul>
              <li><strong>What this is about:</strong> finding the <em>effective</em> nonlinear coefficient <span class="mono">d<sub>eff</sub></span> for collinear Type-II <span class="mono">o–e–e</span> three-wave mixing in a <span class="mono">3m</span> crystal (e.g., BBO).</li>
              <li><strong>Key physics idea:</strong> <span class="mono">d<sub>eff</sub></span> is a <em>projection</em> of the second-order tensor <span class="mono">d<sub>ijk</sub></span> onto the participating field polarizations.</li>
              <li><strong>Governing relation:</strong> nonlinear polarization <span class="mono">P_i(ω₃) = 2ε₀ Σ<sub>jk</sub> d<sub>ijk</sub> E_j(ω₁) E_k(ω₂)</span> (with symmetry in <span class="mono">j↔k</span>).</li>
              <li><strong>Geometry:</strong> the common propagation direction is specified by spherical angles <span class="mono">(θ, φ)</span> relative to the crystal axes (with <span class="mono">z</span> along the optic axis).</li>
              <li><strong>Polarizations:</strong> for collinear mixing, the ordinary unit polarization is perpendicular to the principal plane; the extraordinary unit polarization lies in the principal plane (both ⟂ to <span class="mono">k</span>).</li>
              <li><strong>Symmetry payoff:</strong> in <span class="mono">3m</span>, many tensor components vanish; for <span class="mono">o–e–e</span>, the surviving contraction reduces cleanly to a single coefficient <span class="mono">d<sub>22</sub></span>.</li>
              <li><strong>Result type:</strong> purely <strong>symbolic</strong>; the answer is an angular dependence.</li>
              <li><strong>Physical meaning:</strong> <span class="mono">cos²θ</span> comes from how much the extraordinary polarization “leans” along the optic axis as the beam tilts; <span class="mono">cos 3φ</span> reflects the threefold rotational symmetry about <span class="mono">z</span>.</li>
            </ul>

            <div class="callout">
              <div class="label key">Final result (to be proved)</div>
              <div class="eq" data-copy>
                <div class="row">
                  <pre>For collinear Type-II o–e–e mixing in a 3m crystal (e.g., BBO):
d_eff = d_22 cos^2(θ) cos(3φ).</pre>
                  <button class="btn small" type="button" data-copybtn>Copy</button>
                </div>
              </div>
            </div>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="p0">
            <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

            <h3>0.1 Core definitions (symbols + SI units)</h3>
            <ul>
              <li><span class="mono">E</span>: electric field amplitude (V·m<sup>−1</sup>).</li>
              <li><span class="mono">P</span>: polarization density (C·m<sup>−2</sup>).</li>
              <li><span class="mono">ε₀</span>: vacuum permittivity (F·m<sup>−1</sup>).</li>
              <li><span class="mono">d<sub>ijk</sub></span>: second-order nonlinear coefficient tensor (m·V<sup>−1</sup> in SI; often quoted in pm·V<sup>−1</sup>).</li>
              <li><span class="mono">d<sub>eff</sub></span>: effective nonlinear coefficient for a specific interaction (same units as <span class="mono">d</span>).</li>
              <li><span class="mono">k</span>: wavevector (m<sup>−1</sup>); for collinear mixing, all waves share the same direction <span class="mono">ŝ</span>.</li>
              <li><span class="mono">(θ, φ)</span>: polar and azimuthal angles of <span class="mono">ŝ</span> in the crystal frame; <span class="mono">θ</span> from the optic axis <span class="mono">z</span>, <span class="mono">φ</span> from <span class="mono">x</span> in the <span class="mono">xy</span> plane (radians).</li>
              <li><span class="mono">o</span>, <span class="mono">e</span>: ordinary and extraordinary waves (polarization eigenmodes in a uniaxial crystal).</li>
            </ul>

            <h3>0.2 What <span class="mono">d<sub>eff</sub></span> really is (intuition)</h3>
            <p>
              In any second-order process (SHG, SFG, DFG), the crystal produces a nonlinear polarization at the generated frequency.
              Only the component of that nonlinear polarization along the <em>generated wave’s polarization</em> drives the generated wave efficiently.
              That is why <span class="mono">d<sub>eff</sub></span> is essentially a <strong>triple projection</strong>:
              one projection for the output polarization and two for the input polarizations.
            </p>

            <div class="callout">
              <div class="label key">Key law: second-order nonlinear polarization</div>
              <div class="eq" data-copy>
                <div class="row">
                  <pre>P_i(ω3) = 2 ε0 Σ_{j,k} d_{i j k} E_j(ω1) E_k(ω2)  (with symmetry in j↔k for most crystals away from resonances)</pre>
                  <button class="btn small" type="button" data-copybtn>Copy</button>
                </div>
              </div>
              <p style="margin:8px 0 0;color:var(--muted)">
                For a chosen set of unit polarization vectors <span class="mono">ê₁, ê₂, ê₃</span> (at <span class="mono">ω₁, ω₂, ω₃</span>), we define
                <span class="mono">d_eff</span> so that the driven polarization along the output mode is
                <span class="mono">P_‖(ω3) = 2 ε0 d_eff E1 E2</span>.
              </p>
            </div>

            <h3>0.3 Symmetry + contracted notation (why the tensor becomes manageable)</h3>
            <p>
              Because the product <span class="mono">E_j E_k</span> is symmetric under exchanging <span class="mono">j</span> and <span class="mono">k</span>, we often use the
              <em>contracted</em> (Voigt) notation:
              <span class="mono">(xx, yy, zz, yz, zx, xy) → (1,2,3,4,5,6)</span>.
              Then each row corresponds to <span class="mono">P_x, P_y, P_z</span>.
            </p>

            <details>
              <summary>Optional deeper note: the “why” of <span class="mono">cos 3φ</span></summary>
              <div class="content">
                <p>
                  A <span class="mono">3m</span> crystal has a threefold rotational symmetry about the optic axis <span class="mono">z</span>.
                  Rotating the crystal by <span class="mono">120°</span> about <span class="mono">z</span> must not change measurable physics,
                  which strongly constrains how any scalar “coupling strength” can depend on the azimuthal angle <span class="mono">φ</span>.
                  The simplest periodic dependence consistent with threefold symmetry is <span class="mono">cos 3φ</span> (or <span class="mono">sin 3φ</span> depending on conventions).
                </p>
              </div>
            </details>

            <h3>0.4 Ordinary vs extraordinary polarization (collinear, uniaxial)</h3>
            <p>
              Let the optic axis be the crystal <span class="mono">z</span> axis, and the common propagation direction be <span class="mono">ŝ</span>.
              The <strong>principal plane</strong> is the plane spanned by <span class="mono">ŝ</span> and <span class="mono">z</span>.
            </p>
            <ul>
              <li><strong>Ordinary mode (o):</strong> polarization perpendicular to the principal plane (and ⟂ <span class="mono">ŝ</span>).</li>
              <li><strong>Extraordinary mode (e):</strong> polarization in the principal plane, still ⟂ <span class="mono">ŝ</span>.</li>
            </ul>

            <div class="callout">
              <div class="label warn">What to watch for (common pitfalls)</div>
              <ul style="margin:8px 0 0 22px; color:var(--muted)">
                <li><strong>Angle conventions:</strong> <span class="mono">φ</span> measured from <span class="mono">x</span> vs from <span class="mono">y</span> changes sine/cosine forms.</li>
                <li><strong>Polarization sign:</strong> <span class="mono">ê_o</span> and <span class="mono">−ê_o</span> are both valid; this can flip an overall sign in <span class="mono">d_eff</span> (physically irrelevant because intensity depends on <span class="mono">|d_eff|²</span>).</li>
                <li><strong>Which wave is “o”:</strong> Type-II labels which participating fields are ordinary/extraordinary—keep the assignment consistent in the contraction.</li>
                <li><strong>Tensor convention:</strong> some references swap signs in the contracted matrix for <span class="mono">d_22</span>; always match the book’s convention.</li>
              </ul>
            </div>

            <a class="backtop" href="#top">↑ Back to top</a>
          </section>

          <section id="p1">
            <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

            <h3>1.1 Restate the problem</h3>
            <p>
              We consider <strong>collinear</strong> Type-II <span class="mono">o–e–e</span> three-wave mixing in a uniaxial crystal of point group <span class="mono">3m</span>
              (such as BBO). We must <strong>repeat the style of analysis</strong> used in a worked example and show that the
              <em>effective nonlinear coefficient</em> for this interaction is
              <span class="mono">d_eff = d_22 cos²θ cos 3φ</span>.
            </p>

            <h3>1.2 Given quantities</h3>
            <ul>
              <li>Crystal symmetry: point group <span class="mono">3m</span> (BBO is a common example).</li>
              <li>Collinear propagation direction <span class="mono">ŝ</span> specified by angles <span class="mono">θ</span> and <span class="mono">φ</span> in the crystal frame.</li>
              <li>Type-II <span class="mono">o–e–e</span>: one interacting wave is ordinary, the other interacting wave is extraordinary, and the generated wave is extraordinary (all collinear).</li>
            </ul>

            <h3>1.3 Unknowns / what must be shown</h3>
            <ul>
              <li>Find (or demonstrate) the angular dependence of <span class="mono">d_eff</span> and prove:
                <span class="mono">d_eff = d_22 cos²θ cos 3φ</span>.</li>
            </ul>

            <h3>1.4 Relevant principles (and why they apply)</h3>
            <div class="grid2">
              <div class="callout">
                <div class="label key">Applies</div>
                <ul style="margin:8px 0 0 22px; color:var(--muted)">
                  <li><strong>Second-order nonlinear polarization:</strong> definition of <span class="mono">d_eff</span> as a projection of <span class="mono">d_{ijk}</span> along polarization vectors.</li>
                  <li><strong>Mode polarizations in a uniaxial crystal:</strong> ordinary and extraordinary unit vectors expressed in the crystal frame using <span class="mono">(θ, φ)</span>.</li>
                  <li><strong>Crystal symmetry:</strong> the <span class="mono">3m</span> tensor form strongly restricts <span class="mono">d_{ijk}</span>, enabling an analytic contraction.</li>
                </ul>
              </div>
              <div class="callout">
                <div class="label note">Does not need to be used here</div>
                <ul style="margin:8px 0 0 22px; color:var(--muted)">
                  <li><strong>Coupled-wave amplitude growth</strong> (sinc factors, depletion, walkoff): those govern conversion efficiency vs length, not the tensor projection defining <span class="mono">d_eff</span>.</li>
                  <li><strong>Exact birefringent dispersion</strong> (Sellmeier): determines phase-matching angles, but the task is to derive <span class="mono">d_eff(θ,φ)</span> once angles are specified.</li>
                </ul>
              </div>
            </div>

            <div class="callout">
              <div class="label warn">Assumptions (stated explicitly)</div>
              <ul style="margin:8px 0 0 22px; color:var(--muted)">
                <li><strong>Collinear waves:</strong> all three waves share the same propagation direction <span class="mono">ŝ</span>.</li>
                <li><strong>Plane waves / well-defined polarizations:</strong> we use unit polarization vectors for <span class="mono">o</span> and <span class="mono">e</span> eigenmodes.</li>
                <li><strong>Second-order tensor symmetry in indices (j↔k):</strong> the usual contracted notation is valid (appropriate for many transparent dielectric crystals away from strong resonances).</li>
                <li><strong>Crystal axes:</strong> <span class="mono">z</span> is the optic axis; <span class="mono">x,y</span> are transverse crystal axes consistent with the standard <span class="mono">3m</span> contracted <span class="mono">d</span>-matrix.</li>
              </ul>
            </div>

            <h3>1.5 Possible approaches (compare and choose)</h3>
            <ul>
              <li><strong>Approach A — Full tensor contraction (recommended):</strong>
                write <span class="mono">ê_o</span>, <span class="mono">ê_e</span> in crystal coordinates, use the <span class="mono">3m</span> contracted matrix, build the mixed products, and project along the output polarization.
                <em>Pros:</em> transparent, systematic, and shows why only <span class="mono">d_22</span> survives. <em>Cons:</em> some algebra.</li>
              <li><strong>Approach B — Symmetry argument first, then fix prefactors:</strong>
                use threefold symmetry to infer <span class="mono">cos 3φ</span>, then use limiting cases to infer <span class="mono">cos²θ</span>.
                <em>Pros:</em> quick intuition. <em>Cons:</em> not a rigorous “repeat the analysis” derivation.</li>
              <li><strong>Approach C — Rotate tensor to the wave frame:</strong>
                perform a full rotation of <span class="mono">d_{ijk}</span> with direction cosines, then read off <span class="mono">d_eff</span>.
                <em>Pros:</em> very general. <em>Cons:</em> heavier than needed for this specific problem.</li>
            </ul>
            <p>
              We choose <strong>Approach A</strong> because it is the cleanest way to demonstrate the stated result while staying close to typical textbook “Example” analyses.
            </p>

            <a class="backtop" href="#top">↑ Back to top</a>
          </section>

          <section id="p2">
            <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

            <ol style="margin:10px 0 10px 20px">
              <li><strong>Set coordinates:</strong> define the propagation direction <span class="mono">ŝ(θ,φ)</span> in the crystal frame. <em>Meaning:</em> fixes geometry of the principal plane.</li>
              <li><strong>Write polarization unit vectors:</strong> construct <span class="mono">ê_o</span> (⊥ principal plane) and <span class="mono">ê_e</span> (in principal plane, ⟂ <span class="mono">ŝ</span>). <em>Meaning:</em> connects angles to field components.</li>
              <li><strong>Recall the <span class="mono">3m</span> contracted tensor:</strong> write the standard <span class="mono">d</span>-matrix in Voigt form. <em>Meaning:</em> encodes symmetry restrictions.</li>
              <li><strong>Form mixed products for Type-II:</strong> use the “two-field” version of Voigt products (e.g., <span class="mono">E1xE2y + E1yE2x</span>). <em>Meaning:</em> adapts quadratic tensor law to mixing.</li>
              <li><strong>Compute the nonlinear polarization vector:</strong> obtain <span class="mono">P</span> from the tensor contraction. <em>Meaning:</em> this is what drives the generated wave.</li>
              <li><strong>Project onto the output polarization:</strong> <span class="mono">d_eff</span> is proportional to <span class="mono">ê_3 · P</span>. <em>Meaning:</em> only the matching output mode is effective.</li>
              <li><strong>Simplify trig:</strong> use identities to show the azimuthal dependence becomes <span class="mono">cos 3φ</span>, and the polar dependence gives <span class="mono">cos²θ</span>.</li>
              <li><strong>Sanity checks:</strong> periodicity in <span class="mono">φ</span> (threefold), zeros where symmetry predicts, and sign conventions.</li>
            </ol>

            <div class="callout">
              <div class="label bad">Common mistakes</div>
              <ul style="margin:8px 0 0 22px; color:var(--muted)">
                <li>Using the <span class="mono">E_x^2</span> Voigt vector for SHG instead of the <em>mixed-product</em> vector for three-wave mixing.</li>
                <li>Forgetting that both ordinary and extraordinary polarizations must satisfy <span class="mono">ê · ŝ = 0</span>.</li>
                <li>Mixing up <span class="mono">sin</span>/<span class="mono">cos</span> in the direction cosines for <span class="mono">ŝ</span> (especially the <span class="mono">φ</span> components).</li>
                <li>Panicking if you get an overall minus sign: it can come from choosing <span class="mono">ê_o</span> versus <span class="mono">−ê_o</span> or from a different tensor sign convention.</li>
              </ul>
            </div>

            <a class="backtop" href="#top">↑ Back to top</a>
          </section>

          <section id="p3">
            <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

            <h3>3.1 Qualitative expectation (before algebra)</h3>
            <p>
              Because the crystal is threefold symmetric about <span class="mono">z</span>, the coupling strength cannot depend arbitrarily on the azimuth <span class="mono">φ</span>;
              it should repeat every <span class="mono">120°</span>, suggesting a <span class="mono">cos 3φ</span> or <span class="mono">sin 3φ</span> pattern.
              Also, if the beam propagates nearly perpendicular to the optic axis (large <span class="mono">θ</span>), the extraordinary polarization gains a larger component along <span class="mono">−z</span>,
              changing how strongly it samples tensor elements; a factor like <span class="mono">cos θ</span> (or <span class="mono">cos²θ</span>) is therefore plausible.
              The stated goal <span class="mono">cos²θ cos 3φ</span> matches both intuitions.
            </p>

            <div class="hr"></div>

            <h3>3.2 Geometry: propagation direction <span class="mono">ŝ(θ,φ)</span></h3>
            <p>
              Choose the crystal axes so that <span class="mono">z</span> is the optic axis. Let the unit propagation direction be
            </p>
            <div class="eq" data-copy>
              <div class="row">
                <pre>ŝ = (sinθ cosφ,  sinθ sinφ,  cosθ).</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>
            <p style="color:var(--muted)">
              This is standard spherical-coordinate direction cosines in the crystal frame.
            </p>

            <h3>3.3 Polarization unit vectors for collinear ordinary and extraordinary waves</h3>
            <p>
              The principal plane is spanned by <span class="mono">ŝ</span> and <span class="mono">ẑ</span>.
              A convenient orthonormal basis transverse to <span class="mono">ŝ</span> is:
            </p>

            <div class="callout">
              <div class="label key">Ordinary polarization (perpendicular to principal plane)</div>
              <p style="margin:8px 0 0;color:var(--muted)">
                Start from <span class="mono">ẑ × ŝ</span>, which is perpendicular to both <span class="mono">ẑ</span> and <span class="mono">ŝ</span>.
                Normalize to get <span class="mono">ê_o</span>. One consistent choice is:
              </p>
              <div class="eq" data-copy>
                <div class="row">
                  <pre>ê_o = ( sinφ,  −cosφ,  0 ).</pre>
                  <button class="btn small" type="button" data-copybtn>Copy</button>
                </div>
              </div>
              <p style="margin:8px 0 0;color:var(--muted)">
                (Choosing <span class="mono">−ê_o</span> is equally valid and only flips the overall sign of <span class="mono">d_eff</span>.)
              </p>
            </div>

            <div class="callout">
              <div class="label key">Extraordinary polarization (in principal plane, still ⟂ ŝ)</div>
              <p style="margin:8px 0 0;color:var(--muted)">
                Build the second transverse unit vector by <span class="mono">ê_e = ê_o × ŝ</span>, which lies in the principal plane and remains orthogonal to <span class="mono">ŝ</span>:
              </p>
              <div class="eq" data-copy>
                <div class="row">
                  <pre>ê_e = ( cosφ cosθ,  sinφ cosθ,  −sinθ ).</pre>
                  <button class="btn small" type="button" data-copybtn>Copy</button>
                </div>
              </div>
            </div>

            <details>
              <summary>Optional check: verify orthonormality</summary>
              <div class="content">
                <ul>
                  <li><span class="mono">ê_o · ŝ = 0</span> and <span class="mono">ê_e · ŝ = 0</span> (both transverse).</li>
                  <li><span class="mono">ê_o · ê_e = 0</span> and <span class="mono">|ê_o|=|ê_e|=1</span>.</li>
                </ul>
                <p>
                  These properties ensure we are projecting the tensor onto physically correct polarization directions.
                </p>
              </div>
            </details>

            <div class="hr"></div>

            <h3>3.4 The <span class="mono">3m</span> contracted nonlinear tensor</h3>
            <p>
              In Voigt notation (columns correspond to <span class="mono">xx, yy, zz, yz, zx, xy</span>),
              a common standard form for a <span class="mono">3m</span> crystal is:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>[P_x]   [ 0     0     0     0    d_15  −d_22 ] [E_x E_x]
[P_y] = [ −d_22 d_22  0    d_15   0     0   ] [E_y E_y]
[P_z]   [ d_31  d_31  d_33  0     0     0   ] [E_z E_z]
                                     (Voigt products: 2E_yE_z, 2E_zE_x, 2E_xE_y)</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p style="color:var(--muted)">
              For three-wave mixing (two different fields), we must use the <em>mixed-product</em> version of the Voigt vector rather than <span class="mono">(E_x^2, E_y^2, ...)</span>.
            </p>

            <h3>3.5 Mixed-product Voigt vector for two fields</h3>
            <p>
              Let the interacting fields be <span class="mono">E(ω1) = E1 ê1</span> and <span class="mono">E(ω2) = E2 ê2</span>.
              Then the symmetric mixed products replacing <span class="mono">(E_x^2, E_y^2, ...)</span> are:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>f1 = E1x E2x
f2 = E1y E2y
f3 = E1z E2z
f4 = E1y E2z + E1z E2y
f5 = E1z E2x + E1x E2z
f6 = E1x E2y + E1y E2x</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p style="color:var(--muted)">
              With this, the nonlinear polarization vector produced at <span class="mono">ω3</span> is <span class="mono">P = 2ε0 · d · f</span>.
              The <span class="mono">d_eff</span> is the projection of <span class="mono">P</span> onto the generated wave’s polarization unit vector <span class="mono">ê3</span>.
            </p>

            <div class="hr"></div>

            <h3>3.6 Apply to Type-II <span class="mono">o–e–e</span> (collinear)</h3>
            <p>
              For Type-II <span class="mono">o–e–e</span>, take:
            </p>
            <ul>
              <li>Wave 1: ordinary, <span class="mono">ê1 = ê_o</span></li>
              <li>Wave 2: extraordinary, <span class="mono">ê2 = ê_e</span></li>
              <li>Generated wave 3: extraordinary, <span class="mono">ê3 = ê_e</span></li>
            </ul>

            <p>
              Because <span class="mono">d_eff</span> is defined per unit field amplitudes, we can work using just the unit vectors (the scalar amplitudes factor out).
              Thus set <span class="mono">E1 = ê_o</span> and <span class="mono">E2 = ê_e</span> in the mixed products.
            </p>

            <h3>3.7 Compute the needed mixed products</h3>
            <p>
              From
              <span class="mono">ê_o = ( sinφ, −cosφ, 0 )</span>
              and
              <span class="mono">ê_e = ( cosφ cosθ, sinφ cosθ, −sinθ )</span>,
              the components are:
            </p>
            <ul>
              <li><span class="mono">E1x = sinφ</span>, <span class="mono">E1y = −cosφ</span>, <span class="mono">E1z = 0</span></li>
              <li><span class="mono">E2x = cosφ cosθ</span>, <span class="mono">E2y = sinφ cosθ</span>, <span class="mono">E2z = −sinθ</span></li>
            </ul>

            <p>Now build the six mixed products:</p>
            <div class="eq" data-copy>
              <div class="row">
                <pre>f1 = E1x E2x = (sinφ)(cosφ cosθ) = sinφ cosφ cosθ
f2 = E1y E2y = (−cosφ)(sinφ cosθ) = −sinφ cosφ cosθ
f3 = E1z E2z = 0
f4 = E1y E2z + E1z E2y = (−cosφ)(−sinθ) + 0 = cosφ sinθ
f5 = E1z E2x + E1x E2z = 0 + (sinφ)(−sinθ) = −sinφ sinθ
f6 = E1x E2y + E1y E2x
   = (sinφ)(sinφ cosθ) + (−cosφ)(cosφ cosθ)
   = (sin^2φ − cos^2φ) cosθ = −cos(2φ) cosθ</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <div class="hr"></div>

            <h3>3.8 Compute the nonlinear polarization components using the <span class="mono">3m</span> matrix</h3>
            <p>
              Using the contracted form (rows for <span class="mono">P_x, P_y, P_z</span>):
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>P_x ∝ d_15 f5 − d_22 f6
P_y ∝ (−d_22) f1 + d_22 f2 + d_15 f4
P_z ∝ d_31 f1 + d_31 f2 + d_33 f3</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p style="color:var(--muted)">
              We use “∝” because the overall factor <span class="mono">2ε0 E1 E2</span> is common and will be absorbed into the definition of <span class="mono">d_eff</span>.
            </p>

            <p>Substitute the <span class="mono">f</span>’s found above:</p>
            <div class="eq" data-copy>
              <div class="row">
                <pre>P_x ∝ d_15(−sinφ sinθ) − d_22(−cos(2φ) cosθ)
    = −d_15 sinφ sinθ + d_22 cos(2φ) cosθ

P_y ∝ (−d_22)(sinφ cosφ cosθ) + d_22(−sinφ cosφ cosθ) + d_15(cosφ sinθ)
    = −2 d_22 sinφ cosφ cosθ + d_15 cosφ sinθ

P_z ∝ d_31 f1 + d_31 f2 + d_33 f3
    = d_31(sinφ cosφ cosθ) + d_31(−sinφ cosφ cosθ) + 0
    = 0</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p style="color:var(--muted)">
              A key simplification already appears: <span class="mono">P_z</span> cancels exactly because <span class="mono">f1 + f2 = 0</span> for this <span class="mono">o–e</span> pair.
            </p>

            <div class="hr"></div>

            <h3>3.9 Project onto the generated extraordinary polarization to get <span class="mono">d_eff</span></h3>
            <p>
              The generated wave is extraordinary, so we project the nonlinear polarization onto <span class="mono">ê3 = ê_e</span>.
              By definition (up to the common factor <span class="mono">2ε0 E1 E2</span>),
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>d_eff = ê_e · P  (with P computed per unit field amplitudes)</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p>
              With <span class="mono">ê_e = (cosφ cosθ, sinφ cosθ, −sinθ)</span> and <span class="mono">P_z = 0</span>,
              we have:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>d_eff = (cosφ cosθ) P_x + (sinφ cosθ) P_y</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p>Now substitute <span class="mono">P_x</span> and <span class="mono">P_y</span>:</p>
            <div class="eq" data-copy>
              <div class="row">
                <pre>d_eff ∝ (cosφ cosθ)( −d_15 sinφ sinθ + d_22 cos(2φ) cosθ )
     + (sinφ cosθ)( −2 d_22 sin^2φ cosφ cos^2θ + d_15 cosφ sinθ )</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p>
              Expand and group <span class="mono">d_15</span> terms and <span class="mono">d_22</span> terms:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>d_eff ∝  [ −d_15 cosφ sinφ cosθ sinθ  + d_22 cosφ cos(2φ) cos^2θ ]
      +  [ −2 d_22 sin^2φ cosφ cos^2θ + d_15 sinφ cosφ cosθ sinθ ]</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p>
              The <span class="mono">d_15</span> contributions cancel <em>exactly</em>:
              <span class="mono">−d_15(...)+d_15(...)=0</span>. Therefore, only <span class="mono">d_22</span> remains:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>d_eff ∝ d_22 cos^2θ [ cosφ cos(2φ) − 2 sin^2φ cosφ ]</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <h3>3.10 Trig simplification to <span class="mono">cos 3φ</span></h3>
            <p>
              Factor out <span class="mono">cosφ</span> and simplify the bracket:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>cosφ cos(2φ) − 2 sin^2φ cosφ
= cosφ [ cos(2φ) − 2 sin^2φ ]</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p>
              Use <span class="mono">sin^2φ = (1 − cos(2φ))/2</span>:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>cos(2φ) − 2 sin^2φ
= cos(2φ) − (1 − cos(2φ))
= 2cos(2φ) − 1</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <p>
              Then recognize the identity:
              <span class="mono">cos(3φ) = cosφ(2cos(2φ) − 1)</span>.
              Hence:
            </p>

            <div class="eq" data-copy>
              <div class="row">
                <pre>cosφ [2cos(2φ) − 1] = cos(3φ)</pre>
                <button class="btn small" type="button" data-copybtn>Copy</button>
              </div>
            </div>

            <div class="callout">
              <div class="label good">Final Answer</div>
              <div class="eq" data-copy>
                <div class="row">
                  <pre>d_eff = d_22 cos^2(θ) cos(3φ)</pre>
                  <button class="btn small" type="button" data-copybtn>Copy</button>
                </div>
              </div>
              <p style="margin:8px 0 0;color:var(--muted)">
                This matches the required result for Type-II <span class="mono">o–e–e</span> mixing in a <span class="mono">3m</span> crystal (such as BBO), under the stated conventions.
              </p>
            </div>

            <h3>3.11 Sanity checks</h3>
            <div class="grid2">
              <div class="callout">
                <div class="label key">Units / dimensions</div>
                <p style="margin:8px 0 0;color:var(--muted)">
                  <span class="mono">cos²θ</span> and <span class="mono">cos 3φ</span> are dimensionless, so <span class="mono">d_eff</span> has the same units as <span class="mono">d_22</span>. ✔
                </p>
              </div>
              <div class="callout">
                <div class="label key">Limiting cases</div>
                <ul style="margin:8px 0 0 22px; color:var(--muted)">
                  <li><span class="mono">θ = 90°</span> ⇒ <span class="mono">cos²θ = 0</span> ⇒ <span class="mono">d_eff = 0</span>. ✔</li>
                  <li><span class="mono">φ → φ + 120°</span> ⇒ <span class="mono">cos 3(φ+120°)=cos(3φ+360°)=cos 3φ</span>. ✔</li>
                </ul>
              </div>
            </div>

            <a class="backtop" href="#top">↑ Back to top</a>
          </section>

          <section id="p4">
            <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

            <h3>4.1 Re-interpret the final formula term by term</h3>
            <ul>
              <li><strong><span class="mono">d_22</span>:</strong> the symmetry-allowed tensor element that actually contributes for this polarization combination (others cancel by geometry and symmetry).</li>
              <li><strong><span class="mono">cos²θ</span>:</strong> comes from the extraordinary polarization’s transverse components scaling like <span class="mono">cosθ</span> in the crystal frame.</li>
              <li><strong><span class="mono">cos 3φ</span>:</strong> directly encodes threefold rotational symmetry about the optic axis.</li>
            </ul>

            <h3>4.2 Parameter dependence</h3>
            <ul>
              <li><span class="mono">|d_eff|</span> decreases as <span class="mono">cos²θ</span> as you tilt away from the optic axis.</li>
              <li>In <span class="mono">φ</span>, the coupling has a 3-lobed pattern: repeats every <span class="mono">120°</span>, zeroes every <span class="mono">60°</span>.</li>
            </ul>

            <h3>4.3 Alternative derivation idea</h3>
            <p>
              Use symmetry to restrict <span class="mono">φ</span>-dependence to <span class="mono">cos 3φ</span>/<span class="mono">sin 3φ</span>, then compute one reference orientation
              to fix the prefactor, and infer the remaining <span class="mono">θ</span>-dependence from the extraordinary polarization geometry.
            </p>

            <h3>4.4 Concept check (with answers)</h3>
            <ul>
              <li><strong>Q:</strong> Why does <span class="mono">d_15</span> disappear in the final result?<br><strong>A:</strong> Its contributions cancel when projecting onto the extraordinary output polarization for the <span class="mono">o–e</span> input pair.</li>
              <li><strong>Q:</strong> Why does the result repeat every <span class="mono">120°</span> in <span class="mono">φ</span>?<br><strong>A:</strong> Threefold symmetry about <span class="mono">z</span> demands invariance under <span class="mono">φ→φ+120°</span>.</li>
              <li><strong>Q:</strong> If you flip <span class="mono">ê_o → −ê_o</span>, what happens?<br><strong>A:</strong> <span class="mono">d_eff</span> flips sign; measurable efficiency (∝<span class="mono">|d_eff|²</span>) does not change.</li>
            </ul>

            <a class="backtop" href="#top">↑ Back to top</a>
          </section>

          <section id="p5">
            <h2>PART 5 — Optional Plot Guide</h2>
            <p>
              A plot is not strictly necessary because the problem is symbolic. But one simple static plot helps visualize the threefold symmetry:
              <span class="mono">d_eff/(d_22 cos²θ) = cos 3φ</span>. The canvas below shows that normalized factor.
            </p>

            <figure>
              <canvas id="plot" width="1100" height="520" aria-label="Plot of cos(3phi) vs phi"></canvas>
              <figcaption>
                Static plot: normalized factor <span class="mono">cos(3φ)</span> (dimensionless) vs <span class="mono">φ</span> in degrees.
              </figcaption>
            </figure>

            <div class="callout" style="margin-top:12px">
              <div class="label note">Plot reading guide</div>
              <ul style="margin:8px 0 0 22px; color:var(--muted)">
                <li><strong>x-axis:</strong> <span class="mono">φ</span> (degrees).</li>
                <li><strong>y-axis:</strong> <span class="mono">cos(3φ)</span> (dimensionless).</li>
                <li><strong>Key feature:</strong> period <span class="mono">120°</span> and zeros every <span class="mono">60°</span>.</li>
              </ul>
            </div>

            <a class="backtop" href="#top">↑ Back to top</a>
          </section>
        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="wrap">
      <p style="margin:0">
        Self-contained learning article (vanilla HTML/CSS/JS). Copy buttons export plain-text equations and results.
      </p>
    </div>
  </footer>

  <script>
    (function(){
      function copyText(txt){
        if(!txt) return;
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(txt).catch(function(){ fallbackCopy(txt); });
        } else { fallbackCopy(txt); }
      }
      function fallbackCopy(txt){
        var ta = document.createElement('textarea');
        ta.value = txt;
        ta.setAttribute('readonly','');
        ta.style.position='fixed';
        ta.style.left='-9999px';
        ta.style.top='-9999px';
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); }catch(e){}
        document.body.removeChild(ta);
      }

      document.querySelectorAll('[data-copy]').forEach(function(box){
        var btn = box.querySelector('[data-copybtn]');
        var pre = box.querySelector('pre');
        if(!btn || !pre) return;
        btn.addEventListener('click', function(){
          copyText(pre.innerText.trim());
          var old = btn.textContent;
          btn.textContent = 'Copied';
          btn.style.borderColor = 'rgba(52,211,153,.35)';
          btn.style.background = 'rgba(52,211,153,.10)';
          window.setTimeout(function(){
            btn.textContent = old;
            btn.style.borderColor = '';
            btn.style.background = '';
          }, 900);
        });
      });

      var canvas = document.getElementById('plot');
      if(!canvas) return;

      if(!CanvasRenderingContext2D.prototype.roundRect){
        CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){
          r = Math.min(r, w/2, h/2);
          this.beginPath();
          this.moveTo(x+r, y);
          this.arcTo(x+w, y, x+w, y+h, r);
          this.arcTo(x+w, y+h, x, y+h, r);
          this.arcTo(x, y+h, x, y, r);
          this.arcTo(x, y, x+w, y, r);
          this.closePath();
          return this;
        };
      }

      function draw(){
        var ctx = canvas.getContext('2d');
        var cssW = canvas.clientWidth || 900;
        var cssH = Math.max(340, Math.round(cssW * 0.46));
        var dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));

        canvas.style.height = cssH + 'px';
        canvas.width = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);

        var w = cssW, h = cssH;

        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = 'rgba(10,14,28,0.35)';
        ctx.fillRect(0,0,w,h);

        var m = {l:64, r:18, t:46, b:54};
        var pw = w - m.l - m.r;
        var ph = h - m.t - m.b;

        var xmin = 0, xmax = 360;
        var ymin = -1.2, ymax = 1.2;

        function X(x){ return m.l + (x - xmin) / (xmax - xmin) * pw; }
        function Y(y){ return m.t + (ymax - y) / (ymax - ymin) * ph; }

        ctx.fillStyle = 'rgba(233,238,252,0.95)';
        ctx.font = '700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'alphabetic';
        ctx.fillText('Normalized angular factor:  d_eff/(d_22 cos²θ) = cos(3φ)', m.l, 26);

        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgba(233,238,252,0.10)';
        ctx.fillStyle = 'rgba(233,238,252,0.70)';
        ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';

        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        for(var xt=0; xt<=360; xt+=60){
          var xx = X(xt);
          ctx.beginPath();
          ctx.moveTo(xx, m.t);
          ctx.lineTo(xx, m.t+ph);
          ctx.stroke();

          ctx.strokeStyle = 'rgba(233,238,252,0.18)';
          ctx.beginPath();
          ctx.moveTo(xx, m.t+ph);
          ctx.lineTo(xx, m.t+ph+6);
          ctx.stroke();
          ctx.strokeStyle = 'rgba(233,238,252,0.10)';
          ctx.fillText(String(xt), xx, m.t+ph+10);
        }

        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        for(var yt=-1.0; yt<=1.0001; yt+=0.5){
          var yy = Y(yt);
          ctx.beginPath();
          ctx.moveTo(m.l, yy);
          ctx.lineTo(m.l+pw, yy);
          ctx.stroke();

          ctx.strokeStyle = 'rgba(233,238,252,0.18)';
          ctx.beginPath();
          ctx.moveTo(m.l-6, yy);
          ctx.lineTo(m.l, yy);
          ctx.stroke();
          ctx.strokeStyle = 'rgba(233,238,252,0.10)';
          ctx.fillText(yt.toFixed(1), m.l-10, yy);
        }

        ctx.strokeStyle = 'rgba(233,238,252,0.35)';
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(m.l, Y(0));
        ctx.lineTo(m.l+pw, Y(0));
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(m.l, m.t);
        ctx.lineTo(m.l, m.t+ph);
        ctx.stroke();

        ctx.fillStyle = 'rgba(233,238,252,0.85)';
        ctx.font = '600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'alphabetic';
        ctx.fillText('φ (degrees)', m.l + pw*0.5, h - 14);

        ctx.save();
        ctx.translate(18, m.t + ph*0.5);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'alphabetic';
        ctx.fillText('cos(3φ)  (dimensionless)', 0, 0);
        ctx.restore();

        ctx.strokeStyle = 'rgba(125,211,252,0.95)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        var first = true;
        for(var x=0; x<=360; x+=1){
          var rad = x * Math.PI / 180;
          var y = Math.cos(3*rad);
          var xx2 = X(x), yy2 = Y(y);
          if(first){ ctx.moveTo(xx2, yy2); first=false; }
          else { ctx.lineTo(xx2, yy2); }
        }
        ctx.stroke();

        var lx = m.l + 12, ly = m.t + 10;
        ctx.fillStyle = 'rgba(255,255,255,0.78)';
        ctx.strokeStyle = 'rgba(233,238,252,0.16)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.roundRect(lx, ly, 220, 34, 10);
        ctx.fill();
        ctx.stroke();

        ctx.strokeStyle = 'rgba(125,211,252,0.95)';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(lx+12, ly+17);
        ctx.lineTo(lx+42, ly+17);
        ctx.stroke();

        ctx.fillStyle = 'rgba(10,14,28,0.88)';
        ctx.font = '700 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText('y = cos(3φ)', lx+52, ly+17);
      }

      draw();
      window.addEventListener('resize', function(){
        clearTimeout(draw._t);
        draw._t = setTimeout(draw, 80);
      }, {passive:true});
    })();
  </script>
</body>
</html>
