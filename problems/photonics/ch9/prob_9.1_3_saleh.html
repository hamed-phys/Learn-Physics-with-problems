<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Planar-Mirror Waveguide (9.1-3) — Field Distribution & Boundary Conditions</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1624;
      --panel2:#101a2b;
      --text:#e9eef7;
      --muted:#a9b5c7;
      --faint:#7f8aa0;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.14);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(125,211,252,.16), transparent 50%),
        radial-gradient(1000px 800px at 90% 20%, rgba(167,139,250,.14), transparent 55%),
        radial-gradient(900px 700px at 60% 110%, rgba(134,239,172,.10), transparent 60%),
        linear-gradient(180deg, #070a11, #0b0f17 40%, #070a11);
      line-height:1.55;
    }
    a{color:var(--accent)}
    header{
      padding:28px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
    }
    .titleCard{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius2);
      padding:18px 18px 16px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .titleCard:before{
      content:"";
      position:absolute; inset:-120px -80px auto auto;
      width:260px; height:260px;
      background:radial-gradient(circle at 30% 30%, rgba(125,211,252,.18), transparent 60%);
      transform:rotate(18deg);
      pointer-events:none;
    }
    h1{
      font-size: clamp(1.35rem, 2.0vw + 1rem, 2.2rem);
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .subtitle{color:var(--muted); margin:0}
    .metaRow{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top:10px;
      color:var(--faint);
      font-size:.95rem;
    }
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:6px 10px;
      border-radius:999px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .pill b{color:var(--text); font-weight:600}
    .tocCard{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius2);
      padding:14px;
      box-shadow:var(--shadow);
      position:relative;
    }
    .tocSticky{
      position:sticky;
      top:12px;
    }
    .tocTitle{
      display:flex; align-items:center; justify-content:space-between;
      margin:0 0 8px;
      font-size:1rem;
      color:var(--muted);
    }
    nav ul{list-style:none; padding:0; margin:0; display:grid; gap:8px}
    nav a{
      text-decoration:none;
      display:block;
      padding:8px 10px;
      border:1px solid transparent;
      border-radius:12px;
      color:var(--text);
      background:rgba(255,255,255,.02);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      font-size:.98rem;
    }
    nav a:hover{
      border-color:rgba(125,211,252,.35);
      background:rgba(125,211,252,.08);
      transform: translateY(-1px);
    }
    main{
      max-width:1200px;
      margin:0 auto;
      padding:10px 18px 60px;
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }
    section{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    section > .secHead{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-end;
      background:rgba(0,0,0,.12);
    }
    .secHead h2{
      margin:0;
      font-size:1.15rem;
      letter-spacing:.2px;
    }
    .secHead .hint{color:var(--muted); font-size:.95rem}
    section .content{
      padding:16px;
    }

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .grid3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px}
    @media (max-width: 980px){
      .grid2,.grid3{grid-template-columns:1fr}
    }

    .callout{
      border:1px solid var(--line2);
      background:rgba(255,255,255,.03);
      border-radius:16px;
      padding:12px 12px 10px;
    }
    .callout h3{
      margin:0 0 6px;
      font-size:1.02rem;
      color:var(--text);
      display:flex; gap:8px; align-items:center;
    }
    .tag{
      font-family:var(--mono);
      font-size:.85rem;
      color:var(--muted);
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      padding:3px 7px;
      border-radius:999px;
    }

    .eqCard{
      border:1px solid rgba(125,211,252,.25);
      background:linear-gradient(180deg, rgba(125,211,252,.10), rgba(255,255,255,.02));
      border-radius:16px;
      padding:12px;
      overflow:auto;
      position:relative;
    }
    .eq{
      font-family:var(--mono);
      font-size:.98rem;
      white-space:nowrap;
      display:block;
    }
    .copyBtn{
      position:absolute;
      top:10px;
      right:10px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      padding:7px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:.9rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .copyBtn:hover{transform: translateY(-1px); border-color:rgba(125,211,252,.35); background:rgba(125,211,252,.10)}
    .copyBtn:active{transform: translateY(0px)}
    .copyNote{
      position:absolute;
      top:10px;
      right:110px;
      color:var(--muted);
      font-size:.9rem;
      opacity:0;
      transform: translateY(-4px);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
    }
    .copyNote.show{opacity:1; transform: translateY(0px)}
    ul{margin:8px 0 0 18px}
    li{margin:6px 0}
    .muted{color:var(--muted)}
    .small{font-size:.94rem; color:var(--muted)}
    .kicker{color:var(--accent); font-weight:650; letter-spacing:.2px}
    .divider{height:1px; background:var(--line); margin:12px 0}
    figure{
      margin:0;
      padding:12px;
      border-top:1px solid var(--line);
      background:rgba(0,0,0,.10);
    }
    .vizWrap{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .vizWrap{grid-template-columns:1fr}
    }
    .canvasCard{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background:rgba(255,255,255,.02);
    }
    .canvasHead{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      background:rgba(0,0,0,.10);
    }
    .canvasHead .title{
      font-weight:650;
      color:var(--text);
      font-size:.98rem;
    }
    .canvasHead .legend{
      font-family:var(--mono);
      font-size:.82rem;
      color:var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      text-align:right;
    }
    canvas{display:block; width:100%; height:320px}
    .controls{
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .controls{grid-template-columns:1fr} }
    .ctrl{
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      border-radius:16px;
      padding:10px 10px 8px;
    }
    .ctrl label{
      display:flex;
      justify-content:space-between;
      gap:10px;
      color:var(--muted);
      font-size:.9rem;
      margin-bottom:6px;
    }
    .ctrl .val{
      font-family:var(--mono);
      color:var(--text);
    }
    input[type="range"]{
      width:100%;
      accent-color: var(--accent);
    }
    select{
      width:100%;
      padding:9px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
    }
    .noteBox{
      border-left:3px solid rgba(125,211,252,.55);
      padding:10px 12px;
      background:rgba(125,211,252,.06);
      border-radius:14px;
      color:var(--muted);
    }
    .finalBox{
      border:1px solid rgba(134,239,172,.35);
      background:linear-gradient(180deg, rgba(134,239,172,.12), rgba(255,255,255,.02));
      border-radius:18px;
      padding:12px;
      position:relative;
      overflow:auto;
    }
    .finalBox .eq{white-space:normal}
    footer{
      max-width:1200px;
      margin:0 auto;
      padding:18px 18px 30px;
      color:var(--muted);
      text-align:center;
    }

    /* subtle entrance */
    .fadeIn{animation: fade .5s ease both}
    @keyframes fade{from{opacity:0; transform: translateY(6px)} to{opacity:1; transform:none}}

    /* print-friendly */
    @media print{
      body{background:#fff; color:#000}
      section, .titleCard, .tocCard{box-shadow:none}
      .tocCard{display:none}
      .copyBtn, .controls{display:none !important}
      canvas{height:260px}
      .eqCard, .finalBox, .callout{border-color:#999}
      a{color:#000; text-decoration:underline}
    }
  </style>
</head>
<body>
<header class="fadeIn">
  <div class="hero">
    <div class="titleCard">
      <div class="kicker">Photonics / Waveguides</div>
      <h1>9.1-3 — Field Distribution in a Planar-Mirror Waveguide</h1>
      <p class="subtitle">Why a single plane wave can’t satisfy mirror boundary conditions, and what the correct two-wave superposition must look like.</p>
      <div class="metaRow">
        <span class="pill"><b>Geometry</b> two perfect mirrors at <span class="muted">y = ±d/2</span></span>
        <span class="pill"><b>Field</b> TEM-like <span class="muted">E<sub>x</sub>(y,z)</span></span>
        <span class="pill"><b>Goal</b> enforce <span class="muted">E<sub>x</sub>(±d/2,z)=0</span></span>
      </div>
    </div>

    <div class="tocCard tocSticky">
      <div class="tocTitle">
        <span>Mini Table of Contents</span>
        <span class="tag">scroll</span>
      </div>
      <nav aria-label="Table of contents">
        <ul>
          <li><a href="#quick">Quick Summary</a></li>
          <li><a href="#part0">PART 0 — Concept Primer</a></li>
          <li><a href="#part1">PART 1 — Problem Analysis</a></li>
          <li><a href="#part2">PART 2 — Strategy & Tips</a></li>
          <li><a href="#part3">PART 3 — Full Solution</a></li>
          <li><a href="#part4">PART 4 — Deeper Understanding</a></li>
          <li><a href="#part5">PART 5 — Visualization Guide</a></li>
          <li><a href="#viz">Interactive Visualizations</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<main class="fadeIn">
  <!-- Quick Summary -->
  <section id="quick">
    <div class="secHead">
      <h2>Quick Summary</h2>
      <div class="hint">What you’ll learn & the result type</div>
    </div>
    <div class="content">
      <ul>
        <li><b>Topic:</b> Field distributions in a <b>planar-mirror waveguide</b> (two parallel perfect mirrors separated by distance <span class="eq">d</span>).</li>
        <li><b>Key idea:</b> Perfect-conductor mirror walls force the <b>tangential electric field to vanish</b> at the surfaces: <span class="eq">E<sub>x</sub>(±d/2, z)=0</span>.</li>
        <li><b>Governing form:</b> Plane-wave dependence in <span class="eq">y</span> and <span class="eq">z</span>: <span class="eq">E<sub>x</sub>(y,z) ∝ e<sup>-j k<sub>y</sub> y</sup> e<sup>-j β z</sup></span>.</li>
        <li><b>Result (a):</b> A <b>single</b> plane wave cannot satisfy both boundary conditions for all <span class="eq">z</span> unless the field is trivial (<span class="eq">A=0</span>).</li>
        <li><b>Result (b):</b> Two counter-propagating transverse plane waves can satisfy the mirrors only if their <b>relative phase (amplitudes) matches the mode parity</b>.</li>
        <li><b>Quantization:</b> Enforcing both walls yields <span class="eq">k<sub>y</sub> = mπ/d</span> and a <b>required ratio</b> <span class="eq">A<sub>2</sub>/A<sub>1</sub> = -(-1)<sup>m</sup></span>.</li>
        <li><b>Final result type:</b> <b>Symbolic</b> proofs + a clean closed-form mode shape (standing wave across <span class="eq">y</span>).</li>
      </ul>
    </div>
  </section>

  <!-- PART 0 -->
  <section id="part0">
    <div class="secHead">
      <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>
      <div class="hint">Mini textbook section</div>
    </div>
    <div class="content">
      <div class="grid2">
        <div class="callout">
          <h3>Core definitions <span class="tag">symbols & units</span></h3>
          <ul>
            <li><span class="eq">y</span> — transverse coordinate (m)</li>
            <li><span class="eq">z</span> — propagation coordinate along the guide (m)</li>
            <li><span class="eq">d</span> — mirror separation (m)</li>
            <li><span class="eq">k<sub>0</sub> = 2π/λ</span> — free-space wavenumber (rad/m)</li>
            <li><span class="eq">k<sub>y</sub></span> — transverse wavenumber component (rad/m)</li>
            <li><span class="eq">β</span> — longitudinal propagation constant (rad/m)</li>
            <li><span class="eq">j</span> — imaginary unit, <span class="eq">j²=-1</span></li>
          </ul>
        </div>

        <div class="callout">
          <h3>Physical meaning <span class="tag">what it represents</span></h3>
          <ul>
            <li><span class="eq">e<sup>-jβz</sup></span> means a wave that accumulates <b>phase</b> as it travels along <span class="eq">z</span>.</li>
            <li><span class="eq">e<sup>-jk<sub>y</sub>y</sup></span> means a wave whose phase varies across the gap; combining <b>±k<sub>y</sub></b> gives a <b>standing wave</b> in <span class="eq">y</span>.</li>
            <li><span class="eq">E<sub>x</sub>(±d/2,z)=0</span> encodes “the mirror kills tangential E at the surface.” This is the main constraint.</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="callout">
          <h3>Key laws & validity <span class="tag">assumptions</span></h3>
          <ul>
            <li><b>Perfect conductor boundary condition:</b> <span class="eq">E<sub>t</sub>=0</span> at the surface (valid if mirror is an ideal PEC).</li>
            <li><b>Harmonic time dependence:</b> fields vary as <span class="eq">e<sup>jωt</sup></span> (phasor form). We suppress time to work with spatial phasors.</li>
            <li><b>Homogeneous region between mirrors:</b> dispersion relation <span class="eq">k<sub>0</sub>² = k<sub>y</sub>² + β²</span> for plane-wave components.</li>
          </ul>
          <div class="noteBox small">
            In real optics, mirrors aren’t perfect; this ideal model is used mainly to build intuition for dielectric guides and resonators.
          </div>
        </div>

        <div class="callout">
          <h3>Common models we use <span class="tag">why</span></h3>
          <ul>
            <li><b>Plane-wave decomposition:</b> any field pattern can be built from plane waves; mirrors couple transverse components into standing waves.</li>
            <li><b>Modal picture:</b> the guide supports discrete transverse field shapes (“modes”) determined by boundary conditions.</li>
            <li><b>Ray ↔ wave link:</b> <span class="eq">k<sub>y</sub>=k<sub>0</sub>sinθ</span>, <span class="eq">β=k<sub>0</sub>cosθ</span>. Quantization of <span class="eq">k<sub>y</sub></span> corresponds to discrete bounce angles.</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="callout">
          <h3>Mini intuition examples <span class="tag">quick</span></h3>
          <ul>
            <li><b>One wall:</b> If you had only a single mirror at, say, <span class="eq">y=0</span>, you could cancel the field at that wall by adding a reflected wave. With <b>two</b> walls, you must cancel at <b>both</b> simultaneously.</li>
            <li><b>Standing waves:</b> A vibrating string fixed at both ends must be a standing wave with nodes at the ends. Here, <span class="eq">E<sub>x</sub></span> plays the role of the string displacement and the mirrors are the fixed ends.</li>
          </ul>
        </div>

        <div class="callout">
          <h3>What to watch for <span class="tag">pitfalls</span></h3>
          <ul>
            <li>Forgetting that the boundary condition must hold for <b>all</b> <span class="eq">z</span> (not just one plane).</li>
            <li>Assuming <span class="eq">A<sub>1</sub>=±A<sub>2</sub></span> always works—actually the correct sign depends on <b>mode index parity</b>.</li>
            <li>Mixing up “zero at <span class="eq">y=±d/2</span>” with “sine about <span class="eq">y=0</span>.” The node positions matter.</li>
            <li>Ignoring the dispersion constraint <span class="eq">β² = k<sub>0</sub>² - k<sub>y</sub>²</span> (propagation requires <span class="eq">k<sub>y</sub> ≤ k<sub>0</sub></span>).</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- PART 1 -->
  <section id="part1">
    <div class="secHead">
      <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>
      <div class="hint">Restate, identify laws, plan approaches</div>
    </div>
    <div class="content">
      <article class="callout">
        <h3>Problem restatement <span class="tag">in my words</span></h3>
        <p class="muted" style="margin:0">
          We have two perfect mirrors parallel to the <span class="eq">x–z</span> plane at positions <span class="eq">y=±d/2</span>.
          A field component <span class="eq">E<sub>x</sub>(y,z)</span> is proposed in plane-wave form.
          <br><br>
          (a) Show a single plane wave <span class="eq">E<sub>x</sub>=A e^{-j k_y y} e^{-j β z}</span> cannot satisfy <span class="eq">E<sub>x</sub>(±d/2,z)=0</span> for all <span class="eq">z</span>.
          <br>
          (b) Consider two waves with <span class="eq">β<sub>1</sub>=β<sub>2</sub></span> and <span class="eq">k_{y1}=-k_{y2}=mπ/d</span>.
          Show that merely choosing <span class="eq">A<sub>1</sub>=±A<sub>2</sub></span> does <b>not</b> generally satisfy the boundary conditions (it only works for the right parity).
        </p>
      </article>

      <div class="grid2" style="margin-top:12px">
        <div class="callout">
          <h3>Given quantities</h3>
          <ul>
            <li>Mirror locations: <span class="eq">y=±d/2</span></li>
            <li>Candidate fields: single wave and two-wave sum</li>
            <li>In (b): <span class="eq">β<sub>1</sub>=β<sub>2</sub></span>, <span class="eq">k_{y1}=-k_{y2}=mπ/d</span>, <span class="eq">m=1,2,…</span></li>
          </ul>
        </div>
        <div class="callout">
          <h3>Unknowns / must be proved</h3>
          <ul>
            <li>(a) Prove impossibility except trivial field (<span class="eq">A=0</span>).</li>
            <li>(b) Prove that <span class="eq">A<sub>1</sub>=+A<sub>2</sub></span> or <span class="eq">A<sub>1</sub>=-A<sub>2</sub></span> does not satisfy both walls for <b>all</b> <span class="eq">m</span>.</li>
            <li>Find the <b>correct amplitude relation</b> that actually enforces the walls.</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="callout">
          <h3>Relevant principles & why they apply</h3>
          <ul>
            <li><b>PEC boundary condition:</b> mirrors are ideal conductors ⇒ tangential <span class="eq">E</span> at the surface must be zero.</li>
            <li><b>Superposition:</b> Maxwell’s equations are linear in this setting ⇒ sums of solutions are solutions.</li>
            <li><b>Plane-wave phase factors:</b> the <span class="eq">z</span>-factor <span class="eq">e^{-jβz}</span> never becomes zero for all <span class="eq">z</span>, so zeros must come from transverse dependence or amplitude choices.</li>
          </ul>
        </div>
        <div class="callout">
          <h3>Assumptions stated explicitly</h3>
          <ul>
            <li>Perfect mirrors (ideal PEC): no penetration, no loss.</li>
            <li>Single-frequency steady-state fields (phasor form).</li>
            <li>Uniform medium between mirrors (constant <span class="eq">k<sub>0</sub></span>).</li>
            <li>We treat <span class="eq">E<sub>x</sub></span> as the tangential component on the mirror surfaces (appropriate for walls parallel to <span class="eq">x–z</span>).</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid3">
        <div class="callout">
          <h3>Approach 1: Direct boundary substitution</h3>
          <p class="muted" style="margin:0">Plug <span class="eq">y=±d/2</span> into the proposed field and enforce zeros. Fast and clean for (a) and (b).</p>
        </div>
        <div class="callout">
          <h3>Approach 2: Standing-wave / mode-shape viewpoint</h3>
          <p class="muted" style="margin:0">Recognize fixed-end condition ⇒ field must be sinusoidal with nodes at both mirrors, like a string. Great for interpretation.</p>
        </div>
        <div class="callout">
          <h3>Approach 3: Reflection phase (ray/wave) argument</h3>
          <p class="muted" style="margin:0">Track round-trip phase between mirrors; demand self-consistency ⇒ quantization. Very intuitive, but less algebraic.</p>
        </div>
      </div>

      <div class="noteBox" style="margin-top:12px">
        <b>Chosen approach:</b> Use <b>Approach 1</b> (direct boundary substitution) to prove (a) and (b) rigorously, then interpret the result with the standing-wave picture (Approach 2).
      </div>
    </div>
  </section>

  <!-- PART 2 -->
  <section id="part2">
    <div class="secHead">
      <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>
      <div class="hint">Steps before the algebra</div>
    </div>
    <div class="content">
      <ol style="margin:0 0 0 18px">
        <li><b>Write the boundary condition:</b> <span class="eq">E<sub>x</sub>(±d/2,z)=0</span>. <span class="muted">Meaning: tangential E must vanish at both mirrors.</span></li>
        <li><b>Part (a):</b> Substitute <span class="eq">y=+d/2</span> into <span class="eq">A e^{-jk_y y} e^{-jβz}</span>. <span class="muted">Goal: see what can be zero for all z.</span></li>
        <li><b>Use the key fact:</b> <span class="eq">e^{-jβz}≠0</span> for any real/complex β and finite z. <span class="muted">So any enforced zero must come from A or transverse factor, not z.</span></li>
        <li><b>Part (b):</b> Form <span class="eq">E<sub>x</sub>=e^{-jβz}(A<sub>1</sub>e^{-jk_y y}+A<sub>2</sub>e^{+jk_y y})</span> using <span class="eq">k_{y1}=-k_{y2}=k_y</span>.</li>
        <li><b>Apply the two boundary equations</b> at <span class="eq">y=±d/2</span> to obtain two linear equations for <span class="eq">A<sub>1</sub>,A<sub>2</sub></span>.</li>
        <li><b>Solve for the amplitude ratio</b> <span class="eq">A<sub>2</sub>/A<sub>1</sub></span> and the allowed <span class="eq">k_y</span>. <span class="muted">Physical meaning: which standing wave fits between walls.</span></li>
        <li><b>Check the special choices</b> <span class="eq">A<sub>1</sub>=±A<sub>2</sub></span> and see when (if ever) they satisfy the derived ratio. <span class="muted">This exposes the parity condition.</span></li>
        <li><b>Sanity checks:</b> node positions at the mirrors, and (optionally) dispersion <span class="eq">β²=k<sub>0</sub>²-k_y²</span>.</li>
      </ol>

      <div class="grid2" style="margin-top:12px">
        <div class="callout">
          <h3>Common mistakes</h3>
          <ul>
            <li>Setting the field to zero at one wall and forgetting the other wall.</li>
            <li>Assuming “cosine modes” or “sine modes” about <span class="eq">y=0</span> always match the boundaries—node placement matters.</li>
            <li>For (b), treating <span class="eq">A<sub>1</sub>=±A<sub>2</sub></span> as a general solution instead of a special case.</li>
          </ul>
        </div>
        <div class="callout">
          <h3>Quick tips</h3>
          <ul>
            <li>Factor out <span class="eq">e^{-jβz}</span> immediately; it cannot enforce boundary zeros.</li>
            <li>Use symmetry carefully: walls are at <span class="eq">±d/2</span>, so a convenient “string-like” mode is <span class="eq">sin(k_y(y+d/2))</span>.</li>
            <li>When in doubt, solve the two boundary equations as a 2×2 linear system.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- PART 3 -->
  <section id="part3">
    <div class="secHead">
      <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>
      <div class="hint">Step-by-step derivation</div>
    </div>
    <div class="content">
      <div class="callout">
        <h3>Physical intuition before math <span class="tag">expectation</span></h3>
        <p class="muted" style="margin:0">
          Two perfect mirrors act like two fixed ends. A traveling wave in <span class="eq">y</span> alone can’t vanish at two distinct points
          unless it’s identically zero. To get nodes at both walls, you need a <b>standing wave</b> across the gap, built from a superposition of
          <b>two</b> transverse plane waves (one with <span class="eq">+k_y</span>, one with <span class="eq">-k_y</span>).
        </p>
      </div>

      <div class="divider"></div>

      <!-- Key equation card -->
      <div class="eqCard" style="margin-bottom:12px">
        <div class="copyNote" id="noteEq0">Copied!</div>
        <button class="copyBtn" data-copy="BC: Ex(+d/2,z)=0 and Ex(-d/2,z)=0 (for all z).">Copy</button>
        <span class="eq"><b>Boundary condition (PEC mirrors):</b>  E<sub>x</sub>(+d/2, z) = 0  and  E<sub>x</sub>(-d/2, z) = 0  for all z.</span>
      </div>

      <article class="callout">
        <h3>(a) Single plane wave cannot satisfy both boundaries</h3>
        <p class="muted" style="margin:0 0 10px">
          Proposed field:
        </p>
        <div class="eqCard">
          <div class="copyNote" id="noteEqA">Copied!</div>
          <button class="copyBtn" data-copy="Ex(y,z)=A exp(-j ky y) exp(-j β z).">Copy</button>
          <span class="eq">E<sub>x</sub>(y,z) = A · exp(−j k<sub>y</sub> y) · exp(−j β z)</span>
        </div>

        <p class="muted" style="margin:10px 0 6px">
          Apply the boundary at <span class="eq">y=+d/2</span>:
        </p>

        <div class="eqCard">
          <button class="copyBtn" data-copy="0=Ex(d/2,z)=A exp(-j ky d/2) exp(-j β z) ⇒ A=0.">Copy</button>
          <span class="eq">0 = E<sub>x</sub>(d/2,z) = A · exp(−j k<sub>y</sub> d/2) · exp(−j β z)</span>
        </div>

        <p class="muted" style="margin:10px 0 0">
          Now notice: for any finite <span class="eq">z</span>, the factor <span class="eq">exp(−jβz)</span> is never identically zero.
          Also <span class="eq">exp(−j k<sub>y</sub> d/2)</span> is never zero for any finite complex number in the exponent (the exponential function has no zeros).
          Therefore the only way the product can be zero for all <span class="eq">z</span> is
          <b>the trivial amplitude</b>:
        </p>

        <div class="finalBox" style="margin-top:10px">
          <div class="copyNote" id="noteFinalA">Copied!</div>
          <button class="copyBtn" data-copy="Part (a) result: A must be 0 (trivial field). A single plane wave cannot satisfy Ex(±d/2,z)=0 for all z.">Copy</button>
          <span class="eq"><b>Conclusion (a):</b> A must be 0 ⇒ the only single-plane-wave solution satisfying both mirrors is the trivial field.</span>
        </div>

        <p class="muted" style="margin:10px 0 0">
          <b>Why this is decisive:</b> If you can’t even satisfy one wall nontrivially, you certainly can’t satisfy both.
          The presence of two walls forces a standing-wave pattern in <span class="eq">y</span>.
        </p>
      </article>

      <div class="divider"></div>

      <article class="callout">
        <h3>(b) Two plane waves: why “just ±” amplitudes is not generally enough</h3>

        <p class="muted" style="margin:0 0 10px">
          Start from the given two-wave form and impose the specific constraints:
          <span class="eq">β<sub>1</sub>=β<sub>2</sub>=β</span> and <span class="eq">k<sub>y1</sub>=−k<sub>y2</sub>=k<sub>y</sub></span>,
          where later we will enforce <span class="eq">k<sub>y</sub>=mπ/d</span>.
        </p>

        <div class="eqCard">
          <div class="copyNote" id="noteEqB0">Copied!</div>
          <button class="copyBtn" data-copy="Ex(y,z)=A1 exp(-j ky y) exp(-j β z) + A2 exp(+j ky y) exp(-j β z)=exp(-jβz)(A1 e^{-jkyy}+A2 e^{+jkyy}).">Copy</button>
          <span class="eq">E<sub>x</sub>(y,z) = A<sub>1</sub>e^{−jk<sub>y</sub>y}e^{−jβz} + A<sub>2</sub>e^{+jk<sub>y</sub>y}e^{−jβz}</span>
          <span class="eq">= e^{−jβz}\Big(A<sub>1</sub>e^{−jk<sub>y</sub>y}+A<sub>2</sub>e^{+jk<sub>y</sub>y}\Big)</span>
        </div>

        <p class="muted" style="margin:10px 0 0">
          Since <span class="eq">e^{−jβz}</span> cannot be zero, the boundary conditions reduce to the bracketed transverse factor being zero at both walls.
        </p>

        <p class="muted" style="margin:10px 0 6px"><b>Apply the boundary at</b> <span class="eq">y=+d/2</span>:</p>
        <div class="eqCard">
          <button class="copyBtn" data-copy="At y=+d/2: A1 e^{-j ky d/2} + A2 e^{+j ky d/2}=0.">Copy</button>
          <span class="eq">A<sub>1</sub>e^{−jk<sub>y</sub>d/2} + A<sub>2</sub>e^{+jk<sub>y</sub>d/2} = 0</span>
        </div>

        <p class="muted" style="margin:10px 0 6px"><b>Apply the boundary at</b> <span class="eq">y=−d/2</span>:</p>
        <div class="eqCard">
          <button class="copyBtn" data-copy="At y=-d/2: A1 e^{+j ky d/2} + A2 e^{-j ky d/2}=0.">Copy</button>
          <span class="eq">A<sub>1</sub>e^{+jk<sub>y</sub>d/2} + A<sub>2</sub>e^{−jk<sub>y</sub>d/2} = 0</span>
        </div>

        <p class="muted" style="margin:10px 0 6px">
          These are two linear equations for <span class="eq">A<sub>1</sub>,A<sub>2</sub></span>. Solve the first for the ratio:
        </p>

        <div class="eqCard">
          <button class="copyBtn" data-copy="From y=+d/2: A2/A1 = - exp(-j ky d).">Copy</button>
          <span class="eq">A<sub>2</sub>e^{+jk<sub>y</sub>d/2} = −A<sub>1</sub>e^{−jk<sub>y</sub>d/2}</span>
          <span class="eq">⇒  A<sub>2</sub>/A<sub>1</sub> = −e^{−jk<sub>y</sub>d}</span>
        </div>

        <p class="muted" style="margin:10px 0 6px">
          Now impose that the second boundary equation gives the <b>same</b> ratio. From <span class="eq">y=−d/2</span>:
        </p>

        <div class="eqCard">
          <button class="copyBtn" data-copy="From y=-d/2: A2/A1 = - exp(+j ky d). Consistency requires exp(+j ky d)=exp(-j ky d) ⇒ sin(ky d)=0 ⇒ ky=mπ/d.">Copy</button>
          <span class="eq">A<sub>2</sub>e^{−jk<sub>y</sub>d/2} = −A<sub>1</sub>e^{+jk<sub>y</sub>d/2}</span>
          <span class="eq">⇒  A<sub>2</sub>/A<sub>1</sub> = −e^{+jk<sub>y</sub>d}</span>
        </div>

        <p class="muted" style="margin:10px 0 0">
          For a nontrivial solution (<span class="eq">A<sub>1</sub>≠0</span>), both ratios must match:
        </p>

        <div class="eqCard">
          <button class="copyBtn" data-copy="-e^{-j ky d} = -e^{+j ky d} ⇒ e^{+j ky d}=e^{-j ky d} ⇒ sin(ky d)=0 ⇒ ky d = mπ ⇒ ky=mπ/d.">Copy</button>
          <span class="eq">−e^{−jk<sub>y</sub>d} = −e^{+jk<sub>y</sub>d}</span>
          <span class="eq">⇒ e^{+jk<sub>y</sub>d} = e^{−jk<sub>y</sub>d}</span>
          <span class="eq">⇒ e^{2jk<sub>y</sub>d} = 1</span>
          <span class="eq">⇒ 2k<sub>y</sub>d = 2mπ  ⇒  k<sub>y</sub>d = mπ  ⇒  <b>k<sub>y</sub> = mπ/d</b></span>
        </div>

        <p class="muted" style="margin:10px 0 6px">
          Good — this recovers the given quantization <span class="eq">k<sub>y</sub>=mπ/d</span>.
          Now plug this back into the ratio:
        </p>

        <div class="eqCard">
          <button class="copyBtn" data-copy="With ky=mπ/d: A2/A1 = -exp(-j mπ)= -(-1)^m. So A2=+A1 for odd m, and A2=-A1 for even m.">Copy</button>
          <span class="eq">A<sub>2</sub>/A<sub>1</sub> = −e^{−jk<sub>y</sub>d} = −e^{−jmπ} = −(−1)<sup>m</sup></span>
          <span class="eq">⇒ <b>A<sub>2</sub> = −(−1)<sup>m</sup> A<sub>1</sub></b></span>
          <span class="eq">⇒ If m is odd: (−1)<sup>m</sup>=−1 ⇒ A<sub>2</sub>=+A<sub>1</sub></span>
          <span class="eq">⇒ If m is even: (−1)<sup>m</sup>=+1 ⇒ A<sub>2</sub>=−A<sub>1</sub></span>
        </div>

        <div class="finalBox" style="margin-top:10px">
          <div class="copyNote" id="noteFinalB">Copied!</div>
          <button class="copyBtn" data-copy="Part (b) result: ky=mπ/d and A2/A1 = -(-1)^m. Therefore A1=+A2 works only for odd m, and A1=-A2 works only for even m (not for all m).">Copy</button>
          <span class="eq"><b>Conclusion (b):</b> The boundary conditions require <b>both</b> <span class="eq">k<sub>y</sub>=mπ/d</span> and <span class="eq">A<sub>2</sub>/A<sub>1</sub>=-(-1)<sup>m</sup></span>.</span>
          <span class="eq">So the special choices <span class="eq">A<sub>1</sub>=±A<sub>2</sub></span> do <b>not</b> work for all m: “+” works only for odd m, “−” works only for even m.</span>
        </div>

        <div class="divider"></div>

        <p class="muted" style="margin:0 0 6px">
          <b>Mode shape (nice closed form):</b> Using the correct ratio produces a standing wave with nodes at both mirrors:
        </p>
        <div class="eqCard">
          <button class="copyBtn" data-copy="A convenient mode form: Ex(y,z)=E0 sin[ky (y+d/2)] exp(-jβz), with ky=mπ/d. This gives Ex(-d/2)=0 and Ex(+d/2)=0.">Copy</button>
          <span class="eq">E<sub>x</sub>(y,z) = E<sub>0</sub> · sin( k<sub>y</sub>(y + d/2) ) · e^{−jβz},  &nbsp; k<sub>y</sub>=mπ/d</span>
          <span class="eq">Check: at y=−d/2 ⇒ sin(0)=0; at y=+d/2 ⇒ sin(k<sub>y</sub>d)=sin(mπ)=0.</span>
        </div>

        <div class="callout" style="margin-top:12px">
          <h3>Sanity checks <span class="tag">quick</span></h3>
          <ul>
            <li><b>Dimensions:</b> <span class="eq">k<sub>y</sub></span> has units rad/m; <span class="eq">mπ/d</span> also rad/m ✓</li>
            <li><b>Nodes:</b> <span class="eq">sin(k<sub>y</sub>(y+d/2))</span> is exactly zero at both mirrors ✓</li>
            <li><b>Limiting behavior:</b> Larger <span class="eq">d</span> ⇒ smaller spacing of allowed <span class="eq">k<sub>y</sub></span> (more modes fit) ✓</li>
            <li><b>Propagation condition (optional physics):</b> If the region is uniform with wavenumber <span class="eq">k<sub>0</sub></span>, then <span class="eq">β²=k<sub>0</sub>²-k<sub>y</sub>²</span>. If <span class="eq">k<sub>y</sub>&gt;k<sub>0</sub></span>, β becomes imaginary ⇒ no propagating power along z (evanescent) ✓</li>
          </ul>
        </div>
      </article>
    </div>
  </section>

  <!-- PART 4 -->
  <section id="part4">
    <div class="secHead">
      <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>
      <div class="hint">Interpretation, parameter effects, self-test</div>
    </div>
    <div class="content">
      <div class="grid2">
        <div class="callout">
          <h3>Re-interpreting the key formulas</h3>
          <ul>
            <li><span class="eq">k<sub>y</sub>=mπ/d</span> is a <b>transverse resonance condition</b>: exactly an integer number of half-wavelengths (in the transverse standing wave) fits between the mirrors.</li>
            <li><span class="eq">A<sub>2</sub>/A<sub>1</sub> = -(-1)<sup>m</sup></span> sets the <b>phase symmetry</b> about the midplane <span class="eq">y=0</span>:
              <ul>
                <li><b>odd m:</b> <span class="eq">A<sub>2</sub>=A<sub>1</sub></span> ⇒ cosine-like about <span class="eq">y=0</span></li>
                <li><b>even m:</b> <span class="eq">A<sub>2</sub>=-A<sub>1</sub></span> ⇒ sine-like about <span class="eq">y=0</span></li>
              </ul>
              Both are just different ways to represent the same “nodes at the walls” condition.
            </li>
          </ul>
        </div>

        <div class="callout">
          <h3>How changing parameters affects the outcome</h3>
          <ul>
            <li><b>Increase d:</b> allowed <span class="eq">k<sub>y</sub></span> values get smaller for fixed m ⇒ more modes are below cutoff (if you also consider <span class="eq">k<sub>0</sub></span>).</li>
            <li><b>Increase m:</b> transverse oscillations increase (more nodes inside). Also <span class="eq">k<sub>y</sub></span> grows, pushing <span class="eq">β</span> down via <span class="eq">β²=k<sub>0</sub>²-k<sub>y</sub>²</span>.</li>
            <li><b>Pick wrong sign (A<sub>2</sub>=±A<sub>1</sub>):</b> you miss a wall node unless the mode parity matches. The main plot in this page shows the boundary “error.”</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <div class="callout">
        <h3>Alternative derivation idea <span class="tag">brief</span></h3>
        <p class="muted" style="margin:0">
          A ray bouncing between mirrors picks up a round-trip transverse phase of <span class="eq">2k<sub>y</sub>d</span>.
          For the field to reproduce itself after one round-trip, that phase must be <span class="eq">2mπ</span>, giving <span class="eq">k<sub>y</sub>d=mπ</span>.
          The required relative phase between “up-going” and “down-going” transverse components corresponds to the amplitude ratio <span class="eq">A<sub>2</sub>/A<sub>1</sub>=-(-1)<sup>m</sup></span>.
        </p>
      </div>

      <div class="divider"></div>

      <div class="callout">
        <h3>Concept checks (with answers)</h3>
        <ul>
          <li><b>Q:</b> Why can’t <span class="eq">e^{-jβz}</span> help enforce <span class="eq">E=0</span> at a boundary for all z?
            <br><b>A:</b> Exponentials never become identically zero; they only change phase/magnitude.</li>
          <li><b>Q:</b> What physical structure does the transverse field resemble?
            <br><b>A:</b> A standing wave like a string fixed at both ends (nodes at mirrors).</li>
          <li><b>Q:</b> For which m does <span class="eq">A<sub>1</sub>=A<sub>2</sub></span> satisfy the walls (given <span class="eq">k<sub>y</sub>=mπ/d</span>)?
            <br><b>A:</b> Only odd m, because then the needed ratio is +1.</li>
          <li><b>Q:</b> If <span class="eq">k<sub>y</sub>&gt;k<sub>0</sub></span>, what happens to propagation along z?
            <br><b>A:</b> <span class="eq">β</span> becomes imaginary ⇒ no propagating mode (evanescent decay along z).</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- PART 5 -->
  <section id="part5">
    <div class="secHead">
      <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>
      <div class="hint">What each canvas shows</div>
    </div>
    <div class="content">
      <div class="grid2">
        <div class="callout">
          <h3>Canvas A: Geometry diagram</h3>
          <ul>
            <li>Two horizontal lines are the mirrors at <span class="eq">y=±d/2</span>.</li>
            <li>A zig-zag ray illustrates the ray picture; the angle is linked to <span class="eq">k<sub>y</sub>/k<sub>0</sub> = sinθ</span> (when propagating).</li>
            <li>The diagram updates when you change <span class="eq">d</span> or <span class="eq">m</span> (via <span class="eq">k<sub>y</sub>=mπ/d</span>).</li>
          </ul>
        </div>
        <div class="callout">
          <h3>Canvas B: Main plot — Boundary error vs mode index</h3>
          <ul>
            <li>Plots a <b>boundary residual</b> (dimensionless) for different field guesses:
              <ul>
                <li>Single plane wave: never satisfies walls (residual stays high).</li>
                <li>Two-wave with <span class="eq">A<sub>2</sub>=+A<sub>1</sub></span> (cos-like): only odd m hits zero.</li>
                <li>Two-wave with <span class="eq">A<sub>2</sub>=-A<sub>1</sub></span> (sin-like): only even m hits zero.</li>
                <li>Correct ratio <span class="eq">A<sub>2</sub>/A<sub>1</sub>=-(-1)<sup>m</sup></span>: residual is zero for all m.</li>
              </ul>
            </li>
            <li>This plot directly visualizes what part (b) is asking you to notice.</li>
          </ul>
        </div>
      </div>

      <div class="grid2" style="margin-top:12px">
        <div class="callout">
          <h3>Canvas C: Secondary plot — Dispersion β vs mode index</h3>
          <ul>
            <li>Uses example wavelength (for plotting): <span class="eq">λ = 633 nm</span> so <span class="eq">k<sub>0</sub>=2π/λ</span>.</li>
            <li>Computes <span class="eq">β = sqrt(max(0, k<sub>0</sub>² - k<sub>y</sub>²))</span> for each m (propagating part).</li>
            <li>Shows how increasing m (or decreasing d) pushes the mode toward cutoff.</li>
          </ul>
        </div>
        <div class="callout">
          <h3>Interactive controls</h3>
          <ul>
            <li><b>d slider:</b> changes mirror separation, hence changes <span class="eq">k<sub>y</sub>=mπ/d</span>.</li>
            <li><b>m selector:</b> chooses a highlighted mode index for the diagram and dispersion marker.</li>
            <li><b>Amplitude sign selector:</b> toggles “naive” choice <span class="eq">A<sub>2</sub>=±A<sub>1</sub></span> so you can see why it fails except for the matching parity.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Visualizations -->
  <section id="viz">
    <div class="secHead">
      <h2>Interactive Visualizations</h2>
      <div class="hint">All plots update live</div>
    </div>
    <div class="content">
      <div class="controls" aria-label="Interactive controls">
        <div class="ctrl">
          <label for="dSlider">
            Mirror separation <span class="eq">d</span> (μm)
            <span class="val" id="dVal"></span>
          </label>
          <input id="dSlider" type="range" min="0.8" max="20" step="0.1" value="6.0"/>
          <div class="small">Example values for plotting (you can change them).</div>
        </div>
        <div class="ctrl">
          <label for="mSel">
            Highlighted mode index <span class="eq">m</span>
            <span class="val" id="mVal"></span>
          </label>
          <select id="mSel"></select>
          <div class="small">Used in the diagram + marker on dispersion plot.</div>
        </div>
        <div class="ctrl">
          <label for="signSel">
            Naive amplitude choice
            <span class="val" id="signVal"></span>
          </label>
          <select id="signSel">
            <option value="+">A2 = +A1</option>
            <option value="-">A2 = −A1</option>
          </select>
          <div class="small">Shows why ± works only for certain parity.</div>
        </div>
      </div>

      <figure class="vizWrap" style="margin-top:12px">
        <div class="canvasCard">
          <div class="canvasHead">
            <div class="title">Canvas A — Planar-mirror waveguide diagram</div>
            <div class="legend" id="diagLegend"></div>
          </div>
          <canvas id="cDiag"></canvas>
        </div>

        <div class="canvasCard">
          <div class="canvasHead">
            <div class="title">Canvas B — Main plot: boundary residual vs mode index</div>
            <div class="legend">
              <span>Residual at walls</span>
              <span class="tag">dimensionless</span>
            </div>
          </div>
          <canvas id="cMain"></canvas>
        </div>

        <div class="canvasCard" style="grid-column:1 / -1">
          <div class="canvasHead">
            <div class="title">Canvas C — Secondary plot: dispersion β vs mode index</div>
            <div class="legend" id="dispLegend"></div>
          </div>
          <canvas id="cDisp"></canvas>
        </div>
      </figure>

      <div class="noteBox" style="margin-top:12px">
        <b>Note:</b> The plotted wavelength is an <b>example</b> (λ = 633 nm) to make β concrete. The algebraic proofs above do not require a numeric λ.
      </div>
    </div>
  </section>

  <!-- Final Answer -->
  <section id="final">
    <div class="secHead">
      <h2>Final Answer (Boxed)</h2>
      <div class="hint">Copy-ready</div>
    </div>
    <div class="content">
      <div class="finalBox">
        <div class="copyNote" id="noteFinalAll">Copied!</div>
        <button class="copyBtn" data-copy="(a) Single plane wave Ex=A e^{-j ky y} e^{-jβz} cannot satisfy Ex(±d/2,z)=0 for all z unless A=0.\n\n(b) With ky1=-ky2=ky and β1=β2=β, Ex=e^{-jβz}(A1 e^{-jkyy}+A2 e^{+jkyy}). Enforcing Ex(±d/2,z)=0 gives ky=mπ/d and the required amplitude ratio A2/A1 = -e^{-jky d} = -(-1)^m. Hence A2=+A1 only for odd m, and A2=-A1 only for even m; therefore the blanket assumption A1=±A2 does not generally satisfy the boundaries.\n\nA convenient correct mode form: Ex(y,z)=E0 sin[ky(y+d/2)] e^{-jβz} with ky=mπ/d.">Copy</button>
        <div class="eq" style="white-space:pre-wrap; font-family:var(--mono); font-size:.98rem;">
(a)  E_x(y,z)=A e^{-j k_y y} e^{-jβ z}  cannot satisfy  E_x(±d/2,z)=0  for all z unless  A=0.

(b)  With k_{y1}=-k_{y2}=k_y and β_1=β_2=β,
     E_x(y,z)=e^{-jβz}(A_1 e^{-jk_y y}+A_2 e^{+jk_y y}).
     Enforcing E_x(±d/2,z)=0 gives:
        k_y d = mπ  ⇒  k_y = mπ/d,
        A_2/A_1 = -e^{-jk_y d} = -(-1)^m.
     Therefore A_2=+A_1 only for odd m, and A_2=-A_1 only for even m; the blanket choice A_1=±A_2 does not work for all m.

     A convenient correct mode shape:
        E_x(y,z)=E_0 sin[k_y(y+d/2)] e^{-jβz},  with  k_y=mπ/d.
        </div>
      </div>
    </div>
  </section>
</main>

<footer class="fadeIn">
  Built as a self-contained learning article (vanilla HTML/CSS/JS). Print-friendly and interactive.
</footer>

<script>
(function(){
  // ---------- Utilities ----------
  const $ = (id)=>document.getElementById(id);

  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  function niceTicks(min, max, count){
    // simple "nice" ticks
    const span = max-min;
    if(span <= 0) return [min];
    const raw = span / count;
    const pow10 = Math.pow(10, Math.floor(Math.log10(raw)));
    const n = raw / pow10;
    let step;
    if(n < 1.5) step = 1;
    else if(n < 3) step = 2;
    else if(n < 7) step = 5;
    else step = 10;
    step *= pow10;
    const t0 = Math.ceil(min/step)*step;
    const ticks = [];
    for(let t=t0; t<=max+1e-12; t+=step) ticks.push(t);
    return ticks;
  }

  function setupCanvas(canvas){
    const ctx = canvas.getContext('2d');
    function resize(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.max(2, Math.floor(rect.width * dpr));
      canvas.height = Math.max(2, Math.floor(rect.height * dpr));
      ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
    }
    resize();
    return {ctx, resize};
  }

  function clear(ctx, w, h){
    ctx.clearRect(0,0,w,h);
  }

  function drawPanel(ctx, w, h){
    // subtle background
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0,'rgba(255,255,255,0.02)');
    g.addColorStop(1,'rgba(255,255,255,0.00)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);
  }

  function drawAxes(ctx, box, xLabel, yLabel, xTicks, yTicks, fmtX, fmtY){
    const {x0,y0,x1,y1} = box;
    ctx.save();
    ctx.strokeStyle = 'rgba(255,255,255,0.22)';
    ctx.lineWidth = 1;

    // axes
    ctx.beginPath();
    ctx.moveTo(x0,y1);
    ctx.lineTo(x1,y1);
    ctx.moveTo(x0,y1);
    ctx.lineTo(x0,y0);
    ctx.stroke();

    // grid + ticks
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.fillStyle = 'rgba(233,238,247,0.75)';

    // x ticks
    xTicks.forEach(t=>{
      const x = x0 + (t - fmtX.min)/(fmtX.max-fmtX.min) * (x1-x0);
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      ctx.beginPath();
      ctx.moveTo(x,y0);
      ctx.lineTo(x,y1);
      ctx.stroke();

      ctx.strokeStyle = 'rgba(255,255,255,0.25)';
      ctx.beginPath();
      ctx.moveTo(x,y1);
      ctx.lineTo(x,y1+5);
      ctx.stroke();

      const s = fmtX.f(t);
      ctx.fillText(s, x - ctx.measureText(s).width/2, y1+18);
    });

    // y ticks
    yTicks.forEach(t=>{
      const y = y1 - (t - fmtY.min)/(fmtY.max-fmtY.min) * (y1-y0);
      ctx.strokeStyle = 'rgba(255,255,255,0.10)';
      ctx.beginPath();
      ctx.moveTo(x0,y);
      ctx.lineTo(x1,y);
      ctx.stroke();

      ctx.strokeStyle = 'rgba(255,255,255,0.25)';
      ctx.beginPath();
      ctx.moveTo(x0-5,y);
      ctx.lineTo(x0,y);
      ctx.stroke();

      const s = fmtY.f(t);
      ctx.fillText(s, x0 - 8 - ctx.measureText(s).width, y + 4);
    });

    // labels
    ctx.fillStyle = 'rgba(233,238,247,0.85)';
    ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText(xLabel, (x0+x1)/2 - ctx.measureText(xLabel).width/2, y1+38);

    ctx.save();
    ctx.translate(x0-42, (y0+y1)/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
    ctx.restore();

    ctx.restore();
  }

  function plotLines(ctx, box, series, xMin, xMax, yMin, yMax){
    const {x0,y0,x1,y1} = box;
    function X(x){ return x0 + (x-xMin)/(xMax-xMin)*(x1-x0); }
    function Y(y){ return y1 - (y-yMin)/(yMax-yMin)*(y1-y0); }

    series.forEach(s=>{
      ctx.save();
      ctx.lineWidth = 2;
      ctx.strokeStyle = s.color;
      ctx.globalAlpha = s.alpha ?? 1;
      ctx.beginPath();
      s.data.forEach((p,i)=>{
        const xx = X(p.x), yy = Y(p.y);
        if(i===0) ctx.moveTo(xx,yy);
        else ctx.lineTo(xx,yy);
      });
      ctx.stroke();
      ctx.restore();
    });
  }

  function plotMarkers(ctx, box, points, xMin, xMax, yMin, yMax){
    const {x0,y0,x1,y1} = box;
    function X(x){ return x0 + (x-xMin)/(xMax-xMin)*(x1-x0); }
    function Y(y){ return y1 - (y-yMin)/(yMax-yMin)*(y1-y0); }

    points.forEach(p=>{
      ctx.save();
      ctx.fillStyle = p.color;
      ctx.globalAlpha = p.alpha ?? 1;
      const xx = X(p.x), yy = Y(p.y);
      ctx.beginPath();
      ctx.arc(xx, yy, 4, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    });
  }

  // ---------- Physics helpers ----------
  function kyFrom(m, d){ return (m*Math.PI)/d; } // rad/m
  function betaFrom(k0, ky){
    const val = k0*k0 - ky*ky;
    return val>0 ? Math.sqrt(val) : 0;
  }

  // Boundary residual measure for a given transverse bracket F(y)=A1 e^{-jky y}+A2 e^{+jky y}.
  // We compute |F(+d/2)|^2 + |F(-d/2)|^2 normalized by (|A1|+|A2|)^2 (avoid scale dependence).
  function residualFor(A2overA1, ky, d){
    const A1 = {re:1, im:0};
    const A2 = {re:A2overA1.re, im:A2overA1.im};

    function expi(phi){ return {re: Math.cos(phi), im: Math.sin(phi)}; }
    function mul(a,b){ return {re:a.re*b.re - a.im*b.im, im:a.re*b.im + a.im*b.re}; }
    function add(a,b){ return {re:a.re+b.re, im:a.im+b.im}; }
    function abs2(a){ return a.re*a.re + a.im*a.im; }

    function F(y){
      const e1 = expi(-ky*y); // e^{-jky y}
      const e2 = expi(+ky*y); // e^{+jky y}
      return add(mul(A1,e1), mul(A2,e2));
    }
    const fp = F(+d/2), fm = F(-d/2);
    const num = abs2(fp) + abs2(fm);
    const denom = Math.pow(1 + Math.hypot(A2.re, A2.im), 2);
    return num / Math.max(1e-12, denom);
  }

  // ---------- Copy buttons ----------
  function hookCopyButtons(){
    const buttons = document.querySelectorAll('.copyBtn');
    buttons.forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const txt = btn.getAttribute('data-copy') || '';
        try{
          await navigator.clipboard.writeText(txt);
          // show a nearby note if exists
          const parent = btn.parentElement;
          const note = parent.querySelector('.copyNote');
          if(note){
            note.classList.add('show');
            setTimeout(()=>note.classList.remove('show'), 900);
          }
        }catch(e){
          // fallback
          const ta = document.createElement('textarea');
          ta.value = txt;
          document.body.appendChild(ta);
          ta.select();
          try{ document.execCommand('copy'); }catch(_){}
          document.body.removeChild(ta);
        }
      });
    });
  }

  // ---------- State ----------
  const state = {
    lambda: 633e-9, // example for plotting
    d_um: 6.0,
    m: 3,
    sign: '+',
    Mmax: 12
  };

  // Populate m select
  const mSel = $('mSel');
  for(let i=1;i<=state.Mmax;i++){
    const opt = document.createElement('option');
    opt.value = String(i);
    opt.textContent = String(i);
    mSel.appendChild(opt);
  }
  mSel.value = String(state.m);

  // UI refs
  const dSlider = $('dSlider');
  const signSel = $('signSel');
  const dVal = $('dVal');
  const mVal = $('mVal');
  const signVal = $('signVal');

  function syncUI(){
    dSlider.value = String(state.d_um);
    mSel.value = String(state.m);
    signSel.value = state.sign;
    dVal.textContent = state.d_um.toFixed(1);
    mVal.textContent = String(state.m);
    signVal.textContent = (state.sign==='+') ? 'A2=+A1' : 'A2=-A1';
  }

  // ---------- Canvases ----------
  const diag = setupCanvas($('cDiag'));
  const main = setupCanvas($('cMain'));
  const disp = setupCanvas($('cDisp'));

  function drawDiagram(){
    const ctx = diag.ctx;
    const W = $('cDiag').getBoundingClientRect().width;
    const H = $('cDiag').getBoundingClientRect().height;
    clear(ctx, W, H);
    drawPanel(ctx, W, H);

    const d = state.d_um * 1e-6;
    const m = state.m;
    const k_0 = 2*Math.PI/state.lambda;
    const ky = kyFrom(m,d);
    const beta = betaFrom(k0, ky);
    const propagating = (k0*k0 - ky*ky) > 0;

    // layout box
    const pad = 22;
    const x0 = pad, x1 = W - pad, y0 = pad+10, y1 = H - pad;
    const midY = (y0+y1)/2;

    // Map y coordinate of physical y to canvas y:
    // show mirrors at y=±d/2 occupying some fraction of diagram height.
    const gapPix = clamp((H*0.45), 120, 220);
    const yTop = midY - gapPix/2;
    const yBot = midY + gapPix/2;

    // Draw mirrors
    ctx.save();
    ctx.strokeStyle = 'rgba(125,211,252,0.55)';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(x0+20, yTop);
    ctx.lineTo(x1-20, yTop);
    ctx.moveTo(x0+20, yBot);
    ctx.lineTo(x1-20, yBot);
    ctx.stroke();

    // Mirror labels
    ctx.fillStyle = 'rgba(233,238,247,0.85)';
    ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText('Mirror: y = +d/2', x0+22, yTop-10);
    ctx.fillText('Mirror: y = −d/2', x0+22, yBot+22);

    // Axes arrows
    function arrow(xa,ya, xb,yb, label){
      ctx.strokeStyle = 'rgba(255,255,255,0.35)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(xa,ya);
      ctx.lineTo(xb,yb);
      ctx.stroke();
      const ang = Math.atan2(yb-ya, xb-xa);
      const ah = 7;
      ctx.beginPath();
      ctx.moveTo(xb,yb);
      ctx.lineTo(xb - ah*Math.cos(ang-0.5), yb - ah*Math.sin(ang-0.5));
      ctx.lineTo(xb - ah*Math.cos(ang+0.5), yb - ah*Math.sin(ang+0.5));
      ctx.closePath();
      ctx.fillStyle = 'rgba(255,255,255,0.35)';
      ctx.fill();
      ctx.fillStyle = 'rgba(233,238,247,0.75)';
      ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
      ctx.fillText(label, xb+6, yb+4);
    }
    arrow(x0+28, yBot+36, x0+28, yBot-36, 'y');
    arrow(x0+28, yBot+36, x0+92, yBot+36, 'z');

    // Zig-zag ray
    const zStart = x0+80;
    const zEnd = x1-40;
    const nBounces = 7;
    const dz = (zEnd - zStart)/nBounces;
    const pts = [];
    for(let i=0;i<=nBounces;i++){
      const x = zStart + i*dz;
      const y = (i%2===0) ? yBot : yTop;
      pts.push({x,y});
    }
    ctx.strokeStyle = 'rgba(251,191,36,0.80)';
    ctx.lineWidth = 2.2;
    ctx.beginPath();
    ctx.moveTo(pts[0].x, pts[0].y);
    for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].x, pts[i].y);
    ctx.stroke();

    // Angle theta indicator (if propagating)
    const theta = propagating ? Math.asin(clamp(ky/k0,0,1)) : Math.PI/2;
    // Draw small angle arc near first segment
    const p0 = pts[0], p1 = pts[1];
    const vx = p1.x - p0.x, vy = p1.y - p0.y;
    const segAng = Math.atan2(vy, vx);
    const refAng = 0; // horizontal along +z
    const arcR = 26;
    ctx.strokeStyle = 'rgba(251,191,36,0.55)';
    ctx.lineWidth = 1.6;
    ctx.beginPath();
    ctx.arc(p0.x, p0.y, arcR, refAng, segAng, segAng<refAng);
    ctx.stroke();
    ctx.fillStyle = 'rgba(251,191,36,0.92)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.fillText('θ', p0.x + arcR + 6, p0.y - 6);

    // Gap dimension d bracket
    ctx.strokeStyle = 'rgba(134,239,172,0.65)';
    ctx.lineWidth = 1.8;
    const bx = x0+18;
    ctx.beginPath();
    ctx.moveTo(bx, yTop);
    ctx.lineTo(bx, yBot);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(bx-6, yTop);
    ctx.lineTo(bx+6, yTop);
    ctx.moveTo(bx-6, yBot);
    ctx.lineTo(bx+6, yBot);
    ctx.stroke();
    ctx.fillStyle = 'rgba(134,239,172,0.90)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.fillText('d', bx-10, (yTop+yBot)/2);

    // Status text
    ctx.fillStyle = 'rgba(233,238,247,0.85)';
    ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    const info1 = `m=${m},  d=${state.d_um.toFixed(1)} μm`;
    ctx.fillText(info1, x0+20, y0+6);

    const kyText = `k_y = mπ/d = ${ (ky/1e6).toFixed(2) } Mrad/m`;
    const bText  = `β = ${ (beta/1e6).toFixed(2) } Mrad/m`;
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.fillStyle = propagating ? 'rgba(134,239,172,0.88)' : 'rgba(251,113,133,0.88)';
    ctx.fillText(kyText, x0+20, y0+26);
    ctx.fillText(bText + (propagating ? '' : '  (cutoff / evanescent)'), x0+20, y0+44);

    ctx.restore();

    // Update legend text outside canvas
    const diagLegend = $('diagLegend');
    const k0 = 2*Math.PI/state.lambda;
    const ratio = ky/k0;
    const s = propagating ? `sinθ = k_y/k0 = ${ratio.toFixed(3)} ⇒ θ ≈ ${(theta*180/Math.PI).toFixed(1)}°` : `k_y/k0 = ${ratio.toFixed(3)} (no real θ)`;
    diagLegend.textContent = s;
  }

  function drawMainPlot(){
    const ctx = main.ctx;
    const W = $('cMain').getBoundingClientRect().width;
    const H = $('cMain').getBoundingClientRect().height;
    clear(ctx, W, H);
    drawPanel(ctx, W, H);

    const d = state.d_um*1e-6;
    const M = state.Mmax;

    // build residual series vs m
    const series = {
      single: [],
      plus: [],
      minus: [],
      correct: []
    };

    for(let m=1;m<=M;m++){
      const ky = kyFrom(m,d);

      // single plane wave: amplitude at walls never zero -> model residual as 1 (normalized)
      // We can compute residual using A2=0 and A1=1, which corresponds to single transverse wave.
      const rSingle = residualFor({re:0,im:0}, ky, d);

      // naive plus/minus
      const rPlus = residualFor({re:+1,im:0}, ky, d);
      const rMinus = residualFor({re:-1,im:0}, ky, d);

      // correct ratio: A2/A1 = -(-1)^m = (m odd ? +1 : -1)
      const correctRatio = (m%2===1) ? +1 : -1;
      const rCorrect = residualFor({re:correctRatio, im:0}, ky, d);

      series.single.push({x:m, y:rSingle});
      series.plus.push({x:m, y:rPlus});
      series.minus.push({x:m, y:rMinus});
      series.correct.push({x:m, y:rCorrect});
    }

    // determine y range
    const allY = [...series.single, ...series.plus, ...series.minus, ...series.correct].map(p=>p.y);
    const yMax = Math.max(1e-6, ...allY);
    const yTop = Math.min(1.2, Math.max(0.25, yMax*1.05)); // keep reasonable
    const yMin = 0;

    const box = {x0:58, y0:22, x1:W-18, y1:H-58};

    const xMin = 1, xMax = M;

    // ticks
    const xTicks = [];
    for(let m=1;m<=M;m++) xTicks.push(m);
    const yTicks = niceTicks(0, yTop, 5);

    drawAxes(ctx, box,
      'Mode index m (dimensionless)',
      'Boundary residual R (dimensionless)',
      xTicks, yTicks,
      {min:xMin, max:xMax, f:(t)=>String(t)},
      {min:yMin, max:yTop, f:(t)=> (t===0 ? '0' : t.toFixed(2))}
    );

    // draw lines
    const lines = [
      {name:'Single plane wave', color:'rgba(251,113,133,0.85)', data:series.single},
      {name:'Two-wave naive: A2=+A1', color:'rgba(125,211,252,0.85)', data:series.plus},
      {name:'Two-wave naive: A2=-A1', color:'rgba(167,139,250,0.85)', data:series.minus},
      {name:'Correct ratio', color:'rgba(134,239,172,0.90)', data:series.correct}
    ];
    plotLines(ctx, box, lines, xMin, xMax, yMin, yTop);

    // highlight selected m
    const mh = state.m;
    function yAt(arr){
      const p = arr.find(q=>q.x===mh);
      return p ? p.y : 0;
    }
    const markers = [
      {x:mh, y:yAt(series.single), color:'rgba(251,113,133,0.95)'},
      {x:mh, y:yAt(series.plus), color:'rgba(125,211,252,0.95)'},
      {x:mh, y:yAt(series.minus), color:'rgba(167,139,250,0.95)'},
      {x:mh, y:yAt(series.correct), color:'rgba(134,239,172,0.95)'}
    ];
    plotMarkers(ctx, box, markers, xMin, xMax, yMin, yTop);

    // legend
    ctx.save();
    ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    const lx = box.x0 + 8, ly = box.y0 + 6;
    const items = [
      {txt:'Single wave', col:'rgba(251,113,133,0.95)'},
      {txt:'Naive +', col:'rgba(125,211,252,0.95)'},
      {txt:'Naive −', col:'rgba(167,139,250,0.95)'},
      {txt:'Correct', col:'rgba(134,239,172,0.95)'},
    ];
    let x = lx, y = ly;
    items.forEach((it, i)=>{
      ctx.fillStyle = it.col;
      ctx.fillRect(x, y+5, 10, 3);
      ctx.fillStyle = 'rgba(233,238,247,0.82)';
      ctx.fillText(it.txt, x+14, y+10);
      x += 95;
      if(x > box.x1 - 90){ x = lx; y += 18; }
    });
    ctx.restore();

    // title inside plot area
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,247,0.85)';
    ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    const title = 'Boundary residual R = |F(+d/2)|² + |F(−d/2)|² (normalized)';
    ctx.fillText(title, box.x0, 16);
    ctx.restore();
  }

  function drawDispPlot(){
    const ctx = disp.ctx;
    const W = $('cDisp').getBoundingClientRect().width;
    const H = $('cDisp').getBoundingClientRect().height;
    clear(ctx, W, H);
    drawPanel(ctx, W, H);

    const d = state.d_um*1e-6;
    const M = state.Mmax;
    const k0 = 2*Math.PI/state.lambda;

    const data = [];
    for(let m=1;m<=M;m++){
      const ky = kyFrom(m,d);
      const beta = betaFrom(k0, ky);
      data.push({x:m, y: beta/k0}); // normalized
    }

    const yMin = 0;
    const yMax = 1.02;
    const xMin = 1;
    const xMax = M;

    const box = {x0:58, y0:26, x1:W-18, y1:H-56};

    const xTicks = [];
    for(let m=1;m<=M;m++) xTicks.push(m);
    const yTicks = [0,0.2,0.4,0.6,0.8,1.0];

    drawAxes(ctx, box,
      'Mode index m (dimensionless)',
      'β / k0 (dimensionless)',
      xTicks, yTicks,
      {min:xMin, max:xMax, f:(t)=>String(t)},
      {min:yMin, max:yMax, f:(t)=>t.toFixed(1)}
    );

    // line
    plotLines(ctx, box, [
      {name:'β/k0', color:'rgba(125,211,252,0.90)', data}
    ], xMin, xMax, yMin, yMax);

    // highlight selected m
    const mh = state.m;
    const p = data.find(q=>q.x===mh) || {x:mh,y:0};
    plotMarkers(ctx, box, [{x:p.x,y:p.y,color:'rgba(251,191,36,0.95)'}], xMin, xMax, yMin, yMax);

    // cutoff shading (where ky>k0)
    // We'll draw small "cutoff" markers above x positions with beta=0
    ctx.save();
    ctx.fillStyle = 'rgba(251,113,133,0.25)';
    ctx.strokeStyle = 'rgba(251,113,133,0.40)';
    ctx.lineWidth = 1;
    const {x0,y0,x1,y1} = box;
    function X(x){ return x0 + (x-xMin)/(xMax-xMin)*(x1-x0); }
    function Y(y){ return y1 - (y-yMin)/(yMax-yMin)*(y1-y0); }
    for(let m=1;m<=M;m++){
      const ky = kyFrom(m,d);
      if(ky > k0){
        const xx = X(m);
        // draw a small "x" at beta=0
        const yy = Y(0);
        ctx.beginPath();
        ctx.moveTo(xx-5, yy-5);
        ctx.lineTo(xx+5, yy+5);
        ctx.moveTo(xx-5, yy+5);
        ctx.lineTo(xx+5, yy-5);
        ctx.stroke();
      }
    }
    ctx.restore();

    // title + notes
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,247,0.85)';
    ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText('Example dispersion (uniform gap): β = √(k0² − ky²), ky = mπ/d', box.x0, 18);
    ctx.fillStyle = 'rgba(169,181,199,0.90)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.fillText('Markers: orange dot = selected m, red x = ky>k0 (evanescent)', box.x0, H-18);
    ctx.restore();

    // legend text outside canvas
    const dispLegend = $('dispLegend');
    const kySel = kyFrom(state.m,d);
    const betaSel = betaFrom(k0, kySel);
    const prop = (kySel<=k0) ? 'propagating' : 'evanescent';
    dispLegend.textContent = `λ=633 nm (example),  ky/k0=${(kySel/k0).toFixed(3)},  β/k0=${(betaSel/k0).toFixed(3)} (${prop})`;
  }

  function redrawAll(){
    syncUI();
    drawDiagram();
    drawMainPlot();
    drawDispPlot();
  }

  // ---------- Events ----------
  dSlider.addEventListener('input', ()=>{
    state.d_um = parseFloat(dSlider.value);
    redrawAll();
  });
  mSel.addEventListener('change', ()=>{
    state.m = parseInt(mSel.value, 10);
    redrawAll();
  });
  signSel.addEventListener('change', ()=>{
    state.sign = signSel.value;
    redrawAll();
  });

  // Resize handling
  function resizeAll(){
    diag.resize(); main.resize(); disp.resize();
    redrawAll();
  }
  window.addEventListener('resize', resizeAll);

  // Smooth scroll for ToC
  document.querySelectorAll('nav a[href^="#"]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      const id = a.getAttribute('href').slice(1);
      const el = document.getElementById(id);
      if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
    });
  });

  // Init
  hookCopyButtons();
  redrawAll();
})();
</script>
</body>
</html>
