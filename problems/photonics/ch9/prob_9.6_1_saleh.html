<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Silver-Slab (Metal-Film) Waveguide: Symmetric & Anti-symmetric SPP Modes (Drude Model)</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#111827;
      --panel2:#0f172a;
      --text:#e5e7eb;
      --muted:#a7b0c0;
      --line:rgba(255,255,255,.10);
      --accent:#60a5fa;
      --accent2:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --ok:#a3e635;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(96,165,250,.20), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(52,211,153,.14), transparent 60%),
        radial-gradient(900px 700px at 60% 120%, rgba(251,191,36,.12), transparent 60%),
        linear-gradient(180deg, var(--bg), #070a10 70%);
      line-height:1.55;
    }
    a{color:var(--accent)}
    header{
      padding:28px 18px 8px;
      position:relative;
      overflow:hidden;
    }
    header .wrap{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 920px){
      header .wrap{grid-template-columns:1fr}
    }
    .titleCard{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px 18px 16px;
      box-shadow:var(--shadow);
    }
    h1{
      margin:0 0 8px;
      font-size:clamp(22px, 2.7vw, 34px);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:14.5px;
    }
    .meta{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12.8px;
    }
    .pill{
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background:rgba(17,24,39,.55);
      backdrop-filter: blur(6px);
    }

    /* Sticky mini TOC */
    .toc{
      position:sticky;
      top:14px;
      align-self:start;
      background:linear-gradient(180deg, rgba(17,24,39,.80), rgba(15,23,42,.62));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:12px 12px 10px;
      box-shadow:var(--shadow);
    }
    .toc h2{
      margin:0 0 8px;
      font-size:14px;
      color:#dbeafe;
      letter-spacing:.2px;
    }
    .toc a{
      display:block;
      text-decoration:none;
      color:var(--muted);
      padding:6px 8px;
      border-radius:10px;
      border:1px solid transparent;
      font-size:13.2px;
    }
    .toc a:hover{
      color:var(--text);
      border-color:rgba(96,165,250,.25);
      background:rgba(96,165,250,.08);
    }

    main{
      max-width:1100px;
      margin:0 auto;
      padding:10px 18px 60px;
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }
    section{
      background:linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
    }
    section h2{
      margin:0 0 10px;
      font-size:20px;
      letter-spacing:.2px;
    }
    section h3{
      margin:18px 0 8px;
      font-size:16px;
      color:#eaf2ff;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 900px){
      .grid2{grid-template-columns:1fr}
    }
    .callout{
      background:linear-gradient(180deg, rgba(96,165,250,.10), rgba(17,24,39,.25));
      border:1px solid rgba(96,165,250,.20);
      border-radius:14px;
      padding:12px 12px;
    }
    .callout.warn{
      background:linear-gradient(180deg, rgba(251,191,36,.12), rgba(17,24,39,.25));
      border-color:rgba(251,191,36,.25);
    }
    .callout.bad{
      background:linear-gradient(180deg, rgba(251,113,133,.12), rgba(17,24,39,.25));
      border-color:rgba(251,113,133,.25);
    }
    .callout.ok{
      background:linear-gradient(180deg, rgba(163,230,53,.10), rgba(17,24,39,.25));
      border-color:rgba(163,230,53,.20);
    }
    .callout .label{
      font-weight:700;
      font-size:12.5px;
      letter-spacing:.25px;
      text-transform:uppercase;
      color:#dbeafe;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .callout.warn .label{color:#fff7d6}
    .callout.bad .label{color:#ffe4e8}
    .callout.ok .label{color:#ecfccb}
    ul{margin:8px 0 0 18px}
    li{margin:6px 0}
    .eqbox{
      background:rgba(15,23,42,.70);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      overflow:auto;
      position:relative;
    }
    pre, code{font-family:var(--mono)}
    pre.eq{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-size:13.2px;
      color:#e6f0ff;
    }
    .copyBtn{
      position:absolute;
      top:10px;
      right:10px;
      border:1px solid var(--line);
      background:rgba(17,24,39,.75);
      color:var(--text);
      padding:6px 9px;
      border-radius:10px;
      cursor:pointer;
      font-size:12px;
      transition:transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .copyBtn:hover{background:rgba(96,165,250,.12); border-color:rgba(96,165,250,.35)}
    .copyBtn:active{transform:scale(.98)}
    .small{color:var(--muted); font-size:13.2px}
    .note{color:var(--muted); font-size:13px; margin-top:6px}
    .divider{
      height:1px; background:var(--line);
      margin:14px 0;
    }

    /* Visualization block */
    figure.viz{
      margin:0;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .vizHeader{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      background:rgba(15,23,42,.55);
      border:1px solid var(--line);
      border-radius:14px;
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px 12px;
      align-items:center;
    }
    .control{
      display:flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(17,24,39,.65);
    }
    .control label{
      font-size:12.5px;
      color:var(--muted);
    }
    .control input[type="range"]{width:190px}
    .control select{
      background:rgba(0,0,0,.25);
      color:var(--text);
      border:1px solid var(--line);
      border-radius:10px;
      padding:5px 8px;
      font-size:12.5px;
      outline:none;
    }
    .control button{
      border:1px solid var(--line);
      background:rgba(17,24,39,.65);
      color:var(--text);
      border-radius:10px;
      padding:6px 10px;
      cursor:pointer;
      font-size:12.5px;
    }
    .control button:hover{border-color:rgba(96,165,250,.35); background:rgba(96,165,250,.10)}
    .canvasGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 950px){
      .canvasGrid{grid-template-columns:1fr}
    }
    .canvasCard{
      background:rgba(15,23,42,.45);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      overflow:hidden;
    }
    .canvasTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin:2px 2px 8px;
    }
    .canvasTitle h4{
      margin:0;
      font-size:13.8px;
      color:#dbeafe;
      letter-spacing:.2px;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.08));
      border:1px solid rgba(255,255,255,.06);
    }
    .kpiRow{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width: 980px){
      .kpiRow{grid-template-columns: repeat(2, 1fr)}
    }
    .kpi{
      background:rgba(17,24,39,.55);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px 9px;
    }
    .kpi .k{color:var(--muted); font-size:12.3px}
    .kpi .v{font-size:14.2px; margin-top:4px; font-family:var(--mono)}
    footer{
      max-width:1100px;
      margin:0 auto;
      padding:0 18px 36px;
      color:var(--muted);
      font-size:12.8px;
    }

    /* subtle animation */
    @media (prefers-reduced-motion: no-preference){
      section{animation: pop .35s ease both}
      @keyframes pop{
        from{opacity:0; transform: translateY(8px)}
        to{opacity:1; transform: translateY(0)}
      }
    }
    @media print{
      body{background:#fff; color:#000}
      section, .titleCard, .toc{box-shadow:none}
      .toc{position:relative; top:auto}
      canvas{border:1px solid #999}
      .copyBtn{display:none}
      a{color:#000; text-decoration:none}
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="titleCard">
      <h1>9.6-1 — Silver-Slab (Metal-Film) Waveguide: Coupled SPP Modes</h1>
      <p class="subtitle">
        Calculate & plot the dispersion relations for the <b>symmetric</b> and <b>anti-symmetric</b> TM modes of a
        <b>silver slab</b> (thickness <b>d = 20 nm</b>) embedded in a dielectric of index <b>n<sub>2</sub> = 2</b>,
        using a lossless <b>Drude model</b> for silver. Then evaluate mode properties at <b>λ<sub>0</sub>=400 nm</b>
        and compare with a single-interface SPP.
      </p>
      <div class="meta">
        <span class="pill">TM / plasmonic guided waves</span>
        <span class="pill">Metal film coupling → mode splitting</span>
        <span class="pill">Interactive plots (change thickness)</span>
      </div>
    </div>

    <nav class="toc" aria-label="Mini Table of Contents">
      <h2>On this page</h2>
      <a href="#quick">Quick Summary</a>
      <a href="#part0">PART 0 — Concept Primer</a>
      <a href="#part1">PART 1 — Problem Analysis</a>
      <a href="#part2">PART 2 — Strategy & Tips</a>
      <a href="#part3">PART 3 — Full Solution</a>
      <a href="#part4">PART 4 — Deeper Understanding</a>
      <a href="#part5">PART 5 — Visualization Guide</a>
      <a href="#viz">Interactive Visualizations</a>
    </nav>
  </div>
</header>

<main>

  <section id="quick">
    <h2>Quick Summary</h2>
    <ul>
      <li><b>What this is:</b> A <b>metal film</b> in a dielectric supports two coupled surface-plasmon-polariton (SPP) modes: <b>symmetric</b> and <b>anti-symmetric</b>.</li>
      <li><b>Key physics idea:</b> Two metal–dielectric interfaces couple through the finite film thickness, splitting the single-interface SPP into a <b>long-range</b> (lower confinement) and <b>short-range</b> (higher confinement) branch.</li>
      <li><b>Material model:</b> Lossless Drude (given): <code>ε_m(ω) = ε0(1 − ω_p^2/ω^2)</code>, with <code>ω_p</code> corresponding to <code>λ_p = 138 nm</code>.</li>
      <li><b>Waveguide dispersion equations:</b> For TM modes in a symmetric dielectric environment,
        the modes satisfy a transcendental equation involving <code>tanh(κ_m d/2)</code> or <code>coth(κ_m d/2)</code>.</li>
      <li><b>What you compute:</b> The dispersion curves <code>β(ω)</code> (or effective index <code>n_eff = β/k0</code>) for symmetric and anti-symmetric modes, plus a single-interface SPP for comparison.</li>
      <li><b>At λ0 = 400 nm:</b> You extract <b>phase velocity</b> <code>v_p = ω/β = c/n_eff</code>, <b>group velocity</b> <code>v_g = dω/dβ</code> (lossless ≈ energy velocity), <b>guided wavelength</b> <code>λ_g = 2π/β = λ0/n_eff</code>, and <b>penetration depths</b> <code>δ = 1/κ</code> in dielectric and metal.</li>
      <li><b>Final result type:</b> A <b>numerical dispersion plot</b> and <b>numerical mode properties</b> at a specified wavelength.</li>
    </ul>
  </section>

  <section id="part0">
    <h2>PART 0 — Concept Primer (THEORY BEFORE SOLVING)</h2>

    <div class="grid2">
      <article>
        <h3>0.1 Core definitions (symbols & units)</h3>
        <ul>
          <li><b>Free-space wavelength:</b> <code>λ0</code> [m], <b>angular frequency:</b> <code>ω = 2πc/λ0</code> [rad/s].</li>
          <li><b>Free-space wavenumber:</b> <code>k0 = ω/c = 2π/λ0</code> [1/m].</li>
          <li><b>Dielectric permittivity:</b> <code>ε2 = n2^2 ε0</code> [F/m] (here <code>n2=2</code> → <code>ε2/ε0=4</code>).</li>
          <li><b>Metal permittivity (Drude, lossless):</b> <code>εm(ω) = ε0(1 − ωp^2/ω^2)</code>.</li>
          <li><b>Propagation constant:</b> <code>β</code> along the film [1/m], define <b>effective index</b> <code>n_eff = β/k0</code> [dimensionless].</li>
          <li><b>Transverse decay constants</b> (evanescent): <code>κ2</code> in dielectric, <code>κm</code> in metal [1/m].</li>
        </ul>
      </article>

      <article>
        <h3>0.2 Physical meaning of key quantities</h3>
        <ul>
          <li><code>β</code> sets how fast the phase advances along the guide; it determines the <b>guided wavelength</b> <code>λg = 2π/β</code>.</li>
          <li><code>n_eff</code> compares phase slowness to free space: <code>v_p = c/n_eff</code>.</li>
          <li><code>κ</code> controls confinement perpendicular to the interface; the <b>penetration depth</b> is <code>δ = 1/κ</code>.</li>
          <li><code>v_g = dω/dβ</code> governs pulse/envelope transport (lossless, weakly dispersive → close to energy velocity).</li>
        </ul>
      </article>
    </div>

    <div class="divider"></div>

    <article>
      <h3>0.3 What is an SPP, and why does a metal film have two modes?</h3>
      <p>
        A <b>surface plasmon polariton</b> (SPP) is a bound electromagnetic wave at a metal–dielectric interface
        where the metal’s real permittivity is <b>negative</b> (typical below the plasma frequency).
        The field is <b>TM-polarized</b> and decays evanescently away from the interface.
      </p>
      <p>
        A <b>metal film</b> has <b>two interfaces</b>. The SPP on one interface can “feel” the other interface if the film is thin enough
        that fields penetrate through the metal. The result is <b>coupled modes</b>:
      </p>
      <ul>
        <li><b>Symmetric</b> branch (often called <b>long-range SPP</b> in symmetric surroundings): generally lower confinement and lower loss (in real metals).</li>
        <li><b>Anti-symmetric</b> branch (often called <b>short-range SPP</b>): higher confinement and larger β.</li>
      </ul>
    </article>

    <div class="grid2">
      <article class="callout">
        <div class="label">Key laws / validity</div>
        <ul>
          <li>Use <b>Maxwell’s equations</b> in linear, homogeneous layers (each region has constant <code>ε</code>).</li>
          <li>Assume <b>time-harmonic</b> dependence <code>e^{-iωt}</code> and propagation <code>e^{iβx}</code>.</li>
          <li>Bound modes require <code>β &gt; k0√ε2</code> so fields decay in the outer dielectric.</li>
          <li>Lossless Drude here ignores damping; real silver has loss, which would make <code>β</code> complex.</li>
        </ul>
      </article>

      <article class="callout warn">
        <div class="label">What to watch for (pitfalls)</div>
        <ul>
          <li><b>Wrong κ definitions:</b> For bound modes, use <code>κ = √(β² − ε k0²)</code> (real &gt; 0 in dielectric).</li>
          <li><b>Branch confusion:</b> Symmetric vs anti-symmetric is about field parity across the mid-plane of the film.</li>
          <li><b>Not checking existence:</b> At some wavelengths or thicknesses, one branch may cease to exist as a bound solution.</li>
          <li><b>Mixing λ0 and λg:</b> Guided wavelength is along the film: <code>λg = 2π/β</code>, not the free-space wavelength.</li>
        </ul>
      </article>
    </div>

    <article>
      <h3>0.4 Mini intuition examples</h3>
      <ul>
        <li><b>Thick film limit:</b> As <code>d → ∞</code>, the two interfaces decouple and both branches approach the <b>single-interface SPP</b>.</li>
        <li><b>Thin film limit:</b> As <code>d</code> decreases, coupling increases: one branch shifts toward <b>lower β</b> (less confined) and the other to <b>higher β</b> (more confined).</li>
      </ul>
    </article>
  </section>

  <section id="part1">
    <h2>PART 1 — Problem Analysis (no solving yet)</h2>

    <article>
      <h3>1.1 Restate the problem (in plain language)</h3>
      <p>
        A silver film of thickness <b>d = 20 nm</b> is embedded in a dielectric with <b>n<sub>2</sub> = 2</b>.
        Silver is described by a lossless Drude permittivity with plasma frequency corresponding to
        <b>λ<sub>p</sub> = 138 nm</b>. We must:
      </p>
      <ul>
        <li>Compute and plot the <b>dispersion relations</b> (β vs ω or n<sub>eff</sub> vs λ<sub>0</sub>) for the <b>symmetric</b> and <b>anti-symmetric</b> guided SPP modes of the film.</li>
        <li>At <b>λ<sub>0</sub> = 400 nm</b>, determine for the <b>symmetric mode</b>:
          <b>velocity</b> (phase and group),
          <b>propagation wavelength</b> (guided wavelength),
          and <b>penetration depths</b> in metal and dielectric.
        </li>
        <li>Compare these properties to a <b>single-interface</b> SPP between silver and the same dielectric.</li>
      </ul>
    </article>

    <div class="grid2">
      <article>
        <h3>1.2 Given quantities</h3>
        <ul>
          <li>Film thickness: <code>d = 20 nm</code></li>
          <li>Host refractive index: <code>n2 = 2</code> → <code>ε2/ε0 = n2^2 = 4</code></li>
          <li>Plasma wavelength: <code>λp = 138 nm</code> → <code>ωp = 2πc/λp</code></li>
          <li>Evaluation wavelength: <code>λ0 = 400 nm</code></li>
          <li>Model: lossless Drude: <code>εm(ω)/ε0 = 1 − (ωp/ω)^2</code></li>
        </ul>
      </article>

      <article>
        <h3>1.3 Unknowns / outputs</h3>
        <ul>
          <li>Dispersion: <code>β(ω)</code> or <code>n_eff(λ0)</code> for symmetric & anti-symmetric modes.</li>
          <li>At <code>λ0=400 nm</code> (symmetric mode): <code>v_p</code>, <code>v_g</code>, <code>λg</code>, <code>δ2</code>, <code>δm</code>.</li>
          <li>Same set for single-interface SPP for comparison.</li>
        </ul>
      </article>
    </div>

    <article>
      <h3>1.4 Which principles apply (and why)?</h3>
      <ul>
        <li><b>Layered-medium Maxwell boundary conditions</b> apply because the structure is planar, piecewise homogeneous, and linear.</li>
        <li><b>TM-mode assumption</b> applies because SPPs require an electric field component normal to the interface (TE modes do not bind to a metal-dielectric interface in the usual way).</li>
        <li><b>Drude model</b> applies because the problem specifies it, giving a simple frequency-dependent ε<sub>m</sub>.</li>
        <li>We do <b>not</b> use ray optics or scalar waveguide approximations because plasmonic confinement depends on vector boundary conditions and dispersive ε(ω).</li>
      </ul>
    </article>

    <article class="callout">
      <div class="label">Assumptions (explicit)</div>
      <ul>
        <li>Planar, infinite film; uniform along propagation direction; no roughness.</li>
        <li>Lossless Drude (no damping), so <code>εm</code> is real and <code>β</code> is real for bound modes.</li>
        <li>Non-magnetic media: <code>μ = μ0</code> everywhere.</li>
        <li>Symmetric cladding: same dielectric on both sides → clean “symmetric/anti-symmetric” classification.</li>
      </ul>
    </article>

    <article>
      <h3>1.5 Possible approaches (compare, then choose)</h3>
      <ul>
        <li><b>Approach A: Full boundary-condition derivation (analytic transcendental equations)</b><br/>
          Pros: Clear physics & exact (within assumptions). Cons: Requires numerical root-finding for β(ω).</li>
        <li><b>Approach B: Coupled-mode / thin-film approximations</b><br/>
          Pros: Gives intuition and closed-form trends for very thin or very thick films. Cons: Less accurate across full wavelength range; still need numeric evaluation for plots.</li>
        <li><b>Approach C: Direct numerical eigenmode solver</b> (FEM/FDTD)<br/>
          Pros: Handles loss, asymmetry, complex geometries. Cons: Not allowed here (and overkill); also external tools.</li>
      </ul>
      <p>
        <b>We choose Approach A</b>: derive the standard film-SPP dispersion equations and solve them numerically for plots and properties.
        This matches the problem’s intent (“calculate and plot dispersion relation”).
      </p>
    </article>
  </section>

  <section id="part2">
    <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

    <ol>
      <li>
        <b>Convert material model into usable form.</b><br/>
        Tool: Drude relation; use <code>ωp=2πc/λp</code> and <code>ω=2πc/λ0</code> to compute <code>εm(λ0)</code>.<br/>
        Meaning: tells you whether the metal is “plasmonic” (negative ε).
      </li>
      <li>
        <b>Write TM field forms in each region.</b><br/>
        Tool: bound-wave ansatz <code>~e^{iβx} e^{-κ|z|}</code> in dielectric and hyperbolic functions inside the film.<br/>
        Meaning: ensures confinement.
      </li>
      <li>
        <b>Define transverse decay constants.</b><br/>
        Tool: dispersion in each homogeneous medium: <code>κ = √(β² − ε k0²)</code> for evanescent decay.<br/>
        Meaning: directly gives penetration depths.
      </li>
      <li>
        <b>Apply boundary conditions at the two interfaces.</b><br/>
        Tool: continuity of tangential <code>E_x</code> and <code>H_y</code> (TM).<br/>
        Meaning: produces two transcendental equations for symmetric/anti-symmetric parity.
      </li>
      <li>
        <b>Numerically solve for β (or n_eff) vs wavelength.</b><br/>
        Tool: bracket roots + bisection (robust).<br/>
        Meaning: yields the dispersion curves for plotting.
      </li>
      <li>
        <b>Evaluate at λ0=400 nm (symmetric mode).</b><br/>
        Tool: compute <code>n_eff</code>, then <code>v_p=c/n_eff</code>, <code>λg=λ0/n_eff</code>, <code>δ=1/κ</code>.<br/>
        Meaning: connects dispersion to measurable propagation/confinement.
      </li>
      <li>
        <b>Compute single-interface SPP for comparison.</b><br/>
        Tool: <code>β_spp = k0 √(εm ε2/(εm+ε2))</code>.<br/>
        Meaning: baseline: what changes when you have two interfaces.
      </li>
      <li>
        <b>Estimate group velocity.</b><br/>
        Tool: numerical slope <code>v_g ≈ Δω/Δβ</code> near 400 nm (lossless).<br/>
        Meaning: pulse transport speed; highlights dispersion strength.
      </li>
    </ol>

    <div class="grid2">
      <article class="callout warn">
        <div class="label">Common mistakes</div>
        <ul>
          <li>Using <code>√(ε k0² − β²)</code> (wrong sign) for evanescent decay in the dielectric.</li>
          <li>Forgetting that <code>εm</code> is frequency-dependent, so <code>β</code> changes with λ0 even if geometry is fixed.</li>
          <li>Confusing “symmetric mode” of a film with “single-interface mode” — they only match in the thick-film limit.</li>
        </ul>
      </article>
      <article class="callout ok">
        <div class="label">Quick tips</div>
        <ul>
          <li>Work in <code>n_eff = β/k0</code> to avoid huge numbers and improve numerical stability.</li>
          <li>Bound modes must satisfy <code>n_eff &gt; n2</code> (since <code>β &gt; k0 n2</code>).</li>
          <li>Use bisection for the transcendental equations: it’s slower than Newton’s method, but very robust.</li>
        </ul>
      </article>
    </div>
  </section>

  <section id="part3">
    <h2>PART 3 — Full Solution (DETAILED + TEACHING)</h2>

    <article>
      <h3>3.1 Qualitative expectation (before calculating)</h3>
      <ul>
        <li>Because the cladding is the same on both sides, modes split into <b>symmetric</b> and <b>anti-symmetric</b> parity across the film center.</li>
        <li>As the film gets thinner, the two interfaces couple more strongly:
          one mode becomes <b>less confined</b> (lower <code>n_eff</code> close to <code>n2</code>), while the other becomes <b>more confined</b> (higher <code>n_eff</code>).</li>
        <li>At <code>λ0 = 400 nm</code>, the Drude model gives <code>εm/ε0 = 1 − (λ0/λp)^2</code>, which is negative, so SPP-type bound modes should exist.</li>
      </ul>
    </article>

    <article>
      <h3>3.2 Material model: Drude permittivity in wavelength form</h3>
      <p>
        The problem states (lossless Drude):
      </p>
      <div class="eqbox">
        <button class="copyBtn" data-copy="eq-drude">Copy</button>
        <pre class="eq" id="eq-drude">εm(ω) = ε0 ( 1 − ωp^2/ω^2 )

with  ω = 2πc/λ0 ,  ωp = 2πc/λp  (given λp = 138 nm)

⇒ εm(λ0)/ε0 = 1 − (λ0/λp)^2</pre>
      </div>
      <p class="note">
        This is convenient because you can compute εm directly from wavelength without carrying ω explicitly.
      </p>
    </article>

    <article>
      <h3>3.3 Geometry and field setup (TM modes)</h3>
      <p>
        Take propagation along <code>x</code> and transverse coordinate <code>z</code>.
        The metal film occupies <code>|z| &lt; d/2</code> with permittivity <code>εm</code>.
        The dielectric occupies <code>|z| &gt; d/2</code> with <code>ε2 = n2^2 ε0</code>.
      </p>
      <p>
        For a TM mode, the nonzero components can be taken as <code>(H_y, E_x, E_z)</code> with
        <code>~ e^{iβx - iωt}</code>.
        Bound modes decay away from the film, so in the dielectric the dependence is
        <code>e^{-κ2(|z|-d/2)}</code>.
      </p>

      <div class="callout">
        <div class="label">Transverse decay constants</div>
        <p class="small">
          In each homogeneous region, Maxwell’s equations give the local dispersion:
          <code>β^2 + k_z^2 = ε_r k0^2</code>.
          For evanescent decay, set <code>k_z = iκ</code> with <code>κ&gt;0</code>, giving:
        </p>
        <div class="eqbox" style="margin-top:10px;">
          <button class="copyBtn" data-copy="eq-kappa">Copy</button>
          <pre class="eq" id="eq-kappa">k0 = ω/c

κ2 = √( β^2 − ε2 k0^2 )   (dielectric, must be real for confinement)

κm = √( β^2 − εm k0^2 )   (metal film, typically real for SPP in Drude regime)

Penetration depths:  δ2 = 1/κ2 ,  δm = 1/κm</pre>
        </div>
      </div>
    </article>

    <article>
      <h3>3.4 Boundary conditions → film-SPP dispersion equations</h3>
      <p>
        At each interface (<code>z = ± d/2</code>), continuity of tangential fields must hold:
        <code>E_x</code> and <code>H_y</code> are continuous (for non-magnetic media).
        Enforcing these at both interfaces and using symmetry about <code>z=0</code>
        yields two transcendental equations for the two parities.
      </p>

      <div class="eqbox">
        <button class="copyBtn" data-copy="eq-film">Copy</button>
        <pre class="eq" id="eq-film">Define ε2 = n2^2 ε0 and k0 = 2π/λ0.
Let κ2 = √(β^2 − ε2 k0^2),   κm = √(β^2 − εm k0^2).

Then, for a symmetric dielectric environment:

(1) Symmetric mode (even across z=0):
    tanh( κm d/2 ) = − (ε2 κm) / (εm κ2)

(2) Anti-symmetric mode (odd across z=0):
    coth( κm d/2 ) = − (ε2 κm) / (εm κ2)</pre>
      </div>

      <p class="note">
        <b>Interpretation:</b> the left side is the “coupling” through the film thickness (hyperbolic functions),
        while the right side comes from the TM boundary-condition ratio involving permittivities.
        In the thick-film limit, <code>tanh(κm d/2)→1</code> and <code>coth(κm d/2)→1</code>, so both reduce to the same single-interface condition.
      </p>
    </article>

    <article>
      <h3>3.5 Single-interface SPP dispersion (comparison baseline)</h3>
      <p>
        For one metal–dielectric interface, the standard lossless TM SPP dispersion is:
      </p>
      <div class="eqbox">
        <button class="copyBtn" data-copy="eq-spp">Copy</button>
        <pre class="eq" id="eq-spp">Single-interface SPP:
β_spp = k0 √( εm ε2 / (εm + ε2) )

Effective index:
n_eff,spp = β_spp/k0 = √( εm ε2 / (εm + ε2) )</pre>
      </div>
    </article>

    <article>
      <h3>3.6 Properties extracted from β(ω)</h3>
      <p>
        Once a mode solution gives <code>β</code> (or <code>n_eff</code>), we compute:
      </p>
      <div class="eqbox">
        <button class="copyBtn" data-copy="eq-props">Copy</button>
        <pre class="eq" id="eq-props">n_eff = β/k0

Phase velocity:    v_p = ω/β = c / n_eff
Guided wavelength: λ_g = 2π/β = λ0 / n_eff

Penetration depths (lossless): 
δ2 = 1/κ2,  κ2 = k0 √(n_eff^2 − ε2/ε0)
δm = 1/κm,  κm = k0 √(n_eff^2 − εm/ε0)

Group velocity (numerical near a chosen point):
v_g = dω/dβ  (lossless ⇒ often interpreted as energy-transport speed)</pre>
      </div>
    </article>

    <article class="callout ok">
      <div class="label">Sanity checks you should always do</div>
      <ul>
        <li><b>Units:</b> β, κ are [1/m]; δ is [m]; velocities are [m/s].</li>
        <li><b>Bound-mode condition:</b> <code>β &gt; k0 n2</code> ⇒ <code>n_eff &gt; n2</code>.</li>
        <li><b>Limits:</b> As <code>d</code> increases, symmetric and anti-symmetric curves should approach the single-interface SPP curve.</li>
      </ul>
    </article>

    <article>
      <h3>3.7 Numerical results (computed live below)</h3>
      <p>
        The plots and the “Final Answer” panel are computed <b>inside this page</b> using the equations above.
        By default, the page uses the problem’s values (<code>d=20 nm</code>, <code>n2=2</code>, <code>λp=138 nm</code>) and evaluates at <code>λ0=400 nm</code>.
        You can change thickness with the slider to see how coupling alters dispersion and confinement.
      </p>

      <div class="callout" style="margin-top:12px;">
        <div class="label">Final Answer (numbers at λ0 = 400 nm)</div>
        <div class="eqbox" style="margin-top:10px;">
          <button class="copyBtn" data-copy="final-answer">Copy</button>
          <pre class="eq" id="final-answer">Loading…</pre>
        </div>
        <p class="note">Values shown include the symmetric film mode and the single-interface SPP for comparison.</p>
      </div>
    </article>
  </section>

  <section id="part4">
    <h2>PART 4 — Deeper Understanding (THEORY AROUND THE RESULT)</h2>

    <article>
      <h3>4.1 Re-interpreting the film dispersion equations</h3>
      <p>
        The film equations
        <code>tanh(κm d/2)</code> (symmetric) and <code>coth(κm d/2)</code> (anti-symmetric)
        encode how strongly the two interfaces talk to each other:
      </p>
      <ul>
        <li><b>Large d:</b> <code>κm d/2</code> is large → <code>tanh→1</code>, <code>coth→1</code> → both branches ≈ single-interface SPP.</li>
        <li><b>Small d:</b> hyperbolic functions depart from 1 → one branch shifts to smaller β (less confined), the other to larger β (more confined).</li>
      </ul>
      <p>
        The right-hand side
        <code>−(ε2 κm)/(εm κ2)</code> comes from the TM boundary condition that relates the normal field component
        to permittivity: the “price” of putting field in the metal depends strongly on <code>εm(ω)</code>.
      </p>
    </article>

    <div class="grid2">
      <article>
        <h3>4.2 How parameters affect outcomes (connect to plots)</h3>
        <ul>
          <li><b>Decrease thickness d:</b> coupling increases → symmetric branch tends to move toward <code>n_eff ≈ n2</code> (long-range), anti-symmetric tends to larger <code>n_eff</code> (short-range).</li>
          <li><b>Change wavelength λ0:</b> Drude metal becomes “more negative” at longer λ0 (since <code>εm/ε0 = 1 − (λ0/λp)^2</code> decreases), typically increasing SPP confinement (larger <code>n_eff</code>) until approaching resonance conditions.</li>
          <li><b>Higher n2:</b> raises the light line <code>β = k0 n2</code> and tends to increase confinement and effective index for SPPs.</li>
        </ul>
      </article>

      <article>
        <h3>4.3 Alternative derivation idea (brief)</h3>
        <p>
          An alternate route is to start from the <b>single-interface SPP fields</b> and treat the second interface as a perturbation,
          leading to a <b>coupled-mode splitting</b> picture where the symmetric/anti-symmetric propagation constants are
          approximately <code>β0 ± Δβ</code> with <code>Δβ</code> set by overlap through the metal. This gives good intuition for thin films
          but the full boundary-condition method used here is more generally accurate.
        </p>
      </article>
    </div>

    <article class="callout warn">
      <div class="label">Concept checks (self-test)</div>
      <ul>
        <li><b>Q:</b> Why do SPPs require TM polarization?<br/>
            <b>A:</b> The bound mode needs an electric field normal to the interface to couple to charge motion in the metal; TE waves do not satisfy the needed boundary-condition structure for a bound plasmonic mode in this setting.</li>
        <li><b>Q:</b> What does <code>n_eff &gt; n2</code> physically mean?<br/>
            <b>A:</b> The guided wave has a larger in-plane wavevector than a plane wave in the dielectric, so it cannot radiate; it must decay evanescently away from the interface.</li>
        <li><b>Q:</b> In the thick-film limit, why do the two branches merge?<br/>
            <b>A:</b> The two interfaces decouple because fields die off inside the metal over ~<code>1/κm</code>, so each interface supports an independent single-interface SPP.</li>
        <li><b>Q:</b> If we added metal loss (complex εm), what changes most directly?<br/>
            <b>A:</b> β becomes complex; the imaginary part sets propagation length. Dispersion curves still exist but now include attenuation.</li>
      </ul>
    </article>
  </section>

  <section id="part5">
    <h2>PART 5 — Visualization Guide (HOW TO READ THE PLOTS)</h2>

    <article>
      <h3>5.1 What each canvas shows</h3>
      <ul>
        <li><b>Diagram:</b> cross-section of the dielectric–metal–dielectric stack, showing thickness <code>d</code>, propagation <code>β</code>, and qualitative evanescent decay lengths <code>δ2</code>, <code>δm</code>.</li>
        <li><b>Main plot:</b> dispersion as <b>effective index</b> <code>n_eff(λ0)</code> for symmetric and anti-symmetric film modes, plus the single-interface SPP curve.</li>
        <li><b>Secondary plot:</b> <b>penetration depths</b> <code>δ2</code> (dielectric) and <code>δm</code> (metal) versus <code>λ0</code>, for the selected mode (and optionally the single-interface baseline).</li>
      </ul>
    </article>

    <article>
      <h3>5.2 Interactive control</h3>
      <ul>
        <li>The <b>thickness slider</b> changes <code>d</code> in nanometers. This changes the coupling between interfaces, so:
          <ul>
            <li>Main plot: the splitting between symmetric/anti-symmetric branches changes.</li>
            <li>Secondary plot: confinement changes, so penetration depths shift.</li>
            <li>Final-answer panel: numeric values at <code>λ0=400 nm</code> update live.</li>
          </ul>
        </li>
        <li>The <b>mode selector</b> chooses which film branch is used for the secondary plot and the “at 400 nm” evaluation.</li>
      </ul>
    </article>

    <article class="callout">
      <div class="label">Mapping between text symbols and plot labels</div>
      <ul>
        <li>Plot uses <code>n_eff = β/k0</code> (dimensionless).</li>
        <li>Penetration depths use <code>δ2 = 1/κ2</code>, <code>δm = 1/κm</code> (shown in nm).</li>
        <li>Wavelength axis is <code>λ0</code> in nm.</li>
      </ul>
    </article>
  </section>

  <section id="viz">
    <h2>Interactive Visualizations</h2>

    <figure class="viz" aria-label="Interactive plasmonic slab waveguide visualization">
      <div class="vizHeader">
        <div>
          <div style="font-weight:700; color:#dbeafe; letter-spacing:.2px;">Live solver (lossless Drude)</div>
          <div class="small">Defaults: d = 20 nm, n2 = 2, λp = 138 nm, evaluation at λ0 = 400 nm.</div>
        </div>

        <div class="controls" role="group" aria-label="Controls">
          <div class="control">
            <label for="dSlider">Film thickness d (nm)</label>
            <input id="dSlider" type="range" min="5" max="120" step="1" value="20" />
            <span id="dVal" class="small" style="min-width:58px; text-align:right;">20</span>
          </div>

          <div class="control">
            <label for="modeSel">Mode for “properties”</label>
            <select id="modeSel">
              <option value="sym" selected>Symmetric (tanh)</option>
              <option value="anti">Anti-symmetric (coth)</option>
            </select>
          </div>

          <div class="control">
            <button id="resetBtn" type="button">Reset</button>
          </div>
        </div>
      </div>

      <div class="kpiRow" aria-label="Key numeric readouts">
        <div class="kpi"><div class="k">εm/ε0 at 400 nm (Drude)</div><div class="v" id="kpiEps">—</div></div>
        <div class="kpi"><div class="k">Selected mode n_eff at 400 nm</div><div class="v" id="kpiNeff">—</div></div>
        <div class="kpi"><div class="k">Guided wavelength λg (nm)</div><div class="v" id="kpiLg">—</div></div>
        <div class="kpi"><div class="k">Penetration δ2 / δm (nm)</div><div class="v" id="kpiPen">—</div></div>
      </div>

      <div class="canvasGrid">
        <div class="canvasCard">
          <div class="canvasTitle">
            <h4>Diagram — Silver film in dielectric (TM SPP modes)</h4>
            <span class="small">geometry + decay lengths</span>
          </div>
          <canvas id="cDiagram"></canvas>
        </div>

        <div class="canvasCard">
          <div class="canvasTitle">
            <h4>Main plot — Dispersion (effective index n_eff vs λ0)</h4>
            <span class="small">sym / anti + single-interface</span>
          </div>
          <canvas id="cMain"></canvas>
        </div>

        <div class="canvasCard" style="grid-column:1/-1;">
          <div class="canvasTitle">
            <h4>Secondary plot — Penetration depths δ2 and δm vs λ0</h4>
            <span class="small">uses selected mode</span>
          </div>
          <canvas id="cSecond" style="height:360px;"></canvas>
        </div>
      </div>

      <figcaption class="small" style="margin-top:8px; color:var(--muted);">
        Numerical method: bracket roots in <code>n_eff</code> and solve by bisection for each wavelength.
        Model is lossless Drude (no damping), so results show dispersion and confinement but not propagation length.
      </figcaption>
    </figure>
  </section>

</main>

<footer>
  <div>
    Built as a self-contained learning article (vanilla HTML/CSS/JS). Equations are displayed in plain text for easy copying.
  </div>
</footer>

<script>
/* =========================
   Utility: Copy buttons
========================= */
(function(){
  function copyText(txt){
    if(!navigator.clipboard){
      // Fallback
      const ta=document.createElement('textarea');
      ta.value=txt; document.body.appendChild(ta);
      ta.select(); try{document.execCommand('copy')}catch(e){}
      document.body.removeChild(ta);
      return;
    }
    navigator.clipboard.writeText(txt);
  }
  document.addEventListener('click', (e)=>{
    const b=e.target.closest('.copyBtn');
    if(!b) return;
    const id=b.getAttribute('data-copy');
    const el=document.getElementById(id);
    if(!el) return;
    copyText(el.textContent.trim());
    const old=b.textContent;
    b.textContent="Copied";
    setTimeout(()=>b.textContent=old, 900);
  });
})();

/* =========================
   Physics + Numerics
========================= */
const C = 299792458;                 // m/s
const n2 = 2.0;
const eps2r = n2*n2;                 // ε2/ε0
const lambdaP_nm = 138.0;            // nm
const evalLambda_nm = 400.0;         // nm

function epsMetal_r(lambda_nm){
  // lossless Drude: εm/ε0 = 1 - (ωp/ω)^2 = 1 - (λ/λp)^2
  const r = lambda_nm / lambdaP_nm;
  return 1.0 - r*r;
}

function k0(lambda_nm){
  const lambda_m = lambda_nm * 1e-9;
  return 2*Math.PI / lambda_m;
}

function omega(lambda_nm){
  const lambda_m = lambda_nm * 1e-9;
  return 2*Math.PI * C / lambda_m;
}

function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

function isFiniteNumber(x){ return Number.isFinite(x) && !Number.isNaN(x); }

/* Film dispersion functions in terms of n_eff.
   κ2 = k0 * sqrt(n_eff^2 - eps2r)
   κm = k0 * sqrt(n_eff^2 - epsmr)
   symmetric: tanh(κm d/2) + (ε2 κm)/(εm κ2) = 0
   anti:      coth(κm d/2) + (ε2 κm)/(εm κ2) = 0  (coth = 1/tanh)
*/
function fSym(neff, lambda_nm, d_nm){
  const epsmr = epsMetal_r(lambda_nm);
  const kk0 = k0(lambda_nm);
  const d_m = d_nm * 1e-9;

  const a = neff*neff - eps2r;
  const b = neff*neff - epsmr;

  if(a <= 0 || b <= 0) return NaN; // needs evanescent in dielectric and real κm for our branch
  const k2 = kk0 * Math.sqrt(a);
  const km = kk0 * Math.sqrt(b);

  const lhs = Math.tanh(km * d_m / 2);
  const rhs = (eps2r * km) / (epsmr * k2); // note: epsmr is negative in plasmonic region
  return lhs + rhs;
}

function fAnti(neff, lambda_nm, d_nm){
  const epsmr = epsMetal_r(lambda_nm);
  const kk0 = k0(lambda_nm);
  const d_m = d_nm * 1e-9;

  const a = neff*neff - eps2r;
  const b = neff*neff - epsmr;

  if(a <= 0 || b <= 0) return NaN;
  const k2 = kk0 * Math.sqrt(a);
  const km = kk0 * Math.sqrt(b);

  const t = Math.tanh(km * d_m / 2);
  if(Math.abs(t) < 1e-12) return NaN;
  const lhs = 1 / t; // coth
  const rhs = (eps2r * km) / (epsmr * k2);
  return lhs + rhs;
}

function findRootBisection(func, lambda_nm, d_nm, x1, x2){
  let f1 = func(x1, lambda_nm, d_nm);
  let f2 = func(x2, lambda_nm, d_nm);
  if(!isFiniteNumber(f1) || !isFiniteNumber(f2)) return null;
  if(f1 === 0) return x1;
  if(f2 === 0) return x2;
  if(f1*f2 > 0) return null;

  let a=x1, b=x2;
  for(let i=0;i<70;i++){
    const m = 0.5*(a+b);
    const fm = func(m, lambda_nm, d_nm);
    if(!isFiniteNumber(fm)) return null;
    if(Math.abs(fm) < 1e-10) return m;
    if(f1*fm <= 0){
      b=m; f2=fm;
    }else{
      a=m; f1=fm;
    }
  }
  return 0.5*(a+b);
}

function solveNeffForLambda(lambda_nm, d_nm, mode){
  const func = (mode==="sym") ? fSym : fAnti;

  // scan neff above n2
  const neffMin = Math.sqrt(eps2r) + 1e-4; // just above light line
  const neffMax = 20.0;                    // generous cap for plasmonic confinement
  const N = 2200;
  let prevX = neffMin;
  let prevF = func(prevX, lambda_nm, d_nm);

  let best = null;
  for(let i=1;i<=N;i++){
    const x = neffMin + (neffMax-neffMin)*i/N;
    const fx = func(x, lambda_nm, d_nm);
    if(isFiniteNumber(prevF) && isFiniteNumber(fx) && prevF*fx <= 0){
      // bracket found
      const root = findRootBisection(func, lambda_nm, d_nm, prevX, x);
      if(root !== null){
        // choose first root encountered (works well for these branches)
        best = root;
        break;
      }
    }
    prevX = x; prevF = fx;
  }
  return best; // may be null if no bound root
}

function neffSingleInterface(lambda_nm){
  const epsmr = epsMetal_r(lambda_nm);
  const val = (epsmr * eps2r) / (epsmr + eps2r);
  if(val <= 0) return null; // for lossless, bound SPP requires positive effective-index squared
  return Math.sqrt(val);
}

function modeProps(lambda_nm, d_nm, neff){
  const kk0 = k0(lambda_nm);
  const epsmr = epsMetal_r(lambda_nm);

  const kappa2 = kk0 * Math.sqrt(neff*neff - eps2r);
  const kappam = kk0 * Math.sqrt(neff*neff - epsmr);

  const delta2 = 1 / kappa2;
  const deltam = 1 / kappam;

  const vp = C / neff;
  const lg = (lambda_nm*1e-9) / neff;

  return { epsmr, kappa2, kappam, delta2, deltam, vp, lg };
}

function groupVelocityNumerical(lambda_nm, d_nm, mode){
  // central difference in ω(λ) vs β(λ) near lambda_nm
  const h = 2.0; // nm step
  const l1 = lambda_nm - h;
  const l2 = lambda_nm + h;

  const n1 = solveNeffForLambda(l1, d_nm, mode);
  const n2v = solveNeffForLambda(l2, d_nm, mode);
  if(n1===null || n2v===null) return null;

  const b1 = k0(l1) * n1;
  const b2 = k0(l2) * n2v;
  const w1 = omega(l1);
  const w2 = omega(l2);
  const dBeta = (b2 - b1);
  if(Math.abs(dBeta) < 1e-20) return null;
  const vg = (w2 - w1) / dBeta;
  return vg;
}

/* =========================
   Plotting helpers (Canvas)
========================= */
function setupCanvas(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(2, Math.floor(rect.width * dpr));
  const h = Math.max(2, Math.floor(rect.height * dpr));
  if(canvas.width !== w || canvas.height !== h){
    canvas.width = w; canvas.height = h;
  }
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {ctx, w: rect.width, h: rect.height, dpr};
}

function fmt(x, digits=3){
  if(!isFiniteNumber(x)) return "—";
  const ax = Math.abs(x);
  if(ax !== 0 && (ax < 1e-3 || ax > 1e4)) return x.toExponential(2);
  return x.toFixed(digits);
}

function drawAxes(ctx, W, H, pad, xMin, xMax, yMin, yMax, xLabel, yLabel, title){
  // background
  ctx.clearRect(0,0,W,H);
  // title
  ctx.save();
  ctx.fillStyle = "rgba(219,234,254,.95)";
  ctx.font = "600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(title, pad.left, pad.top-10);
  ctx.restore();

  // plot frame
  const x0=pad.left, y0=pad.top, x1=W-pad.right, y1=H-pad.bottom;
  ctx.save();
  ctx.strokeStyle="rgba(255,255,255,.10)";
  ctx.lineWidth=1;
  ctx.strokeRect(x0,y0,x1-x0,y1-y0);
  ctx.restore();

  // grid + ticks
  const nTicks = 6;
  ctx.save();
  ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillStyle = "rgba(167,176,192,.90)";
  ctx.strokeStyle = "rgba(255,255,255,.07)";
  ctx.lineWidth = 1;

  function tx(x){ return x0 + (x-xMin)*(x1-x0)/(xMax-xMin); }
  function ty(y){ return y1 - (y-yMin)*(y1-y0)/(yMax-yMin); }

  for(let i=0;i<=nTicks;i++){
    const gx = xMin + (xMax-xMin)*i/nTicks;
    const px = tx(gx);
    ctx.beginPath();
    ctx.moveTo(px,y0); ctx.lineTo(px,y1);
    ctx.stroke();
    // tick label
    const t = (xMax-xMin)>=50 ? gx.toFixed(0) : gx.toFixed(2);
    ctx.fillText(t, px-10, y1+18);
  }

  for(let j=0;j<=nTicks;j++){
    const gy = yMin + (yMax-yMin)*j/nTicks;
    const py = ty(gy);
    ctx.beginPath();
    ctx.moveTo(x0,py); ctx.lineTo(x1,py);
    ctx.stroke();
    const t = (Math.abs(yMax-yMin)>=5 ? gy.toFixed(2) : gy.toFixed(3));
    ctx.fillText(t, x0-48, py+4);
  }

  // labels
  ctx.save();
  ctx.fillStyle="rgba(229,231,235,.95)";
  ctx.font="600 12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(xLabel, (x0+x1)/2 - ctx.measureText(xLabel).width/2, H-10);
  ctx.translate(14, (y0+y1)/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
  ctx.restore();

  ctx.restore();
  return {tx, ty, x0, y0, x1, y1};
}

function drawLine(ctx, pts, color, width=2){
  if(pts.length<2) return;
  ctx.save();
  ctx.strokeStyle=color;
  ctx.lineWidth=width;
  ctx.lineJoin="round";
  ctx.lineCap="round";
  ctx.beginPath();
  ctx.moveTo(pts[0].x, pts[0].y);
  for(let i=1;i<pts.length;i++) ctx.lineTo(pts[i].x, pts[i].y);
  ctx.stroke();
  ctx.restore();
}

function drawLegend(ctx, items, x, y){
  ctx.save();
  ctx.font="12.2px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillStyle="rgba(229,231,235,.95)";
  const lineH=18;
  let yy=y;
  for(const it of items){
    ctx.strokeStyle=it.color;
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.moveTo(x,yy-4); ctx.lineTo(x+18,yy-4); ctx.stroke();
    ctx.fillText(it.label, x+24, yy);
    yy += lineH;
  }
  ctx.restore();
}

/* =========================
   Application state
========================= */
const state = {
  d_nm: 20,
  mode: "sym",
  lambdaMin: 220,
  lambdaMax: 900,
  nPts: 180
};

const elD = document.getElementById('dSlider');
const elDVal = document.getElementById('dVal');
const elMode = document.getElementById('modeSel');
const elReset = document.getElementById('resetBtn');

const kpiEps = document.getElementById('kpiEps');
const kpiNeff = document.getElementById('kpiNeff');
const kpiLg = document.getElementById('kpiLg');
const kpiPen = document.getElementById('kpiPen');

const finalEl = document.getElementById('final-answer');

const cDiagram = document.getElementById('cDiagram');
const cMain = document.getElementById('cMain');
const cSecond = document.getElementById('cSecond');

function computeCurves(){
  const Lmin = state.lambdaMin;
  const Lmax = state.lambdaMax;
  const N = state.nPts;

  const lambdas = [];
  const sym = [];
  const anti = [];
  const single = [];
  const symPen = []; // {δ2, δm}
  const antiPen = [];
  const singlePen = [];

  for(let i=0;i<N;i++){
    const L = Lmin + (Lmax-Lmin)*i/(N-1);
    lambdas.push(L);

    const ns = solveNeffForLambda(L, state.d_nm, "sym");
    const na = solveNeffForLambda(L, state.d_nm, "anti");
    const ni = neffSingleInterface(L);

    sym.push(ns);
    anti.push(na);
    single.push(ni);

    if(ns!==null){
      const p = modeProps(L, state.d_nm, ns);
      symPen.push({d2: p.delta2*1e9, dm: p.deltam*1e9});
    }else symPen.push(null);

    if(na!==null){
      const p = modeProps(L, state.d_nm, na);
      antiPen.push({d2: p.delta2*1e9, dm: p.deltam*1e9});
    }else antiPen.push(null);

    if(ni!==null){
      const p = modeProps(L, state.d_nm, ni);
      singlePen.push({d2: p.delta2*1e9, dm: p.deltam*1e9});
    }else singlePen.push(null);
  }

  return {lambdas, sym, anti, single, symPen, antiPen, singlePen};
}

function updateFinalNumbers(){
  const epsmr = epsMetal_r(evalLambda_nm);
  kpiEps.textContent = fmt(epsmr, 3);

  const neffFilm = solveNeffForLambda(evalLambda_nm, state.d_nm, state.mode);
  const neffSpp = neffSingleInterface(evalLambda_nm);

  // Compute props
  let filmProps = null;
  if(neffFilm!==null) filmProps = modeProps(evalLambda_nm, state.d_nm, neffFilm);

  let sppProps = null;
  if(neffSpp!==null) sppProps = modeProps(evalLambda_nm, state.d_nm, neffSpp);

  const vgFilm = (neffFilm!==null) ? groupVelocityNumerical(evalLambda_nm, state.d_nm, state.mode) : null;
  const vgSpp = (neffSpp!==null) ? (function(){
    // numerical vg for single-interface using neff(L) formula
    const h=2.0;
    const l1=evalLambda_nm-h, l2=evalLambda_nm+h;
    const n1=neffSingleInterface(l1), n2v=neffSingleInterface(l2);
    if(n1===null || n2v===null) return null;
    const b1=k0(l1)*n1, b2=k0(l2)*n2v;
    const w1=omega(l1), w2=omega(l2);
    if(Math.abs(b2-b1)<1e-20) return null;
    return (w2-w1)/(b2-b1);
  })() : null;

  // KPI summary
  if(filmProps){
    kpiNeff.textContent = fmt(neffFilm, 4);
    kpiLg.textContent = fmt(filmProps.lg*1e9, 2);
    kpiPen.textContent = `${fmt(filmProps.delta2*1e9,2)} / ${fmt(filmProps.deltam*1e9,2)}`;
  }else{
    kpiNeff.textContent = "—";
    kpiLg.textContent = "—";
    kpiPen.textContent = "—";
  }

  // Build final answer text (plain, copyable)
  const modeName = (state.mode==="sym") ? "Symmetric film mode (tanh)" : "Anti-symmetric film mode (coth)";
  const lines = [];
  lines.push(`Given: d = ${state.d_nm.toFixed(0)} nm, n2 = 2 (ε2/ε0 = 4), λp = 138 nm, evaluated at λ0 = 400 nm`);
  lines.push(`Drude metal: εm/ε0 = 1 − (λ0/λp)^2 = ${fmt(epsmr,4)}`);
  lines.push(``);
  lines.push(`[A] Metal film in dielectric — ${modeName}`);
  if(neffFilm===null){
    lines.push(`No bound real solution found at λ0=400 nm for this thickness/mode (in the lossless model).`);
  }else{
    const vp = filmProps.vp;
    const lg = filmProps.lg;
    const delta2 = filmProps.delta2;
    const deltam = filmProps.deltam;
    lines.push(`Effective index: n_eff = β/k0 = ${fmt(neffFilm,5)}`);
    lines.push(`Phase velocity: v_p = c/n_eff = ${fmt(vp/1e8,4)}×10^8 m/s  (= ${fmt(vp/C,4)} c)`);
    if(vgFilm!==null){
      lines.push(`Group velocity: v_g ≈ dω/dβ = ${fmt(vgFilm/1e8,4)}×10^8 m/s  (= ${fmt(vgFilm/C,4)} c)`);
    }else{
      lines.push(`Group velocity: v_g ≈ dω/dβ = — (numerical estimate unavailable)`);
    }
    lines.push(`Guided wavelength: λ_g = λ0/n_eff = ${fmt(lg*1e9,3)} nm`);
    lines.push(`Penetration depth in dielectric: δ2 = 1/κ2 = ${fmt(delta2*1e9,3)} nm`);
    lines.push(`Penetration depth in metal:      δm = 1/κm = ${fmt(deltam*1e9,3)} nm`);
  }

  lines.push(``);
  lines.push(`[B] Single-interface SPP (silver | same dielectric)`);
  if(neffSpp===null){
    lines.push(`No bound real single-interface SPP (lossless) at λ0=400 nm for these parameters.`);
  }else{
    const vp = sppProps.vp;
    const lg = sppProps.lg;
    const delta2 = sppProps.delta2;
    const deltam = sppProps.deltam;
    lines.push(`Effective index: n_eff,spp = √(εm ε2/(εm+ε2)) = ${fmt(neffSpp,5)}`);
    lines.push(`Phase velocity: v_p,spp = c/n_eff = ${fmt(vp/1e8,4)}×10^8 m/s  (= ${fmt(vp/C,4)} c)`);
    if(vgSpp!==null){
      lines.push(`Group velocity: v_g,spp ≈ dω/dβ = ${fmt(vgSpp/1e8,4)}×10^8 m/s  (= ${fmt(vgSpp/C,4)} c)`);
    }else{
      lines.push(`Group velocity: v_g,spp ≈ dω/dβ = — (numerical estimate unavailable)`);
    }
    lines.push(`Guided wavelength: λ_g,spp = λ0/n_eff = ${fmt(lg*1e9,3)} nm`);
    lines.push(`Penetration depth in dielectric: δ2,spp = ${fmt(delta2*1e9,3)} nm`);
    lines.push(`Penetration depth in metal:      δm,spp = ${fmt(deltam*1e9,3)} nm`);
  }

  // Compare statement
  lines.push(``);
  lines.push(`Comparison note: As d increases, the film modes approach the single-interface SPP. As d decreases, coupling splits the branches: one tends toward n_eff close to n2 (long-range), while the other shifts to higher n_eff (short-range).`);

  finalEl.textContent = lines.join('\n');
}

/* =========================
   Diagram rendering
========================= */
function drawDiagram(neff, delta2_nm, deltam_nm){
  const {ctx, w:W, h:H} = setupCanvas(cDiagram);

  ctx.clearRect(0,0,W,H);

  // Title strip
  ctx.save();
  ctx.fillStyle="rgba(15,23,42,.55)";
  ctx.strokeStyle="rgba(255,255,255,.08)";
  ctx.lineWidth=1;
  ctx.beginPath();
  ctx.roundRect(10, 10, W-20, 34, 10);
  ctx.fill();
  ctx.stroke();
  ctx.fillStyle="rgba(229,231,235,.95)";
  ctx.font="600 12.5px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText("Metal film (εm) of thickness d in dielectric (ε2): propagation along x with β", 18, 32);
  ctx.restore();

  // Draw layers
  const pad=16;
  const x0=pad, x1=W-pad;
  const yTop=60, yBot=H-pad;
  const yMid=(yTop+yBot)/2;
  const filmH = Math.max(26, Math.min(80, (state.d_nm/120)*120));
  const yFilm0 = yMid - filmH/2;
  const yFilm1 = yMid + filmH/2;

  // dielectric regions
  ctx.save();
  ctx.fillStyle="rgba(96,165,250,.10)";
  ctx.strokeStyle="rgba(96,165,250,.20)";
  ctx.lineWidth=1;
  ctx.fillRect(x0, yTop, x1-x0, yFilm0-yTop);
  ctx.fillRect(x0, yFilm1, x1-x0, yBot-yFilm1);
  ctx.strokeRect(x0, yTop, x1-x0, yFilm0-yTop);
  ctx.strokeRect(x0, yFilm1, x1-x0, yBot-yFilm1);

  // film
  ctx.fillStyle="rgba(251,191,36,.12)";
  ctx.strokeStyle="rgba(251,191,36,.30)";
  ctx.fillRect(x0, yFilm0, x1-x0, yFilm1-yFilm0);
  ctx.strokeRect(x0, yFilm0, x1-x0, yFilm1-yFilm0);
  ctx.restore();

  // Labels
  ctx.save();
  ctx.fillStyle="rgba(229,231,235,.95)";
  ctx.font="600 13px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText("Dielectric (ε2)", x0+10, yTop+18);
  ctx.fillText("Silver film (εm)", x0+10, yMid+5);
  ctx.fillText("Dielectric (ε2)", x0+10, yFilm1+22);
  ctx.restore();

  // Thickness arrow
  ctx.save();
  ctx.strokeStyle="rgba(229,231,235,.70)";
  ctx.fillStyle="rgba(229,231,235,.90)";
  ctx.lineWidth=1.5;
  const ax = x1-54;
  ctx.beginPath();
  ctx.moveTo(ax, yFilm0); ctx.lineTo(ax, yFilm1);
  ctx.stroke();
  // arrowheads
  ctx.beginPath();
  ctx.moveTo(ax-6, yFilm0+8); ctx.lineTo(ax, yFilm0); ctx.lineTo(ax+6, yFilm0+8);
  ctx.moveTo(ax-6, yFilm1-8); ctx.lineTo(ax, yFilm1); ctx.lineTo(ax+6, yFilm1-8);
  ctx.stroke();
  ctx.font="600 12.5px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillText(`d = ${state.d_nm.toFixed(0)} nm`, ax-58, yMid-8);
  ctx.restore();

  // propagation arrow along x
  ctx.save();
  ctx.strokeStyle="rgba(52,211,153,.80)";
  ctx.fillStyle="rgba(52,211,153,.90)";
  ctx.lineWidth=2;
  const px0=x0+90, py0=yMid;
  const px1=x0+210, py1=yMid;
  ctx.beginPath();
  ctx.moveTo(px0,py0); ctx.lineTo(px1,py1);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(px1-10,py1-6); ctx.lineTo(px1,py1); ctx.lineTo(px1-10,py1+6);
  ctx.stroke();
  ctx.font="600 12.5px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillText("β →", px0-44, py0-10);
  ctx.restore();

  // draw decay bars indicating delta2 and deltam (if available)
  function drawDecay(yStart, direction, label, val_nm, color){
    if(!isFiniteNumber(val_nm)) return;
    const maxBar = 120;
    const scale = maxBar / 250; // 250 nm -> 120 px
    const L = clamp(val_nm*scale, 8, maxBar);
    const x = x0 + 330;
    const y = yStart;
    ctx.save();
    ctx.strokeStyle=color;
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.moveTo(x, y); ctx.lineTo(x, y + direction*L);
    ctx.stroke();
    ctx.fillStyle="rgba(229,231,235,.92)";
    ctx.font="600 12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
    ctx.fillText(`${label} ≈ ${fmt(val_nm,1)} nm`, x+10, y + direction*(L*0.55));
    ctx.restore();
  }
  drawDecay(yFilm0-6, -1, "δ2 (in dielectric)", delta2_nm, "rgba(96,165,250,.85)");
  drawDecay(yMid,  1, "δm (in metal)", deltam_nm, "rgba(251,191,36,.85)");

  // neff text
  ctx.save();
  ctx.fillStyle="rgba(229,231,235,.92)";
  ctx.font="600 12.5px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  const s = (neff===null) ? "n_eff @400nm: —" : `n_eff @400nm: ${fmt(neff,4)}`;
  ctx.fillText(s, x0+18, H-18);
  ctx.restore();
}

/* =========================
   Main plot rendering
========================= */
function drawMainPlot(curves){
  const {ctx, w:W, h:H} = setupCanvas(cMain);

  // Determine y-range from available curves
  let yMin=Infinity, yMax=-Infinity;
  for(const arr of [curves.sym, curves.anti, curves.single]){
    for(const v of arr){
      if(v!==null && isFiniteNumber(v)){
        yMin=Math.min(yMin,v);
        yMax=Math.max(yMax,v);
      }
    }
  }
  // ensure includes n2 line
  yMin = Math.min(yMin, Math.sqrt(eps2r));
  yMax = Math.max(yMax, Math.sqrt(eps2r)+0.2);
  if(!isFiniteNumber(yMin) || !isFiniteNumber(yMax) || yMin===Infinity){
    yMin=Math.sqrt(eps2r); yMax=yMin+2;
  }
  const pad = {left:58, right:14, top:44, bottom:44};
  const xMin=curves.lambdas[0], xMax=curves.lambdas[curves.lambdas.length-1];
  const yPad = 0.06*(yMax-yMin+1e-9);
  yMin -= yPad; yMax += yPad;

  const ax = drawAxes(ctx, W, H, pad, xMin, xMax, yMin, yMax, "λ0 (nm)", "n_eff = β/k0 (–)", "Dispersion (effective index vs wavelength)");

  // Create point lists
  function ptsFrom(arr){
    const pts=[];
    for(let i=0;i<curves.lambdas.length;i++){
      const L=curves.lambdas[i], v=arr[i];
      if(v!==null && isFiniteNumber(v)){
        pts.push({x: ax.tx(L), y: ax.ty(v)});
      }
    }
    return pts;
  }
  const ptsSym = ptsFrom(curves.sym);
  const ptsAnti = ptsFrom(curves.anti);
  const ptsSingle = ptsFrom(curves.single);

  // light line n2
  ctx.save();
  ctx.strokeStyle="rgba(167,176,192,.55)";
  ctx.setLineDash([5,4]);
  ctx.lineWidth=1.4;
  const yLL = ax.ty(Math.sqrt(eps2r));
  ctx.beginPath();
  ctx.moveTo(ax.x0, yLL);
  ctx.lineTo(ax.x1, yLL);
  ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle="rgba(167,176,192,.85)";
  ctx.font="12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillText("light line: n2", ax.x0+8, yLL-6);
  ctx.restore();

  // lines
  drawLine(ctx, ptsSingle, "rgba(52,211,153,.85)", 2.4);
  drawLine(ctx, ptsSym, "rgba(96,165,250,.92)", 2.6);
  drawLine(ctx, ptsAnti, "rgba(251,191,36,.90)", 2.6);

  drawLegend(ctx, [
    {label:"Film symmetric (tanh)", color:"rgba(96,165,250,.92)"},
    {label:"Film anti-symmetric (coth)", color:"rgba(251,191,36,.90)"},
    {label:"Single-interface SPP", color:"rgba(52,211,153,.85)"}
  ], ax.x0+8, ax.y0+18);
}

/* =========================
   Secondary plot rendering
========================= */
function drawSecondaryPlot(curves){
  const {ctx, w:W, h:H} = setupCanvas(cSecond);

  const pad = {left:58, right:14, top:44, bottom:44};
  const xMin=curves.lambdas[0], xMax=curves.lambdas[curves.lambdas.length-1];

  // Select penetration array
  const penArr = (state.mode==="sym") ? curves.symPen : curves.antiPen;

  // y-range from δ values (nm)
  let yMin=Infinity, yMax=-Infinity;
  function includePen(arr){
    for(const p of arr){
      if(!p) continue;
      if(isFiniteNumber(p.d2)){ yMin=Math.min(yMin,p.d2); yMax=Math.max(yMax,p.d2); }
      if(isFiniteNumber(p.dm)){ yMin=Math.min(yMin,p.dm); yMax=Math.max(yMax,p.dm); }
    }
  }
  includePen(penArr);
  includePen(curves.singlePen);

  if(!isFiniteNumber(yMin) || yMin===Infinity){ yMin=1; yMax=250; }
  // Give breathing room and clamp
  yMin = Math.max(0, yMin*0.85);
  yMax = yMax*1.15 + 1;

  const ax = drawAxes(ctx, W, H, pad, xMin, xMax, yMin, yMax, "λ0 (nm)", "Penetration depth δ (nm)", "Confinement vs wavelength");

  // Build points
  function ptsPen(which, arr){
    const pts=[];
    for(let i=0;i<curves.lambdas.length;i++){
      const L=curves.lambdas[i], p=arr[i];
      if(!p) continue;
      const v = (which==="d2") ? p.d2 : p.dm;
      if(isFiniteNumber(v)){
        pts.push({x: ax.tx(L), y: ax.ty(v)});
      }
    }
    return pts;
  }
  const ptsD2 = ptsPen("d2", penArr);
  const ptsDm = ptsPen("dm", penArr);
  const ptsD2s = ptsPen("d2", curves.singlePen);
  const ptsDms = ptsPen("dm", curves.singlePen);

  // draw
  drawLine(ctx, ptsD2, "rgba(96,165,250,.92)", 2.6);
  drawLine(ctx, ptsDm, "rgba(251,191,36,.90)", 2.6);

  // baseline (single interface) as dashed
  ctx.save();
  ctx.setLineDash([6,4]);
  drawLine(ctx, ptsD2s, "rgba(52,211,153,.80)", 2.1);
  drawLine(ctx, ptsDms, "rgba(163,230,53,.75)", 2.1);
  ctx.restore();

  const modeLabel = (state.mode==="sym") ? "film mode: symmetric" : "film mode: anti-symmetric";
  drawLegend(ctx, [
    {label:`δ2 in dielectric (${modeLabel})`, color:"rgba(96,165,250,.92)"},
    {label:`δm in metal (${modeLabel})`, color:"rgba(251,191,36,.90)"},
    {label:"δ2 single-interface (dashed)", color:"rgba(52,211,153,.80)"},
    {label:"δm single-interface (dashed)", color:"rgba(163,230,53,.75)"}
  ], ax.x0+8, ax.y0+18);

  // mark evaluation wavelength vertical line
  ctx.save();
  ctx.strokeStyle="rgba(229,231,235,.55)";
  ctx.lineWidth=1.2;
  ctx.setLineDash([4,4]);
  const xEval = ax.tx(evalLambda_nm);
  ctx.beginPath(); ctx.moveTo(xEval, ax.y0); ctx.lineTo(xEval, ax.y1); ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle="rgba(229,231,235,.85)";
  ctx.font="12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
  ctx.fillText("λ0=400 nm", xEval+6, ax.y0+14);
  ctx.restore();
}

/* =========================
   Orchestration
========================= */
let lastCurves = null;

function renderAll(){
  // compute curves
  lastCurves = computeCurves();
  updateFinalNumbers();

  // compute diagram numbers from selected mode at 400 nm
  const neffFilm = solveNeffForLambda(evalLambda_nm, state.d_nm, state.mode);
  let delta2_nm = NaN, deltam_nm = NaN;
  if(neffFilm!==null){
    const p = modeProps(evalLambda_nm, state.d_nm, neffFilm);
    delta2_nm = p.delta2*1e9;
    deltam_nm = p.deltam*1e9;
  }

  drawDiagram(neffFilm, delta2_nm, deltam_nm);
  drawMainPlot(lastCurves);
  drawSecondaryPlot(lastCurves);
}

function syncUI(){
  elD.value = String(state.d_nm);
  elDVal.textContent = `${state.d_nm.toFixed(0)}`;
  elMode.value = state.mode;
}

elD.addEventListener('input', ()=>{
  state.d_nm = parseFloat(elD.value);
  elDVal.textContent = `${state.d_nm.toFixed(0)}`;
  renderAll();
});

elMode.addEventListener('change', ()=>{
  state.mode = elMode.value;
  renderAll();
});

elReset.addEventListener('click', ()=>{
  state.d_nm = 20;
  state.mode = "sym";
  syncUI();
  renderAll();
});

window.addEventListener('resize', ()=>{
  // redraw using last curves if available; recomputing is okay but a bit heavier.
  renderAll();
});

// initial
syncUI();
renderAll();
</script>

</body>
</html>
