<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mode Cutoff in a Symmetric Slab Waveguide (TE m&gt;0): Derivation of λc² ≈ 8 n1 Δn d² / m²</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1733;
      --card2:#0c132b;
      --text:#e9ecff;
      --muted:#b7c0ff;
      --faint:rgba(233,236,255,.08);
      --line:rgba(233,236,255,.14);
      --accent:#7cf0ff;
      --accent2:#b8ff7c;
      --warn:#ffd37c;
      --good:#8bffb3;
      --bad:#ff7ca6;
      --shadow: 0 16px 40px rgba(0,0,0,.45);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(124,240,255,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(184,255,124,.12), transparent 55%),
        radial-gradient(700px 700px at 45% 95%, rgba(255,124,166,.10), transparent 55%),
        linear-gradient(180deg, #070a14, #0b1020 40%, #070a14);
      line-height:1.55;
    }

    header{
      padding: 34px 18px 18px;
      max-width: 1200px;
      margin: 0 auto;
      position:relative;
    }

    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .hero-inner{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap: 18px;
      padding: 22px 20px;
      align-items:center;
    }

    h1{
      margin:0 0 8px 0;
      font-size: clamp(1.35rem, 2.4vw, 2.05rem);
      letter-spacing: .2px;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      font-size: .98rem;
      max-width: 70ch;
    }

    .badge-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
    }
    .badge{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(124,240,255,.10);
      border:1px solid rgba(124,240,255,.28);
      color: var(--text);
      font-size: .82rem;
      white-space:nowrap;
    }
    .badge.alt{
      background: rgba(184,255,124,.10);
      border-color: rgba(184,255,124,.28);
    }
    .badge.warn{
      background: rgba(255,211,124,.10);
      border-color: rgba(255,211,124,.28);
    }

    .hero-aside{
      padding: 18px;
      background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.04));
      border-left:1px solid var(--line);
      height:100%;
    }
    .meta{
      font-size:.92rem;
      color:var(--muted);
      margin:0 0 10px 0;
    }
    .meta strong{color:var(--text)}
    .small{
      font-size:.88rem;
      color:var(--muted);
      margin:0;
    }

    main{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap: 18px;
      align-items:start;
    }

    nav.toc{
      position: sticky;
      top: 14px;
      align-self:start;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.04);
      box-shadow: 0 10px 24px rgba(0,0,0,.30);
      overflow:hidden;
    }
    .toc header{
      padding: 12px 14px;
      margin:0;
      background: rgba(255,255,255,.05);
      border-bottom:1px solid var(--line);
    }
    .toc h2{
      font-size: 1rem;
      margin:0;
      letter-spacing:.2px;
    }
    .toc .links{
      padding: 10px 10px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .toc a{
      text-decoration:none;
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      font-size:.93rem;
    }
    .toc a:hover{
      background: rgba(124,240,255,.08);
      border-color: rgba(124,240,255,.20);
      color: var(--text);
      transform: translateY(-1px);
    }

    article{
      display:flex;
      flex-direction:column;
      gap: 16px;
      min-width: 0;
    }

    section{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.035);
      box-shadow: 0 10px 26px rgba(0,0,0,.28);
      overflow:hidden;
    }
    section > .section-head{
      padding: 14px 16px;
      background: rgba(255,255,255,.05);
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 12px;
    }
    .section-head h2{
      margin:0;
      font-size: 1.06rem;
      letter-spacing:.2px;
    }
    .section-head .tag{
      font-size:.82rem;
      color:var(--muted);
      padding: 4px 10px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(0,0,0,.10);
      white-space:nowrap;
    }
    .content{
      padding: 14px 16px 16px;
      min-width:0;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 14px;
    }

    .callout{
      border-radius: 16px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      padding: 12px 12px;
    }
    .callout h3{
      margin: 0 0 6px 0;
      font-size: .98rem;
    }
    .callout p, .callout ul{
      margin: 0;
      color: var(--muted);
      font-size: .95rem;
    }
    .callout ul{padding-left: 18px; margin-top: 6px;}
    .callout.good{border-color: rgba(139,255,179,.35); background: rgba(139,255,179,.06);}
    .callout.warn{border-color: rgba(255,211,124,.35); background: rgba(255,211,124,.06);}
    .callout.bad{border-color: rgba(255,124,166,.35); background: rgba(255,124,166,.06);}
    .callout.key{border-color: rgba(124,240,255,.35); background: rgba(124,240,255,.06);}

    .eq{
      display:flex;
      align-items:stretch;
      gap:10px;
      border-radius: 16px;
      border: 1px solid rgba(124,240,255,.28);
      background: rgba(124,240,255,.06);
      overflow:hidden;
    }
    .eq pre{
      margin:0;
      padding: 12px 12px;
      font-family: var(--mono);
      font-size: .92rem;
      color: var(--text);
      white-space: pre-wrap;
      word-break: break-word;
      flex:1;
      min-width: 0;
    }
    .copybtn{
      border:none;
      background: rgba(0,0,0,.25);
      border-left: 1px solid rgba(124,240,255,.22);
      color: var(--text);
      cursor:pointer;
      padding: 10px 12px;
      font-size: .86rem;
      transition: background .15s ease, transform .15s ease;
      min-width: 92px;
    }
    .copybtn:hover{background: rgba(0,0,0,.35); transform: translateY(-1px);}
    .copybtn:active{transform: translateY(0px);}
    .copystatus{
      font-size:.82rem;
      color: var(--muted);
      margin-top: 6px;
      min-height: 1em;
    }

    figure{
      margin: 0;
      border-radius: var(--radius);
      overflow:hidden;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
    }
    figure figcaption{
      padding: 10px 12px;
      color: var(--muted);
      font-size: .9rem;
      border-top: 1px solid var(--line);
    }
    canvas{
      width:100%;
      height: 320px;
      display:block;
      background: radial-gradient(900px 420px at 20% 20%, rgba(124,240,255,.06), transparent 60%),
                  radial-gradient(700px 420px at 80% 30%, rgba(184,255,124,.05), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.10));
    }

    .viz-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    .controls{
      display:grid;
      grid-template-columns: 1.1fr 1fr 1fr;
      gap: 12px;
      align-items:end;
    }
    .ctrl{
      border: 1px solid var(--line);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
      padding: 10px 12px;
    }
    .ctrl label{
      display:block;
      font-size:.85rem;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .ctrl .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .ctrl input[type="range"]{width:100%;}
    .ctrl select{
      width:100%;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }
    .val{
      font-family: var(--mono);
      font-size: .9rem;
      color: var(--text);
      white-space:nowrap;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
    }

    .steps{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }
    .steps li{margin: 6px 0;}
    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:start;
    }

    .hr{
      height:1px;
      background: var(--line);
      margin: 12px 0;
    }

    footer{
      max-width: 1200px;
      margin: 0 auto;
      padding: 22px 18px 42px;
      color: var(--muted);
      font-size:.9rem;
    }

    .kicker{
      color: var(--muted);
      margin:0 0 6px 0;
      font-size:.92rem;
    }
    .note{
      color: var(--muted);
      font-size:.95rem;
      margin: 8px 0 0;
    }

    @media (max-width: 980px){
      main{grid-template-columns: 1fr;}
      nav.toc{position:relative; top:auto;}
      .hero-inner{grid-template-columns: 1fr;}
      .hero-aside{border-left:none; border-top:1px solid var(--line);}
      .controls{grid-template-columns: 1fr;}
      .grid2,.split{grid-template-columns:1fr;}
      canvas{height: 300px;}
    }

    @media print{
      body{background:#fff; color:#000;}
      nav.toc{display:none;}
      section, .hero{box-shadow:none;}
      section, .hero, figure, .callout, .eq{border-color:#ccc;}
      .copybtn{display:none;}
      canvas{border-top:1px solid #ccc;}
      a{color:#000; text-decoration:none;}
    }

    /* subtle entrance */
    .fade-in{
      animation: fadeInUp .35s ease both;
    }
    @keyframes fadeInUp{
      from{opacity:0; transform: translateY(6px);}
      to{opacity:1; transform: translateY(0);}
    }
  </style>
</head>

<body>
<header class="fade-in">
  <div class="hero">
    <div class="hero-inner">
      <div>
        <h1>9.2-8 — Mode Cutoff in a Symmetric Slab Waveguide (TE, m &gt; 0)</h1>
        <p class="subtitle">
          Show that for a symmetric dielectric slab waveguide with nearly equal indices (<span style="font-family:var(--mono)">n1 ≈ n2</span>),
          the cutoff wavelength for TE mode order <span style="font-family:var(--mono)">m &gt; 0</span> satisfies
          <span style="font-family:var(--mono)">λc² ≈ 8 n1 Δn d² / m²</span>, where <span style="font-family:var(--mono)">Δn = n1 − n2</span>.
        </p>
        <div class="badge-row">
          <span class="badge">Waveguides</span>
          <span class="badge alt">TE modes</span>
          <span class="badge">Cutoff</span>
          <span class="badge warn">Weak guidance (Δn ≪ n1)</span>
        </div>
      </div>
      <aside class="hero-aside">
        <p class="meta"><strong>Outcome:</strong> derive a practical cutoff formula (symbolic), and visualize how <span style="font-family:var(--mono)">d</span>, <span style="font-family:var(--mono)">Δn</span>, and <span style="font-family:var(--mono)">m</span> control guidance.</p>
        <p class="small">This page includes interactive plots: cutoff vs mode number, normalized frequency vs wavelength, and an approximate mode-count sweep.</p>
      </aside>
    </div>
  </div>
</header>

<main class="fade-in">
  <nav class="toc" aria-label="Table of contents">
    <header><h2>On this page</h2></header>
    <div class="links">
      <a href="#qs">Quick Summary</a>
      <a href="#p0">PART 0 — Concept Primer</a>
      <a href="#p1">PART 1 — Problem Analysis</a>
      <a href="#p2">PART 2 — Strategy &amp; Tips</a>
      <a href="#p3">PART 3 — Full Solution</a>
      <a href="#p4">PART 4 — Deeper Understanding</a>
      <a href="#p5">PART 5 — Visualization Guide</a>
      <a href="#viz">Interactive Visuals</a>
    </div>
  </nav>

  <article>
    <!-- Quick Summary -->
    <section id="qs">
      <div class="section-head">
        <h2>Quick Summary</h2>
        <span class="tag">what you should remember</span>
      </div>
      <div class="content">
        <ul class="steps">
          <li>This problem is about <strong>cutoff</strong>: the wavelength where a guided TE mode stops being confined and becomes radiative.</li>
          <li>Key physics idea: in a symmetric slab, TE modes behave like a <strong>transverse standing wave</strong> in the core + <strong>evanescent decay</strong> in the cladding.</li>
          <li>The governing parameter is the <strong>normalized frequency</strong> <span style="font-family:var(--mono)">V</span>, which compares core thickness to wavelength and index contrast.</li>
          <li>At cutoff, the evanescent decay constant goes to zero, so the transverse phase condition becomes a simple <strong>half-wave quantization</strong>.</li>
          <li>TE cutoff for mode order <span style="font-family:var(--mono)">m</span> occurs approximately when <span style="font-family:var(--mono)">V = mπ/2</span> (for <span style="font-family:var(--mono)">m &gt; 0</span>).</li>
          <li>Using <span style="font-family:var(--mono)">V = (2π/λ)(d/2)√(n1²−n2²)</span> gives <strong>symbolic</strong> cutoff <span style="font-family:var(--mono)">λc = (2d/m)√(n1²−n2²)</span>.</li>
          <li>Weak guidance (<span style="font-family:var(--mono)">Δn ≪ n1</span>) gives <span style="font-family:var(--mono)">n1²−n2² ≈ 2 n1 Δn</span>, so</li>
        </ul>

        <div class="eq" style="margin-top:12px;">
          <pre id="eqFinal">Cutoff (TE, m > 0) in a symmetric slab (weak guidance):
λc^2 ≈ (8 n1 Δn d^2) / m^2
where Δn = n1 − n2, and d is the core thickness.</pre>
          <button class="copybtn" data-copytarget="eqFinal">Copy</button>
        </div>
        <div class="copystatus" id="copyStatusTop"></div>
      </div>
    </section>

    <!-- PART 0 -->
    <section id="p0">
      <div class="section-head">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>
        <span class="tag">mini-textbook</span>
      </div>
      <div class="content">
        <div class="grid2">
          <div class="callout key">
            <h3>Core definitions (symbols &amp; units)</h3>
            <ul>
              <li><span style="font-family:var(--mono)">n1</span>: core refractive index (dimensionless)</li>
              <li><span style="font-family:var(--mono)">n2</span>: cladding refractive index (dimensionless), symmetric cladding above &amp; below</li>
              <li><span style="font-family:var(--mono)">Δn = n1 − n2</span>: index contrast (dimensionless)</li>
              <li><span style="font-family:var(--mono)">d</span>: core thickness (m)</li>
              <li><span style="font-family:var(--mono)">λ</span>: free-space wavelength (m), <span style="font-family:var(--mono)">k0 = 2π/λ</span> (rad/m)</li>
              <li><span style="font-family:var(--mono)">β</span>: propagation constant along the guide (rad/m)</li>
            </ul>
          </div>

          <div class="callout">
            <h3>Physical meaning of key quantities</h3>
            <ul>
              <li><span style="font-family:var(--mono)">β</span> sets the phase advance along <span style="font-family:var(--mono)">z</span>; guided modes have <span style="font-family:var(--mono)">k0 n2 &lt; β &lt; k0 n1</span>.</li>
              <li>Transverse behavior: oscillatory in the core (standing-wave-like), evanescent in cladding.</li>
              <li><strong>Cutoff</strong>: the moment a higher-order mode’s field stops decaying in the cladding; mathematically the decay constant tends to zero.</li>
            </ul>
          </div>
        </div>

        <div class="hr"></div>

        <div class="grid2">
          <div class="callout">
            <h3>Key laws/principles &amp; validity</h3>
            <ul>
              <li>Start from source-free Maxwell → Helmholtz wave equation in each uniform region.</li>
              <li>Assume monochromatic fields <span style="font-family:var(--mono)">∝ e^{i(βz−ωt)}</span>, linear isotropic dielectrics, no loss.</li>
              <li>For a slab (1D confinement), TE means the electric field is transverse to the plane of incidence (commonly <span style="font-family:var(--mono)">Ey</span> nonzero, varies with <span style="font-family:var(--mono)">x</span>).</li>
            </ul>
          </div>

          <div class="callout warn">
            <h3>Common approximations (and why)</h3>
            <ul>
              <li><strong>Weak guidance:</strong> <span style="font-family:var(--mono)">Δn ≪ n1</span> so <span style="font-family:var(--mono)">n1 ≈ n2</span>. This simplifies <span style="font-family:var(--mono)">n1²−n2²</span> to <span style="font-family:var(--mono)">≈ 2 n1 Δn</span>.</li>
              <li>At cutoff we set the cladding decay constant to zero: this turns the exact transcendental condition into a simple phase condition.</li>
              <li>Result: a compact scaling law showing how thickness and index contrast control cutoff.</li>
            </ul>
          </div>
        </div>

        <div class="hr"></div>

        <div class="split">
          <div class="callout good">
            <h3>Mini intuition examples</h3>
            <ul>
              <li><strong>Thicker core</strong> (larger <span style="font-family:var(--mono)">d</span>) supports guidance at longer wavelengths because the wave can “fit” more transverse structure.</li>
              <li><strong>Higher index contrast</strong> (larger <span style="font-family:var(--mono)">Δn</span>) increases confinement; modes survive to longer wavelengths (larger cutoff).</li>
            </ul>
          </div>
          <div class="callout bad">
            <h3>What to watch for (pitfalls)</h3>
            <ul>
              <li>Be consistent about whether <span style="font-family:var(--mono)">d</span> is full thickness or half-thickness; here we use <strong>full core thickness</strong>.</li>
              <li>Cutoff for <span style="font-family:var(--mono)">m=0</span> is special (the fundamental TE0 typically has no cutoff in an ideal symmetric slab).</li>
              <li>Don’t confuse free-space wavelength <span style="font-family:var(--mono)">λ</span> with wavelength inside the medium <span style="font-family:var(--mono)">λ/n</span>.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- PART 1 -->
    <section id="p1">
      <div class="section-head">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>
        <span class="tag">set it up cleanly</span>
      </div>
      <div class="content">
        <p class="kicker">Problem re-statement (in plain language)</p>
        <p class="note">
          We have a <strong>symmetric slab waveguide</strong>: a core of refractive index <span style="font-family:var(--mono)">n1</span> and thickness <span style="font-family:var(--mono)">d</span>,
          surrounded on both sides by cladding index <span style="font-family:var(--mono)">n2</span>. For TE modes of order <span style="font-family:var(--mono)">m &gt; 0</span>, show that when
          <span style="font-family:var(--mono)">n1 ≈ n2</span> the cutoff wavelength obeys
          <span style="font-family:var(--mono)">λc² ≈ 8 n1 Δn d² / m²</span>.
        </p>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout">
            <h3>Given</h3>
            <ul>
              <li>Symmetric slab geometry</li>
              <li>Core index <span style="font-family:var(--mono)">n1</span>, cladding index <span style="font-family:var(--mono)">n2</span></li>
              <li>Weak guidance: <span style="font-family:var(--mono)">n1 ≈ n2</span>, i.e. <span style="font-family:var(--mono)">Δn = n1 − n2</span> small</li>
              <li>TE mode order <span style="font-family:var(--mono)">m &gt; 0</span></li>
            </ul>
          </div>
          <div class="callout key">
            <h3>Unknown / To prove</h3>
            <ul>
              <li>Derive the cutoff condition and show the approximation</li>
              <li>Target form: <span style="font-family:var(--mono)">λc² ≈ 8 n1 Δn d² / m²</span></li>
            </ul>
          </div>
        </div>

        <div class="hr"></div>

        <div class="callout warn">
          <h3>Relevant principles (and why they apply)</h3>
          <ul>
            <li><strong>Helmholtz equation in each region:</strong> uniform <span style="font-family:var(--mono)">n</span> means separable solutions in <span style="font-family:var(--mono)">x</span> and <span style="font-family:var(--mono)">z</span>.</li>
            <li><strong>Boundary conditions:</strong> continuity of tangential fields at the two interfaces enforces a dispersion relation.</li>
            <li><strong>Cutoff logic:</strong> at cutoff the cladding field is no longer evanescent → its decay constant goes to zero.</li>
          </ul>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout">
            <h3>Assumptions (explicit)</h3>
            <ul>
              <li>Lossless, linear, isotropic dielectrics</li>
              <li>Time-harmonic fields, steady-state</li>
              <li>1D confinement (slab) with symmetry about the midplane</li>
              <li>Weak guidance: <span style="font-family:var(--mono)">Δn ≪ n1</span></li>
              <li>Use <strong>full core thickness</strong> <span style="font-family:var(--mono)">d</span> (so half-thickness is <span style="font-family:var(--mono)">a=d/2</span>)</li>
            </ul>
          </div>

          <div class="callout">
            <h3>Possible approaches (choose one)</h3>
            <ul>
              <li><strong>(A) Exact slab dispersion → cutoff:</strong> use TE transcendental equations, then take cutoff limit (<em>best for rigor</em>).</li>
              <li><strong>(B) Ray/phase (standing wave) picture:</strong> interpret cutoff as a transverse half-wave fit (<em>fast intuition</em>).</li>
              <li><strong>(C) Normalized frequency V method:</strong> define <span style="font-family:var(--mono)">V</span>, use known cutoff <span style="font-family:var(--mono)">V = mπ/2</span> (<em>cleanest and compact</em>).</li>
            </ul>
            <p class="note"><strong>We will use (C)</strong> (with a short tie-back to (A)) because it produces the target formula directly and transparently.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- PART 2 -->
    <section id="p2">
      <div class="section-head">
        <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>
        <span class="tag">plan before algebra</span>
      </div>
      <div class="content">
        <ol class="steps">
          <li><strong>Define geometry:</strong> set half-thickness <span style="font-family:var(--mono)">a = d/2</span> and coordinate <span style="font-family:var(--mono)">x</span> transverse, <span style="font-family:var(--mono)">z</span> propagation. <em>Meaning:</em> simplifies standard slab formulas.</li>
          <li><strong>Write TE wave equation:</strong> for <span style="font-family:var(--mono)">Ey(x) e^{iβz}</span> get a 1D ODE in each region. <em>Tool:</em> Helmholtz.</li>
          <li><strong>Introduce transverse constants:</strong>
            <span style="font-family:var(--mono)">k_x</span> (core oscillation) and <span style="font-family:var(--mono)">α</span> (cladding decay).
            <em>Meaning:</em> guided modes require oscillatory in core + evanescent outside.
          </li>
          <li><strong>Define normalized parameters:</strong>
            <span style="font-family:var(--mono)">u = k_x a</span>, <span style="font-family:var(--mono)">w = α a</span>, <span style="font-family:var(--mono)">V = √(u²+w²)</span>.
            <em>Meaning:</em> V packages geometry + wavelength + index contrast.
          </li>
          <li><strong>Use TE boundary condition form:</strong> symmetric slab gives even/odd conditions relating <span style="font-family:var(--mono)">u</span> and <span style="font-family:var(--mono)">w</span>. <em>Meaning:</em> quantizes allowed modes.</li>
          <li><strong>Apply cutoff limit:</strong> at cutoff <span style="font-family:var(--mono)">w → 0</span> so the transcendental condition reduces to <span style="font-family:var(--mono)">u = mπ/2</span>. <em>Meaning:</em> pure standing-wave condition at the boundary.</li>
          <li><strong>Convert u back to λ:</strong> use <span style="font-family:var(--mono)">V = k0 a √(n1²−n2²)</span> and <span style="font-family:var(--mono)">V_c = u_c</span> at cutoff. <em>Meaning:</em> derive <span style="font-family:var(--mono)">λc</span> formula.</li>
          <li><strong>Apply weak guidance:</strong> approximate <span style="font-family:var(--mono)">n1²−n2² ≈ 2 n1 Δn</span>. <em>Meaning:</em> reach the target expression.</li>
          <li><strong>Sanity checks:</strong> units, scaling with <span style="font-family:var(--mono)">d</span>, <span style="font-family:var(--mono)">Δn</span>, <span style="font-family:var(--mono)">m</span>. <em>Meaning:</em> confirm physical reasonableness.</li>
        </ol>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout bad">
            <h3>Common mistakes</h3>
            <ul>
              <li>Using <span style="font-family:var(--mono)">a</span> vs <span style="font-family:var(--mono)">d</span> inconsistently (factor of 2 error in cutoff).</li>
              <li>Forgetting that weak guidance means <span style="font-family:var(--mono)">n1+n2 ≈ 2n1</span>, not <span style="font-family:var(--mono)">≈ 2n2</span> (either is close, but be consistent).</li>
              <li>Applying the cutoff formula to <span style="font-family:var(--mono)">m=0</span> without thinking—TE0 is special.</li>
            </ul>
          </div>
          <div class="callout good">
            <h3>Quick tips</h3>
            <ul>
              <li>At cutoff, always look for the parameter that measures evanescence (here <span style="font-family:var(--mono)">α</span> or <span style="font-family:var(--mono)">w</span>) and set it to zero.</li>
              <li>Remember: <span style="font-family:var(--mono)">V ∝ d/λ</span>. Longer wavelength reduces confinement.</li>
              <li>Use plots: the intersection of <span style="font-family:var(--mono)">V(λ)</span> with <span style="font-family:var(--mono)">V_c</span> directly shows cutoff.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- PART 3 -->
    <section id="p3">
      <div class="section-head">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>
        <span class="tag">derivation step-by-step</span>
      </div>
      <div class="content">
        <div class="callout">
          <h3>Physical intuition first</h3>
          <p>
            A higher-order slab mode has more transverse “wiggles” across the core. As the wavelength increases,
            the field can no longer fit that transverse pattern while still satisfying boundary conditions and decaying outside.
            At cutoff, the mode is just barely guided: the cladding field transitions from evanescent to propagating.
            So mathematically we expect a condition like “<em>an integer number of half-wavelengths fits across the thickness</em>,”
            and we expect thicker cores and larger index contrast to allow guidance at longer wavelengths.
          </p>
        </div>

        <div class="hr"></div>

        <p class="kicker">Step 1 — Geometry and field form</p>
        <p class="note">
          Let the slab core occupy <span style="font-family:var(--mono)">|x| ≤ a</span> with <span style="font-family:var(--mono)">a = d/2</span>. Propagation is along <span style="font-family:var(--mono)">z</span>.
          For a TE mode we can take the electric field polarized along <span style="font-family:var(--mono)">y</span>:
        </p>

        <div class="eq">
          <pre id="eq1">E_y(x,z,t) = Re{  E(x) · exp[i(β z − ω t)]  }</pre>
          <button class="copybtn" data-copytarget="eq1">Copy</button>
        </div>

        <p class="note">
          Here <span style="font-family:var(--mono)">E(x)</span> is the transverse profile, <span style="font-family:var(--mono)">β</span> is the propagation constant, and
          <span style="font-family:var(--mono)">k0 = ω/c = 2π/λ</span> is the free-space wavenumber.
        </p>

        <div class="hr"></div>

        <p class="kicker">Step 2 — 1D wave equation in each region</p>
        <p class="note">
          In each uniform region (<span style="font-family:var(--mono)">n = n1</span> in the core, <span style="font-family:var(--mono)">n = n2</span> in cladding),
          the transverse profile satisfies the scalar Helmholtz form:
        </p>

        <div class="eq">
          <pre id="eq2">d^2E/dx^2 + (k0^2 n^2 − β^2) E = 0</pre>
          <button class="copybtn" data-copytarget="eq2">Copy</button>
        </div>

        <p class="note">
          This is a standard separation-of-variables result: the <span style="font-family:var(--mono)">β</span> term accounts for the z-dependence.
        </p>

        <div class="hr"></div>

        <p class="kicker">Step 3 — Define the core oscillation constant and cladding decay constant</p>
        <p class="note">
          For guided modes we require <span style="font-family:var(--mono)">β</span> to lie between the plane-wave values in core and cladding:
          <span style="font-family:var(--mono)">k0 n2 &lt; β &lt; k0 n1</span>.
          Then:
        </p>

        <div class="eq">
          <pre id="eq3">Core (|x| ≤ a):      k_x^2 = k0^2 n1^2 − β^2   (oscillatory)
Cladding (|x| ≥ a):  α^2   = β^2 − k0^2 n2^2   (evanescent)</pre>
          <button class="copybtn" data-copytarget="eq3">Copy</button>
        </div>

        <p class="note">
          <span style="font-family:var(--mono)">k_x</span> is real in the core (so the field oscillates), and <span style="font-family:var(--mono)">α</span> is real in the cladding (so the field decays).
        </p>

        <div class="hr"></div>

        <p class="kicker">Step 4 — Normalize: u, w, and the normalized frequency V</p>
        <p class="note">
          Define dimensionless quantities using the half-thickness <span style="font-family:var(--mono)">a</span>:
        </p>

        <div class="eq">
          <pre id="eq4">u = k_x a,   w = α a,   V = k0 a · √(n1^2 − n2^2)</pre>
          <button class="copybtn" data-copytarget="eq4">Copy</button>
        </div>

        <p class="note">
          A key identity follows from the definitions of <span style="font-family:var(--mono)">k_x</span> and <span style="font-family:var(--mono)">α</span>:
        </p>

        <div class="eq">
          <pre id="eq5">u^2 + w^2 = (k_x^2 + α^2)a^2
          = [ (k0^2 n1^2 − β^2) + (β^2 − k0^2 n2^2) ] a^2
          = k0^2 (n1^2 − n2^2) a^2
          = V^2</pre>
          <button class="copybtn" data-copytarget="eq5">Copy</button>
        </div>

        <p class="note">
          So <span style="font-family:var(--mono)">V</span> measures “how many transverse radians” the waveguide can support; larger <span style="font-family:var(--mono)">V</span> means more guided modes.
        </p>

        <div class="hr"></div>

        <p class="kicker">Step 5 — TE boundary conditions → mode equations (even/odd)</p>
        <p class="note">
          Applying continuity of the tangential fields at <span style="font-family:var(--mono)">x = ±a</span> yields standard TE dispersion relations.
          For a symmetric slab, modes are either even or odd about <span style="font-family:var(--mono)">x=0</span>:
        </p>

        <div class="eq">
          <pre id="eq6">TE even:  w = u tan(u)
TE odd:   w = −u cot(u)</pre>
          <button class="copybtn" data-copytarget="eq6">Copy</button>
        </div>

        <p class="note">
          These are exact for the ideal symmetric step-index slab. The details of deriving them are standard (match E and dE/dx at the boundary).
        </p>

        <div class="hr"></div>

        <p class="kicker">Step 6 — Apply the cutoff condition: w → 0</p>
        <p class="note">
          <strong>Cutoff means the cladding stops being evanescent.</strong> The decay constant <span style="font-family:var(--mono)">α</span> tends to zero, hence <span style="font-family:var(--mono)">w = αa → 0</span>.
          Plug <span style="font-family:var(--mono)">w=0</span> into the TE equations:
        </p>

        <div class="eq">
          <pre id="eq7">Even:  0 = u tan(u)   ⇒   tan(u) = 0   ⇒   u = pπ
Odd:   0 = −u cot(u)  ⇒   cot(u) = 0   ⇒   u = (p + 1/2)π</pre>
          <button class="copybtn" data-copytarget="eq7">Copy</button>
        </div>

        <p class="note">
          Combining these two families, the cutoff values can be indexed compactly as
          <span style="font-family:var(--mono)">u_c = mπ/2</span> with integer <span style="font-family:var(--mono)">m</span>.
          Here, the problem asks for <span style="font-family:var(--mono)">m &gt; 0</span> (higher-order modes).
        </p>

        <div class="callout key" style="margin-top:12px;">
          <h3>Key cutoff fact (symmetric slab, TE)</h3>
          <p style="margin:0; color:var(--text); font-family:var(--mono);">
            At cutoff for mode order m&gt;0:  w → 0  ⇒  V_c = u_c = mπ/2
          </p>
        </div>

        <div class="hr"></div>

        <p class="kicker">Step 7 — Convert Vc to a cutoff wavelength λc</p>
        <p class="note">
          Use the definition <span style="font-family:var(--mono)">V = k0 a √(n1² − n2²)</span> and the cutoff condition <span style="font-family:var(--mono)">V_c = mπ/2</span>.
          Since <span style="font-family:var(--mono)">k0 = 2π/λ</span> and <span style="font-family:var(--mono)">a = d/2</span>:
        </p>

        <div class="eq">
          <pre id="eq8">V_c = k0,c · (d/2) · √(n1^2 − n2^2) = mπ/2

(2π/λc) · (d/2) · √(n1^2 − n2^2) = mπ/2</pre>
          <button class="copybtn" data-copytarget="eq8">Copy</button>
        </div>

        <p class="note">
          Solve for <span style="font-family:var(--mono)">λc</span> by canceling common factors:
        </p>

        <div class="eq">
          <pre id="eq9">π d √(n1^2 − n2^2) / λc = mπ/2
⇒ λc = (2 d / m) · √(n1^2 − n2^2)</pre>
          <button class="copybtn" data-copytarget="eq9">Copy</button>
        </div>

        <p class="note">
          Squaring:
        </p>

        <div class="eq">
          <pre id="eq10">λc^2 = (4 d^2 / m^2) · (n1^2 − n2^2)</pre>
          <button class="copybtn" data-copytarget="eq10">Copy</button>
        </div>

        <div class="hr"></div>

        <p class="kicker">Step 8 — Apply weak guidance: n1 ≈ n2</p>
        <p class="note">
          Write:
          <span style="font-family:var(--mono)">n1^2 − n2^2 = (n1 − n2)(n1 + n2) = Δn (n1 + n2)</span>.
          Under weak guidance <span style="font-family:var(--mono)">n1 + n2 ≈ 2 n1</span> (or ≈ 2n2; either yields nearly identical results).
          Therefore:
        </p>

        <div class="eq">
          <pre id="eq11">n1^2 − n2^2 = Δn (n1 + n2) ≈ 2 n1 Δn</pre>
          <button class="copybtn" data-copytarget="eq11">Copy</button>
        </div>

        <p class="note">
          Substitute into <span style="font-family:var(--mono)">λc^2 = (4 d^2 / m^2)(n1^2 − n2^2)</span>:
        </p>

        <div class="eq">
          <pre id="eq12">λc^2 ≈ (4 d^2 / m^2) · (2 n1 Δn)
     = (8 n1 Δn d^2) / m^2</pre>
          <button class="copybtn" data-copytarget="eq12">Copy</button>
        </div>

        <div class="callout key" style="margin-top:12px;">
          <h3>Final Answer (boxed)</h3>
          <div class="eq" style="margin-top:10px;">
            <pre id="eqFinal2">TE mode cutoff (m > 0), symmetric slab, weak guidance:
λc^2 ≈ (8 n1 Δn d^2) / m^2
Δn = n1 − n2, d = core thickness</pre>
            <button class="copybtn" data-copytarget="eqFinal2">Copy</button>
          </div>
          <div class="copystatus" id="copyStatusFinal"></div>
        </div>

        <div class="hr"></div>

        <div class="grid2">
          <div class="callout">
            <h3>Sanity checks</h3>
            <ul>
              <li><strong>Units:</strong> RHS has <span style="font-family:var(--mono)">d^2</span> (m²) times dimensionless indices → m². Matches <span style="font-family:var(--mono)">λc^2</span>.</li>
              <li><strong>Scaling:</strong> doubling <span style="font-family:var(--mono)">d</span> quadruples <span style="font-family:var(--mono)">λc</span> squared → modes survive to longer wavelengths.</li>
              <li><strong>Mode order:</strong> larger <span style="font-family:var(--mono)">m</span> lowers cutoff as <span style="font-family:var(--mono)">1/m^2</span> (harder to guide higher-order wiggles).</li>
            </ul>
          </div>
          <div class="callout good">
            <h3>Physical interpretation (plain language)</h3>
            <ul>
              <li><span style="font-family:var(--mono)">n1 Δn</span> sets confinement strength; bigger contrast keeps modes guided even when wavelength grows.</li>
              <li><span style="font-family:var(--mono)">d</span> is the transverse “room” available; thicker core supports more transverse half-waves.</li>
              <li><span style="font-family:var(--mono)">m</span> counts transverse structure; higher <span style="font-family:var(--mono)">m</span> demands higher <span style="font-family:var(--mono)">V</span>, so it cuts off sooner (at shorter λ).</li>
            </ul>
          </div>
        </div>

        <p class="note" style="margin-top:10px;">
          Connection to the diagram &amp; plots: in the visuals below, cutoff occurs where the curve <span style="font-family:var(--mono)">V(λ)</span> crosses the horizontal line
          <span style="font-family:var(--mono)">V_c = mπ/2</span>. The corresponding <span style="font-family:var(--mono)">λ</span> is <span style="font-family:var(--mono)">λc</span>.
        </p>
      </div>
    </section>

    <!-- PART 4 -->
    <section id="p4">
      <div class="section-head">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>
        <span class="tag">what the formula is telling you</span>
      </div>
      <div class="content">
        <div class="grid2">
          <div class="callout key">
            <h3>Re-interpreting the final formula</h3>
            <ul>
              <li><span style="font-family:var(--mono)">λc ∝ d</span>: thickness is the most direct lever.</li>
              <li><span style="font-family:var(--mono)">λc ∝ √Δn</span>: doubling index contrast increases cutoff by a factor <span style="font-family:var(--mono)">√2</span>.</li>
              <li><span style="font-family:var(--mono)">λc ∝ 1/m</span>: each higher mode requires proportionally shorter wavelengths to remain guided.</li>
              <li><span style="font-family:var(--mono)">n1</span> appears because <span style="font-family:var(--mono)">n1² − n2² ≈ 2n1Δn</span>: the “average” index matters under weak guidance.</li>
            </ul>
          </div>

          <div class="callout">
            <h3>How changing parameters shifts cutoff (use the sliders)</h3>
            <ul>
              <li>Increase <span style="font-family:var(--mono)">d</span> → all cutoff wavelengths increase linearly (plot 1 shifts up).</li>
              <li>Increase <span style="font-family:var(--mono)">Δn</span> → cutoff increases like <span style="font-family:var(--mono)">√Δn</span> and <span style="font-family:var(--mono)">V(λ)</span> increases (plot 2 curve rises).</li>
              <li>Increase <span style="font-family:var(--mono)">m</span> → higher threshold <span style="font-family:var(--mono)">V_c</span> (plot 2 line moves up) and cutoff decreases (plot 1 highlighted point moves down).</li>
            </ul>
          </div>
        </div>

        <div class="hr"></div>

        <div class="callout warn">
          <h3>Alternative derivation idea (brief)</h3>
          <p>
            A ray/phase picture treats the mode as two plane waves bouncing between interfaces.
            At cutoff the reflection phase becomes small and the transverse phase accumulation approaches
            a half-wave condition. This reproduces <span style="font-family:var(--mono)">u_c = mπ/2</span> and thus the same cutoff scaling.
            The full electromagnetic derivation (the one we used) is essentially the wave version of that intuition.
          </p>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout good">
            <h3>Concept checks (with answers)</h3>
            <ul>
              <li><strong>Q:</strong> Why does cutoff correspond to <span style="font-family:var(--mono)">α → 0</span>? <br><strong>A:</strong> Because <span style="font-family:var(--mono)">α</span> is the cladding decay rate; guidance requires evanescence outside.</li>
              <li><strong>Q:</strong> What happens to <span style="font-family:var(--mono)">V</span> if wavelength increases? <br><strong>A:</strong> <span style="font-family:var(--mono)">V ∝ 1/λ</span>, so it decreases, and modes eventually fall below threshold.</li>
              <li><strong>Q:</strong> Does the formula apply to <span style="font-family:var(--mono)">m=0</span>? <br><strong>A:</strong> Not in the same way; TE0 is guided for any <span style="font-family:var(--mono)">V&gt;0</span> in the ideal symmetric slab.</li>
              <li><strong>Q:</strong> If <span style="font-family:var(--mono)">Δn</span> is four times bigger, how does <span style="font-family:var(--mono)">λc</span> change? <br><strong>A:</strong> It doubles, since <span style="font-family:var(--mono)">λc ∝ √Δn</span>.</li>
            </ul>
          </div>

          <div class="callout bad">
            <h3>Subtle misconception to avoid</h3>
            <p>
              Cutoff is <em>not</em> “the wave stops” — it means the mode can no longer remain confined.
              Energy leaks into the cladding as a propagating wave when <span style="font-family:var(--mono)">β</span> approaches <span style="font-family:var(--mono)">k0 n2</span>.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PART 5 -->
    <section id="p5">
      <div class="section-head">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>
        <span class="tag">read the canvases</span>
      </div>
      <div class="content">
        <div class="callout">
          <h3>What each canvas shows</h3>
          <ul>
            <li><strong>Diagram canvas:</strong> symmetric slab geometry (core index <span style="font-family:var(--mono)">n1</span>, cladding <span style="font-family:var(--mono)">n2</span>, thickness <span style="font-family:var(--mono)">d</span>), plus a sketch of the TE field profile for the selected mode order <span style="font-family:var(--mono)">m</span>.</li>
            <li><strong>Main plot:</strong> cutoff wavelength <span style="font-family:var(--mono)">λc</span> versus mode number <span style="font-family:var(--mono)">m</span>, using
              <span style="font-family:var(--mono)">λc = (2d/m)√(n1²−n2²) ≈ (d/m)√(8 n1 Δn)</span>.</li>
            <li><strong>Secondary plot A:</strong> normalized frequency <span style="font-family:var(--mono)">V(λ)</span> versus <span style="font-family:var(--mono)">λ</span>, with a horizontal line at <span style="font-family:var(--mono)">V_c = mπ/2</span>. Their intersection is cutoff.</li>
            <li><strong>Secondary plot B:</strong> an approximate guided-mode count versus <span style="font-family:var(--mono)">λ</span> using
              <span style="font-family:var(--mono)">N(λ) ≈ floor(2V/π)+1</span> (includes TE0). This shows how modes drop out as wavelength increases.</li>
          </ul>
        </div>

        <div class="callout key" style="margin-top:12px;">
          <h3>Interactive controls</h3>
          <ul>
            <li><strong>Mode m selector:</strong> changes the highlighted cutoff on the plots and the field pattern sketch in the diagram.</li>
            <li><strong>Thickness d slider:</strong> increases/decreases <span style="font-family:var(--mono)">V</span> and all cutoffs linearly (watch plot 1 shift).</li>
            <li><strong>Index contrast Δn slider:</strong> changes confinement strength; cutoffs scale as <span style="font-family:var(--mono)">√Δn</span> and <span style="font-family:var(--mono)">V(λ)</span> rises/falls.</li>
          </ul>
          <p class="note">All canvases update live when you move any control.</p>
        </div>
      </div>
    </section>

    <!-- Visualizations -->
    <section id="viz">
      <div class="section-head">
        <h2>Interactive Visuals</h2>
        <span class="tag">canvas + live controls</span>
      </div>
      <div class="content">
        <div class="controls" role="group" aria-label="Interactive parameters">
          <div class="ctrl">
            <label for="modeSel">Mode order m (TE m&gt;0)</label>
            <div class="row">
              <select id="modeSel" aria-label="Select mode order">
                <option value="1">m = 1</option>
                <option value="2">m = 2</option>
                <option value="3" selected>m = 3</option>
                <option value="4">m = 4</option>
                <option value="5">m = 5</option>
                <option value="6">m = 6</option>
                <option value="7">m = 7</option>
                <option value="8">m = 8</option>
              </select>
            </div>
          </div>

          <div class="ctrl">
            <label for="dSlider">Core thickness d (µm)</label>
            <div class="row" style="gap:12px;">
              <input id="dSlider" type="range" min="1" max="20" step="0.1" value="6" />
              <span class="val" id="dVal">6.0 µm</span>
            </div>
          </div>

          <div class="ctrl">
            <label for="dnSlider">Index contrast Δn = n1 − n2</label>
            <div class="row" style="gap:12px;">
              <input id="dnSlider" type="range" min="0.001" max="0.05" step="0.001" value="0.01" />
              <span class="val" id="dnVal">0.010</span>
            </div>
          </div>
        </div>

        <p class="note">
          <strong>Example values used for plotting:</strong> unless you change them, we take <span style="font-family:var(--mono)">n1 = 1.50</span> and
          <span style="font-family:var(--mono)">n2 = n1 − Δn</span>. The final derived formula is symbolic and general.
        </p>

        <div class="viz-grid" style="margin-top:12px;">
          <figure>
            <canvas id="cvDiagram" aria-label="Slab waveguide diagram"></canvas>
            <figcaption><strong>Diagram:</strong> symmetric slab waveguide and TE field profile sketch for the selected mode order.</figcaption>
          </figure>

          <figure>
            <canvas id="cvPlot1" aria-label="Cutoff wavelength versus mode number plot"></canvas>
            <figcaption><strong>Main plot:</strong> cutoff wavelength λ<sub>c</sub> vs mode number m (highlighted at selected m).</figcaption>
          </figure>

          <div class="grid2">
            <figure>
              <canvas id="cvPlot2" aria-label="Normalized frequency versus wavelength plot"></canvas>
              <figcaption><strong>Secondary plot:</strong> normalized frequency V(λ) and cutoff threshold V<sub>c</sub> = mπ/2.</figcaption>
            </figure>
            <figure>
              <canvas id="cvPlot3" aria-label="Approximate guided-mode count versus wavelength plot"></canvas>
              <figcaption><strong>Parameter sweep:</strong> approximate number of guided TE modes vs wavelength.</figcaption>
            </figure>
          </div>
        </div>
      </div>
    </section>
  </article>
</main>

<footer class="fade-in">
  <div class="callout" style="max-width:1200px; margin:0 auto;">
    <h3 style="margin:0 0 6px 0;">Summary in one line</h3>
    <p style="margin:0;">
      In a symmetric slab, TE cutoff for mode order <span style="font-family:var(--mono)">m&gt;0</span> comes from <span style="font-family:var(--mono)">w→0</span>
      which yields <span style="font-family:var(--mono)">V_c=mπ/2</span>; converting <span style="font-family:var(--mono)">V=k0(d/2)√(n1²−n2²)</span> gives
      <span style="font-family:var(--mono)">λc²≈8 n1 Δn d²/m²</span> for weak guidance.
    </p>
  </div>
</footer>

<script>
/* ===== Smooth TOC scrolling ===== */
document.querySelectorAll('nav.toc a').forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault();
    const id = a.getAttribute('href');
    const el = document.querySelector(id);
    if(!el) return;
    el.scrollIntoView({behavior:'smooth', block:'start'});
    history.replaceState(null, '', id);
  });
});

/* ===== Copy buttons ===== */
function setCopyStatus(text){
  const s1 = document.getElementById('copyStatusTop');
  const s2 = document.getElementById('copyStatusFinal');
  if(s1) s1.textContent = text;
  if(s2) s2.textContent = text;
  window.clearTimeout(setCopyStatus._t);
  setCopyStatus._t = window.setTimeout(()=>{
    if(s1) s1.textContent = '';
    if(s2) s2.textContent = '';
  }, 1300);
}
document.querySelectorAll('.copybtn').forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    const id = btn.getAttribute('data-copytarget');
    const el = document.getElementById(id);
    if(!el) return;
    const txt = el.textContent.trim();
    try{
      await navigator.clipboard.writeText(txt);
      setCopyStatus('Copied to clipboard ✓');
    }catch(err){
      // fallback
      const ta = document.createElement('textarea');
      ta.value = txt;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand('copy'); setCopyStatus('Copied to clipboard ✓'); }
      catch(e){ setCopyStatus('Copy failed (browser blocked)'); }
      document.body.removeChild(ta);
    }
  });
});

/* ===== Canvas helpers (HiDPI, resize, axes) ===== */
function setupCanvas(canvas){
  const ctx = canvas.getContext('2d');
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.max(2, Math.floor(rect.width * dpr));
    canvas.height = Math.max(2, Math.floor(rect.height * dpr));
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  }
  resize();
  return {ctx, resize};
}

function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }

function niceTicks(min, max, approxCount){
  const span = max - min;
  if(span <= 0) return {step:1, ticks:[min]};
  const raw = span / Math.max(1, approxCount);
  const pow = Math.pow(10, Math.floor(Math.log10(raw)));
  const norm = raw / pow;
  let step;
  if(norm < 1.5) step = 1 * pow;
  else if(norm < 3) step = 2 * pow;
  else if(norm < 7) step = 5 * pow;
  else step = 10 * pow;
  const start = Math.ceil(min/step)*step;
  const ticks = [];
  for(let v=start; v<=max+1e-12; v+=step) ticks.push(v);
  return {step, ticks};
}

function drawAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel, title){
  const {x,y,w,h} = box;
  ctx.save();

  // Title
  ctx.fillStyle = 'rgba(233,236,255,.92)';
  ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText(title, x+8, y+18);

  // Plot area
  const padL=54, padR=14, padT=28, padB=40;
  const px = x + padL;
  const py = y + padT;
  const pw = w - padL - padR;
  const ph = h - padT - padB;

  // Background panel
  ctx.fillStyle = 'rgba(0,0,0,.16)';
  ctx.strokeStyle = 'rgba(233,236,255,.14)';
  ctx.lineWidth = 1;
  roundRect(ctx, px, py, pw, ph, 12);
  ctx.fill();
  ctx.stroke();

  // Grid + ticks
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillStyle = 'rgba(233,236,255,.78)';
  ctx.strokeStyle = 'rgba(233,236,255,.10)';
  ctx.lineWidth = 1;

  const xt = niceTicks(xMin, xMax, 6).ticks;
  const yt = niceTicks(yMin, yMax, 5).ticks;

  // gridlines and tick labels
  for(const xv of xt){
    const X = px + (xv - xMin) / (xMax - xMin) * pw;
    ctx.beginPath(); ctx.moveTo(X, py); ctx.lineTo(X, py+ph); ctx.stroke();
    ctx.fillText(formatNum(xv), X-10, py+ph+18);
  }
  for(const yv of yt){
    const Y = py+ph - (yv - yMin) / (yMax - yMin) * ph;
    ctx.beginPath(); ctx.moveTo(px, Y); ctx.lineTo(px+pw, Y); ctx.stroke();
    ctx.fillText(formatNum(yv), px-48, Y+4);
  }

  // axes labels
  ctx.fillStyle = 'rgba(183,192,255,.92)';
  ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText(xLabel, px+pw/2 - ctx.measureText(xLabel).width/2, py+ph+34);

  ctx.save();
  ctx.translate(px-44, py+ph/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
  ctx.restore();

  ctx.restore();
  return {px,py,pw,ph};
}

function roundRect(ctx, x, y, w, h, r){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
}

function formatNum(v){
  const av = Math.abs(v);
  if(av >= 1000) return (v.toFixed(0));
  if(av >= 100) return (v.toFixed(0));
  if(av >= 10) return (v.toFixed(1));
  if(av >= 1) return (v.toFixed(2));
  if(av >= 0.1) return (v.toFixed(3));
  return (v.toExponential(1));
}

function plotLine(ctx, area, xMin, xMax, yMin, yMax, xs, ys, strokeStyle, lineWidth){
  const {px,py,pw,ph} = area;
  ctx.save();
  ctx.strokeStyle = strokeStyle;
  ctx.lineWidth = lineWidth || 2;
  ctx.beginPath();
  for(let i=0;i<xs.length;i++){
    const x = px + (xs[i]-xMin)/(xMax-xMin)*pw;
    const y = py+ph - (ys[i]-yMin)/(yMax-yMin)*ph;
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }
  ctx.stroke();
  ctx.restore();
}

function plotMarkers(ctx, area, xMin, xMax, yMin, yMax, pts, fillStyle){
  const {px,py,pw,ph} = area;
  ctx.save();
  ctx.fillStyle = fillStyle;
  for(const p of pts){
    const x = px + (p.x-xMin)/(xMax-xMin)*pw;
    const y = py+ph - (p.y-yMin)/(yMax-yMin)*ph;
    ctx.beginPath();
    ctx.arc(x,y,4.2,0,Math.PI*2);
    ctx.fill();
  }
  ctx.restore();
}

function drawLegend(ctx, x, y, items){
  ctx.save();
  ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  let yy = y;
  for(const it of items){
    ctx.fillStyle = it.color;
    ctx.fillRect(x, yy-9, 18, 6);
    ctx.fillStyle = 'rgba(233,236,255,.86)';
    ctx.fillText(it.label, x+24, yy-4);
    yy += 16;
  }
  ctx.restore();
}

/* ===== Physics functions ===== */
function lambdaCutoff_nm(m, n1, dn, d_um){
  const n2 = n1 - dn;
  const d_m = d_um * 1e-6;
  const val = (2*d_m/m) * Math.sqrt(Math.max(0, n1*n1 - n2*n2)); // meters
  return val * 1e9; // nm
}
function V_of_lambda(lambda_nm, n1, dn, d_um){
  const n2 = n1 - dn;
  const d_m = d_um * 1e-6;
  const a = d_m/2;
  const lambda_m = lambda_nm * 1e-9;
  const k0 = 2*Math.PI / lambda_m;
  const inside = Math.max(0, n1*n1 - n2*n2);
  return k0 * a * Math.sqrt(inside);
}
function Vc(m){ return m*Math.PI/2; }
function modeCountApprox(lambda_nm, n1, dn, d_um){
  const V = V_of_lambda(lambda_nm, n1, dn, d_um);
  // approximate TE guided count including m=0:
  return Math.max(0, Math.floor(2*V/Math.PI) + 1);
}

/* ===== Drawings ===== */
const n1_fixed = 1.50;

const canv = {
  diagram: setupCanvas(document.getElementById('cvDiagram')),
  p1: setupCanvas(document.getElementById('cvPlot1')),
  p2: setupCanvas(document.getElementById('cvPlot2')),
  p3: setupCanvas(document.getElementById('cvPlot3')),
};

function drawDiagram(params){
  const {ctx} = canv.diagram;
  const canvas = document.getElementById('cvDiagram');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const w = canvas.getBoundingClientRect().width;
  const h = canvas.getBoundingClientRect().height;

  // Layout in CSS pixels (since ctx scaled)
  const box = {x:10, y:10, w:w-20, h:h-20};

  // Title + a small "not to scale"
  ctx.fillStyle = 'rgba(233,236,255,.92)';
  ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText('Symmetric slab waveguide (cross-section) + TE field sketch', box.x+8, box.y+18);
  ctx.fillStyle = 'rgba(183,192,255,.86)';
  ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText('not to scale', box.x+8, box.y+36);

  // Region drawing
  const pad = 18;
  const x0 = box.x + pad;
  const y0 = box.y + 46;
  const W = box.w - 2*pad;
  const H = box.h - 66;

  // Core thickness region in middle
  const coreH = H*0.35;
  const coreY = y0 + (H-coreH)/2;

  // Claddings
  ctx.fillStyle = 'rgba(255,255,255,.04)';
  ctx.strokeStyle = 'rgba(233,236,255,.14)';
  ctx.lineWidth = 1;
  roundRect(ctx, x0, y0, W, coreY - y0, 14); ctx.fill(); ctx.stroke();
  roundRect(ctx, x0, coreY+coreH, W, (y0+H)-(coreY+coreH), 14); ctx.fill(); ctx.stroke();

  // Core
  ctx.fillStyle = 'rgba(124,240,255,.08)';
  ctx.strokeStyle = 'rgba(124,240,255,.28)';
  ctx.lineWidth = 1.2;
  roundRect(ctx, x0, coreY, W, coreH, 14); ctx.fill(); ctx.stroke();

  // Labels n1/n2
  ctx.fillStyle = 'rgba(233,236,255,.92)';
  ctx.font = '600 13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  const n2 = params.n1 - params.dn;
  ctx.fillText(`core: n1 = ${params.n1.toFixed(2)}`, x0+12, coreY+20);
  ctx.fillStyle = 'rgba(183,192,255,.92)';
  ctx.font = '13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText(`cladding: n2 = ${n2.toFixed(3)}`, x0+12, y0+22);
  ctx.fillText(`cladding: n2 = ${n2.toFixed(3)}`, x0+12, y0+H-14);

  // Axes arrows (x, z)
  const axX = x0 + W - 90, axY = y0 + H - 40;
  ctx.strokeStyle = 'rgba(233,236,255,.55)';
  ctx.lineWidth = 1.4;
  ctx.beginPath();
  ctx.moveTo(axX, axY);
  ctx.lineTo(axX+52, axY);
  ctx.lineTo(axX+46, axY-4);
  ctx.moveTo(axX+52, axY);
  ctx.lineTo(axX+46, axY+4);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(axX, axY);
  ctx.lineTo(axX, axY-42);
  ctx.lineTo(axX-4, axY-36);
  ctx.moveTo(axX, axY-42);
  ctx.lineTo(axX+4, axY-36);
  ctx.stroke();
  ctx.fillStyle = 'rgba(233,236,255,.75)';
  ctx.font = '12px var(--mono)';
  ctx.fillText('z', axX+56, axY+4);
  ctx.fillText('x', axX-8, axY-48);

  // Thickness d bracket
  const bx = x0 + W*0.78;
  ctx.strokeStyle = 'rgba(255,211,124,.55)';
  ctx.lineWidth = 1.4;
  ctx.beginPath();
  ctx.moveTo(bx, coreY);
  ctx.lineTo(bx, coreY+coreH);
  ctx.moveTo(bx-10, coreY);
  ctx.lineTo(bx+10, coreY);
  ctx.moveTo(bx-10, coreY+coreH);
  ctx.lineTo(bx+10, coreY+coreH);
  ctx.stroke();
  ctx.fillStyle = 'rgba(255,211,124,.92)';
  ctx.font = '600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText(`d = ${params.d_um.toFixed(1)} µm`, bx+14, coreY + coreH/2 + 4);

  // Field sketch inside core: m half-waves across thickness (vertical direction)
  const m = params.m;
  const fx0 = x0 + W*0.50;
  const fx1 = x0 + W*0.94;
  const npts = 180;
  const xs = [];
  const ys = [];
  for(let i=0;i<npts;i++){
    const t = i/(npts-1);
    const x = fx0 + t*(fx1-fx0);
    // map t to vertical coordinate across core thickness:
    const u = t; // 0..1 across sketch width
    // build a sinusoidal profile along x direction? For clarity, draw a vertical standing wave centered:
    xs.push(x);
    // use sin(m*pi*(y core coordinate)) in vertical direction, but we draw it horizontally as a wiggle line.
    const phase = m*Math.PI*(t); // m half-waves over 0..1 corresponds to sin(m*pi*t)
    const amp = Math.sin(phase);
    const yMid = coreY + coreH/2;
    ys.push(yMid - amp*(coreH*0.34));
  }
  ctx.strokeStyle = 'rgba(184,255,124,.85)';
  ctx.lineWidth = 2.0;
  ctx.beginPath();
  for(let i=0;i<npts;i++){
    if(i===0) ctx.moveTo(xs[i], ys[i]);
    else ctx.lineTo(xs[i], ys[i]);
  }
  ctx.stroke();
  ctx.fillStyle = 'rgba(184,255,124,.92)';
  ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText(`TE field sketch (m=${m})`, fx0, coreY + 16);

  // Cutoff note
  const lc = lambdaCutoff_nm(m, params.n1, params.dn, params.d_um);
  ctx.fillStyle = 'rgba(183,192,255,.90)';
  ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.fillText(`Cutoff: Vc = mπ/2 = ${(Vc(m)).toFixed(2)};  λc ≈ ${lc.toFixed(0)} nm`, x0+12, coreY+coreH+22);
}

function drawPlot1(params){
  const {ctx} = canv.p1;
  const canvas = document.getElementById('cvPlot1');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const mMax = 8;
  const ms = [];
  const lcs = [];
  for(let m=1;m<=mMax;m++){
    ms.push(m);
    lcs.push(lambdaCutoff_nm(m, params.n1, params.dn, params.d_um));
  }

  const xMin = 1, xMax = mMax;
  const yMin = 0;
  const yMax = Math.max(...lcs) * 1.08;

  const area = drawAxes(ctx, {x:10,y:10,w:W-20,h:H-20}, xMin, xMax, yMin, yMax,
                        'Mode order m (dimensionless)',
                        'Cutoff wavelength λc (nm)',
                        'Cutoff wavelength vs mode number (TE, m>0)');

  // line
  plotLine(ctx, area, xMin, xMax, yMin, yMax, ms, lcs, 'rgba(124,240,255,.9)', 2.4);

  // markers all
  const pts = ms.map((m,i)=>({x:m, y:lcs[i]}));
  plotMarkers(ctx, area, xMin, xMax, yMin, yMax, pts, 'rgba(233,236,255,.65)');

  // highlight selected m
  const mSel = params.m;
  const lcSel = lambdaCutoff_nm(mSel, params.n1, params.dn, params.d_um);
  plotMarkers(ctx, area, xMin, xMax, yMin, yMax, [{x:mSel, y:lcSel}], 'rgba(184,255,124,.95)');

  // legend
  drawLegend(ctx, area.px+10, area.py+18, [
    {label:'λc(m) (computed)', color:'rgba(124,240,255,.9)'},
    {label:`selected m=${mSel}`, color:'rgba(184,255,124,.95)'}
  ]);

  // annotation
  ctx.fillStyle = 'rgba(183,192,255,.92)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(`Using λc ≈ (2d/m)√(n1²−n2²) and n2=n1−Δn`, area.px+10, area.py+area.ph-10);
}

function drawPlot2(params){
  const {ctx} = canv.p2;
  const canvas = document.getElementById('cvPlot2');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const lamMin = 400;
  const lamMax = 2000;
  const N = 260;
  const xs = [];
  const ys = [];
  let yMax = 0;
  for(let i=0;i<N;i++){
    const lam = lamMin + (lamMax-lamMin)*i/(N-1);
    const V = V_of_lambda(lam, params.n1, params.dn, params.d_um);
    xs.push(lam);
    ys.push(V);
    yMax = Math.max(yMax, V);
  }

  const mSel = params.m;
  const yLine = Vc(mSel);
  yMax = Math.max(yMax, yLine) * 1.12;
  const yMin = 0;

  const area = drawAxes(ctx, {x:10,y:10,w:W-20,h:H-20}, lamMin, lamMax, yMin, yMax,
                        'Wavelength λ (nm)',
                        'Normalized frequency V (dimensionless)',
                        'Normalized frequency V(λ) and cutoff threshold');

  // V curve
  plotLine(ctx, area, lamMin, lamMax, yMin, yMax, xs, ys, 'rgba(124,240,255,.9)', 2.3);

  // horizontal cutoff line
  ctx.save();
  ctx.strokeStyle = 'rgba(255,211,124,.85)';
  ctx.lineWidth = 2;
  const Y = area.py + area.ph - (yLine - yMin)/(yMax-yMin)*area.ph;
  ctx.beginPath();
  ctx.moveTo(area.px, Y);
  ctx.lineTo(area.px+area.pw, Y);
  ctx.stroke();
  ctx.restore();

  // cutoff point marker at λc
  const lc = lambdaCutoff_nm(mSel, params.n1, params.dn, params.d_um);
  plotMarkers(ctx, area, lamMin, lamMax, yMin, yMax, [{x:lc, y:yLine}], 'rgba(184,255,124,.95)');

  // legend
  drawLegend(ctx, area.px+10, area.py+18, [
    {label:'V(λ)', color:'rgba(124,240,255,.9)'},
    {label:`Vc = mπ/2 (m=${mSel})`, color:'rgba(255,211,124,.85)'},
    {label:'cutoff point (λc, Vc)', color:'rgba(184,255,124,.95)'}
  ]);

  // text
  ctx.fillStyle = 'rgba(183,192,255,.92)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(`At cutoff: V(λc)=Vc. Here λc≈${lc.toFixed(0)} nm`, area.px+10, area.py+area.ph-10);
}

function drawPlot3(params){
  const {ctx} = canv.p3;
  const canvas = document.getElementById('cvPlot3');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const lamMin = 400;
  const lamMax = 2000;
  const N = 220;
  const xs = [];
  const ys = [];
  let yMax = 0;
  for(let i=0;i<N;i++){
    const lam = lamMin + (lamMax-lamMin)*i/(N-1);
    const n = modeCountApprox(lam, params.n1, params.dn, params.d_um);
    xs.push(lam);
    ys.push(n);
    yMax = Math.max(yMax, n);
  }
  yMax = Math.max(1, yMax) + 1;

  const area = drawAxes(ctx, {x:10,y:10,w:W-20,h:H-20}, lamMin, lamMax, 0, yMax,
                        'Wavelength λ (nm)',
                        'Approx. guided TE modes N (count)',
                        'Approximate guided-mode count vs wavelength');

  // step-like line (still drawn as line; the floor makes steps)
  plotLine(ctx, area, lamMin, lamMax, 0, yMax, xs, ys, 'rgba(184,255,124,.9)', 2.2);

  // mark where selected mode m cuts off (show that beyond that λ the mode is gone)
  const lcSel = lambdaCutoff_nm(params.m, params.n1, params.dn, params.d_um);
  const nAtLc = modeCountApprox(lcSel, params.n1, params.dn, params.d_um);
  plotMarkers(ctx, area, lamMin, lamMax, 0, yMax, [{x:lcSel, y:nAtLc}], 'rgba(255,211,124,.92)');

  drawLegend(ctx, area.px+10, area.py+18, [
    {label:'N(λ) ≈ floor(2V/π)+1', color:'rgba(184,255,124,.9)'},
    {label:`marker at λc(m=${params.m})`, color:'rgba(255,211,124,.92)'}
  ]);

  ctx.fillStyle = 'rgba(183,192,255,.92)';
  ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(`As λ increases, V decreases ⇒ fewer modes satisfy V ≥ mπ/2`, area.px+10, area.py+area.ph-10);
}

/* ===== Update loop ===== */
const modeSel = document.getElementById('modeSel');
const dSlider = document.getElementById('dSlider');
const dnSlider = document.getElementById('dnSlider');
const dVal = document.getElementById('dVal');
const dnVal = document.getElementById('dnVal');

function getParams(){
  const m = parseInt(modeSel.value, 10);
  const d_um = parseFloat(dSlider.value);
  const dn = parseFloat(dnSlider.value);
  return {m, d_um, dn, n1: n1_fixed};
}

function updateUI(){
  dVal.textContent = `${parseFloat(dSlider.value).toFixed(1)} µm`;
  dnVal.textContent = `${parseFloat(dnSlider.value).toFixed(3)}`;
}

function redrawAll(){
  const p = getParams();
  drawDiagram(p);
  drawPlot1(p);
  drawPlot2(p);
  drawPlot3(p);
}

function resizeAll(){
  Object.values(canv).forEach(c=>c.resize());
  redrawAll();
}

modeSel.addEventListener('change', ()=>{ updateUI(); redrawAll(); });
dSlider.addEventListener('input', ()=>{ updateUI(); redrawAll(); });
dnSlider.addEventListener('input', ()=>{ updateUI(); redrawAll(); });

window.addEventListener('resize', ()=>{
  // avoid thrash
  clearTimeout(window._rzT);
  window._rzT = setTimeout(resizeAll, 80);
});

// initial
updateUI();
resizeAll();
</script>
</body>
</html>
