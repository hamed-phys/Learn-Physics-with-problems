<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Subwavelength Near-Field Imaging with a Lossy Negative-Index Slab (n = âˆ’2)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1733;
      --ink:#e9ecff;
      --muted:#b9c0ff;
      --muted2:#9aa3e6;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line: rgba(233,236,255,.12);
      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 10% 0%, rgba(167,139,250,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(125,211,252,.15), transparent 55%),
        radial-gradient(1000px 600px at 50% 110%, rgba(52,211,153,.10), transparent 60%),
        var(--bg);
      line-height:1.55;
    }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    header{
      padding: 38px 18px 20px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent 65%);
    }
    .wrap{ max-width: 1100px; margin: 0 auto; }
    .title{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .title h1{
      margin:0;
      font-size: clamp(1.6rem, 2.4vw, 2.4rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      max-width: 80ch;
      margin:0;
    }

    main{
      padding: 22px 18px 70px;
    }

    .layout{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 18px;
      align-items:start;
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
    }

    .toc{
      position: sticky;
      top: 14px;
      background: rgba(15,23,51,.72);
      backdrop-filter: blur(10px);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px 14px 12px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .toc h2{
      margin:0 0 8px;
      font-size: 0.98rem;
      letter-spacing:.2px;
      color: var(--muted);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .toc small{
      color:var(--muted2);
      font-weight:500;
    }
    .toc nav a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--ink);
      border: 1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size: .95rem;
    }
    .toc nav a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
      transform: translateX(2px);
      text-decoration:none;
    }

    section{
      background: rgba(15,23,51,.55);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      margin-bottom: 16px;
      overflow:hidden;
      position:relative;
    }
    section::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background: radial-gradient(900px 180px at 30% 0%, rgba(125,211,252,.10), transparent 60%);
      opacity:.75;
    }
    section > *{ position:relative; }
    section h2{
      margin:0 0 10px;
      font-size: 1.18rem;
      letter-spacing:.2px;
    }
    section h3{
      margin: 14px 0 6px;
      font-size: 1.02rem;
      color: var(--muted);
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 860px){ .grid2{ grid-template-columns:1fr; } }

    .callouts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 860px){ .callouts{ grid-template-columns: 1fr; } }

    .box{
      border-radius: 16px;
      border: 1px solid var(--line);
      background: rgba(11,16,32,.45);
      padding: 12px 12px 10px;
    }
    .box strong{ color:var(--ink); }
    .box .tag{
      display:inline-block;
      font-size:.78rem;
      letter-spacing:.25px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--line);
      color: var(--muted);
      margin-bottom: 8px;
    }
    .box.assumptions .tag{ border-color: rgba(167,139,250,.35); color: rgba(167,139,250,.95); }
    .box.keyeq .tag{ border-color: rgba(125,211,252,.35); color: rgba(125,211,252,.95); }
    .box.mistakes .tag{ border-color: rgba(251,191,36,.40); color: rgba(251,191,36,.95); }
    .box.answer .tag{ border-color: rgba(52,211,153,.40); color: rgba(52,211,153,.95); }

    ul{ margin: 8px 0 0 20px; }
    li{ margin: 6px 0; color: rgba(233,236,255,.92); }
    .muted{ color: var(--muted); }

    .eq{
      font-family: var(--mono);
      font-size: .96rem;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(233,236,255,.14);
      border-radius: 14px;
      padding: 10px 10px;
      overflow:auto;
      white-space: pre;
    }
    .eqrow{
      display:flex;
      gap:10px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .copyBtn{
      appearance:none;
      border: 1px solid rgba(233,236,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      padding: 9px 11px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 600;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .copyBtn:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,.12);
      border-color: rgba(125,211,252,.30);
    }
    .copyBtn:active{ transform: translateY(0px) scale(.99); }
    .copyMsg{
      font-size:.88rem;
      color: var(--muted2);
      min-height: 1.2em;
      margin-top: 6px;
    }

    figure{
      margin: 10px 0 0;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: rgba(11,16,32,.35);
      overflow:hidden;
    }
    .figHead{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      gap:8px;
      align-items:center;
    }
    .figHead .cap{
      color: var(--muted);
      font-weight: 600;
      font-size: .92rem;
    }
    .controls{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .ctrl{
      display:flex;
      gap:8px;
      align-items:center;
      font-size: .88rem;
      color: var(--muted);
      border: 1px solid rgba(233,236,255,.14);
      background: rgba(255,255,255,.04);
      padding: 6px 9px;
      border-radius: 999px;
    }
    .ctrl input[type="range"]{ width: 160px; }
    .ctrl select{
      background: transparent;
      color: var(--ink);
      border: none;
      outline:none;
      font-weight:600;
    }
    .ctrl option{ color:#111; }
    canvas{
      width: 100%;
      height: 340px;
      display:block;
    }
    .smallCanvas{ height: 300px; }

    .note{
      font-size: .92rem;
      color: var(--muted);
      margin-top: 10px;
    }

    footer{
      padding: 22px 18px 34px;
      border-top: 1px solid var(--line);
      color: var(--muted);
    }

    @media print{
      body{ background:white; color:#111; }
      header, footer{ border-color:#ddd; }
      section, .toc{ box-shadow:none; background:white; border-color:#ddd; }
      .eq{ background:#f7f7f7; border-color:#ddd; color:#111; }
      .copyBtn, .controls{ display:none !important; }
      a{ color:#111; text-decoration:underline; }
    }
  </style>
</head>
<body>
<header>
  <div class="wrap title">
    <h1>8.1-3 â€” Subwavelength-Resolution Near-Field Imaging with a Lossy Negative-Index Slab (n = âˆ’2)</h1>
    <p class="subtitle">
      We study how a negative-index material (NIM) slab can <em>amplify</em> evanescent (subwavelength) spatial frequenciesâ€”and how a finite
      loss coefficient ultimately limits the recoverable resolution.
    </p>
  </div>
</header>

<main>
  <div class="wrap layout">
    <aside class="toc" aria-label="Sticky Table of Contents">
      <h2>Contents <small>jump</small></h2>
      <nav>
        <a href="#quick">Quick Summary</a>
        <a href="#part0">PART 0 â€” Concept Primer</a>
        <a href="#part1">PART 1 â€” Problem Analysis</a>
        <a href="#part2">PART 2 â€” Strategy & Tips</a>
        <a href="#part3">PART 3 â€” Full Solution</a>
        <a href="#part4">PART 4 â€” Deeper Understanding</a>
        <a href="#part5">PART 5 â€” Visualization Guide</a>
      </nav>
    </aside>

    <div>
      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><strong>Topic:</strong> Near-field imaging with a negative-index slab; evanescent waves carry subwavelength detail.</li>
          <li><strong>Key idea:</strong> In a NIM, the evanescent component inside the slab can be a <em>growing</em> exponential (amplification), but material loss adds an exponential <em>decay</em>.</li>
          <li><strong>Dispersion:</strong> <span class="muted">for ky = 0</span>, <span class="eq" style="display:inline-block;padding:2px 6px;">kxÂ² + kzÂ² = (n k0)Â²</span>, with <span class="eq" style="display:inline-block;padding:2px 6px;">k0 = 2Ï€/Î»0</span>.</li>
          <li><strong>Evanescent in slab:</strong> if <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span>, then <span class="eq" style="display:inline-block;padding:2px 6px;">kz = iÎ²</span>, <span class="eq" style="display:inline-block;padding:2px 6px;">Î² = âˆš(kxÂ² âˆ’ (|n|k0)Â²)</span>.</li>
          <li><strong>Competing exponentials:</strong> amplification âˆ <span class="eq" style="display:inline-block;padding:2px 6px;">e^{+Î² d}</span>, attenuation (loss) âˆ <span class="eq" style="display:inline-block;padding:2px 6px;">e^{âˆ’Î³ d}</span>.</li>
          <li><strong>Threshold condition:</strong> amplification is smaller than attenuation when <span class="eq" style="display:inline-block;padding:2px 6px;">Î² &lt; Î³</span>; boundary when <span class="eq" style="display:inline-block;padding:2px 6px;">Î² = Î³</span>.</li>
          <li><strong>Given:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">n = âˆ’2</span>, <span class="eq" style="display:inline-block;padding:2px 6px;">Î³ = 0.1 k0</span> â‡’ <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th/k0 = âˆš(4 + 0.01) â‰ˆ 2.0025</span>.</li>
          <li><strong>Resolution estimate:</strong> maximum recoverable transverse spatial angular frequency <span class="eq" style="display:inline-block;padding:2px 6px;">kx,max â‰ˆ 2.0025 k0</span> â‡’ minimum resolvable period
            <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x â‰ˆ 2Ï€/kx,max</span> gives <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x/Î»0 â‰ˆ k0/kx,max â‰ˆ 0.499</span> (about <strong>0.50Î»0</strong>).</li>
        </ul>
      </section>

      <section id="part0">
        <h2>PART 0 â€” Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <article>
            <h3>Core definitions (symbols & units)</h3>
            <ul>
              <li><strong>Free-space wavenumber:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">k0 = 2Ï€/Î»0</span> (units: rad/m).</li>
              <li><strong>Refractive index:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">n</span> (dimensionless). Here <span class="eq" style="display:inline-block;padding:2px 6px;">n = âˆ’2</span>.</li>
              <li><strong>Transverse spatial angular frequency:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> (rad/m). This is the â€œdetail levelâ€ along <span class="eq" style="display:inline-block;padding:2px 6px;">x</span>.</li>
              <li><strong>Longitudinal wavenumber:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">kz</span> (rad/m), set by dispersion.</li>
              <li><strong>Evanescent decay constant:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> (rad/m), when <span class="eq" style="display:inline-block;padding:2px 6px;">kz = iÎ²</span>.</li>
              <li><strong>Loss/attenuation coefficient:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span> (1/m). Here <span class="eq" style="display:inline-block;padding:2px 6px;">Î³ = 0.1 k0</span>.</li>
            </ul>

            <h3>Physical meaning</h3>
            <ul>
              <li><span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> labels a Fourier component of an object field. Larger <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> means finer features (shorter transverse period).</li>
              <li>If <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; n k0</span> (in magnitude), the wave cannot propagate in <span class="eq" style="display:inline-block;padding:2px 6px;">z</span>; it becomes evanescent and decays (or, in a NIM, can grow inside the slab).</li>
              <li>Loss turns â€œperfect amplificationâ€ into a competition between growth and decay.</li>
            </ul>
          </article>

          <article>
            <h3>Key laws / principles (and validity)</h3>
            <ul>
              <li><strong>Helmholtz dispersion (homogeneous isotropic medium):</strong>
                <div class="eq">kxÂ² + kyÂ² + kzÂ² = (n k0)Â²</div>
                Valid for time-harmonic fields in linear media, away from sources, assuming a single effective index.</li>
              <li><strong>Evanescent criterion (ky = 0):</strong> if <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span> then <span class="eq" style="display:inline-block;padding:2px 6px;">kz = iÎ²</span> with
                <div class="eq">Î² = âˆš(kxÂ² âˆ’ (|n|k0)Â²)  (Î² &gt; 0)</div>
              </li>
              <li><strong>Loss model:</strong> amplitude decays as <span class="eq" style="display:inline-block;padding:2px 6px;">e^{âˆ’Î³ z}</span> inside the slab (phenomenological, valid for small/moderate absorption).</li>
            </ul>

            <h3>Common models / approximations (why we use them)</h3>
            <ul>
              <li><strong>Single-spatial-frequency component:</strong> analyze one <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> at a time, then infer resolution from the largest transferable <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span>.</li>
              <li><strong>Compare exponential rates:</strong> growth rate <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> vs loss rate <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>. This gives a thickness-independent threshold (because both scale with slab thickness <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>).</li>
            </ul>

            <h3>Mini intuition examples</h3>
            <ul>
              <li>If <span class="eq" style="display:inline-block;padding:2px 6px;">Î² = 0</span> (right at the slabâ€™s propagating cutoff), there is no evanescent amplificationâ€”loss always wins.</li>
              <li>If <span class="eq" style="display:inline-block;padding:2px 6px;">Î² â‰« Î³</span>, amplification dominates and high-<span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> details can be transferred (in principle).</li>
            </ul>

            <h3>What to watch for (pitfalls)</h3>
            <ul>
              <li>Donâ€™t confuse the air evanescent cutoff <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; k0</span> with the slab cutoff <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span>.</li>
              <li>Resolution depends on what you mean by â€œfeature sizeâ€: minimum <em>period</em> vs half-period. State your convention.</li>
              <li>The question asks for the <em>threshold</em> where amplification becomes smaller than attenuation, which is set by <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> vs <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>, not by a particular thickness.</li>
            </ul>
          </article>
        </div>

        <div class="callouts">
          <div class="box assumptions">
            <div class="tag">Assumptions</div>
            <ul>
              <li>Time-harmonic fields; linear, homogeneous slab.</li>
              <li>ky = 0 (1D transverse variation).</li>
              <li>Loss represented by amplitude factor <span class="eq" style="display:inline-block;padding:2px 6px;">e^{âˆ’Î³ z}</span>.</li>
              <li>We focus on the evanescent-in-slab regime relevant to â€œamplificationâ€ of near-field components.</li>
            </ul>
          </div>
          <div class="box keyeq">
            <div class="tag">Key equations</div>
            <div class="eqrow">
              <div class="eq" id="eqKey1">k0 = 2Ï€/Î»0</div>
              <button class="copyBtn" data-copy="#eqKey1">ğŸ“‹ Copy</button>
            </div>
            <div class="eqrow" style="margin-top:8px;">
              <div class="eq" id="eqKey2">Î² = âˆš(kxÂ² âˆ’ (|n|k0)Â²),   (kx &gt; |n|k0)</div>
              <button class="copyBtn" data-copy="#eqKey2">ğŸ“‹ Copy</button>
            </div>
            <div class="eqrow" style="margin-top:8px;">
              <div class="eq" id="eqKey3">Net amplitude factor through slab:  exp[(Î² âˆ’ Î³)d]</div>
              <button class="copyBtn" data-copy="#eqKey3">ğŸ“‹ Copy</button>
            </div>
            <div class="copyMsg" data-copymsg></div>
          </div>
        </div>
      </section>

      <section id="part1">
        <h2>PART 1 â€” Problem Analysis (No Solving Yet)</h2>

        <article>
          <h3>Problem restatement (in plain words)</h3>
          <p>
            A slab with refractive index <span class="eq" style="display:inline-block;padding:2px 6px;">n = âˆ’2</span> is placed in air.
            A field component with transverse spatial angular frequency <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> is evanescent in air and enters the slab.
            Ideal negative-index behavior can <em>amplify</em> such evanescent components, but the slab is lossy with attenuation coefficient
            <span class="eq" style="display:inline-block;padding:2px 6px;">Î³ = 0.1k0</span>.
            We must find the <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> where the amplification becomes smaller than the attenuation (threshold),
            and then estimate the corresponding imaging resolution in units of <span class="eq" style="display:inline-block;padding:2px 6px;">Î»0</span>.
          </p>

          <h3>Given</h3>
          <ul>
            <li>Air: <span class="eq" style="display:inline-block;padding:2px 6px;">n1 = 1</span></li>
            <li>Slab: <span class="eq" style="display:inline-block;padding:2px 6px;">n2 = âˆ’2</span> (use magnitude <span class="eq" style="display:inline-block;padding:2px 6px;">|n2| = 2</span> in dispersion)</li>
            <li>Loss: <span class="eq" style="display:inline-block;padding:2px 6px;">Î³ = 0.1k0</span>, with <span class="eq" style="display:inline-block;padding:2px 6px;">k0 = 2Ï€/Î»0</span></li>
            <li><span class="eq" style="display:inline-block;padding:2px 6px;">ky = 0</span></li>
          </ul>

          <h3>Unknowns</h3>
          <ul>
            <li>Threshold transverse spatial angular frequency <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th</span> (report as <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th/k0</span>).</li>
            <li>Corresponding resolution estimate <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x</span> in units of <span class="eq" style="display:inline-block;padding:2px 6px;">Î»0</span>.</li>
          </ul>

          <h3>Relevant principles (and why they apply)</h3>
          <ul>
            <li><strong>Plane-wave spatial spectrum:</strong> any field can be decomposed into components labeled by <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span>. Imaging â€œresolutionâ€ depends on how large <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> can be transferred.</li>
            <li><strong>Dispersion relation:</strong> connects <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> and <span class="eq" style="display:inline-block;padding:2px 6px;">kz</span>. Determines whether the component propagates or is evanescent.</li>
            <li><strong>Exponential competition:</strong> evanescent amplification in a NIM behaves like a growing exponential in the slab; material loss causes exponential decay.</li>
          </ul>

          <h3>Assumptions (explicit)</h3>
          <ul>
            <li>We focus on the <strong>evanescent-in-slab</strong> regime (<span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span>), where â€œamplificationâ€ is the relevant behavior.</li>
            <li>Loss is represented by a uniform attenuation coefficient <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span> acting on amplitude.</li>
            <li>We ignore detailed Fresnel coefficients/impedance mismatch because the question asks specifically when <em>amplification vs attenuation</em> changes sign (a rate comparison).</li>
          </ul>

          <h3>Possible approaches (compare briefly)</h3>
          <ol>
            <li><strong>Rate comparison (best here):</strong> write growth factor <span class="eq" style="display:inline-block;padding:2px 6px;">e^{Î²d}</span> and loss factor <span class="eq" style="display:inline-block;padding:2px 6px;">e^{âˆ’Î³d}</span>, compare exponents â†’ threshold <span class="eq" style="display:inline-block;padding:2px 6px;">Î²=Î³</span>.
              <span class="muted">Pros: fast, matches what question asks. Cons: doesnâ€™t include interface prefactors.</span></li>
            <li><strong>Full transfer function:</strong> derive exact transmission through a slab with complex index, including interfaces and multiple reflections.
              <span class="muted">Pros: most complete. Cons: heavy algebra; overkill for â€œamplification smaller than attenuationâ€.</span></li>
            <li><strong>Energy/causality analysis:</strong> discuss physical realizability, bandwidth, and loss constraints.
              <span class="muted">Pros: deeper insight. Cons: not needed for numeric threshold asked.</span></li>
          </ol>

          <p><strong>Chosen approach:</strong> the rate comparison method, because the problem explicitly frames a competition between amplification and attenuation via given <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>.</p>
        </article>
      </section>

      <section id="part2">
        <h2>PART 2 â€” Strategy & Tips (Roadmap Only)</h2>

        <ol>
          <li><strong>Goal:</strong> connect <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> to the slabâ€™s evanescent â€œgrowth rateâ€.
            <br><span class="muted">Tool:</span> dispersion relation <span class="eq" style="display:inline-block;padding:2px 6px;">kxÂ² + kzÂ² = (n k0)Â²</span>.
            <br><span class="muted">Meaning:</span> tells whether the mode decays or propagates along z.</li>

          <li><strong>Goal:</strong> write the evanescent decay constant <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> in the slab.
            <br><span class="muted">Tool:</span> for <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span>, set <span class="eq" style="display:inline-block;padding:2px 6px;">kz = iÎ²</span>.
            <br><span class="muted">Meaning:</span> <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> is the z-direction spatial rate.</li>

          <li><strong>Goal:</strong> model amplification and attenuation over thickness <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>.
            <br><span class="muted">Tool:</span> amplification âˆ <span class="eq" style="display:inline-block;padding:2px 6px;">e^{+Î²d}</span>, loss âˆ <span class="eq" style="display:inline-block;padding:2px 6px;">e^{âˆ’Î³d}</span>.
            <br><span class="muted">Meaning:</span> net factor âˆ <span class="eq" style="display:inline-block;padding:2px 6px;">e^{(Î²âˆ’Î³)d}</span>.</li>

          <li><strong>Goal:</strong> find threshold <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span>.
            <br><span class="muted">Tool:</span> set <span class="eq" style="display:inline-block;padding:2px 6px;">Î²=Î³</span> and solve for <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span>.</li>

          <li><strong>Goal:</strong> convert <span class="eq" style="display:inline-block;padding:2px 6px;">kx,max</span> to a resolution estimate.
            <br><span class="muted">Tool:</span> spatial period <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x â‰ˆ 2Ï€/kx,max</span>.
            <br><span class="muted">Meaning:</span> largest transferable <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> corresponds to smallest transverse period.</li>
        </ol>

        <div class="callouts">
          <div class="box mistakes">
            <div class="tag">Common mistakes</div>
            <ul>
              <li>Using airâ€™s evanescent constant <span class="eq" style="display:inline-block;padding:2px 6px;">âˆš(kxÂ²âˆ’k0Â²)</span> instead of the slabâ€™s <span class="eq" style="display:inline-block;padding:2px 6px;">âˆš(kxÂ²âˆ’(|n|k0)Â²)</span>.</li>
              <li>Forgetting that <span class="eq" style="display:inline-block;padding:2px 6px;">n</span> is negative but dispersion uses <span class="eq" style="display:inline-block;padding:2px 6px;">nÂ²</span> (so use <span class="eq" style="display:inline-block;padding:2px 6px;">|n|</span> in the cutoff).</li>
              <li>Mixing â€œminimum periodâ€ <span class="eq" style="display:inline-block;padding:2px 6px;">2Ï€/kx</span> with â€œminimum feature half-periodâ€ <span class="eq" style="display:inline-block;padding:2px 6px;">Ï€/kx</span> without stating which one you mean.</li>
            </ul>
          </div>
          <div class="box keyeq">
            <div class="tag">Quick tip</div>
            <p class="muted" style="margin:6px 0 0;">
              Because both amplification and loss scale as exponentials in <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>, the <strong>threshold</strong> is set by comparing the coefficients:
              <strong><span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> vs <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span></strong>. You donâ€™t need the slab thickness to answer the question asked.
            </p>
          </div>
        </div>
      </section>

      <section id="part3">
        <h2>PART 3 â€” Full Solution (Detailed + Teaching)</h2>

        <article>
          <h3>Physical intuition first</h3>
          <p>
            Subwavelength details correspond to large <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span>. In ordinary materials those components are evanescent and decay rapidly with distance, so they donâ€™t reach an image plane.
            A negative-index slab can support a solution inside the slab where the evanescent amplitude grows with <span class="eq" style="display:inline-block;padding:2px 6px;">z</span>, effectively restoring near-field details.
            However, if the slab is lossy, amplitude also decays. So the key question becomes:
            <em>is the evanescent growth rate larger than the loss rate?</em>
          </p>

          <h3>Step 1 â€” Dispersion relation in the slab (ky = 0)</h3>
          <p>In any homogeneous isotropic medium, the wavevector satisfies:</p>
          <div class="eqrow">
            <div class="eq" id="eqDisp">kxÂ² + kzÂ² = (n k0)Â²,   with  k0 = 2Ï€/Î»0</div>
            <button class="copyBtn" data-copy="#eqDisp">ğŸ“‹ Copy</button>
          </div>
          <p class="muted">
            Here <span class="eq" style="display:inline-block;padding:2px 6px;">n = âˆ’2</span>, so <span class="eq" style="display:inline-block;padding:2px 6px;">(n k0)Â² = (2k0)Â²</span>. The sign of <span class="eq" style="display:inline-block;padding:2px 6px;">n</span> affects phase/energy directions, but the evanescent cutoff depends on <span class="eq" style="display:inline-block;padding:2px 6px;">nÂ²</span>.
          </p>

          <h3>Step 2 â€” Identify when the field is evanescent inside the slab</h3>
          <p>
            The longitudinal component is
            <span class="eq" style="display:inline-block;padding:2px 6px;">kz = Â±âˆš((n k0)Â² âˆ’ kxÂ²)</span>.
            If <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span>, the square root becomes imaginary and we write:
          </p>
          <div class="eqrow">
            <div class="eq" id="eqBeta">kx &gt; |n|k0  â‡’  kz = iÎ²,  where  Î² = âˆš(kxÂ² âˆ’ (|n|k0)Â²)  (Î²&gt;0)</div>
            <button class="copyBtn" data-copy="#eqBeta">ğŸ“‹ Copy</button>
          </div>
          <p class="muted">
            This <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> is the â€œevanescent rateâ€ inside the slab. In a NIM, boundary conditions can select a <em>growing</em> exponential inside the slab (amplification), rather than a decaying one, which is the mechanism behind near-field â€œsuperlensingâ€.
          </p>

          <h3>Step 3 â€” Model amplification vs attenuation</h3>
          <p>
            Over slab thickness <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>:
          </p>
          <ul>
            <li><strong>Ideal NIM evanescent amplification:</strong> amplitude factor <span class="eq" style="display:inline-block;padding:2px 6px;">A_amp = e^{+Î² d}</span>.</li>
            <li><strong>Material loss attenuation:</strong> amplitude factor <span class="eq" style="display:inline-block;padding:2px 6px;">A_loss = e^{âˆ’Î³ d}</span>.</li>
          </ul>
          <p>So the net multiplicative factor is:</p>
          <div class="eqrow">
            <div class="eq" id="eqNet">A_net = A_amp Â· A_loss = exp[(Î² âˆ’ Î³)d]</div>
            <button class="copyBtn" data-copy="#eqNet">ğŸ“‹ Copy</button>
          </div>
          <p class="muted">
            Interpretation: if <span class="eq" style="display:inline-block;padding:2px 6px;">Î² &gt; Î³</span>, net growth; if <span class="eq" style="display:inline-block;padding:2px 6px;">Î² &lt; Î³</span>, net decay. The threshold is exactly <span class="eq" style="display:inline-block;padding:2px 6px;">Î² = Î³</span>.
          </p>

          <h3>Step 4 â€” Solve the threshold condition Î² = Î³ for kx</h3>
          <p>Set:</p>
          <div class="eq">Î² = âˆš(kxÂ² âˆ’ (|n|k0)Â²) = Î³</div>
          <p>Square both sides (both are nonnegative):</p>
          <div class="eq">kxÂ² âˆ’ (|n|k0)Â² = Î³Â²  â‡’  kxÂ² = (|n|k0)Â² + Î³Â²</div>
          <p>Thus the threshold transverse spatial angular frequency is:</p>
          <div class="eqrow">
            <div class="eq" id="eqKxTh">kx,th = âˆš( (|n|k0)Â² + Î³Â² )</div>
            <button class="copyBtn" data-copy="#eqKxTh">ğŸ“‹ Copy</button>
          </div>

          <h3>Step 5 â€” Insert the numbers (n = âˆ’2, Î³ = 0.1k0)</h3>
          <p>
            Use <span class="eq" style="display:inline-block;padding:2px 6px;">|n| = 2</span> and <span class="eq" style="display:inline-block;padding:2px 6px;">Î³ = 0.1k0</span>:
          </p>
          <div class="eq">kx,th = âˆš( (2k0)Â² + (0.1k0)Â² ) = k0 âˆš(4 + 0.01) = k0 âˆš(4.01)</div>
          <div class="eqrow" style="margin-top:8px;">
            <div class="eq" id="eqNum">kx,th/k0 = âˆš(4.01) â‰ˆ 2.002498...</div>
            <button class="copyBtn" data-copy="#eqNum">ğŸ“‹ Copy</button>
          </div>

          <div class="box answer" style="margin-top:12px;">
            <div class="tag">Final answer (threshold)</div>
            <div class="eq" id="final1">kx,th/k0 = âˆš(4.01) â‰ˆ 2.0025</div>
            <p class="muted" style="margin:8px 0 0;">
              For <span class="eq" style="display:inline-block;padding:2px 6px;">kx/k0</span> only slightly above <span class="eq" style="display:inline-block;padding:2px 6px;">2</span>, the evanescent amplification coefficient <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> is already smaller than the loss coefficient <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>, so the slab cannot effectively boost those higher-detail components.
            </p>
            <div class="eqrow" style="margin-top:10px;">
              <button class="copyBtn" data-copy="#final1">ğŸ“‹ Copy threshold</button>
              <button class="copyBtn" data-copy="#final2">ğŸ“‹ Copy resolution</button>
            </div>
          </div>

          <h3>Step 6 â€” Convert kx,max to a resolution in units of wavelength</h3>
          <p>
            A common Fourier-optics way to relate maximum transferable transverse spatial angular frequency to a smallest resolvable transverse <em>period</em> is:
          </p>
          <div class="eq">Î”x â‰ˆ 2Ï€ / kx,max</div>
          <p>
            Here the threshold is the point beyond which loss dominates, so we take
            <span class="eq" style="display:inline-block;padding:2px 6px;">kx,max â‰ˆ kx,th</span>.
            Then:
          </p>
          <div class="eq">Î”x/Î»0 = (2Ï€/kx,max) / (2Ï€/k0) = k0/kx,max</div>
          <p>Insert <span class="eq" style="display:inline-block;padding:2px 6px;">kx,max/k0 â‰ˆ 2.0025</span>:</p>
          <div class="eqrow">
            <div class="eq" id="final2">Î”x/Î»0 â‰ˆ 1/(kx,max/k0) â‰ˆ 1/2.0025 â‰ˆ 0.499</div>
            <button class="copyBtn" data-copy="#final2">ğŸ“‹ Copy</button>
          </div>

          <div class="box keyeq" style="margin-top:12px;">
            <div class="tag">Resolution note (convention)</div>
            <p class="muted" style="margin:6px 0 0;">
              If you instead define â€œfeature sizeâ€ as a <em>half-period</em> (often used as a rough â€œminimum line widthâ€),
              you would use <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x_half â‰ˆ Ï€/kx,max</span>,
              which would give <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x_half/Î»0 â‰ˆ 0.249</span>.
              In this article we report the <strong>minimum resolvable period</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">2Ï€/kx</span> unless stated otherwise.
            </p>
          </div>

          <h3>Sanity checks</h3>
          <ul>
            <li><strong>Units:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span>, <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>, and <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> are all inverse length. The equation <span class="eq" style="display:inline-block;padding:2px 6px;">kxÂ² = (|n|k0)Â² + Î³Â²</span> is dimensionally consistent.</li>
            <li><strong>Limiting case Î³ â†’ 0:</strong> then <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th â†’ |n|k0 = 2k0</span>. With no loss, the threshold collapses to the evanescent-in-slab cutoff.</li>
            <li><strong>More loss (larger Î³):</strong> threshold <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th</span> increases slightly, but the corresponding resolution <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x/Î»0 = k0/kx,th</span> worsens (increases) toward ~1/|n| at small Î³ and degrades further as Î³ rises.</li>
          </ul>

          <p class="muted">
            Connection to the visuals below: the main plot shows <span class="eq" style="display:inline-block;padding:2px 6px;">Î²/k0</span> vs <span class="eq" style="display:inline-block;padding:2px 6px;">kx/k0</span> and the horizontal line <span class="eq" style="display:inline-block;padding:2px 6px;">Î³/k0</span>. Their intersection is exactly the threshold <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th</span>.
          </p>
        </article>

        <figure>
          <div class="figHead">
            <div class="cap">Interactive visualization (diagram + plots) â€” adjust loss and index magnitude</div>
            <div class="controls" role="group" aria-label="Interactive controls">
              <div class="ctrl" title="Loss coefficient as a fraction of k0">
                <span>Î³/k0</span>
                <input id="gammaSlider" type="range" min="0" max="0.6" step="0.005" value="0.1" />
                <span id="gammaVal" style="min-width:4ch;text-align:right;font-weight:700;color:var(--ink);">0.10</span>
              </div>
              <div class="ctrl" title="Magnitude of refractive index |n| (n is negative in this problem)">
                <span>|n|</span>
                <select id="nSelect" aria-label="Index magnitude">
                  <option value="1">1</option>
                  <option value="1.5">1.5</option>
                  <option value="2" selected>2</option>
                  <option value="2.5">2.5</option>
                  <option value="3">3</option>
                </select>
              </div>
              <div class="ctrl" title="Example slab thickness in units of Î»0 (used only to show net gain exp[(Î²-Î³)d])">
                <span>d/Î»0</span>
                <input id="dSlider" type="range" min="0.1" max="1.5" step="0.05" value="0.5" />
                <span id="dVal" style="min-width:4ch;text-align:right;font-weight:700;color:var(--ink);">0.50</span>
              </div>
            </div>
          </div>
          <canvas id="diagramCanvas" aria-label="Diagram of NIM slab imaging geometry"></canvas>
          <canvas id="mainPlot" aria-label="Main plot: beta and gamma vs kx" class="smallCanvas"></canvas>
          <canvas id="secondaryPlot" aria-label="Secondary plot: resolution vs loss" class="smallCanvas"></canvas>
          <div class="note">
            <strong>Example values:</strong> The slider changes <span class="eq" style="display:inline-block;padding:2px 6px;">Î³/k0</span> and the plots update live.
            The thickness slider <span class="eq" style="display:inline-block;padding:2px 6px;">d/Î»0</span> is used only to illustrate the net factor <span class="eq" style="display:inline-block;padding:2px 6px;">exp[(Î²âˆ’Î³)d]</span> (the threshold itself does not depend on <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>).
          </div>
        </figure>
      </section>

      <section id="part4">
        <h2>PART 4 â€” Deeper Understanding (Theory Around the Result)</h2>

        <article>
          <h3>Re-interpreting the final formula</h3>
          <p>
            The threshold
            <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th = âˆš((|n|k0)Â² + Î³Â²)</span>
            can be read as a Pythagorean â€œvector sumâ€ between:
          </p>
          <ul>
            <li><span class="eq" style="display:inline-block;padding:2px 6px;">|n|k0</span>: the slabâ€™s natural propagating cutoff in transverse wavenumber.</li>
            <li><span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>: how hard loss pushes the system toward decay.</li>
          </ul>
          <p>
            Because <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span> adds in quadrature, small losses slightly increase <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th</span> above <span class="eq" style="display:inline-block;padding:2px 6px;">|n|k0</span>,
            but the core message remains: <strong>the practical recoverable spatial spectrum is capped near <span class="eq" style="display:inline-block;padding:2px 6px;">kx/k0 â‰ˆ |n|</span></strong> unless losses are extremely tiny.
          </p>

          <h3>How changing parameters affects the outcome (connect to plots)</h3>
          <ul>
            <li><strong>Increase loss Î³:</strong> the horizontal line <span class="eq" style="display:inline-block;padding:2px 6px;">Î³/k0</span> rises. The intersection with <span class="eq" style="display:inline-block;padding:2px 6px;">Î²/k0</span> shifts to slightly larger <span class="eq" style="display:inline-block;padding:2px 6px;">kx/k0</span>, but the <strong>net gain</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">exp[(Î²âˆ’Î³)d]</span> becomes negative over more of the spectrum.</li>
            <li><strong>Increase |n|:</strong> the slab cutoff moves right, letting larger transverse frequencies become propagating/less-evanescent inside; the <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> curve changes shape and the resolution bound improves (smaller <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x/Î»0</span>).</li>
            <li><strong>Increase thickness d:</strong> does <em>not</em> change the threshold, but it magnifies whichever side wins: if <span class="eq" style="display:inline-block;padding:2px 6px;">Î²&gt;Î³</span>, net growth becomes stronger; if <span class="eq" style="display:inline-block;padding:2px 6px;">Î²&lt;Î³</span>, decay becomes more severe.</li>
          </ul>

          <h3>Alternative derivation idea (brief)</h3>
          <p class="muted">
            A more complete method is to derive the slabâ€™s <em>transfer function</em> for each spatial frequency, including Fresnel coefficients and multiple reflections, treating the index as complex.
            The resulting transmission magnitude still contains exponentials of the form <span class="eq" style="display:inline-block;padding:2px 6px;">exp(Â±Î²d)</span> and <span class="eq" style="display:inline-block;padding:2px 6px;">exp(âˆ’Î³d)</span>,
            and the same â€œrate comparisonâ€ threshold emerges as the point where the exponent changes sign.
          </p>

          <h3>Concept checks (quick self-test)</h3>
          <ul>
            <li><strong>Q:</strong> Why does higher <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> mean finer detail? <br><strong>A:</strong> The transverse period is <span class="eq" style="display:inline-block;padding:2px 6px;">2Ï€/kx</span>, so larger <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span> corresponds to shorter spatial variations.</li>
            <li><strong>Q:</strong> What sets the evanescent-in-slab condition? <br><strong>A:</strong> The slab dispersion: <span class="eq" style="display:inline-block;padding:2px 6px;">kx &gt; |n|k0</span> makes <span class="eq" style="display:inline-block;padding:2px 6px;">kz</span> imaginary.</li>
            <li><strong>Q:</strong> Why is the threshold independent of thickness <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>? <br><strong>A:</strong> Both effects are exponentials in <span class="eq" style="display:inline-block;padding:2px 6px;">d</span>, so comparing which dominates depends only on <span class="eq" style="display:inline-block;padding:2px 6px;">Î²</span> vs <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span>.</li>
            <li><strong>Q:</strong> If <span class="eq" style="display:inline-block;padding:2px 6px;">Î³</span> doubles, what happens to <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x/Î»0</span>? <br><strong>A:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th</span> increases, so <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x/Î»0 = k0/kx,th</span> decreases slightlyâ€”but the net gain becomes worse over most of the spectrum; practically, usable resolution typically degrades.</li>
          </ul>
        </article>
      </section>

      <section id="part5">
        <h2>PART 5 â€” Visualization Guide (How to Read the Plots)</h2>
        <article>
          <h3>Canvas 1 â€” Diagram</h3>
          <ul>
            <li>Shows air â†’ NIM slab â†’ air with an incident evanescent component labeled by <span class="eq" style="display:inline-block;padding:2px 6px;">kx</span>.</li>
            <li>The diagram emphasizes the difference between transverse variation (along <span class="eq" style="display:inline-block;padding:2px 6px;">x</span>) and longitudinal behavior (along <span class="eq" style="display:inline-block;padding:2px 6px;">z</span>).</li>
          </ul>

          <h3>Canvas 2 â€” Main quantitative plot</h3>
          <ul>
            <li><strong>x-axis:</strong> <span class="eq" style="display:inline-block;padding:2px 6px;">kx/k0</span>.</li>
            <li><strong>y-axis:</strong> rates <span class="eq" style="display:inline-block;padding:2px 6px;">Î²/k0</span> (curve) and <span class="eq" style="display:inline-block;padding:2px 6px;">Î³/k0</span> (horizontal line).</li>
            <li>The intersection point is <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th/k0</span>.</li>
            <li>A shaded â€œnet gainâ€ indicator uses <span class="eq" style="display:inline-block;padding:2px 6px;">exp[(Î²âˆ’Î³)d]</span> (example thickness slider) to show where amplification would or would not win.</li>
          </ul>

          <h3>Canvas 3 â€” Secondary plot (parameter sweep)</h3>
          <ul>
            <li>Plots the predicted resolution proxy <span class="eq" style="display:inline-block;padding:2px 6px;">Î”x/Î»0 = k0/kx,th</span> versus <span class="eq" style="display:inline-block;padding:2px 6px;">Î³/k0</span>.</li>
            <li>As you move the <span class="eq" style="display:inline-block;padding:2px 6px;">Î³/k0</span> slider, the dot moves and the curve updates if you change <span class="eq" style="display:inline-block;padding:2px 6px;">|n|</span>.</li>
          </ul>

          <h3>Interactive controls</h3>
          <ul>
            <li><strong>Î³/k0 slider:</strong> raises/lowers the attenuation line in the main plot and shifts the threshold <span class="eq" style="display:inline-block;padding:2px 6px;">kx,th</span>.</li>
            <li><strong>|n| selector:</strong> changes the slab evanescent cutoff <span class="eq" style="display:inline-block;padding:2px 6px;">|n|</span>, reshaping <span class="eq" style="display:inline-block;padding:2px 6px;">Î²(kx)</span> and the resolution curve.</li>
            <li><strong>d/Î»0 slider (example):</strong> only affects the illustrative net factor <span class="eq" style="display:inline-block;padding:2px 6px;">exp[(Î²âˆ’Î³)d]</span>, not the threshold point.</li>
          </ul>
        </article>
      </section>

      <section>
        <h2>Final Answer (Collected)</h2>
        <div class="box answer">
          <div class="tag">Final answer</div>
          <div class="eq" id="finalAll">Threshold where amplification equals attenuation:
Î² = Î³ â‡’ kx,th = âˆš((|n|k0)Â² + Î³Â²).
With |n|=2 and Î³=0.1k0:
kx,th/k0 = âˆš(4.01) â‰ˆ 2.0025.

Corresponding resolution estimate (minimum resolvable period):
Î”x â‰ˆ 2Ï€/kx,max with kx,maxâ‰ˆkx,th â‡’ Î”x/Î»0 = k0/kx,th â‰ˆ 1/2.0025 â‰ˆ 0.499 â‰ˆ 0.50Î»0.</div>
          <div class="eqrow" style="margin-top:10px;">
            <button class="copyBtn" data-copy="#finalAll">ğŸ“‹ Copy final answer</button>
          </div>
          <div class="copyMsg" data-copymsg></div>
        </div>
      </section>

    </div>
  </div>
</main>

<footer>
  <div class="wrap">
    <p style="margin:0;">
      Built as a self-contained learning article (vanilla HTML/CSS/JS). Use the interactive plots to build intuition about how loss limits near-field â€œsuperlensing.â€
    </p>
  </div>
</footer>

<script>
(function(){
  // ---------- Copy buttons ----------
  const msgTargets = document.querySelectorAll('[data-copymsg]');
  function flashMsg(text){
    msgTargets.forEach(el => { el.textContent = text; });
    clearTimeout(flashMsg._t);
    flashMsg._t = setTimeout(()=> msgTargets.forEach(el=> el.textContent=""), 1200);
  }
  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('.copyBtn');
    if(!btn) return;
    const sel = btn.getAttribute('data-copy');
    const node = document.querySelector(sel);
    if(!node) return;
    const txt = node.textContent.replace(/\u00A0/g,' ').trim();
    try{
      await navigator.clipboard.writeText(txt);
      flashMsg('Copied âœ“');
    }catch(err){
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = txt;
      ta.style.position='fixed';
      ta.style.left='-9999px';
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand('copy'); flashMsg('Copied âœ“'); }
      catch(e2){ flashMsg('Copy failed'); }
      document.body.removeChild(ta);
    }
  });

  // ---------- Math helpers ----------
  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  // Normalized quantities: K = kx/k0, N = |n|, g = gamma/k0, dbar = d/Î»0
  function betaBar(K, N){
    // beta/k0 for evanescent-in-slab regime (K > N)
    if(K <= N) return 0;
    return Math.sqrt(K*K - N*N);
  }
  function Kthreshold(N, g){
    return Math.sqrt(N*N + g*g);
  }
  function resolutionPeriodOverLambda(Kmax){
    // Î”x/Î»0 for minimum resolvable *period* Î”x = 2Ï€/kx ; k0=2Ï€/Î»0 => Î”x/Î»0 = k0/kx = 1/(kx/k0)=1/K
    return 1 / Kmax;
  }
  function netGain(K, N, g, dbar){
    // exp[(Î² - Î³) d]. Need d in meters: d = dbar*Î»0 ; Î² = (betaBar*k0), Î³ = g*k0.
    // exponent = (betaBar - g)*k0*d = (betaBar - g)*(2Ï€/Î»0)*(dbar*Î»0) = 2Ï€ dbar (betaBar - g)
    const bb = betaBar(K,N);
    const expo = 2*Math.PI*dbar*(bb - g);
    // clamp to avoid overflow in plotting
    return Math.exp(clamp(expo, -40, 40));
  }

  // ---------- Canvas utilities ----------
  function setupCanvas(canvas){
    const ctx = canvas.getContext('2d');
    function resize(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.max(1, Math.floor(rect.width * dpr));
      canvas.height = Math.max(1, Math.floor(rect.height * dpr));
      ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
    }
    resize();
    return {ctx, resize};
  }

  function drawAxes(ctx, w, h, plot){
    // plot: {x0,y0,x1,y1,xMin,xMax,yMin,yMax, xLabel, yLabel, title}
    const {x0,y0,x1,y1,xMin,xMax,yMin,yMax} = plot;
    // background
    ctx.save();
    ctx.clearRect(0,0,w,h);

    // panel bg
    ctx.fillStyle = 'rgba(11,16,32,0.20)';
    ctx.fillRect(0,0,w,h);

    // Title
    ctx.fillStyle = 'rgba(233,236,255,0.95)';
    ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText(plot.title, 12, 20);

    // Plot area
    ctx.strokeStyle = 'rgba(233,236,255,0.14)';
    ctx.lineWidth = 1;
    roundRect(ctx, x0, y0, x1-x0, y1-y0, 14);
    ctx.stroke();

    // ticks & grid
    const nx = 6, ny = 5;
    ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    for(let i=0;i<=nx;i++){
      const t = i/nx;
      const x = x0 + t*(x1-x0);
      // grid
      ctx.strokeStyle = 'rgba(233,236,255,0.08)';
      ctx.beginPath(); ctx.moveTo(x,y0); ctx.lineTo(x,y1); ctx.stroke();
      // tick label
      const xv = xMin + t*(xMax-xMin);
      ctx.fillStyle = 'rgba(185,192,255,0.90)';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText(trimTick(xv), x, y1+6);
    }
    for(let j=0;j<=ny;j++){
      const t = j/ny;
      const y = y1 - t*(y1-y0);
      ctx.strokeStyle = 'rgba(233,236,255,0.08)';
      ctx.beginPath(); ctx.moveTo(x0,y); ctx.lineTo(x1,y); ctx.stroke();
      const yv = yMin + t*(yMax-yMin);
      ctx.fillStyle = 'rgba(185,192,255,0.90)';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      ctx.fillText(trimTick(yv), x0-8, y);
    }

    // axis labels
    ctx.fillStyle = 'rgba(233,236,255,0.85)';
    ctx.textAlign='center';
    ctx.textBaseline='bottom';
    ctx.fillText(plot.xLabel, (x0+x1)/2, h-8);

    ctx.save();
    ctx.translate(14, (y0+y1)/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign='center';
    ctx.textBaseline='top';
    ctx.fillText(plot.yLabel, 0, 0);
    ctx.restore();

    ctx.restore();
  }

  function trimTick(v){
    // Pretty tick labels
    const av = Math.abs(v);
    if(av >= 10) return v.toFixed(1);
    if(av >= 1) return v.toFixed(2);
    if(av >= 0.1) return v.toFixed(2);
    return v.toFixed(3);
  }

  function roundRect(ctx,x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
  }

  function mapX(x, plot){
    const {x0,x1,xMin,xMax} = plot;
    return x0 + (x - xMin)/(xMax-xMin) * (x1-x0);
  }
  function mapY(y, plot){
    const {y0,y1,yMin,yMax} = plot;
    return y1 - (y - yMin)/(yMax-yMin) * (y1-y0);
  }

  function drawLegend(ctx, items, x, y){
    // items: [{label, color}]
    ctx.save();
    ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign='left';
    ctx.textBaseline='middle';

    const pad=10, lineH=18;
    const w = Math.max(...items.map(it => ctx.measureText(it.label).width)) + 48;
    const h = items.length*lineH + pad*2;
    ctx.fillStyle='rgba(11,16,32,0.55)';
    ctx.strokeStyle='rgba(233,236,255,0.14)';
    ctx.lineWidth=1;
    roundRect(ctx, x, y, w, h, 12);
    ctx.fill();
    ctx.stroke();

    items.forEach((it,i)=>{
      const yy = y + pad + i*lineH + lineH/2;
      ctx.strokeStyle = it.color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(x+12, yy);
      ctx.lineTo(x+30, yy);
      ctx.stroke();

      ctx.fillStyle='rgba(233,236,255,0.92)';
      ctx.fillText(it.label, x+36, yy);
    });
    ctx.restore();
  }

  // ---------- Draw diagram ----------
  function drawDiagram(ctx, w, h, params){
    const {N, g, dbar} = params;
    ctx.clearRect(0,0,w,h);

    // background
    ctx.fillStyle='rgba(11,16,32,0.18)';
    ctx.fillRect(0,0,w,h);

    // Title
    ctx.fillStyle='rgba(233,236,255,0.95)';
    ctx.font='600 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText('Setup diagram: air â†’ lossy negative-index slab (NIM) â†’ air', 12, 20);

    const pad=22;
    const x0=pad, x1=w-pad;
    const y0=44, y1=h-pad;
    const midY=(y0+y1)/2;

    // Regions
    const slabW = (x1-x0)*0.34;
    const slabX0 = x0 + (x1-x0)*0.33;
    const slabX1 = slabX0 + slabW;

    // Air regions
    ctx.fillStyle='rgba(125,211,252,0.06)';
    ctx.strokeStyle='rgba(125,211,252,0.20)';
    ctx.lineWidth=1;
    roundRect(ctx, x0, y0, slabX0-x0-8, y1-y0, 16);
    ctx.fill(); ctx.stroke();

    roundRect(ctx, slabX1+8, y0, x1-(slabX1+8), y1-y0, 16);
    ctx.fill(); ctx.stroke();

    // Slab region
    ctx.fillStyle='rgba(167,139,250,0.10)';
    ctx.strokeStyle='rgba(167,139,250,0.35)';
    ctx.lineWidth=1.5;
    roundRect(ctx, slabX0, y0, slabX1-slabX0, y1-y0, 16);
    ctx.fill(); ctx.stroke();

    // Labels
    ctx.font='600 13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillStyle='rgba(185,192,255,0.95)';
    ctx.textAlign='center';
    ctx.fillText('air (n=1)', (x0+slabX0)/2, y0+18);
    ctx.fillText('NIM slab', (slabX0+slabX1)/2, y0+18);
    ctx.fillText('air (n=1)', (slabX1+x1)/2, y0+18);

    ctx.font='12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillStyle='rgba(185,192,255,0.92)';
    ctx.fillText('n = âˆ’' + N.toFixed(2) + ' (shown as |n| = ' + N.toFixed(2) + ')', (slabX0+slabX1)/2, y0+38);
    ctx.fillText('loss: Î³/k0 = ' + g.toFixed(3), (slabX0+slabX1)/2, y0+56);
    ctx.fillText('example thickness: d/Î»0 = ' + dbar.toFixed(2), (slabX0+slabX1)/2, y0+74);

    // Axis line z
    ctx.strokeStyle='rgba(233,236,255,0.18)';
    ctx.lineWidth=1;
    ctx.beginPath();
    ctx.moveTo(x0+10, midY);
    ctx.lineTo(x1-10, midY);
    ctx.stroke();

    ctx.fillStyle='rgba(233,236,255,0.75)';
    ctx.textAlign='left';
    ctx.fillText('z â†’', x1-46, midY-8);

    // Evanescent wave sketch: wiggles along x, exponential along z
    // Incident "field" envelope decays in air toward slab
    const waveStartX = x0+20;
    const waveEndX = slabX0-10;
    const amp0 = 28;
    const steps = 120;

    // Envelope + oscillation
    ctx.save();
    ctx.translate(0, midY);
    ctx.strokeStyle='rgba(125,211,252,0.85)';
    ctx.lineWidth=2;

    ctx.beginPath();
    for(let i=0;i<=steps;i++){
      const t = i/steps;
      const x = waveStartX + t*(waveEndX-waveStartX);
      const env = amp0 * Math.exp(-2.4*t); // decay toward slab
      const y = Math.sin(2*Math.PI*3.0*t) * env * 0.25;
      if(i===0) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    }
    ctx.stroke();

    // Growing inside slab (if evanescent-in-slab) + loss indicator
    const inStartX = slabX0+10;
    const inEndX = slabX1-10;
    ctx.strokeStyle='rgba(167,139,250,0.95)';
    ctx.lineWidth=2;

    ctx.beginPath();
    for(let i=0;i<=steps;i++){
      const t = i/steps;
      const x = inStartX + t*(inEndX-inStartX);
      const env = amp0 * (0.55 + 0.85*t); // depict "amplification"
      const y = Math.sin(2*Math.PI*3.0*t) * env * 0.22;
      if(i===0) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    }
    ctx.stroke();

    // Output side: show that it may or may not be restored (illustrative)
    const outStartX = slabX1+10;
    const outEndX = x1-20;
    ctx.strokeStyle='rgba(52,211,153,0.95)';
    ctx.lineWidth=2;

    ctx.beginPath();
    for(let i=0;i<=steps;i++){
      const t = i/steps;
      const x = outStartX + t*(outEndX-outStartX);
      const env = amp0 * 0.55 * Math.exp(-1.6*t);
      const y = Math.sin(2*Math.PI*3.0*t) * env * 0.22;
      if(i===0) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    }
    ctx.stroke();

    ctx.restore();

    // kx arrow (transverse)
    const ax = slabX0 + slabW*0.5;
    const ay = y1 - 42;
    ctx.strokeStyle='rgba(233,236,255,0.85)';
    ctx.lineWidth=2;
    arrow(ctx, ax-55, ay, ax+55, ay);
    ctx.fillStyle='rgba(233,236,255,0.85)';
    ctx.font='600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign='center';
    ctx.fillText('transverse variation â†’ kx', ax, ay-10);

    // kz / beta annotation
    ctx.textAlign='left';
    ctx.fillStyle='rgba(185,192,255,0.92)';
    ctx.font='12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText('In slab (evanescent): kz = iÎ²,  Î² = âˆš(kxÂ² âˆ’ (|n|k0)Â²)', slabX0+12, y1-18);

    // Boundary lines
    ctx.strokeStyle='rgba(233,236,255,0.20)';
    ctx.lineWidth=1;
    ctx.setLineDash([6,6]);
    ctx.beginPath(); ctx.moveTo(slabX0, y0); ctx.lineTo(slabX0, y1); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(slabX1, y0); ctx.lineTo(slabX1, y1); ctx.stroke();
    ctx.setLineDash([]);

    // helper arrow function
    function arrow(ctx, xA,yA,xB,yB){
      const dx=xB-xA, dy=yB-yA;
      const L=Math.hypot(dx,dy)||1;
      const ux=dx/L, uy=dy/L;
      const head=10;
      ctx.beginPath();
      ctx.moveTo(xA,yA);
      ctx.lineTo(xB,yB);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(xB,yB);
      ctx.lineTo(xB-head*ux + head*0.5*(-uy), yB-head*uy + head*0.5*(ux));
      ctx.lineTo(xB-head*ux - head*0.5*(-uy), yB-head*uy - head*0.5*(ux));
      ctx.closePath();
      ctx.fillStyle=ctx.strokeStyle;
      ctx.fill();
    }
  }

  // ---------- Main plot ----------
  function drawMainPlot(ctx, w, h, params){
    const {N, g, dbar} = params;

    const plot = {
      title: 'Main plot: evanescent growth rate Î²/k0 vs transverse frequency kx/k0 (and loss line Î³/k0)',
      xLabel: 'kx/k0 (dimensionless)',
      yLabel: 'rate (dimensionless): Î²/k0 and Î³/k0',
      xMin: 0,
      xMax: Math.max(4.5, N+2.2),
      yMin: 0,
      yMax: 2.2,
      x0: 64,
      y0: 44,
      x1: w-18,
      y1: h-52
    };

    drawAxes(ctx, w, h, plot);

    // Shade region where net gain > 1 for chosen dbar (illustrative)
    // We'll shade in plot area where (Î² - Î³) > 0
    ctx.save();
    const x0=plot.x0, x1=plot.x1, y0=plot.y0, y1=plot.y1;
    ctx.beginPath();
    roundRect(ctx, x0, y0, x1-x0, y1-y0, 14);
    ctx.clip();

    // Create shading stripes for net gain
    const steps=220;
    for(let i=0;i<steps;i++){
      const K = plot.xMin + (i/(steps-1))*(plot.xMax-plot.xMin);
      const bb = betaBar(K,N);
      const sign = (bb - g);
      const xA = mapX(K, plot);
      const xB = mapX(plot.xMin + ((i+1)/(steps-1))*(plot.xMax-plot.xMin), plot);

      if(sign > 0){
        ctx.fillStyle='rgba(52,211,153,0.07)';
      }else{
        ctx.fillStyle='rgba(251,113,133,0.06)';
      }
      ctx.fillRect(xA, y0, Math.max(1, xB-xA), y1-y0);
    }

    // Plot Î² curve
    ctx.strokeStyle='rgba(167,139,250,0.95)';
    ctx.lineWidth=2.5;
    ctx.beginPath();
    for(let i=0;i<=steps;i++){
      const K = plot.xMin + (i/steps)*(plot.xMax-plot.xMin);
      const y = betaBar(K,N);
      const X = mapX(K, plot);
      const Y = mapY(y, plot);
      if(i===0) ctx.moveTo(X,Y);
      else ctx.lineTo(X,Y);
    }
    ctx.stroke();

    // Plot Î³ line
    ctx.strokeStyle='rgba(125,211,252,0.95)';
    ctx.lineWidth=2.2;
    const yg = mapY(g, plot);
    ctx.beginPath();
    ctx.moveTo(plot.x0, yg);
    ctx.lineTo(plot.x1, yg);
    ctx.stroke();

    // Intersection Kth
    const Kth = Kthreshold(N,g);
    const xth = mapX(Kth, plot);
    const yth = mapY(g, plot);
    // vertical marker
    ctx.strokeStyle='rgba(233,236,255,0.55)';
    ctx.lineWidth=1.2;
    ctx.setLineDash([6,6]);
    ctx.beginPath();
    ctx.moveTo(xth, plot.y0);
    ctx.lineTo(xth, plot.y1);
    ctx.stroke();
    ctx.setLineDash([]);

    // marker dot
    ctx.fillStyle='rgba(233,236,255,0.95)';
    ctx.beginPath();
    ctx.arc(xth, yth, 4.8, 0, Math.PI*2);
    ctx.fill();

    // label
    ctx.fillStyle='rgba(233,236,255,0.92)';
    ctx.font='600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign='left';
    const label = `threshold: kx,th/k0 = ${Kth.toFixed(4)} (Î²=Î³)`;
    ctx.fillText(label, clamp(xth+10, plot.x0+6, plot.x1-250), clamp(yth-10, plot.y0+16, plot.y1-6));

    // show net gain at threshold and a couple sample points (illustrative)
    ctx.font='12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillStyle='rgba(185,192,255,0.92)';
    const Gth = netGain(Kth,N,g,dbar);
    ctx.fillText(`example net factor at threshold exp[(Î²âˆ’Î³)d] = ${Gth.toFixed(3)} (should be ~1)`, plot.x0+6, plot.y0+16);

    // Legend
    drawLegend(ctx,
      [
        {label:'Î²/k0 = âˆš((kx/k0)Â² âˆ’ |n|Â²)  (for kx/k0 > |n|)', color:'rgba(167,139,250,0.95)'},
        {label:'Î³/k0 (loss line)', color:'rgba(125,211,252,0.95)'}
      ],
      plot.x0 + 10,
      plot.y0 + 26
    );

    // Add cutoff marker at K=|n|
    const xcut = mapX(N, plot);
    ctx.strokeStyle='rgba(251,191,36,0.60)';
    ctx.lineWidth=1.5;
    ctx.setLineDash([4,6]);
    ctx.beginPath(); ctx.moveTo(xcut, plot.y0); ctx.lineTo(xcut, plot.y1); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='rgba(251,191,36,0.95)';
    ctx.font='600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign='center';
    ctx.fillText('kx/k0 = |n| cutoff', xcut, plot.y1+22);

    // axes boundary already drawn by drawAxes; restore
    ctx.restore();
  }

  // ---------- Secondary plot ----------
  function drawSecondaryPlot(ctx, w, h, params){
    const {N, g} = params;

    const gMax = 0.6;
    const plot = {
      title: 'Secondary plot: predicted resolution proxy Î”x/Î»0 vs loss Î³/k0 (using kx,th)',
      xLabel: 'Î³/k0 (dimensionless)',
      yLabel: 'Î”x/Î»0 (minimum resolvable period)',
      xMin: 0,
      xMax: gMax,
      yMin: 0.15,
      yMax: 1.05,
      x0: 64,
      y0: 44,
      x1: w-18,
      y1: h-52
    };

    drawAxes(ctx, w, h, plot);

    ctx.save();
    ctx.beginPath();
    roundRect(ctx, plot.x0, plot.y0, plot.x1-plot.x0, plot.y1-plot.y0, 14);
    ctx.clip();

    // curve Î”x/Î»0 = 1/Kth = 1/sqrt(N^2 + g^2)
    const steps=300;
    ctx.strokeStyle='rgba(52,211,153,0.95)';
    ctx.lineWidth=2.6;
    ctx.beginPath();
    for(let i=0;i<=steps;i++){
      const gg = plot.xMin + (i/steps)*(plot.xMax-plot.xMin);
      const Kth = Kthreshold(N, gg);
      const y = resolutionPeriodOverLambda(Kth);
      const X = mapX(gg, plot);
      const Y = mapY(y, plot);
      if(i===0) ctx.moveTo(X,Y);
      else ctx.lineTo(X,Y);
    }
    ctx.stroke();

    // current point at selected g
    const KthNow = Kthreshold(N, g);
    const yNow = resolutionPeriodOverLambda(KthNow);
    const xNow = mapX(g, plot);
    const YNow = mapY(yNow, plot);

    ctx.fillStyle='rgba(233,236,255,0.95)';
    ctx.beginPath(); ctx.arc(xNow, YNow, 5.2, 0, Math.PI*2); ctx.fill();

    // annotation
    ctx.fillStyle='rgba(233,236,255,0.92)';
    ctx.font='600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.textAlign='left';
    ctx.fillText(`at Î³/k0=${g.toFixed(3)} â†’ kx,th/k0=${KthNow.toFixed(4)} â†’ Î”x/Î»0=${yNow.toFixed(3)}`,
      clamp(xNow+10, plot.x0+8, plot.x1-320),
      clamp(YNow-10, plot.y0+16, plot.y1-6)
    );

    // Reference line at 1/|n| (Î³â†’0 limit)
    const yLim = 1/N;
    ctx.strokeStyle='rgba(167,139,250,0.55)';
    ctx.lineWidth=1.8;
    ctx.setLineDash([6,6]);
    ctx.beginPath();
    ctx.moveTo(plot.x0, mapY(yLim, plot));
    ctx.lineTo(plot.x1, mapY(yLim, plot));
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='rgba(167,139,250,0.92)';
    ctx.textAlign='right';
    ctx.font='12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText(`Î³â†’0 limit: Î”x/Î»0 â†’ 1/|n| = ${yLim.toFixed(3)}`, plot.x1-6, mapY(yLim, plot)-6);

    // Legend
    drawLegend(ctx,
      [
        {label:'Î”x/Î»0 = 1/âˆš(|n|Â² + (Î³/k0)Â²)', color:'rgba(52,211,153,0.95)'},
      ],
      plot.x0 + 10,
      plot.y0 + 26
    );

    ctx.restore();
  }

  // ---------- Orchestrate ----------
  const diagram = setupCanvas(document.getElementById('diagramCanvas'));
  const mainPlot = setupCanvas(document.getElementById('mainPlot'));
  const secondaryPlot = setupCanvas(document.getElementById('secondaryPlot'));

  const gammaSlider = document.getElementById('gammaSlider');
  const gammaVal = document.getElementById('gammaVal');
  const nSelect = document.getElementById('nSelect');
  const dSlider = document.getElementById('dSlider');
  const dVal = document.getElementById('dVal');

  function getParams(){
    return {
      g: parseFloat(gammaSlider.value),
      N: parseFloat(nSelect.value),
      dbar: parseFloat(dSlider.value)
    };
  }

  function render(){
    const params = getParams();
    gammaVal.textContent = params.g.toFixed(2);
    dVal.textContent = params.dbar.toFixed(2);

    // Resize to remain crisp/responsive
    diagram.resize(); mainPlot.resize(); secondaryPlot.resize();

    const dRect = document.getElementById('diagramCanvas').getBoundingClientRect();
    drawDiagram(diagram.ctx, dRect.width, dRect.height, params);

    const mRect = document.getElementById('mainPlot').getBoundingClientRect();
    drawMainPlot(mainPlot.ctx, mRect.width, mRect.height, params);

    const sRect = document.getElementById('secondaryPlot').getBoundingClientRect();
    drawSecondaryPlot(secondaryPlot.ctx, sRect.width, sRect.height, params);

    // Update the collected final answers text to match slider values (for exploration)
    // Keep original problem values in text above; this is just for interactive exploration.
    const Kth = Kthreshold(params.N, params.g);
    const dx = resolutionPeriodOverLambda(Kth);
    // We won't overwrite the main "Final Answer" (it must match the problem).
    // But we can display live values by adding a small badge if desired (not necessary).
  }

  // Resize observer to rerender on layout changes
  const ro = new ResizeObserver(()=>render());
  ro.observe(document.getElementById('diagramCanvas'));
  ro.observe(document.getElementById('mainPlot'));
  ro.observe(document.getElementById('secondaryPlot'));

  gammaSlider.addEventListener('input', render);
  nSelect.addEventListener('change', render);
  dSlider.addEventListener('input', render);

  // initial render
  render();
})();
</script>
</body>
</html>
