<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fourier Transform of Line Functions — Lens Focal-Plane Intensity</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1624;
      --card:#111b2d;
      --text:#e9eef7;
      --muted:#a9b4c7;
      --line:#22304a;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(125,211,252,.14), transparent 55%),
        radial-gradient(900px 700px at 85% 20%, rgba(167,139,250,.12), transparent 55%),
        radial-gradient(900px 700px at 40% 95%, rgba(52,211,153,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #070a10 70%);
      overflow-x:hidden;
    }
    a{color:var(--accent)}
    header{
      position:relative;
      padding: 34px 18px 20px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent);
    }
    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 12px 40px;
    }
    .hero{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap: 14px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .hero{grid-template-columns:1fr}
    }
    h1{
      margin: 0 0 8px;
      font-weight: 800;
      letter-spacing: -0.02em;
      font-size: clamp(24px, 3vw, 38px);
      line-height:1.15;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      line-height:1.55;
      font-size: 15px;
    }
    .chipbar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:14px;
    }
    .chip{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,27,45,.65);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      backdrop-filter: blur(6px);
    }
    .chip b{color:var(--text); font-weight:700}
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel .inner{padding:14px}
    .mini{
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
    }
    .mini strong{color:var(--text)}
    main{
      padding: 18px 0 40px;
    }
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .toc{
      position: sticky;
      top: 12px;
      align-self:start;
      padding: 12px;
    }
    .toc h2{
      font-size: 13px;
      margin: 0 0 10px;
      color: var(--muted);
      letter-spacing:.08em;
      text-transform: uppercase;
    }
    .toc a{
      display:block;
      text-decoration:none;
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid transparent;
      margin: 6px 0;
      background: rgba(17,27,45,.35);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      font-size: 14px;
    }
    .toc a:hover{
      transform: translateY(-1px);
      border-color: rgba(125,211,252,.35);
      background: rgba(125,211,252,.08);
    }
    section{
      scroll-margin-top: 84px;
    }
    .content{
      display:grid;
      gap:14px;
    }
    .card{
      background: rgba(17,27,45,.62);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent);
    }
    .card .hd h3{
      margin:0;
      font-size: 16px;
      letter-spacing:-0.01em;
    }
    .card .bd{
      padding: 14px;
      color: var(--text);
      line-height:1.7;
      font-size: 15px;
    }
    .two{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 860px){
      .two{grid-template-columns:1fr}
    }
    .callout{
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(15,22,36,.55);
    }
    .callout.good{border-color: rgba(52,211,153,.35); background: rgba(52,211,153,.08)}
    .callout.warn{border-color: rgba(251,191,36,.35); background: rgba(251,191,36,.07)}
    .callout.bad{border-color: rgba(251,113,133,.35); background: rgba(251,113,133,.07)}
    .k{
      font-family: var(--mono);
      font-size: 13px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.08);
      padding: 10px 10px;
      border-radius: 14px;
      overflow:auto;
      position:relative;
    }
    .copybtn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(125,211,252,.10);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    .copybtn:hover{transform: translateY(-1px); border-color: rgba(125,211,252,.45); background: rgba(125,211,252,.14)}
    .copyrow{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:8px;
    }
    ul{margin: 10px 0 0 20px}
    li{margin: 6px 0}
    .eqwrap{
      display:grid;
      gap:10px;
    }
    .eq{
      border-left: 3px solid rgba(125,211,252,.65);
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
      border-radius: 14px;
    }
    .eq .lbl{
      color: var(--muted);
      font-size: 12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      margin-bottom:6px;
    }
    .eq code{
      font-family: var(--mono);
      font-size: 13px;
      white-space:pre-wrap;
    }
    figure{margin:0}
    canvas{
      width:100%;
      height:360px;
      display:block;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 16px;
    }
    .vizgrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .viztop{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .controls{
      display:grid;
      grid-template-columns: 1.1fr 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    @media (max-width: 980px){
      .controls{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom:6px;
    }
    .control{
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(15,22,36,.45);
    }
    input[type="range"]{width:100%}
    select, button.small{
      width:100%;
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(17,27,45,.8);
      color: var(--text);
      font-size: 13px;
      outline:none;
    }
    button.small{
      cursor:pointer;
      background: rgba(167,139,250,.10);
    }
    .readout{
      margin-top:8px;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      padding: 4px 8px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      background: rgba(0,0,0,.18);
    }
    .boxfinal{
      border: 1px solid rgba(52,211,153,.35);
      background: rgba(52,211,153,.08);
      border-radius: 18px;
      padding: 12px 12px;
    }
    .boxfinal h4{margin:0 0 8px; font-size: 14px}
    footer{
      border-top:1px solid rgba(255,255,255,.06);
      padding: 18px 12px 30px;
      color: var(--muted);
      font-size: 13px;
    }
    @media print{
      body{background:#fff;color:#000}
      .panel,.card{box-shadow:none}
      .toc{display:none}
      canvas{border:1px solid #bbb}
      .copybtn,.controls,button.small{display:none !important}
      a{color:#000;text-decoration:none}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap hero">
    <div class="panel">
      <div class="inner">
        <h1>Fourier Transform of Line Functions (Lens Focal Plane)</h1>
        <p class="subtitle">
          A thin lens produces (up to a known scaling) the <b>2D Fourier transform</b> of the transparency’s complex amplitude
          transmittance in its focal plane. Here we apply that fact to delta-function “lines” and predict the
          intensity patterns in the object (transparency) plane and in the focal plane.
        </p>
        <div class="chipbar">
          <div class="chip"><b>Given</b> λ = 1&nbsp;µm (= 10<sup>−3</sup>&nbsp;mm)</div>
          <div class="chip"><b>Given</b> f = 100&nbsp;cm (= 1000&nbsp;mm)</div>
          <div class="chip"><b>Cases</b> δ(x−y), δ(x±a), δ(x+a)+jδ(x−a)</div>
          <div class="chip"><b>Key map</b> f<sub>x</sub>=X/(λf), f<sub>y</sub>=Y/(λf)</div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="inner">
        <div class="mini">
          <strong>Quick Summary</strong>
          <ul>
            <li>Object plane intensity is concentrated on the delta “lines” (idealized infinitely thin bright lines).</li>
            <li>Lens focal plane field ∝ 2D Fourier transform <span class="k" style="padding:2px 6px;border-radius:10px">T(fx,fy)</span> evaluated at <span class="k" style="padding:2px 6px;border-radius:10px">fx=X/(λf), fy=Y/(λf)</span>.</li>
            <li><b>δ(x−y)</b> → a bright line in the focal plane along <b>X+Y=0</b>.</li>
            <li><b>δ(x±a)</b> → spectrum on <b>Y=0</b> with <b>cos²</b> fringes; spacing <b>ΔX=λf/(2a)</b> (here 0.5&nbsp;mm when a=1&nbsp;mm).</li>
            <li><b>δ(x+a)+jδ(x−a)</b> → same confinement to <b>Y=0</b> but fringes are <b>phase-shifted</b>: intensity ∝ <b>1+sin(4πaX/(λf))</b>.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap grid">
    <!-- TOC -->
    <aside class="panel toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <a href="#viz">Interactive Visualizations</a>
      <a href="#part1">Part 1 — Problem Analysis</a>
      <a href="#part2">Part 2 — Strategy &amp; Tips</a>
      <a href="#part3">Part 3 — Full Solution</a>
      <a href="#final">Final Results (copy-ready)</a>
    </aside>

    <!-- CONTENT -->
    <div class="content">
      <!-- Visualizations -->
      <section id="viz" class="card">
        <div class="hd">
          <h3>Interactive Visualizations (object plane + focal plane)</h3>
          <div class="copyrow">
            <button class="copybtn" data-copy="fx = X/(λ f), fy = Y/(λ f)&#10;U_f(X,Y) = (e^{ikf}/(i λ f)) T(fx,fy)">Copy key mapping</button>
          </div>
        </div>
        <div class="bd">
          <div class="controls">
            <div class="control">
              <label for="caseSel">Select transparency case</label>
              <select id="caseSel">
                <option value="a">a) t(x,y)=δ(x−y)</option>
                <option value="b" selected>b) t(x,y)=δ(x+a)+δ(x−a)</option>
                <option value="c">c) t(x,y)=δ(x+a)+jδ(x−a)</option>
              </select>
              <div class="readout">
                <span class="badge">λ = <span id="lamRO">1.000</span> µm</span>
                <span class="badge">f = <span id="fRO">100</span> cm</span>
              </div>
            </div>

            <div class="control">
              <label for="aSlider">Line offset a (mm) — affects cases (b,c)</label>
              <input id="aSlider" type="range" min="0.2" max="3.0" step="0.01" value="1.00" />
              <div class="readout">
                <span class="badge">a = <span id="aRO">1.00</span> mm</span>
                <span class="badge">ΔX = <span id="dxRO">0.50</span> mm (fringe period)</span>
              </div>
            </div>

            <div class="control">
              <label for="wSlider">Visualization line-width w (mm) (numerical “delta”)</label>
              <input id="wSlider" type="range" min="0.01" max="0.20" step="0.005" value="0.05" />
              <div class="readout">
                <span class="badge">w = <span id="wRO">0.050</span> mm</span>
                <span class="badge">Tip: smaller w → sharper lines</span>
              </div>
            </div>
          </div>

          <div class="vizgrid" style="margin-top:12px">
            <figure class="callout">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px">
                <div style="color:var(--muted);font-size:12px;letter-spacing:.08em;text-transform:uppercase">Diagram</div>
                <button class="small" id="btnReset">Reset view</button>
              </div>
              <canvas id="setupCanvas" aria-label="Optical setup diagram"></canvas>
              <div class="mini" style="margin-top:8px">
                Lens performs a Fourier transform from the transparency plane to the back focal plane.
                Axes in the focal plane are labeled in <b>mm</b>; they map to spatial frequencies via <b>f<sub>x</sub>=X/(λf)</b>.
              </div>
            </figure>

            <div class="two">
              <figure class="callout">
                <div style="color:var(--muted);font-size:12px;letter-spacing:.08em;text-transform:uppercase;margin-bottom:8px">Secondary plot: Object-plane intensity |t(x,y)|²</div>
                <canvas id="objCanvas" aria-label="Object plane intensity plot"></canvas>
                <div class="mini" style="margin-top:8px">
                  Ideal delta functions are drawn as narrow Gaussians of width <b>w</b> for visualization.
                </div>
              </figure>

              <figure class="callout">
                <div style="color:var(--muted);font-size:12px;letter-spacing:.08em;text-transform:uppercase;margin-bottom:8px">Main plot: Focal-plane intensity cross-section (Y = 0)</div>
                <canvas id="mainCanvas" aria-label="Focal plane intensity cross-section"></canvas>
                <div class="mini" style="margin-top:8px">
                  For cases (b,c) the spectrum is confined to <b>Y=0</b>. For case (a), the bright line is diagonal, so the
                  “Y=0” cut intersects it at the origin.
                </div>
              </figure>
            </div>

            <figure class="callout">
              <div style="color:var(--muted);font-size:12px;letter-spacing:.08em;text-transform:uppercase;margin-bottom:8px">2D focal-plane intensity map I(X,Y)</div>
              <canvas id="focalCanvas" aria-label="Focal plane intensity map"></canvas>
              <div class="mini" style="margin-top:8px">
                Color encodes intensity (normalized). The analytically exact patterns are distributions (delta-lines); the
                map shows a physically realistic “finite width” version.
              </div>
            </figure>
          </div>
        </div>
      </section>

      <!-- PART 1 -->
      <section id="part1" class="card">
        <div class="hd"><h3>PART 1 — Problem Analysis (no solving yet)</h3></div>
        <div class="bd">
          <div class="callout">
            <b>Problem restated.</b>
            A transparency has complex amplitude transmittance <b>t(x,y)</b> and is illuminated by a plane wave of wavelength
            <b>λ = 1 µm</b>. A lens of focal length <b>f = 100 cm</b> forms the Fourier transform of the transmitted field in its focal
            plane. For three given delta-function transmittances, sketch the <b>intensity distribution</b> (i) in the transparency plane and (ii) in the lens focal plane.
            Distances are in <b>mm</b>.
          </div>

          <div class="two" style="margin-top:12px">
            <div class="callout">
              <b>Given quantities</b>
              <ul>
                <li>Wavelength: λ = 1 µm = 10<sup>−3</sup> mm</li>
                <li>Focal length: f = 100 cm = 1000 mm</li>
                <li>Case (b,c) offset: a = 1 mm</li>
                <li>Plane-wave illumination (uniform amplitude, constant phase)</li>
              </ul>
            </div>
            <div class="callout">
              <b>Unknowns / what to find</b>
              <ul>
                <li>Object-plane intensity: I<sub>obj</sub>(x,y) ∝ |t(x,y)|²</li>
                <li>Focal-plane intensity: I<sub>f</sub>(X,Y) ∝ |U<sub>f</sub>(X,Y)|², where U<sub>f</sub> is the lens Fourier transform of t</li>
                <li>Sketch (shape + key features like lines, fringe spacing)</li>
              </ul>
            </div>
          </div>

          <div class="callout" style="margin-top:12px">
            <b>Relevant principles &amp; why they apply</b>
            <ul>
              <li><b>Thin lens Fourier-transform property</b>: With plane-wave illumination and under paraxial/Fraunhofer conditions, the complex field in the back focal plane is proportional to the <b>2D Fourier transform</b> of the transparency transmittance t(x,y).</li>
              <li><b>Delta-function sampling</b>: δ-functions collapse integrals and convert spatial “lines” into corresponding lines in frequency space.</li>
              <li><b>Intensity</b> is the magnitude-squared of the complex field: I ∝ |U|², so relative phase between components matters (especially case c).</li>
            </ul>
          </div>

          <div class="callout warn" style="margin-top:12px">
            <b>Possible approaches</b>
            <ol>
              <li><b>Direct 2D Fourier transform</b> using δ properties (fast, exact, best).</li>
              <li><b>Interpret as sums of shifted impulses</b> → use Fourier shift theorem (also fast, highlights fringes).</li>
              <li><b>Physical interference picture</b> in the focal plane (good intuition for cases b/c, but needs math to be precise).</li>
            </ol>
            <div style="margin-top:8px">
              <b>Chosen approach:</b> Use the <b>2D Fourier transform + δ identities</b> because it gives immediate, exact focal-plane field expressions and cleanly reveals
              where intensity is concentrated (lines) and the fringe spacing.
            </div>
          </div>
        </div>
      </section>

      <!-- PART 2 -->
      <section id="part2" class="card">
        <div class="hd"><h3>PART 2 — Strategy &amp; Tips (roadmap only)</h3></div>
        <div class="bd">
          <div class="callout">
            <b>Plan (5–10 steps)</b>
            <ol>
              <li><b>Model the object-plane field.</b> Goal: write U<sub>obj</sub>(x,y). Tool: plane-wave illumination ⇒ U<sub>obj</sub> ∝ t(x,y).</li>
              <li><b>Write the lens Fourier relation.</b> Goal: connect U<sub>f</sub>(X,Y) to T(f<sub>x</sub>,f<sub>y</sub>). Tool: thin-lens FT property.</li>
              <li><b>Define the 2D Fourier transform convention.</b> Goal: compute T(f<sub>x</sub>,f<sub>y</sub>) exactly.</li>
              <li><b>Case-by-case FT using δ identities.</b> Goal: find T for (a), (b), (c). Tool: ∫δ(g)φ = sum φ/|g'|.</li>
              <li><b>Map frequency coordinates to the focal-plane coordinates.</b> Goal: replace f<sub>x</sub>,f<sub>y</sub> with X/(λf), Y/(λf).</li>
              <li><b>Compute intensity.</b> Goal: I ∝ |U|² ∝ |T|² (up to constants).</li>
              <li><b>Extract sketch features.</b> Goal: identify lines, modulation, and fringe spacing ΔX.</li>
              <li><b>Sanity checks.</b> Units + limiting cases (e.g., a→0).</li>
            </ol>
          </div>

          <div class="two" style="margin-top:12px">
            <div class="callout warn">
              <b>Common mistakes</b>
              <ul>
                <li>Forgetting the mapping <span class="k" style="padding:2px 6px;border-radius:10px">f<sub>x</sub>=X/(λf)</span> (so fringe spacing looks wrong).</li>
                <li>Dropping the δ(f<sub>y</sub>) factor for y-invariant transparencies.</li>
                <li>Confusing <b>amplitude</b> fringes (cos) with <b>intensity</b> fringes (cos²).</li>
                <li>Ignoring the role of <b>relative phase</b> between the two lines (case c changes the pattern).</li>
              </ul>
            </div>
            <div class="callout good">
              <b>Quick tips</b>
              <ul>
                <li>Two shifted impulses in x always produce an interference factor <b>e^{±i2πf<sub>x</sub>a}</b>.</li>
                <li>Sum of two complex phasors ⇒ intensity depends on their relative phase (case c).</li>
                <li>For sketches, it’s enough to show where the intensity is nonzero (often a line) and how it varies along that line.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- PART 3 -->
      <section id="part3" class="card">
        <div class="hd">
          <h3>PART 3 — Full Solution</h3>
          <div class="copyrow">
            <button class="copybtn" data-copy="U_f(X,Y) = (e^{ikf}/(i λ f)) ∬ t(x,y) e^{-i 2π (fx x + fy y)} dx dy,  with fx = X/(λ f), fy = Y/(λ f).">Copy lens FT relation</button>
          </div>
        </div>
        <div class="bd">
          <div class="callout">
            <b>Physical intuition first.</b>
            The transparency acts like a “source distribution” in the object plane. A lens converts angle (direction) content into position in the focal plane.
            Delta-function lines have extremely broad spectra, but their geometry constrains the spectrum to <b>lines in frequency space</b>. If the transparency is invariant in y, all energy stays on the <b>f<sub>y</sub>=0</b> axis (hence <b>Y=0</b> in the focal plane), with interference fringes along X set by the separation 2a.
          </div>

          <div class="eqwrap" style="margin-top:12px">
            <div class="eq">
              <div class="lbl">Step 1 — Object-plane field</div>
              <code>Plane-wave illumination ⇒ U_obj(x,y) = U0 · t(x,y)
I_obj(x,y) ∝ |U_obj|^2 ∝ |t(x,y)|^2</code>
            </div>

            <div class="eq">
              <div class="lbl">Step 2 — Lens Fourier-transform property</div>
              <code>Define 2D Fourier transform (frequency in cycles/mm):
T(fx,fy) = ∬ t(x,y) e^{-i 2π (fx x + fy y)} dx dy

Back focal plane field (up to a constant phase factor):
U_f(X,Y) = (e^{ikf}/(i λ f)) · T(fx,fy),
with fx = X/(λ f), fy = Y/(λ f)

Therefore: I_f(X,Y) ∝ |U_f|^2 ∝ |T(X/(λf), Y/(λf))|^2</code>
              <div class="copyrow">
                <button class="copybtn" data-copy="T(fx,fy) = ∬ t(x,y) e^{-i2π(fx x + fy y)} dx dy">Copy T(fx,fy)</button>
              </div>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid rgba(255,255,255,.08);margin:14px 0">

          <article class="callout">
            <h4 style="margin:0 0 8px">Case (a): t(x,y) = δ(x − y)</h4>

            <div class="eqwrap">
              <div class="eq">
                <div class="lbl">Object plane</div>
                <code>I_obj(x,y) ∝ |δ(x−y)|^2  → idealized infinitely thin bright line along x=y</code>
              </div>

              <div class="eq">
                <div class="lbl">Fourier transform</div>
                <code>T(fx,fy) = ∬ δ(x−y) e^{-i2π(fx x + fy y)} dx dy

Use δ(x−y): integrate over y with y=x:
T(fx,fy) = ∫ e^{-i2π(fx x + fy x)} dx
        = ∫ e^{-i2π(fx+fy)x} dx
        = δ(fx + fy)</code>
              </div>

              <div class="eq">
                <div class="lbl">Focal plane mapping + intensity sketch</div>
                <code>fx = X/(λf), fy = Y/(λf)

δ(fx+fy) ⇒ δ( (X+Y)/(λf) )  ∝ δ(X+Y)

So I_f(X,Y) is concentrated on the line:  X + Y = 0 (a diagonal through the origin).</code>
              </div>
            </div>

            <div class="callout good" style="margin-top:10px">
              <b>Interpretation:</b> A line in real space at 45° becomes a line in frequency space at −45°.
              The focal-plane “spectrum” is a bright diagonal line.
            </div>
          </article>

          <article class="callout" style="margin-top:12px">
            <h4 style="margin:0 0 8px">Case (b): t(x,y) = δ(x + a) + δ(x − a), with a = 1 mm</h4>

            <div class="eqwrap">
              <div class="eq">
                <div class="lbl">Object plane</div>
                <code>Two vertical delta lines at x=−a and x=+a (uniform in y).
I_obj(x,y): intensity concentrated on those two lines.</code>
              </div>

              <div class="eq">
                <div class="lbl">Fourier transform</div>
                <code>T(fx,fy) = ∬ [δ(x+a)+δ(x−a)] e^{-i2π(fx x + fy y)} dx dy

Separate x and y:
(1) y-integral: ∫ e^{-i2π fy y} dy = δ(fy)

(2) x-integral using δ:
∫ δ(x+a)e^{-i2π fx x} dx = e^{-i2π fx(-a)} = e^{+i2π fx a}
∫ δ(x−a)e^{-i2π fx x} dx = e^{-i2π fx(+a)} = e^{−i2π fx a}

So:
T(fx,fy) = [e^{i2π fx a} + e^{-i2π fx a}] · δ(fy)
         = 2 cos(2π fx a) · δ(fy)</code>
              </div>

              <div class="eq">
                <div class="lbl">Focal plane intensity</div>
                <code>U_f(X,Y) ∝ T(X/(λf), Y/(λf))
So energy is confined to fy=0 ⇒ Y=0.

Along Y=0:
Amplitude ∝ 2 cos(2π a · X/(λf))
Intensity ∝ 4 cos^2(2π a · X/(λf))</code>
              </div>

              <div class="eq">
                <div class="lbl">Fringe spacing in mm</div>
                <code>cos^2(·) has period π in its argument.
Let ϕ = 2π a X/(λf).
cos^2(ϕ) repeats when ϕ → ϕ + π.

So: 2π a ΔX/(λf) = π  ⇒  ΔX = (λf)/(2a)

With λ=10^{-3} mm, f=1000 mm, a=1 mm:
ΔX = (10^{-3}·1000)/(2·1) = 0.5 mm</code>
              </div>
            </div>

            <div class="callout good" style="margin-top:10px">
              <b>Interpretation:</b> Two identical lines act like two coherent “sources” in x, producing
              interference fringes in the focal plane along X, but only on the axis Y=0.
            </div>
          </article>

          <article class="callout" style="margin-top:12px">
            <h4 style="margin:0 0 8px">Case (c): t(x,y) = δ(x + a) + j δ(x − a), with a = 1 mm (j = i)</h4>

            <div class="eqwrap">
              <div class="eq">
                <div class="lbl">Object plane</div>
                <code>Still two vertical lines at x=−a and x=+a, but the right line has a +90° phase shift.
Intensity in the object plane is still concentrated on two lines (phase does not show in |t|^2).</code>
              </div>

              <div class="eq">
                <div class="lbl">Fourier transform</div>
                <code>Same y-part: δ(fy)

x-part:
δ(x+a) → e^{+i2π fx a}
δ(x−a) → e^{−i2π fx a}, multiplied by i

So:
T(fx,fy) = [ e^{i2π fx a} + i e^{-i2π fx a} ] · δ(fy)</code>
              </div>

              <div class="eq">
                <div class="lbl">Intensity along Y=0 (compute magnitude)</div>
                <code>Let α = 2π fx a.
A = e^{iα} + i e^{-iα}.

|A|^2 = (e^{iα} + i e^{-iα})(e^{-iα} − i e^{iα})
      = 2 + 2 sin(2α)

Thus:
|T|^2 ∝ [2 + 2 sin(4π fx a)] · δ(fy)^2

In focal plane (fx = X/(λf)):
Along Y=0:
I_f(X,0) ∝ 2[1 + sin( 4π a X/(λf) )]</code>
              </div>

              <div class="eq">
                <div class="lbl">Fringe spacing</div>
                <code>sin(4π a X/(λf)) repeats when its argument increases by 2π:
4π a ΔX/(λf) = 2π ⇒ ΔX = (λf)/(2a)

Same spacing as case (b), but the pattern is phase-shifted (sine vs cos^2).</code>
              </div>
            </div>

            <div class="callout warn" style="margin-top:10px">
              <b>Interpretation:</b> The two contributions have a fixed <b>quadrature</b> phase offset. That changes
              interference: maxima/minima move (a “fringe shift”), even though the spatial frequency content still lies on Y=0.
            </div>
          </article>

          <hr style="border:none;border-top:1px solid rgba(255,255,255,.08);margin:14px 0">

          <div class="callout">
            <b>Sanity checks</b>
            <ul>
              <li><b>Units:</b> X and Y are in mm; λf has units mm·mm = mm², so X/(λf) has units 1/mm, consistent with spatial frequency.</li>
              <li><b>Limiting case a→0:</b> In (b), t→2δ(x). Then T→2·δ(fy) (no fringes), consistent with ΔX→∞.</li>
              <li><b>Energy confinement:</b> If t is independent of y (cases b,c), its Fourier transform must contain δ(fy), meaning all energy lies on Y=0 in the focal plane.</li>
              <li><b>Geometry duality:</b> A line constraint in (x,y) becomes a perpendicular line constraint in (f<sub>x</sub>,f<sub>y</sub>).</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- FINAL -->
      <section id="final" class="card">
        <div class="hd">
          <h3>Final Results (copy-ready)</h3>
          <div class="copyrow">
            <button class="copybtn" data-copy="Given: λ=1 µm=10^{-3} mm, f=100 cm=1000 mm.  Mapping: fx=X/(λf), fy=Y/(λf).  I_f(X,Y) ∝ |T(fx,fy)|^2.">Copy header</button>
          </div>
        </div>
        <div class="bd">
          <div class="boxfinal">
            <h4>Lens Fourier mapping (core result)</h4>
            <div class="k" id="finalCore">T(fx,fy) = ∬ t(x,y) e^{-i2π(fx x + fy y)} dx dy
U_f(X,Y) = (e^{ikf}/(iλf)) T(X/(λf), Y/(λf))
I_f(X,Y) ∝ |T(X/(λf), Y/(λf))|^2</div>
            <div class="copyrow">
              <button class="copybtn" data-copy="T(fx,fy) = ∬ t(x,y) e^{-i2π(fx x + fy y)} dx dy&#10;U_f(X,Y) = (e^{ikf}/(iλf)) T(X/(λf), Y/(λf))&#10;I_f(X,Y) ∝ |T(X/(λf), Y/(λf))|^2">Copy final answer (core)</button>
            </div>
          </div>

          <div class="two" style="margin-top:12px">
            <div class="callout">
              <b>(a) t(x,y)=δ(x−y)</b>
              <div class="k" style="margin-top:8px">Object plane: bright line x=y
Fourier: T(fx,fy)=δ(fx+fy)
Focal plane: bright line X+Y=0</div>
              <div class="copyrow">
                <button class="copybtn" data-copy="(a) t(x,y)=δ(x−y):  T(fx,fy)=δ(fx+fy)  ⇒ focal-plane intensity on X+Y=0.">Copy (a)</button>
              </div>
            </div>

            <div class="callout">
              <b>(b) t(x,y)=δ(x+a)+δ(x−a)</b>
              <div class="k" style="margin-top:8px">T(fx,fy)=2 cos(2πfx a) · δ(fy)
Focal plane: confined to Y=0
I_f(X,0) ∝ 4 cos^2(2π a X/(λf))
Fringe period: ΔX = λf/(2a)</div>
              <div class="copyrow">
                <button class="copybtn" data-copy="(b) t=δ(x+a)+δ(x−a):  T=2cos(2πfx a)δ(fy).  Focal plane on Y=0 with I(X,0)∝4cos^2(2π a X/(λf)), ΔX=λf/(2a).">Copy (b)</button>
              </div>
            </div>
          </div>

          <div class="callout" style="margin-top:12px">
            <b>(c) t(x,y)=δ(x+a)+jδ(x−a) (j=i)</b>
            <div class="k" style="margin-top:8px">T(fx,fy) = (e^{i2πfx a} + i e^{-i2πfx a}) · δ(fy)
Along Y=0:  I_f(X,0) ∝ 2[1 + sin(4π a X/(λf))]
Fringe period: ΔX = λf/(2a) (same as b, shifted fringes)</div>
            <div class="copyrow">
              <button class="copybtn" data-copy="(c) t=δ(x+a)+iδ(x−a):  T=(e^{i2πfx a}+i e^{-i2πfx a})δ(fy).  Along Y=0: I(X,0)∝2[1+sin(4π a X/(λf))], with ΔX=λf/(2a).">Copy (c)</button>
              <button class="copybtn" data-copy="Numeric (a=1 mm, λ=1 µm, f=100 cm):  ΔX = λf/(2a) = 0.5 mm.">Copy numeric ΔX</button>
            </div>
          </div>

        </div>
      </section>

    </div>
  </div>
</main>

<footer>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>Made for optics/photonics study: delta-line transparencies → line spectra + interference fringes.</div>
      <div style="opacity:.9">Vanilla HTML/CSS/JS • Print-friendly • High-DPI canvases</div>
    </div>
  </div>
</footer>

<script>
(function(){
  // ---------- helpers ----------
  const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
  function $(id){return document.getElementById(id);}
  function niceTicks(min,max,count){
    // simple "nice" tick generator
    const span = max-min;
    if(span<=0) return [min];
    const raw = span/(count-1);
    const pow = Math.pow(10, Math.floor(Math.log10(raw)));
    const candidates = [1,2,5,10].map(m=>m*pow);
    let step = candidates.reduce((best,c)=>Math.abs(c-raw)<Math.abs(best-raw)?c:best, candidates[0]);
    const start = Math.ceil(min/step)*step;
    const ticks=[];
    for(let v=start; v<=max+1e-12; v+=step) ticks.push(+v.toFixed(10));
    return ticks;
  }
  function gaussian2(x,y,s){ return Math.exp(-(x*x+y*y)/(2*s*s)); }
  function gaussian1(x,s){ return Math.exp(-(x*x)/(2*s*s)); }

  // Copy buttons
  function doCopy(text){
    if(!navigator.clipboard){
      const ta=document.createElement('textarea');
      ta.value=text; document.body.appendChild(ta);
      ta.select(); document.execCommand('copy');
      document.body.removeChild(ta);
      return;
    }
    navigator.clipboard.writeText(text);
  }
  document.addEventListener('click', (e)=>{
    const b = e.target.closest('.copybtn');
    if(!b) return;
    const text = b.getAttribute('data-copy') || '';
    doCopy(text);
    const old = b.textContent;
    b.textContent = 'Copied ✓';
    setTimeout(()=>b.textContent=old, 900);
  });

  // Smooth scroll for TOC
  document.querySelectorAll('.toc a').forEach(a=>{
    a.addEventListener('click', (ev)=>{
      ev.preventDefault();
      const id = a.getAttribute('href').slice(1);
      const el = document.getElementById(id);
      if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
    });
  });

  // ---------- physical parameters ----------
  // Given by problem (keep consistent with plots)
  const lam_um = 1.0;                 // µm
  const lam_mm = lam_um * 1e-3;        // mm
  const f_cm = 100;                   // cm
  const f_mm = f_cm * 10;             // 1000 mm

  $('lamRO').textContent = lam_um.toFixed(3);
  $('fRO').textContent = f_cm.toString();

  // Controls
  const caseSel = $('caseSel');
  const aSlider = $('aSlider');
  const wSlider = $('wSlider');
  const aRO = $('aRO');
  const wRO = $('wRO');
  const dxRO = $('dxRO');
  const btnReset = $('btnReset');

  // Canvas set
  const setupCanvas = $('setupCanvas');
  const objCanvas = $('objCanvas');
  const mainCanvas = $('mainCanvas');
  const focalCanvas = $('focalCanvas');

  // View settings
  let view = {
    objRange: 3.2,      // mm half-width for object plot
    focalRange: 3.0,    // mm half-width for focal plot
    mainXRange: 3.0     // mm half-width for main cut
  };

  btnReset.addEventListener('click', ()=>{
    view = {objRange:3.2,focalRange:3.0,mainXRange:3.0};
    renderAll();
  });

  // ---------- High-DPI canvas ----------
  function fitCanvas(canvas, targetCSSHeight){
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    const w = Math.max(1, Math.floor(rect.width * dpr));
    const h = Math.max(1, Math.floor(targetCSSHeight * dpr));
    if(canvas.width !== w || canvas.height !== h){
      canvas.width = w;
      canvas.height = h;
    }
    return {ctx: canvas.getContext('2d'), dpr, w, h, cssW: rect.width, cssH: targetCSSHeight};
  }

  function clear(ctx,w,h){
    ctx.clearRect(0,0,w,h);
    // background gradient
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0,'rgba(255,255,255,0.02)');
    g.addColorStop(1,'rgba(0,0,0,0.0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);
  }

  // ---------- plotting primitives ----------
  function drawAxes(ctx, box, xMin,xMax,yMin,yMax, xLabel, yLabel, title){
    const {x,y,w,h} = box;
    // Title
    ctx.save();
    ctx.fillStyle = 'rgba(233,238,247,0.92)';
    ctx.font = `${Math.max(12, Math.floor(h*0.06))}px system-ui`;
    ctx.textAlign='left';
    ctx.textBaseline='top';
    ctx.fillText(title, x+10, y+8);
    ctx.restore();

    // Inner plot region
    const padL = 52, padR = 18, padT = 34, padB = 44;
    const px = x + padL, py = y + padT, pw = w - padL - padR, ph = h - padT - padB;

    // Grid & ticks
    const xTicks = niceTicks(xMin,xMax,6);
    const yTicks = niceTicks(yMin,yMax,6);

    ctx.save();
    ctx.strokeStyle = 'rgba(255,255,255,0.06)';
    ctx.lineWidth = 1;

    // vertical grid
    xTicks.forEach(t=>{
      const u = (t-xMin)/(xMax-xMin);
      const X = px + u*pw;
      ctx.beginPath();
      ctx.moveTo(X, py);
      ctx.lineTo(X, py+ph);
      ctx.stroke();
    });
    // horizontal grid
    yTicks.forEach(t=>{
      const v = (t-yMin)/(yMax-yMin);
      const Y = py + (1-v)*ph;
      ctx.beginPath();
      ctx.moveTo(px, Y);
      ctx.lineTo(px+pw, Y);
      ctx.stroke();
    });

    // Axes
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.lineWidth = 1.2;
    ctx.beginPath();
    ctx.moveTo(px, py+ph);
    ctx.lineTo(px+pw, py+ph);
    ctx.lineTo(px+pw, py);
    ctx.stroke();

    // Tick labels
    ctx.fillStyle = 'rgba(169,180,199,0.95)';
    ctx.font = `12px ${getComputedStyle(document.body).fontFamily}`;
    ctx.textAlign='center';
    ctx.textBaseline='top';
    xTicks.forEach(t=>{
      const u=(t-xMin)/(xMax-xMin);
      const X=px+u*pw;
      ctx.fillText(formatTick(t), X, py+ph+8);
      ctx.strokeStyle='rgba(255,255,255,0.18)';
      ctx.beginPath();
      ctx.moveTo(X, py+ph);
      ctx.lineTo(X, py+ph+4);
      ctx.stroke();
    });
    ctx.textAlign='right';
    ctx.textBaseline='middle';
    yTicks.forEach(t=>{
      const v=(t-yMin)/(yMax-yMin);
      const Y=py+(1-v)*ph;
      ctx.fillText(formatTick(t), px-8, Y);
      ctx.strokeStyle='rgba(255,255,255,0.18)';
      ctx.beginPath();
      ctx.moveTo(px-4, Y);
      ctx.lineTo(px, Y);
      ctx.stroke();
    });

    // Axis labels
    ctx.fillStyle = 'rgba(233,238,247,0.9)';
    ctx.font = `13px system-ui`;
    ctx.textAlign='center';
    ctx.textBaseline='bottom';
    ctx.fillText(xLabel, px+pw/2, y+h-10);

    ctx.save();
    ctx.translate(x+14, py+ph/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign='center';
    ctx.textBaseline='top';
    ctx.fillText(yLabel, 0, 0);
    ctx.restore();

    ctx.restore();

    return {px,py,pw,ph, padL,padR,padT,padB};
  }

  function formatTick(v){
    const av = Math.abs(v);
    if(av>=1000) return (v/1000).toFixed(1)+'k';
    if(av>=10) return v.toFixed(0);
    if(av>=1) return v.toFixed(1);
    if(av>=0.1) return v.toFixed(2);
    return v.toFixed(3);
  }

  function toScreenX(x, xMin,xMax, region){ return region.px + (x-xMin)/(xMax-xMin)*region.pw; }
  function toScreenY(y, yMin,yMax, region){ return region.py + (1-(y-yMin)/(yMax-yMin))*region.ph; }

  // ---------- model: approximate delta-lines with Gaussians ----------
  function tAmplitude(caseKey, x, y, a, w){
    // Return complex amplitude as {re,im} (dimensionless for visualization)
    // We approximate delta(x-x0) with g(x-x0) = exp(-(x-x0)^2/(2w^2))
    // For δ(x-y): approximate with exp(-(x-y)^2/(2w^2)).
    if(caseKey==='a'){
      const g = gaussian1(x-y, w);
      return {re:g, im:0};
    }
    if(caseKey==='b'){
      const g1 = gaussian1(x+a, w);
      const g2 = gaussian1(x-a, w);
      return {re:(g1+g2), im:0};
    }
    // case c: δ(x+a) + i δ(x-a)
    const g1 = gaussian1(x+a, w);
    const g2 = gaussian1(x-a, w);
    return {re:g1, im:g2};
  }

  // Analytic focal-plane intensity along Y=0 for cases b,c (normalized)
  function IfocalLine(caseKey, X, a){
    // Use analytic expressions (normalized, ignoring distributional δ(fy))
    if(caseKey==='b'){
      const phi = 2*Math.PI*a*X/(lam_mm*f_mm);
      const A = 2*Math.cos(phi);
      return A*A; // 4 cos^2
    }
    if(caseKey==='c'){
      const theta = 4*Math.PI*a*X/(lam_mm*f_mm);
      return 2*(1+Math.sin(theta)); // 2(1+sin)
    }
    // case a: line X+Y=0; along Y=0 only hits at X=0.
    // show narrow peak for visualization:
    const wX = 0.06; // mm, display-only
    return Math.exp(-(X*X)/(2*wX*wX));
  }

  // Approximate 2D focal intensity map based on analytic "line + modulation" but with finite width
  function Ifocal2D(caseKey, X, Y, a, wLine){
    const s = wLine; // mm width in focal plane for displaying the delta-lines
    if(caseKey==='a'){
      // intensity concentrated near X+Y=0
      const d = (X+Y)/Math.SQRT2;
      return Math.exp(-(d*d)/(2*s*s));
    }
    // cases b,c: concentrated near Y=0 plus modulation vs X
    const line = Math.exp(-(Y*Y)/(2*s*s));
    let mod;
    if(caseKey==='b'){
      const phi = 2*Math.PI*a*X/(lam_mm*f_mm);
      mod = 4*Math.cos(phi)*Math.cos(phi);
    }else{
      const theta = 4*Math.PI*a*X/(lam_mm*f_mm);
      mod = 2*(1+Math.sin(theta));
    }
    return line * mod;
  }

  // ---------- renderers ----------
  function renderSetup(){
    const boxH = 360;
    const {ctx,w,h} = fitCanvas(setupCanvas, boxH);
    clear(ctx,w,h);

    // coordinate system in pixels
    const margin = 18;
    const x0 = margin, y0 = margin, W=w-2*margin, H=h-2*margin;

    // A simple labeled diagram: plane wave -> transparency -> lens -> focal plane
    ctx.save();
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(125,211,252,0.85)';
    ctx.fillStyle = 'rgba(233,238,247,0.92)';
    ctx.font = `14px system-ui`;
    ctx.textBaseline='middle';

    const yMid = y0 + H*0.52;

    // Plane wave arrows
    ctx.strokeStyle = 'rgba(167,139,250,0.85)';
    for(let i=0;i<5;i++){
      const yy = yMid - 60 + i*30;
      ctx.beginPath();
      ctx.moveTo(x0+10, yy);
      ctx.lineTo(x0+120, yy);
      ctx.stroke();
      // arrow head
      ctx.beginPath();
      ctx.moveTo(x0+120, yy);
      ctx.lineTo(x0+110, yy-6);
      ctx.lineTo(x0+110, yy+6);
      ctx.closePath();
      ctx.fillStyle='rgba(167,139,250,0.85)';
      ctx.fill();
    }
    ctx.fillStyle='rgba(233,238,247,0.92)';
    ctx.fillText('Plane wave (λ)', x0+14, y0+26);

    // Transparency plane
    const tx = x0 + W*0.30;
    ctx.strokeStyle = 'rgba(233,238,247,0.70)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(tx, y0+40);
    ctx.lineTo(tx, y0+H-20);
    ctx.stroke();
    ctx.fillStyle='rgba(233,238,247,0.92)';
    ctx.fillText('Transparency: t(x,y)', tx+10, y0+55);

    // Lens symbol
    const lx = x0 + W*0.58;
    const lensTop = y0+70, lensBot = y0+H-40;
    ctx.strokeStyle = 'rgba(125,211,252,0.85)';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(lx, lensTop);
    ctx.quadraticCurveTo(lx+28, (lensTop+lensBot)/2, lx, lensBot);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(lx+28, lensTop);
    ctx.quadraticCurveTo(lx, (lensTop+lensBot)/2, lx+28, lensBot);
    ctx.stroke();
    ctx.fillStyle='rgba(233,238,247,0.92)';
    ctx.fillText('Lens (f)', lx-10, y0+55);

    // Focal plane
    const fx = x0 + W*0.82;
    ctx.strokeStyle = 'rgba(233,238,247,0.70)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(fx, y0+40);
    ctx.lineTo(fx, y0+H-20);
    ctx.stroke();
    ctx.fillStyle='rgba(233,238,247,0.92)';
    ctx.fillText('Back focal plane', fx-30, y0+55);

    // Rays from transparency to focal plane (schematic)
    ctx.strokeStyle = 'rgba(125,211,252,0.35)';
    ctx.lineWidth = 2;
    const pts = [
      {y:yMid-80, yy:yMid-55},
      {y:yMid-30, yy:yMid-25},
      {y:yMid+20, yy:yMid+5},
      {y:yMid+70, yy:yMid+40}
    ];
    pts.forEach(p=>{
      ctx.beginPath();
      ctx.moveTo(tx, p.y);
      ctx.lineTo(lx+14, p.yy);
      ctx.lineTo(fx, yMid);
      ctx.stroke();
    });

    // Axis labels in focal plane
    ctx.fillStyle='rgba(169,180,199,0.95)';
    ctx.font = `12px system-ui`;
    ctx.fillText('X (mm)', fx-5, y0+H-10);
    ctx.save();
    ctx.translate(fx+10, yMid);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Y (mm)', 0, 0);
    ctx.restore();

    // Annotation: frequency mapping
    ctx.fillStyle='rgba(233,238,247,0.92)';
    ctx.font = `13px system-ui`;
    const note = 'Mapping: fx = X/(λf), fy = Y/(λf)\nU_f ∝ Fourier{t}';
    drawMultiline(ctx, note, x0+W*0.34, y0+H*0.12, 18);

    ctx.restore();
  }

  function drawMultiline(ctx, text, x, y, lineH){
    const lines=text.split('\n');
    ctx.textAlign='left';
    ctx.textBaseline='top';
    lines.forEach((ln,i)=>ctx.fillText(ln, x, y+i*lineH));
  }

  function renderObject(){
    const boxH = 360;
    const {ctx,w,h} = fitCanvas(objCanvas, boxH);
    clear(ctx,w,h);

    const caseKey = caseSel.value;
    const a = parseFloat(aSlider.value);
    const wLine = parseFloat(wSlider.value);

    const xMin=-view.objRange, xMax=view.objRange;
    const yMin=-view.objRange, yMax=view.objRange;

    const region = drawAxes(ctx, {x:0,y:0,w,h}, xMin,xMax,yMin,yMax, 'x (mm)', 'y (mm)', 'Object plane: I_obj(x,y) ∝ |t(x,y)|² (visualized)');

    // Heatmap render
    const img = ctx.createImageData(Math.floor(region.pw), Math.floor(region.ph));
    const pw = img.width, ph = img.height;

    // sample grid
    let maxI = 1e-9;
    const Ivals = new Float32Array(pw*ph);

    for(let j=0;j<ph;j++){
      const y = yMax - (j+0.5)/ph*(yMax-yMin);
      for(let i=0;i<pw;i++){
        const x = xMin + (i+0.5)/pw*(xMax-xMin);
        const t = tAmplitude(caseKey, x, y, a, wLine);
        const I = t.re*t.re + t.im*t.im;
        Ivals[j*pw+i]=I;
        if(I>maxI) maxI=I;
      }
    }

    // Map intensity to color (single-hue luminance)
    for(let j=0;j<ph;j++){
      for(let i=0;i<pw;i++){
        const I = Ivals[j*pw+i]/maxI;
        const g = Math.pow(clamp(I,0,1), 0.45); // gamma
        const idx = (j*pw+i)*4;
        // bluish-white ramp
        img.data[idx+0] = Math.floor(30 + 200*g);
        img.data[idx+1] = Math.floor(40 + 210*g);
        img.data[idx+2] = Math.floor(60 + 220*g);
        img.data[idx+3] = 255;
      }
    }

    ctx.putImageData(img, region.px, region.py);

    // Overlay: line labels
    ctx.save();
    ctx.fillStyle='rgba(233,238,247,0.9)';
    ctx.font='12px system-ui';
    if(caseKey==='a'){
      ctx.fillText('bright line: x = y', region.px+10, region.py+10);
    }else{
      ctx.fillText(`bright lines: x = ±a (a=${a.toFixed(2)} mm)`, region.px+10, region.py+10);
      // draw x=±a
      ctx.strokeStyle='rgba(255,255,255,0.35)';
      ctx.lineWidth=1.2;
      const Xa = toScreenX(a, xMin,xMax, region);
      const Xm = toScreenX(-a, xMin,xMax, region);
      ctx.beginPath(); ctx.moveTo(Xa, region.py); ctx.lineTo(Xa, region.py+region.ph); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(Xm, region.py); ctx.lineTo(Xm, region.py+region.ph); ctx.stroke();
    }
    ctx.restore();
  }

  function renderMain(){
    const boxH = 360;
    const {ctx,w,h} = fitCanvas(mainCanvas, boxH);
    clear(ctx,w,h);

    const caseKey = caseSel.value;
    const a = parseFloat(aSlider.value);

    const xMin=-view.mainXRange, xMax=view.mainXRange;
    const yMin=0, yMax=4.2; // for normalized intensity, enough headroom

    const region = drawAxes(ctx, {x:0,y:0,w,h}, xMin,xMax,yMin,yMax, 'X (mm) at Y=0', 'Normalized intensity (a.u.)', 'Focal plane cut: I_f(X, Y=0)');

    // Compute curve
    const N = 700;
    const xs = new Float32Array(N);
    const ys = new Float32Array(N);
    let maxY = 1e-9;
    for(let i=0;i<N;i++){
      const X = xMin + i/(N-1)*(xMax-xMin);
      const I = IfocalLine(caseKey, X, a);
      xs[i]=X; ys[i]=I;
      if(I>maxY) maxY=I;
    }
    // Normalize to 1 for display
    for(let i=0;i<N;i++) ys[i] /= maxY;

    // Plot curve
    ctx.save();
    ctx.strokeStyle='rgba(125,211,252,0.95)';
    ctx.lineWidth=2.2;
    ctx.beginPath();
    for(let i=0;i<N;i++){
      const Xs = toScreenX(xs[i], xMin,xMax, region);
      const Ys = toScreenY(ys[i], 0,1.05, region); // show up to 1.05
      if(i===0) ctx.moveTo(Xs,Ys); else ctx.lineTo(Xs,Ys);
    }
    ctx.stroke();

    // Legend
    ctx.fillStyle='rgba(233,238,247,0.92)';
    ctx.font='12px system-ui';
    const label = (caseKey==='a') ? 'case (a): diagonal line (shown as narrow peak at X=0)' :
                  (caseKey==='b') ? 'case (b): ∝ cos²(2π a X/(λf))' :
                                    'case (c): ∝ 1 + sin(4π a X/(λf))';
    ctx.fillText(label, region.px+10, region.py+18);

    // Mark fringe period for b/c
    if(caseKey!=='a'){
      const dX = lam_mm*f_mm/(2*a);
      ctx.strokeStyle='rgba(167,139,250,0.75)';
      ctx.lineWidth=1.6;
      const x1 = 0, x2 = dX;
      const X1 = toScreenX(x1, xMin,xMax, region);
      const X2 = toScreenX(x2, xMin,xMax, region);
      const Yb = region.py+region.ph-12;
      ctx.beginPath(); ctx.moveTo(X1,Yb); ctx.lineTo(X2,Yb); ctx.stroke();
      // end caps
      ctx.beginPath(); ctx.moveTo(X1,Yb-5); ctx.lineTo(X1,Yb+5); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(X2,Yb-5); ctx.lineTo(X2,Yb+5); ctx.stroke();
      ctx.fillStyle='rgba(167,139,250,0.95)';
      ctx.fillText(`ΔX = λf/(2a) = ${dX.toFixed(3)} mm`, (X1+X2)/2, Yb-8);
    }
    ctx.restore();
  }

  function renderFocal2D(){
    const boxH = 360;
    const {ctx,w,h} = fitCanvas(focalCanvas, boxH);
    clear(ctx,w,h);

    const caseKey = caseSel.value;
    const a = parseFloat(aSlider.value);
    const wVis = parseFloat(wSlider.value);

    const xMin=-view.focalRange, xMax=view.focalRange;
    const yMin=-view.focalRange, yMax=view.focalRange;

    const region = drawAxes(ctx, {x:0,y:0,w,h}, xMin,xMax,yMin,yMax, 'X (mm)', 'Y (mm)', 'Focal plane: I_f(X,Y) (visualized finite-width)');

    const img = ctx.createImageData(Math.floor(region.pw), Math.floor(region.ph));
    const pw=img.width, ph=img.height;

    let maxI=1e-9;
    const Ivals = new Float32Array(pw*ph);

    // Use a slightly different width in focal plane (display-only):
    // Make it tied to wSlider but not identical in meaning:
    const s = clamp(0.35*wVis, 0.01, 0.08); // mm

    for(let j=0;j<ph;j++){
      const Y = yMax - (j+0.5)/ph*(yMax-yMin);
      for(let i=0;i<pw;i++){
        const X = xMin + (i+0.5)/pw*(xMax-xMin);
        const I = Ifocal2D(caseKey, X, Y, a, s);
        Ivals[j*pw+i]=I;
        if(I>maxI) maxI=I;
      }
    }

    for(let j=0;j<ph;j++){
      for(let i=0;i<pw;i++){
        const I = Ivals[j*pw+i]/maxI;
        const g = Math.pow(clamp(I,0,1), 0.45);
        const idx=(j*pw+i)*4;
        // Purple-blue ramp
        img.data[idx+0] = Math.floor(20 + 180*g);
        img.data[idx+1] = Math.floor(22 + 170*g);
        img.data[idx+2] = Math.floor(45 + 210*g);
        img.data[idx+3] = 255;
      }
    }
    ctx.putImageData(img, region.px, region.py);

    // Overlay analytical constraint lines
    ctx.save();
    ctx.strokeStyle='rgba(255,255,255,0.40)';
    ctx.lineWidth=1.2;
    ctx.setLineDash([6,6]);
    if(caseKey==='a'){
      // X+Y=0 line
      const p1 = {X:xMin, Y:-xMin};
      const p2 = {X:xMax, Y:-xMax};
      const x1=toScreenX(p1.X,xMin,xMax,region);
      const y1=toScreenY(p1.Y,yMin,yMax,region);
      const x2=toScreenX(p2.X,xMin,xMax,region);
      const y2=toScreenY(p2.Y,yMin,yMax,region);
      ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
      ctx.fillStyle='rgba(233,238,247,0.92)';
      ctx.setLineDash([]);
      ctx.font='12px system-ui';
      ctx.fillText('Analytic support: X+Y=0', region.px+10, region.py+18);
    }else{
      // Y=0 axis
      const y0=toScreenY(0,yMin,yMax,region);
      ctx.beginPath(); ctx.moveTo(region.px,y0); ctx.lineTo(region.px+region.pw,y0); ctx.stroke();
      ctx.fillStyle='rgba(233,238,247,0.92)';
      ctx.setLineDash([]);
      ctx.font='12px system-ui';
      ctx.fillText('Analytic support: Y=0 (δ(fy))', region.px+10, region.py+18);
    }
    ctx.restore();
  }

  // ---------- live readouts ----------
  function updateReadouts(){
    const a = parseFloat(aSlider.value);
    const w = parseFloat(wSlider.value);
    aRO.textContent = a.toFixed(2);
    wRO.textContent = w.toFixed(3);
    const dx = lam_mm*f_mm/(2*a);
    dxRO.textContent = dx.toFixed(2);
  }

  function renderAll(){
    updateReadouts();
    renderSetup();
    renderObject();
    renderMain();
    renderFocal2D();
  }

  // ---------- events ----------
  caseSel.addEventListener('change', renderAll);
  aSlider.addEventListener('input', renderAll);
  wSlider.addEventListener('input', renderAll);
  window.addEventListener('resize', ()=>{
    // re-render on resize for crisp layout
    renderAll();
  });

  // initial render
  renderAll();
})();
</script>
</body>
</html>
