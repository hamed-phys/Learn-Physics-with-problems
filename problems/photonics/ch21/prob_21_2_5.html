<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="light dark"/>
  <title>LiNbO₃ Mach–Zehnder Intensity Modulator: Minimum Half-Wave Voltage Vπ</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel:#101a33;
      --panel2:#0e1630;
      --text:#eaf0ff;
      --muted:#b9c5ff;
      --faint:#8fa1d9;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line: rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --radius: 16px;
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f9ff;
        --panel:#ffffff;
        --panel2:#f2f5ff;
        --text:#0b1636;
        --muted:#2b3a6f;
        --faint:#5164a6;
        --accent:#0066ff;
        --accent2:#6d28d9;
        --line: rgba(9,20,60,.12);
        --shadow: 0 10px 30px rgba(9,20,60,.12);
      }
    }

    html{scroll-behavior:smooth;}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(125,211,252,.18), transparent 55%),
                  radial-gradient(900px 500px at 90% 10%, rgba(167,139,250,.16), transparent 50%),
                  var(--bg);
      color:var(--text);
      font-family: var(--sans);
      line-height:1.55;
      letter-spacing: .1px;
    }

    a{color:var(--accent); text-decoration:none;}
    a:hover{text-decoration:underline;}
    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 22px 16px 60px;
    }

    header.hero{
      background: linear-gradient(180deg, rgba(125,211,252,.12), transparent 55%),
                  linear-gradient(135deg, rgba(167,139,250,.10), transparent 55%),
                  var(--panel);
      border:1px solid var(--line);
      border-radius: calc(var(--radius) + 6px);
      box-shadow: var(--shadow);
      padding: 22px 18px;
      position: relative;
      overflow:hidden;
    }
    header.hero::after{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(500px 220px at 15% 10%, rgba(125,211,252,.18), transparent 60%),
        radial-gradient(420px 220px at 90% 0%, rgba(167,139,250,.16), transparent 55%);
      pointer-events:none;
      filter: blur(0.2px);
    }
    header.hero > *{position:relative; z-index:1;}
    .kicker{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding: 6px 10px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 13px;
      width: fit-content;
      margin-bottom: 10px;
    }
    .kdot{
      width:9px;height:9px;border-radius:99px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 3px rgba(125,211,252,.12);
    }
    h1{
      margin: 6px 0 8px;
      font-size: clamp(22px, 3vw, 34px);
      line-height: 1.15;
      letter-spacing: .2px;
    }
    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 15.5px;
      max-width: 90ch;
    }

    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap: 14px;
      align-items:start;
    }

    nav.toc{
      position: sticky;
      top: 12px;
      align-self:start;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent 70%), var(--panel);
      box-shadow: var(--shadow);
      padding: 14px 12px;
    }
    nav.toc h2{
      margin:0 0 10px;
      font-size: 14px;
      color: var(--muted);
      letter-spacing: .3px;
      text-transform: uppercase;
    }
    nav.toc a{
      display:block;
      padding: 7px 10px;
      border-radius: 10px;
      color: var(--text);
      border: 1px solid transparent;
    }
    nav.toc a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.22);
      text-decoration:none;
    }
    .toc small{
      display:block;
      color: var(--faint);
      margin-top: 10px;
      padding: 10px;
      border-top: 1px dashed var(--line);
      font-size: 12.5px;
    }

    main{min-width: 0;}

    section.card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent 75%), var(--panel);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px 16px;
      margin-bottom: 14px;
    }

    h2{
      margin: 0 0 8px;
      font-size: 20px;
      letter-spacing: .1px;
    }
    h3{
      margin: 16px 0 8px;
      font-size: 16.5px;
      color: var(--muted);
    }
    p{margin: 8px 0;}
    ul{margin: 8px 0 8px 22px;}
    li{margin: 6px 0;}
    .muted{color: var(--muted);}
    .faint{color: var(--faint);}

    .callouts{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .callout{
      grid-column: span 12;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent 65%), var(--panel2);
      overflow:hidden;
      position:relative;
    }
    .callout::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(600px 220px at 10% 0%, rgba(125,211,252,.10), transparent 60%);
      pointer-events:none;
    }
    .callout > *{position:relative; z-index:1;}
    .callout h4{
      margin: 0 0 6px;
      font-size: 14px;
      letter-spacing: .2px;
      text-transform: uppercase;
      color: var(--muted);
      display:flex; gap:10px; align-items:center;
    }
    .badge{
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      text-transform:none;
      letter-spacing:0;
    }
    .assump h4 .badge{border-color: rgba(251,191,36,.35); color: var(--warn);}
    .keyeq h4 .badge{border-color: rgba(125,211,252,.35); color: var(--accent);}
    .mist h4 .badge{border-color: rgba(251,113,133,.35); color: var(--bad);}
    .final h4 .badge{border-color: rgba(52,211,153,.35); color: var(--good);}

    .eq{
      font-family: var(--mono);
      font-size: 13.5px;
      line-height:1.45;
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      overflow-x:auto;
      margin: 8px 0;
      white-space: pre;
    }
    @media (prefers-color-scheme: light){
      .eq{background: rgba(9,20,60,.05);}
    }

    .row{
      display:flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 7px 10px;
      border-radius: 12px;
      font-size: 13px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      display:inline-flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .btn:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.30);
    }
    .btn:active{transform: scale(.98);}
    .btn .dot{
      width:8px;height:8px;border-radius:99px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }
    .btn.good:hover{background: rgba(52,211,153,.10); border-color: rgba(52,211,153,.28);}
    .btn.good .dot{background: linear-gradient(90deg, var(--good), var(--accent));}

    details{
      border:1px dashed var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.03);
      margin-top: 10px;
    }
    details summary{
      cursor:pointer;
      color: var(--muted);
      font-weight: 600;
    }

    figure{
      margin: 12px 0 0;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 70%), var(--panel2);
      padding: 10px;
      overflow:hidden;
    }
    figcaption{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
    }
    canvas{width: 100%; height: 340px; display:block;}
    .backtop{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      color: var(--text);
      text-decoration:none;
      transition: background .15s ease, border-color .15s ease;
    }
    .backtop:hover{
      background: rgba(167,139,250,.10);
      border-color: rgba(167,139,250,.30);
      text-decoration:none;
    }

    footer{
      margin-top: 16px;
      padding: 16px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      color: var(--muted);
      box-shadow: var(--shadow);
    }

    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr;}
      nav.toc{position:relative; top:0;}
      canvas{height: 300px;}
    }

    @keyframes rise { from { transform: translateY(6px); opacity: .0;} to { transform: translateY(0); opacity: 1;} }
    section.card{animation: rise .25s ease both;}

    @media print{
      :root{--shadow:none;}
      body{background:#fff; color:#000;}
      header.hero, section.card, nav.toc, footer{
        box-shadow:none !important;
        background:#fff !important;
        border-color:#bbb !important;
      }
      a{color:#000; text-decoration:underline;}
      nav.toc{display:none;}
      .grid{grid-template-columns:1fr;}
      .btn{display:none;}
      .eq{background:#f6f6f6 !important;}
      figure{break-inside: avoid;}
      section{break-inside: avoid; page-break-inside: avoid;}
      h2, h3{page-break-after: avoid;}
    }
  </style>
</head>
<body>
  <a id="top"></a>
  <div class="wrap">
    <header class="hero">
      <div class="kicker"><span class="kdot"></span><span>Integrated Photonics • Electro-Optic Modulation • LiNbO₃</span></div>
      <h1>Designing a LiNbO₃ Mach–Zehnder Intensity Modulator for Minimum Half-Wave Voltage <span style="white-space:nowrap;">Vπ</span></h1>
      <p class="subtitle">
        We choose the crystal orientation and guided-mode polarization to maximize the linear electro-optic (Pockels) phase shift per volt,
        then compute the resulting <span style="white-space:nowrap;">Vπ</span> for a <span style="white-space:nowrap;">L = 1 mm</span> active region with electrode gap <span style="white-space:nowrap;">d = 5 µm</span>.
      </p>
    </header>

    <div class="grid">
      <nav class="toc" aria-label="Table of contents">
        <h2>Contents</h2>
        <a href="#qs">Quick Summary</a>
        <a href="#p0">PART 0 — Concept Primer</a>
        <a href="#p1">PART 1 — Problem Analysis</a>
        <a href="#p2">PART 2 — Strategy & Tips</a>
        <a href="#p3">PART 3 — Full Solution</a>
        <a href="#p4">PART 4 — Deeper Understanding</a>
        <a href="#p5">PART 5 — Optional Plot Guide</a>
        <small>
          Tip: use the “Copy” buttons to grab equations and the final numeric answer as plain text for your notes.
        </small>
      </nav>

      <main>
        <section id="qs" class="card">
          <h2>Quick Summary</h2>
          <ul>
            <li><strong>What this is about:</strong> A LiNbO₃ Mach–Zehnder interferometer (MZI) intensity modulator uses an electro-optic phase shifter in one (or both) arms to control interference at the output.</li>
            <li><strong>Key physics idea:</strong> The <em>Pockels effect</em> changes the refractive index linearly with applied electric field, producing a controllable optical phase shift.</li>
            <li><strong>Governing relationships:</strong> Pockels index change (small-signal): <span class="muted">Δn ≈ −(1/2) n³ r E</span> and phase shift: <span class="muted">Δφ = (2π/λ) Δn L</span>.</li>
            <li><strong>Half-wave voltage meaning:</strong> <span class="muted">Vπ</span> is the voltage needed to produce a phase shift of <span class="muted">π</span> (enough to switch an MZI from maximum to minimum output in the ideal case).</li>
            <li><strong>Design choice for minimum Vπ:</strong> Maximize <span class="muted">n³ r</span> using the largest relevant electro-optic coefficient and the appropriate refractive index (ordinary vs extraordinary).</li>
            <li><strong>Best choice here:</strong> Use the <strong>extraordinary polarization</strong> (guided mode polarized along the crystal <strong>z</strong> axis) and apply the electric field along <strong>z</strong>, so the modulation uses <strong>r33</strong>.</li>
            <li><strong>Result type:</strong> Both <strong>symbolic</strong> (general design formula) and <strong>numeric</strong> (with given L, d, λ₀, n, r).</li>
            <li><strong>Numerical result (single-arm phase shifter):</strong> <strong>Vπ ≈ 13.5 V</strong> for <span class="muted">L = 1 mm</span>, <span class="muted">d = 5 µm</span>, <span class="muted">λ₀ = 0.85 µm</span>, <span class="muted">n = n_e = 2.17</span>, <span class="muted">r = r33 = 30.9 pm/V</span>.</li>
            <li><strong>Physical interpretation:</strong> Larger <span class="muted">L</span> and smaller <span class="muted">d</span> reduce <span class="muted">Vπ</span>; choosing the largest <span class="muted">r</span> is the dominant material lever.</li>
          </ul>

          <div class="callouts">
            <div class="callout keyeq">
              <h4>Key equations <span class="badge">copyable</span></h4>
              <div class="eq" id="eq-key">Pockels (small-signal):   Δn ≈ −(1/2) n^3 r E
Phase shift:             Δφ = (2π/λ) Δn L
Uniform field:           E ≈ V/d
Half-wave condition:     |Δφ| = π  ⇒  Vπ = (λ d)/(n^3 r L)</div>
              <div class="row">
                <button class="btn" data-copy-target="#eq-key" aria-label="Copy key equations">
                  <span class="dot"></span>Copy equations (plain text)
                </button>
              </div>
              <p class="faint">Note: Some modulators use “push–pull” (opposite phase shifts in the two arms), which halves the required Vπ for the same intensity swing. This problem statement does not specify push–pull, so we compute the standard single-arm Vπ and mention the push–pull variant as an add-on.</p>
            </div>
          </div>
        </section>

        <section id="p0" class="card">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

          <h3>0.1 Core definitions (symbols + SI units)</h3>
          <ul>
            <li><strong>λ</strong> (m): optical wavelength in vacuum (here λ₀ = 0.85 µm).</li>
            <li><strong>n</strong> (dimensionless): refractive index of the guided polarization (ordinary <strong>nₒ</strong> or extraordinary <strong>nₑ</strong> in LiNbO₃).</li>
            <li><strong>r</strong> (m/V): linear electro-optic (Pockels) coefficient (given in pm/V).</li>
            <li><strong>E</strong> (V/m): applied electric field (often approximated as <strong>E ≈ V/d</strong> in a simple electrode gap).</li>
            <li><strong>L</strong> (m): length of the phase-shifting (active) region.</li>
            <li><strong>d</strong> (m): effective electrode separation across which the voltage drops.</li>
            <li><strong>Δn</strong> (dimensionless): change in refractive index due to the field.</li>
            <li><strong>Δφ</strong> (rad): induced optical phase shift over length L.</li>
            <li><strong>Vπ</strong> (V): voltage that produces a phase shift magnitude of π (half-wave retardation).</li>
          </ul>

          <h3>0.2 Physical meaning (intuition)</h3>
          <p>
            An MZI intensity modulator splits light into two waveguide arms, then recombines them.
            The output power depends on the <strong>phase difference</strong> between arms.
            If we change the index in one arm, we change its optical path length and therefore its phase.
            A phase change of <strong>π</strong> flips constructive interference to destructive interference (ideal “on” to “off” switching).
          </p>

          <h3>0.3 Key principle: Pockels effect in electro-optic crystals</h3>
          <p>
            In non-centrosymmetric crystals like LiNbO₃, the refractive index changes <em>linearly</em> with electric field (Pockels effect).
            In compact form (for a chosen polarization that couples to a particular tensor element),
            the index change is well approximated by:
          </p>
          <div class="eq" id="eq-pockels">Δn ≈ −(1/2) n^3 r E</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-pockels"><span class="dot"></span>Copy this equation</button>
          </div>
          <p class="muted">
            The factor <span style="font-family:var(--mono);">n^3</span> makes high-index materials respond more strongly in phase for a given r and E.
          </p>

          <h3>0.4 From index change to phase shift</h3>
          <p>
            A wave accumulating phase in a medium has propagation constant <span style="font-family:var(--mono);">β = (2π/λ) n</span>.
            A small index change produces a phase shift:
          </p>
          <div class="eq" id="eq-phase">Δφ = (2π/λ) Δn L</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-phase"><span class="dot"></span>Copy this equation</button>
          </div>

          <h3>0.5 Validity conditions & common approximations</h3>
          <div class="callouts">
            <div class="callout assump">
              <h4>Assumptions typically used <span class="badge">check before trusting numbers</span></h4>
              <ul>
                <li><strong>Uniform field:</strong> take <span style="font-family:var(--mono);">E ≈ V/d</span> (real electrodes give a nonuniform field and an overlap factor).</li>
                <li><strong>Small-signal index change:</strong> linear Pockels regime (good for usual modulator voltages).</li>
                <li><strong>Perfect overlap:</strong> optical mode fully overlaps the active region; in practice use a confinement/overlap factor Γ &lt; 1.</li>
                <li><strong>No velocity mismatch / RF loss:</strong> relevant for GHz bandwidth, but not needed for static Vπ estimation.</li>
              </ul>
            </div>
          </div>

          <h3>0.6 Mini intuition examples (quick)</h3>
          <ul>
            <li><strong>Longer device → smaller voltage:</strong> doubling L doubles phase shift for the same Δn, so Vπ halves.</li>
            <li><strong>Smaller electrode gap → smaller voltage:</strong> for fixed V, smaller d increases E and thus Δn; hence Vπ ∝ d.</li>
            <li><strong>Use the biggest r:</strong> since Vπ ∝ 1/r, choosing r33 instead of r13 can reduce Vπ by several times.</li>
          </ul>

          <h3>0.7 What to watch for (pitfalls)</h3>
          <ul>
            <li><strong>Tensor bookkeeping:</strong> LiNbO₃ has different r coefficients depending on field direction and optical polarization.</li>
            <li><strong>Ordinary vs extraordinary:</strong> the index n in the phase shift is the one for the guided polarization you actually excite.</li>
            <li><strong>Push–pull vs single-arm:</strong> intensity modulators often drive arms oppositely; that halves Vπ compared with driving only one arm.</li>
            <li><strong>Real devices:</strong> electrode geometry introduces an <em>effective</em> field and a mode-overlap factor; the simple Vπ formula is an optimistic baseline.</li>
          </ul>

          <details>
            <summary>Optional deeper note: why “Δn ≈ −(1/2) n³ r E” appears so often</summary>
            <p>
              The Pockels effect is cleanly expressed as a change in the inverse squared refractive index (index ellipsoid):
              <span style="font-family:var(--mono);">Δ(1/n²) = r E</span> (schematically, for a chosen component).
              For small changes, differentiate: <span style="font-family:var(--mono);">d(1/n²) = −2 dn / n³</span>.
              Solving gives <span style="font-family:var(--mono);">dn ≈ −(1/2) n³ r E</span>.
            </p>
          </details>

          <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </section>

        <section id="p1" class="card">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

          <h3>1.1 Restate the problem in plain words</h3>
          <p>
            We want to design a LiNbO₃ integrated-photonic <strong>intensity modulator</strong> based on a Mach–Zehnder interferometer.
            An electro-optic phase modulator section of length <span style="font-family:var(--mono);">L = 1 mm</span> and electrode gap <span style="font-family:var(--mono);">d = 5 µm</span>
            changes the phase in an arm. We must choose:
          </p>
          <ul>
            <li>the <strong>crystal orientation</strong> (which axis the electric field is applied along), and</li>
            <li>the <strong>polarization</strong> of the guided optical mode (ordinary vs extraordinary),</li>
          </ul>
          <p>
            so that the required <strong>half-wave voltage Vπ</strong> is as small as possible.
          </p>

          <h3>1.2 Given quantities</h3>
          <ul>
            <li><strong>L</strong> = 1 mm = 1.0×10<sup>−3</sup> m</li>
            <li><strong>d</strong> = 5 µm = 5.0×10<sup>−6</sup> m</li>
            <li><strong>λ₀</strong> = 0.85 µm = 0.85×10<sup>−6</sup> m</li>
            <li><strong>nₒ</strong> = 2.29, <strong>nₑ</strong> = 2.17</li>
            <li>Electro-optic coefficients:
              <span style="font-family:var(--mono);">r33 = 30.9</span>,
              <span style="font-family:var(--mono);">r13 = 8.6</span>,
              <span style="font-family:var(--mono);">r22 = 3.4</span>,
              <span style="font-family:var(--mono);">r42 = 28</span> pm/V
            </li>
          </ul>

          <h3>1.3 Unknowns</h3>
          <ul>
            <li>Which orientation/polarization yields the <strong>minimum Vπ</strong>.</li>
            <li>The corresponding numerical value of <strong>Vπ</strong> for that best choice.</li>
          </ul>

          <h3>1.4 Which principles apply (and why)</h3>
          <ul>
            <li><strong>Pockels effect</strong> applies because LiNbO₃ is a strong linear electro-optic crystal and the problem provides r coefficients.</li>
            <li><strong>Interferometric intensity modulation</strong> applies because the device is a Mach–Zehnder: output intensity depends on phase difference.</li>
            <li><strong>Waveguide optics</strong> appears only through an effective refractive index and polarization choice; detailed mode solving is not required (not enough geometry is provided).</li>
          </ul>
          <p class="muted">
            We do <em>not</em> need Bragg diffraction, absorption models, or nonlinear Kerr effects here because the problem explicitly points to the electro-optic coefficients and asks for Vπ.
          </p>

          <h3>1.5 Assumptions (explicit)</h3>
          <div class="callouts">
            <div class="callout assump">
              <h4>Assumptions used in this design estimate <span class="badge">standard for textbook Vπ</span></h4>
              <ul>
                <li>Uniform electric field: <span style="font-family:var(--mono);">E = V/d</span>.</li>
                <li>Perfect overlap between optical mode and modulating field (no overlap factor Γ).</li>
                <li>Single-pass phase modulation over length L.</li>
                <li>Lossless, ideal MZI couplers (the required phase for “half-wave” switching is π differential phase).</li>
              </ul>
            </div>
          </div>

          <h3>1.6 Possible approaches (compare 2–3)</h3>
          <ol>
            <li><strong>Direct Vπ formula approach (best here):</strong> use <span style="font-family:var(--mono);">Δn ≈ −(1/2)n³ r E</span> and <span style="font-family:var(--mono);">Δφ = (2π/λ)ΔnL</span>, then solve for Vπ. <em>Pros:</em> fast, uses given data directly. <em>Cons:</em> ignores overlap factor and detailed tensor rotations beyond the main diagonal coupling.</li>
            <li><strong>Index-ellipsoid / tensor method:</strong> write the full LiNbO₃ electro-optic tensor and compute the effective index change for an arbitrary field direction and polarization. <em>Pros:</em> most general. <em>Cons:</em> requires more geometry detail than provided for a guided mode and electrode field distribution.</li>
            <li><strong>Full waveguide + RF simulation:</strong> compute mode profiles and electrode fields, then determine an effective Vπ including overlap and microwave effects. <em>Pros:</em> realistic. <em>Cons:</em> impossible with the information given (and beyond the requested scope).</li>
          </ol>

          <h3>1.7 Chosen approach (and why)</h3>
          <p>
            We choose the <strong>direct Vπ formula approach</strong>, then evaluate it for the plausible “largest-coupling” choices:
            using <span style="font-family:var(--mono);">r33</span> with the extraordinary index <span style="font-family:var(--mono);">n_e</span>, versus alternatives like <span style="font-family:var(--mono);">r13</span> with <span style="font-family:var(--mono);">n_o</span>.
            This matches the data given and targets the minimum Vπ.
          </p>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <section id="p2" class="card">
          <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>
          <ol>
            <li><strong>Goal:</strong> Relate voltage to phase shift. <strong>Tool:</strong> <span style="font-family:var(--mono);">E = V/d</span>. <strong>Meaning:</strong> converts electrode voltage into the material’s driving field.</li>
            <li><strong>Goal:</strong> Express index change from Pockels effect. <strong>Tool:</strong> <span style="font-family:var(--mono);">Δn ≈ −(1/2)n³ r E</span>. <strong>Meaning:</strong> gives how strongly the material phase responds per field.</li>
            <li><strong>Goal:</strong> Convert Δn to optical phase shift. <strong>Tool:</strong> <span style="font-family:var(--mono);">Δφ = (2π/λ)ΔnL</span>. <strong>Meaning:</strong> phase grows with length and with the induced index change.</li>
            <li><strong>Goal:</strong> Impose the half-wave condition. <strong>Tool:</strong> <span style="font-family:var(--mono);">|Δφ| = π</span>. <strong>Meaning:</strong> π phase shift corresponds to “half-wave” switching in an interferometer.</li>
            <li><strong>Goal:</strong> Solve for Vπ symbolically. <strong>Tool:</strong> algebra. <strong>Meaning:</strong> exposes how Vπ scales with λ, d, n, r, L.</li>
            <li><strong>Goal:</strong> Minimize Vπ by choosing the best (n, r) combination consistent with LiNbO₃ orientation/polarization. <strong>Tool:</strong> compare <span style="font-family:var(--mono);">n³ r</span> across options. <strong>Meaning:</strong> the largest <span style="font-family:var(--mono);">n³ r</span> gives the smallest Vπ.</li>
            <li><strong>Goal:</strong> Plug in numbers carefully. <strong>Tool:</strong> unit conversions (µm→m, pm/V→m/V). <strong>Meaning:</strong> avoids the most common numerical mistakes.</li>
          </ol>

          <div class="callouts">
            <div class="callout mist">
              <h4>Common mistakes <span class="badge">quick fixes</span></h4>
              <ul>
                <li><strong>pm/V conversion:</strong> 1 pm/V = 1×10<sup>−12</sup> m/V.</li>
                <li><strong>Using the wrong n:</strong> choose <span style="font-family:var(--mono);">n = n_e</span> if the guided mode is extraordinary (polarized along z), otherwise <span style="font-family:var(--mono);">n = n_o</span>.</li>
                <li><strong>Forgetting the n³ factor:</strong> Vπ depends strongly on refractive index.</li>
                <li><strong>Confusing MZI switching vs phase shifter:</strong> the phase shifter needs π differential phase for ideal extinction; how you distribute that between arms changes Vπ by simple factors (like 2 for push–pull).</li>
              </ul>
            </div>
          </div>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <section id="p3" class="card">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

          <h3>3.1 Physical intuition before calculating</h3>
          <p>
            We expect the smallest Vπ when the device produces the <strong>largest phase shift per volt</strong>.
            From the Pockels formula, the “strength” scales like <span style="font-family:var(--mono);">n³ r</span> and also benefits from a large interaction length L and small electrode spacing d.
            Since LiNbO₃ has a particularly large coefficient <span style="font-family:var(--mono);">r33</span>, we anticipate that a configuration using <span style="font-family:var(--mono);">r33</span>
            (field along z and extraordinary polarization) will win.
          </p>

          <h3>3.2 Derive Vπ from first principles (step-by-step)</h3>

          <p><strong>Step A — Relate voltage to electric field.</strong></p>
          <p>
            With electrode separation <span style="font-family:var(--mono);">d</span>, the simplest estimate of the field magnitude is
          </p>
          <div class="eq" id="eq-E">E ≈ V/d</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-E"><span class="dot"></span>Copy</button>
          </div>

          <p><strong>Step B — Pockels index change for the chosen polarization.</strong></p>
          <p>
            For the polarization/component that couples to a particular electro-optic coefficient <span style="font-family:var(--mono);">r</span>, the small-signal index change is
          </p>
          <div class="eq" id="eq-dn">Δn ≈ −(1/2) n^3 r E</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-dn"><span class="dot"></span>Copy</button>
          </div>
          <p class="muted">
            The sign is not important for Vπ because Vπ depends on the <em>magnitude</em> of phase shift; reversing voltage flips the sign of Δn.
          </p>

          <p><strong>Step C — Convert index change to phase shift over length L.</strong></p>
          <p>
            Optical phase accumulated over length L changes by
          </p>
          <div class="eq" id="eq-dphi">Δφ = (2π/λ) Δn L</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-dphi"><span class="dot"></span>Copy</button>
          </div>

          <p><strong>Step D — Impose the half-wave condition.</strong></p>
          <p>
            The half-wave voltage <span style="font-family:var(--mono);">Vπ</span> is defined by <span style="font-family:var(--mono);">|Δφ| = π</span>.
            Substitute Steps A–C:
          </p>
          <div class="eq" id="eq-derive">|Δφ| = (2π/λ) |Δn| L
      = (2π/λ) (1/2) n^3 r |E| L
      = (2π/λ) (1/2) n^3 r (|V|/d) L

Set |Δφ| = π  ⇒  π = (2π/λ)(1/2) n^3 r (Vπ/d) L</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-derive"><span class="dot"></span>Copy derivation</button>
          </div>

          <p><strong>Step E — Solve for Vπ.</strong></p>
          <p>
            Cancel π on both sides and solve:
          </p>
          <div class="eq" id="eq-Vpi">Vπ = (λ d)/(n^3 r L)</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-Vpi"><span class="dot"></span>Copy Vπ formula</button>
          </div>

          <h3>3.3 Choose orientation & polarization to minimize Vπ</h3>
          <p>
            From <span style="font-family:var(--mono);">Vπ ∝ 1/(n³ r)</span>, we should maximize <span style="font-family:var(--mono);">n³ r</span>.
            In LiNbO₃, the largest provided coefficient is <span style="font-family:var(--mono);">r33 = 30.9 pm/V</span>, and it is associated with
            applying the electric field along the crystal <strong>z</strong> axis and using the <strong>extraordinary</strong> optical polarization (index <span style="font-family:var(--mono);">n = n_e</span>).
          </p>

          <div class="callouts">
            <div class="callout keyeq">
              <h4>Best configuration (minimum Vπ) <span class="badge">design choice</span></h4>
              <ul>
                <li><strong>Crystal orientation:</strong> choose the device so the applied modulating field is along the <strong>z (optic) axis</strong> (often described as “z-field” drive).</li>
                <li><strong>Guided polarization:</strong> excite the <strong>extraordinary (TM-like)</strong> mode so the relevant index is <strong>n = n_e</strong>.</li>
                <li><strong>Electro-optic coefficient used:</strong> <strong>r = r33</strong> (largest of the given set), giving the strongest phase shift per volt.</li>
              </ul>
            </div>
          </div>

          <p class="muted">
            Why not the other coefficients? For simple phase modulation of a fixed polarization, the dominant “diagonal” coupling for ordinary polarization with a z-field uses <span style="font-family:var(--mono);">r13</span>, which is much smaller.
            Coefficients like <span style="font-family:var(--mono);">r22</span> and <span style="font-family:var(--mono);">r42</span> can be important for other geometries (including polarization rotation),
            but with the information given, the standard minimum-Vπ choice is the well-known <span style="font-family:var(--mono);">r33</span> extraordinary configuration.
          </p>

          <h3>3.4 Compute the numerical Vπ for the best choice</h3>
          <p>
            Use <span style="font-family:var(--mono);">λ = 0.85×10⁻⁶ m</span>,
            <span style="font-family:var(--mono);">d = 5×10⁻⁶ m</span>,
            <span style="font-family:var(--mono);">L = 1×10⁻³ m</span>,
            <span style="font-family:var(--mono);">n = n_e = 2.17</span>,
            <span style="font-family:var(--mono);">r = r33 = 30.9×10⁻¹² m/V</span>.
          </p>
          <div class="eq" id="eq-num">Vπ = (λ d)/(n^3 r L)
   = (0.85×10⁻⁶)(5×10⁻⁶) / [(2.17)³ (30.9×10⁻¹²) (1×10⁻³)]
   ≈ 13.46 V  ≈ 13.5 V</div>
          <div class="row">
            <button class="btn good" data-copy-target="#eq-num"><span class="dot"></span>Copy numeric evaluation</button>
          </div>

          <div class="callouts">
            <div class="callout final">
              <h4>Final answer <span class="badge">copyable</span></h4>
              <p><strong>Minimum half-wave voltage (single-arm phase shifter):</strong></p>
              <div class="eq" id="eq-final">Choose E || z and extraordinary (z-polarized / TM-like) guided mode so the modulation uses r33.
Vπ = (λ0 d)/(n_e^3 r33 L) ≈ 13.5 V  (for L = 1 mm, d = 5 µm, λ0 = 0.85 µm, n_e = 2.17, r33 = 30.9 pm/V).</div>
              <div class="row">
                <button class="btn good" data-copy-target="#eq-final"><span class="dot"></span>Copy final answer (plain text)</button>
              </div>
              <details>
                <summary>Optional note: push–pull drive (common in MZI intensity modulators)</summary>
                <p>
                  If the device drives the two MZI arms with equal and opposite phase shifts (push–pull), the <em>differential</em> phase doubles for the same voltage.
                  In that common case, the required voltage for the same π differential phase is
                  <span style="font-family:var(--mono);">Vπ(push–pull) = (λ d)/(2 n³ r L) ≈ 6.7 V</span>
                  using the same best configuration.
                </p>
              </details>
            </div>
          </div>

          <h3>3.5 Sanity checks</h3>
          <ul>
            <li><strong>Units:</strong> <span style="font-family:var(--mono);">(λ d)/(n³ r L)</span> has units (m·m)/(dimensionless·m/V·m) = V ✔</li>
            <li><strong>Scaling:</strong> increasing <span style="font-family:var(--mono);">L</span> by 10× reduces <span style="font-family:var(--mono);">Vπ</span> by 10× ✔</li>
            <li><strong>Reasonableness:</strong> a ~10–20 V Vπ for a short (1 mm) LiNbO₃ phase shifter with a few-µm gap is plausible as a baseline textbook estimate ✔</li>
          </ul>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <section id="p4" class="card">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

          <h3>4.1 Re-interpret the final formula</h3>
          <p>
            The design equation
            <span style="font-family:var(--mono);">Vπ = (λ d)/(n³ r L)</span>
            tells you exactly what controls modulator efficiency:
          </p>
          <ul>
            <li><strong>λ</strong> (wavelength): longer wavelength requires higher Vπ (harder to accumulate π phase in cycles).</li>
            <li><strong>d</strong> (electrode spacing): larger spacing reduces field for a given voltage → higher Vπ.</li>
            <li><strong>L</strong> (interaction length): longer length gives more phase per volt → lower Vπ.</li>
            <li><strong>n³ r</strong> (material + polarization choice): the strongest lever from orientation/polarization; maximizing it minimizes Vπ.</li>
          </ul>

          <h3>4.2 Parameter dependence (qualitative)</h3>
          <ul>
            <li><strong>Double L</strong> → Vπ halves.</li>
            <li><strong>Halve d</strong> → Vπ halves (strong motivation for tight electrode gaps, limited by fabrication and optical loss).</li>
            <li><strong>Switch from r13 to r33</strong> → Vπ reduces by roughly r33/r13 ≈ 3.6× (a big gain).</li>
            <li><strong>Polarization choice matters twice:</strong> it selects both the <em>index</em> (nₒ vs nₑ) and the <em>tensor element</em> (r coefficient).</li>
          </ul>

          <h3>4.3 Quick comparison to alternative (non-optimal) choices</h3>
          <p>
            If instead you used the ordinary polarization with a z-directed field (commonly associated with <span style="font-family:var(--mono);">r13</span>),
            you would get a much larger Vπ:
          </p>
          <div class="eq" id="eq-compare">Using ordinary polarization (n = n_o) with r13:
Vπ ≈ (λ0 d)/(n_o^3 r13 L)
   ≈ (0.85 µm · 5 µm)/[(2.29)^3 · 8.6 pm/V · 1 mm]
   ≈ 41 V</div>
          <div class="row">
            <button class="btn" data-copy-target="#eq-compare"><span class="dot"></span>Copy comparison</button>
          </div>
          <p class="muted">
            This comparison reinforces the core design rule: <strong>choose the polarization + field direction that accesses r33 in LiNbO₃</strong> when the goal is minimum Vπ.
          </p>

          <h3>4.4 Alternative derivation idea (brief but meaningful)</h3>
          <p>
            You can derive the same result by starting from the <strong>index ellipsoid</strong> form:
            <span style="font-family:var(--mono);">Δ(1/n²) = r E</span>
            for the relevant principal index, then converting <span style="font-family:var(--mono);">Δ(1/n²)</span> to <span style="font-family:var(--mono);">Δn</span> via differentiation,
            and finally using <span style="font-family:var(--mono);">Δφ = (2π/λ)ΔnL</span>.
            This route is especially helpful when the field is not aligned with a principal axis and you must compute an effective index change.
          </p>

          <h3>4.5 Concept checks (self-test with answers)</h3>
          <ul>
            <li><strong>Q:</strong> If you keep the same device but go to a longer wavelength, does Vπ go up or down? <strong>A:</strong> Up, because Vπ ∝ λ.</li>
            <li><strong>Q:</strong> Why does r33 usually beat r13 in LiNbO₃ modulators? <strong>A:</strong> r33 is significantly larger, and with extraordinary polarization you still have a comparable index, so n³r is bigger.</li>
            <li><strong>Q:</strong> What’s the quickest way to cut Vπ in half without changing material? <strong>A:</strong> Double L (or halve d), or use push–pull if you were single-arm.</li>
            <li><strong>Q:</strong> Why might a real device have a higher measured Vπ than this calculation? <strong>A:</strong> Nonuniform field, less than 100% optical/electric overlap (Γ&lt;1), and electrode geometry effects.</li>
          </ul>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <section id="p5" class="card">
          <h2>PART 5 — Optional Plot Guide</h2>

          <p>
            A plot is useful here because the design equation is strongly instructive: <strong>Vπ scales as 1/L</strong>.
            The figure below shows <span style="font-family:var(--mono);">Vπ(L)</span> for the <em>best configuration</em> (extraordinary + r33),
            using the <strong>given</strong> λ₀ and d and the <strong>given</strong> material parameters.
          </p>

          <figure>
            <canvas id="plot" aria-label="Static plot of Vpi versus interaction length"></canvas>
            <figcaption>
              <strong>Static plot:</strong> Half-wave voltage <span style="font-family:var(--mono);">Vπ</span> versus interaction length <span style="font-family:var(--mono);">L</span> (best configuration: <span style="font-family:var(--mono);">n = n_e</span>, <span style="font-family:var(--mono);">r = r33</span>, <span style="font-family:var(--mono);">d = 5 µm</span>, <span style="font-family:var(--mono);">λ0 = 0.85 µm</span>). Notice the inverse dependence: doubling L halves Vπ.
            </figcaption>
          </figure>

          <h3>How to read the plot</h3>
          <ul>
            <li><strong>x-axis:</strong> interaction length <span style="font-family:var(--mono);">L</span> in millimeters (mm).</li>
            <li><strong>y-axis:</strong> half-wave voltage <span style="font-family:var(--mono);">Vπ</span> in volts (V).</li>
            <li><strong>Key feature:</strong> the curve is a hyperbola-like decay because <span style="font-family:var(--mono);">Vπ ∝ 1/L</span>.</li>
            <li><strong>Connection to the solution:</strong> at <span style="font-family:var(--mono);">L = 1 mm</span>, the plot shows <span style="font-family:var(--mono);">Vπ ≈ 13.5 V</span>, matching the computed result.</li>
          </ul>

          <a class="backtop" href="#top">↑ Back to top</a>
        </section>

        <footer>
          <strong>Takeaway:</strong> To minimize LiNbO₃ modulator Vπ, align the electric field and optical polarization to access <span style="font-family:var(--mono);">r33</span> with the extraordinary index, then leverage long interaction length and small electrode gap.
          <div class="faint" style="margin-top:8px;">
            Baseline formula used: <span style="font-family:var(--mono);">Vπ = (λ d)/(n³ r L)</span> (idealized uniform field and perfect overlap).
          </div>
        </footer>
      </main>
    </div>
  </div>

  <script>
    // Copy buttons (plain text)
    (function(){
      function getTextFromTarget(sel){
        const el = document.querySelector(sel);
        if(!el) return "";
        return (el.innerText || el.textContent || "").replace(/\u00A0/g, " ").trim();
      }
      async function copyText(text){
        try{
          await navigator.clipboard.writeText(text);
          return true;
        }catch(e){
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly','');
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          try{
            document.execCommand('copy');
            document.body.removeChild(ta);
            return true;
          }catch(err){
            document.body.removeChild(ta);
            return false;
          }
        }
      }
      function flash(btn, ok){
        const prev = btn.innerHTML;
        btn.innerHTML = ok ? '<span class="dot"></span>Copied!' : '<span class="dot"></span>Copy failed';
        btn.style.borderColor = ok ? 'rgba(52,211,153,.40)' : 'rgba(251,113,133,.45)';
        btn.style.background = ok ? 'rgba(52,211,153,.10)' : 'rgba(251,113,133,.10)';
        setTimeout(()=>{
          btn.innerHTML = prev;
          btn.style.borderColor = '';
          btn.style.background = '';
        }, 900);
      }
      document.addEventListener('click', async (ev)=>{
        const btn = ev.target.closest('button[data-copy-target]');
        if(!btn) return;
        const sel = btn.getAttribute('data-copy-target');
        const text = getTextFromTarget(sel);
        const ok = await copyText(text);
        flash(btn, ok);
      });
    })();

    // Static plot: Vpi vs L (best configuration)
    (function(){
      const canvas = document.getElementById('plot');
      if(!canvas) return;

      const lambda0 = 0.85e-6;      // m
      const d = 5e-6;              // m
      const ne = 2.17;             // dimensionless
      const r33 = 30.9e-12;        // m/V

      function Vpi(L){ // L in meters
        return (lambda0 * d) / (Math.pow(ne,3) * r33 * L);
      }

      function draw(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const rect = canvas.getBoundingClientRect();
        const W = Math.max(320, Math.floor(rect.width));
        const H = Math.max(260, Math.floor(rect.height));
        canvas.width = Math.floor(W * dpr);
        canvas.height = Math.floor(H * dpr);
        const ctx = canvas.getContext('2d');
        ctx.setTransform(dpr,0,0,dpr,0,0);

        const cs = getComputedStyle(document.documentElement);
        const bg = cs.getPropertyValue('--panel2').trim() || '#111827';
        const fg = cs.getPropertyValue('--text').trim() || '#e5e7eb';
        const muted = cs.getPropertyValue('--muted').trim() || '#cbd5e1';
        const faint = cs.getPropertyValue('--faint').trim() || '#94a3b8';
        const line = cs.getPropertyValue('--line').trim() || 'rgba(255,255,255,.12)';
        const accent = cs.getPropertyValue('--accent').trim() || '#60a5fa';
        const accent2 = cs.getPropertyValue('--accent2').trim() || '#a78bfa';

        ctx.clearRect(0,0,W,H);
        ctx.fillStyle = bg;
        ctx.fillRect(0,0,W,H);

        const padL = 58, padR = 18, padT = 36, padB = 44;
        const x0 = padL, y0 = padT;
        const x1 = W - padR, y1 = H - padB;
        const plotW = x1 - x0, plotH = y1 - y0;

        const Lmin = 0.5e-3, Lmax = 5e-3; // m
        const Vmax = Vpi(Lmin);
        const yMin = 0;
        const yMax = Vmax * 1.05;

        function xMap(L){ return x0 + ((L - Lmin) / (Lmax - Lmin)) * plotW; }
        function yMap(V){ return y1 - ((V - yMin) / (yMax - yMin)) * plotH; }

        ctx.strokeStyle = line;
        ctx.lineWidth = 1;

        // x ticks at 0.5, 1.0, ..., 5.0 mm
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.fillStyle = faint;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        for(let Lmm=0.5; Lmm<=5.0001; Lmm+=0.5){
          const x = xMap(Lmm*1e-3);
          ctx.beginPath();
          ctx.moveTo(x,y0);
          ctx.lineTo(x,y1);
          ctx.stroke();
          ctx.fillText(Lmm.toFixed(Lmm%1===0?0:1), x, y1+8);
        }

        // nice y ticks
        function niceStep(maxVal, targetTicks){
          const raw = maxVal / targetTicks;
          const pow = Math.pow(10, Math.floor(Math.log10(raw)));
          const frac = raw / pow;
          let niceFrac = 1;
          if(frac <= 1) niceFrac = 1;
          else if(frac <= 2) niceFrac = 2;
          else if(frac <= 5) niceFrac = 5;
          else niceFrac = 10;
          return niceFrac * pow;
        }
        const step = niceStep(yMax, 7);
        const yTop = Math.ceil(yMax/step)*step;

        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        for(let v=0; v<=yTop+1e-9; v+=step){
          const y = yMap(v);
          ctx.beginPath();
          ctx.moveTo(x0,y);
          ctx.lineTo(x1,y);
          ctx.stroke();
          const lab = (v >= 10) ? v.toFixed(0) : (v >= 1 ? v.toFixed(1) : v.toFixed(2));
          ctx.fillText(lab, x0-8, y);
        }

        // axes
        ctx.strokeStyle = fg;
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(x0,y0);
        ctx.lineTo(x0,y1);
        ctx.lineTo(x1,y1);
        ctx.stroke();

        // title
        ctx.fillStyle = fg;
        ctx.textAlign = 'left';
        ctx.textBaseline = 'top';
        ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.fillText('Half-wave voltage Vπ vs interaction length L (best: n = ne, r = r33)', x0, 10);

        // axis labels
        ctx.fillStyle = muted;
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText('Interaction length L (mm)', x0 + plotW/2, H-8);

        ctx.save();
        ctx.translate(16, y0 + plotH/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText('Half-wave voltage Vπ (V)', 0, 0);
        ctx.restore();

        // curve
        const grad = ctx.createLinearGradient(x0,y0,x1,y1);
        grad.addColorStop(0, accent);
        grad.addColorStop(1, accent2);
        ctx.strokeStyle = grad;
        ctx.lineWidth = 2.2;
        ctx.beginPath();
        const N = 240;
        for(let i=0;i<=N;i++){
          const L = Lmin + (Lmax - Lmin)*i/N;
          const v = Vpi(L);
          const x = xMap(L);
          const y = yMap(v);
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.stroke();

        // point at L=1 mm
        const L1 = 1e-3;
        const V1 = Vpi(L1);
        const xP = xMap(L1);
        const yP = yMap(V1);

        ctx.fillStyle = fg;
        ctx.beginPath();
        ctx.arc(xP,yP,4.2,0,Math.PI*2);
        ctx.fill();

        // annotation box
        const label = `At L = 1.0 mm: Vπ ≈ ${V1.toFixed(1)} V`;
        const lx = Math.min(xP + 10, x1 - 160);
        const ly = Math.max(yP - 10, y0 + 18);
        const pad = 6;
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        const tw = ctx.measureText(label).width;
        const boxW = tw + 2*pad;
        const boxH = 20;

        ctx.fillStyle = 'rgba(0,0,0,.25)';
        ctx.fillRect(lx, ly - boxH, boxW, boxH);
        ctx.strokeStyle = line;
        ctx.strokeRect(lx, ly - boxH, boxW, boxH);
        ctx.fillStyle = muted;
        ctx.textAlign = 'left';
        ctx.textBaseline = 'bottom';
        ctx.fillText(label, lx + pad, ly - 5);

        // legend
        const legX = x1 - 210;
        const legY = y0 + 10;
        ctx.fillStyle = 'rgba(0,0,0,.18)';
        ctx.fillRect(legX, legY, 200, 46);
        ctx.strokeStyle = line;
        ctx.strokeRect(legX, legY, 200, 46);

        ctx.strokeStyle = grad;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(legX + 10, legY + 16);
        ctx.lineTo(legX + 40, legY + 16);
        ctx.stroke();

        ctx.fillStyle = muted;
        ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText('Vπ(L) = (λ0 d)/(ne³ r33 L)', legX + 50, legY + 16);
        ctx.fillStyle = faint;
        ctx.fillText('Using: λ0=0.85µm, d=5µm, ne=2.17, r33=30.9pm/V', legX + 10, legY + 34);
      }

      let raf = 0;
      function scheduleDraw(){
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(draw);
      }
      window.addEventListener('resize', scheduleDraw, {passive:true});
      scheduleDraw();
    })();
  </script>
</body>
</html>
