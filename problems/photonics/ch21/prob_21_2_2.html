<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0b1020" />
  <title>Silica Integrated-Photonic Phase Modulator (Pockels Effect) — Worked Solution</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.09);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --faint: rgba(255,255,255,0.55);
      --line: rgba(255,255,255,0.14);
      --accent: #7dd3fc;
      --accent2:#a7f3d0;
      --warn:#fbbf24;
      --ok:#34d399;
      --danger:#fb7185;
      --shadow: 0 16px 40px rgba(0,0,0,0.35);
      --radius: 16px;
      --radius2: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg: #f6f7fb;
        --panel: rgba(10,20,40,0.05);
        --panel2: rgba(10,20,40,0.08);
        --text: rgba(10,20,40,0.92);
        --muted: rgba(10,20,40,0.74);
        --faint: rgba(10,20,40,0.55);
        --line: rgba(10,20,40,0.14);
        --shadow: 0 16px 44px rgba(10,20,40,0.12);
      }
    }

    *{ box-sizing: border-box; }
    html{ scroll-behavior: smooth; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background: radial-gradient(1100px 700px at 15% 10%, rgba(125,211,252,0.18), transparent 55%),
                  radial-gradient(1000px 700px at 85% 15%, rgba(167,243,208,0.14), transparent 55%),
                  radial-gradient(900px 600px at 55% 100%, rgba(251,191,36,0.10), transparent 55%),
                  var(--bg);
      line-height: 1.55;
    }

    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    header{
      padding: 28px 18px 18px;
      border-bottom: 1px solid var(--line);
      position: relative;
      overflow: hidden;
    }
    header .wrap{
      max-width: 1120px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 18px;
      align-items: end;
    }
    @media (max-width: 900px){
      header .wrap{ grid-template-columns: 1fr; }
    }

    .kicker{
      font-size: 13px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
    }
    h1{
      margin: 8px 0 10px;
      font-size: clamp(26px, 2.6vw, 38px);
      line-height: 1.15;
      letter-spacing: -0.02em;
    }
    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 15px;
      max-width: 72ch;
    }

    .metaCard{
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      padding: 14px 14px;
      box-shadow: var(--shadow);
    }
    .metaGrid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 6px;
    }
    .metaItem{
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
    }
    @media (prefers-color-scheme: light){
      .metaItem{ background: rgba(10,20,40,0.04); border-color: rgba(10,20,40,0.10); }
    }
    .metaItem .lab{
      font-size: 12px;
      color: var(--faint);
      margin-bottom: 4px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .metaItem .val{
      font-family: var(--mono);
      font-size: 13px;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    main{
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 18px 60px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 18px;
      align-items: start;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    nav.toc{
      position: sticky;
      top: 14px;
      align-self: start;
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      padding: 14px 12px;
      box-shadow: var(--shadow);
    }
    @media (max-width: 980px){
      nav.toc{ position: relative; top: 0; }
    }
    .toc h2{
      font-size: 14px;
      margin: 0 0 10px;
      color: var(--text);
      letter-spacing: 0.02em;
    }
    .toc a{
      display: block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--muted);
      border: 1px solid transparent;
      transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
      font-size: 14px;
    }
    .toc a:hover{
      background: rgba(125,211,252,0.10);
      border-color: rgba(125,211,252,0.22);
      color: var(--text);
      text-decoration: none;
      transform: translateY(-1px);
    }

    article{
      min-width: 0;
    }

    section{
      margin: 0 0 18px;
      padding: 16px 16px;
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.03));
      box-shadow: 0 10px 26px rgba(0,0,0,0.18);
      overflow: hidden;
    }
    @media (prefers-color-scheme: light){
      section{
        background: linear-gradient(180deg, rgba(10,20,40,0.04), rgba(10,20,40,0.025));
        box-shadow: 0 10px 26px rgba(10,20,40,0.08);
      }
    }

    section h2{
      margin: 0 0 10px;
      font-size: 18px;
      letter-spacing: -0.01em;
    }
    section h3{
      margin: 16px 0 8px;
      font-size: 16px;
      color: var(--text);
    }
    p{ margin: 10px 0; color: var(--muted); }
    ul{ margin: 10px 0 10px 22px; color: var(--muted); }
    li{ margin: 6px 0; }

    .grid2{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 860px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .callout{
      border-radius: var(--radius);
      padding: 12px 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.045);
    }
    @media (prefers-color-scheme: light){
      .callout{ background: rgba(10,20,40,0.035); }
    }
    .callout strong{
      color: var(--text);
    }
    .callout.assumptions{ border-color: rgba(167,243,208,0.34); background: rgba(167,243,208,0.06); }
    .callout.keyeq{ border-color: rgba(125,211,252,0.34); background: rgba(125,211,252,0.06); }
    .callout.mistakes{ border-color: rgba(251,191,36,0.42); background: rgba(251,191,36,0.07); }
    .callout.final{ border-color: rgba(52,211,153,0.42); background: rgba(52,211,153,0.07); }
    .callout.note{ border-color: rgba(251,113,133,0.30); background: rgba(251,113,133,0.05); }

    .eqRow{
      display:flex;
      align-items: stretch;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0;
    }
    .eqBox{
      flex: 1 1 540px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,0.16);
    }
    @media (prefers-color-scheme: light){
      .eqBox{ background: rgba(10,20,40,0.05); }
    }
    .eq{
      font-family: var(--mono);
      font-size: 13px;
      color: var(--text);
      white-space: pre-wrap;
      word-break: break-word;
      margin: 0;
    }
    .btn{
      appearance:none;
      border: 1px solid rgba(125,211,252,0.28);
      background: rgba(125,211,252,0.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor: pointer;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,0.14);
      border-color: rgba(125,211,252,0.42);
    }
    .btn:active{ transform: translateY(0px) scale(0.99); }

    .tag{
      display:inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      color: var(--muted);
      font-size: 12px;
      margin-right: 6px;
      margin-top: 6px;
      background: rgba(255,255,255,0.04);
    }
    @media (prefers-color-scheme: light){
      .tag{ border-color: rgba(10,20,40,0.14); background: rgba(10,20,40,0.04); }
    }

    details{
      border: 1px dashed rgba(255,255,255,0.20);
      border-radius: var(--radius);
      padding: 10px 12px;
      background: rgba(255,255,255,0.03);
      margin: 10px 0;
    }
    @media (prefers-color-scheme: light){
      details{ border-color: rgba(10,20,40,0.20); background: rgba(10,20,40,0.03); }
    }
    summary{
      cursor: pointer;
      color: var(--text);
      font-weight: 600;
      letter-spacing: 0.01em;
    }
    summary::-webkit-details-marker{ display:none; }
    summary::before{
      content: "▸";
      display: inline-block;
      margin-right: 8px;
      transform: translateY(-1px);
      transition: transform 140ms ease;
      color: var(--accent);
    }
    details[open] summary::before{ transform: rotate(90deg) translateX(1px); }

    figure{
      margin: 12px 0 0;
      padding: 12px 12px;
      border-radius: var(--radius2);
      background: rgba(0,0,0,0.14);
      border: 1px solid var(--line);
      overflow: hidden;
    }
    @media (prefers-color-scheme: light){
      figure{ background: rgba(10,20,40,0.04); }
    }
    figcaption{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
    }

    .canvasWrap{
      width: 100%;
      aspect-ratio: 16 / 9;
      min-height: 240px;
      position: relative;
    }
    canvas{
      width: 100%;
      height: 100%;
      display:block;
      border-radius: 14px;
      background: rgba(255,255,255,0.02);
    }

    .backTop{
      display:flex;
      justify-content: flex-end;
      margin-top: 12px;
    }
    .backTop a{
      color: var(--muted);
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid transparent;
    }
    .backTop a:hover{
      border-color: rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.04);
      text-decoration:none;
      color: var(--text);
    }

    footer{
      padding: 18px;
      border-top: 1px solid var(--line);
      color: var(--faint);
      font-size: 13px;
      text-align: center;
    }

    .tiny{
      font-size: 12.5px;
      color: var(--faint);
    }

    /* Print-friendly */
    @media print{
      :root{
        --bg:#ffffff;
        --text:#111827;
        --muted:#374151;
        --faint:#4b5563;
        --line:#d1d5db;
      }
      body{ background: #ffffff !important; }
      nav.toc{ display:none; }
      header{ border-bottom: 1px solid var(--line); }
      section, .metaCard{ box-shadow:none !important; }
      a{ color:#111827; text-decoration: underline; }
      .btn{ display:none !important; }
      details{ border-style: solid; }
      .backTop{ display:none; }
      section{ break-inside: avoid; page-break-inside: avoid; }
      h2, h3{ break-after: avoid; page-break-after: avoid; }
      figure{ break-inside: avoid; page-break-inside: avoid; }
    }

    /* Subtle micro-animations */
    @media (prefers-reduced-motion: no-preference){
      section{
        animation: floatIn 360ms ease both;
      }
      @keyframes floatIn{
        from{ opacity:0; transform: translateY(6px); }
        to{ opacity:1; transform: translateY(0); }
      }
    }
  </style>
</head>

<body>
  <header id="top">
    <div class="wrap">
      <div>
        <div class="kicker">Integrated Photonics • Electro-Optic Modulation</div>
        <h1>Silica Integrated-Photonic Phase Modulator (Pockels Effect): Phase Shift</h1>
        <p class="subtitle">
          We compute the optical phase shift produced by an applied voltage across a poled-silica waveguide,
          using the <em>linear electro-optic (Pockels) effect</em> and the standard phase-accumulation relation.
        </p>
        <div>
          <span class="tag">Pockels effect</span>
          <span class="tag">Phase modulation</span>
          <span class="tag">Integrated optics</span>
          <span class="tag">Index perturbation</span>
        </div>
      </div>

      <aside class="metaCard" aria-label="Problem constants summary">
        <div class="kicker" style="margin-bottom:6px;">Given (from the problem)</div>
        <div class="metaGrid">
          <div class="metaItem"><div class="lab">Electrode length</div><div class="val">L = 25 mm</div></div>
          <div class="metaItem"><div class="lab">Separation</div><div class="val">d = 30 µm</div></div>
          <div class="metaItem"><div class="lab">Wavelength</div><div class="val">λ = 1.55 µm</div></div>
          <div class="metaItem"><div class="lab">Voltage</div><div class="val">V = 400 V</div></div>
          <div class="metaItem"><div class="lab">Index</div><div class="val">n = 1.445</div></div>
          <div class="metaItem"><div class="lab">EO coefficient</div><div class="val">r33 = 0.15 pm/V</div></div>
        </div>
        <p class="tiny" style="margin:10px 2px 0;">
          Polarization: optical <b>y</b>, electric field <b>y</b>, propagation along <b>z</b>. Principal axes (x1,x2,x3) aligned with (z,x,y).
        </p>
      </aside>
    </div>
  </header>

  <main>
    <nav class="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <a href="#quick">Quick Summary</a>
      <a href="#primer">PART 0 — Concept Primer</a>
      <a href="#analysis">PART 1 — Problem Analysis</a>
      <a href="#strategy">PART 2 — Strategy & Tips</a>
      <a href="#solution">PART 3 — Full Solution</a>
      <a href="#deeper">PART 4 — Deeper Understanding</a>
      <a href="#plotguide">PART 5 — Optional Plot Guide</a>
      <div class="backTop" style="justify-content:flex-start; margin-top:10px;">
        <a href="#top" title="Back to top">↑ Back to top</a>
      </div>
    </nav>

    <article>
      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this is about:</b> finding the <b>phase shift</b> an optical wave accumulates in a poled-silica waveguide when a voltage is applied across electrodes.</li>
          <li><b>Key physics idea:</b> the applied field changes the refractive index via the <b>linear electro-optic (Pockels) effect</b>.</li>
          <li><b>Governing EO relation (small-signal):</b> Δ(1/n<sup>2</sup>) = r · E, so along a principal axis: Δn ≈ −(1/2) n<sup>3</sup> r E.</li>
          <li><b>Phase accumulation:</b> Δφ = (2π/λ) Δn · L.</li>
          <li><b>Geometry alignment:</b> optical polarization is along <b>y</b>, which is the material’s principal axis <b>x3</b>; applied E is also along <b>y</b> ⇒ use <b>r33</b>.</li>
          <li><b>Result type:</b> primarily <b>numeric</b> (all quantities are given); sign indicates whether the phase advances or lags.</li>
          <li><b>Physical meaning:</b> the modulator produces a controllable phase shift proportional to voltage; in this device the shift is modest because r33 is small in silica.</li>
          <li><b>Final numeric result:</b> Δφ ≈ <b>−0.306 rad</b> at 400 V (magnitude 0.306 rad ≈ 17.5°).</li>
        </ul>

        <div class="eqRow">
          <div class="eqBox" role="group" aria-label="Key equation: phase shift">
            <pre class="eq" id="eq-phase">Δφ = (2π/λ) Δn L</pre>
          </div>
          <button class="btn" data-copy-target="eq-phase" title="Copy equation as plain text">
            ⧉ Copy equation
          </button>
        </div>

        <div class="eqRow">
          <div class="eqBox" role="group" aria-label="Key equation: Pockels index change">
            <pre class="eq" id="eq-dn">Δn ≈ −(1/2) n^3 r33 E,  with  E ≈ V/d</pre>
          </div>
          <button class="btn" data-copy-target="eq-dn" title="Copy equation as plain text">
            ⧉ Copy equation
          </button>
        </div>
      </section>

      <section id="primer">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <h3>0.1 Core definitions (symbols and SI units)</h3>
        <ul>
          <li><b>n</b> — refractive index (dimensionless). In isotropic media, n is the same for all polarizations; in electro-optic media under bias, effective indices can differ by direction.</li>
          <li><b>λ</b> — vacuum wavelength of light (m).</li>
          <li><b>L</b> — interaction length (m) over which the optical wave sees the applied electric field.</li>
          <li><b>E</b> — applied electric field (V/m). In a simple electrode gap model, E ≈ V/d.</li>
          <li><b>V</b> — applied voltage (V); <b>d</b> — electrode separation (m).</li>
          <li><b>r<sub>ij</sub></b> — Pockels (linear electro-optic) coefficients (m/V). Often reported in pm/V.</li>
          <li><b>Δn</b> — change in refractive index (dimensionless) caused by E.</li>
          <li><b>Δφ</b> — accumulated phase change (radians).</li>
        </ul>

        <h3>0.2 What the Pockels effect means physically</h3>
        <p>
          The Pockels effect is a <b>linear</b> change of the optical properties with applied electric field.
          Microscopically, the field slightly distorts the electronic distribution and therefore the material’s polarization response.
          The key point for modulators: a controllable index shift Δn changes the optical phase by Δφ ∝ Δn.
        </p>

        <h3>0.3 Key law: index ellipsoid / impermeability change</h3>
        <p>
          Electro-optic coefficients are most cleanly expressed as changes to the <b>optical impermeability</b>
          (also called the dielectric “inverse index-squared” tensor):
        </p>

        <div class="callout keyeq">
          <p style="margin:0 0 8px;"><strong>Key relation (contracted notation):</strong></p>
          <div class="eqRow" style="margin:0;">
            <div class="eqBox">
              <pre class="eq" id="eq-imperm">Δ(1/n^2)_i = Σ_j r_ij E_j</pre>
            </div>
            <button class="btn" data-copy-target="eq-imperm" title="Copy equation as plain text">⧉ Copy equation</button>
          </div>
          <p class="tiny" style="margin:6px 0 0;">
            When the optical polarization and the applied field are aligned with a <em>principal axis</em>,
            this simplifies to a single coefficient: Δ(1/n^2) = r E.
          </p>
        </div>

        <h3>0.4 Small-signal approximation: from Δ(1/n²) to Δn</h3>
        <p>
          If the index change is small (typical for modulators), expand to first order:
        </p>
        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-linearize">Let η ≡ 1/n^2.  Then  Δη = rE.
Since η = n^(-2),  dη/dn = −2 n^(-3),
so  Δη ≈ (dη/dn) Δn = −2 n^(-3) Δn  ⇒  Δn ≈ −(1/2) n^3 rE.</pre>
          </div>
          <button class="btn" data-copy-target="eq-linearize" title="Copy derivation as plain text">⧉ Copy</button>
        </div>

        <h3>0.5 Phase accumulation in a waveguide</h3>
        <p>
          Optical phase in a uniform medium is φ = βL with propagation constant β = (2π/λ) n<sub>eff</sub>.
          If the modulator changes the effective index by Δn (or Δn<sub>eff</sub>), the incremental phase shift is:
        </p>
        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-phase2">Δφ = (2π/λ) Δn L</pre>
          </div>
          <button class="btn" data-copy-target="eq-phase2" title="Copy equation as plain text">⧉ Copy equation</button>
        </div>

        <h3>0.6 Validity conditions and common approximations</h3>
        <div class="grid2">
          <div class="callout assumptions">
            <p style="margin:0 0 8px;"><strong>Assumptions typically used here</strong></p>
            <ul style="margin:0 0 0 18px;">
              <li>Uniform field in the gap: E ≈ V/d (ignores fringing and mode overlap factors).</li>
              <li>Small-signal linearization: |Δn| ≪ n.</li>
              <li>Optical polarization aligns with a principal axis (so a single r coefficient applies).</li>
              <li>Neglect absorption, dispersion changes, and electrode loss (pure phase modulation).</li>
            </ul>
          </div>

          <div class="callout mistakes">
            <p style="margin:0 0 8px;"><strong>What to watch for (pitfalls)</strong></p>
            <ul style="margin:0 0 0 18px;">
              <li><b>Using Δn = + (1/2) n^3 rE:</b> the sign is negative from η = 1/n².</li>
              <li><b>Confusing axes:</b> you must match the optical polarization and E-field to the material principal axes.</li>
              <li><b>Unit slips:</b> r in pm/V must be converted to m/V; d in µm to m; λ in µm to m.</li>
              <li><b>Mixing λ in vacuum vs in material:</b> the standard phase formula uses vacuum λ with n in β = 2πn/λ.</li>
            </ul>
          </div>
        </div>

        <h3>0.7 Mini intuition examples (quick, minimal algebra)</h3>
        <ul>
          <li><b>Linear scaling with voltage:</b> because Δn ∝ E ∝ V, the phase shift satisfies Δφ ∝ V. Double V ⇒ double phase shift.</li>
          <li><b>Longer interaction helps:</b> Δφ ∝ L, so integrated modulators often use long electrodes or resonators to boost phase shift.</li>
          <li><b>Smaller gap helps:</b> Δφ ∝ 1/d. Reducing electrode separation increases E for the same V (within breakdown/processing limits).</li>
        </ul>

        <details>
          <summary>Deeper note: why coefficients are given as a matrix</summary>
          <p>
            In general, an applied electric field changes a <em>tensor</em> describing the index ellipsoid.
            Contracted notation packages the symmetry-reduced coefficients into a 6×3 matrix r<sub>ij</sub>.
            The problem conveniently aligns the axes so that the relevant response for y-polarized light under a y-directed field is governed by r<sub>33</sub>.
          </p>
        </details>

        <div class="backTop"><a href="#top">↑ Back to top</a></div>
      </section>

      <section id="analysis">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <h3>1.1 Restate the problem in plain words</h3>
        <p>
          We have a poled-silica integrated photonic phase modulator with electrodes of length L and separation d.
          A voltage V creates an electric field along the y direction. A guided optical wave travels along z and is polarized along y.
          Using the given refractive index n and electro-optic coefficient matrix (with r<sub>33</sub> specified),
          determine the <b>phase shift</b> induced over the length L.
        </p>

        <div class="grid2">
          <div class="callout">
            <p style="margin:0 0 8px;"><strong>Given quantities</strong></p>
            <ul style="margin:0 0 0 18px;">
              <li>L = 25 mm = 2.5×10<sup>−2</sup> m</li>
              <li>d = 30 µm = 3.0×10<sup>−5</sup> m</li>
              <li>λ = 1.55 µm = 1.55×10<sup>−6</sup> m</li>
              <li>V = 400 V</li>
              <li>n = 1.445</li>
              <li>r<sub>33</sub> = 0.15 pm/V = 0.15×10<sup>−12</sup> m/V</li>
              <li>Optical polarization: y; Electric field: y; Propagation: z</li>
              <li>Principal axes: (x1,x2,x3) point along (z,x,y)</li>
            </ul>
          </div>

          <div class="callout">
            <p style="margin:0 0 8px;"><strong>Unknowns / what must be found</strong></p>
            <ul style="margin:0 0 0 18px;">
              <li>Index change for the guided polarization: Δn (along y ≡ x3)</li>
              <li>Phase shift: Δφ over length L</li>
            </ul>
            <p class="tiny" style="margin:10px 0 0;">
              Sign convention: a negative Δn means the optical phase accumulates more slowly than without the field (a phase decrease relative to baseline).
            </p>
          </div>
        </div>

        <h3>1.2 Relevant principles and why they apply</h3>
        <ul>
          <li><b>Pockels effect</b> applies because the material has been <b>thermally poled</b>, breaking centrosymmetry and enabling a linear EO response.</li>
          <li><b>Index linearization</b> applies because r is small and fields are moderate ⇒ |Δn| ≪ n.</li>
          <li><b>Phase accumulation</b> applies because the wave travels a distance L with an altered propagation constant β.</li>
        </ul>
        <p>
          Other effects (Kerr effect, thermal tuning) are not needed because the problem explicitly points to the Pockels coefficients and gives r<sub>33</sub>.
        </p>

        <div class="callout assumptions">
          <p style="margin:0 0 8px;"><strong>Assumptions stated explicitly</strong></p>
          <ul style="margin:0 0 0 18px;">
            <li>The optical mode experiences an approximately uniform E-field equal to V/d (no overlap factor Γ is provided, so we take Γ ≈ 1).</li>
            <li>The wave is polarized purely along y (principal axis x3), so coupling to other axes is neglected.</li>
            <li>The given scalar n is used for the relevant principal index (consistent with the problem’s single n value).</li>
          </ul>
        </div>

        <h3>1.3 Possible approaches (compare, then choose)</h3>
        <ul>
          <li><b>Approach A — Direct scalar principal-axis formula (best here):</b> Use Δn ≈ −(1/2)n<sup>3</sup>r<sub>33</sub>E and then Δφ = (2π/λ)ΔnL. <em>Pros:</em> shortest, matches axis alignment. <em>Cons:</em> hides tensor origin.</li>
          <li><b>Approach B — Full index ellipsoid with the r-matrix:</b> Write the perturbed impermeability tensor, diagonalize for principal indices, then compute phase. <em>Pros:</em> most general. <em>Cons:</em> overkill because the geometry already isolates r<sub>33</sub>.</li>
          <li><b>Approach C — Modulator figure-of-merit (Vπ):</b> Derive Δφ(V) and compute Vπ; then plug V. <em>Pros:</em> yields a useful design metric. <em>Cons:</em> still based on Approach A algebra.</li>
        </ul>

        <p><b>Chosen approach:</b> Approach A, because polarization and field align with a principal axis and the problem gives r<sub>33</sub>, enabling a clean one-coefficient calculation.</p>

        <div class="backTop"><a href="#top">↑ Back to top</a></div>
      </section>

      <section id="strategy">
        <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

        <ol style="margin:10px 0 10px 22px; color: var(--muted);">
          <li><b>Compute the electric field:</b> use the parallel-plate estimate E = V/d. (Goal: convert voltage to field.)</li>
          <li><b>Pick the correct EO coefficient:</b> since light is y-polarized (x3) and E is along y (E3), use r<sub>33</sub>. (Goal: isolate the relevant material response.)</li>
          <li><b>Convert EO response to index change:</b> start from Δ(1/n²)=r<sub>33</sub>E and linearize to get Δn ≈ −(1/2)n³r<sub>33</sub>E. (Goal: turn tensor data into Δn.)</li>
          <li><b>Convert index change to phase shift:</b> use Δφ=(2π/λ)ΔnL. (Goal: get the desired output.)</li>
          <li><b>Check units:</b> pm/V → m/V, µm → m, mm → m. (Goal: prevent order-of-magnitude errors.)</li>
          <li><b>Interpret sign and magnitude:</b> decide what a negative Δφ means and whether the magnitude is plausible. (Goal: physical sense-making.)</li>
        </ol>

        <div class="callout mistakes">
          <p style="margin:0 0 8px;"><strong>Common mistakes (quick tips)</strong></p>
          <ul style="margin:0 0 0 18px;">
            <li>Forgetting the <b>½</b> factor in Δn ≈ −(1/2)n³rE.</li>
            <li>Using r in pm/V without converting to meters per volt.</li>
            <li>Plugging λ in nm but leaving L in meters (mixed prefixes).</li>
            <li>Using the wrong axis coefficient (e.g., r13) despite the y–y alignment.</li>
          </ul>
        </div>

        <div class="backTop"><a href="#top">↑ Back to top</a></div>
      </section>

      <section id="solution">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>3.1 Qualitative expectation (before calculating)</h3>
        <p>
          Because this is a Pockels modulator, we expect a <b>linear</b> phase shift with applied voltage:
          Δφ ∝ V. Poled silica has a relatively small r<sub>33</sub> (fractions of pm/V), so even hundreds of volts may
          produce only a fraction of a radian unless the device is very long or has strong field confinement.
        </p>

        <h3>3.2 Step 1: Electric field magnitude in the electrode gap</h3>
        <p>
          Use the simplest electrode model: two electrodes separated by distance d create an approximately uniform field
          (directed along y here):
        </p>

        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-E">E = V/d</pre>
          </div>
          <button class="btn" data-copy-target="eq-E">⧉ Copy</button>
        </div>

        <p>
          Insert numbers:
        </p>
        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-E-num">V = 400 V
d = 30 µm = 30×10^(-6) m

E = 400 / (30×10^(-6)) ≈ 1.333×10^7 V/m</pre>
          </div>
          <button class="btn" data-copy-target="eq-E-num">⧉ Copy</button>
        </div>

        <h3>3.3 Step 2: Choose the correct Pockels coefficient</h3>
        <p>
          The problem states the principal axes (x1,x2,x3) align with (z,x,y). Therefore:
        </p>
        <ul>
          <li>Propagation along z ⇒ along x1 (this matters for geometry but not for picking r when polarization is fixed).</li>
          <li>Optical polarization along y ⇒ along x3.</li>
          <li>Applied electric field along y ⇒ E3 (along x3).</li>
        </ul>
        <p>
          For index changes along the same principal axis as both the optical polarization and E-field, the relevant coefficient is
          <b>r<sub>33</sub></b>. (The matrix contains other entries like r13, but they would matter for other polarization/field combinations.)
        </p>

        <h3>3.4 Step 3: Convert Δ(1/n²) to Δn (small-signal)</h3>
        <p>
          Along the x3 axis (y direction), the Pockels relation reduces to:
        </p>

        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-eta">Δ(1/n^2) = r33 E</pre>
          </div>
          <button class="btn" data-copy-target="eq-eta">⧉ Copy</button>
        </div>

        <p>
          Linearizing n (as derived in the primer):
        </p>
        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-dn2">Δn ≈ −(1/2) n^3 r33 E</pre>
          </div>
          <button class="btn" data-copy-target="eq-dn2">⧉ Copy</button>
        </div>

        <p>
          Now insert numbers (convert r<sub>33</sub> carefully):
        </p>
        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-dn-num">n = 1.445
r33 = 0.15 pm/V = 0.15×10^(-12) m/V
E ≈ 1.333×10^7 V/m

Δn ≈ −(1/2)(1.445^3)(0.15×10^(-12))(1.333×10^7)
   ≈ −3.02×10^(-6)</pre>
          </div>
          <button class="btn" data-copy-target="eq-dn-num">⧉ Copy</button>
        </div>

        <p class="tiny">
          Interpretation: the effective index for y-polarized light decreases by about 3 parts per million under the applied field.
        </p>

        <h3>3.5 Step 4: Compute the phase shift</h3>
        <p>
          The phase accumulated by an optical wave is φ = βL with β = (2π/λ) n. A small index change produces:
        </p>

        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-dphi">Δφ = (2π/λ) Δn L</pre>
          </div>
          <button class="btn" data-copy-target="eq-dphi">⧉ Copy</button>
        </div>

        <p>Insert values:</p>
        <div class="eqRow">
          <div class="eqBox">
            <pre class="eq" id="eq-dphi-num">λ = 1.55 µm = 1.55×10^(-6) m
L = 25 mm = 2.5×10^(-2) m
Δn ≈ −3.02×10^(-6)

Δφ = (2π/1.55×10^(-6)) (−3.02×10^(-6)) (2.5×10^(-2))
   ≈ −0.306 rad  (≈ −17.5°)</pre>
          </div>
          <button class="btn" data-copy-target="eq-dphi-num">⧉ Copy</button>
        </div>

        <div class="callout final" role="group" aria-label="Final answer">
          <p style="margin:0 0 8px;"><strong>Final Answer (with the given numbers)</strong></p>
          <div class="eqRow" style="margin:0;">
            <div class="eqBox" style="flex:1 1 720px;">
              <pre class="eq" id="final-answer">E = V/d ≈ 1.33×10^7 V/m
Δn ≈ −(1/2) n^3 r33 (V/d) ≈ −3.02×10^(-6)
Δφ = (2π/λ) Δn L ≈ −0.306 rad  (magnitude 0.306 rad ≈ 17.5°)</pre>
            </div>
            <button class="btn" data-copy-target="final-answer" title="Copy final answer as plain text">⧉ Copy final answer</button>
          </div>
        </div>

        <h3>3.6 Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <p style="margin:0 0 6px;"><strong>Units / dimensions</strong></p>
            <ul style="margin:0 0 0 18px;">
              <li>r: m/V, E: V/m ⇒ rE is dimensionless (matches Δ(1/n²)).</li>
              <li>Δn is dimensionless.</li>
              <li>(2π/λ) has units 1/m; multiply by Δn (dimensionless) and L (m) ⇒ radians (dimensionless).</li>
            </ul>
          </div>
          <div class="callout">
            <p style="margin:0 0 6px;"><strong>Limiting cases & sign</strong></p>
            <ul style="margin:0 0 0 18px;">
              <li>If V → 0 ⇒ E → 0 ⇒ Δn → 0 ⇒ Δφ → 0 (correct).</li>
              <li>Δφ scales linearly with L and V and inversely with d and λ (expected for a phase modulator).</li>
              <li>Negative sign: since Δn ≈ −(1/2)n³rE, a positive r and positive E reduce n, so the phase accumulation decreases (a phase lag relative to baseline).</li>
            </ul>
          </div>
        </div>

        <details>
          <summary>Useful design metric: the π-voltage (Vπ)</summary>
          <p>
            From the derived relation:
          </p>
          <div class="eqRow">
            <div class="eqBox">
              <pre class="eq" id="eq-vpi">Δφ(V) = −(π n^3 r33 L / (λ d)) V
So the voltage for |Δφ| = π is:
Vπ = λ d / (n^3 r33 L)</pre>
            </div>
            <button class="btn" data-copy-target="eq-vpi">⧉ Copy</button>
          </div>
          <p class="tiny">
            This is a standard modulator figure-of-merit. (This problem asks for Δφ at a given V, but Vπ gives intuition about how “strong” the modulator is.)
          </p>
        </details>

        <div class="backTop"><a href="#top">↑ Back to top</a></div>
      </section>

      <section id="deeper">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>4.1 Re-interpreting the formula: what each term controls</h3>
        <div class="callout keyeq">
          <p style="margin:0 0 8px;"><strong>Compact result (voltage form)</strong></p>
          <div class="eqRow" style="margin:0;">
            <div class="eqBox">
              <pre class="eq" id="eq-compact">Δφ = −(π n^3 r33 L / (λ d)) V</pre>
            </div>
            <button class="btn" data-copy-target="eq-compact">⧉ Copy</button>
          </div>
          <p class="tiny" style="margin:8px 0 0;">
            The prefactor (π n³ r33 L)/(λ d) is the phase sensitivity (rad per volt).
          </p>
        </div>

        <ul>
          <li><b>n³</b>: larger refractive index increases EO phase sensitivity (common in high-index modulators).</li>
          <li><b>r<sub>33</sub></b>: stronger EO materials (larger r) dramatically reduce required voltage/length.</li>
          <li><b>L</b>: longer interaction length increases phase shift proportionally.</li>
          <li><b>1/λ</b>: shorter wavelengths accumulate more phase per unit index change.</li>
          <li><b>1/d</b>: smaller electrode spacing increases E for the same V (but may increase loss or risk breakdown).</li>
        </ul>

        <h3>4.2 Parameter dependence (qualitative)</h3>
        <ul>
          <li>If <b>V doubles</b>, |Δφ| doubles.</li>
          <li>If <b>d halves</b>, |Δφ| doubles.</li>
          <li>If <b>L increases by 4×</b>, |Δφ| increases by 4× (why long electrodes are common).</li>
          <li>If <b>r<sub>33</sub></b> were 10× larger (typical of strong EO crystals), the same geometry would yield 10× the phase shift.</li>
        </ul>

        <h3>4.3 Alternative derivation idea (brief but meaningful)</h3>
        <p>
          Instead of linearizing n directly, you can start from the propagation constant:
          β = (2π/λ) n. Differentiate with respect to E using Δ(1/n²)=rE to get dβ/dE, then integrate over L.
          This yields the same Δφ but emphasizes that modulation is fundamentally a change in β (phase velocity).
        </p>

        <h3>4.4 Concept check (self-test Q&A)</h3>
        <ul>
          <li><b>Q:</b> Why is the phase shift linear in V here? <b>A:</b> Because the Pockels effect is linear: Δ(1/n²) ∝ E ∝ V.</li>
          <li><b>Q:</b> If λ increases (say to 2 µm), what happens to |Δφ|? <b>A:</b> It decreases, since Δφ ∝ 1/λ.</li>
          <li><b>Q:</b> If the optical polarization were orthogonal to the field, would r<sub>33</sub> still apply? <b>A:</b> Not necessarily; you would need the coefficient corresponding to the new axis combination (and possibly solve the full tensor problem).</li>
          <li><b>Q:</b> What does a negative Δφ mean physically? <b>A:</b> The effective index decreased, so the wave accumulates less phase over the same length compared to the unbiased case.</li>
          <li><b>Q:</b> What extra factor often appears in real waveguides but is omitted here? <b>A:</b> A mode-overlap factor Γ (&lt; 1) accounting for nonuniform field and optical mode confinement.</li>
        </ul>

        <div class="backTop"><a href="#top">↑ Back to top</a></div>
      </section>

      <section id="plotguide">
        <h2>PART 5 — Optional Plot Guide</h2>

        <p>
          A plot is useful here because the result is a <b>linear transfer function</b>: phase shift vs voltage.
          Seeing the straight line reinforces that this is a Pockels (linear) modulator and lets you visually read off sensitivity.
          (The plot below uses the <em>given problem parameters</em>; it is not a parameter sweep beyond voltage.)
        </p>

        <figure>
          <div class="canvasWrap">
            <canvas id="plot" aria-label="Static plot of phase shift versus voltage"></canvas>
          </div>
          <figcaption>
            <b>Static plot:</b> Δφ(V) = −(π n³ r<sub>33</sub> L / (λ d)) V using the problem’s values (n=1.445, r<sub>33</sub>=0.15 pm/V, L=25 mm, λ=1.55 µm, d=30 µm).
            The marked point indicates V = 400 V, where Δφ ≈ −0.306 rad.
          </figcaption>
        </figure>

        <ul>
          <li><b>x-axis:</b> Voltage V (V).</li>
          <li><b>y-axis:</b> Phase shift Δφ (rad).</li>
          <li><b>Feature to notice:</b> constant slope (phase sensitivity). The negative slope indicates phase decreases with positive V for positive r<sub>33</sub> in this sign convention.</li>
          <li><b>Why no other plots:</b> the physics here is captured by a single linear relation; additional plots would not add conceptual value without introducing extra device-specific parameters (overlap factor, dispersion, electrode RF effects, etc.).</li>
        </ul>

        <div class="backTop"><a href="#top">↑ Back to top</a></div>
      </section>

      <footer>
        Built as a self-contained learning article (vanilla HTML/CSS/JS). Copy buttons export plain-text equations/results.
      </footer>
    </article>
  </main>

  <script>
    (function(){
      // --- Copy buttons (plain text) ---
      function copyTextFromElement(id){
        var el = document.getElementById(id);
        if(!el) return Promise.reject(new Error("Missing element: " + id));
        var text = (el.innerText || el.textContent || "").trim();
        return navigator.clipboard.writeText(text);
      }

      function flash(btn, ok){
        var original = btn.textContent;
        btn.textContent = ok ? "✓ Copied" : "✕ Copy failed";
        btn.style.borderColor = ok ? "rgba(52,211,153,0.6)" : "rgba(251,113,133,0.6)";
        btn.style.background = ok ? "rgba(52,211,153,0.12)" : "rgba(251,113,133,0.10)";
        setTimeout(function(){
          btn.textContent = original;
          btn.style.borderColor = "";
          btn.style.background = "";
        }, 1100);
      }

      document.addEventListener("click", function(ev){
        var btn = ev.target.closest("[data-copy-target]");
        if(!btn) return;
        var id = btn.getAttribute("data-copy-target");
        copyTextFromElement(id).then(function(){
          flash(btn, true);
        }).catch(function(){
          // Fallback for older browsers: create a temporary textarea
          try{
            var el = document.getElementById(id);
            var text = (el.innerText || el.textContent || "").trim();
            var ta = document.createElement("textarea");
            ta.value = text;
            ta.setAttribute("readonly", "");
            ta.style.position = "fixed";
            ta.style.left = "-9999px";
            ta.style.top = "0";
            document.body.appendChild(ta);
            ta.select();
            var ok = document.execCommand("copy");
            document.body.removeChild(ta);
            flash(btn, !!ok);
          }catch(e){
            flash(btn, false);
          }
        });
      });

      // --- Smooth scroll with gentle focus handling ---
      document.addEventListener("click", function(ev){
        var a = ev.target.closest('a[href^="#"]');
        if(!a) return;
        var href = a.getAttribute("href");
        if(!href || href.length < 2) return;
        var target = document.querySelector(href);
        if(!target) return;
        ev.preventDefault();
        target.scrollIntoView({behavior:"smooth", block:"start"});
        // mild accessibility: focus after scroll
        setTimeout(function(){
          if(target.tabIndex < 0) target.tabIndex = -1;
          try{ target.focus({preventScroll:true}); }catch(e){}
        }, 350);
      });

      // --- Static plot: Δφ vs V using given parameters ---
      var canvas = document.getElementById("plot");
      if(!canvas) return;

      function draw(){
        var rect = canvas.getBoundingClientRect();
        var cssW = Math.max(320, rect.width);
        var cssH = Math.max(220, rect.height);

        var dpr = window.devicePixelRatio || 1;
        canvas.width = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);

        var ctx = canvas.getContext("2d");
        ctx.setTransform(dpr,0,0,dpr,0,0);

        // Colors adapt to theme via computed styles
        var cs = getComputedStyle(document.documentElement);
        var text = cs.getPropertyValue("--text").trim() || "rgba(255,255,255,0.92)";
        var muted = cs.getPropertyValue("--muted").trim() || "rgba(255,255,255,0.72)";
        var line = cs.getPropertyValue("--line").trim() || "rgba(255,255,255,0.14)";
        var accent = cs.getPropertyValue("--accent").trim() || "#7dd3fc";
        var ok = cs.getPropertyValue("--ok").trim() || "#34d399";

        // Plot margins
        var W = cssW, H = cssH;
        var m = {l:56, r:20, t:34, b:50};
        var pw = W - m.l - m.r;
        var ph = H - m.t - m.b;

        // Given parameters
        var n = 1.445;
        var r33 = 0.15e-12; // m/V
        var L = 25e-3;      // m
        var lambda = 1.55e-6; // m
        var d = 30e-6;      // m
        // Δφ(V) = -K * V where K = π n^3 r33 L /(λ d)
        var K = Math.PI * Math.pow(n,3) * r33 * L / (lambda * d);

        // Voltage span for plot (static choice)
        var Vmin = -600, Vmax = 600;

        // y range: compute endpoints
        function dphi(V){ return -K * V; }
        var y1 = dphi(Vmin), y2 = dphi(Vmax);
        var ymin = Math.min(y1,y2), ymax = Math.max(y1,y2);
        // Add padding
        var pad = 0.12 * (ymax - ymin || 1);
        ymin -= pad; ymax += pad;

        // Helpers: mapping
        function xPix(V){
          return m.l + (V - Vmin) / (Vmax - Vmin) * pw;
        }
        function yPix(y){
          return m.t + (1 - (y - ymin) / (ymax - ymin)) * ph;
        }

        // Background
        ctx.clearRect(0,0,W,H);

        // Gridlines + axes
        ctx.lineWidth = 1;

        // Grid ticks
        var xTicks = 7; // -600..600 step 200
        var yTicks = 6;

        ctx.strokeStyle = line;
        ctx.globalAlpha = 0.85;

        // Vertical grid
        for(var i=0;i<xTicks;i++){
          var V = Vmin + i*(Vmax - Vmin)/(xTicks-1);
          var x = xPix(V);
          ctx.beginPath();
          ctx.moveTo(x, m.t);
          ctx.lineTo(x, m.t + ph);
          ctx.stroke();
        }

        // Horizontal grid
        for(var j=0;j<yTicks;j++){
          var y = ymin + j*(ymax - ymin)/(yTicks-1);
          var yp = yPix(y);
          ctx.beginPath();
          ctx.moveTo(m.l, yp);
          ctx.lineTo(m.l + pw, yp);
          ctx.stroke();
        }
        ctx.globalAlpha = 1;

        // Axes lines
        ctx.strokeStyle = text;
        ctx.globalAlpha = 0.35;
        ctx.beginPath();
        ctx.moveTo(m.l, m.t);
        ctx.lineTo(m.l, m.t + ph);
        ctx.lineTo(m.l + pw, m.t + ph);
        ctx.stroke();
        ctx.globalAlpha = 1;

        // Plot title
        ctx.fillStyle = text;
        ctx.font = "600 14px " + getComputedStyle(document.body).fontFamily;
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("Phase shift vs voltage (given device parameters)", m.l, 10);

        // Axis labels
        ctx.fillStyle = muted;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
        ctx.textAlign = "center";
        ctx.textBaseline = "bottom";
        ctx.fillText("Voltage V (V)", m.l + pw/2, H - 10);

        // y-axis label (rotated)
        ctx.save();
        ctx.translate(16, m.t + ph/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        ctx.fillText("Phase shift Δφ (rad)", 0, 0);
        ctx.restore();

        // Tick labels
        ctx.fillStyle = muted;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;

        // X ticks labels
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        for(var i2=0;i2<xTicks;i2++){
          var Vt = Vmin + i2*(Vmax - Vmin)/(xTicks-1);
          var xp = xPix(Vt);
          ctx.fillText(String(Math.round(Vt)), xp, m.t + ph + 6);
        }

        // Y ticks labels
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        for(var j2=0;j2<yTicks;j2++){
          var yt = ymin + j2*(ymax - ymin)/(yTicks-1);
          var yp2 = yPix(yt);
          // format to 2 decimals
          var s = (Math.abs(yt) < 1e-3) ? "0" : (Math.round(yt*100)/100).toString();
          ctx.fillText(s, m.l - 8, yp2);
        }

        // Main line
        ctx.strokeStyle = accent;
        ctx.lineWidth = 2;
        ctx.beginPath();
        var N = 80;
        for(var k=0;k<=N;k++){
          var Vv = Vmin + k*(Vmax - Vmin)/N;
          var yy = dphi(Vv);
          var xp2 = xPix(Vv);
          var yp3 = yPix(yy);
          if(k===0) ctx.moveTo(xp2, yp3);
          else ctx.lineTo(xp2, yp3);
        }
        ctx.stroke();

        // Mark V=400 point
        var Vmark = 400;
        var ymark = dphi(Vmark);
        var xM = xPix(Vmark);
        var yM = yPix(ymark);

        ctx.fillStyle = ok;
        ctx.beginPath();
        ctx.arc(xM, yM, 4.6, 0, Math.PI*2);
        ctx.fill();

        // Annotation
        ctx.fillStyle = text;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
        ctx.textAlign = "left";
        ctx.textBaseline = "bottom";
        var label = "V = 400 V  →  Δφ ≈ " + (Math.round(ymark*1000)/1000) + " rad";
        // Keep label within plot bounds
        var lx = Math.min(xM + 10, m.l + pw - 190);
        var ly = Math.max(yM - 10, m.t + 18);
        // small label background
        ctx.globalAlpha = 0.85;
        ctx.fillStyle = (matchMedia("(prefers-color-scheme: light)").matches) ? "rgba(255,255,255,0.75)" : "rgba(0,0,0,0.35)";
        var padX=8, padY=6;
        ctx.fillRect(lx - padX, ly - 18 - padY, 190, 20 + 2*padY);
        ctx.globalAlpha = 1;
        ctx.fillStyle = text;
        ctx.fillText(label, lx, ly);

        // Legend
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        var legX = m.l + 10, legY = m.t + 10;
        ctx.globalAlpha = 0.9;
        ctx.fillStyle = (matchMedia("(prefers-color-scheme: light)").matches) ? "rgba(255,255,255,0.70)" : "rgba(0,0,0,0.32)";
        ctx.fillRect(legX, legY, 240, 46);
        ctx.globalAlpha = 1;

        ctx.strokeStyle = accent;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(legX + 12, legY + 15);
        ctx.lineTo(legX + 44, legY + 15);
        ctx.stroke();

        ctx.fillStyle = muted;
        ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
        ctx.fillText("Δφ(V) (linear Pockels response)", legX + 54, legY + 8);

        ctx.fillStyle = ok;
        ctx.beginPath();
        ctx.arc(legX + 28, legY + 34, 4.6, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = muted;
        ctx.fillText("Marked point: V = 400 V", legX + 54, legY + 27);
      }

      // Resize-aware redraw (still a static plot; no user interaction)
      var ro;
      if("ResizeObserver" in window){
        ro = new ResizeObserver(function(){ draw(); });
        ro.observe(canvas);
      }else{
        window.addEventListener("resize", function(){ draw(); }, {passive:true});
      }
      draw();
    })();
  </script>
</body>
</html>
