<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Wienâ€™s Law from Planckâ€™s Spectrum (Wavelength vs Frequency Peaks)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1833;
      --muted:#9fb0d0;
      --text:#e9eeff;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 800px at 20% 0%, rgba(125,211,252,.18), transparent 55%),
                  radial-gradient(1000px 700px at 90% 10%, rgba(167,139,250,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
      line-height:1.55;
    }
    header{
      padding:28px 18px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    header .title{
      display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size: clamp(1.5rem, 2.6vw, 2.3rem);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:8px 0 0;
      color:var(--muted);
      max-width:80ch;
    }
    main{
      max-width:1200px;
      margin:0 auto;
      padding:14px 18px 70px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }
    aside{
      position:sticky;
      top:12px;
      align-self:start;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px 14px 10px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    @media (max-width: 980px){
      aside{ position:relative; top:auto; }
    }
    .toc-title{
      font-weight:700;
      letter-spacing:.25px;
      margin:0 0 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .toc a{
      display:block;
      padding:8px 10px;
      margin:4px 0;
      border-radius:12px;
      color:var(--text);
      text-decoration:none;
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .toc a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
      transform: translateX(2px);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:.85rem;
      color:var(--muted);
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.05);
      border:1px solid var(--line);
    }
    .content{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    section{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px 16px 14px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      animation: fadeUp .35s ease both;
    }
    @keyframes fadeUp{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }
    h2{
      margin:0 0 10px;
      font-size: clamp(1.15rem, 1.8vw, 1.5rem);
    }
    h3{
      margin:14px 0 8px;
      font-size:1.05rem;
      color: #dbe7ff;
    }
    p{ margin: 8px 0; color: rgba(233,238,255,.95); }
    ul{ margin:8px 0 8px 22px; }
    li{ margin:6px 0; color: rgba(233,238,255,.95); }

    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 860px){
      .grid-2{ grid-template-columns: 1fr; }
    }

    .callout{
      border-radius:14px;
      border:1px solid var(--line);
      padding:12px 12px 10px;
      background: rgba(0,0,0,.14);
    }
    .callout strong{ color:#ffffff; }
    .callout.assumptions{ border-color: rgba(167,139,250,.28); background: rgba(167,139,250,.10); }
    .callout.keyeq{ border-color: rgba(125,211,252,.28); background: rgba(125,211,252,.10); }
    .callout.mistakes{ border-color: rgba(251,191,36,.30); background: rgba(251,191,36,.10); }
    .callout.final{ border-color: rgba(52,211,153,.30); background: rgba(52,211,153,.10); }

    .eq{
      font-family: var(--mono);
      font-size: .95rem;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      padding:10px 10px;
      border-radius:12px;
      overflow:auto;
      position:relative;
    }
    .eq .label{
      display:block;
      color: var(--muted);
      font-size:.85rem;
      margin-bottom:6px;
      font-family:var(--sans);
    }
    .copy-btn{
      position:absolute;
      top:10px;
      right:10px;
      border-radius:10px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding:6px 10px;
      font-size:.85rem;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    .copy-btn:hover{ background: rgba(125,211,252,.12); transform: translateY(-1px); }
    .copy-btn:active{ transform: translateY(0); }

    .viz-wrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .viz-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){
      .viz-grid{ grid-template-columns: 1fr; }
    }
    figure{
      margin:0;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
    }
    figcaption{
      margin-top:8px;
      color: var(--muted);
      font-size:.92rem;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius:12px;
      background: rgba(8,12,24,.55);
      border:1px solid rgba(255,255,255,.08);
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.14);
    }
    .controls .left, .controls .right{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    label{
      color: var(--muted);
      font-size:.92rem;
    }
    input[type="range"]{
      width: 260px;
      accent-color: var(--accent);
    }
    .readout{
      font-family: var(--mono);
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:12px;
      font-size:.92rem;
      white-space:nowrap;
    }
    .mini{
      color: var(--muted);
      font-size:.92rem;
    }
    footer{
      max-width:1200px;
      margin:0 auto;
      padding:16px 18px 40px;
      color: var(--muted);
      font-size:.92rem;
    }
    .print-note{
      display:none;
    }
    @media print{
      body{ background:#fff; color:#111; }
      header, main, footer{ max-width: 100%; }
      aside{ display:none; }
      section, figure, .controls{ box-shadow:none; backdrop-filter:none; }
      .print-note{ display:block; color:#333; }
      canvas{ border:1px solid #ddd; background:#fff; }
      .copy-btn{ display:none; }
    }
  </style>
</head>
<body>
<header>
  <div class="title">
    <div>
      <h1>Wienâ€™s Law from Planckâ€™s Spectrum: Why the Peak Depends on Using Î» or Î½</h1>
      <p class="subtitle">
        We derive the wavelength spectral energy density from Planckâ€™s law, relate the wavelength and frequency forms,
        obtain Wienâ€™s displacement law <span class="eq-inline" style="font-family:var(--mono);">Î»<sub>p</sub>T = constant</span>,
        and show why <span class="eq-inline" style="font-family:var(--mono);">Î»<sub>p</sub> â‰  c/Î½<sub>p</sub></span>.
      </p>
    </div>
    <span class="pill" title="Scope">
      ğŸ”¥ Blackbody radiation â€¢ Planck spectrum â€¢ Wien displacement
    </span>
  </div>
</header>

<main>
  <aside aria-label="Table of Contents">
    <div class="toc-title">
      <span>Table of Contents</span>
      <span class="pill" style="font-size:.78rem;">sticky</span>
    </div>
    <nav class="toc">
      <a href="#quick">Quick Summary</a>
      <a href="#part0">PART 0 â€” Concept Primer</a>
      <a href="#part1">PART 1 â€” Problem Analysis</a>
      <a href="#part2">PART 2 â€” Strategy & Tips</a>
      <a href="#part3">PART 3 â€” Full Solution</a>
      <a href="#part4">PART 4 â€” Deeper Understanding</a>
      <a href="#part5">PART 5 â€” Visualization Guide</a>
      <a href="#viz">Interactive Visualizations</a>
    </nav>
    <p class="mini" style="margin:10px 2px 0;">
      Tip: use the temperature slider to see peaks move and to compare wavelength vs frequency peak locations.
    </p>
  </aside>

  <div class="content">

    <section id="quick">
      <h2>Quick Summary</h2>
      <ul>
        <li><strong>What this is about:</strong> blackbody radiation spectrum written as energy density per wavelength <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span> and per frequency <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span>.</li>
        <li><strong>Key physics idea:</strong> the spectrum is Planck-distributed because EM modes in a cavity are quantized and thermally populated.</li>
        <li><strong>Governing equation (wavelength form):</strong> <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)= (8Ï€hc/Î»âµ)/(exp(hc/Î»kT)âˆ’1)</span>.</li>
        <li><strong>Change-of-variables link:</strong> <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)dÎ» = Ï<sub>Î½</sub>(Î½)dÎ½</span> with <span style="font-family:var(--mono);">Î½=c/Î»</span> â‡’ <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)/Ï<sub>Î½</sub>(Î½)=c/Î»Â²</span>.</li>
        <li><strong>Peak condition (wavelength):</strong> letting <span style="font-family:var(--mono);">y=hc/(Î»kT)</span>, the maximum satisfies <span style="font-family:var(--mono);">5(1âˆ’e<sup>âˆ’y</sup>)=y</span> â‡’ <span style="font-family:var(--mono);">yâ‰ˆ4.9651</span>.</li>
        <li><strong>Wienâ€™s law:</strong> <span style="font-family:var(--mono);">Î»<sub>p</sub>T = hc/(ky) â‰ˆ 2.8978Ã—10â»Â³ mÂ·K</span> (symbolic + numeric constant).</li>
        <li><strong>Representation matters:</strong> frequency-peak satisfies <span style="font-family:var(--mono);">3(1âˆ’e<sup>âˆ’x</sup>)=x</span> with <span style="font-family:var(--mono);">x=hÎ½/(kT)</span>, giving <span style="font-family:var(--mono);">xâ‰ˆ2.8214</span> and therefore <span style="font-family:var(--mono);">Î»<sub>p</sub> â‰  c/Î½<sub>p</sub></span>.</li>
      </ul>
    </section>

    <section id="part0">
      <h2>PART 0 â€” Concept Primer (Theory Before Solving)</h2>

      <h3>Core definitions (symbols + units)</h3>
      <ul>
        <li><strong>Energy density per wavelength</strong> <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span>:
          energy per unit volume per unit wavelength. Units: <span style="font-family:var(--mono);">JÂ·mâ»â´</span> so that <span style="font-family:var(--mono);">Ï<sub>Î»</sub>dÎ»</span> has units <span style="font-family:var(--mono);">JÂ·mâ»Â³</span>.</li>
        <li><strong>Energy density per frequency</strong> <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span>:
          energy per unit volume per unit frequency. Units: <span style="font-family:var(--mono);">JÂ·mâ»Â³Â·Hzâ»Â¹</span>.</li>
        <li><strong>Blackbody</strong>: an ideal object/cavity that absorbs and emits EM radiation with maximal emissivity (â‰ˆ1). Spectrum depends only on temperature <span style="font-family:var(--mono);">T</span>.</li>
        <li><strong>Constants</strong>: speed of light <span style="font-family:var(--mono);">c</span>, Planckâ€™s constant <span style="font-family:var(--mono);">h</span>, Boltzmann constant <span style="font-family:var(--mono);">k</span>.</li>
      </ul>

      <h3>Physical meaning of key quantities</h3>
      <p>
        <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)dÎ»</span> is the portion of the electromagnetic energy density
        (inside a cavity at thermal equilibrium) contributed by modes whose wavelengths lie in <span style="font-family:var(--mono);">[Î»,Î»+dÎ»]</span>.
        Likewise <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)dÎ½</span> is the same physical energy, but â€œbinnedâ€ by frequency.
      </p>
      <p>
        The <strong>peak</strong> (â€œmost intenseâ€ wavelength or frequency) depends on how you bin the same underlying radiation field:
        equal-width wavelength bins are not equal-width frequency bins because <span style="font-family:var(--mono);">Î½=c/Î»</span> is nonlinear.
      </p>

      <h3>Key laws/principles (validity + assumptions)</h3>
      <ul>
        <li><strong>Mode counting in a cavity</strong> (classical EM + boundary conditions): number of modes between <span style="font-family:var(--mono);">Î½</span> and <span style="font-family:var(--mono);">Î½+dÎ½</span> is proportional to <span style="font-family:var(--mono);">Î½Â² dÎ½</span>.</li>
        <li><strong>Quantum energy per photon</strong>: <span style="font-family:var(--mono);">E=hÎ½</span>.</li>
        <li><strong>Boseâ€“Einstein thermal occupation</strong> for photons (chemical potential 0): mean energy per mode is
          <span style="font-family:var(--mono);">âŸ¨EâŸ© = (hÎ½)/(exp(hÎ½/kT)âˆ’1)</span>.</li>
        <li><strong>Thermal equilibrium</strong>: spectrum depends only on <span style="font-family:var(--mono);">T</span> (no time-dependence, uniform temperature, isotropy).</li>
      </ul>

      <div class="grid-2">
        <div class="callout assumptions">
          <strong>Assumptions (Blackbody cavity model)</strong>
          <ul>
            <li>Large cavity, EM modes form a quasi-continuum.</li>
            <li>Radiation in thermal equilibrium at temperature <span style="font-family:var(--mono);">T</span>.</li>
            <li>Photons are non-interacting; chemical potential is zero.</li>
            <li>We focus on energy density in the cavity (not surface radiance).</li>
          </ul>
        </div>
        <div class="callout mistakes">
          <strong>What to watch for (common pitfalls)</strong>
          <ul>
            <li>Mixing up <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span> and <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span>: their peaks are different.</li>
            <li>Forgetting the Jacobian: <span style="font-family:var(--mono);">dÎ½ = |dÎ½/dÎ»| dÎ»</span>.</li>
            <li>Assuming <span style="font-family:var(--mono);">Î»<sub>p</sub>=c/Î½<sub>p</sub></span> (usually false).</li>
            <li>Dropping constants without tracking units/dimensions.</li>
          </ul>
        </div>
      </div>

      <h3>Mini intuition examples</h3>
      <ul>
        <li>If you plot the same â€œmountainâ€ using different horizontal coordinates, the location of the maximum shifts unless the mapping is linear. Here <span style="font-family:var(--mono);">Î½=c/Î»</span> is not linear.</li>
        <li>Increasing <span style="font-family:var(--mono);">T</span> shifts the whole spectrum to higher frequencies (shorter wavelengths) because typical thermal photon energy is ~<span style="font-family:var(--mono);">kT</span>.</li>
      </ul>
    </section>

    <section id="part1">
      <h2>PART 1 â€” Problem Analysis (No solving yet)</h2>

      <h3>Restate the problem (in plain words)</h3>
      <p>
        Starting from Planckâ€™s blackbody spectrum, we want the expression for the <em>wavelength</em> spectral energy density
        <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span>, show how it relates to the <em>frequency</em> form
        <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span>, then find the condition for the wavelength peak
        <span style="font-family:var(--mono);">Î»<sub>p</sub></span> and hence prove <span style="font-family:var(--mono);">Î»<sub>p</sub>T=constant</span> (Wienâ€™s displacement law).
        Finally, we compare the peak positions in the two representations and show <span style="font-family:var(--mono);">Î»<sub>p</sub> â‰  c/Î½<sub>p</sub></span>.
      </p>

      <h3>Given quantities</h3>
      <ul>
        <li>Temperature <span style="font-family:var(--mono);">T</span> (symbolic; weâ€™ll also use example values for plots).</li>
        <li>Physical constants <span style="font-family:var(--mono);">h, c, k</span>.</li>
      </ul>

      <h3>Unknowns / targets</h3>
      <ul>
        <li>Derive <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span> and relate it to <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span>.</li>
        <li>Find the peak condition equation for <span style="font-family:var(--mono);">Î»<sub>p</sub></span> and compute <span style="font-family:var(--mono);">Î»<sub>p</sub>T</span>.</li>
        <li>Show how the frequency-peak parameter <span style="font-family:var(--mono);">x</span> is found and compare <span style="font-family:var(--mono);">Î»<sub>p</sub></span> to <span style="font-family:var(--mono);">c/Î½<sub>p</sub></span>.</li>
      </ul>

      <h3>Relevant principles (and why)</h3>
      <ul>
        <li><strong>Planck distribution</strong>: gives the equilibrium energy per mode at temperature <span style="font-family:var(--mono);">T</span>; needed to get the spectral form.</li>
        <li><strong>Density of EM modes</strong>: converts â€œper modeâ€ energy to â€œper volume per frequencyâ€.</li>
        <li><strong>Change of variables</strong>: converts frequency density to wavelength density with the Jacobian <span style="font-family:var(--mono);">|dÎ½/dÎ»|</span>.</li>
        <li><strong>Calculus (maximize)</strong>: set derivative of <span style="font-family:var(--mono);">Ï<sub>Î»</sub></span> to zero to obtain the transcendental equation for the peak.</li>
      </ul>

      <h3>Assumptions to state explicitly</h3>
      <div class="callout assumptions">
        <ul>
          <li>Blackbody cavity in thermal equilibrium, isotropic radiation field.</li>
          <li>Continuum approximation for mode spectrum (large cavity volume).</li>
          <li>Photons are ideal bosons with zero chemical potential.</li>
        </ul>
      </div>

      <h3>Possible approaches (compare)</h3>
      <ul>
        <li><strong>Approach A (fast + standard):</strong> Start from known <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span>, then use <span style="font-family:var(--mono);">Ï<sub>Î»</sub}dÎ»=Ï<sub>Î½</sub}dÎ½</span> to get <span style="font-family:var(--mono);">Ï<sub>Î»</sub></span>. Pro: minimal derivation effort. Con: you must trust the frequency form.</li>
        <li><strong>Approach B (from scratch):</strong> Count modes in <span style="font-family:var(--mono);">k</span>-space and multiply by mean mode energy. Pro: most fundamental. Con: longer.</li>
        <li><strong>Approach C (dimensionless scaling):</strong> Use substitutions <span style="font-family:var(--mono);">x=hÎ½/kT</span>, <span style="font-family:var(--mono);">y=hc/(Î»kT)</span> to make maxima universal. Pro: clean physics intuition; shows why <span style="font-family:var(--mono);">Î»<sub>p</sub>T</span> is constant. Con: requires careful algebra for derivatives.</li>
      </ul>
      <p><strong>We choose A + C:</strong> get <span style="font-family:var(--mono);">Ï<sub>Î»</sub</span> by change of variables, then maximize using dimensionless <span style="font-family:var(--mono);">y</span>.</p>
    </section>

    <section id="part2">
      <h2>PART 2 â€” Strategy & Tips (Roadmap only)</h2>
      <ol style="margin:8px 0 8px 22px;">
        <li>
          <strong>Goal:</strong> state Planckâ€™s spectral energy density per frequency.
          <br><span class="mini">Tool:</span> cavity mode density + Bose occupation.
          <br><span class="mini">Meaning:</span> energy distribution when binned by frequency.
        </li>
        <li>
          <strong>Goal:</strong> convert to wavelength form.
          <br><span class="mini">Tool:</span> <span style="font-family:var(--mono);">Ï<sub>Î»</sub}(Î»)dÎ»=Ï<sub>Î½</sub}(Î½)dÎ½</span> with <span style="font-family:var(--mono);">Î½=c/Î»</span>.
          <br><span class="mini">Meaning:</span> same physical energy, different binning.
        </li>
        <li>
          <strong>Goal:</strong> show <span style="font-family:var(--mono);">Ï<sub>Î»</sub}/Ï<sub>Î½</sub = c/Î»Â²</span>.
          <br><span class="mini">Tool:</span> Jacobian <span style="font-family:var(--mono);">|dÎ½/dÎ»|=c/Î»Â²</span>.
        </li>
        <li>
          <strong>Goal:</strong> find wavelength peak condition.
          <br><span class="mini">Tool:</span> set <span style="font-family:var(--mono);">dÏ<sub>Î»</sub}/dÎ»=0</span>, substitute <span style="font-family:var(--mono);">y=hc/(Î»kT)</span>.
          <br><span class="mini">Meaning:</span> peak occurs at a universal dimensionless y.
        </li>
        <li>
          <strong>Goal:</strong> compute <span style="font-family:var(--mono);">Î»<sub>p</sub}T</span>.
          <br><span class="mini">Tool:</span> <span style="font-family:var(--mono);">Î»<sub>p</sub}T=hc/(ky)</span> with numerically solved <span style="font-family:var(--mono);">y</span>.
        </li>
        <li>
          <strong>Goal:</strong> compare with frequency peak <span style="font-family:var(--mono);">Î½<sub>p</sub}</span>.
          <br><span class="mini">Tool:</span> solve <span style="font-family:var(--mono);">3(1-e^{-x})=x</span> for <span style="font-family:var(--mono);">x=hÎ½/(kT)</span>.
          <br><span class="mini">Meaning:</span> peak depends on which variable you plot against.
        </li>
        <li>
          <strong>Goal:</strong> show <span style="font-family:var(--mono);">Î»<sub>p</sub} â‰  c/Î½<sub>p</sub}</span>.
          <br><span class="mini">Tool:</span> compare <span style="font-family:var(--mono);">c/Î½<sub>p</sub} = hc/(xkT)</span> to <span style="font-family:var(--mono);">Î»<sub>p</sub} = hc/(ykT)</span>.
        </li>
      </ol>

      <div class="callout mistakes">
        <strong>Quick tips</strong>
        <ul>
          <li>Differentiate using logs to avoid messy product/quotient rules: maximize <span style="font-family:var(--mono);">ln Ï<sub>Î»</sub</span>.</li>
          <li>When changing variables, always match physical energy: <span style="font-family:var(--mono);">Ï<sub>Î»</sub}dÎ» = Ï<sub>Î½</sub}dÎ½</span>.</li>
          <li>Keep <span style="font-family:var(--mono);">x</span> and <span style="font-family:var(--mono);">y</span> straight: <span style="font-family:var(--mono);">x=hÎ½/kT</span>, <span style="font-family:var(--mono);">y=hc/(Î»kT)</span>.</li>
        </ul>
      </div>
    </section>

    <section id="part3">
      <h2>PART 3 â€” Full Solution (Detailed + Teaching)</h2>

      <h3>Physical intuition before the math</h3>
      <p>
        A hotter blackbody has more photons and pushes typical photon energies upward. Since photon energy is <span style="font-family:var(--mono);">E=hÎ½</span>,
        higher temperature implies a larger typical <span style="font-family:var(--mono);">Î½</span> (and thus smaller typical <span style="font-family:var(--mono);">Î»</span>).
        The spectrum cannot grow without bound at high frequency because thermal occupation falls off exponentially
        when <span style="font-family:var(--mono);">hÎ½ â‰« kT</span>. The competition between a growing mode count (<span style="font-family:var(--mono);">âˆÎ½Â²</span>) and
        thermal suppression creates a peak.
      </p>

      <h3>Step 1: Planck energy density per frequency</h3>
      <p>
        For electromagnetic waves in a cavity, the number of modes per unit volume with frequencies in <span style="font-family:var(--mono);">[Î½,Î½+dÎ½]</span> is
        <span style="font-family:var(--mono);">g(Î½)dÎ½ = (8Ï€Î½Â²/cÂ³)dÎ½</span> (the factor 2 for polarizations is included).
        Each mode has mean energy
        <span style="font-family:var(--mono);">âŸ¨EâŸ© = (hÎ½)/(exp(hÎ½/kT)âˆ’1)</span>.
      </p>

      <div class="eq" id="eq_rhonu">
        <button class="copy-btn" data-copy="rho_nu(nu) = (8*pi*h*nu^3/c^3) / (exp(h*nu/(k*T)) - 1)">Copy</button>
        <span class="label">Key equation (frequency spectral energy density)</span>
        <div style="font-family:var(--mono);">
          Ï<sub>Î½</sub>(Î½) = (8Ï€hÎ½<sup>3</sup>/c<sup>3</sup>) Â· 1/(exp(hÎ½/kT) âˆ’ 1)
        </div>
      </div>

      <p>
        <strong>Meaning:</strong> <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span> tells you how energy density is distributed across frequency.
        Units check: <span style="font-family:var(--mono);">hÎ½Â³/cÂ³</span> gives <span style="font-family:var(--mono);">JÂ·s Â· sâ»3 / (m/s)Â³ = JÂ·sâ»2 Â· sÂ³/mÂ³ = J/mÂ³</span>,
        and dividing by Hz (since itâ€™s â€œper Î½â€) yields <span style="font-family:var(--mono);">JÂ·mâ»3Â·Hzâ»1</span> as expected.
      </p>

      <h3>Step 2: Convert to wavelength density Ï<sub>Î»</sub>(Î»)</h3>
      <p>
        Frequency and wavelength are related by <span style="font-family:var(--mono);">Î½=c/Î»</span>. The same physical energy in a small band must match:
      </p>

      <div class="eq">
        <button class="copy-btn" data-copy="rho_lambda(lambda)*dlambda = rho_nu(nu)*dnu, with nu = c/lambda">Copy</button>
        <span class="label">Change-of-variables identity (same energy in the bin)</span>
        <div style="font-family:var(--mono);">
          Ï<sub>Î»</sub>(Î») dÎ» = Ï<sub>Î½</sub>(Î½) dÎ½, &nbsp; with &nbsp; Î½ = c/Î»
        </div>
      </div>

      <p>
        Differentiate <span style="font-family:var(--mono);">Î½=c/Î»</span>:
        <span style="font-family:var(--mono);">dÎ½/dÎ» = -c/Î»Â²</span>, so <span style="font-family:var(--mono);">|dÎ½| = (c/Î»Â²)|dÎ»|</span>.
        Therefore
        <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î») = Ï<sub>Î½</sub>(Î½)Â·|dÎ½/dÎ»| = Ï<sub>Î½</sub>(c/Î»)Â·(c/Î»Â²)</span>.
      </p>

      <div class="eq" id="eq_rholambda">
        <button class="copy-btn" data-copy="rho_lambda(lambda) = (8*pi*h*c)/(lambda^5) / (exp(h*c/(lambda*k*T)) - 1)">Copy</button>
        <span class="label">Derived result (wavelength spectral energy density)</span>
        <div style="font-family:var(--mono);">
          Ï<sub>Î»</sub>(Î») = (8Ï€hc/Î»<sup>5</sup>) Â· 1/(exp(hc/(Î»kT)) âˆ’ 1)
        </div>
      </div>

      <div class="callout keyeq">
        <strong>Required relationship (as asked)</strong><br/>
        Since <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)=Ï<sub>Î½</sub>(Î½)|dÎ½/dÎ»|</span> and <span style="font-family:var(--mono);">|dÎ½/dÎ»|=c/Î»Â²</span>, we have
        <div style="margin-top:8px; font-family:var(--mono);">
          Ï<sub>Î»</sub>(Î») / Ï<sub>Î½</sub>(Î½) = c/Î»Â²  &nbsp; (with Î½=c/Î»)
        </div>
      </div>

      <h3>Step 3: Maximize Ï<sub>Î»</sub>(Î») to get Wienâ€™s displacement law</h3>
      <p>
        Define the dimensionless variable
        <span style="font-family:var(--mono);">y = hc/(Î»kT)</span>. Note that <span style="font-family:var(--mono);">y âˆ 1/Î»</span>.
        Write the spectrum:
      </p>

      <div class="eq">
        <button class="copy-btn" data-copy="rho_lambda(lambda) = (8*pi*h*c)*lambda^{-5} * [exp(y)-1]^{-1},  y = h*c/(lambda*k*T)">Copy</button>
        <span class="label">Set up for differentiation (define y)</span>
        <div style="font-family:var(--mono);">
          Ï<sub>Î»</sub>(Î») = (8Ï€hc) Â· Î»<sup>âˆ’5</sup> Â· (exp(y) âˆ’ 1)<sup>âˆ’1</sup>, &nbsp; y = hc/(Î»kT)
        </div>
      </div>

      <p>
        To find the peak, set <span style="font-family:var(--mono);">dÏ<sub>Î»</sub>/dÎ» = 0</span>. A clean method is to differentiate the log:
      </p>

      <div class="eq">
        <button class="copy-btn" data-copy="ln rho_lambda = const - 5 ln lambda - ln(exp(y)-1),  y=hc/(lambda*k*T)">Copy</button>
        <span class="label">Differentiate ln(Ï<sub>Î»</sub>)</span>
        <div style="font-family:var(--mono);">
          ln Ï<sub>Î»</sub> = const âˆ’ 5 ln Î» âˆ’ ln(exp(y) âˆ’ 1)
        </div>
      </div>

      <p>
        Differentiate with respect to <span style="font-family:var(--mono);">Î»</span>:
      </p>
      <ul>
        <li><span style="font-family:var(--mono);">d/dÎ»(âˆ’5 ln Î») = âˆ’5/Î»</span>.</li>
        <li>
          For the last term, use chain rule:
          <span style="font-family:var(--mono);">d/dÎ» ln(exp(y)âˆ’1) = (exp(y)/(exp(y)âˆ’1)) Â· dy/dÎ»</span>.
        </li>
        <li>
          Since <span style="font-family:var(--mono);">y=hc/(Î»kT)</span>, we have
          <span style="font-family:var(--mono);">dy/dÎ» = âˆ’hc/(kT) Â· 1/Î»Â² = âˆ’y/Î»</span>.
        </li>
      </ul>

      <p>
        Put it together:
      </p>

      <div class="eq">
        <button class="copy-btn" data-copy="d/dlambda ln(rho_lambda)= -5/lambda - [exp(y)/(exp(y)-1)]*(dy/dlambda);  dy/dlambda=-y/lambda">Copy</button>
        <span class="label">Set derivative to zero</span>
        <div style="font-family:var(--mono);">
          0 = d/dÎ» ln Ï<sub>Î»</sub>
            = âˆ’5/Î» âˆ’ (exp(y)/(exp(y)âˆ’1)) Â· (dy/dÎ»)
          <br/>
          with dy/dÎ» = âˆ’y/Î»
        </div>
      </div>

      <p>
        Substitute <span style="font-family:var(--mono);">dy/dÎ» = âˆ’y/Î»</span>:
      </p>
      <p style="font-family:var(--mono);">
        0 = âˆ’5/Î» + (exp(y)/(exp(y)âˆ’1)) Â· (y/Î»)
        &nbsp;â‡’&nbsp; 5 = y Â· exp(y)/(exp(y)âˆ’1).
      </p>

      <p>
        Rewrite <span style="font-family:var(--mono);">exp(y)/(exp(y)âˆ’1) = 1/(1âˆ’exp(âˆ’y))</span>, giving the required transcendental equation:
      </p>

      <div class="eq" id="eq_y">
        <button class="copy-btn" data-copy="5*(1 - exp(-y)) = y,  where y = h*c/(lambda_p*k*T)">Copy</button>
        <span class="label">Peak condition for the wavelength spectrum</span>
        <div style="font-family:var(--mono);">
          5(1 âˆ’ e<sup>âˆ’y</sup>) = y, &nbsp; where &nbsp; y = hc/(Î»<sub>p</sub>kT)
        </div>
      </div>

      <p>
        This equation has a universal numerical solution
        <span style="font-family:var(--mono);">y â‰ˆ 4.965114...</span>.
        Therefore,
      </p>

      <div class="eq" id="eq_wien">
        <button class="copy-btn" data-copy="lambda_p*T = (h*c)/(k*y) â‰ˆ 2.8978e-3 m*K, with yâ‰ˆ4.965114">Copy</button>
        <span class="label">Wienâ€™s displacement law (wavelength peak)</span>
        <div style="font-family:var(--mono);">
          Î»<sub>p</sub>T = hc/(k y) â‰ˆ 2.8978Ã—10<sup>âˆ’3</sup> mÂ·K
        </div>
      </div>

      <div class="callout final">
        <strong>Final (boxed) results</strong>
        <ul>
          <li><span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î») = (8Ï€hc/Î»âµ)/(exp(hc/(Î»kT))âˆ’1)</span></li>
          <li><span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)/Ï<sub>Î½</sub>(Î½) = c/Î»Â²</span> (with <span style="font-family:var(--mono);">Î½=c/Î»</span>)</li>
          <li>Peak condition: <span style="font-family:var(--mono);">5(1âˆ’e<sup>âˆ’y</sup>)=y</span>, <span style="font-family:var(--mono);">yâ‰ˆ4.9651</span></li>
          <li>Wien: <span style="font-family:var(--mono);">Î»<sub>p</sub>T â‰ˆ 2.8978Ã—10â»Â³ mÂ·K</span></li>
        </ul>
        <button class="copy-btn" style="position:static; margin-top:8px;" data-copy="rho_lambda(lambda) = (8*pi*h*c)/(lambda^5)/(exp(h*c/(lambda*k*T))-1)
rho_lambda/rho_nu = c/lambda^2 (nu=c/lambda)
Peak: 5(1-exp(-y))=y, y= h*c/(lambda_p*k*T), yâ‰ˆ4.965114
Wien: lambda_p*T = h*c/(k*y) â‰ˆ 2.8978e-3 m*K">Copy final answers</button>
      </div>

      <h3>Step 4: Frequency peak and why Î»<sub>p</sub> â‰  c/Î½<sub>p</sub></h3>
      <p>
        The exercise states that the frequency at which the <em>frequency</em> spectrum is maximum satisfies
        <span style="font-family:var(--mono);">3(1âˆ’e<sup>âˆ’x</sup>)=x</span>, where <span style="font-family:var(--mono);">x=hÎ½<sub>p</sub>/(kT)</span>.
        Solving gives <span style="font-family:var(--mono);">x â‰ˆ 2.821439...</span>.
        Then
        <span style="font-family:var(--mono);">Î½<sub>p</sub> = (x kT)/h</span>.
      </p>

      <div class="eq" id="eq_x">
        <button class="copy-btn" data-copy="3*(1 - exp(-x)) = x,  x = h*nu_p/(k*T),  xâ‰ˆ2.821439">Copy</button>
        <span class="label">Peak condition for the frequency spectrum (given in the exercise)</span>
        <div style="font-family:var(--mono);">
          3(1 âˆ’ e<sup>âˆ’x</sup>) = x, &nbsp; x = hÎ½<sub>p</sub>/(kT), &nbsp; xâ‰ˆ2.821439
        </div>
      </div>

      <p>
        Compare the â€œwavelength corresponding to the frequency peakâ€:
      </p>
      <p style="font-family:var(--mono);">
        c/Î½<sub>p</sub> = hc/(xkT), &nbsp; while &nbsp; Î»<sub>p</sub> = hc/(ykT).
      </p>
      <p>
        Since <span style="font-family:var(--mono);">yâ‰ˆ4.9651</span> and <span style="font-family:var(--mono);">xâ‰ˆ2.8214</span>,
      </p>
      <p style="font-family:var(--mono);">
        c/Î½<sub>p</sub> = (y/x) Î»<sub>p</sub> â‰ˆ 1.760 Î»<sub>p</sub>.
      </p>

      <div class="callout keyeq">
        <strong>Conclusion:</strong> <span style="font-family:var(--mono);">Î»<sub>p</sub> â‰  c/Î½<sub>p</sub></span>.
        <br/>
        The mismatch is not a paradox: it comes from using different â€œbin widthsâ€ (equal Î”Î» vs equal Î”Î½) and the nonlinear mapping <span style="font-family:var(--mono);">Î½=c/Î»</span>.
      </div>

      <h3>Sanity checks</h3>
      <ul>
        <li><strong>Units:</strong> <span style="font-family:var(--mono);">Î»<sub>p</sub>T</span> has units <span style="font-family:var(--mono);">mÂ·K</span>, consistent with <span style="font-family:var(--mono);">hc/k</span>.</li>
        <li><strong>Limiting behavior:</strong> as <span style="font-family:var(--mono);">Î»â†’0</span>, the exponential dominates and <span style="font-family:var(--mono);">Ï<sub>Î»</sub>â†’0</span>; as <span style="font-family:var(--mono);">Î»â†’âˆ</span>, the <span style="font-family:var(--mono);">Î»â»âµ</span> factor wins and <span style="font-family:var(--mono);">Ï<sub>Î»</sub>â†’0</span>. So a peak must exist.</li>
        <li><strong>Temperature shift:</strong> increasing <span style="font-family:var(--mono);">T</span> decreases <span style="font-family:var(--mono);">Î»<sub>p</sub></span> proportional to <span style="font-family:var(--mono);">1/T</span>, matching the physical expectation â€œhotter â†’ bluerâ€.</li>
      </ul>

      <p class="print-note">
        (Print note: interactive plots are included on screen; in print they appear as static canvas snapshots.)
      </p>
    </section>

    <section id="part4">
      <h2>PART 4 â€” Deeper Understanding (Theory Around the Result)</h2>

      <h3>Re-interpreting the final formulas</h3>
      <p>
        In <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î») = (8Ï€hc/Î»âµ)/(exp(hc/(Î»kT))âˆ’1)</span>:
      </p>
      <ul>
        <li><strong>The prefactor</strong> <span style="font-family:var(--mono);">8Ï€hc/Î»âµ</span> grows rapidly at short wavelength, reflecting both mode density and energy-per-photon scaling.</li>
        <li><strong>The denominator</strong> <span style="font-family:var(--mono);">exp(hc/(Î»kT))âˆ’1</span> suppresses very short wavelengths because high-energy photons are thermally rare.</li>
        <li><strong>The dimensionless ratio</strong> <span style="font-family:var(--mono);">hc/(Î»kT)</span> controls shape: itâ€™s â€œphoton energy / thermal energyâ€.</li>
      </ul>

      <h3>How parameters affect outcomes (connect to plots)</h3>
      <ul>
        <li>Changing <span style="font-family:var(--mono);">T</span> rescales the horizontal axis: <span style="font-family:var(--mono);">Î»<sub>p</sub>âˆ1/T</span> and <span style="font-family:var(--mono);">Î½<sub>p</sub>âˆT</span>.</li>
        <li>The <strong>shape</strong> of the normalized spectrum is universal in the variable <span style="font-family:var(--mono);">y=hc/(Î»kT)</span> (or <span style="font-family:var(--mono);">x=hÎ½/(kT)</span>).</li>
        <li>The wavelength-peak and frequency-peak occur at different dimensionless numbers (<span style="font-family:var(--mono);">yâ‰ˆ4.965</span> vs <span style="font-family:var(--mono);">xâ‰ˆ2.821</span>), so their â€œconvertedâ€ wavelengths differ by a factor <span style="font-family:var(--mono);">y/xâ‰ˆ1.760</span>.</li>
      </ul>

      <h3>Alternative derivation idea (brief)</h3>
      <p>
        Instead of starting from <span style="font-family:var(--mono);">Ï<sub>Î½</sub></span>, you can count states in <span style="font-family:var(--mono);">k</span>-space directly,
        write energy density per angular frequency <span style="font-family:var(--mono);">u(Ï‰)</span>, and then convert to <span style="font-family:var(--mono);">u(Î»)</span>.
        The peak equations emerge identically once you use the dimensionless combinations <span style="font-family:var(--mono);">Ä§Ï‰/kT</span> or <span style="font-family:var(--mono);">hc/(Î»kT)</span>.
      </p>

      <h3>Concept checks (self-test)</h3>
      <ul>
        <li><strong>Q:</strong> If you double <span style="font-family:var(--mono);">T</span>, what happens to <span style="font-family:var(--mono);">Î»<sub>p</sub></span>? <br><strong>A:</strong> It halves, because <span style="font-family:var(--mono);">Î»<sub>p</sub>T</span> is constant.</li>
        <li><strong>Q:</strong> Why doesnâ€™t <span style="font-family:var(--mono);">Î»<sub>p</sub>=c/Î½<sub>p</sub></span>? <br><strong>A:</strong> Because changing variables requires a Jacobian; maximizing after a nonlinear transform shifts the maximum.</li>
        <li><strong>Q:</strong> What does <span style="font-family:var(--mono);">y=hc/(Î»kT)</span> represent? <br><strong>A:</strong> Photon energy <span style="font-family:var(--mono);">hc/Î»</span> measured in units of thermal energy <span style="font-family:var(--mono);">kT</span>.</li>
        <li><strong>Q:</strong> Does the spectrum depend on cavity size? <br><strong>A:</strong> The energy density spectrum in equilibrium depends only on <span style="font-family:var(--mono);">T</span>, not on cavity size (in the continuum limit).</li>
      </ul>
    </section>

    <section id="part5">
      <h2>PART 5 â€” Visualization Guide (How to Read the Plots)</h2>
      <ul>
        <li><strong>Diagram canvas:</strong> a blackbody cavity with a small aperture. Inside, radiation is isotropic and in equilibrium at temperature <span style="font-family:var(--mono);">T</span>. The aperture lets a sample escape without disturbing equilibrium (idealized).</li>
        <li><strong>Main plot:</strong> normalized wavelength energy density <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span> vs <span style="font-family:var(--mono);">Î»</span> (Î¼m). The vertical line marks <span style="font-family:var(--mono);">Î»<sub>p</sub></span>.</li>
        <li><strong>Secondary plot:</strong> normalized frequency energy density <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span> vs <span style="font-family:var(--mono);">Î½</span> (THz). The vertical line marks <span style="font-family:var(--mono);">Î½<sub>p</sub></span>, and a second marker shows <span style="font-family:var(--mono);">c/Î»<sub>p</sub></span> to visualize the mismatch.</li>
        <li><strong>Interactive control:</strong> the temperature slider updates <span style="font-family:var(--mono);">Î»<sub>p</sub>(T)=b/T</span> and <span style="font-family:var(--mono);">Î½<sub>p</sub>(T)=xkT/h</span>, shifting both axes and updating both plots live.</li>
      </ul>
    </section>

    <section id="viz">
      <h2>Interactive Visualizations</h2>

      <div class="controls" aria-label="Interactive controls">
        <div class="left">
          <label for="temp">Temperature T (K)</label>
          <input id="temp" type="range" min="100" max="6000" step="10" value="300">
          <span class="readout" id="Tread">T = 300 K</span>
        </div>
        <div class="right">
          <span class="readout" id="lpread">Î»p = â€”</span>
          <span class="readout" id="nupread">Î½p = â€”</span>
          <span class="readout" id="ratioRead">c/Î½p Ã· Î»p = â€”</span>
        </div>
      </div>

      <div class="viz-wrap">
        <figure>
          <canvas id="cav"></canvas>
          <figcaption>
            Labeled setup: blackbody cavity at temperature <span style="font-family:var(--mono);">T</span> with a small aperture.
            The spectrum shown in the plots is the equilibrium radiation inside the cavity (energy density).
          </figcaption>
        </figure>

        <div class="viz-grid">
          <figure>
            <canvas id="plotLambda"></canvas>
            <figcaption>
              Main plot: normalized <span style="font-family:var(--mono);">Ï<sub>Î»</sub>(Î»)</span> vs wavelength. Peak at <span style="font-family:var(--mono);">Î»<sub>p</sub></span> obeys Wienâ€™s law.
            </figcaption>
          </figure>
          <figure>
            <canvas id="plotNu"></canvas>
            <figcaption>
              Secondary plot: normalized <span style="font-family:var(--mono);">Ï<sub>Î½</sub>(Î½)</span> vs frequency. Note the distinct peak <span style="font-family:var(--mono);">Î½<sub>p</sub></span> and compare to <span style="font-family:var(--mono);">c/Î»<sub>p</sub></span>.
            </figcaption>
          </figure>
        </div>
      </div>

      <p class="mini">
        Plot note: we display <em>normalized</em> spectral shapes (each curve divided by its own maximum) so the important physics is the peak location and shape,
        while units remain clear on the axes.
      </p>
    </section>

  </div>
</main>

<footer>
  <div>
    Constants used: <span style="font-family:var(--mono);">h = 6.62607015Ã—10â»Â³â´ JÂ·s</span>,
    <span style="font-family:var(--mono);">k = 1.380649Ã—10â»Â²Â³ J/K</span>,
    <span style="font-family:var(--mono);">c = 2.99792458Ã—10â¸ m/s</span>.
    Wavelength-peak root <span style="font-family:var(--mono);">yâ‰ˆ4.965114</span>, frequency-peak root <span style="font-family:var(--mono);">xâ‰ˆ2.821439</span>.
  </div>
</footer>

<script>
/* ========= Copy buttons ========= */
(function(){
  function setButtonState(btn, ok){
    btn.textContent = ok ? "Copied!" : "Copy";
    btn.style.borderColor = ok ? "rgba(52,211,153,.45)" : "rgba(255,255,255,.10)";
    btn.style.background = ok ? "rgba(52,211,153,.12)" : "rgba(0,0,0,.20)";
    setTimeout(()=> {
      btn.textContent = "Copy";
      btn.style.borderColor = "rgba(255,255,255,.10)";
      btn.style.background = "rgba(0,0,0,.20)";
    }, 900);
  }
  document.querySelectorAll(".copy-btn").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const text = btn.getAttribute("data-copy") || "";
      try{
        await navigator.clipboard.writeText(text);
        setButtonState(btn, true);
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand("copy"); setButtonState(btn, true); }
        catch(err){ setButtonState(btn, false); }
        document.body.removeChild(ta);
      }
    });
  });
})();

/* ========= Physics constants ========= */
const CONST = {
  h: 6.62607015e-34,
  k: 1.380649e-23,
  c: 2.99792458e8,
  pi: Math.PI,
  // Universal roots (precomputed):
  // y solves 5(1-e^{-y})=y, x solves 3(1-e^{-x})=x
  y: 4.965114231744276,
  x: 2.8214393721220787
};
CONST.b = (CONST.h * CONST.c) / (CONST.k * CONST.y); // Wien displacement constant for wavelength peak

/* ========= Canvas helpers ========= */
function setupHiDPICanvas(canvas){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(2, Math.floor(rect.width * dpr));
  const h = Math.max(2, Math.floor(rect.height * dpr));
  if(canvas.width !== w || canvas.height !== h){
    canvas.width = w; canvas.height = h;
  }
  const ctx = canvas.getContext("2d");
  ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  return {ctx, w: rect.width, h: rect.height, dpr};
}

function clear(ctx, w, h){
  ctx.clearRect(0,0,w,h);
}

function roundNice(x){
  // nice rounding for readouts
  if(x === 0) return "0";
  const ax = Math.abs(x);
  if(ax >= 1e3 || ax < 1e-2) return x.toExponential(3);
  return x.toFixed(3);
}

function drawPanelTitle(ctx, x, y, text){
  ctx.save();
  ctx.font = "700 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillStyle = "rgba(233,238,255,.95)";
  ctx.fillText(text, x, y);
  ctx.restore();
}

function drawAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel){
  const {x,y,w,h} = box;
  const padL = 56, padR = 16, padT = 28, padB = 44;
  const gx = x + padL, gy = y + padT;
  const gw = w - padL - padR, gh = h - padT - padB;

  // background
  ctx.save();
  ctx.fillStyle = "rgba(0,0,0,.12)";
  ctx.fillRect(x,y,w,h);
  ctx.strokeStyle = "rgba(255,255,255,.10)";
  ctx.lineWidth = 1;
  ctx.strokeRect(x+0.5,y+0.5,w-1,h-1);
  ctx.restore();

  function X(u){ return gx + (u - xMin) * gw / (xMax - xMin); }
  function Y(v){ return gy + gh - (v - yMin) * gh / (yMax - yMin); }

  // grid + ticks
  ctx.save();
  ctx.strokeStyle = "rgba(255,255,255,.10)";
  ctx.fillStyle = "rgba(233,238,255,.70)";
  ctx.lineWidth = 1;
  ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";

  const nXTicks = 6, nYTicks = 5;
  for(let i=0;i<=nXTicks;i++){
    const t = i/nXTicks;
    const xv = xMin + t*(xMax-xMin);
    const xp = X(xv);
    ctx.beginPath();
    ctx.moveTo(xp, gy);
    ctx.lineTo(xp, gy+gh);
    ctx.stroke();

    ctx.fillText(formatTick(xv), xp-10, gy+gh+18);
  }
  for(let j=0;j<=nYTicks;j++){
    const t = j/nYTicks;
    const yv = yMin + t*(yMax-yMin);
    const yp = Y(yv);
    ctx.beginPath();
    ctx.moveTo(gx, yp);
    ctx.lineTo(gx+gw, yp);
    ctx.stroke();

    ctx.fillText(formatTick(yv), gx-40, yp+4);
  }

  // axes lines
  ctx.strokeStyle = "rgba(233,238,255,.55)";
  ctx.lineWidth = 1.2;
  ctx.beginPath();
  ctx.moveTo(gx, gy);
  ctx.lineTo(gx, gy+gh);
  ctx.lineTo(gx+gw, gy+gh);
  ctx.stroke();

  // labels
  ctx.fillStyle = "rgba(233,238,255,.88)";
  ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillText(xLabel, gx + gw/2 - ctx.measureText(xLabel).width/2, gy+gh+36);

  ctx.save();
  ctx.translate(x+16, gy + gh/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
  ctx.restore();

  ctx.restore();

  return {X, Y, gx, gy, gw, gh};
}

function formatTick(v){
  const av = Math.abs(v);
  if(av >= 1000) return (v/1000).toFixed(1)+"k";
  if(av >= 10) return v.toFixed(0);
  if(av >= 1) return v.toFixed(1);
  if(av >= 0.1) return v.toFixed(2);
  return v.toFixed(3);
}

function drawLine(ctx, pts, strokeStyle, lineWidth=2){
  ctx.save();
  ctx.strokeStyle = strokeStyle;
  ctx.lineWidth = lineWidth;
  ctx.lineJoin = "round";
  ctx.lineCap = "round";
  ctx.beginPath();
  for(let i=0;i<pts.length;i++){
    const p = pts[i];
    if(i===0) ctx.moveTo(p[0], p[1]);
    else ctx.lineTo(p[0], p[1]);
  }
  ctx.stroke();
  ctx.restore();
}

function drawVMarker(ctx, X, yTop, yBot, xVal, label, color){
  const xp = X(xVal);
  ctx.save();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(xp, yTop);
  ctx.lineTo(xp, yBot);
  ctx.stroke();

  // label box
  ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  const pad = 6;
  const tw = ctx.measureText(label).width;
  const bx = xp - tw/2 - pad;
  const by = yTop + 8;
  ctx.fillStyle = "rgba(0,0,0,.55)";
  ctx.strokeStyle = "rgba(255,255,255,.18)";
  ctx.lineWidth = 1;
  roundRect(ctx, bx, by, tw + pad*2, 22, 9);
  ctx.fill();
  ctx.stroke();
  ctx.fillStyle = "rgba(233,238,255,.92)";
  ctx.fillText(label, xp - tw/2, by + 15);
  ctx.restore();
}

function roundRect(ctx, x, y, w, h, r){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
}

/* ========= Spectral shapes (normalized) =========
   Use dimensionless forms so shape is universal; temperature only rescales axis units.

   Wavelength: rho_lambda âˆ (1/Î»^5)/(exp(hc/(Î»kT))-1).
   Let s = Î»/Î»p, y = hc/(Î»p kT). Then exponent = y/s.
   Normalized: fÎ»(s) = [(1/s^5)/(exp(y/s)-1)] / [(1)/(exp(y)-1)].

   Frequency: rho_nu âˆ (Î½^3)/(exp(hÎ½/(kT))-1).
   Let t = Î½/Î½p, x = hÎ½p/(kT). Then exponent = x t.
   Normalized: fÎ½(t) = [t^3/(exp(x t)-1)] / [1/(exp(x)-1)].
*/
function fLambdaNorm(s){
  const y = CONST.y;
  const num = (1/Math.pow(s,5)) / (Math.exp(y/s) - 1);
  const den = 1 / (Math.exp(y) - 1);
  return num/den;
}
function fNuNorm(t){
  const x = CONST.x;
  const num = (Math.pow(t,3)) / (Math.exp(x*t) - 1);
  const den = 1 / (Math.exp(x) - 1);
  return num/den;
}

/* ========= Draw cavity diagram ========= */
function drawCavity(canvas, T){
  const {ctx, w, h} = setupHiDPICanvas(canvas);
  clear(ctx, w, h);

  // Title
  drawPanelTitle(ctx, 14, 18, "Blackbody cavity (equilibrium radiation)");

  // Cavity body
  const cx = 22, cy = 34, cw = w-44, ch = h-70;

  ctx.save();
  ctx.fillStyle = "rgba(255,255,255,.04)";
  ctx.strokeStyle = "rgba(255,255,255,.14)";
  ctx.lineWidth = 2;
  roundRect(ctx, cx, cy, cw, ch, 18);
  ctx.fill();
  ctx.stroke();

  // inner shading
  ctx.fillStyle = "rgba(0,0,0,.22)";
  roundRect(ctx, cx+10, cy+10, cw-20, ch-20, 14);
  ctx.fill();

  // aperture
  const apR = 10;
  const apX = cx+cw;
  const apY = cy + ch*0.50;
  ctx.fillStyle = "rgba(125,211,252,.85)";
  ctx.beginPath();
  ctx.arc(apX, apY, apR, 0, Math.PI*2);
  ctx.fill();

  // rays
  ctx.strokeStyle = "rgba(125,211,252,.50)";
  ctx.lineWidth = 2;
  for(let i=-2;i<=2;i++){
    ctx.beginPath();
    ctx.moveTo(apX+apR+2, apY+i*7);
    ctx.lineTo(apX+apR+70, apY+i*13);
    ctx.stroke();
  }

  // Isotropic wave squiggles inside
  ctx.strokeStyle = "rgba(167,139,250,.45)";
  ctx.lineWidth = 2;
  for(let k=0;k<6;k++){
    const x0 = cx+40 + (k%3)*120;
    const y0 = cy+50 + Math.floor(k/3)*120;
    ctx.beginPath();
    for(let i=0;i<60;i++){
      const xx = x0 + i*2;
      const yy = y0 + 10*Math.sin((i/60)*Math.PI*3 + k);
      ctx.lineTo(xx, yy);
    }
    ctx.stroke();
  }

  // Labels
  ctx.fillStyle = "rgba(233,238,255,.92)";
  ctx.font = "600 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillText("cavity walls (ideal absorber/emitter)", cx+16, cy+20);

  ctx.fillStyle = "rgba(233,238,255,.85)";
  ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillText("radiation in thermal equilibrium", cx+16, cy+40);

  const Ttxt = `T = ${Math.round(T)} K`;
  ctx.fillStyle = "rgba(52,211,153,.95)";
  ctx.font = "700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillText(Ttxt, cx+16, cy+60);

  ctx.fillStyle = "rgba(125,211,252,.92)";
  ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillText("small aperture (samples spectrum)", apX-190, apY-18);

  ctx.restore();
}

/* ========= Draw plots ========= */
function drawLambdaPlot(canvas, T){
  const {ctx, w, h} = setupHiDPICanvas(canvas);
  clear(ctx, w, h);

  drawPanelTitle(ctx, 14, 18, "Wavelength spectrum (normalized)  ÏÎ»(Î»)/ÏÎ»,max");

  // Compute peak wavelength for this T
  const lambdaP = CONST.b / T; // meters
  const lambdaP_um = lambdaP * 1e6;

  // Choose plotting range around peak (0.2..5)*lambdaP
  const xMin = 0.2*lambdaP_um;
  const xMax = 5.0*lambdaP_um;
  const yMin = 0;
  const yMax = 1.05;

  const box = {x: 10, y: 10, w: w-20, h: h-20};
  const ax = drawAxes(ctx, box, xMin, xMax, yMin, yMax, "wavelength Î» (Î¼m)", "normalized ÏÎ»");

  // Curve
  const N = 420;
  const pts = [];
  for(let i=0;i<=N;i++){
    const lam_um = xMin + (xMax-xMin)*i/N;
    const s = lam_um / lambdaP_um; // Î»/Î»p
    const val = fLambdaNorm(s);
    pts.push([ax.X(lam_um), ax.Y(val)]);
  }
  drawLine(ctx, pts, "rgba(125,211,252,.95)", 2.5);

  // Peak marker
  drawVMarker(ctx, ax.X, ax.gy, ax.gy+ax.gh, lambdaP_um, "Î»p", "rgba(52,211,153,.95)");

  // Legend
  ctx.save();
  ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillStyle = "rgba(233,238,255,.85)";
  ctx.fillText("Curve: Planck ÏÎ» (shape), normalized", ax.gx+10, ax.gy+18);
  ctx.fillStyle = "rgba(52,211,153,.9)";
  ctx.fillText(`Î»p = ${lambdaP_um.toFixed(3)} Î¼m`, ax.gx+10, ax.gy+36);
  ctx.restore();
}

function drawNuPlot(canvas, T){
  const {ctx, w, h} = setupHiDPICanvas(canvas);
  clear(ctx, w, h);

  drawPanelTitle(ctx, 14, 18, "Frequency spectrum (normalized)  ÏÎ½(Î½)/ÏÎ½,max");

  // Peak frequency for this T
  const nuP = (CONST.x * CONST.k * T) / CONST.h; // Hz
  const nuP_THz = nuP / 1e12;

  // Also compute c/lambdaP for comparison marker (convert Î»p from Wien)
  const lambdaP = CONST.b / T; // m
  const nu_from_lambdaP = CONST.c / lambdaP; // Hz
  const nu_from_lambdaP_THz = nu_from_lambdaP / 1e12;

  // Plot range around nuP: (0.2..5)*nuP
  const xMin = 0.2*nuP_THz;
  const xMax = 5.0*nuP_THz;
  const yMin = 0;
  const yMax = 1.05;

  const box = {x: 10, y: 10, w: w-20, h: h-20};
  const ax = drawAxes(ctx, box, xMin, xMax, yMin, yMax, "frequency Î½ (THz)", "normalized ÏÎ½");

  // Curve
  const N = 420;
  const pts = [];
  for(let i=0;i<=N;i++){
    const nu_THz = xMin + (xMax-xMin)*i/N;
    const t = nu_THz / nuP_THz; // Î½/Î½p
    const val = fNuNorm(t);
    pts.push([ax.X(nu_THz), ax.Y(val)]);
  }
  drawLine(ctx, pts, "rgba(167,139,250,.95)", 2.5);

  // Markers: Î½p and c/Î»p
  drawVMarker(ctx, ax.X, ax.gy, ax.gy+ax.gh, nuP_THz, "Î½p", "rgba(52,211,153,.95)");
  // draw second marker if in range
  if(nu_from_lambdaP_THz >= xMin && nu_from_lambdaP_THz <= xMax){
    drawVMarker(ctx, ax.X, ax.gy, ax.gy+ax.gh, nu_from_lambdaP_THz, "c/Î»p", "rgba(251,191,36,.95)");
  }

  // Legend
  ctx.save();
  ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
  ctx.fillStyle = "rgba(233,238,255,.85)";
  ctx.fillText("Curve: Planck ÏÎ½ (shape), normalized", ax.gx+10, ax.gy+18);
  ctx.fillStyle = "rgba(52,211,153,.9)";
  ctx.fillText(`Î½p = ${nuP_THz.toFixed(3)} THz`, ax.gx+10, ax.gy+36);
  ctx.fillStyle = "rgba(251,191,36,.95)";
  ctx.fillText(`c/Î»p = ${nu_from_lambdaP_THz.toFixed(3)} THz`, ax.gx+10, ax.gy+54);
  ctx.restore();
}

/* ========= UI + update loop ========= */
const els = {
  temp: document.getElementById("temp"),
  Tread: document.getElementById("Tread"),
  lpread: document.getElementById("lpread"),
  nupread: document.getElementById("nupread"),
  ratioRead: document.getElementById("ratioRead"),
  cav: document.getElementById("cav"),
  plotLambda: document.getElementById("plotLambda"),
  plotNu: document.getElementById("plotNu")
};

function updateAll(){
  const T = Number(els.temp.value);
  els.Tread.textContent = `T = ${T} K`;

  const lambdaP = CONST.b / T; // m
  const lambdaP_um = lambdaP * 1e6;
  const nuP = (CONST.x * CONST.k * T) / CONST.h; // Hz
  const nuP_THz = nuP / 1e12;

  const cOverNuP = CONST.c / nuP; // m
  const ratio = cOverNuP / lambdaP;

  els.lpread.textContent = `Î»p = ${lambdaP_um.toFixed(3)} Î¼m`;
  els.nupread.textContent = `Î½p = ${nuP_THz.toFixed(3)} THz`;
  els.ratioRead.textContent = `c/Î½p Ã· Î»p = ${ratio.toFixed(3)}`;

  drawCavity(els.cav, T);
  drawLambdaPlot(els.plotLambda, T);
  drawNuPlot(els.plotNu, T);
}

// Resize-aware redraw
let resizeTimer = null;
window.addEventListener("resize", ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(updateAll, 80);
});
els.temp.addEventListener("input", updateAll);

// Initial draw
updateAll();
</script>
</body>
</html>
