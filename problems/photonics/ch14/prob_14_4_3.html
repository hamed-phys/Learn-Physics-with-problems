<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inhibited Spontaneous Emission in a 2D Blackbody Radiator (Mode Density, Spectrum, and 2D Spontaneous Emission)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f1733;
      --card2:#0c1430;
      --text:#e9eefc;
      --muted:#b8c2e6;
      --soft:#8ea0df;
      --accent:#8be9fd;
      --accent2:#a78bfa;
      --warn:#ffd166;
      --good:#7CFF9B;
      --bad:#ff6b6b;
      --line:rgba(255,255,255,.10);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: radial-gradient(1200px 700px at 15% 0%, rgba(167,139,250,.18), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(139,233,253,.18), transparent 60%),
                  linear-gradient(180deg, #070a14, #0b1020 30%, #070a14);
      line-height:1.55;
    }
    header{
      padding:34px 18px 18px;
      max-width:1180px;
      margin:0 auto;
    }
    .title{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:start;
    }
    h1{
      margin:0;
      font-size: clamp(1.35rem, 2.3vw, 2.1rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      max-width: 86ch;
      font-size: 1rem;
    }

    main{
      max-width:1180px;
      margin:0 auto;
      padding: 0 18px 40px;
      display:grid;
      grid-template-columns: 330px 1fr;
      gap:16px;
      align-items:start;
    }

    nav.toc{
      position: sticky;
      top: 14px;
      align-self:start;
      background: linear-gradient(180deg, rgba(15,23,51,.92), rgba(12,20,48,.86));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px 14px 12px;
      backdrop-filter: blur(10px);
    }
    .toc h2{
      margin: 2px 0 10px;
      font-size: .98rem;
      color: var(--text);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .toc small{color:var(--soft)}
    .toc a{
      display:block;
      text-decoration:none;
      color: var(--muted);
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      font-size:.95rem;
    }
    .toc a:hover{
      background: rgba(139,233,253,.08);
      border-color: rgba(139,233,253,.22);
      transform: translateX(2px);
      color: var(--text);
    }

    article{
      background: linear-gradient(180deg, rgba(15,23,51,.82), rgba(12,20,48,.62));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      backdrop-filter: blur(10px);
    }

    section{
      padding: 6px 0 14px;
      border-bottom: 1px dashed rgba(255,255,255,.10);
      scroll-margin-top: 70px;
    }
    section:last-child{border-bottom:none}
    h2{
      margin: 16px 0 8px;
      font-size: 1.25rem;
      letter-spacing:.2px;
    }
    h3{
      margin: 14px 0 6px;
      font-size: 1.05rem;
      color: var(--text);
    }
    p{margin: 8px 0}
    ul{margin:8px 0 8px 20px}
    li{margin: 6px 0}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px 12px 10px;
    }
    .callout{
      border-left: 4px solid var(--accent);
      padding: 10px 12px;
      background: rgba(139,233,253,.08);
      border-radius: 14px;
      border: 1px solid rgba(139,233,253,.16);
    }
    .warn{
      border-left-color: var(--warn);
      background: rgba(255,209,102,.09);
      border-color: rgba(255,209,102,.18);
    }
    .good{
      border-left-color: var(--good);
      background: rgba(124,255,155,.08);
      border-color: rgba(124,255,155,.18);
    }
    .bad{
      border-left-color: var(--bad);
      background: rgba(255,107,107,.09);
      border-color: rgba(255,107,107,.18);
    }

    .eqwrap{
      display:flex;
      align-items:stretch;
      gap:10px;
      margin:10px 0;
    }
    pre.eq{
      flex:1;
      margin:0;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      overflow:auto;
      font-family: var(--mono);
      font-size: .92rem;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    button.copy{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 10px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      min-width: 108px;
      font-weight: 650;
      letter-spacing:.2px;
    }
    button.copy:hover{
      transform: translateY(-1px);
      background: rgba(139,233,253,.10);
      border-color: rgba(139,233,253,.30);
    }
    button.copy:active{transform: translateY(0)}
    .tiny{font-size:.92rem; color: var(--muted)}
    .kpi{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: .92rem;
    }
    .pill b{color: var(--text)}
    figure{
      margin: 10px 0 0;
    }
    canvas{
      width:100%;
      height: 340px;
      display:block;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
    }
    .canvasRow{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:12px;
      align-items:start;
    }
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin: 8px 0 0;
    }
    .control{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,.04);
    }
    .control label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      margin-bottom:6px;
      color: var(--muted);
      font-size:.92rem;
    }
    input[type="range"]{width:100%}
    select{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }

    footer{
      max-width:1180px;
      margin: 0 auto;
      padding: 10px 18px 36px;
      color: var(--muted);
      font-size: .92rem;
    }

    @media (max-width: 980px){
      main{grid-template-columns: 1fr}
      nav.toc{position:relative; top:auto}
      .canvasRow{grid-template-columns:1fr}
      canvas{height: 320px}
      .controls{grid-template-columns:1fr}
      .grid2{grid-template-columns:1fr}
      .grid3{grid-template-columns:1fr}
    }

    @media print{
      body{background:#fff; color:#000}
      nav.toc{display:none}
      article, .card, .control, pre.eq{box-shadow:none; backdrop-filter:none}
      article{border:1px solid #ddd}
      canvas{border:1px solid #ddd; background:#fff}
      button.copy{display:none}
      a{color:#000}
    }

    /* Subtle entrance animation */
    @keyframes fadeUp{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0)}
    }
    article{animation: fadeUp .35s ease both}
  </style>
</head>
<body>
<header>
  <div class="title">
    <h1>Inhibited Spontaneous Emission: 2D Blackbody Radiation, Mode Density, and 2D Spontaneous-Emission Rate</h1>
    <div class="subtitle">
      We derive the <b>2D electromagnetic density of states</b>, the <b>2D Planck spectrum per unit area</b>, and then use
      <b>Fermi’s golden rule</b> to show how restricting photons to two dimensions changes the spontaneous-emission scaling
      from <span style="font-family:var(--mono)">ω³</span> (3D) to <span style="font-family:var(--mono)">ω²</span> (2D), leading to emission inhibition in slab-like cavities.
    </div>
  </div>
</header>

<main>
  <nav class="toc" aria-label="Table of contents">
    <h2>Contents <small>sticky</small></h2>
    <a href="#quick">Quick Summary</a>
    <a href="#primer">PART 0 — Concept Primer</a>
    <a href="#analysis">PART 1 — Problem Analysis</a>
    <a href="#strategy">PART 2 — Strategy & Tips</a>
    <a href="#solution">PART 3 — Full Solution</a>
    <a href="#deeper">PART 4 — Deeper Understanding</a>
    <a href="#vizguide">PART 5 — Visualization Guide</a>
  </nav>

  <article>
    <section id="quick">
      <h2>Quick Summary</h2>
      <ul>
        <li><b>Goal:</b> For a <b>two-dimensional blackbody radiator</b> (radiation constrained to a plane), find the <b>mode density</b> per area <span style="font-family:var(--mono)">M(ν)</span> and the <b>spectral energy density per area</b> <span style="font-family:var(--mono)">q(ν)</span>.</li>
        <li><b>Key idea:</b> Count electromagnetic modes in <b>k-space</b> in <b>2D</b>: the number of states is proportional to the <b>circumference</b> of a ring, not the surface area of a sphere.</li>
        <li><b>Governing relations:</b> dispersion <span style="font-family:var(--mono)">ω = c|k|</span>, quantized state counting <span style="font-family:var(--mono)">dN ∝ d²k</span>, thermal mean photon energy <span style="font-family:var(--mono)">⟨E⟩ = hν/(e^{hν/kT}-1)</span>.</li>
        <li><b>Result type:</b> symbolic formulas for <span style="font-family:var(--mono)">M(ν)</span> and <span style="font-family:var(--mono)">q(ν)</span> (2D Planck law per unit area).</li>
        <li><b>Spontaneous emission:</b> Use <b>Fermi’s golden rule</b>; in a 2D photonic environment the spontaneous-emission rate scales like <span style="font-family:var(--mono)">Γ₂D ∝ ω₀²</span> (instead of <span style="font-family:var(--mono)">ω₀³</span> in 3D), giving an inhibition factor that grows with the confinement length <span style="font-family:var(--mono)">L</span>.</li>
        <li><b>Interactive plots:</b> Explore how temperature shifts the 2D spectrum and how cavity thickness controls inhibition vs transition frequency.</li>
      </ul>
    </section>

    <section id="primer">
      <h2>PART 0 — Concept Primer (THEORY BEFORE SOLVING)</h2>

      <div class="grid2">
        <div class="card">
          <h3>Core definitions (symbols & units)</h3>
          <ul>
            <li><b>Frequency</b> <span style="font-family:var(--mono)">ν</span> (Hz), angular frequency <span style="font-family:var(--mono)">ω = 2πν</span> (rad/s)</li>
            <li><b>Wavevector</b> <span style="font-family:var(--mono)">k</span> (1/m), magnitude <span style="font-family:var(--mono)">|k| = k</span></li>
            <li><b>Speed of light</b> <span style="font-family:var(--mono)">c</span> (m/s)</li>
            <li><b>Mode density per area</b> <span style="font-family:var(--mono)">M(ν)</span>: modes / (m²·Hz)</li>
            <li><b>Spectral energy density per area</b> <span style="font-family:var(--mono)">q(ν)</span>: J / (m²·Hz)</li>
            <li><b>Thermal energy scale</b> <span style="font-family:var(--mono)">k_B T</span> (J)</li>
            <li><b>Photon energy</b> <span style="font-family:var(--mono)">hν = ħω</span> (J)</li>
          </ul>
        </div>

        <div class="card">
          <h3>Physical meaning</h3>
          <ul>
            <li><span style="font-family:var(--mono)">M(ν)dν</span> tells you how many electromagnetic standing-wave patterns (per area) exist with frequencies between <span style="font-family:var(--mono)">ν</span> and <span style="font-family:var(--mono)">ν+dν</span>.</li>
            <li><span style="font-family:var(--mono)">q(ν)dν</span> is the thermal electromagnetic energy (per area) stored in those modes in equilibrium.</li>
            <li><b>“2D radiation”</b> means photons can only have in-plane momentum components: the allowed <span style="font-family:var(--mono)">k</span>-states form a <b>2D plane</b>, not 3D space.</li>
          </ul>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <h3>Key principles & validity</h3>
          <ul>
            <li><b>Mode counting in k-space:</b> In d dimensions, the number of modes in a thin shell scales like the “surface area” of a d-dimensional sphere.</li>
            <li><b>Thermal equilibrium (Planck/Bose-Einstein):</b> photon occupation number
              <span style="font-family:var(--mono)">n̄(ν) = 1/(e^{hν/k_BT}-1)</span>.</li>
            <li><b>Assumptions:</b> linear, isotropic medium (vacuum/air), negligible dispersion and absorption inside the cavity region used for counting, large-area limit so we can treat k-states as quasi-continuous.</li>
          </ul>
        </div>

        <div class="card">
          <h3>Common models/approximations (and why)</h3>
          <ul>
            <li><b>Periodic boundary conditions</b> on a large area <span style="font-family:var(--mono)">A</span> to discretize k-states, then take <span style="font-family:var(--mono)">A → ∞</span> so sums become integrals.</li>
            <li><b>Free-space dispersion</b> in-plane: <span style="font-family:var(--mono)">ω = ck</span> (good when the slab supports near-lightline modes).</li>
            <li><b>Two polarizations</b> (TE-like, TM-like) for electromagnetic waves in a slab: we include a polarization degeneracy factor <span style="font-family:var(--mono)">g_p</span> (often 2).</li>
          </ul>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <h3>Mini intuition examples</h3>
          <ul>
            <li><b>Why the spectrum changes:</b> In 3D, the number of modes grows like <span style="font-family:var(--mono)">ν²</span>, but in 2D it grows like <span style="font-family:var(--mono)">ν</span>. Multiply by photon energy (~<span style="font-family:var(--mono)">ν</span>) and you get <span style="font-family:var(--mono)">q(ν) ∝ ν²</span> (2D) vs <span style="font-family:var(--mono)">q(ν) ∝ ν³</span> (3D) at low occupancy cutoffs.</li>
            <li><b>Why emission can be inhibited:</b> Spontaneous emission needs available photon final states. Fewer states (lower density of states) ⇒ smaller emission rate.</li>
          </ul>
        </div>

        <div class="callout warn">
          <h3>What to watch for (pitfalls)</h3>
          <ul>
            <li>Mixing <span style="font-family:var(--mono)">M(ν)</span> (per Hz) with <span style="font-family:var(--mono)">ρ(ω)</span> (per rad/s) without the factor <span style="font-family:var(--mono)">dν = dω/(2π)</span>.</li>
            <li>Forgetting polarization degeneracy <span style="font-family:var(--mono)">g_p</span> (or using the wrong value for a specific cavity).</li>
            <li>Confusing “energy density” per volume (3D) with per area (2D). Here everything is <b>per unit area</b>.</li>
            <li>In spontaneous emission, the density of states must be per <b>energy</b> when used in Fermi’s golden rule (brings in an extra <span style="font-family:var(--mono)">1/ħ</span>).</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="analysis">
      <h2>PART 1 — Problem Analysis (no solving yet)</h2>

      <h3>Problem restatement</h3>
      <p>
        We have a <b>two-dimensional blackbody radiator</b> (a plate of area <span style="font-family:var(--mono)">A</span>) in thermal equilibrium at temperature <span style="font-family:var(--mono)">T</span>.
      </p>
      <ol>
        <li>(a) Find the <b>density of electromagnetic modes</b> per unit area <span style="font-family:var(--mono)">M(ν)</span> and the <b>spectral energy density per unit area</b> <span style="font-family:var(--mono)">q(ν)</span> so that <span style="font-family:var(--mono)">q(ν)dν</span> is the energy (per area) between <span style="font-family:var(--mono)">ν</span> and <span style="font-family:var(--mono)">ν+dν</span>.</li>
        <li>(b) Using the 2D photonic environment (cavity that only allows propagation in 2D), find the <b>probability density / rate</b> for <b>spontaneous emission</b> of an atom in that cavity (i.e., how spontaneous emission depends on the 2D density of states).</li>
      </ol>

      <div class="grid2">
        <div class="card">
          <h3>Given quantities</h3>
          <ul>
            <li>Temperature: <span style="font-family:var(--mono)">T</span></li>
            <li>Plate area: <span style="font-family:var(--mono)">A</span> (large)</li>
            <li>Radiation restricted to <b>2D</b> (in-plane wavevectors)</li>
            <li>Fundamental constants: <span style="font-family:var(--mono)">c, h, ħ, k_B, ε₀</span></li>
          </ul>
        </div>
        <div class="card">
          <h3>Unknowns</h3>
          <ul>
            <li><span style="font-family:var(--mono)">M(ν)</span> modes / (m²·Hz)</li>
            <li><span style="font-family:var(--mono)">q(ν)</span> J / (m²·Hz)</li>
            <li>2D spontaneous emission rate (or spectral probability density) in terms of the 2D density of states</li>
          </ul>
        </div>
      </div>

      <h3>Relevant physical principles (and why they apply)</h3>
      <ul>
        <li><b>k-space mode counting:</b> In a large quantization area, allowed k-values form a grid; counting states in an annulus gives the density of modes.</li>
        <li><b>Bose-Einstein statistics for photons:</b> Photons in thermal equilibrium have mean occupation <span style="font-family:var(--mono)">n̄ = 1/(e^{hν/k_BT}-1)</span>.</li>
        <li><b>Fermi’s golden rule:</b> Spontaneous emission is a transition from an excited atom to a lower state + one photon; the rate is proportional to the photonic density of final states.</li>
      </ul>
      <p class="tiny">
        We do <b>not</b> need ray optics or Stefan–Boltzmann laws here (those are for integrated flux, and typically 3D). This problem is about <b>mode density and spectral distributions</b> in 2D.
      </p>

      <div class="callout">
        <b>Assumptions (explicit)</b>
        <ul>
          <li>Large-area limit: sums over modes → integrals over k-space.</li>
          <li>Free-space-like in-plane dispersion: <span style="font-family:var(--mono)">ω = c k</span>.</li>
          <li>Polarization degeneracy included via <span style="font-family:var(--mono)">g_p</span> (use <span style="font-family:var(--mono)">g_p=2</span> for two independent polarizations unless the cavity enforces a single polarization).</li>
          <li>For (b), cavity confines the field in the transverse direction to an effective thickness <span style="font-family:var(--mono)">L</span> so the mode “volume” is <span style="font-family:var(--mono)">V_eff ≈ A L</span>.</li>
        </ul>
      </div>

      <h3>Possible approaches (compare)</h3>
      <div class="grid3">
        <div class="card">
          <h3>Approach 1: Direct k-space counting</h3>
          <p class="tiny">Count states in an annulus in 2D k-space; convert k→ν.</p>
          <p><b>Pros:</b> clean, generalizable to any dimension.</p>
          <p><b>Cons:</b> must track degeneracy and 2π factors carefully.</p>
        </div>
        <div class="card">
          <h3>Approach 2: Start from known 3D DOS and “reduce” dimension</h3>
          <p class="tiny">Constrain one k-component and integrate it out.</p>
          <p><b>Pros:</b> intuitive connection to 3D.</p>
          <p><b>Cons:</b> easy to mishandle boundary conditions and normalization.</p>
        </div>
        <div class="card">
          <h3>Approach 3: Use general d-dimensional DOS formula</h3>
          <p class="tiny">Plug d=2 into a known general expression.</p>
          <p><b>Pros:</b> fastest if memorized.</p>
          <p><b>Cons:</b> less educational; still need thermal factor.</p>
        </div>
      </div>

      <p><b>Choice:</b> We use <b>Approach 1</b> (direct k-space counting) because it’s transparent and keeps all factors under control.</p>
    </section>

    <section id="strategy">
      <h2>PART 2 — Strategy & Tips (roadmap only)</h2>
      <ol>
        <li><b>Quantize the field in a large area</b> <span style="font-family:var(--mono)">A</span>: allowed k-states form a 2D grid. <span class="tiny">(Tool: periodic boundary conditions)</span></li>
        <li><b>Count states in a thin annulus</b> between <span style="font-family:var(--mono)">k</span> and <span style="font-family:var(--mono)">k+dk</span>. <span class="tiny">(Tool: area of annulus = 2πk dk)</span></li>
        <li><b>Divide by state area</b> in k-space <span style="font-family:var(--mono)">(2π/A)²</span> and include polarization factor <span style="font-family:var(--mono)">g_p</span> to get <span style="font-family:var(--mono)">M(k)</span> per area.</li>
        <li><b>Convert</b> <span style="font-family:var(--mono)">k → ν</span> using <span style="font-family:var(--mono)">ω=ck</span> and <span style="font-family:var(--mono)">ν=ω/(2π)</span>.</li>
        <li><b>Multiply by thermal mean energy per mode</b> <span style="font-family:var(--mono)">⟨E⟩ = hν/(e^{hν/k_BT}-1)</span> to obtain <span style="font-family:var(--mono)">q(ν)</span>.</li>
        <li><b>For spontaneous emission:</b> write Fermi’s golden rule for <span style="font-family:var(--mono)">|e,0⟩ → |g,1_k⟩</span>.</li>
        <li><b>Use field quantization</b> with effective volume <span style="font-family:var(--mono)">V_eff ≈ AL</span> to get the matrix element scaling with <span style="font-family:var(--mono)">√(ħω)</span>.</li>
        <li><b>Insert 2D density of states</b> <span style="font-family:var(--mono)">ρ₂D(ω)</span> (modes per rad/s) and convert to density per energy (brings <span style="font-family:var(--mono)">1/ħ</span>).</li>
        <li><b>Simplify</b> to a closed form <span style="font-family:var(--mono)">Γ₂D(ω₀)</span>, compare scaling to 3D.</li>
      </ol>

      <div class="callout warn">
        <b>Common mistakes + quick tips</b>
        <ul>
          <li><b>Tip:</b> Decide early whether you’re using <span style="font-family:var(--mono)">ν</span> or <span style="font-family:var(--mono)">ω</span>. Only convert at the end if possible.</li>
          <li><b>Tip:</b> Keep track of whether a density of states is “per area” or “total”. You usually want per area for (a), but total DOS for FGR in (b).</li>
          <li><b>Mistake:</b> Using <span style="font-family:var(--mono)">ρ(ω)</span> directly in FGR without converting to density per energy.</li>
        </ul>
      </div>
    </section>

    <section id="solution">
      <h2>PART 3 — Full Solution (DETAILED + TEACHING)</h2>

      <h3>Physical intuition first</h3>
      <p>
        In 3D, the number of electromagnetic modes grows rapidly with frequency because k-space shells are spheres with area ~<span style="font-family:var(--mono)">k²</span>.
        In 2D, k-space shells are <b>circles</b> with circumference ~<span style="font-family:var(--mono)">k</span>. So we expect:
      </p>
      <ul>
        <li><b>2D DOS:</b> <span style="font-family:var(--mono)">M(ν) ∝ ν</span></li>
        <li><b>2D Planck spectrum per area:</b> <span style="font-family:var(--mono)">q(ν) ∝ ν² / (e^{hν/kT}-1)</span></li>
        <li><b>2D spontaneous emission:</b> since <span style="font-family:var(--mono)">Γ ∝ DOS × field-strength²</span>, we will get <span style="font-family:var(--mono)">Γ₂D ∝ ω₀²</span>.</li>
      </ul>

      <h3>(a) Density of modes <span style="font-family:var(--mono)">M(ν)</span> and spectral energy density <span style="font-family:var(--mono)">q(ν)</span> in 2D</h3>

      <div class="card">
        <p><b>Step 1: Quantize k-states in a large 2D area</b></p>
        <p>
          Impose periodic boundary conditions on a square of area <span style="font-family:var(--mono)">A = L_x L_y</span>.
          Then the allowed wavevectors are
          <span style="font-family:var(--mono)">k_x = 2π n_x / L_x</span>, <span style="font-family:var(--mono)">k_y = 2π n_y / L_y</span>.
        </p>
        <p>
          Each state occupies a k-space “cell area”
          <span style="font-family:var(--mono)">Δk_x Δk_y = (2π/L_x)(2π/L_y) = (2π)² / A</span>.
        </p>
        <p class="tiny">Meaning: one mode per area <span style="font-family:var(--mono)">(2π)²/A</span> in 2D k-space.</p>
      </div>

      <div class="card">
        <p><b>Step 2: Count states in an annulus between</b> <span style="font-family:var(--mono)">k</span> and <span style="font-family:var(--mono)">k+dk</span></p>
        <p>
          In 2D, the set of vectors with magnitude between <span style="font-family:var(--mono)">k</span> and <span style="font-family:var(--mono)">k+dk</span> forms an annulus of area:
        </p>
        <div class="eqwrap">
          <pre class="eq" id="eq_annulus">Area in k-space annulus:  dA_k = 2π k dk</pre>
          <button class="copy" data-copy="Area in k-space annulus:  dA_k = 2π k dk">Copy</button>
        </div>
        <p>
          Number of modes in that annulus (for one polarization) is:
          <span style="font-family:var(--mono)">dN = dA_k / ((2π)²/A) = A (2π k dk)/(2π)² = A (k dk)/(2π)</span>.
        </p>
        <p>
          Including polarization degeneracy <span style="font-family:var(--mono)">g_p</span> (typically 2):
          <span style="font-family:var(--mono)">dN = g_p A (k dk)/(2π)</span>.
        </p>
      </div>

      <div class="card">
        <p><b>Step 3: Convert to mode density per unit area per frequency</b></p>
        <p>
          Divide by area <span style="font-family:var(--mono)">A</span> to get modes per area:
          <span style="font-family:var(--mono)">dN/A = g_p (k dk)/(2π)</span>.
        </p>
        <p>
          Use dispersion <span style="font-family:var(--mono)">ω = ck</span> and <span style="font-family:var(--mono)">ω = 2πν</span>.
          Then
          <span style="font-family:var(--mono)">k = ω/c = 2πν/c</span>,
          and
          <span style="font-family:var(--mono)">dk = (2π/c) dν</span>.
        </p>

        <div class="eqwrap">
          <pre class="eq" id="eq_Mnu">Mode density per area per Hz (2D):
M(ν) = (dN/A)/dν = g_p * (2π ν / c²)</pre>
          <button class="copy" data-copy="Mode density per area per Hz (2D): M(ν) = g_p * (2π ν / c²)">Copy</button>
        </div>

        <p class="tiny">
          If <span style="font-family:var(--mono)">g_p = 2</span> (two polarizations), then
          <span style="font-family:var(--mono)">M(ν) = (4π ν / c²)</span>.
        </p>
      </div>

      <div class="callout good">
        <b>Sanity check (units)</b>
        <ul>
          <li><span style="font-family:var(--mono)">ν</span> has units s⁻¹, <span style="font-family:var(--mono)">c²</span> has (m/s)² = m²/s², so <span style="font-family:var(--mono)">ν/c²</span> has units (s⁻¹)/(m²/s²) = s/m².</li>
          <li>Thus <span style="font-family:var(--mono)">M(ν)</span> has units s/m² = 1/(m²·Hz). Correct.</li>
        </ul>
      </div>

      <div class="card">
        <p><b>Step 4: Multiply by thermal mean energy per mode to get</b> <span style="font-family:var(--mono)">q(ν)</span></p>
        <p>
          In thermal equilibrium, the mean photon number per mode is:
          <span style="font-family:var(--mono)">n̄(ν) = 1/(e^{hν/(k_BT)} - 1)</span>.
        </p>
        <p>
          Ignoring the vacuum (zero-point) energy (which does not contribute to thermal radiation exchange),
          the mean energy per mode is:
          <span style="font-family:var(--mono)">⟨E⟩ = hν n̄(ν) = hν/(e^{hν/(k_BT)} - 1)</span>.
        </p>

        <div class="eqwrap">
          <pre class="eq" id="eq_qnu">2D spectral energy density per unit area:
q(ν) = M(ν) ⟨E⟩
     = g_p * (2π ν / c²) * (hν / (e^{hν/(k_BT)} - 1))
     = g_p * (2π h ν² / c²) / (e^{hν/(k_BT)} - 1)</pre>
          <button class="copy" data-copy="2D spectral energy density per unit area: q(ν) = g_p * (2π h ν² / c²) / (e^{hν/(k_BT)} - 1)">Copy</button>
        </div>

        <p class="tiny">
          For <span style="font-family:var(--mono)">g_p=2</span>:
          <span style="font-family:var(--mono)">q(ν) = (4π h ν² / c²) / (e^{hν/(k_BT)} - 1)</span>.
        </p>
      </div>

      <div class="callout">
        <b>Interpretation</b>
        <p>
          Compared to the usual 3D Planck spectrum (which has a <span style="font-family:var(--mono)">ν³</span> prefactor),
          the 2D spectrum has a <span style="font-family:var(--mono)">ν²</span> prefactor because the 2D density of states grows only linearly with <span style="font-family:var(--mono)">ν</span>.
        </p>
      </div>

      <h3>(b) Spontaneous emission probability density (rate) in a 2D cavity</h3>

      <p>
        An excited atom with transition angular frequency <span style="font-family:var(--mono)">ω₀</span> can decay by emitting a photon into an available electromagnetic mode.
        The spontaneous emission rate follows from Fermi’s golden rule:
      </p>

      <div class="eqwrap">
        <pre class="eq" id="eq_FGR">Fermi's golden rule (for emission):
Γ_sp = (2π/ħ) |V_if|² ρ_E(E_f)

where ρ_E is the density of final states per unit energy.</pre>
        <button class="copy" data-copy="Fermi's golden rule (for emission): Γ_sp = (2π/ħ) |V_if|² ρ_E(E_f), where ρ_E is the density of final states per unit energy.">Copy</button>
      </div>

      <div class="card">
        <p><b>Step 1: Matrix element for dipole emission</b></p>
        <p>
          Use the electric dipole interaction <span style="font-family:var(--mono)">H_int = - d · E</span>,
          with transition dipole moment <span style="font-family:var(--mono)">d</span>.
        </p>
        <p>
          For a single photon in a mode with effective volume <span style="font-family:var(--mono)">V_eff ≈ A L</span>,
          the (rms) electric-field amplitude scales as:
        </p>
        <div class="eqwrap">
          <pre class="eq" id="eq_E0">Single-photon field scale:
E_1 = sqrt( ħ ω / (2 ε₀ V_eff) )  ≈ sqrt( ħ ω / (2 ε₀ A L) )</pre>
          <button class="copy" data-copy="Single-photon field scale: E_1 = sqrt( ħ ω / (2 ε₀ V_eff) )  ≈ sqrt( ħ ω / (2 ε₀ A L) )">Copy</button>
        </div>
        <p>
          Then a typical squared matrix element is
          <span style="font-family:var(--mono)">|V_if|² = |d·e|² E_1² = |d·e|² (ħω)/(2ε₀AL)</span>,
          where <span style="font-family:var(--mono)">e</span> is the polarization unit vector.
        </p>
        <p class="tiny">
          We keep <span style="font-family:var(--mono)">|d·e|²</span> to allow orientation dependence.
          For random orientations in a plane you can replace it by an average (order-unity factor).
        </p>
      </div>

      <div class="card">
        <p><b>Step 2: 2D photonic density of states</b></p>
        <p>
          From part (a), the number of modes per area per Hz is
          <span style="font-family:var(--mono)">M(ν) = g_p (2πν/c²)</span>.
          Convert to angular frequency:
        </p>
        <p>
          Since <span style="font-family:var(--mono)">ν = ω/(2π)</span>, we have
          <span style="font-family:var(--mono)">M(ν) = g_p (ω/c²)</span>.
        </p>
        <p>
          But FGR is easiest using the density per rad/s:
          <span style="font-family:var(--mono)">ρ₂D(ω) = dN/dω</span>.
          Because <span style="font-family:var(--mono)">dν = dω/(2π)</span>,
        </p>

        <div class="eqwrap">
          <pre class="eq" id="eq_rhoomega">2D DOS per area per rad/s:
(1/A) dN/dω = M(ν) (dν/dω)
           = [g_p (ω/c²)] * (1/(2π))
           = g_p * ω / (2π c²)

So total DOS (area A):  ρ₂D(ω) = dN/dω = A g_p ω / (2π c²)</pre>
          <button class="copy" data-copy="2D DOS per area per rad/s: (1/A) dN/dω = g_p * ω / (2π c²). Total DOS: ρ₂D(ω)=A g_p ω/(2π c²).">Copy</button>
        </div>

        <p>
          FGR needs density per <b>energy</b>:
          <span style="font-family:var(--mono)">E = ħω ⇒ dE = ħ dω</span>,
          so <span style="font-family:var(--mono)">ρ_E = dN/dE = (dN/dω)/(ħ) = ρ₂D(ω)/ħ</span>.
        </p>
      </div>

      <div class="card">
        <p><b>Step 3: Assemble Fermi’s golden rule at</b> <span style="font-family:var(--mono)">ω = ω₀</span></p>
        <p>
          Insert
          <span style="font-family:var(--mono)">|V_if|² = |d·e|² (ħω)/(2ε₀AL)</span>
          and
          <span style="font-family:var(--mono)">ρ_E = ρ₂D(ω)/ħ = [A g_p ω/(2π c²)]/ħ</span>
          into
          <span style="font-family:var(--mono)">Γ_sp = (2π/ħ)|V_if|² ρ_E</span>.
        </p>

        <p><b>Compute step-by-step (no jumps):</b></p>
        <ul>
          <li><span style="font-family:var(--mono)">Γ_sp = (2π/ħ) · |d·e|² (ħω)/(2ε₀AL) · (1/ħ) · [A g_p ω/(2π c²)]</span></li>
          <li>Cancel <span style="font-family:var(--mono)">A</span> (good: the rate should not depend on the arbitrary quantization area).</li>
          <li>Cancel <span style="font-family:var(--mono)">2π</span>, and simplify <span style="font-family:var(--mono)">ħ</span> factors: one <span style="font-family:var(--mono)">ħ</span> remains in the denominator.</li>
        </ul>

        <div class="eqwrap">
          <pre class="eq" id="eq_Gamma2D">Spontaneous emission rate in a 2D photonic environment (effective thickness L):
Γ₂D(ω₀) = (g_p |d·e|² ω₀²) / (2 ε₀ ħ c² L)</pre>
          <button class="copy" data-copy="Spontaneous emission rate in a 2D photonic environment: Γ₂D(ω₀) = (g_p |d·e|² ω₀²) / (2 ε₀ ħ c² L)">Copy</button>
        </div>

        <div class="callout good">
          <b>Key takeaway:</b> In 2D, <span style="font-family:var(--mono)">Γ₂D ∝ ω₀²</span>, not <span style="font-family:var(--mono)">ω₀³</span>. Restricting photons to 2D reduces the available final states and can inhibit emission.
        </div>
      </div>

      <div class="callout warn">
        <b>About “probability density”</b>
        <p>
          Spontaneous emission from an ideal two-level atom is sharply peaked at the transition frequency.
          A convenient “spectral probability density” representation is:
        </p>
        <div class="eqwrap">
          <pre class="eq" id="eq_Pnu">Spectral emission probability density (idealized line):
P_sp(ν) = Γ₂D(ω₀) · δ(ν - ν₀)

where ν₀ = ω₀/(2π)</pre>
          <button class="copy" data-copy="Spectral emission probability density (idealized line): P_sp(ν) = Γ₂D(ω₀) · δ(ν - ν₀), where ν₀ = ω₀/(2π)">Copy</button>
        </div>
        <p class="tiny">
          Real atoms have linewidths; then the delta function is replaced by a normalized lineshape (Lorentzian, etc.).
          The <b>overall rate</b> is still set by <span style="font-family:var(--mono)">Γ₂D</span>.
        </p>
      </div>

      <h3>Sanity checks</h3>
      <div class="grid2">
        <div class="callout good">
          <b>Dimensional check (rate)</b>
          <p class="tiny">
            <span style="font-family:var(--mono)">|d|²/ε₀</span> has units of J·m³, dividing by <span style="font-family:var(--mono)">ħ</span> gives (m³/s),
            multiplying by <span style="font-family:var(--mono)">ω₀²/(c² L)</span> gives 1/s. Good.
          </p>
        </div>
        <div class="callout">
          <b>Limiting behavior</b>
          <ul>
            <li><span style="font-family:var(--mono)">L</span> larger ⇒ weaker field per photon ⇒ smaller <span style="font-family:var(--mono)">Γ₂D</span> (inhibition).</li>
            <li>Higher frequency ⇒ larger <span style="font-family:var(--mono)">Γ₂D</span> as <span style="font-family:var(--mono)">ω₀²</span>.</li>
          </ul>
        </div>
      </div>

      <div class="callout bad">
        <b>FINAL ANSWERS (boxed)</b>
        <div class="eqwrap">
          <pre class="eq" id="eq_final">Part (a):
M(ν) = g_p * (2π ν / c²)    [modes / (m²·Hz)]
q(ν) = g_p * (2π h ν² / c²) / (e^{hν/(k_BT)} - 1)   [J / (m²·Hz)]

(For two polarizations: g_p = 2 ⇒ M(ν) = 4πν/c² and q(ν) = (4π h ν²/c²)/(e^{hν/k_BT}-1))

Part (b):
Γ₂D(ω₀) = (g_p |d·e|² ω₀²) / (2 ε₀ ħ c² L)
and an idealized spectral probability density:  P_sp(ν)=Γ₂D(ω₀) δ(ν-ν₀),  ν₀=ω₀/(2π)</pre>
          <button class="copy" data-copy="Part (a): M(ν) = g_p * (2π ν / c²);  q(ν) = g_p * (2π h ν² / c²) / (exp(hν/(k_BT)) - 1).  Part (b): Γ₂D(ω₀) = (g_p |d·e|² ω₀²) / (2 ε₀ ħ c² L);  P_sp(ν)=Γ₂D(ω₀) δ(ν-ν₀), ν₀=ω₀/(2π).">Copy</button>
        </div>
      </div>

      <h3>Connect to the diagram & plots</h3>
      <p>
        The diagram below shows a slab-like cavity with reflectors above and below, forcing the photon momentum to lie in the plane.
        In k-space that means allowed states fill a <b>2D plane</b>, so shells are <b>rings</b> (circumference ∝ k), producing <span style="font-family:var(--mono)">M(ν) ∝ ν</span>.
        The plots visualize the resulting <b>2D Planck spectrum</b> and the <b>inhibition factor</b> of spontaneous emission as you vary temperature and cavity thickness.
      </p>

      <figure class="card">
        <div class="controls" aria-label="Interactive controls">
          <div class="control">
            <label for="Tslider">
              Temperature <span class="tiny">(example for plotting)</span>
              <span class="pill"><b id="Tread">900</b> K</span>
            </label>
            <input id="Tslider" type="range" min="200" max="3000" step="10" value="900" />
            <div class="tiny">Changes the thermal spectrum <span style="font-family:var(--mono)">q(ν)</span> (2D and 3D shown for comparison).</div>
          </div>
          <div class="control">
            <label for="Lslider">
              Cavity thickness <span class="tiny">(effective)</span>
              <span class="pill"><b id="Lread">250</b> nm</span>
            </label>
            <input id="Lslider" type="range" min="50" max="2000" step="10" value="250" />
            <div class="tiny">Controls <span style="font-family:var(--mono)">Γ₂D ∝ 1/L</span> and inhibition vs 3D emission.</div>
          </div>
          <div class="control">
            <label for="nu0slider">
              Atom transition frequency <span class="tiny">(example)</span>
              <span class="pill"><b id="nu0read">500</b> THz</span>
            </label>
            <input id="nu0slider" type="range" min="100" max="900" step="5" value="500" />
            <div class="tiny">Moves the vertical marker and changes <span style="font-family:var(--mono)">Γ₂D(ω₀)</span>.</div>
          </div>
          <div class="control">
            <label for="polSelect">
              Polarization factor <span class="tiny">g_p</span>
              <span class="pill"><b id="gpread">2</b></span>
            </label>
            <select id="polSelect">
              <option value="2" selected>g_p = 2 (two polarizations)</option>
              <option value="1">g_p = 1 (single polarization)</option>
            </select>
            <div class="tiny">If the cavity supports only one polarization, the DOS and rates halve.</div>
          </div>
        </div>

        <div class="canvasRow" style="margin-top:12px;">
          <div>
            <canvas id="diagCanvas" aria-label="Diagram: 2D cavity geometry"></canvas>
            <div class="tiny" style="margin-top:6px;">
              Diagram: slab cavity with top/bottom reflectors ⇒ photons propagate in-plane (2D k-space).
            </div>
          </div>
          <div>
            <canvas id="plot2Canvas" aria-label="Secondary plot: Inhibition factor vs frequency"></canvas>
            <div class="tiny" style="margin-top:6px;">
              Secondary plot: inhibition factor <span style="font-family:var(--mono)">Γ₂D/Γ₃D</span> vs frequency, with your chosen <span style="font-family:var(--mono)">ν₀</span> marker.
            </div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <canvas id="plot1Canvas" aria-label="Main plot: 2D Planck spectrum per area"></canvas>
          <div class="tiny" style="margin-top:6px;">
            Main plot: <span style="font-family:var(--mono)">q(ν)</span> (2D) vs <span style="font-family:var(--mono)">ν</span>; also shows the 3D Planck spectrum (scaled) for shape comparison.
          </div>
        </div>

        <div class="kpi">
          <div class="pill">Example constants used in plots: <b>c</b>=299792458 m/s, <b>h</b>=6.626e−34 J·s, <b>k<sub>B</sub></b>=1.381e−23 J/K</div>
          <div class="pill">2D spectrum shown per area: <b>q(ν)</b> in J/(m²·Hz)</div>
          <div class="pill">Spontaneous emission shown via ratio using standard 3D free-space formula (orientation-averaged) for comparison</div>
        </div>
      </figure>
    </section>

    <section id="deeper">
      <h2>PART 4 — Deeper Understanding (THEORY AROUND THE RESULT)</h2>

      <h3>Re-interpreting the formulas</h3>
      <div class="grid2">
        <div class="card">
          <h3>What controls <span style="font-family:var(--mono)">M(ν)</span> in 2D?</h3>
          <ul>
            <li><b>Geometry of k-space:</b> ring circumference <span style="font-family:var(--mono)">2πk</span> ⇒ DOS grows linearly with <span style="font-family:var(--mono)">k</span> and thus with <span style="font-family:var(--mono)">ν</span>.</li>
            <li><b>Polarizations:</b> <span style="font-family:var(--mono)">g_p</span> multiplies the count.</li>
            <li><b>Light speed:</b> <span style="font-family:var(--mono)">1/c²</span> appears because frequency spacing is set by the dispersion <span style="font-family:var(--mono)">ω=ck</span>.</li>
          </ul>
        </div>
        <div class="card">
          <h3>What controls <span style="font-family:var(--mono)">Γ₂D</span>?</h3>
          <ul>
            <li><b>Density of states:</b> in 2D, <span style="font-family:var(--mono)">ρ₂D(ω) ∝ ω</span>.</li>
            <li><b>Field per photon:</b> <span style="font-family:var(--mono)">E_1² ∝ ω/(AL)</span> so tighter vertical confinement (smaller <span style="font-family:var(--mono)">L</span>) strengthens coupling.</li>
            <li><b>Dipole orientation:</b> enters through <span style="font-family:var(--mono)">|d·e|²</span>.</li>
          </ul>
        </div>
      </div>

      <h3>How changing parameters affects outcomes (connect to plots)</h3>
      <ul>
        <li><b>Increase T:</b> the peak of <span style="font-family:var(--mono)">q(ν)</span> shifts to higher frequencies and the spectrum grows in magnitude (more thermal photons).</li>
        <li><b>Increase L:</b> reduces <span style="font-family:var(--mono)">Γ₂D</span> as <span style="font-family:var(--mono)">1/L</span> (stronger inhibition for thicker effective slabs).</li>
        <li><b>Increase ν₀:</b> increases <span style="font-family:var(--mono)">Γ₂D</span> like <span style="font-family:var(--mono)">ν₀²</span> (or <span style="font-family:var(--mono)">ω₀²</span>).</li>
        <li><b>Switch g_p=1:</b> halves both the 2D spectrum and the emission rate.</li>
      </ul>

      <h3>Alternative derivation idea (brief)</h3>
      <p>
        Instead of direct k-space counting, you can start from the <b>3D DOS</b> and impose strong confinement in <span style="font-family:var(--mono)">z</span>
        so only one transverse mode (one allowed <span style="font-family:var(--mono)">k_z</span>) remains. Then integrate/sum over the remaining in-plane components.
        The result again yields <span style="font-family:var(--mono)">ρ₂D(ω) ∝ ω</span>.
      </p>

      <h3>Concept checks (quick Q&A)</h3>
      <ul>
        <li><b>Q:</b> Why does 2D change the Planck prefactor from <span style="font-family:var(--mono)">ν³</span> to <span style="font-family:var(--mono)">ν²</span>?<br/>
            <b>A:</b> Because the DOS changes from scaling like <span style="font-family:var(--mono)">ν²</span> (3D) to scaling like <span style="font-family:var(--mono)">ν</span> (2D); multiply by photon energy (~<span style="font-family:var(--mono)">ν</span>).</li>
        <li><b>Q:</b> Where does the <span style="font-family:var(--mono)">1/L</span> in <span style="font-family:var(--mono)">Γ₂D</span> come from?<br/>
            <b>A:</b> From field normalization: a single photon’s energy is spread over volume <span style="font-family:var(--mono)">AL</span>, so <span style="font-family:var(--mono)">E_1² ∝ 1/(AL)</span>.</li>
        <li><b>Q:</b> Does smaller DOS always mean smaller spontaneous emission?<br/>
            <b>A:</b> Generally yes in weak coupling: <span style="font-family:var(--mono)">Γ ∝ DOS</span>. But cavities can also create sharp resonances that enhance emission at selected frequencies (Purcell effect).</li>
        <li><b>Q:</b> If the cavity allowed only one polarization, what happens?<br/>
            <b>A:</b> Replace <span style="font-family:var(--mono)">g_p=2</span> by <span style="font-family:var(--mono)">g_p=1</span>: spectra and rates halve.</li>
      </ul>
    </section>

    <section id="vizguide">
      <h2>PART 5 — Visualization Guide (HOW TO READ THE PLOTS)</h2>

      <div class="grid2">
        <div class="card">
          <h3>Diagram canvas</h3>
          <ul>
            <li>Shows a slab between two reflectors (top/bottom) to enforce <b>2D photon motion</b>.</li>
            <li>Atom placed inside emits into <b>in-plane</b> modes with wavevector <span style="font-family:var(--mono)">k∥</span>.</li>
            <li>Labels indicate <span style="font-family:var(--mono)">L</span> (effective thickness), and a ring in k-space emphasizes 2D counting.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Main quantitative plot</h3>
          <ul>
            <li>Plots <span style="font-family:var(--mono)">q₂D(ν)</span> vs <span style="font-family:var(--mono)">ν</span> using the derived formula (per unit area).</li>
            <li>Also overlays a <span style="font-family:var(--mono)">q₃D(ν)</span> curve <i>scaled</i> for shape comparison (so you can see the different low-frequency power laws).</li>
            <li>Vertical marker at <span style="font-family:var(--mono)">ν₀</span> shows where an atom would emit/absorb.</li>
          </ul>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <h3>Secondary plot (parameter sweep)</h3>
          <ul>
            <li>Shows inhibition factor <span style="font-family:var(--mono)">R(ν)=Γ₂D/Γ₃D</span> vs frequency (using standard 3D free-space reference).</li>
            <li>Demonstrates that for fixed <span style="font-family:var(--mono)">L</span>, the ratio typically decreases with frequency like ~<span style="font-family:var(--mono)">1/ν</span> (because 2D scales as <span style="font-family:var(--mono)">ω²</span> while 3D scales as <span style="font-family:var(--mono)">ω³</span>).</li>
            <li>Marker at <span style="font-family:var(--mono)">ν₀</span> reads the ratio at the chosen atomic transition.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Interactive controls</h3>
          <ul>
            <li><b>Temperature T:</b> updates the spectrum magnitude and peak position in the main plot.</li>
            <li><b>Thickness L:</b> updates inhibition ratio in the secondary plot (<span style="font-family:var(--mono)">Γ₂D ∝ 1/L</span>).</li>
            <li><b>Transition frequency ν₀:</b> moves the marker and changes the computed <span style="font-family:var(--mono)">Γ₂D(ω₀)</span> and ratio at that point.</li>
            <li><b>Polarization g_p:</b> scales DOS, spectrum, and rate linearly.</li>
          </ul>
        </div>
      </div>
    </section>
  </article>
</main>

<footer>
  Built as a self-contained learning article (vanilla HTML/CSS/JS). Equations are copyable; plots are interactive and responsive.
</footer>

<script>
/* ---------- Copy buttons ---------- */
(function(){
  const buttons = document.querySelectorAll('button.copy');
  buttons.forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const txt = btn.getAttribute('data-copy') || '';
      try{
        await navigator.clipboard.writeText(txt);
        const old = btn.textContent;
        btn.textContent = 'Copied ✓';
        setTimeout(()=>btn.textContent = old, 900);
      }catch(e){
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); }catch(_){}
        document.body.removeChild(ta);
        const old = btn.textContent;
        btn.textContent = 'Copied ✓';
        setTimeout(()=>btn.textContent = old, 900);
      }
    });
  });
})();

/* ---------- Math helpers (no external libs) ---------- */
const CONST = {
  c: 299792458,
  h: 6.62607015e-34,
  kB: 1.380649e-23,
  hbar: 1.054571817e-34,
  eps0: 8.8541878128e-12,
  pi: Math.PI
};

function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

function q2D_nu(nu, T, gp){
  // q(ν)=gp*(2π h ν^2 / c^2)/(exp(hν/kT)-1)
  const x = CONST.h * nu / (CONST.kB * T);
  const denom = Math.expm1(x); // exp(x)-1 robust
  if(denom <= 0) return 0;
  return gp * (2*CONST.pi * CONST.h * nu*nu / (CONST.c*CONST.c)) / denom;
}

function q3D_nu(nu, T, gp3=2){
  // Standard 3D energy density per volume per Hz (Planck):
  // u(ν)=gp*(8π h ν^3 / c^3)/(exp(hν/kT)-1)
  // Here used only for shape comparison, later scaled to fit.
  const x = CONST.h * nu / (CONST.kB * T);
  const denom = Math.expm1(x);
  if(denom <= 0) return 0;
  return gp3 * (8*CONST.pi * CONST.h * nu*nu*nu / (CONST.c*CONST.c*CONST.c)) / denom;
}

function gamma2D(omega0, L, gp, dEff){
  // Γ₂D = (gp |d·e|^2 ω0^2)/(2 ε0 ħ c^2 L)
  return (gp * dEff*dEff * omega0*omega0) / (2 * CONST.eps0 * CONST.hbar * CONST.c*CONST.c * L);
}

function gamma3D_ref(omega0, dEff){
  // Reference 3D free-space spontaneous emission rate (orientation-averaged constant omitted):
  // Common textbook: Γ₃D = ω0^3 |d|^2 / (3π ε0 ħ c^3).
  // We'll use this as a baseline comparison for inhibition ratio.
  return (omega0*omega0*omega0 * dEff*dEff) / (3*CONST.pi * CONST.eps0 * CONST.hbar * CONST.c*CONST.c*CONST.c);
}

/* ---------- HiDPI canvas setup ---------- */
function setupCanvas(canvas){
  const ctx = canvas.getContext('2d');
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    const w = Math.max(2, Math.floor(rect.width * dpr));
    const h = Math.max(2, Math.floor(rect.height * dpr));
    if(canvas.width !== w || canvas.height !== h){
      canvas.width = w; canvas.height = h;
    }
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  }
  const ro = new ResizeObserver(resize);
  ro.observe(canvas);
  resize();
  return {ctx, resize};
}

function drawAxes(ctx, box, xMin, xMax, yMin, yMax, opts){
  const {
    title='', xLabel='', yLabel='',
    grid=true, ticks=5, xTicks=6, yTicks=5
  } = opts || {};
  const {x,y,w,h} = box;

  // background
  ctx.save();
  ctx.fillStyle = 'rgba(0,0,0,0.14)';
  ctx.fillRect(x,y,w,h);

  // plot area padding
  const padL = 54, padR = 18, padT = 34, padB = 44;
  const px = x + padL, py = y + padT, pw = w - padL - padR, ph = h - padT - padB;

  // axes lines
  ctx.strokeStyle = 'rgba(255,255,255,0.22)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(px, py);
  ctx.lineTo(px, py+ph);
  ctx.lineTo(px+pw, py+ph);
  ctx.stroke();

  function xTo(u){ return px + (u - xMin) * (pw/(xMax-xMin)); }
  function yTo(v){ return py + ph - (v - yMin) * (ph/(yMax-yMin)); }

  // grid + ticks
  ctx.font = '12px ui-sans-serif, system-ui';
  ctx.fillStyle = 'rgba(233,238,252,0.78)';
  ctx.strokeStyle = 'rgba(255,255,255,0.10)';
  ctx.lineWidth = 1;

  if(grid){
    for(let i=0;i<=xTicks;i++){
      const u = xMin + (xMax-xMin)*i/xTicks;
      const X = xTo(u);
      ctx.beginPath();
      ctx.moveTo(X, py);
      ctx.lineTo(X, py+ph);
      ctx.stroke();
      // tick label
      ctx.fillStyle = 'rgba(233,238,252,0.72)';
      const txt = formatTick(u);
      ctx.fillText(txt, X-10, py+ph+18);
    }
    for(let j=0;j<=yTicks;j++){
      const v = yMin + (yMax-yMin)*j/yTicks;
      const Y = yTo(v);
      ctx.beginPath();
      ctx.moveTo(px, Y);
      ctx.lineTo(px+pw, Y);
      ctx.stroke();
      ctx.fillStyle = 'rgba(233,238,252,0.72)';
      const txt = formatTick(v);
      ctx.fillText(txt, x+6, Y+4);
    }
  }

  // title
  ctx.fillStyle = 'rgba(233,238,252,0.92)';
  ctx.font = '600 14px ui-sans-serif, system-ui';
  ctx.fillText(title, x+12, y+20);

  // labels
  ctx.fillStyle = 'rgba(184,194,230,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui';
  ctx.fillText(xLabel, px + pw/2 - ctx.measureText(xLabel).width/2, y + h - 12);

  // y label rotated
  ctx.save();
  ctx.translate(x+14, py + ph/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
  ctx.restore();

  ctx.restore();
  return {plot:{x:px,y:py,w:pw,h:ph}, xTo, yTo};
}

function formatTick(v){
  // compact tick formatter
  const av = Math.abs(v);
  if(av >= 1e6 || (av > 0 && av < 1e-3)){
    return v.toExponential(1);
  }
  if(av >= 1000) return (Math.round(v/10)/100).toString();
  if(av >= 10) return (Math.round(v*10)/10).toString();
  return (Math.round(v*100)/100).toString();
}

function drawLegend(ctx, x, y, items){
  ctx.save();
  ctx.font = '12px ui-sans-serif, system-ui';
  const pad = 8;
  let w = 0;
  items.forEach(it=>{
    w = Math.max(w, 20 + ctx.measureText(it.label).width);
  });
  const h = items.length*18 + pad*2;
  ctx.fillStyle = 'rgba(0,0,0,0.35)';
  ctx.strokeStyle = 'rgba(255,255,255,0.14)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  roundRect(ctx, x, y, w+pad*2, h, 12);
  ctx.fill(); ctx.stroke();

  items.forEach((it,i)=>{
    const yy = y + pad + i*18 + 10;
    ctx.strokeStyle = it.stroke;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x+pad, yy-4);
    ctx.lineTo(x+pad+14, yy-4);
    ctx.stroke();
    ctx.fillStyle = 'rgba(233,238,252,0.9)';
    ctx.fillText(it.label, x+pad+20, yy);
  });
  ctx.restore();
}

function roundRect(ctx, x, y, w, h, r){
  const rr = Math.min(r, w/2, h/2);
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
}

/* ---------- Canvases ---------- */
const diag = setupCanvas(document.getElementById('diagCanvas'));
const plot1 = setupCanvas(document.getElementById('plot1Canvas'));
const plot2 = setupCanvas(document.getElementById('plot2Canvas'));

/* ---------- UI state ---------- */
const UI = {
  T: 900,
  Lnm: 250,
  nu0THz: 500,
  gp: 2,
  // example dipole moment magnitude used for rate comparisons in plots (only ratios matter much)
  dEff: 3.0e-29 // C·m (order of atomic)
};

const els = {
  Tslider: document.getElementById('Tslider'),
  Lslider: document.getElementById('Lslider'),
  nu0slider: document.getElementById('nu0slider'),
  polSelect: document.getElementById('polSelect'),
  Tread: document.getElementById('Tread'),
  Lread: document.getElementById('Lread'),
  nu0read: document.getElementById('nu0read'),
  gpread: document.getElementById('gpread')
};

function syncReads(){
  els.Tread.textContent = UI.T.toFixed(0);
  els.Lread.textContent = UI.Lnm.toFixed(0);
  els.nu0read.textContent = UI.nu0THz.toFixed(0);
  els.gpread.textContent = UI.gp.toFixed(0);
}

els.Tslider.addEventListener('input', ()=>{
  UI.T = +els.Tslider.value;
  syncReads(); renderAll();
});
els.Lslider.addEventListener('input', ()=>{
  UI.Lnm = +els.Lslider.value;
  syncReads(); renderAll();
});
els.nu0slider.addEventListener('input', ()=>{
  UI.nu0THz = +els.nu0slider.value;
  syncReads(); renderAll();
});
els.polSelect.addEventListener('change', ()=>{
  UI.gp = +els.polSelect.value;
  syncReads(); renderAll();
});

syncReads();

/* ---------- Rendering ---------- */
function renderDiagram(){
  const ctx = diag.ctx;
  const c = document.getElementById('diagCanvas');
  const W = c.getBoundingClientRect().width;
  const H = c.getBoundingClientRect().height;

  ctx.clearRect(0,0,W,H);

  // Title area
  ctx.save();
  ctx.fillStyle = 'rgba(233,238,252,0.92)';
  ctx.font = '600 14px ui-sans-serif, system-ui';
  ctx.fillText('Setup: slab cavity enforcing 2D photon propagation', 12, 20);
  ctx.restore();

  // Draw slab + reflectors
  const margin = 22;
  const x0 = margin, x1 = W - margin;
  const yMid = H*0.58;
  const slabH = 64;

  // reflectors
  const refH = 12;
  const gap = 12;

  ctx.save();
  ctx.fillStyle = 'rgba(139,233,253,0.10)';
  ctx.strokeStyle = 'rgba(139,233,253,0.35)';
  ctx.lineWidth = 2;
  // top reflector
  ctx.beginPath();
  roundRect(ctx, x0, yMid - slabH/2 - gap - refH, x1-x0, refH, 10);
  ctx.fill(); ctx.stroke();
  // bottom reflector
  ctx.beginPath();
  roundRect(ctx, x0, yMid + slabH/2 + gap, x1-x0, refH, x1?10:10);
  ctx.fill(); ctx.stroke();

  // slab region
  ctx.fillStyle = 'rgba(167,139,250,0.10)';
  ctx.strokeStyle = 'rgba(167,139,250,0.35)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  roundRect(ctx, x0+30, yMid - slabH/2, (x1-x0)-60, slabH, 16);
  ctx.fill(); ctx.stroke();

  // Atom
  const ax = W*0.52, ay = yMid;
  ctx.fillStyle = 'rgba(255,255,255,0.92)';
  ctx.strokeStyle = 'rgba(0,0,0,0.25)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(ax, ay, 9, 0, Math.PI*2);
  ctx.fill(); ctx.stroke();

  // Emission arrows (in-plane)
  ctx.strokeStyle = 'rgba(124,255,155,0.85)';
  ctx.lineWidth = 2;
  for(const s of [-1,1]){
    ctx.beginPath();
    ctx.moveTo(ax, ay);
    ctx.lineTo(ax + s*92, ay + s*16);
    ctx.stroke();
    // arrow head
    const tx = ax + s*92, ty = ay + s*16;
    const ang = Math.atan2(ty-ay, tx-ax);
    ctx.beginPath();
    ctx.moveTo(tx, ty);
    ctx.lineTo(tx - 10*Math.cos(ang-0.35), ty - 10*Math.sin(ang-0.35));
    ctx.lineTo(tx - 10*Math.cos(ang+0.35), ty - 10*Math.sin(ang+0.35));
    ctx.closePath();
    ctx.fillStyle = 'rgba(124,255,155,0.85)';
    ctx.fill();
  }

  // Thickness L label
  const Lpx = clamp(UI.Lnm/2000, 0, 1) * 90 + 40; // purely visual
  ctx.strokeStyle = 'rgba(255,209,102,0.9)';
  ctx.lineWidth = 2;
  const xL = x0 + 18;
  const yTop = yMid - slabH/2 - gap;
  const yBot = yMid + slabH/2 + gap;
  ctx.beginPath();
  ctx.moveTo(xL, yTop);
  ctx.lineTo(xL, yBot);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(xL-6, yTop); ctx.lineTo(xL+6, yTop);
  ctx.moveTo(xL-6, yBot); ctx.lineTo(xL+6, yBot);
  ctx.stroke();

  ctx.fillStyle = 'rgba(255,209,102,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui';
  ctx.fillText('effective thickness L', xL + 10, (yTop+yBot)/2 - 6);
  ctx.fillStyle = 'rgba(184,194,230,0.9)';
  ctx.fillText(`L = ${UI.Lnm.toFixed(0)} nm`, xL + 10, (yTop+yBot)/2 + 12);

  // k-space ring inset
  const insetX = W*0.70, insetY = H*0.18, insetR = 58;
  ctx.fillStyle = 'rgba(0,0,0,0.28)';
  ctx.strokeStyle = 'rgba(255,255,255,0.14)';
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  ctx.arc(insetX, insetY+10, insetR+16, 0, Math.PI*2);
  ctx.fill(); ctx.stroke();

  ctx.strokeStyle = 'rgba(139,233,253,0.85)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(insetX, insetY+10, insetR, 0, Math.PI*2);
  ctx.stroke();

  ctx.strokeStyle = 'rgba(255,255,255,0.20)';
  ctx.beginPath();
  ctx.moveTo(insetX-(insetR+8), insetY+10);
  ctx.lineTo(insetX+(insetR+8), insetY+10);
  ctx.moveTo(insetX, insetY+10-(insetR+8));
  ctx.lineTo(insetX, insetY+10+(insetR+8));
  ctx.stroke();

  ctx.fillStyle = 'rgba(233,238,252,0.9)';
  ctx.font = '600 12px ui-sans-serif, system-ui';
  ctx.fillText('2D k-space', insetX - 32, insetY - 16);
  ctx.fillStyle = 'rgba(184,194,230,0.9)';
  ctx.font = '12px ui-sans-serif, system-ui';
  ctx.fillText('shell = ring (∝ k)', insetX - 42, insetY + insetR + 28);

  // labels
  ctx.fillStyle = 'rgba(184,194,230,0.9)';
  ctx.font = '12px ui-sans-serif, system-ui';
  ctx.fillText('Top reflector', x0+10, yMid - slabH/2 - gap - refH - 8);
  ctx.fillText('Bottom reflector', x0+10, yMid + slabH/2 + gap + refH + 18);
  ctx.fillText('Atom', ax+14, ay+4);
  ctx.fillStyle = 'rgba(124,255,155,0.9)';
  ctx.fillText('in-plane photon modes', ax+14, ay+24);

  ctx.restore();
}

function renderPlot1(){
  const ctx = plot1.ctx;
  const c = document.getElementById('plot1Canvas');
  const W = c.getBoundingClientRect().width;
  const H = c.getBoundingClientRect().height;
  ctx.clearRect(0,0,W,H);

  // Frequency range for plot (THz)
  const nuMin = 0;
  const nuMaxTHz = 1200;
  const nuMax = nuMaxTHz * 1e12;
  const nu0 = UI.nu0THz * 1e12;

  // sample curves
  const N = 520;
  let maxY = 0;
  const gp = UI.gp;

  const y2 = new Float64Array(N);
  const y3 = new Float64Array(N);
  for(let i=0;i<N;i++){
    const nu = nuMin + (nuMax-nuMin)*i/(N-1);
    const v2 = q2D_nu(nu, UI.T, gp);
    const v3 = q3D_nu(nu, UI.T, 2);
    y2[i]=v2; y3[i]=v3;
    maxY = Math.max(maxY, v2);
  }

  // scale 3D curve to comparable height (shape comparison only)
  let maxY3 = 0;
  for(let i=0;i<N;i++) maxY3 = Math.max(maxY3, y3[i]);
  const scale3 = (maxY3>0) ? (maxY / maxY3) : 1;

  const ax = drawAxes(ctx,
    {x:8,y:8,w:W-16,h:H-16},
    0, nuMaxTHz, 0, maxY*1.10,
    {
      title: '2D Planck spectrum per area: q(ν)  (and 3D shape for comparison)',
      xLabel: 'frequency ν (THz)',
      yLabel: 'q(ν)  [J / (m²·Hz)]',
      xTicks: 6, yTicks: 5
    }
  );

  // Draw curves
  const stroke2D = 'rgba(139,233,253,0.92)';
  const stroke3D = 'rgba(167,139,250,0.88)';

  // 2D curve
  ctx.save();
  ctx.lineWidth = 2.2;
  ctx.strokeStyle = stroke2D;
  ctx.beginPath();
  for(let i=0;i<N;i++){
    const nuTHz = (nuMin + (nuMax-nuMin)*i/(N-1))/1e12;
    const X = ax.xTo(nuTHz);
    const Y = ax.yTo(y2[i]);
    if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
  }
  ctx.stroke();

  // 3D curve (scaled)
  ctx.strokeStyle = stroke3D;
  ctx.lineWidth = 2.0;
  ctx.beginPath();
  for(let i=0;i<N;i++){
    const nuTHz = (nuMin + (nuMax-nuMin)*i/(N-1))/1e12;
    const X = ax.xTo(nuTHz);
    const Y = ax.yTo(y3[i]*scale3);
    if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
  }
  ctx.stroke();

  // ν0 marker
  const nu0THz = UI.nu0THz;
  const Xm = ax.xTo(nu0THz);
  ctx.strokeStyle = 'rgba(255,209,102,0.95)';
  ctx.lineWidth = 2;
  ctx.setLineDash([6,4]);
  ctx.beginPath();
  ctx.moveTo(Xm, ax.plot.y);
  ctx.lineTo(Xm, ax.plot.y+ax.plot.h);
  ctx.stroke();
  ctx.setLineDash([]);

  // annotate marker values
  const yAtNu0 = q2D_nu(nu0, UI.T, gp);
  ctx.fillStyle = 'rgba(255,209,102,0.95)';
  ctx.font = '12px ui-sans-serif, system-ui';
  const label = `ν₀=${nu0THz.toFixed(0)} THz,  q₂D(ν₀)≈${(yAtNu0).toExponential(2)}`;
  const lx = clamp(Xm+8, ax.plot.x+8, ax.plot.x+ax.plot.w-260);
  const ly = ax.plot.y + 18;
  ctx.fillText(label, lx, ly);

  // legend
  drawLegend(ctx, ax.plot.x+ax.plot.w-190, ax.plot.y+10, [
    {label:`q₂D(ν), g_p=${UI.gp}`, stroke: stroke2D},
    {label:`q₃D(ν) scaled`, stroke: stroke3D},
    {label:`ν₀ marker`, stroke: 'rgba(255,209,102,0.95)'}
  ]);

  ctx.restore();
}

function renderPlot2(){
  const ctx = plot2.ctx;
  const c = document.getElementById('plot2Canvas');
  const W = c.getBoundingClientRect().width;
  const H = c.getBoundingClientRect().height;
  ctx.clearRect(0,0,W,H);

  const gp = UI.gp;
  const L = UI.Lnm * 1e-9;
  const dEff = UI.dEff;

  // frequency sweep (THz)
  const nuMinTHz = 80;
  const nuMaxTHz = 900;
  const N = 420;

  // Compute ratio R(ν)=Γ2D/Γ3D
  let maxR = 0;
  const R = new Float64Array(N);
  for(let i=0;i<N;i++){
    const nuTHz = nuMinTHz + (nuMaxTHz-nuMinTHz)*i/(N-1);
    const omega = 2*CONST.pi * nuTHz * 1e12;
    const g2 = gamma2D(omega, L, gp, dEff);
    const g3 = gamma3D_ref(omega, dEff);
    const r = (g3>0) ? (g2/g3) : 0;
    R[i]=r;
    maxR = Math.max(maxR, r);
  }

  const yMax = maxR*1.12 || 1;
  const ax = drawAxes(ctx,
    {x:8,y:8,w:W-16,h:H-16},
    nuMinTHz, nuMaxTHz, 0, yMax,
    {
      title: 'Inhibition / enhancement ratio: R(ν) = Γ₂D / Γ₃D (reference)',
      xLabel: 'frequency ν (THz)',
      yLabel: 'R(ν) (dimensionless)',
      xTicks: 5, yTicks: 5
    }
  );

  // draw curve
  const strokeR = 'rgba(124,255,155,0.92)';
  ctx.save();
  ctx.strokeStyle = strokeR;
  ctx.lineWidth = 2.2;
  ctx.beginPath();
  for(let i=0;i<N;i++){
    const nuTHz = nuMinTHz + (nuMaxTHz-nuMinTHz)*i/(N-1);
    const X = ax.xTo(nuTHz);
    const Y = ax.yTo(R[i]);
    if(i===0) ctx.moveTo(X,Y); else ctx.lineTo(X,Y);
  }
  ctx.stroke();

  // marker at nu0
  const nu0THz = UI.nu0THz;
  const omega0 = 2*CONST.pi * nu0THz * 1e12;
  const r0 = gamma2D(omega0, L, gp, dEff) / gamma3D_ref(omega0, dEff);

  const Xm = ax.xTo(clamp(nu0THz, nuMinTHz, nuMaxTHz));
  ctx.strokeStyle = 'rgba(255,209,102,0.95)';
  ctx.lineWidth = 2;
  ctx.setLineDash([6,4]);
  ctx.beginPath();
  ctx.moveTo(Xm, ax.plot.y);
  ctx.lineTo(Xm, ax.plot.y+ax.plot.h);
  ctx.stroke();
  ctx.setLineDash([]);

  // dot at (nu0, r0)
  const Y0 = ax.yTo(clamp(r0, 0, yMax));
  ctx.fillStyle = 'rgba(255,209,102,0.95)';
  ctx.beginPath();
  ctx.arc(Xm, Y0, 4.5, 0, Math.PI*2);
  ctx.fill();

  // annotate
  ctx.fillStyle = 'rgba(233,238,252,0.90)';
  ctx.font = '12px ui-sans-serif, system-ui';
  const txt = `At ν₀: R≈${r0.toExponential(2)}   (L=${UI.Lnm.toFixed(0)} nm, g_p=${gp})`;
  ctx.fillText(txt, ax.plot.x+10, ax.plot.y+18);

  // show Γ2D value (example)
  const g2 = gamma2D(omega0, L, gp, dEff);
  ctx.fillStyle = 'rgba(184,194,230,0.92)';
  ctx.fillText(`Example Γ₂D(ω₀)≈${g2.toExponential(2)} s⁻¹ (using example dipole)`, ax.plot.x+10, ax.plot.y+36);

  drawLegend(ctx, ax.plot.x+ax.plot.w-170, ax.plot.y+10, [
    {label:'R(ν)=Γ₂D/Γ₃D', stroke: strokeR},
    {label:'ν₀ marker', stroke: 'rgba(255,209,102,0.95)'}
  ]);

  ctx.restore();
}

function renderAll(){
  renderDiagram();
  renderPlot1();
  renderPlot2();
}

renderAll();
window.addEventListener('resize', renderAll);
</script>
</body>
</html>
