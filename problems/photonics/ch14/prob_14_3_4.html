<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spontaneous Emission into Prescribed Cavity Modes (1 Œºm¬≥ Cube)</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#101827;
      --panel2:#0f172a;
      --text:#e6eefc;
      --muted:#a9b7d1;
      --faint:#7f8aa3;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% 0%, rgba(125,211,252,.12), transparent 60%),
                  radial-gradient(1000px 700px at 80% 10%, rgba(167,139,250,.12), transparent 55%),
                  linear-gradient(180deg, #070a10, var(--bg));
      color:var(--text);
      font-family:var(--sans);
      line-height:1.55;
    }
    header{
      padding:36px 18px 18px;
      max-width:1100px;
      margin:0 auto;
    }
    .kicker{
      color:var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:.78rem;
    }
    h1{
      margin:.35rem 0 .5rem;
      font-size: clamp(1.6rem, 2.8vw, 2.55rem);
      line-height:1.15;
    }
    .subtitle{
      color:var(--muted);
      max-width: 78ch;
      font-size:1.03rem;
    }

    main{
      max-width:1100px;
      margin:0 auto;
      padding: 0 18px 70px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      align-items:start;
    }

    nav.toc{
      position:sticky;
      top:14px;
      background: linear-gradient(180deg, rgba(16,24,39,.92), rgba(16,24,39,.78));
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px 14px 10px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .toc h2{
      font-size: .95rem;
      margin:0 0 8px;
      color:var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .toc a{
      display:block;
      padding:8px 10px;
      border-radius: 12px;
      color:var(--muted);
      text-decoration:none;
      font-size:.92rem;
      border:1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .toc a:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(125,211,252,.18);
      color:var(--text);
      transform: translateX(2px);
    }
    .toc .mini{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed rgba(255,255,255,.14);
      color:var(--faint);
      font-size:.88rem;
    }

    article{
      background: linear-gradient(180deg, rgba(16,24,39,.70), rgba(16,24,39,.45));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .content{
      padding: 18px 18px 22px;
    }
    section{
      padding: 14px 0;
      border-top: 1px solid rgba(255,255,255,.07);
    }
    section:first-child{border-top:none}
    h2{
      margin: 0 0 10px;
      font-size: 1.25rem;
      letter-spacing:.01em;
    }
    h3{
      margin: 12px 0 8px;
      font-size: 1.05rem;
      color: var(--text);
    }
    p{margin: 8px 0; color: var(--muted)}
    ul{margin: 8px 0 8px 22px; color: var(--muted)}
    li{margin: 6px 0}
    code, .mono{font-family: var(--mono)}
    .eq{
      font-family: var(--mono);
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
      overflow:auto;
      position:relative;
    }
    .eq .copy{
      position:absolute;
      right:10px;
      top:10px;
      font-size:.78rem;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      color: var(--text);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .eq .copy:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
    }
    .callouts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin: 10px 0 6px;
    }
    .card{
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      padding: 12px 12px;
      background: rgba(255,255,255,.03);
    }
    .card h4{
      margin:0 0 6px;
      font-size:.95rem;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .tag{
      display:inline-block;
      font-size:.72rem;
      letter-spacing:.06em;
      text-transform:uppercase;
      padding: 3px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      color: var(--muted);
      background: rgba(0,0,0,.18);
    }
    .tag.ok{border-color: rgba(52,211,153,.35); color: rgba(167,243,208,.95)}
    .tag.warn{border-color: rgba(251,191,36,.35); color: rgba(253,230,138,.95)}
    .tag.bad{border-color: rgba(251,113,133,.35); color: rgba(254,202,202,.95)}
    .highlight{
      border-left: 3px solid rgba(125,211,252,.75);
      padding-left: 10px;
    }

    .vizWrap{
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,.07);
      padding-top: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .vizRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    figure{
      margin:0;
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    figcaption{
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-size:.9rem;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      background: radial-gradient(900px 380px at 20% 0%, rgba(125,211,252,.08), transparent 55%),
                  radial-gradient(900px 380px at 80% 0%, rgba(167,139,250,.08), transparent 55%),
                  linear-gradient(180deg, rgba(2,6,23,.45), rgba(2,6,23,.75));
    }
    .controls{
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap:10px;
      margin: 8px 0 0;
    }
    .control{
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      padding: 10px 12px;
    }
    .control label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size:.9rem;
      color: var(--muted);
      gap:10px;
    }
    .control .val{
      font-family: var(--mono);
      color: var(--text);
      font-size:.88rem;
      white-space:nowrap;
    }
    input[type="range"]{
      width:100%;
      margin-top:8px;
      accent-color: var(--accent);
    }
    select, button.small{
      width:100%;
      margin-top:8px;
      border-radius: 12px;
      padding: 8px 10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size:.92rem;
      outline:none;
      cursor:pointer;
    }
    button.small:hover{border-color: rgba(125,211,252,.28); background: rgba(125,211,252,.08)}
    .answerBox{
      border:1px solid rgba(52,211,153,.25);
      background: rgba(52,211,153,.06);
      border-radius: var(--radius);
      padding: 12px 12px 12px;
      margin-top:10px;
      position:relative;
      overflow:hidden;
    }
    .answerBox h3{margin:0 0 8px}
    .answerBox .copyFinal{
      position:absolute;
      right:10px;
      top:10px;
      font-size:.78rem;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(52,211,153,.35);
      background: rgba(0,0,0,.18);
      color: var(--text);
      cursor:pointer;
    }
    .answerBox .copyFinal:hover{background: rgba(52,211,153,.10)}
    .answerText{
      font-family: var(--mono);
      color: rgba(231,255,246,.95);
      white-space: pre-wrap;
    }

    footer{
      max-width:1100px;
      margin: 14px auto 30px;
      padding: 0 18px;
      color: var(--faint);
      font-size:.9rem;
    }

    @media (max-width: 980px){
      main{grid-template-columns: 1fr}
      nav.toc{position:relative; top:auto}
      .vizRow{grid-template-columns: 1fr}
      canvas{height: 300px}
      .controls{grid-template-columns: 1fr}
      .callouts{grid-template-columns: 1fr}
    }

    @media print{
      body{background:#fff; color:#000}
      nav.toc{display:none}
      article{box-shadow:none; border:1px solid #ccc}
      canvas{background:#fff}
      .eq .copy, .answerBox .copyFinal{display:none}
    }
  </style>
</head>
<body>
<header>
  <div class="kicker">Photonics ‚Ä¢ Cavity QED ‚Ä¢ Mode Counting</div>
  <h1>Spontaneous Emission into Prescribed Modes of a 1&nbsp;Œºm<sup>3</sup> Cubic Cavity</h1>
  <p class="subtitle">
    We find the lowest and next-higher electromagnetic cavity-mode frequencies for a cube, then use degeneracy to compare
    spontaneous-emission probabilities into a single specified mode vs ‚Äúany mode at that same frequency‚Äù.
  </p>
</header>

<main>
  <nav class="toc" aria-label="Table of contents">
    <h2>üìå Table of Contents</h2>
    <a href="#quick">Quick Summary</a>
    <a href="#part0">PART 0 ‚Äî Concept Primer</a>
    <a href="#part1">PART 1 ‚Äî Problem Analysis</a>
    <a href="#part2">PART 2 ‚Äî Strategy & Tips</a>
    <a href="#part3">PART 3 ‚Äî Full Solution</a>
    <a href="#part4">PART 4 ‚Äî Deeper Understanding</a>
    <a href="#part5">PART 5 ‚Äî Visualization Guide</a>
    <div class="mini">
      Interactive controls below update <span class="mono">all</span> canvases live (size <span class="mono">L</span>, index <span class="mono">n</span>, and emission scaling).
    </div>
  </nav>

  <article>
    <div class="content">

      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this is about:</b> Electromagnetic standing-wave modes in a cubic cavity and spontaneous emission into discrete modes.</li>
          <li><b>Key idea:</b> A cube enforces <span class="mono">k</span>-components <span class="mono">k_i = q_i œÄ/L</span> (integers), giving discrete frequencies.</li>
          <li><b>Governing relation (mode frequency):</b> <span class="mono">f(q1,q2,q3) = (c/(2 n L)) ‚àö(q1¬≤+q2¬≤+q3¬≤)</span>.</li>
          <li><b>Lowest mode:</b> <span class="mono">(q1,q2,q3)=(1,1,1)</span> ‚Üí <span class="mono">f ‚âà 260 THz</span> for <span class="mono">L=1 Œºm</span>, <span class="mono">n=1</span>.</li>
          <li><b>Next-higher frequency:</b> smallest next value of <span class="mono">q1¬≤+q2¬≤+q3¬≤</span> is <span class="mono">6</span> ‚Üí modes <span class="mono">(2,1,1)</span> and permutations ‚Üí <span class="mono">f ‚âà 367 THz</span>.</li>
          <li><b>Spontaneous emission into a ‚Äúspecific mode‚Äù vs ‚Äúthat frequency‚Äù:</b> if the three permutations are degenerate and equally likely, then <span class="mono">p_sp2/p_sp1 = 3</span>.</li>
          <li><b>Final result type:</b> numeric mode frequencies + a simple integer ratio from degeneracy counting.</li>
        </ul>
      </section>

      <section id="part0">
        <h2>PART 0 ‚Äî Concept Primer (THEORY BEFORE SOLVING)</h2>

        <h3>Core definitions (symbols &amp; units)</h3>
        <ul>
          <li><b>Cavity side length</b> <span class="mono">L</span> (m). Here a cube with volume <span class="mono">V=L¬≥</span>.</li>
          <li><b>Refractive index</b> <span class="mono">n</span> (dimensionless). Wave speed is <span class="mono">v=c/n</span>.</li>
          <li><b>Mode indices</b> <span class="mono">(q1,q2,q3)</span> (integers). They count half-wavelength ‚Äúnodes‚Äù along each axis.</li>
          <li><b>Wavevector</b> <span class="mono">k</span> (rad/m). For a rectangular cavity: <span class="mono">k_i = q_i œÄ/L</span>.</li>
          <li><b>Angular frequency</b> <span class="mono">œâ</span> (rad/s) and frequency <span class="mono">f=œâ/(2œÄ)</span> (Hz).</li>
          <li><b>Spontaneous emission rate</b> (probability per time) into a channel: units <span class="mono">s‚Åª¬π</span>.</li>
        </ul>

        <h3>Physical meaning</h3>
        <p class="highlight">
          A cavity does <b>not</b> allow arbitrary wavelengths. Boundary conditions force standing waves. Each allowed
          standing wave is a <b>mode</b>, and photons created by spontaneous emission must land in one of these discrete modes.
        </p>

        <h3>Key principles &amp; validity conditions</h3>
        <div class="callouts">
          <div class="card">
            <h4><span class="tag ok">Principle</span> Standing-wave quantization</h4>
            <p>
              For an ideal cavity (perfectly reflecting walls), the electric/magnetic fields must satisfy boundary conditions at the walls.
              This forces discrete <span class="mono">k</span>-components: <span class="mono">k_i=q_i œÄ/L</span>.
            </p>
          </div>
          <div class="card">
            <h4><span class="tag ok">Principle</span> Spontaneous emission into modes</h4>
            <p>
              In quantum electrodynamics, spontaneous emission is driven by vacuum fluctuations. In a cavity,
              the <b>available final states</b> are discrete modes. If multiple modes share the same frequency (degeneracy),
              emission into ‚Äúthat frequency‚Äù sums over those modes.
            </p>
          </div>
        </div>

        <h3>Common models/approximations (and why)</h3>
        <ul>
          <li><b>Ideal cubic cavity:</b> perfectly conducting (or perfectly reflecting) boundaries ‚Üí clean mode quantization.</li>
          <li><b>Uniform refractive index:</b> constant <span class="mono">n</span> so <span class="mono">v=c/n</span> everywhere ‚Üí simple dispersion <span class="mono">œâ=(c/n)|k|</span>.</li>
          <li><b>Equal coupling to degenerate modes (typical textbook assumption):</b> a randomly oriented dipole and a generic location
              make symmetry-related modes equally probable on average.</li>
        </ul>

        <h3>Mini intuition examples</h3>
        <ul>
          <li><b>1D string analogy:</b> A string of length <span class="mono">L</span> supports wavelengths <span class="mono">Œª=2L/q</span>. A 3D cavity is three such quantizations combined.</li>
          <li><b>Degeneracy intuition:</b> If three distinct standing-wave patterns have the same frequency, you have three different ‚Äúbins‚Äù a photon can fall into ‚Üí probabilities add.</li>
        </ul>

        <h3>What to watch for (pitfalls)</h3>
        <ul>
          <li>Mixing up <span class="mono">œâ</span> (rad/s) and <span class="mono">f</span> (Hz). The factor <span class="mono">2œÄ</span> matters.</li>
          <li>For a cube, the lowest nonzero mode uses <span class="mono">q1=q2=q3=1</span> (not <span class="mono">1,0,0</span> if you restrict to all-positive indices as is often done in this cavity-mode listing).</li>
          <li>‚ÄúMode‚Äù vs ‚Äúfrequency‚Äù: multiple modes can share one frequency (degeneracy). The problem‚Äôs ratio hinges on this distinction.</li>
        </ul>
      </section>

      <section id="part1">
        <h2>PART 1 ‚Äî Problem Analysis (no solving yet)</h2>

        <h3>Rewrite the problem in plain words</h3>
        <p>
          We have a cubic optical cavity of volume <span class="mono">1 Œºm¬≥</span> (so side length <span class="mono">L=1 Œºm</span>) filled with a medium of refractive index <span class="mono">n=1</span>.
          (a) Find the integer mode indices <span class="mono">(q1,q2,q3)</span> for the lowest and next-higher frequency modes and verify their frequencies are 260 THz and 367 THz.
          (b) Put one excited atom in the empty cavity (vacuum field; zero photons initially). Let <span class="mono">p_sp1</span> be the spontaneous-emission probability density into one specific mode (the <span class="mono">(2,1,1)</span> mode), and
          <span class="mono">p_sp2</span> be the probability density to emit a photon with frequency 367 THz (i.e., into any mode at that frequency). Find <span class="mono">p_sp2/p_sp1</span>.
        </p>

        <h3>Given quantities</h3>
        <ul>
          <li><span class="mono">V = 1 Œºm¬≥ = 1√ó10‚Åª¬π‚Å∏ m¬≥</span> ‚áí <span class="mono">L = V^{1/3} = 1 Œºm = 1√ó10‚Åª‚Å∂ m</span></li>
          <li><span class="mono">n = 1</span></li>
          <li>Speed of light <span class="mono">c ‚âà 3.00√ó10‚Å∏ m/s</span></li>
        </ul>

        <h3>Unknowns</h3>
        <ul>
          <li>Mode indices for the two lowest distinct frequencies: <span class="mono">(q1,q2,q3)</span></li>
          <li>Frequencies of those modes (Hz or THz)</li>
          <li>Ratio <span class="mono">p_sp2/p_sp1</span></li>
        </ul>

        <h3>Relevant principles and why they apply</h3>
        <ul>
          <li><b>Cavity boundary conditions</b> ‚Üí discrete standing-wave modes (must use because the cavity imposes quantization).</li>
          <li><b>Dispersion in uniform medium</b> <span class="mono">œâ=(c/n)|k|</span> ‚Üí connects mode indices to frequency.</li>
          <li><b>Degeneracy counting</b> ‚Üí when multiple modes share the same frequency, emission ‚Äúat that frequency‚Äù is the sum over those modes.</li>
        </ul>
        <p>
          We do <b>not</b> need detailed atomic structure, dipole matrix elements, or line broadening here because the question asks for a <b>ratio</b> that (under standard symmetry assumptions) is set purely by how many modes are available at that frequency.
        </p>

        <div class="callouts">
          <div class="card">
            <h4><span class="tag warn">Assumptions</span> Idealizations used</h4>
            <ul>
              <li>Perfectly reflecting cubic cavity, uniform <span class="mono">n</span>.</li>
              <li>Mode labeling by positive integers <span class="mono">q1,q2,q3 ‚â• 1</span> (as in many textbook listings for ‚Äú3D box‚Äù modes).</li>
              <li>Degenerate modes at the same frequency have equal spontaneous-emission probability density (symmetry/averaging).</li>
            </ul>
          </div>
          <div class="card">
            <h4><span class="tag warn">Why this is enough</span></h4>
            <p>
              Part (b) compares one <i>specific</i> degenerate mode to the <i>set</i> of all degenerate modes at the same frequency.
              If each is equally likely, the ratio is just the degeneracy.
            </p>
          </div>
        </div>

        <h3>Possible approaches (and which we choose)</h3>
        <ul>
          <li><b>Approach A: Direct mode formula</b> using <span class="mono">f=(c/(2nL))‚àö(q1¬≤+q2¬≤+q3¬≤)</span> and search smallest integer sums. <i>Fast, transparent</i>.</li>
          <li><b>Approach B: Wavelength counting</b> with <span class="mono">Œª_i=2L/q_i</span> and 3D relation <span class="mono">1/Œª¬≤=1/Œªx¬≤+1/Œªy¬≤+1/Œªz¬≤</span>. <i>Equivalent, slightly longer</i>.</li>
          <li><b>Approach C: Density-of-states continuum</b>. <i>Not appropriate</i> because the cavity is small and we care about specific discrete modes.</li>
        </ul>
        <p><b>Chosen approach:</b> Approach A, because it directly matches the ‚Äúmode numbers‚Äù asked for and gives immediate frequencies.</p>
      </section>

      <section id="part2">
        <h2>PART 2 ‚Äî Strategy &amp; Tips (roadmap only)</h2>
        <ol style="color:var(--muted); margin:8px 0 8px 22px;">
          <li>
            <b>Convert volume to side length</b>:
            goal: get <span class="mono">L</span>;
            tool: <span class="mono">L=V^{1/3}</span>;
            meaning: the cavity‚Äôs geometric scale sets the wavelength.
          </li>
          <li>
            <b>Write the cavity mode frequency formula</b>:
            goal: relate <span class="mono">(q1,q2,q3)</span> to <span class="mono">f</span>;
            principle: standing-wave <span class="mono">k_i=q_iœÄ/L</span> and <span class="mono">œâ=(c/n)|k|</span>.
          </li>
          <li>
            <b>Find the smallest integer value of</b> <span class="mono">S=q1¬≤+q2¬≤+q3¬≤</span>:
            goal: lowest frequency;
            meaning: smallest wavevector magnitude.
          </li>
          <li>
            <b>Find the next smallest distinct</b> <span class="mono">S</span>:
            goal: next-higher frequency;
            meaning: the next allowed |k| shell.
          </li>
          <li>
            <b>Compute numeric frequencies</b>:
            tool: plug in <span class="mono">c, n, L</span>;
            meaning: check against 260 THz and 367 THz.
          </li>
          <li>
            <b>Count degeneracy at 367 THz</b>:
            goal: compare one specific mode to ‚Äúany mode at that frequency‚Äù;
            tool: number of permutations of <span class="mono">(2,1,1)</span>;
            meaning: probabilities add over distinct final modes.
          </li>
        </ol>

        <div class="callouts">
          <div class="card">
            <h4><span class="tag bad">Common mistake</span> Confusing ‚Äúa mode‚Äù with ‚Äúa frequency‚Äù</h4>
            <p>
              The <span class="mono">(2,1,1)</span>, <span class="mono">(1,2,1)</span>, and <span class="mono">(1,1,2)</span> patterns are <b>different modes</b>
              but share the <b>same frequency</b>. If you ask ‚Äúprobability to emit at 367 THz‚Äù, you must sum over all of them.
            </p>
          </div>
          <div class="card">
            <h4><span class="tag ok">Quick tip</span></h4>
            <p>
              For a cube, frequencies group into ‚Äúshells‚Äù of constant <span class="mono">S=q1¬≤+q2¬≤+q3¬≤</span>.
              Lowest shell is <span class="mono">S=3</span>, next is <span class="mono">S=6</span>.
            </p>
          </div>
        </div>
      </section>

      <section id="part3">
        <h2>PART 3 ‚Äî Full Solution (DETAILED + TEACHING)</h2>

        <h3>Physical intuition (before calculating)</h3>
        <p>
          Smaller cavities force shorter wavelengths (higher frequencies). Inside a cube, the ‚Äúsmoothest‚Äù nontrivial standing wave
          has one half-wavelength along each axis (that‚Äôs <span class="mono">q1=q2=q3=1</span>). The next frequency should come from
          increasing one index to 2 (one direction fits an extra half-wavelength), giving a slightly larger wavevector magnitude and thus a higher frequency.
        </p>

        <h3>Step 1: Geometry ‚Üí side length</h3>
        <p>
          The cavity volume is <span class="mono">V = 1 Œºm¬≥</span>. For a cube, <span class="mono">V=L¬≥</span>, so
        </p>
        <div class="eq" data-copy="L = V^(1/3) = (1 Œºm^3)^(1/3) = 1 Œºm = 1√ó10^-6 m">
          <button class="copy" type="button">Copy</button>
          <div class="mono">L = V^(1/3) = (1 Œºm^3)^(1/3) = 1 Œºm = 1√ó10^-6 m</div>
        </div>
        <p>
          <b>Meaning:</b> the fundamental length scale is one micron, so the fundamental half-wave scale <span class="mono">L</span> will correspond to optical/near-IR frequencies.
        </p>

        <h3>Step 2: Allowed wavevectors in a cubic cavity</h3>
        <p>
          For an ideal rectangular cavity, boundary conditions force standing waves with
        </p>
        <div class="eq" data-copy="k_x = (q1 œÄ)/L,  k_y = (q2 œÄ)/L,  k_z = (q3 œÄ)/L   (q1,q2,q3 are positive integers)">
          <button class="copy" type="button">Copy</button>
          <div class="mono">k_x = (q1 œÄ)/L,  k_y = (q2 œÄ)/L,  k_z = (q3 œÄ)/L   (q1,q2,q3 are positive integers)</div>
        </div>
        <p>
          Therefore
          <span class="mono">|k| = sqrt(kx¬≤+ky¬≤+kz¬≤) = (œÄ/L) sqrt(q1¬≤+q2¬≤+q3¬≤)</span>.
        </p>

        <h3>Step 3: Dispersion relation ‚Üí mode frequency</h3>
        <p>
          In a uniform medium of refractive index <span class="mono">n</span>, electromagnetic waves satisfy
          <span class="mono">œâ = (c/n)|k|</span>. Substitute the expression for <span class="mono">|k|</span>:
        </p>
        <div class="eq" data-copy="œâ(q1,q2,q3) = (c/n) (œÄ/L) ‚àö(q1^2+q2^2+q3^2)">
          <button class="copy" type="button">Copy</button>
          <div class="mono">œâ(q1,q2,q3) = (c/n) (œÄ/L) ‚àö(q1^2+q2^2+q3^2)</div>
        </div>
        <p>
          Convert to ordinary frequency <span class="mono">f = œâ/(2œÄ)</span>:
        </p>
        <div class="eq" data-copy="f(q1,q2,q3) = (c/(2 n L)) ‚àö(q1^2+q2^2+q3^2)">
          <button class="copy" type="button">Copy</button>
          <div class="mono">f(q1,q2,q3) = (c/(2 n L)) ‚àö(q1^2+q2^2+q3^2)</div>
        </div>
        <p>
          <b>Meaning:</b> all cavity frequencies are proportional to <span class="mono">1/(nL)</span> times a dimensionless integer length <span class="mono">‚àö(q1¬≤+q2¬≤+q3¬≤)</span>.
        </p>

        <h3>(a) Step 4: Lowest-frequency mode (smallest integer sum)</h3>
        <p>
          Define the ‚Äúshell index‚Äù
          <span class="mono">S = q1¬≤ + q2¬≤ + q3¬≤</span>.
          For positive integers, the smallest possible values are:
        </p>
        <ul>
          <li><span class="mono">(1,1,1)</span> gives <span class="mono">S=1+1+1=3</span> (this is the smallest).</li>
        </ul>

        <p>
          So the <b>lowest-frequency mode</b> is
          <span class="mono">(q1,q2,q3)=(1,1,1)</span>.
          Now compute its frequency with <span class="mono">n=1</span>, <span class="mono">L=1√ó10‚Åª‚Å∂ m</span>:
        </p>

        <p class="mono">
          First compute the prefactor: <br/>
          <span class="mono">c/(2 n L) = 3.00√ó10^8 / (2¬∑1¬∑1√ó10^-6) = 1.50√ó10^14 Hz</span>.
        </p>

        <p class="mono">
          Then <span class="mono">f111 = (1.50√ó10^14) ‚àö3 = 1.50√ó10^14 ¬∑ 1.732 = 2.60√ó10^14 Hz</span>
          <br/>‚áí <span class="mono">f111 ‚âà 260 THz</span>.
        </p>

        <h3>(a) Step 5: Next-higher frequency (next smallest distinct shell)</h3>
        <p>
          We need the next smallest <span class="mono">S</span> above 3. Try increasing one index from 1 to 2:
        </p>
        <ul>
          <li><span class="mono">(2,1,1)</span> gives <span class="mono">S=4+1+1=6</span>.</li>
          <li>Any other combination with integers ‚â• 1 has <span class="mono">S ‚â• 6</span> (e.g., <span class="mono">(2,2,1)</span> gives 9, etc.).</li>
        </ul>
        <p>
          So the <b>next-higher frequency shell</b> is <span class="mono">S=6</span>, represented by
          <span class="mono">(2,1,1)</span> and its permutations:
          <span class="mono">(2,1,1), (1,2,1), (1,1,2)</span>.
        </p>

        <p class="mono">
          Compute the frequency:
          <br/>
          <span class="mono">f211 = (c/(2nL)) ‚àö6 = (1.50√ó10^14) ¬∑ 2.449 = 3.67√ó10^14 Hz</span>
          <br/>‚áí <span class="mono">f211 ‚âà 367 THz</span>.
        </p>

        <h3>(b) Step 6: Spontaneous emission into a specific mode vs a frequency</h3>
        <p>
          Let:
        </p>
        <ul>
          <li><span class="mono">p_sp1</span> = probability density (s‚Åª¬π) to emit into the <b>specific</b> mode <span class="mono">(2,1,1)</span>.</li>
          <li><span class="mono">p_sp2</span> = probability density (s‚Åª¬π) to emit a photon with <b>frequency</b> 367 THz (i.e., into <b>any</b> mode in that degenerate shell).</li>
        </ul>
        <p>
          The frequency <span class="mono">367 THz</span> corresponds to the shell <span class="mono">S=6</span>.
          In a cube, the distinct spatial mode patterns at <span class="mono">S=6</span> are the three permutations:
        </p>
        <div class="eq" data-copy="Degenerate modes at f = 367 THz: (2,1,1), (1,2,1), (1,1,2)  ‚Üí degeneracy g = 3">
          <button class="copy" type="button">Copy</button>
          <div class="mono">Degenerate modes at f = 367 THz: (2,1,1), (1,2,1), (1,1,2)  ‚Üí degeneracy g = 3</div>
        </div>
        <p>
          Under the standard assumption that these symmetry-related modes have equal emission probability density,
          the probability density to emit at that frequency is the <b>sum</b> over the three modes:
        </p>
        <div class="eq" data-copy="p_sp2 = p[(2,1,1)] + p[(1,2,1)] + p[(1,1,2)] = 3 p_sp1">
          <button class="copy" type="button">Copy</button>
          <div class="mono">p_sp2 = p[(2,1,1)] + p[(1,2,1)] + p[(1,1,2)] = 3 p_sp1</div>
        </div>

        <div class="answerBox" id="finalAnswerBox">
          <button class="copyFinal" type="button">Copy final</button>
          <h3>Final Answers (boxed)</h3>
          <div class="answerText" id="finalAnswerText">Part (a)
Lowest-frequency mode: (q1,q2,q3) = (1,1,1)
f_111 = (c/(2 n L)) ‚àö3 = 2.60√ó10^14 Hz ‚âà 260 THz  (for L=1 Œºm, n=1)

Next-higher frequency shell: (2,1,1) and permutations
(q1,q2,q3) = (2,1,1), (1,2,1), (1,1,2)
f_211 = (c/(2 n L)) ‚àö6 = 3.67√ó10^14 Hz ‚âà 367 THz

Part (b)
Degeneracy at 367 THz is g = 3, so:
p_sp2 / p_sp1 = 3</div>
        </div>

        <h3>Sanity checks</h3>
        <ul>
          <li><b>Units:</b> <span class="mono">c/(2nL)</span> has units <span class="mono">(m/s)/m = s‚Åª¬π</span>, so <span class="mono">f</span> is Hz. Good.</li>
          <li><b>Scaling:</b> if <span class="mono">L</span> increases, all frequencies decrease as <span class="mono">1/L</span>. This matches physical intuition.</li>
          <li><b>Ordering:</b> since <span class="mono">‚àö6 &gt; ‚àö3</span>, the (2,1,1) shell must be above (1,1,1). Good.</li>
          <li><b>Interpretation of the ratio:</b> ‚Äúemit at 367 THz‚Äù means ‚Äúany of the 3 distinct spatial patterns at that frequency‚Äù ‚Üí factor of 3. Good.</li>
        </ul>

        <p class="highlight">
          Connection to the visuals below: the diagram shows the cube and how mode numbers count half-wavelengths along each axis.
          The plots show how frequencies cluster into shells of constant <span class="mono">S=q1¬≤+q2¬≤+q3¬≤</span> and how degeneracy determines summed emission probability at a given frequency.
        </p>

        <div class="vizWrap" aria-label="Interactive visualizations">
          <div class="controls" aria-label="Interactive controls">
            <div class="control">
              <label for="Lslider">
                Cavity side length <span class="mono">L</span> (Œºm)
                <span class="val" id="Lval">1.00</span>
              </label>
              <input id="Lslider" type="range" min="0.50" max="2.50" step="0.01" value="1.00" />
              <div style="color:var(--faint); font-size:.85rem; margin-top:6px;">
                Changes all mode frequencies via <span class="mono">f ‚àù 1/L</span>.
              </div>
            </div>

            <div class="control">
              <label for="nslider">
                Refractive index <span class="mono">n</span>
                <span class="val" id="nval">1.00</span>
              </label>
              <input id="nslider" type="range" min="1.00" max="2.20" step="0.01" value="1.00" />
              <div style="color:var(--faint); font-size:.85rem; margin-top:6px;">
                Changes wave speed: <span class="mono">f ‚àù 1/n</span>.
              </div>
            </div>

            <div class="control">
              <label for="emSelect">
                Emission scaling model (for plot)
                <span class="val" id="emVal">degeneracy only</span>
              </label>
              <select id="emSelect">
                <option value="deg">Degeneracy only (shell counts)</option>
                <option value="omega">Degeneracy √ó f (‚àù œâ)</option>
                <option value="omega3">Degeneracy √ó f¬≥ (‚àù œâ¬≥)</option>
              </select>
              <button class="small" id="resetBtn" type="button">Reset to problem values</button>
            </div>
          </div>

          <div class="vizRow">
            <figure>
              <canvas id="diagram"></canvas>
              <figcaption>
                <b>Diagram:</b> cubic cavity (side <span class="mono">L</span>) and standing-wave mode numbers <span class="mono">(q1,q2,q3)</span> as half-wavelength counts.
              </figcaption>
            </figure>

            <figure>
              <canvas id="plot1"></canvas>
              <figcaption>
                <b>Main plot:</b> discrete mode frequencies <span class="mono">f(q1,q2,q3)</span> for small integer modes (up to <span class="mono">q ‚â§ 4</span>), showing the lowest shell (<span class="mono">111</span>) and next shell (<span class="mono">211</span> permutations).
              </figcaption>
            </figure>
          </div>

          <figure>
            <canvas id="plot2"></canvas>
            <figcaption>
              <b>Secondary plot:</b> ‚Äúemission weight‚Äù vs frequency shell (example visualization). It sums over degenerate modes at each frequency; the ratio at 367 THz is set by degeneracy (<span class="mono">3</span> modes).
            </figcaption>
          </figure>
        </div>
      </section>

      <section id="part4">
        <h2>PART 4 ‚Äî Deeper Understanding (THEORY AROUND THE RESULT)</h2>

        <h3>Re-interpreting the final formula</h3>
        <p>
          The mode frequency
          <span class="mono">f = (c/(2nL)) ‚àö(q1¬≤+q2¬≤+q3¬≤)</span>
          separates cleanly into:
        </p>
        <ul>
          <li><b>Geometry/material scale:</b> <span class="mono">c/(2nL)</span> sets the base frequency scale.</li>
          <li><b>Integer geometry:</b> <span class="mono">‚àö(q1¬≤+q2¬≤+q3¬≤)</span> picks out the ‚Äúshell‚Äù in mode space.</li>
        </ul>

        <h3>How parameters affect outcomes (connect to plots)</h3>
        <ul>
          <li>Increase <span class="mono">L</span> ‚Üí all dots in the frequency plot move downward (inverse scaling).</li>
          <li>Increase <span class="mono">n</span> ‚Üí frequencies also move downward (slower wave speed).</li>
          <li>Degeneracy creates ‚Äújumps‚Äù in the secondary plot: more modes at the same frequency means larger summed emission probability density.</li>
        </ul>

        <h3>Alternative derivation idea (brief)</h3>
        <p>
          You can derive the same frequency relation by thinking in wavelengths:
          a standing wave along x fits <span class="mono">q1</span> half-wavelengths, so <span class="mono">Œªx = 2L/q1</span> (and similarly for y,z).
          Then the 3D wavevector magnitude satisfies
          <span class="mono">1/Œª¬≤ = 1/Œªx¬≤ + 1/Œªy¬≤ + 1/Œªz¬≤</span>,
          which leads directly to <span class="mono">Œª = 2L/‚àö(q1¬≤+q2¬≤+q3¬≤)</span> and thus the same <span class="mono">f=c/(nŒª)</span>.
        </p>

        <h3>Concept check (quick self-test)</h3>
        <ul>
          <li><b>Q:</b> Why is <span class="mono">(2,1,1)</span> not three times the frequency of <span class="mono">(1,1,1)</span>?<br/>
              <b>A:</b> Frequency scales with <span class="mono">‚àö(q1¬≤+q2¬≤+q3¬≤)</span>, not with the sum of the indices.</li>
          <li><b>Q:</b> If the cavity side doubles, what happens to 260 THz?<br/>
              <b>A:</b> It halves to 130 THz because <span class="mono">f ‚àù 1/L</span>.</li>
          <li><b>Q:</b> Why does <span class="mono">p_sp2</span> exceed <span class="mono">p_sp1</span>?<br/>
              <b>A:</b> <span class="mono">p_sp2</span> includes multiple distinct final modes at the same frequency; probabilities add.</li>
          <li><b>Q:</b> What is the key reason the ratio is an integer here?<br/>
              <b>A:</b> It‚Äôs a pure degeneracy count (number of symmetry-related modes in the shell).</li>
        </ul>
      </section>

      <section id="part5">
        <h2>PART 5 ‚Äî Visualization Guide (HOW TO READ THE PLOTS)</h2>
        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Diagram canvas:</b> A cube labeled with axes. The integers <span class="mono">q1,q2,q3</span> indicate how many half-wavelengths fit along x,y,z for a standing wave.</li>
          <li><b>Main plot (Mode frequencies):</b> Scatter of frequencies for all modes with <span class="mono">1 ‚â§ q1,q2,q3 ‚â§ 4</span>. Points are colored by shell <span class="mono">S=q1¬≤+q2¬≤+q3¬≤</span>. The two textbook targets (260 THz, 367 THz) are highlighted.</li>
          <li><b>Secondary plot (Shell emission weight):</b> Bars/points summarizing a chosen ‚Äúemission weight‚Äù per frequency shell. At minimum, it reflects degeneracy; optional models multiply by <span class="mono">f</span> or <span class="mono">f¬≥</span> to show how frequency-dependent coupling would further bias emission (purely for visualization).</li>
        </ul>

        <h3>Interactive controls</h3>
        <ul>
          <li><b>Slider <span class="mono">L</span>:</b> changes cavity size; all frequencies update as <span class="mono">f ‚àù 1/L</span>.</li>
          <li><b>Slider <span class="mono">n</span>:</b> changes refractive index; all frequencies update as <span class="mono">f ‚àù 1/n</span>.</li>
          <li><b>Select ‚Äúemission scaling model‚Äù:</b> changes only the secondary plot‚Äôs weighting rule. The core degeneracy fact (ratio 3 at 367 THz) remains visible in the shell counts.</li>
        </ul>

        <p class="highlight">
          To reproduce the problem‚Äôs numbers, set <span class="mono">L=1.00 Œºm</span> and <span class="mono">n=1.00</span> (or press ‚ÄúReset‚Äù).
          You‚Äôll see the lowest shell at ~260 THz and the next shell at ~367 THz.
        </p>
      </section>

    </div>
  </article>
</main>

<footer>
  Built as a self-contained teaching page (vanilla HTML/CSS/JS). The visuals are illustrative and update in real time; the analytic answers are exact within the stated assumptions.
</footer>

<script>
(function(){
  // ---------- Utilities ----------
  const TAU = Math.PI * 2;

  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  function niceNum(range, round){
    // Nice numbers for tick steps (1,2,5)*10^n
    const exp = Math.floor(Math.log10(range));
    const frac = range / Math.pow(10, exp);
    let niceFrac;
    if(round){
      if(frac < 1.5) niceFrac = 1;
      else if(frac < 3) niceFrac = 2;
      else if(frac < 7) niceFrac = 5;
      else niceFrac = 10;
    } else {
      if(frac <= 1) niceFrac = 1;
      else if(frac <= 2) niceFrac = 2;
      else if(frac <= 5) niceFrac = 5;
      else niceFrac = 10;
    }
    return niceFrac * Math.pow(10, exp);
  }

  function ticks(min, max, count=6){
    const range = niceNum(max-min, false);
    const step = niceNum(range/(count-1), true);
    const graphMin = Math.floor(min/step)*step;
    const graphMax = Math.ceil(max/step)*step;
    const arr = [];
    for(let v = graphMin; v <= graphMax + 0.5*step; v += step) arr.push(v);
    return {step, graphMin, graphMax, arr};
  }

  function dprCanvas(canvas){
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.max(1, Math.floor(rect.width * dpr));
    canvas.height = Math.max(1, Math.floor(rect.height * dpr));
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
    return ctx;
  }

  function drawAxes(ctx, box, xLabel, yLabel, xTicks, yTicks, title){
    const {x,y,w,h} = box;
    // panel
    ctx.save();
    ctx.globalAlpha = 1;
    // Title
    ctx.fillStyle = 'rgba(230,238,252,0.92)';
    ctx.font = '600 14px ui-sans-serif, system-ui';
    ctx.fillText(title, x, y - 10);

    // Grid + ticks
    ctx.strokeStyle = 'rgba(255,255,255,0.10)';
    ctx.lineWidth = 1;

    // grid y
    yTicks.arr.forEach(v=>{
      const yy = y + h - (v - yTicks.graphMin) / (yTicks.graphMax - yTicks.graphMin) * h;
      ctx.beginPath();
      ctx.moveTo(x, yy);
      ctx.lineTo(x+w, yy);
      ctx.stroke();
    });
    // grid x
    xTicks.arr.forEach(v=>{
      const xx = x + (v - xTicks.graphMin) / (xTicks.graphMax - xTicks.graphMin) * w;
      ctx.beginPath();
      ctx.moveTo(xx, y);
      ctx.lineTo(xx, y+h);
      ctx.stroke();
    });

    // axes
    ctx.strokeStyle = 'rgba(255,255,255,0.22)';
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x, y+h);
    ctx.lineTo(x+w, y+h);
    ctx.stroke();

    // tick labels
    ctx.fillStyle = 'rgba(169,183,209,0.95)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"';
    // y labels
    yTicks.arr.forEach(v=>{
      const yy = y + h - (v - yTicks.graphMin) / (yTicks.graphMax - yTicks.graphMin) * h;
      ctx.fillText(formatTick(v), x - 8 - ctx.measureText(formatTick(v)).width, yy + 4);
      // tick mark
      ctx.strokeStyle = 'rgba(255,255,255,0.22)';
      ctx.beginPath();
      ctx.moveTo(x-4, yy);
      ctx.lineTo(x, yy);
      ctx.stroke();
    });
    // x labels
    xTicks.arr.forEach(v=>{
      const xx = x + (v - xTicks.graphMin) / (xTicks.graphMax - xTicks.graphMin) * w;
      const s = formatTick(v);
      const tw = ctx.measureText(s).width;
      ctx.fillText(s, xx - tw/2, y + h + 18);
      ctx.strokeStyle = 'rgba(255,255,255,0.22)';
      ctx.beginPath();
      ctx.moveTo(xx, y+h);
      ctx.lineTo(xx, y+h+4);
      ctx.stroke();
    });

    // axis labels
    ctx.fillStyle = 'rgba(230,238,252,0.85)';
    ctx.font = '600 12px ui-sans-serif, system-ui';
    ctx.fillText(xLabel, x + w/2 - ctx.measureText(xLabel).width/2, y + h + 40);

    ctx.save();
    ctx.translate(x - 48, y + h/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
    ctx.restore();

    ctx.restore();
  }

  function formatTick(v){
    // Keep readable for THz-ish scales and small scales
    const av = Math.abs(v);
    if(av >= 1000) return (v/1000).toFixed(0) + "k";
    if(av >= 100) return v.toFixed(0);
    if(av >= 10) return v.toFixed(0);
    if(av >= 1) return v.toFixed(1);
    return v.toFixed(2);
  }

  function mapX(v, xTicks, box){
    const {x,w} = box;
    return x + (v - xTicks.graphMin) / (xTicks.graphMax - xTicks.graphMin) * w;
  }
  function mapY(v, yTicks, box){
    const {y,h} = box;
    return y + h - (v - yTicks.graphMin) / (yTicks.graphMax - yTicks.graphMin) * h;
  }

  // ---------- Physics ----------
  const c = 3.0e8; // m/s

  function fModeTHz(q1,q2,q3, L_um, n){
    const L = L_um * 1e-6;
    const S = q1*q1 + q2*q2 + q3*q3;
    const f = (c/(2*n*L)) * Math.sqrt(S); // Hz
    return f / 1e12; // THz
  }

  function generateModes(qMax, L_um, n){
    const modes = [];
    for(let q1=1; q1<=qMax; q1++){
      for(let q2=1; q2<=qMax; q2++){
        for(let q3=1; q3<=qMax; q3++){
          const S = q1*q1+q2*q2+q3*q3;
          const f = fModeTHz(q1,q2,q3,L_um,n);
          modes.push({q1,q2,q3,S,f, label:`(${q1},${q2},${q3})`});
        }
      }
    }
    modes.sort((a,b)=>a.f-b.f);
    return modes;
  }

  function groupByShell(modes){
    // group by S; each S corresponds to one frequency shell for fixed L,n
    const map = new Map();
    modes.forEach(m=>{
      if(!map.has(m.S)) map.set(m.S, {S:m.S, f:m.f, modes:[]});
      map.get(m.S).modes.push(m);
    });
    const shells = Array.from(map.values()).sort((a,b)=>a.f-b.f);
    // Update f per shell as average of members (should be equal)
    shells.forEach(sh=>{
      sh.f = sh.modes.reduce((s,m)=>s+m.f,0)/sh.modes.length;
      sh.g = sh.modes.length; // degeneracy in this qMax-limited set
    });
    return shells;
  }

  function weightShell(shell, model){
    // For visualization only: degeneracy-only or times f or f^3
    if(model === 'deg') return shell.g;
    if(model === 'omega') return shell.g * shell.f;
    if(model === 'omega3') return shell.g * Math.pow(shell.f,3);
    return shell.g;
  }

  // ---------- DOM ----------
  const Lslider = document.getElementById('Lslider');
  const nslider = document.getElementById('nslider');
  const Lval = document.getElementById('Lval');
  const nval = document.getElementById('nval');
  const emSelect = document.getElementById('emSelect');
  const emVal = document.getElementById('emVal');
  const resetBtn = document.getElementById('resetBtn');

  const diagram = document.getElementById('diagram');
  const plot1 = document.getElementById('plot1');
  const plot2 = document.getElementById('plot2');

  function setUI(L_um, n){
    Lslider.value = L_um.toFixed(2);
    nslider.value = n.toFixed(2);
    Lval.textContent = (+Lslider.value).toFixed(2);
    nval.textContent = (+nslider.value).toFixed(2);
    emVal.textContent = (emSelect.value==='deg' ? 'degeneracy only' :
                         emSelect.value==='omega' ? 'degeneracy √ó f' :
                         'degeneracy √ó f¬≥');
  }

  // ---------- Drawing: Diagram ----------
  function drawDiagram(L_um, n){
    const ctx = dprCanvas(diagram);
    const W = diagram.getBoundingClientRect().width;
    const H = diagram.getBoundingClientRect().height;

    ctx.clearRect(0,0,W,H);

    // Title
    ctx.fillStyle = 'rgba(230,238,252,0.95)';
    ctx.font = '700 14px ui-sans-serif, system-ui';
    ctx.fillText('Cubic cavity geometry & mode indices', 14, 24);

    // Cube in pseudo-3D
    const cx = W*0.42, cy = H*0.55;
    const s = Math.min(W,H)*0.32;
    const dx = s*0.35, dy = -s*0.25;

    const front = [
      {x:cx-s/2, y:cy-s/2},
      {x:cx+s/2, y:cy-s/2},
      {x:cx+s/2, y:cy+s/2},
      {x:cx-s/2, y:cy+s/2},
    ];
    const back = front.map(p=>({x:p.x+dx, y:p.y+dy}));

    // edges
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(255,255,255,0.22)';
    ctx.beginPath();
    // front square
    ctx.moveTo(front[0].x, front[0].y);
    for(let i=1;i<4;i++) ctx.lineTo(front[i].x, front[i].y);
    ctx.closePath();
    // back square
    ctx.moveTo(back[0].x, back[0].y);
    for(let i=1;i<4;i++) ctx.lineTo(back[i].x, back[i].y);
    ctx.closePath();
    // connectors
    for(let i=0;i<4;i++){
      ctx.moveTo(front[i].x, front[i].y);
      ctx.lineTo(back[i].x, back[i].y);
    }
    ctx.stroke();

    // axes arrows
    function arrow(x1,y1,x2,y2, label){
      ctx.strokeStyle = 'rgba(125,211,252,0.85)';
      ctx.fillStyle = 'rgba(125,211,252,0.85)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.lineTo(x2,y2);
      ctx.stroke();
      const ang = Math.atan2(y2-y1, x2-x1);
      const ah = 8;
      ctx.beginPath();
      ctx.moveTo(x2,y2);
      ctx.lineTo(x2-ah*Math.cos(ang-0.5), y2-ah*Math.sin(ang-0.5));
      ctx.lineTo(x2-ah*Math.cos(ang+0.5), y2-ah*Math.sin(ang+0.5));
      ctx.closePath();
      ctx.fill();
      ctx.font = '600 12px ui-sans-serif, system-ui';
      ctx.fillText(label, x2+6, y2+4);
    }

    // anchor near front-bottom-left
    const ox = front[3].x, oy = front[3].y;
    arrow(ox,oy, ox+s*0.55, oy, 'x (q1)');
    arrow(ox,oy, ox, oy-s*0.55, 'y (q2)');
    arrow(ox,oy, ox+dx*0.85, oy+dy*0.85, 'z (q3)');

    // Standing wave sketch inside: three sinusoids along edges
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(167,139,250,0.65)';
    function sineAlong(x1,y1,x2,y2, cycles){
      const N=90;
      ctx.beginPath();
      for(let i=0;i<=N;i++){
        const t=i/N;
        const x=x1+(x2-x1)*t;
        const y=y1+(y2-y1)*t;
        const nx=-(y2-y1), ny=(x2-x1);
        const norm=Math.hypot(nx,ny)||1;
        const amp=6*Math.sin(Math.PI*t*cycles);
        const xx=x + (nx/norm)*amp;
        const yy=y + (ny/norm)*amp;
        if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
      }
      ctx.stroke();
    }
    // show example: 1,1,1 half-wave count (one half-wave per axis)
    sineAlong(front[3].x, front[3].y, front[2].x, front[2].y, 1);
    sineAlong(front[3].x, front[3].y, front[0].x, front[0].y, 1);
    sineAlong(front[3].x, front[3].y, back[3].x, back[3].y, 1);

    // Annotations
    ctx.fillStyle = 'rgba(169,183,209,0.95)';
    ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"';
    ctx.fillText(`L = ${L_um.toFixed(2)} Œºm`, 14, H-44);
    ctx.fillText(`n = ${n.toFixed(2)}`, 14, H-26);

    // Key formula note
    ctx.fillStyle = 'rgba(230,238,252,0.80)';
    ctx.font = '600 12px ui-sans-serif, system-ui';
    ctx.fillText('Mode frequency:  f = (c/(2 n L)) ‚àö(q1¬≤+q2¬≤+q3¬≤)', 14, 46);
  }

  // ---------- Drawing: Plot 1 (mode frequencies scatter) ----------
  function drawPlot1(modes, L_um, n){
    const ctx = dprCanvas(plot1);
    const W = plot1.getBoundingClientRect().width;
    const H = plot1.getBoundingClientRect().height;
    ctx.clearRect(0,0,W,H);

    // Determine domain/range
    const xMin = 0.8, xMax = 10.5; // S values shown
    const fVals = modes.map(m=>m.f);
    const yMin0 = Math.min(...fVals);
    const yMax0 = Math.max(...fVals);
    const pad = 0.08*(yMax0-yMin0);
    const yMin = Math.max(0, yMin0 - pad);
    const yMax = yMax0 + pad;

    const box = {x:66, y:56, w: W-96, h: H-116};

    const xTicks = ticks(xMin, xMax, 6);
    const yTicks = ticks(yMin, yMax, 6);

    drawAxes(ctx, box, 'Shell index S = q1¬≤+q2¬≤+q3¬≤ (dimensionless)', 'Frequency f (THz)', xTicks, yTicks, 'Discrete cavity mode frequencies (q ‚â§ 4)');

    // Legend
    ctx.save();
    ctx.font = '12px ui-sans-serif, system-ui';
    ctx.fillStyle = 'rgba(230,238,252,0.85)';
    ctx.fillText('Highlights: 111 (lowest) and 211-permutations (next shell)', box.x, box.y - 26);
    ctx.restore();

    // Draw points
    function shellColor(S){
      // deterministic hue-like mix without setting an explicit palette
      // Use alpha changes for visual separation
      const a = 0.55 + 0.35 * ((S % 7)/6);
      return `rgba(125,211,252,${a})`;
    }

    // all points
    modes.forEach(m=>{
      const xx = mapX(m.S, xTicks, box);
      const yy = mapY(m.f, yTicks, box);
      ctx.beginPath();
      ctx.fillStyle = shellColor(m.S);
      ctx.arc(xx, yy, 3.0, 0, TAU);
      ctx.fill();
    });

    // Highlight 111 and 211 (and permutations)
    const f111 = fModeTHz(1,1,1,L_um,n);
    const f211 = fModeTHz(2,1,1,L_um,n);

    // horizontal reference lines
    ctx.save();
    ctx.strokeStyle = 'rgba(52,211,153,0.35)';
    ctx.lineWidth = 2;
    let yy = mapY(f111, yTicks, box);
    ctx.beginPath(); ctx.moveTo(box.x, yy); ctx.lineTo(box.x+box.w, yy); ctx.stroke();
    ctx.strokeStyle = 'rgba(251,191,36,0.35)';
    yy = mapY(f211, yTicks, box);
    ctx.beginPath(); ctx.moveTo(box.x, yy); ctx.lineTo(box.x+box.w, yy); ctx.stroke();

    // labels
    ctx.fillStyle = 'rgba(231,255,246,0.92)';
    ctx.font = '600 12px ui-sans-serif, system-ui';
    ctx.fillText(`f(1,1,1) ‚âà ${f111.toFixed(1)} THz`, box.x + 8, mapY(f111, yTicks, box) - 6);
    ctx.fillStyle = 'rgba(253,230,138,0.92)';
    ctx.fillText(`f(2,1,1) ‚âà ${f211.toFixed(1)} THz`, box.x + 8, mapY(f211, yTicks, box) - 6);

    // mark the specific modes in the scatter
    function mark(S, f, label, color){
      const xx = mapX(S, xTicks, box);
      const yy = mapY(f, yTicks, box);
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(xx, yy, 7, 0, TAU);
      ctx.stroke();
      ctx.fillStyle = color;
      ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas';
      ctx.fillText(label, xx + 10, yy + 4);
    }
    mark(3, f111, '111', 'rgba(52,211,153,0.95)');
    mark(6, f211, '211', 'rgba(251,191,36,0.95)');

    ctx.restore();
  }

  // ---------- Drawing: Plot 2 (shell weights / degeneracy) ----------
  function drawPlot2(shells, model){
    const ctx = dprCanvas(plot2);
    const W = plot2.getBoundingClientRect().width;
    const H = plot2.getBoundingClientRect().height;
    ctx.clearRect(0,0,W,H);

    const box = {x:66, y:56, w: W-96, h: H-116};

    // take first several shells to keep readable
    const shown = shells.slice(0, 10);
    const xVals = shown.map(s=>s.f);
    const yVals = shown.map(s=>weightShell(s, model));

    const xMin0 = Math.min(...xVals), xMax0 = Math.max(...xVals);
    const yMin0 = 0, yMax0 = Math.max(...yVals) * 1.12;

    const xTicks = ticks(xMin0, xMax0, 6);
    const yTicks = ticks(yMin0, yMax0, 6);

    const title = (model==='deg')
      ? 'Shell ‚Äúemission weight‚Äù vs frequency (degeneracy only)'
      : (model==='omega')
        ? 'Shell ‚Äúemission weight‚Äù vs frequency (degeneracy √ó f)'
        : 'Shell ‚Äúemission weight‚Äù vs frequency (degeneracy √ó f¬≥)';

    drawAxes(ctx, box, 'Frequency f (THz)', 'Relative shell weight (arb.)', xTicks, yTicks, title);

    // Draw bars
    const barW = Math.max(10, box.w / shown.length * 0.55);
    shown.forEach((s, i)=>{
      const x = mapX(s.f, xTicks, box);
      const y = mapY(weightShell(s, model), yTicks, box);
      const y0 = mapY(0, yTicks, box);
      const h = y0 - y;

      ctx.fillStyle = 'rgba(167,139,250,0.35)';
      ctx.strokeStyle = 'rgba(167,139,250,0.75)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.rect(x - barW/2, y, barW, h);
      ctx.fill();
      ctx.stroke();

      // annotate degeneracy
      ctx.fillStyle = 'rgba(230,238,252,0.78)';
      ctx.font = '11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas';
      ctx.fillText(`g=${s.g}`, x - barW/2 + 4, y - 6);

      // mark the S value near bottom
      ctx.fillStyle = 'rgba(169,183,209,0.80)';
      ctx.font = '11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas';
      ctx.fillText(`S=${s.S}`, x - barW/2 + 4, y0 + 14);
    });

    // highlight the 367 THz shell (S=6) if present
    const target = shown.find(s=>s.S===6);
    if(target){
      const x = mapX(target.f, xTicks, box);
      const yTop = box.y;
      const yBot = box.y + box.h;
      ctx.strokeStyle = 'rgba(251,191,36,0.55)';
      ctx.lineWidth = 2;
      ctx.setLineDash([6,6]);
      ctx.beginPath();
      ctx.moveTo(x, yTop);
      ctx.lineTo(x, yBot);
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.fillStyle = 'rgba(253,230,138,0.92)';
      ctx.font = '600 12px ui-sans-serif, system-ui';
      ctx.fillText('S=6 (367 THz) shell', x + 6, yTop + 14);

      ctx.fillStyle = 'rgba(253,230,138,0.88)';
      ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas';
      ctx.fillText('Degeneracy g=3 ‚áí p(f)/p(2,1,1)=3', x + 6, yTop + 32);
    }

    // legend note
    ctx.fillStyle = 'rgba(169,183,209,0.90)';
    ctx.font = '12px ui-sans-serif, system-ui';
    ctx.fillText('Note: weights are illustrative; the ratio in the problem comes from degeneracy at S=6.', box.x, box.y - 26);
  }

  // ---------- Interactivity ----------
  function recomputeAndDraw(){
    const L_um = +Lslider.value;
    const n = +nslider.value;
    Lval.textContent = L_um.toFixed(2);
    nval.textContent = n.toFixed(2);
    emVal.textContent = (emSelect.value==='deg' ? 'degeneracy only' :
                         emSelect.value==='omega' ? 'degeneracy √ó f' :
                         'degeneracy √ó f¬≥');

    drawDiagram(L_um, n);

    const modes = generateModes(4, L_um, n);
    drawPlot1(modes, L_um, n);

    const shells = groupByShell(modes);
    drawPlot2(shells, emSelect.value);
  }

  // Resize handling
  let resizeTimer = null;
  window.addEventListener('resize', ()=>{
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(recomputeAndDraw, 80);
  });

  Lslider.addEventListener('input', recomputeAndDraw);
  nslider.addEventListener('input', recomputeAndDraw);
  emSelect.addEventListener('change', recomputeAndDraw);

  resetBtn.addEventListener('click', ()=>{
    emSelect.value = 'deg';
    setUI(1.00, 1.00);
    recomputeAndDraw();
  });

  // ---------- Copy buttons ----------
  function attachCopy(){
    document.querySelectorAll('.eq').forEach(eq=>{
      const btn = eq.querySelector('.copy');
      if(!btn) return;
      btn.addEventListener('click', async ()=>{
        const txt = eq.getAttribute('data-copy') || eq.innerText;
        try{
          await navigator.clipboard.writeText(txt.trim());
          btn.textContent = 'Copied';
          setTimeout(()=>btn.textContent='Copy', 900);
        }catch(e){
          btn.textContent = 'Copy failed';
          setTimeout(()=>btn.textContent='Copy', 900);
        }
      });
    });

    const copyFinal = document.querySelector('.copyFinal');
    const finalText = document.getElementById('finalAnswerText');
    if(copyFinal && finalText){
      copyFinal.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(finalText.textContent.trim());
          copyFinal.textContent = 'Copied';
          setTimeout(()=>copyFinal.textContent='Copy final', 900);
        }catch(e){
          copyFinal.textContent = 'Copy failed';
          setTimeout(()=>copyFinal.textContent='Copy final', 900);
        }
      });
    }
  }

  // Init
  setUI(1.00, 1.00);
  attachCopy();
  recomputeAndDraw();

})();
</script>
</body>
</html>
