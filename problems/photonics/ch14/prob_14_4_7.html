<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Stefan–Boltzmann Law from Planck’s Spectrum (Derivation + Interactive Plots)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#101a33;
      --panel2:#0f1730;
      --text:#e8eefc;
      --muted:#aab7e6;
      --faint:#6f7bb3;
      --accent:#7cf0c5;
      --accent2:#9aa8ff;
      --warn:#ffd166;
      --bad:#ff6b6b;
      --ok:#7cf0c5;
      --border:rgba(255,255,255,0.10);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 30% 10%, rgba(124,240,197,0.12), transparent 60%),
                  radial-gradient(1100px 800px at 80% 20%, rgba(154,168,255,0.12), transparent 60%),
                  linear-gradient(180deg, #070a14, var(--bg));
      color:var(--text);
      line-height:1.55;
    }
    header{
      padding:28px 18px 14px;
      max-width:1180px;
      margin:0 auto;
    }
    .title-wrap{
      display:grid;
      grid-template-columns: 1.3fr 0.7fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .title-wrap{grid-template-columns:1fr}
    }
    .hero{
      background: linear-gradient(135deg, rgba(124,240,197,0.10), rgba(154,168,255,0.10));
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:18px 18px 16px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(500px 180px at 20% 20%, rgba(124,240,197,0.20), transparent 70%),
                  radial-gradient(520px 220px at 80% 40%, rgba(154,168,255,0.18), transparent 70%);
      filter: blur(0px);
      opacity:0.9;
      pointer-events:none;
    }
    .hero > *{position:relative}
    h1{
      margin:0 0 8px;
      font-size: clamp(22px, 2.3vw, 34px);
      letter-spacing:0.2px;
    }
    .sub{
      color:var(--muted);
      margin:0;
      font-size: 14.5px;
    }
    .meta-card{
      background: rgba(16,26,51,0.75);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px 14px 12px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.18);
      color:var(--muted);
      font-size:12.5px;
      width:max-content;
    }
    .pill b{color:var(--text); font-weight:650}
    main{
      max-width:1180px;
      margin:0 auto;
      padding: 10px 18px 44px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 980px){
      main{grid-template-columns:1fr}
    }
    nav.toc{
      position: sticky;
      top: 10px;
      align-self:start;
      background: rgba(16,26,51,0.70);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    @media print{
      nav.toc{display:none}
      body{background:white; color:#111}
      .card, .hero, .meta-card{box-shadow:none}
    }
    .toc h2{
      margin:0 0 10px;
      font-size:14px;
      color:var(--text);
      letter-spacing:0.2px;
    }
    .toc a{
      display:block;
      padding:7px 8px;
      margin:2px 0;
      border-radius:10px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid transparent;
      font-size:13px;
    }
    .toc a:hover{
      background: rgba(124,240,197,0.08);
      border-color: rgba(124,240,197,0.18);
      color:var(--text);
    }
    .content{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    section{
      scroll-margin-top: 14px;
    }
    .card{
      background: rgba(16,26,51,0.62);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 16px 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    h2{
      margin:0 0 10px;
      font-size: 18px;
      letter-spacing:0.2px;
    }
    h3{
      margin: 14px 0 8px;
      font-size: 15.5px;
      color: var(--text);
    }
    p{margin: 8px 0; color: var(--text)}
    ul{margin:8px 0 8px 20px; color:var(--text)}
    li{margin:6px 0}
    .muted{color:var(--muted)}
    .eq{
      font-family:var(--mono);
      background: rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.12);
      padding: 2px 6px;
      border-radius: 10px;
      display:inline-block;
      white-space: nowrap;
    }
    .eqblock{
      display:block;
      padding:10px 12px;
      margin:10px 0;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      overflow-x:auto;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width: 780px){
      .grid2{grid-template-columns:1fr}
    }
    .callout{
      border-radius: var(--radius);
      padding: 12px 12px 10px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(124,240,197,0.08), rgba(154,168,255,0.06));
    }
    .callout h3{margin-top:0}
    .callout.assumptions{border-color: rgba(124,240,197,0.25)}
    .callout.mistakes{border-color: rgba(255,209,102,0.25)}
    .callout.final{border-color: rgba(124,240,197,0.35); background: linear-gradient(180deg, rgba(124,240,197,0.12), rgba(0,0,0,0.20))}
    .kpi{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top:8px;
    }
    .kpi .box{
      flex: 1 1 170px;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.18);
      border-radius: 14px;
      padding:10px 10px 8px;
    }
    .kpi .label{color:var(--muted); font-size:12px}
    .kpi .value{font-family:var(--mono); font-size:13.5px; margin-top:6px}
    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: rgba(0,0,0,0.20);
    }
    .controls label{color:var(--muted); font-size:13px}
    input[type="range"]{width: 280px; max-width: 100%;}
    .btn{
      border:1px solid var(--border);
      background: rgba(124,240,197,0.10);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-size:12.5px;
      transition: transform 120ms ease, background 120ms ease;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(124,240,197,0.16)}
    .copy-note{
      font-size:12px;
      color:var(--muted);
      margin-left:auto;
    }
    .viz{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .canvas-card{
      border:1px solid var(--border);
      background: rgba(0,0,0,0.18);
      border-radius: var(--radius);
      padding: 10px;
      overflow:hidden;
    }
    .canvas-title{
      display:flex; justify-content:space-between; align-items:baseline;
      padding: 4px 6px 8px;
      gap:10px;
    }
    .canvas-title b{font-size:13.5px}
    .canvas-title span{font-size:12px; color:var(--muted)}
    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius: 14px;
      background: rgba(11,16,32,0.65);
      border:1px solid rgba(255,255,255,0.10);
    }
    @media (max-width: 780px){ canvas{height:280px} }
    footer{
      max-width:1180px;
      margin:0 auto;
      padding: 0 18px 30px;
      color:var(--muted);
      font-size:12.5px;
    }
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      background: rgba(16,26,51,0.92);
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      opacity:0;
      pointer-events:none;
      transition: opacity 180ms ease, transform 180ms ease;
      font-size:12.5px;
      z-index:9999;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-3px);
    }
    .fade-in{
      animation: popIn 420ms ease both;
    }
    @keyframes popIn{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0px)}
    }
  </style>
</head>

<body>
  <header>
    <div class="title-wrap">
      <div class="hero fade-in">
        <h1>Stefan–Boltzmann Law from Planck’s Blackbody Spectrum</h1>
        <p class="sub">
          Starting from the spectral energy density of blackbody radiation
          <span class="eq">u(ν) = (8πhν³/c³)/(exp(hν/kT) − 1)</span>, we integrate over frequency and connect energy density to
          radiated power to show <span class="eq">j*(T) = σT⁴</span>.
        </p>
        <div class="kpi">
          <div class="box">
            <div class="label">Core goal</div>
            <div class="value">Show total emission ∝ T⁴</div>
          </div>
          <div class="box">
            <div class="label">Key substitution</div>
            <div class="value">x = hν/(kT)</div>
          </div>
          <div class="box">
            <div class="label">Hint integral</div>
            <div class="value">∫₀∞ x³/(eˣ−1) dx = π⁴/15</div>
          </div>
        </div>
      </div>

      <div class="meta-card fade-in">
        <div class="pill"><b>Topic</b> Thermal radiation</div>
        <div class="pill"><b>Tools</b> Planck spectrum → integrals</div>
        <div class="pill"><b>Result</b> Stefan–Boltzmann constant σ</div>
        <div class="pill"><b>Interactive</b> Temperature slider updates all plots</div>
      </div>
    </div>
  </header>

  <main>
    <nav class="toc fade-in" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <a href="#quick">Quick Summary</a>
      <a href="#part0">PART 0 — Concept Primer</a>
      <a href="#part1">PART 1 — Problem Analysis</a>
      <a href="#part2">PART 2 — Strategy & Tips</a>
      <a href="#part3">PART 3 — Full Solution</a>
      <a href="#part4">PART 4 — Deeper Understanding</a>
      <a href="#part5">PART 5 — Visualization Guide</a>
    </nav>

    <div class="content">
      <section id="quick" class="card fade-in">
        <h2>Quick Summary</h2>
        <ul>
          <li>We start from Planck’s <b>spectral energy density</b> (energy per volume per frequency): <span class="eq">u(ν)</span>.</li>
          <li>We integrate over all frequencies to get the <b>total energy density</b> <span class="eq">u(T)=∫₀∞ u(ν)dν</span>.</li>
          <li>Using the dimensionless variable <span class="eq">x = hν/(kT)</span>, the temperature dependence factors out as <span class="eq">T⁴</span>.</li>
          <li>The remaining integral is universal: <span class="eq">∫₀∞ x³/(eˣ−1)dx = π⁴/15</span>.</li>
          <li>To convert energy density to emitted power per area, for isotropic radiation we use <span class="eq">j* = (c/4)u</span>.</li>
          <li>Final result (symbolic): <span class="eq">j*(T) = σT⁴</span> with <span class="eq">σ = 2π⁵k⁴/(15h³c²)</span>.</li>
          <li>Numerical reference: <span class="eq">σ ≈ 5.67×10⁻⁸ W·m⁻²·K⁻⁴</span>.</li>
        </ul>

        <div class="controls" role="group" aria-label="Interactive controls">
          <label for="Tslider"><b>Temperature</b> T (K):</label>
          <input id="Tslider" type="range" min="300" max="8000" value="3000" step="10" />
          <span class="eq" id="Treadout">T = 3000 K</span>
          <button class="btn" id="resetBtn" type="button">Reset</button>
          <span class="copy-note">Tip: copy buttons are embedded near key equations.</span>
        </div>
      </section>

      <section id="part0" class="card fade-in">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <h3>Core definitions (symbols + units)</h3>
        <ul>
          <li><b>Frequency</b> <span class="eq">ν</span> (Hz): oscillations per second.</li>
          <li><b>Temperature</b> <span class="eq">T</span> (K): sets the thermal energy scale <span class="eq">kT</span>.</li>
          <li><b>Planck constant</b> <span class="eq">h</span> (J·s): quantum of action; photon energy is <span class="eq">E = hν</span>.</li>
          <li><b>Boltzmann constant</b> <span class="eq">k</span> (J/K): converts temperature to energy.</li>
          <li><b>Speed of light</b> <span class="eq">c</span> (m/s).</li>
          <li><b>Spectral energy density</b> <span class="eq">u(ν)</span> (J·m<sup>−3</sup>·Hz<sup>−1</sup>): energy per volume per frequency.</li>
          <li><b>Total energy density</b> <span class="eq">u(T)</span> (J·m<sup>−3</sup>): <span class="eq">u(T)=∫₀∞ u(ν)dν</span>.</li>
          <li><b>Radiant exitance (power per area)</b> <span class="eq">j*(T)</span> (W·m<sup>−2</sup>): total emitted power from a black surface.</li>
          <li><b>Stefan–Boltzmann constant</b> <span class="eq">σ</span> (W·m<sup>−2</sup>·K<sup>−4</sup>): the proportionality in <span class="eq">j*=σT⁴</span>.</li>
        </ul>

        <h3>Physical meaning</h3>
        <p>
          A blackbody is an ideal emitter/absorber in thermal equilibrium. Its radiation field is a “gas of photons”
          with a temperature-dependent distribution of energies. The function <span class="eq">u(ν)</span> tells you how
          the energy is spread across frequencies. Integrating over all <span class="eq">ν</span> gives the total energy density
          stored in the electromagnetic field. Turning that into an emitted power per area uses geometric/kinetic reasoning:
          only a fraction of photons travel outward through the surface, and their directions are isotropically distributed.
        </p>

        <h3>Key laws and validity conditions</h3>
        <ul>
          <li><b>Planck distribution</b> assumes thermal equilibrium and a large cavity (many modes).</li>
          <li><b>Photon energy quantization</b> <span class="eq">E=hν</span> is essential (classical equipartition fails: ultraviolet catastrophe).</li>
          <li><b>Isotropy</b>: in equilibrium inside a cavity, radiation has no preferred direction.</li>
          <li><b>Black surface</b>: emissivity = 1, so the surface emits the maximum allowed for that temperature.</li>
        </ul>

        <h3>Common models/approximations and why</h3>
        <ul>
          <li>Use <b>spectral integration</b> because total power is the sum over all frequencies.</li>
          <li>Use the substitution <span class="eq">x=hν/(kT)</span> to make the integral dimensionless (reveals the <span class="eq">T⁴</span> scaling).</li>
          <li>Use the relation <span class="eq">j*=(c/4)u</span> for isotropic radiation, analogous to kinetic theory (flux = speed × density × angular factor).</li>
        </ul>

        <h3>Mini intuition examples</h3>
        <ul>
          <li>If <span class="eq">T</span> increases, the spectrum shifts to higher <span class="eq">ν</span> (hotter objects look “bluer”).</li>
          <li>The <span class="eq">T⁴</span> law is steep: doubling <span class="eq">T</span> increases emitted power by <span class="eq">2⁴=16</span>.</li>
        </ul>

        <div class="callout mistakes">
          <h3>What to watch for (pitfalls)</h3>
          <ul>
            <li>Mixing up <b>energy density</b> (J/m³) with <b>radiated power per area</b> (W/m²).</li>
            <li>Forgetting the <span class="eq">c/4</span> factor (it comes from angular averaging in isotropic radiation).</li>
            <li>Not checking units after factoring out <span class="eq">T</span>.</li>
            <li>Confusing different Planck forms: per frequency <span class="eq">u(ν)</span> vs per wavelength <span class="eq">u(λ)</span> (their peaks differ).</li>
          </ul>
        </div>
      </section>

      <section id="part1" class="card fade-in">
        <h2>PART 1 — Problem Analysis (No solving yet)</h2>

        <h3>Problem restatement (in plain words)</h3>
        <p>
          You are given Planck’s spectral energy density for blackbody radiation (as a function of frequency).
          Use it to compute the total radiated power and confirm that it scales as <span class="eq">T⁴</span>,
          i.e., derive the Stefan–Boltzmann law and find the proportionality constant.
        </p>

        <h3>Given</h3>
        <ul>
          <li>Planck spectral energy density (per frequency):
            <div class="eqblock" id="eqPlanck">
              u(ν) = (8πhν³/c³) · 1/(exp(hν/(kT)) − 1)
            </div>
            <button class="btn" data-copy-target="eqPlanck">Copy equation</button>
          </li>
          <li>Hint integral:
            <div class="eqblock" id="eqHint">
              ∫₀∞ x³/(eˣ − 1) dx = π⁴/15
            </div>
            <button class="btn" data-copy-target="eqHint">Copy integral</button>
          </li>
        </ul>

        <h3>Unknowns</h3>
        <ul>
          <li>Total radiated power per area <span class="eq">j*(T)</span> (or radiant exitance).</li>
          <li>Proportionality constant <span class="eq">σ</span> in <span class="eq">j*(T)=σT⁴</span>.</li>
        </ul>

        <h3>What must be found / proved</h3>
        <ul>
          <li>Show <span class="eq">j*(T) ∝ T⁴</span>.</li>
          <li>Compute <span class="eq">σ</span> in terms of <span class="eq">h,k,c</span> (and optionally give a numerical value).</li>
        </ul>

        <h3>Relevant physical principles (and why they apply)</h3>
        <ul>
          <li><b>Planck distribution</b>: provides the equilibrium photon energy density per frequency.</li>
          <li><b>Integration over modes</b>: total energy density is the sum over all frequencies.</li>
          <li><b>Isotropic flux relation</b> <span class="eq">j*=(c/4)u</span>: converts energy density inside a cavity to the outward emitted power per unit area from a small hole or ideal black surface.</li>
        </ul>
        <p class="muted">
          We do <i>not</i> need detailed surface microphysics because a blackbody is defined as an ideal emitter: once the field is isotropic,
          geometry fixes how much energy crosses a unit area per unit time.
        </p>

        <div class="callout assumptions">
          <h3>Assumptions (explicit)</h3>
          <ul>
            <li>Thermal equilibrium at temperature <span class="eq">T</span>.</li>
            <li>Radiation field is isotropic (no preferred direction).</li>
            <li>Surface is an ideal black emitter (emissivity = 1).</li>
            <li>Steady-state emission (no time-dependent temperature changes).</li>
          </ul>
        </div>

        <h3>Possible approaches (2–3) and comparison</h3>
        <ul>
          <li><b>Approach A (direct)</b>: integrate <span class="eq">u(ν)</span> over <span class="eq">ν</span>, then use <span class="eq">j*=(c/4)u</span>.
            <span class="muted">Pros: shortest, matches the hint integral. Cons: must remember the <span class="eq">c/4</span> factor.</span>
          </li>
          <li><b>Approach B (radiance)</b>: start from Planck spectral radiance and integrate over solid angle and frequency.
            <span class="muted">Pros: directly yields surface power. Cons: introduces extra definitions (radiance, intensity).</span>
          </li>
          <li><b>Approach C (thermodynamics)</b>: use photon gas pressure and energy density relation, then derive <span class="eq">u∝T⁴</span>.
            <span class="muted">Pros: deep conceptual link. Cons: longer and not aligned with the provided formula.</span>
          </li>
        </ul>

        <p><b>Chosen approach:</b> Approach A — it uses exactly what’s given and the provided hint integral, and it cleanly exposes the <span class="eq">T⁴</span> scaling.</p>
      </section>

      <section id="part2" class="card fade-in">
        <h2>PART 2 — Strategy & Tips (Roadmap only)</h2>
        <ol>
          <li>
            <b>Goal:</b> Write total energy density.
            <br><span class="muted">Tool:</span> <span class="eq">u(T)=∫₀∞ u(ν)dν</span>.
            <br><span class="muted">Meaning:</span> sum energy contributions from all photon frequencies.
          </li>
          <li>
            <b>Goal:</b> Factor out all constants.
            <br><span class="muted">Tool:</span> pull out <span class="eq">8πh/c³</span>.
            <br><span class="muted">Meaning:</span> isolate the temperature-dependent part.
          </li>
          <li>
            <b>Goal:</b> Make the integral dimensionless.
            <br><span class="muted">Tool:</span> substitute <span class="eq">x = hν/(kT)</span>.
            <br><span class="muted">Meaning:</span> reveals how <span class="eq">T</span> scales.
          </li>
          <li>
            <b>Goal:</b> Use the hint integral.
            <br><span class="muted">Tool:</span> <span class="eq">∫₀∞ x³/(eˣ−1)dx = π⁴/15</span>.
            <br><span class="muted">Meaning:</span> turns the remaining integral into a universal constant.
          </li>
          <li>
            <b>Goal:</b> Convert energy density to emitted power/area.
            <br><span class="muted">Tool:</span> <span class="eq">j*=(c/4)u</span> for isotropic radiation.
            <br><span class="muted">Meaning:</span> only a geometric fraction of energy flows outward.
          </li>
          <li>
            <b>Goal:</b> Identify <span class="eq">σ</span> and check units.
            <br><span class="muted">Tool:</span> dimensional analysis.
            <br><span class="muted">Meaning:</span> ensures the result is physically consistent.
          </li>
        </ol>

        <div class="callout mistakes">
          <h3>Common mistakes + quick tips</h3>
          <ul>
            <li><b>Mistake:</b> setting <span class="eq">j*=cu</span>. <b>Tip:</b> isotropy gives <span class="eq">c/4</span>, not <span class="eq">c</span>.</li>
            <li><b>Mistake:</b> forgetting <span class="eq">dν = (kT/h) dx</span>. <b>Tip:</b> always transform the differential.</li>
            <li><b>Mistake:</b> losing powers: <span class="eq">ν³ dν → (kT/h)⁴ x³ dx</span>. <b>Tip:</b> count powers carefully.</li>
          </ul>
        </div>
      </section>

      <section id="part3" class="card fade-in">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Physical intuition before the math</h3>
        <p>
          Planck’s spectrum has a characteristic “bump”: as temperature rises, (1) the bump shifts to higher frequency
          and (2) the overall area under the curve increases. If the typical photon energy scales like <span class="eq">kT</span>
          and the number of available modes grows roughly like frequency cubed, it is plausible that the total energy grows as a high power of <span class="eq">T</span>.
          The exact scaling and prefactor come from the integral.
        </p>

        <h3>Step 1: Start from Planck’s spectral energy density</h3>
        <div class="eqblock" id="eq1">
          u(ν) = (8πhν³/c³) · 1/(exp(hν/(kT)) − 1)
        </div>
        <button class="btn" data-copy-target="eq1">Copy equation</button>
        <p class="muted">
          Here <span class="eq">u(ν)dν</span> is the energy per unit volume carried by photons with frequencies between <span class="eq">ν</span> and <span class="eq">ν+dν</span>.
        </p>

        <h3>Step 2: Integrate over frequency to get total energy density</h3>
        <p>Define the total energy density:</p>
        <div class="eqblock" id="eq2">
          u(T) = ∫₀∞ u(ν) dν
        </div>
        <button class="btn" data-copy-target="eq2">Copy equation</button>

        <p>Insert Planck’s formula:</p>
        <div class="eqblock" id="eq3">
          u(T) = ∫₀∞ (8πh/c³) · [ ν³/(exp(hν/(kT)) − 1) ] dν
        </div>
        <button class="btn" data-copy-target="eq3">Copy equation</button>

        <p class="muted">
          We’ve pulled out constants and left the frequency dependence inside the integral.
        </p>

        <h3>Step 3: Use a dimensionless substitution to expose the T-scaling</h3>
        <p>
          Let
          <span class="eq">x = hν/(kT)</span>.
          Then
          <span class="eq">ν = (kT/h)x</span>
          and
          <span class="eq">dν = (kT/h) dx</span>.
        </p>

        <p>Compute the combination <span class="eq">ν³ dν</span> under this change:</p>
        <div class="eqblock" id="eq4">
          ν³ dν = [(kT/h)³ x³] · [(kT/h) dx] = (kT/h)⁴ x³ dx
        </div>
        <button class="btn" data-copy-target="eq4">Copy equation</button>

        <p>Substitute into the integral:</p>
        <div class="eqblock" id="eq5">
          u(T) = (8πh/c³) · (kT/h)⁴ ∫₀∞ x³/(eˣ − 1) dx
        </div>
        <button class="btn" data-copy-target="eq5">Copy equation</button>

        <p class="muted">
          This is the key moment: all the temperature dependence is now outside the integral as <span class="eq">T⁴</span>.
          The remaining integral is a pure number.
        </p>

        <h3>Step 4: Use the hint integral</h3>
        <p>Given (and standard): <span class="eq">∫₀∞ x³/(eˣ − 1) dx = π⁴/15</span>.</p>

        <p>So the total energy density becomes:</p>
        <div class="eqblock" id="eq6">
          u(T) = (8πh/c³) · (kT/h)⁴ · (π⁴/15)
               = (8π⁵ k⁴ / (15 h³ c³)) · T⁴
        </div>
        <button class="btn" data-copy-target="eq6">Copy equation</button>

        <div class="callout assumptions">
          <h3>Interpretation</h3>
          <p class="muted">
            The photon gas energy density in equilibrium scales as <span class="eq">T⁴</span>. This is already a big part of the Stefan–Boltzmann story.
            To get <i>emitted power per area</i>, we need one more geometric step.
          </p>
        </div>

        <h3>Step 5: Convert energy density to emitted power per area</h3>
        <p>
          For isotropic radiation, the net outward energy flux through a surface is
          <span class="eq">j* = (c/4) u</span>.
        </p>
        <p class="muted">
          Why <span class="eq">1/4</span>? In isotropy, directions are uniformly distributed over solid angle. The flux involves an average of the normal
          velocity component <span class="eq">c cosθ</span> over the outward hemisphere, which yields the factor <span class="eq">1/4</span>.
          (This is exactly analogous to kinetic theory for gas molecules hitting a wall.)
        </p>

        <p>Therefore:</p>
        <div class="eqblock" id="eq7">
          j*(T) = (c/4) u(T)
               = (c/4) · (8π⁵ k⁴ / (15 h³ c³)) · T⁴
               = (2π⁵ k⁴ / (15 h³ c²)) · T⁴
        </div>
        <button class="btn" data-copy-target="eq7">Copy equation</button>

        <div class="callout final">
          <h3>Final Answer (Stefan–Boltzmann Law)</h3>
          <div class="eqblock" id="eqFinal">
            j*(T) = σ T⁴,
            with  σ = 2π⁵ k⁴ / (15 h³ c²)
            (equivalently, σ = π² k⁴ / (60 ħ³ c²))
          </div>
          <button class="btn" data-copy-target="eqFinal">Copy final answer</button>
          <p class="muted">
            Numerical reference (commonly quoted): <span class="eq">σ ≈ 5.67×10⁻⁸ W·m⁻²·K⁻⁴</span>.
          </p>
        </div>

        <h3>Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <h3>Units / dimensions</h3>
            <p class="muted">
              <span class="eq">k</span> has units J/K, so <span class="eq">k⁴T⁴</span> gives J⁴.
              Denominator <span class="eq">h³c²</span> gives (J·s)³·(m/s)² = J³·s·m².
              Ratio → J/(s·m²) = W/m². Correct for <span class="eq">j*</span>.
            </p>
          </div>
          <div class="callout">
            <h3>Limiting / qualitative behavior</h3>
            <p class="muted">
              If <span class="eq">T</span> doubles, <span class="eq">j*</span> increases by <span class="eq">16</span>.
              This matches the strong temperature sensitivity observed in thermal radiation (e.g., incandescent filaments).
            </p>
          </div>
        </div>

        <p class="muted">
          Connection to the diagram and plots: the spectrum <span class="eq">u(ν)</span> is the curve you’ll see changing with temperature.
          The area under that curve is proportional to <span class="eq">u(T)</span>, and multiplying by <span class="eq">c/4</span> produces the emitted flux <span class="eq">j*(T)</span>
          shown in the <span class="eq">T⁴</span> plot.
        </p>
      </section>

      <section id="part4" class="card fade-in">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the final formula</h3>
        <ul>
          <li><span class="eq">σ</span> is built only from universal constants <span class="eq">h,k,c</span> (or <span class="eq">ħ</span>): it’s “pure physics,” not material-dependent.</li>
          <li><span class="eq">T⁴</span> appears because (i) photon energies scale with <span class="eq">T</span>, and (ii) the number of available EM modes grows rapidly with frequency, and the whole integral collapses into a universal dimensionless number.</li>
          <li>The step <span class="eq">j*=(c/4)u</span> is a geometry/isotropy statement: it encodes how much of an isotropic energy density actually crosses a surface.</li>
        </ul>

        <h3>How changing parameters affects the outcome (connect to plots)</h3>
        <ul>
          <li>Increasing <span class="eq">T</span> shifts the spectral peak to higher <span class="eq">ν</span> and increases the curve’s area dramatically.</li>
          <li>The total exitance plot grows as <span class="eq">T⁴</span>, so at high temperature the flux climbs extremely fast.</li>
        </ul>

        <h3>An alternative derivation idea (brief)</h3>
        <p class="muted">
          One can derive <span class="eq">u(T) ∝ T⁴</span> from thermodynamics of a photon gas:
          electromagnetic radiation has pressure <span class="eq">p = u/3</span>.
          Using entropy relations and the fact that photons have zero chemical potential leads to <span class="eq">u ∝ T⁴</span>,
          with the same prefactor when Planck’s constant is used to fix the mode counting.
        </p>

        <h3>Concept checks (quick self-test)</h3>
        <ul>
          <li><b>Q:</b> Why does the substitution <span class="eq">x=hν/(kT)</span> help?<br><b>A:</b> It makes the integral dimensionless so all <span class="eq">T</span>-dependence factors out as a power.</li>
          <li><b>Q:</b> Where does the <span class="eq">1/4</span> factor come from?<br><b>A:</b> From angular averaging of <span class="eq">cosθ</span> over the outward hemisphere for an isotropic field.</li>
          <li><b>Q:</b> If a surface has emissivity <span class="eq">ε</span> (gray body), what changes?<br><b>A:</b> The emitted power becomes <span class="eq">j*=εσT⁴</span> (with <span class="eq">0&lt;ε&lt;1</span>).</li>
          <li><b>Q:</b> Does this use wavelength or frequency form of Planck’s law?<br><b>A:</b> Frequency form <span class="eq">u(ν)</span>; a wavelength form exists but must be integrated with its own Jacobian.</li>
        </ul>
      </section>

      <section id="part5" class="card fade-in">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>

        <div class="viz">
          <div class="canvas-card">
            <div class="canvas-title">
              <b>Diagram: Blackbody surface emitting into a hemisphere</b>
              <span>Shows isotropic rays; flux uses ⟨cosθ⟩ over hemisphere ⇒ factor 1/4</span>
            </div>
            <canvas id="diagram"></canvas>
          </div>

          <div class="canvas-card">
            <div class="canvas-title">
              <b>Main Plot: Planck spectral energy density u(ν) vs frequency ν</b>
              <span>Slider changes T; curve shifts + area increases</span>
            </div>
            <canvas id="plotSpectrum"></canvas>
          </div>

          <div class="canvas-card">
            <div class="canvas-title">
              <b>Secondary Plot: Stefan–Boltzmann law j*(T)=σT⁴</b>
              <span>Shows T⁴ scaling; current T marked</span>
            </div>
            <canvas id="plotSB"></canvas>
          </div>
        </div>

        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Diagram:</b> A black surface with many rays leaving at angles <span class="eq">θ</span> relative to the normal. The outward flux depends on the average of <span class="eq">cosθ</span> over the hemisphere, leading to <span class="eq">j*=(c/4)u</span>.</li>
          <li><b>Main plot:</b> <span class="eq">u(ν)</span> (J·m<sup>−3</sup>·Hz<sup>−1</sup>) vs <span class="eq">ν</span> (Hz). The plotted curve is exactly the formula used in the derivation.</li>
          <li><b>Secondary plot:</b> <span class="eq">j*(T)</span> (W·m<sup>−2</sup>) vs <span class="eq">T</span> (K) with a highlighted point at the current slider value.</li>
        </ul>

        <h3>Interactive control</h3>
        <p class="muted">
          The <b>Temperature slider</b> changes <span class="eq">T</span>. You should see:
          (1) the Planck spectrum shift to higher frequencies and grow in magnitude,
          (2) the Stefan–Boltzmann curve point move upward according to <span class="eq">T⁴</span>,
          and (3) the diagram remains the same because geometry/isotropy is temperature-independent.
        </p>
      </section>
    </div>
  </main>

  <footer>
    <p>
      Notes: Plots use example numerical constants for display (standard values of <span class="eq">h,k,c</span>).
      The derivation remains symbolic and general.
    </p>
  </footer>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script>
    // ---------- Utilities ----------
    const TAU = Math.PI * 2;

    function showToast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(()=>t.classList.remove('show'), 1100);
    }

    function copyText(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text).then(()=>showToast("Copied ✓")).catch(()=>fallbackCopy(text));
      }else{
        fallbackCopy(text);
      }
    }
    function fallbackCopy(text){
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.setAttribute('readonly','');
      ta.style.position='fixed';
      ta.style.left='-9999px';
      document.body.appendChild(ta);
      ta.select();
      try{
        document.execCommand('copy');
        showToast("Copied ✓");
      }catch(e){
        showToast("Copy failed");
      }
      document.body.removeChild(ta);
    }

    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-copy-target]');
      if(!btn) return;
      const id = btn.getAttribute('data-copy-target');
      const el = document.getElementById(id);
      if(!el) return;
      const text = el.textContent.replace(/\s+\n/g, '\n').trim();
      copyText(text);
    });

    // ---------- Physics constants (example values for plotting) ----------
    // These are standard constants used to compute example numeric curves.
    const h = 6.62607015e-34;      // J*s
    const k = 1.380649e-23;        // J/K
    const c = 299792458;           // m/s
    const pi = Math.PI;

    // Stefan–Boltzmann constant from derived expression:
    // sigma = 2*pi^5*k^4/(15*h^3*c^2)
    const sigma = (2 * Math.pow(pi,5) * Math.pow(k,4)) / (15 * Math.pow(h,3) * Math.pow(c,2));

    // Planck spectral energy density per frequency:
    // u(nu) = (8*pi*h*nu^3 / c^3) * 1/(exp(h*nu/(kT)) - 1)
    function u_nu(nu, T){
      const x = (h*nu)/(k*T);
      // Guard numerical overflow for exp(x) at large x
      if(x > 120) return 0;
      const denom = Math.expm1(x); // exp(x)-1 stable for small x
      if(denom <= 0) return 0;
      return (8*pi*h*Math.pow(nu,3)/Math.pow(c,3)) * (1/denom);
    }

    function nu_peak(T){
      // Peak of f(x)=x^3/(e^x-1) occurs near x≈2.821439... (same as B_nu peak)
      const xpk = 2.821439;
      return (xpk * k * T) / h;
    }

    // ---------- Canvas plotting helpers ----------
    function setupHiDPICanvas(canvas){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(200, Math.floor(rect.width));
      const hpx = Math.max(200, Math.floor(rect.height));
      canvas.width = Math.floor(w * dpr);
      canvas.height = Math.floor(hpx * dpr);
      const ctx = canvas.getContext('2d');
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // draw in CSS pixels
      return {ctx, w, h: hpx, dpr};
    }

    function drawAxes(ctx, box, xLabel, yLabel, title, opts={}){
      const {x0,y0,w,h} = box;
      const padL = opts.padL ?? 54;
      const padR = opts.padR ?? 16;
      const padT = opts.padT ?? 34;
      const padB = opts.padB ?? 44;

      const plot = {
        x: x0 + padL,
        y: y0 + padT,
        w: w - padL - padR,
        h: h - padT - padB
      };

      // Background
      ctx.save();
      ctx.fillStyle = 'rgba(255,255,255,0.02)';
      ctx.fillRect(x0, y0, w, h);

      // Title
      ctx.fillStyle = 'rgba(232,238,252,0.95)';
      ctx.font = '600 13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText(title, x0 + 10, y0 + 18);

      // Grid
      const gridColor = 'rgba(255,255,255,0.08)';
      ctx.strokeStyle = gridColor;
      ctx.lineWidth = 1;

      const nx = opts.nx ?? 6;
      const ny = opts.ny ?? 5;

      for(let i=0;i<=nx;i++){
        const xx = plot.x + (plot.w*i/nx);
        ctx.beginPath();
        ctx.moveTo(xx, plot.y);
        ctx.lineTo(xx, plot.y + plot.h);
        ctx.stroke();
      }
      for(let j=0;j<=ny;j++){
        const yy = plot.y + (plot.h*j/ny);
        ctx.beginPath();
        ctx.moveTo(plot.x, yy);
        ctx.lineTo(plot.x + plot.w, yy);
        ctx.stroke();
      }

      // Axes box
      ctx.strokeStyle = 'rgba(255,255,255,0.18)';
      ctx.strokeRect(plot.x, plot.y, plot.w, plot.h);

      // Labels
      ctx.fillStyle = 'rgba(170,183,230,0.95)';
      ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';

      // x label
      ctx.fillText(xLabel, plot.x + plot.w/2 - ctx.measureText(xLabel).width/2, y0 + h - 14);

      // y label rotated
      ctx.save();
      ctx.translate(x0 + 14, plot.y + plot.h/2);
      ctx.rotate(-Math.PI/2);
      ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
      ctx.restore();

      ctx.restore();
      return plot;
    }

    function formatSI(x, unit){
      // lightweight SI formatter (not exhaustive)
      const abs = Math.abs(x);
      if(abs === 0) return `0 ${unit}`;
      const prefixes = [
        {p: -24, s: 'y'}, {p:-21,s:'z'},{p:-18,s:'a'},{p:-15,s:'f'},{p:-12,s:'p'},
        {p:-9,s:'n'},{p:-6,s:'µ'},{p:-3,s:'m'},{p:0,s:''},{p:3,s:'k'},
        {p:6,s:'M'},{p:9,s:'G'},{p:12,s:'T'},{p:15,s:'P'},{p:18,s:'E'}
      ];
      const p = Math.floor(Math.log10(abs)/3)*3;
      const pr = prefixes.reduce((best,cur)=> (Math.abs(cur.p - p) < Math.abs(best.p - p) ? cur : best), prefixes[8]);
      const scaled = x / Math.pow(10, pr.p);
      const val = (Math.abs(scaled) >= 100) ? scaled.toFixed(0) : (Math.abs(scaled) >= 10 ? scaled.toFixed(1) : scaled.toFixed(2));
      return `${val} ${pr.s}${unit}`;
    }

    // ---------- Drawing: Diagram ----------
    function drawDiagram(canvas, T){
      const {ctx, w, h} = setupHiDPICanvas(canvas);

      // Clear
      ctx.clearRect(0,0,w,h);

      // Layout
      const box = {x0: 0, y0: 0, w, h};
      const plot = drawAxes(ctx, box, "Position along surface (arb.)", "Height (arb.)",
                            "Blackbody emission geometry (isotropic rays)");

      // Draw a "surface"
      const ySurf = plot.y + plot.h*0.78;
      ctx.save();
      ctx.strokeStyle = 'rgba(124,240,197,0.85)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(plot.x + 10, ySurf);
      ctx.lineTo(plot.x + plot.w - 10, ySurf);
      ctx.stroke();

      // Surface label
      ctx.fillStyle = 'rgba(232,238,252,0.95)';
      ctx.font = '600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText("Ideal black surface", plot.x + 12, ySurf - 10);

      // Normal arrow
      const xMid = plot.x + plot.w*0.35;
      ctx.strokeStyle = 'rgba(154,168,255,0.9)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(xMid, ySurf);
      ctx.lineTo(xMid, ySurf - 60);
      ctx.stroke();
      // Arrow head
      ctx.beginPath();
      ctx.moveTo(xMid, ySurf - 60);
      ctx.lineTo(xMid - 6, ySurf - 48);
      ctx.lineTo(xMid + 6, ySurf - 48);
      ctx.closePath();
      ctx.fillStyle = 'rgba(154,168,255,0.9)';
      ctx.fill();

      ctx.fillStyle = 'rgba(170,183,230,0.95)';
      ctx.font = '12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText("surface normal", xMid + 8, ySurf - 46);

      // Rays (hemisphere)
      const rayOriginX = plot.x + plot.w*0.62;
      const rayOriginY = ySurf;
      const rays = 11;
      ctx.lineWidth = 1.7;
      for(let i=0;i<rays;i++){
        const frac = i/(rays-1);
        const theta = (frac*0.92 + 0.04) * (Math.PI/2); // 0..~pi/2
        const L = 95 + 20*Math.sin(frac*TAU);
        const dx = L*Math.sin(theta);
        const dy = -L*Math.cos(theta);

        ctx.strokeStyle = 'rgba(255,255,255,0.22)';
        ctx.beginPath();
        ctx.moveTo(rayOriginX, rayOriginY);
        ctx.lineTo(rayOriginX + dx, rayOriginY + dy);
        ctx.stroke();

        // tiny arrow head
        const ax = rayOriginX + dx;
        const ay = rayOriginY + dy;
        const ang = Math.atan2(dy, dx);
        const ah = 6;
        ctx.fillStyle = 'rgba(255,255,255,0.26)';
        ctx.beginPath();
        ctx.moveTo(ax, ay);
        ctx.lineTo(ax - ah*Math.cos(ang-0.5), ay - ah*Math.sin(ang-0.5));
        ctx.lineTo(ax - ah*Math.cos(ang+0.5), ay - ah*Math.sin(ang+0.5));
        ctx.closePath();
        ctx.fill();
      }

      // Theta annotation (one representative ray)
      const theta = Math.PI/5;
      const L = 95;
      const dx = L*Math.sin(theta);
      const dy = -L*Math.cos(theta);
      ctx.strokeStyle = 'rgba(255,209,102,0.85)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(rayOriginX, rayOriginY);
      ctx.lineTo(rayOriginX + dx, rayOriginY + dy);
      ctx.stroke();

      // angle arc
      ctx.strokeStyle = 'rgba(255,209,102,0.65)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(rayOriginX, rayOriginY, 28, -Math.PI/2, -Math.PI/2 + theta, false);
      ctx.stroke();
      ctx.fillStyle = 'rgba(255,209,102,0.95)';
      ctx.font = '600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText("θ", rayOriginX + 20, rayOriginY - 20);

      // Formula text
      ctx.fillStyle = 'rgba(170,183,230,0.95)';
      ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
      const f1 = "Isotropic flux:  j* = (c/4) u";
      ctx.fillText(f1, plot.x + 10, plot.y + 22);

      // Temperature note
      ctx.fillStyle = 'rgba(124,240,197,0.95)';
      ctx.font = '600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText(`T = ${Math.round(T)} K (geometry unchanged)`, plot.x + plot.w - 220, plot.y + 22);

      ctx.restore();

      // Add ticks labels (simple)
      drawSimpleTicks(ctx, plot, 6, 5, (i)=>"", (j)=>"");
    }

    function drawSimpleTicks(ctx, plot, nx, ny, xFmt, yFmt){
      ctx.save();
      ctx.fillStyle = 'rgba(170,183,230,0.85)';
      ctx.font = '11px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      // x ticks
      for(let i=0;i<=nx;i++){
        const x = plot.x + (plot.w*i/nx);
        const y = plot.y + plot.h;
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.beginPath();
        ctx.moveTo(x,y);
        ctx.lineTo(x,y+6);
        ctx.stroke();
        const label = xFmt(i);
        if(label){
          const tw = ctx.measureText(label).width;
          ctx.fillText(label, x - tw/2, y+20);
        }
      }
      // y ticks
      for(let j=0;j<=ny;j++){
        const y = plot.y + (plot.h*j/ny);
        const x = plot.x;
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.beginPath();
        ctx.moveTo(x-6,y);
        ctx.lineTo(x,y);
        ctx.stroke();
        const label = yFmt(ny-j);
        if(label){
          const tw = ctx.measureText(label).width;
          ctx.fillText(label, x - 10 - tw, y+4);
        }
      }
      ctx.restore();
    }

    // ---------- Drawing: Spectrum plot ----------
    function drawSpectrum(canvas, T){
      const {ctx, w, h} = setupHiDPICanvas(canvas);
      ctx.clearRect(0,0,w,h);

      const box = {x0:0,y0:0,w,h};
      const plot = drawAxes(ctx, box,
        "Frequency ν (Hz)",
        "Spectral energy density u(ν) (J·m⁻³·Hz⁻¹)",
        "Planck spectrum u(ν) = (8πhν³/c³)/(exp(hν/kT)−1)",
        {nx:6, ny:5, padL:66, padB:46}
      );

      // Frequency range: up to 6*nu_peak (covers most area)
      const nup = nu_peak(T);
      const nuMax = Math.max(5e12, 6*nup);
      const nuMin = 0;

      // Sample curve
      const N = 600;
      const xs = new Array(N);
      const ys = new Array(N);
      let yMax = 0;
      for(let i=0;i<N;i++){
        const nu = nuMin + (nuMax - nuMin)*i/(N-1);
        const y = u_nu(nu, T);
        xs[i] = nu;
        ys[i] = y;
        if(y > yMax) yMax = y;
      }
      if(yMax <= 0) yMax = 1;

      // Mapping
      const xToPx = (nu)=> plot.x + (nu - nuMin)/(nuMax - nuMin)*plot.w;
      const yToPx = (y)=> plot.y + plot.h - (y)/(yMax*1.08)*plot.h;

      // Draw curve
      ctx.save();
      ctx.strokeStyle = 'rgba(124,240,197,0.95)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for(let i=0;i<N;i++){
        const px = xToPx(xs[i]);
        const py = yToPx(ys[i]);
        if(i===0) ctx.moveTo(px,py);
        else ctx.lineTo(px,py);
      }
      ctx.stroke();

      // Peak marker
      const nuPk = nup;
      const yPk = u_nu(nuPk, T);
      const pxPk = xToPx(nuPk);
      const pyPk = yToPx(yPk);
      ctx.fillStyle = 'rgba(255,209,102,0.95)';
      ctx.beginPath();
      ctx.arc(pxPk, pyPk, 4.2, 0, TAU);
      ctx.fill();

      ctx.strokeStyle = 'rgba(255,209,102,0.65)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(pxPk, plot.y);
      ctx.lineTo(pxPk, plot.y + plot.h);
      ctx.stroke();

      // Legend
      ctx.fillStyle = 'rgba(232,238,252,0.92)';
      ctx.font = '600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText(`T = ${Math.round(T)} K`, plot.x + 10, plot.y + 18);

      ctx.fillStyle = 'rgba(255,209,102,0.95)';
      ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
      const peakText = `ν_peak ≈ ${formatSI(nuPk,'Hz')}`;
      ctx.fillText(peakText, plot.x + 10, plot.y + 36);

      // Tick labels
      const nx = 6, ny = 5;
      drawSimpleTicks(ctx, plot, nx, ny,
        (i)=>{
          const nu = nuMin + (nuMax - nuMin)*i/nx;
          // show as scientific-ish
          return formatSI(nu,'Hz').replace(' Hz','');
        },
        (j)=>{
          const y = (yMax*1.08)*j/ny;
          // since we draw y top to bottom, j here passed is ny-j in helper
          return '';
        }
      );

      // Custom y tick labels (left side) with correct orientation
      ctx.fillStyle = 'rgba(170,183,230,0.85)';
      ctx.font = '11px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      for(let j=0;j<=ny;j++){
        const yVal = (yMax*1.08)*(ny-j)/ny;
        const y = plot.y + plot.h*j/ny;
        const label = formatSI(yVal,'').trim();
        const tw = ctx.measureText(label).width;
        ctx.fillText(label, plot.x - 10 - tw, y+4);
      }

      ctx.restore();
    }

    // ---------- Drawing: Stefan–Boltzmann plot ----------
    function drawSB(canvas, T){
      const {ctx, w, h} = setupHiDPICanvas(canvas);
      ctx.clearRect(0,0,w,h);

      const box = {x0:0,y0:0,w,h};
      const plot = drawAxes(ctx, box,
        "Temperature T (K)",
        "Radiant exitance j*(T) (W·m⁻²)",
        "Stefan–Boltzmann law: j*(T) = σT⁴",
        {nx:6, ny:5, padL:66, padB:46}
      );

      const Tmin = 0;
      const Tmax = 8000;

      // Curve samples
      const N = 500;
      let yMax = sigma*Math.pow(Tmax,4);
      const xToPx = (x)=> plot.x + (x - Tmin)/(Tmax - Tmin)*plot.w;
      const yToPx = (y)=> plot.y + plot.h - y/(yMax*1.02)*plot.h;

      ctx.save();
      ctx.strokeStyle = 'rgba(154,168,255,0.95)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for(let i=0;i<N;i++){
        const t = Tmin + (Tmax - Tmin)*i/(N-1);
        const y = sigma*Math.pow(t,4);
        const px = xToPx(t);
        const py = yToPx(y);
        if(i===0) ctx.moveTo(px,py);
        else ctx.lineTo(px,py);
      }
      ctx.stroke();

      // Current point
      const yT = sigma*Math.pow(T,4);
      const pxT = xToPx(T);
      const pyT = yToPx(yT);

      ctx.fillStyle = 'rgba(124,240,197,0.95)';
      ctx.beginPath();
      ctx.arc(pxT, pyT, 5, 0, TAU);
      ctx.fill();

      ctx.strokeStyle = 'rgba(124,240,197,0.55)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(pxT, plot.y);
      ctx.lineTo(pxT, plot.y + plot.h);
      ctx.stroke();

      ctx.fillStyle = 'rgba(232,238,252,0.92)';
      ctx.font = '600 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      ctx.fillText(`σ = ${sigma.toExponential(6)} W·m⁻²·K⁻⁴`, plot.x + 10, plot.y + 18);

      ctx.fillStyle = 'rgba(124,240,197,0.95)';
      ctx.font = '12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
      ctx.fillText(`j*(T) = ${formatSI(yT,'W/m²')}`, plot.x + 10, plot.y + 36);

      // Tick labels
      const nx=6, ny=5;

      // x ticks with K
      ctx.fillStyle = 'rgba(170,183,230,0.85)';
      ctx.font = '11px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      for(let i=0;i<=nx;i++){
        const t = Tmin + (Tmax - Tmin)*i/nx;
        const x = xToPx(t);
        const y = plot.y + plot.h;
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.beginPath();
        ctx.moveTo(x,y);
        ctx.lineTo(x,y+6);
        ctx.stroke();
        const label = (t===0) ? "0" : formatSI(t,'K').replace(' K','');
        const tw = ctx.measureText(label).width;
        ctx.fillText(label, x - tw/2, y+20);
      }

      // y ticks
      for(let j=0;j<=ny;j++){
        const yVal = (yMax*1.02)*(ny-j)/ny;
        const y = plot.y + plot.h*j/ny;
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.beginPath();
        ctx.moveTo(plot.x-6,y);
        ctx.lineTo(plot.x,y);
        ctx.stroke();
        const label = formatSI(yVal,'').trim();
        const tw = ctx.measureText(label).width;
        ctx.fillText(label, plot.x - 10 - tw, y+4);
      }

      ctx.restore();
    }

    // ---------- State + render loop ----------
    const state = {
      T: 3000
    };

    const Tslider = document.getElementById('Tslider');
    const Treadout = document.getElementById('Treadout');
    const resetBtn = document.getElementById('resetBtn');

    function setT(T){
      state.T = T;
      Treadout.textContent = `T = ${Math.round(T)} K`;
      renderAll();
    }

    function renderAll(){
      drawDiagram(document.getElementById('diagram'), state.T);
      drawSpectrum(document.getElementById('plotSpectrum'), state.T);
      drawSB(document.getElementById('plotSB'), state.T);
    }

    Tslider.addEventListener('input', ()=> setT(parseFloat(Tslider.value)));
    resetBtn.addEventListener('click', ()=>{
      Tslider.value = 3000;
      setT(3000);
      showToast("Reset ✓");
    });

    // Responsive redraw on resize
    let resizeTimer = null;
    window.addEventListener('resize', ()=>{
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(renderAll, 80);
    });

    // Initial
    setT(parseFloat(Tslider.value));
  </script>
</body>
</html>
