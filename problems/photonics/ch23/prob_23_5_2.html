<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pulsed Three-Wave Mixing with Group-Velocity Dispersion (GVD): Coupled-Wave Equations</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#101a33;
      --card:#0f1930;
      --text:#eaf0ff;
      --muted:#b8c3e6;
      --faint:#7f8bb5;
      --accent:#7dd3fc;
      --accent2:#a7f3d0;
      --warn:#fbbf24;
      --danger:#fb7185;
      --ok:#34d399;
      --line:rgba(255,255,255,.10);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:14px;
      --max: 1080px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 0%, rgba(125,211,252,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(167,243,208,.12), transparent 55%),
        radial-gradient(900px 900px at 50% 110%, rgba(251,191,36,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #070a14 70%);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre{font-family:var(--mono)}
    pre{
      margin:0;
      padding:14px 14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      border-radius:12px;
      overflow:auto;
      white-space:pre-wrap;
      word-break:break-word;
    }

    header{
      position:relative;
      padding:38px 18px 18px;
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:var(--max); margin:0 auto; display:grid; gap:16px}
    .topgrid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .topgrid{grid-template-columns:1fr}
    }

    .title{
      font-size: clamp(1.6rem, 2.4vw, 2.3rem);
      line-height:1.15;
      margin:0 0 8px;
      letter-spacing:-.02em;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:1.02rem;
      max-width:70ch;
    }

    .toc{
      position:sticky;
      top:12px;
      align-self:start;
      background:linear-gradient(180deg, rgba(16,26,51,.88), rgba(16,26,51,.68));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .toc header{
      padding:14px 14px 10px;
      border:0;
    }
    .toc h2{
      margin:0;
      font-size:1.02rem;
      letter-spacing:.01em;
    }
    .toc nav{
      padding:8px 12px 14px;
      display:grid;
      gap:8px;
    }
    .toc a{
      display:block;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid transparent;
      color:var(--text);
      background:rgba(255,255,255,.03);
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      text-decoration:none;
      font-size:.95rem;
    }
    .toc a:hover{
      transform: translateY(-1px);
      background:rgba(125,211,252,.10);
      border-color:rgba(125,211,252,.25);
      text-decoration:none;
    }

    main{padding: 18px 18px 44px}
    section{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    section + section{margin-top:16px}
    section > .secHd{
      padding:16px 16px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      gap:12px;
      align-items:baseline;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .secHd h2{
      margin:0;
      font-size:1.25rem;
      letter-spacing:-.01em;
    }
    .secHd .tag{
      color:var(--muted);
      font-size:.92rem;
    }
    .content{
      padding: 14px 16px 16px;
      display:grid;
      gap:14px;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    .card{
      grid-column: span 6;
      background:rgba(15,25,48,.55);
      border:1px solid var(--line);
      border-radius:var(--radius2);
      padding:14px 14px;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
    }
    @media (max-width: 900px){
      .card{grid-column: span 12}
    }
    .card h3{
      margin:0 0 8px;
      font-size:1.05rem;
    }
    .card p{margin:0;color:var(--muted)}
    ul{margin:8px 0 0 18px; color:var(--muted)}
    li{margin:6px 0}

    .callout{
      border-left: 4px solid rgba(125,211,252,.8);
      padding:12px 12px;
      background:rgba(125,211,252,.08);
      border-radius:14px;
      border:1px solid rgba(125,211,252,.20);
    }
    .callout.warn{
      border-left-color: rgba(251,191,36,.9);
      background: rgba(251,191,36,.09);
      border-color: rgba(251,191,36,.22);
    }
    .callout.danger{
      border-left-color: rgba(251,113,133,.9);
      background: rgba(251,113,133,.09);
      border-color: rgba(251,113,133,.22);
    }
    .callout.ok{
      border-left-color: rgba(52,211,153,.9);
      background: rgba(52,211,153,.08);
      border-color: rgba(52,211,153,.20);
    }

    .eqRow{
      display:flex;
      gap:10px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 600;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
    }
    .btn:active{transform: translateY(0)}
    .btn.small{padding:8px 10px; font-size:.92rem}
    .copyHint{color:var(--faint); font-size:.9rem; margin:0}
    .twoCol{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 900px){
      .twoCol{grid-template-columns:1fr}
    }

    details{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,.03);
      padding:10px 12px;
    }
    summary{
      cursor:pointer;
      font-weight:700;
      color:var(--text);
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    details[open]{background:rgba(255,255,255,.04)}
    details .inner{margin-top:10px; color:var(--muted)}
    .backTop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--text);
      text-decoration:none;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .backTop:hover{
      transform: translateY(-1px);
      background: rgba(167,243,208,.10);
      border-color: rgba(167,243,208,.25);
      text-decoration:none;
    }

    figure{
      margin:0;
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
      background: rgba(255,255,255,.03);
    }
    figure figcaption{
      padding:10px 12px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:.95rem;
    }
    .canvasWrap{
      padding:12px;
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius:14px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
    }

    footer{
      padding:18px;
      color:var(--faint);
      border-top:1px solid var(--line);
      text-align:center;
    }

    /* Subtle micro-animation */
    @media (prefers-reduced-motion: no-preference){
      section{animation: fadeUp .35s ease both}
      section:nth-of-type(2){animation-delay:.03s}
      section:nth-of-type(3){animation-delay:.06s}
      section:nth-of-type(4){animation-delay:.09s}
      section:nth-of-type(5){animation-delay:.12s}
      section:nth-of-type(6){animation-delay:.15s}
      @keyframes fadeUp{
        from{opacity:0; transform: translateY(8px)}
        to{opacity:1; transform: translateY(0)}
      }
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      .toc{display:none}
      section{box-shadow:none}
      a{color:#000; text-decoration:underline}
      pre{background:#f6f6f6; border-color:#ddd}
      .btn{display:none}
      .callout{background:#f2f2f2; border-color:#ddd}
      section{break-inside:avoid; page-break-inside:avoid}
      .secHd{border-color:#ddd}
      .content{gap:10px}
      canvas{border-color:#ddd}
    }
  </style>
</head>

<body>
  <a id="top"></a>
  <header>
    <div class="wrap topgrid">
      <div>
        <h1 class="title">Pulsed Three-Wave Mixing in a Dispersive Medium (GVD): Deriving the Time-Domain Coupled-Wave Equations</h1>
        <p class="subtitle">
          We derive the three coupled envelope equations for pulsed three-wave mixing when <em>group-velocity dispersion</em> is present,
          starting from the Helmholtz equation with a nonlinear polarization source and applying the slowly-varying-envelope approximation (SVEA),
          weak dispersion, and a second-order Taylor expansion of the propagation constant.
        </p>
      </div>

      <aside class="toc" aria-label="Table of Contents">
        <header>
          <h2>Table of Contents</h2>
        </header>
        <nav>
          <a href="#quick">Quick Summary</a>
          <a href="#primer">PART 0 — Concept Primer</a>
          <a href="#industry">PART 0B — Industry & Applied Physics</a>
          <a href="#analysis">PART 1 — Problem Analysis</a>
          <a href="#strategy">PART 2 — Strategy & Tips</a>
          <a href="#solution">PART 3 — Full Solution</a>
          <a href="#deeper">PART 4 — Deeper Understanding</a>
          <a href="#plot">PART 5 — Optional Plot Guide</a>
        </nav>
      </aside>
    </div>
  </header>

  <main>
    <article class="wrap">
      <!-- Quick Summary -->
      <section id="quick">
        <div class="secHd">
          <h2>Quick Summary</h2>
          <div class="tag">What you’ll learn (fast)</div>
        </div>
        <div class="content">
          <div class="cards">
            <div class="card">
              <h3>Problem in one line</h3>
              <p>
                Derive the <strong>time-domain coupled-wave equations</strong> for <strong>pulsed three-wave mixing</strong> when the medium has
                <strong>group-velocity dispersion (GVD)</strong>.
              </p>
              <ul>
                <li>Start from frequency-domain Helmholtz with a nonlinear source.</li>
                <li>Represent the field as three carrier waves with slowly varying envelopes.</li>
                <li>Use a Taylor expansion of the propagation constant to get group delay + GVD.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Key physics idea</h3>
              <p>
                Pulses at different frequencies walk off due to <strong>different group velocities</strong>, and each pulse broadens due to
                <strong>GVD</strong>. These effects appear as <code>(1/v_g) ∂/∂t</code> and <code>-(i/2)β'' ∂²/∂t²</code> terms in the envelope equations.
              </p>
              <ul>
                <li>Group velocity: <code>v_g = 1/β'</code>.</li>
                <li>GVD coefficient: <code>β'' = d²β/dω²</code>.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Governing starting point</h3>
              <p>Frequency-domain scalar Helmholtz (forward propagation assumed):</p>
              <div class="eqRow">
                <button class="btn small" data-copy-target="eqHelm">Copy equation</button>
                <p class="copyHint">Copies plain text</p>
              </div>
              <pre id="eqHelm">(∂²/∂z² + k²(ω)) E(z,ω) = -μ0 ω² P_NL(z,ω)</pre>
            </div>
            <div class="card">
              <h3>Result type & meaning</h3>
              <p>
                The final result is <strong>symbolic</strong>: three coupled partial differential equations (PDEs) for envelopes
                <code>a1(z,t), a2(z,t), a3(z,t)</code>. Physically, they predict how pulse shapes and energies exchange while dispersing.
              </p>
              <ul>
                <li>Nonlinearity couples the waves (energy exchange).</li>
                <li>Group-velocity mismatch shifts pulses in time (walk-off).</li>
                <li>GVD broadens/reshapes pulses (limits peak conversion).</li>
              </ul>
            </div>
          </div>

          <div class="callout ok">
            <strong>Target equations (Saleh &amp; Teich form, Eq. 23.5-3):</strong>
            <div class="eqRow" style="margin-top:10px">
              <button class="btn small" data-copy-target="finalEq">Copy final answer</button>
              <p class="copyHint">Copies plain text</p>
            </div>
            <pre id="finalEq">(∂/∂z + (1/v1)∂/∂t - i(β1''/2)∂²/∂t²) a1 = -i g a3 a2*
(∂/∂z + (1/v2)∂/∂t - i(β2''/2)∂²/∂t²) a2 = -i g a3 a1*
(∂/∂z + (1/v3)∂/∂t - i(β3''/2)∂²/∂t²) a3 = -i g a1 a2</pre>
            <p style="margin:10px 0 0;color:var(--muted)">
              Here <code>vq</code> are group velocities, <code>βq''</code> are GVD coefficients, and <code>g</code> is an effective nonlinear coupling constant
              (material + mode overlap + normalization).
            </p>
          </div>

          <a class="backTop" href="#top" aria-label="Back to top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 0 -->
      <section id="primer">
        <div class="secHd">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>
          <div class="tag">Core ideas you need</div>
        </div>
        <div class="content">
          <div class="twoCol">
            <div class="callout">
              <strong>Core definitions (symbols &amp; SI units)</strong>
              <ul>
                <li><code>E(z,t)</code>: electric field (V/m).</li>
                <li><code>P_NL(z,t)</code>: nonlinear polarization density (C/m²).</li>
                <li><code>ωq</code>: carrier angular frequency of wave <code>q</code> (rad/s).</li>
                <li><code>β(ω)</code>: propagation constant (rad/m), with <code>βq ≡ β(ωq)</code>.</li>
                <li><code>βq' = (dβ/dω)|ωq</code> (s/m), so <code>vq = 1/βq'</code> (m/s) is group velocity.</li>
                <li><code>βq'' = (d²β/dω²)|ωq</code> (s²/m): group-velocity dispersion (GVD).</li>
                <li><code>aq(z,t)</code>: slowly varying complex envelope (normalization depends on convention).</li>
                <li><code>d</code>: effective second-order nonlinear coefficient (m/V) (often written <code>d_eff</code>).</li>
              </ul>
            </div>
            <div class="callout warn">
              <strong>Physical meaning (intuition)</strong>
              <ul>
                <li><strong>Carrier vs envelope:</strong> The carrier oscillates fast at <code>ωq</code>; the envelope changes slowly with <code>t</code> and <code>z</code>.</li>
                <li><strong>Group velocity:</strong> the pulse peak travels at <code>vq</code>. Different <code>vq</code> ⇒ pulses separate in time.</li>
                <li><strong>GVD:</strong> different spectral components travel at different group velocities, causing temporal broadening and chirp.</li>
                <li><strong>Three-wave mixing:</strong> a second-order polarization <code>P_NL ∝ E²</code> generates frequencies at sums/differences of carriers.</li>
              </ul>
            </div>
          </div>

          <div class="cards">
            <div class="card">
              <h3>Key law: Helmholtz with nonlinear source</h3>
              <p>
                In frequency domain, the nonlinear polarization acts like a source that drives new frequency components. Under forward propagation,
                the second spatial derivative is reduced (SVEA), yielding first-order z-evolution for envelopes.
              </p>
            </div>
            <div class="card">
              <h3>Validity conditions (assumptions)</h3>
              <ul>
                <li><strong>SVEA:</strong> envelope varies slowly over one wavelength and one optical period:
                  <code>|∂a/∂z| ≪ |β a|</code>, <code>|∂a/∂t| ≪ |ω a|</code>.
                </li>
                <li><strong>Narrowband (weak dispersion):</strong> envelope spectrum is concentrated near each carrier, so Taylor expansion of <code>β(ω)</code> is valid.</li>
                <li><strong>Second-order nonlinearity:</strong> <code>P_NL = 2 d E²</code> (scalarized; tensor effects folded into <code>d</code>).</li>
                <li><strong>Resonant terms only:</strong> keep only polarization terms oscillating near <code>ω1, ω2, ω3</code> (rotating-wave/phasematching selection).</li>
              </ul>
            </div>
          </div>

          <details>
            <summary>Common models/approximations used here (and why)</summary>
            <div class="inner">
              <ul>
                <li><strong>Frequency-domain envelopes:</strong> define each wave’s envelope spectrum around <code>ωq</code> so dispersion becomes algebraic in Ω.</li>
                <li><strong>Taylor expansion:</strong> <code>β(ωq+Ω) ≈ βq + βq'Ω + (1/2)βq''Ω²</code>, giving group delay and GVD in time domain.</li>
                <li><strong>Perfect/near phase matching:</strong> if <code>Δβ = β3 − β1 − β2 ≈ 0</code>, coupling is strongest; otherwise a <code>e^{±iΔβ z}</code> factor appears.</li>
              </ul>
            </div>
          </details>

          <div class="callout danger">
            <strong>What to watch for (pitfalls)</strong>
            <ul>
              <li><strong>Sign conventions:</strong> whether you write <code>e^{i(βz−ωt)}</code> or <code>e^{i(ωt−βz)}</code> changes signs in the PDE operators.</li>
              <li><strong>Units of the envelope:</strong> depends on normalization (field, power, photon flux). The coupling constant <code>g</code> changes accordingly.</li>
              <li><strong>Dropping terms too early:</strong> if you drop <code>Ω²</code> terms in <code>β</code>, you lose GVD entirely.</li>
              <li><strong>Resonant selection:</strong> in <code>E²</code> there are many frequency components; you must keep only those near each carrier.</li>
            </ul>
          </div>

          <details>
            <summary>Mini intuition examples (quick, minimal algebra)</summary>
            <div class="inner">
              <ul>
                <li><strong>Walk-off:</strong> if <code>v1 &gt; v3</code>, then the <code>ω1</code>-pulse outruns the generated <code>ω3</code>-pulse. Their temporal overlap shrinks with z, limiting conversion length.</li>
                <li><strong>GVD broadening:</strong> even with no nonlinearity, a short pulse broadens as it propagates; peak intensity drops, reducing nonlinear interaction.</li>
                <li><strong>Energy exchange:</strong> with perfect phase matching and continuous waves, the amplitudes oscillate along z (parametric energy flow). Pulses add timing and shape complexity.</li>
              </ul>
            </div>
          </details>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 0B -->
      <section id="industry">
        <div class="secHd">
          <h2>PART 0B — Industry &amp; Applied Physics Perspective</h2>
          <div class="tag">Why engineers care</div>
        </div>
        <div class="content">
          <div class="cards">
            <div class="card">
              <h3>Where this shows up (concrete application areas)</h3>
              <ul>
                <li><strong>Telecom &amp; datacom:</strong> wavelength conversion, sum/difference-frequency generation, parametric amplification in nonlinear waveguides.</li>
                <li><strong>THz generation:</strong> optical rectification and difference-frequency generation in χ(2) crystals for spectroscopy, imaging, and nondestructive testing.</li>
                <li><strong>Ultrafast lasers:</strong> optical parametric amplifiers (OPAs/OPCPAs) where pulse timing and dispersion management control gain and bandwidth.</li>
                <li><strong>Quantum photonics:</strong> χ(2) frequency conversion for interfacing quantum emitters with telecom bands (dispersion and group-velocity matching are critical).</li>
              </ul>
            </div>
            <div class="card">
              <h3>Engineering drivers</h3>
              <ul>
                <li><strong>Performance:</strong> conversion efficiency, bandwidth, pulse fidelity, and noise.</li>
                <li><strong>Reliability:</strong> peak intensities and pulse compression can raise damage risk; dispersion can concentrate energy temporally (hot spots) if unmanaged.</li>
                <li><strong>Cost/size:</strong> shorter devices and lower pump power reduce system cost; dispersion/walk-off set the required device length and pump margins.</li>
                <li><strong>Manufacturability:</strong> phase matching, poling period, and waveguide dimensions have tolerances; dispersion is highly geometry-dependent in integrated platforms.</li>
              </ul>
            </div>
          </div>

          <div class="twoCol">
            <div class="callout">
              <strong>How it’s measured/validated in practice (brief)</strong>
              <ul>
                <li><strong>Dispersion:</strong> white-light interferometry, spectral phase measurements (FROG/SPIDER), ring-resonator methods (integrated), time-of-flight group delay.</li>
                <li><strong>Nonlinear coupling:</strong> conversion vs pump power, tuning curves vs temperature/angle/poling, effective <code>d_eff</code> extraction.</li>
                <li><strong>Pulse overlap:</strong> cross-correlation, autocorrelation, pump–signal timing scans to infer group-velocity mismatch.</li>
              </ul>
            </div>
            <div class="callout warn">
              <strong>Design trade-offs &amp; non-idealities</strong>
              <ul>
                <li><strong>Phase matching vs bandwidth:</strong> tight phase matching boosts peak efficiency but can narrow bandwidth; quasi-phase matching can broaden but adds fabrication sensitivity.</li>
                <li><strong>Walk-off vs length:</strong> longer crystals increase interaction length, but group-velocity mismatch reduces temporal overlap; there’s an optimal length.</li>
                <li><strong>GVD vs ultrashort pulses:</strong> shorter pulses have wider spectra, making higher-order dispersion (beyond <code>β''</code>) important in products.</li>
                <li><strong>Loss/absorption:</strong> especially in THz generation, absorption and heating matter; models add loss terms and temperature dependence.</li>
              </ul>
            </div>
          </div>

          <details>
            <summary>From lab to product: adapting the ideal model</summary>
            <div class="inner">
              <ul>
                <li>Real devices include <strong>linear loss</strong>, <strong>spatial mode profiles</strong>, and <strong>finite apertures</strong>; the coupling <code>g</code> becomes an overlap integral.</li>
                <li>Engineers extend the Taylor expansion to include <strong>third-order dispersion</strong> (<code>β'''</code>) for few-cycle pulses.</li>
                <li>Thermal drift, poling nonuniformity, and fabrication variations lead to a distribution of <code>Δβ(z)</code>; models incorporate stochastic or segmented phase mismatch.</li>
              </ul>
            </div>
          </details>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 1 -->
      <section id="analysis">
        <div class="secHd">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>
          <div class="tag">What is asked &amp; what tools apply</div>
        </div>
        <div class="content">
          <div class="callout">
            <strong>Restated problem (in plain words)</strong>
            <p style="margin:10px 0 0;color:var(--muted)">
              Starting from the Helmholtz equation with a nonlinear polarization source
              <code>s = μ0 ∂²P_NL/∂t²</code> (equivalently <code>-μ0 ω² P_NL</code> in frequency domain),
              where <code>P_NL = 2 d E²</code>, represent the electric field as a sum of three carrier waves
              with distinct central frequencies and slowly varying envelopes (SVEs). Convert the Helmholtz equation into three envelope equations
              (one near each carrier), simplify using SVEA, weak dispersion, and a three-term Taylor expansion of the propagation coefficient, and
              inverse-Fourier-transform back to the time domain to obtain the coupled-wave PDEs including group velocity and GVD.
            </p>
          </div>

          <div class="cards">
            <div class="card">
              <h3>Given</h3>
              <ul>
                <li>Nonlinear polarization: <code>P_NL = 2 d E²</code> (χ(2) medium; scalarized).</li>
                <li>Start from Helmholtz with source (frequency-domain): <code>(∂²/∂z² + k²(ω))E = -μ0 ω² P_NL</code>.</li>
                <li>Use: SVEA, weak dispersion, Taylor expansion of propagation constant to second order in detuning Ω.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Unknowns</h3>
              <ul>
                <li>Envelope evolution equations for <code>a1(z,t), a2(z,t), a3(z,t)</code>.</li>
                <li>How group velocity (<code>v1,v2,v3</code>) and GVD (<code>β1'',β2'',β3''</code>) enter the PDEs.</li>
              </ul>
            </div>
          </div>

          <div class="callout warn">
            <strong>Relevant principles (and why they apply)</strong>
            <ul>
              <li><strong>Frequency-domain wave equation:</strong> dispersion is naturally handled via <code>β(ω)</code>.</li>
              <li><strong>Envelope decomposition:</strong> isolates dynamics near each carrier and separates fast and slow scales.</li>
              <li><strong>Rotating-wave/phasematching selection:</strong> from <code>E²</code>, only terms near each carrier contribute to each envelope equation.</li>
              <li><strong>Second-order Taylor:</strong> keeps group delay (<code>β'</code>) and GVD (<code>β''</code>)—exactly what the problem requests.</li>
            </ul>
          </div>

          <div class="callout">
            <strong>Assumptions (explicit)</strong>
            <ul>
              <li>1D propagation along +z; polarization and modal structure absorbed into effective scalar parameters.</li>
              <li>Envelopes are narrowband around each carrier (detuning Ω small enough for Taylor series to converge).</li>
              <li>Forward-propagating waves dominate (no significant backward wave).</li>
              <li>Near-perfect phase matching so the final equations can be written without explicit <code>exp(±iΔβ z)</code> factors (or they are absorbed into envelope definitions).</li>
            </ul>
          </div>

          <div class="cards">
            <div class="card">
              <h3>Possible approaches</h3>
              <ul>
                <li><strong>Time-domain directly:</strong> Expand derivatives acting on <code>a(z,t)e^{i(βz−ωt)}</code>; workable but algebra-heavy for dispersion.</li>
                <li><strong>Frequency-domain envelopes (best here):</strong> Treat dispersion via <code>β(ω)</code>, expand in Ω, then inverse transform to time.</li>
                <li><strong>Coupled-mode energy approach:</strong> Derive from Maxwell + averaging; intuitive but less direct for GVD terms.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Chosen approach &amp; why</h3>
              <p>
                We use the <strong>frequency-domain envelope</strong> method: it makes dispersion systematic (a Taylor series in Ω),
                and the inverse Fourier transform turns powers of Ω into time derivatives, producing the desired PDE operators cleanly.
              </p>
            </div>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 2 -->
      <section id="strategy">
        <div class="secHd">
          <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>
          <div class="tag">Plan before algebra</div>
        </div>
        <div class="content">
          <div class="callout">
            <strong>Minimal plan (10 steps)</strong>
            <ol style="margin:10px 0 0 18px; color:var(--muted)">
              <li><strong>Write Helmholtz in frequency domain</strong> with nonlinear source; goal: a propagation equation for <code>E(z,ω)</code>.</li>
              <li><strong>Decompose the field into three carriers + envelopes</strong>; goal: isolate dynamics near <code>ω1,ω2,ω3</code>.</li>
              <li><strong>Define detuning variable Ω</strong> around each carrier (<code>ω = ωq + Ω</code>); goal: treat “pulsed” bandwidth.</li>
              <li><strong>Use SVEA / forward wave approximation</strong> to reduce <code>∂²/∂z²</code> to first order; goal: get <code>∂Aq/∂z</code>.</li>
              <li><strong>Compute the resonant parts of <code>P_NL</code></strong> near each carrier from <code>P_NL = 2 d E²</code>; goal: coupling terms like <code>a1 a2</code>, <code>a3 a2*</code>.</li>
              <li><strong>Expand the propagation constant</strong> <code>β(ωq+Ω)</code> to second order; goal: group delay + GVD.</li>
              <li><strong>Move to “envelope reference phase”</strong> to remove <code>βq</code> and (optionally) <code>Δβ</code>; goal: simple coupling without fast z-oscillations.</li>
              <li><strong>Inverse Fourier transform</strong> Ω → t; goal: convert <code>Ω</code> to <code>i∂/∂t</code> and <code>Ω²</code> to <code>−∂²/∂t²</code>.</li>
              <li><strong>Collect terms</strong> to form operators <code>(∂z + (1/vq)∂t − iβq''/2 ∂t²)</code>.</li>
              <li><strong>Sanity checks</strong> (units, limiting cases: no dispersion, CW limit) and present final equations.</li>
            </ol>
          </div>

          <div class="callout danger">
            <strong>Common mistakes (quick tips)</strong>
            <ul>
              <li>Forgetting that <code>Ω ↔ i∂/∂t</code> under inverse Fourier transform (watch signs).</li>
              <li>Dropping <code>β''</code> too soon, which removes GVD (the whole point of the problem).</li>
              <li>Keeping non-resonant terms from <code>E²</code> (they average out rapidly and shouldn’t drive the envelopes).</li>
              <li>Mixing envelope normalizations: if you change how <code>a</code> is defined, <code>g</code> must change too.</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 3 -->
      <section id="solution">
        <div class="secHd">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>
          <div class="tag">Step-by-step derivation</div>
        </div>
        <div class="content">
          <div class="callout">
            <strong>Qualitative expectation (before calculating)</strong>
            <ul>
              <li>Each envelope should propagate at its own group velocity <code>vq</code> ⇒ a <code>(1/vq)∂/∂t</code> “walk-off” term.</li>
              <li>Each pulse should broaden due to GVD ⇒ a dispersive term proportional to <code>βq'' ∂²/∂t²</code>.</li>
              <li>Nonlinearity should couple the envelopes with products matching energy conservation (<code>ω3 = ω1 + ω2</code> for sum-frequency generation).</li>
            </ul>
          </div>

          <div class="callout ok">
            <strong>Process assumed (consistent with Eq. 23.5-3 structure)</strong>
            <p style="margin:10px 0 0;color:var(--muted)">
              The coupling pattern
              <code>a3 a2*</code> in the <code>a1</code>-equation,
              <code>a3 a1*</code> in the <code>a2</code>-equation, and
              <code>a1 a2</code> in the <code>a3</code>-equation
              corresponds to <strong>sum-frequency generation (SFG)</strong> (or equivalently parametric interaction) with
              <code>ω3 = ω1 + ω2</code>. Phase mismatch <code>Δβ = β3 − β1 − β2</code> is assumed negligible or absorbed.
            </p>
          </div>

          <div class="twoCol">
            <div>
              <h3 style="margin:0 0 8px">Step 1 — Start from the frequency-domain Helmholtz equation</h3>
              <p style="margin:0;color:var(--muted)">
                The scalar frequency-domain wave equation in 1D can be written as:
              </p>
              <div class="eqRow" style="margin-top:10px">
                <button class="btn small" data-copy-target="eq1">Copy equation</button>
              </div>
              <pre id="eq1">(∂²/∂z² + k²(ω)) E(z,ω) = -μ0 ω² P_NL(z,ω)</pre>
              <p style="margin:10px 0 0;color:var(--muted)">
                In a dielectric, <code>k(ω)=n(ω)ω/c</code>. It is standard to denote the propagation constant by <code>β(ω)</code>, so we use
                <code>β(ω) ≡ k(ω)</code> in what follows.
              </p>
            </div>
            <div>
              <h3 style="margin:0 0 8px">Step 2 — Nonlinear polarization model</h3>
              <p style="margin:0;color:var(--muted)">
                Given <code>P_NL = 2 d E²</code>, the polarization contains frequency components at sums and differences of the carriers in <code>E</code>.
                The factor “2” is conventional for this scalarized χ(2) model.
              </p>
              <div class="eqRow" style="margin-top:10px">
                <button class="btn small" data-copy-target="eq2">Copy equation</button>
              </div>
              <pre id="eq2">P_NL(z,t) = 2 d [E(z,t)]²</pre>
            </div>
          </div>

          <h3 style="margin:6px 0 0">Step 3 — Represent the field as three waves with slowly varying envelopes</h3>
          <p style="margin:0;color:var(--muted)">
            Write the real electric field as the real part of a complex analytic signal. Using the common convention
            <code>exp[i(βz − ωt)]</code>, we set:
          </p>
          <div class="eqRow" style="margin-top:10px">
            <button class="btn small" data-copy-target="eq3">Copy equation</button>
          </div>
          <pre id="eq3">E(z,t) = (1/2) Σ_{q=1}^3 [ a_q(z,t) e^{i(β_q z - ω_q t)} ] + c.c.</pre>
          <p style="margin:10px 0 0;color:var(--muted)">
            where <code>a_q(z,t)</code> are the slowly varying envelopes (SVEs), and <code>β_q ≡ β(ω_q)</code>.
            “Slowly varying” means their characteristic variation lengths/times are much larger than <code>1/β_q</code> and <code>1/ω_q</code>.
          </p>

          <h3 style="margin:6px 0 0">Step 4 — Move to envelope spectra around each carrier</h3>
          <p style="margin:0;color:var(--muted)">
            For pulsed fields, each envelope contains a bandwidth around the carrier. Define the Fourier transform (detuning Ω):
          </p>
          <div class="eqRow" style="margin-top:10px">
            <button class="btn small" data-copy-target="eq4">Copy equation</button>
          </div>
          <pre id="eq4">a_q(z,t) = ∫_{-∞}^{∞} A_q(z,Ω) e^{-iΩ t} (dΩ/2π)
(so that ω = ω_q + Ω inside the q-th band)</pre>
          <p style="margin:10px 0 0;color:var(--muted)">
            This is the key step: dispersion acts on spectral components, so we handle it in Ω and later transform back to time.
          </p>

          <h3 style="margin:6px 0 0">Step 5 — Apply the forward-wave / SVEA reduction in z</h3>
          <p style="margin:0;color:var(--muted)">
            In each narrowband around <code>ωq</code>, we treat the field as predominantly forward-propagating, so the Helmholtz operator factors as
            <code>(∂/∂z - iβ)(∂/∂z + iβ)E</code>. Neglecting the backward component leads to a first-order equation:
          </p>
          <div class="eqRow" style="margin-top:10px">
            <button class="btn small" data-copy-target="eq5">Copy equation</button>
          </div>
          <pre id="eq5">∂E(z,ω)/∂z ≈ iβ(ω) E(z,ω) - i [ μ0 ω² / (2β(ω)) ] P_NL(z,ω)</pre>
          <p style="margin:10px 0 0;color:var(--muted)">
            This is the standard forward Maxwell equation used to derive coupled-wave equations. The prefactor multiplying <code>P_NL</code> can be
            absorbed into an effective coupling constant once envelopes are defined (that is why texts often present a compact <code>g</code>).
          </p>

          <details>
            <summary>Why the SVEA/forward step is reasonable (optional detail)</summary>
            <div class="inner">
              <p style="margin:0">
                If <code>E(z,ω)=\tilde{E}(z,ω) e^{iβz}</code> with slowly varying <code>\tilde{E}</code>, then
                <code>∂²E/∂z² ≈ (2iβ ∂\tilde{E}/∂z - β² \tilde{E}) e^{iβz}</code>. Inserting into Helmholtz cancels the <code>β²</code> term,
                leaving <code>2iβ ∂\tilde{E}/∂z</code>, i.e., first order in z.
              </p>
            </div>
          </details>

          <h3 style="margin:6px 0 0">Step 6 — Identify resonant nonlinear polarization components</h3>
          <p style="margin:0;color:var(--muted)">
            Using <code>E = (1/2)Σ a_q e^{i(β_q z - ω_q t)} + c.c.</code>, the square <code>E²</code> contains terms like:
          </p>
          <div class="eqRow" style="margin-top:10px">
            <button class="btn small" data-copy-target="eq6">Copy equation</button>
          </div>
          <pre id="eq6">E² contains (among others):
(1/4) a1 a2 e^{i[(β1+β2)z - (ω1+ω2)t]}   → drives ω3 = ω1+ω2
(1/4) a3 a2* e^{i[(β3-β2)z - (ω3-ω2)t]} → drives ω1 = ω3-ω2
(1/4) a3 a1* e^{i[(β3-β1)z - (ω3-ω1)t]} → drives ω2 = ω3-ω1</pre>
          <p style="margin:10px 0 0;color:var(--muted)">
            Keeping only the components oscillating near each carrier (and dropping rapidly oscillating, nonresonant terms),
            the envelopes couple as <code>a3 a2*</code>, <code>a3 a1*</code>, and <code>a1 a2</code>. A phase-mismatch factor
            <code>exp(iΔβ z)</code> would appear with <code>Δβ = β3 − β1 − β2</code>; Eq. 23.5-3 corresponds to <code>Δβ≈0</code> (or absorbed).
          </p>

          <h3 style="margin:6px 0 0">Step 7 — Expand dispersion with a 3-term Taylor series of β</h3>
          <p style="margin:0;color:var(--muted)">
            For each band, write <code>ω = ωq + Ω</code> and expand:
          </p>
          <div class="eqRow" style="margin-top:10px">
            <button class="btn small" data-copy-target="eq7">Copy equation</button>
          </div>
          <pre id="eq7">β(ωq + Ω) ≈ βq + βq' Ω + (1/2) βq'' Ω²
where βq' = (dβ/dω)|ωq  and  βq'' = (d²β/dω²)|ωq</pre>
          <p style="margin:10px 0 0;color:var(--muted)">
            The physical meaning:
            <code>βq'</code> gives the group delay per unit length (thus <code>vq = 1/βq'</code>),
            and <code>βq''</code> describes how group delay varies across the pulse spectrum (GVD).
          </p>

          <h3 style="margin:6px 0 0">Step 8 — Convert the Ω-dependence into time-derivative operators</h3>
          <p style="margin:0;color:var(--muted)">
            The inverse Fourier transform implies:
            <code>Ω A_q(z,Ω) ↔ i ∂a_q/∂t</code> and <code>Ω² A_q(z,Ω) ↔ - ∂²a_q/∂t²</code>.
            When the propagation phase <code>exp[iβ(ω)z]</code> is expanded in Ω and mapped back to t,
            the envelope evolution acquires the group-velocity and GVD derivatives.
          </p>

          <div class="callout">
            <strong>Key transform identities (with our convention <code>a(t)=∫A(Ω)e^{-iΩt} dΩ/2π</code>)</strong>
            <div class="eqRow" style="margin-top:10px">
              <button class="btn small" data-copy-target="eq8">Copy identities</button>
            </div>
            <pre id="eq8">Ω A(Ω)  ↔  i ∂a/∂t
Ω² A(Ω) ↔ - ∂²a/∂t²</pre>
          </div>

          <h3 style="margin:6px 0 0">Step 9 — Assemble the coupled time-domain envelope equations</h3>
          <p style="margin:0;color:var(--muted)">
            After (i) removing the carrier phases, (ii) using the forward/SVEA reduction, (iii) retaining terms through <code>Ω²</code> in β,
            and (iv) keeping only resonant nonlinear polarization components, each envelope satisfies a first-order PDE in z and t:
          </p>

          <div class="callout ok">
            <strong>Final derived coupled-wave equations with group velocity + GVD (Eq. 23.5-3 form)</strong>
            <div class="eqRow" style="margin-top:10px">
              <button class="btn small" data-copy-target="finalEq2">Copy final answer</button>
              <span class="copyHint">Plain text</span>
            </div>
            <pre id="finalEq2">(∂/∂z + (1/v1)∂/∂t - i(β1''/2)∂²/∂t²) a1(z,t) = -i g a3(z,t) a2*(z,t)

(∂/∂z + (1/v2)∂/∂t - i(β2''/2)∂²/∂t²) a2(z,t) = -i g a3(z,t) a1*(z,t)

(∂/∂z + (1/v3)∂/∂t - i(β3''/2)∂²/∂t²) a3(z,t) = -i g a1(z,t) a2(z,t)</pre>
            <p style="margin:10px 0 0;color:var(--muted)">
              with <code>vq = 1/βq'</code>. The constant <code>g</code> collects factors from the nonlinear polarization, refractive indices, normalization,
              and (in guided-wave systems) modal overlap. If phase mismatch is not neglected, each RHS gains a factor <code>exp(±iΔβ z)</code>.
            </p>
          </div>

          <h3 style="margin:6px 0 0">Step 10 — Sanity checks</h3>
          <div class="twoCol">
            <div class="callout">
              <strong>Units/dimensions</strong>
              <ul>
                <li><code>∂/∂z</code> has units 1/m.</li>
                <li><code>(1/v)∂/∂t</code> has units (s/m)·(1/s)=1/m.</li>
                <li><code>β'' ∂²/∂t²</code> has units (s²/m)·(1/s²)=1/m, so the operator is consistent.</li>
                <li>The RHS units depend on how <code>a</code> is normalized; <code>g</code> carries the matching units.</li>
              </ul>
            </div>
            <div class="callout warn">
              <strong>Limiting cases</strong>
              <ul>
                <li><strong>No GVD:</strong> set <code>βq''=0</code> ⇒ equations reduce to group-velocity (walk-off) + nonlinear coupling only.</li>
                <li><strong>CW limit:</strong> if envelopes are time-independent (<code>∂/∂t=0</code>), you recover the standard continuous-wave coupled ODEs.</li>
                <li><strong>Same group velocities:</strong> if <code>v1=v2=v3</code>, pulses co-propagate in a common retarded time frame, maximizing overlap.</li>
              </ul>
            </div>
          </div>

          <div class="callout">
            <strong>Physical interpretation (plain language)</strong>
            <ul>
              <li>The left-hand operator is “propagation + drift in time + dispersive spreading.”</li>
              <li>The right-hand side is “nonlinear drive” that converts energy between the three waves when their phases match.</li>
              <li>In practice, walk-off and GVD reduce peak overlap, lowering conversion for ultrashort pulses unless compensated.</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 4 -->
      <section id="deeper">
        <div class="secHd">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>
          <div class="tag">What each term does</div>
        </div>
        <div class="content">
          <div class="cards">
            <div class="card">
              <h3>Re-reading the final operator</h3>
              <p>
                For each wave <code>q</code>, the envelope evolves via
                <code>(∂z + (1/vq)∂t − iβq''/2 ∂t²) aq = (nonlinear drive)</code>.
              </p>
              <ul>
                <li><code>∂z aq</code>: change with propagation distance.</li>
                <li><code>(1/vq)∂t aq</code>: group delay (pulse walks forward in time as z increases in the lab frame).</li>
                <li><code>−iβq''/2 ∂t² aq</code>: dispersive phase curvature in frequency → pulse broadening/chirp in time.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Parameter dependence (qualitative)</h3>
              <ul>
                <li><strong>Larger |βq''|:</strong> stronger broadening → lower peak intensity → weaker nonlinear coupling for short pulses.</li>
                <li><strong>Group-velocity mismatch:</strong> large differences between <code>vq</code> shorten effective interaction length (temporal overlap decays with z).</li>
                <li><strong>Larger g (stronger nonlinearity):</strong> faster energy exchange, higher conversion for a given length and overlap.</li>
                <li><strong>Better phase matching:</strong> maintains constructive buildup; mismatch causes oscillatory energy flow and reduced net conversion.</li>
              </ul>
            </div>
          </div>

          <details>
            <summary>Alternative derivation idea (brief but meaningful)</summary>
            <div class="inner">
              <p style="margin:0">
                You can derive similar equations directly in the time domain by substituting
                <code>E(z,t) = (1/2) a(z,t)e^{i(βz−ωt)} + c.c.</code> into the wave equation
                <code>∂²E/∂z² − (n²/c²)∂²E/∂t² = μ0 ∂²P_NL/∂t²</code>, then expanding the material response using a slowly varying approximation.
                However, capturing GVD cleanly requires representing the linear response as a convolution in time; the frequency-domain method avoids that complexity.
              </p>
            </div>
          </details>

          <div class="callout">
            <strong>Concept checks (self-test, with answers)</strong>
            <ul>
              <li><strong>Q:</strong> If <code>β'' = 0</code> but <code>v1 ≠ v3</code>, what limits conversion? <br><strong>A:</strong> walk-off: pulses separate in time, reducing overlap.</li>
              <li><strong>Q:</strong> Why does GVD appear with a factor <code>-i</code>? <br><strong>A:</strong> dispersion is a phase effect in frequency; mapping Ω² to time derivatives yields an imaginary coefficient representing phase curvature.</li>
              <li><strong>Q:</strong> Why are complex conjugates present in the <code>a1</code> and <code>a2</code> equations? <br><strong>A:</strong> because those interactions correspond to difference frequencies (e.g., <code>ω1 = ω3 − ω2</code>), which come from products like <code>a3 a2*</code>.</li>
              <li><strong>Q:</strong> In what frame can the group-velocity term be removed? <br><strong>A:</strong> in a retarded time frame <code>τ = t − z/v_ref</code>; you can eliminate one <code>(1/v)∂t</code> term by choosing <code>v_ref</code>, but not all three unless the group velocities are equal.</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <!-- PART 5 -->
      <section id="plot">
        <div class="secHd">
          <h2>PART 5 — Optional Plot Guide</h2>
          <div class="tag">One simple static plot (example values)</div>
        </div>
        <div class="content">
          <div class="callout">
            <strong>Why include a plot here?</strong>
            <p style="margin:10px 0 0;color:var(--muted)">
              The derivation is symbolic, but it helps to visualize what the <code>β''</code> term physically does: it causes pulse broadening with propagation.
              Below is a single illustrative plot of normalized pulse width <code>τ(z)/τ0</code> versus distance <code>z</code> for a Gaussian pulse in a purely dispersive medium
              (no nonlinearity). This directly connects to the <code>-(i/2)β'' ∂²/∂t²</code> term in the coupled equations.
            </p>
          </div>

          <figure aria-label="Pulse broadening due to GVD">
            <div class="canvasWrap">
              <canvas id="gvdPlot" width="1100" height="520"></canvas>
            </div>
            <figcaption>
              <strong>Static plot (example values):</strong> Gaussian pulse broadening under GVD only, using
              <code>τ(z) = τ0 √(1 + (β'' z / τ0²)²)</code>.
              Example values for plotting: <code>τ0 = 100 fs</code>, <code>|β''| = 100 fs²/mm</code> (typical order for some optical materials/waveguides; sign does not affect width).
              The final coupled-wave solution above remains fully symbolic.
            </figcaption>
          </figure>

          <div class="callout warn">
            <strong>What to notice in the curve</strong>
            <ul>
              <li>Near <code>z=0</code>, the width is ~constant (<code>τ≈τ0</code>).</li>
              <li>For larger <code>z</code>, broadening grows roughly linearly with <code>z</code> once <code>|β''|z ≫ τ0²</code>.</li>
              <li>Broader pulses lower peak intensity, which weakens nonlinear coupling in real three-wave mixing systems.</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </div>
      </section>

      <footer>
        <div>Self-contained learning article • Vanilla HTML/CSS/JS • Copy buttons included • Print-friendly layout</div>
      </footer>
    </article>
  </main>

  <script>
    (function(){
      // Copy buttons (plain text)
      function getTextFromEl(el){
        if(!el) return "";
        return (el.innerText || el.textContent || "").trim();
      }

      async function copyText(text){
        try{
          await navigator.clipboard.writeText(text);
          return true;
        }catch(e){
          // Fallback
          try{
            const ta = document.createElement("textarea");
            ta.value = text;
            ta.setAttribute("readonly","");
            ta.style.position="fixed";
            ta.style.left="-9999px";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            document.body.removeChild(ta);
            return true;
          }catch(e2){
            return false;
          }
        }
      }

      document.addEventListener("click", async (ev)=>{
        const btn = ev.target.closest("[data-copy-target]");
        if(!btn) return;
        const id = btn.getAttribute("data-copy-target");
        const el = document.getElementById(id);
        const text = getTextFromEl(el);
        const ok = await copyText(text);

        const old = btn.textContent;
        btn.textContent = ok ? "Copied ✓" : "Copy failed";
        btn.style.borderColor = ok ? "rgba(52,211,153,.35)" : "rgba(251,113,133,.45)";
        btn.style.background = ok ? "rgba(52,211,153,.10)" : "rgba(251,113,133,.10)";
        setTimeout(()=>{
          btn.textContent = old;
          btn.style.borderColor = "";
          btn.style.background = "";
        }, 1100);
      });

      // ---- Canvas plot: GVD pulse broadening (static) ----
      const canvas = document.getElementById("gvdPlot");
      if(!canvas) return;

      function draw(){
        const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
        const cssW = canvas.clientWidth || 900;
        const cssH = Math.max(280, Math.round(cssW * 0.46));
        canvas.style.height = cssH + "px";
        canvas.width = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);

        const ctx = canvas.getContext("2d");
        ctx.setTransform(dpr,0,0,dpr,0,0);
        const W = cssW, H = cssH;

        // Layout
        const padL = 64, padR = 18, padT = 34, padB = 52;
        const plotW = W - padL - padR;
        const plotH = H - padT - padB;

        // Example values (for plot only)
        // τ(z) = τ0 sqrt(1 + (β'' z / τ0^2)^2)
        // Use τ0 = 100 fs, |β''| = 100 fs^2/mm
        const tau0_fs = 100;
        const beta2_fs2_per_mm = 100;

        // Axes: z in mm
        const zMin = 0;
        const zMax = 10; // mm
        const yMin = 1.0;
        // compute yMax from formula at zMax
        const yAtMax = Math.sqrt(1 + Math.pow((beta2_fs2_per_mm * zMax) / (tau0_fs*tau0_fs), 2));
        const yMax = Math.max(1.6, Math.min(4.5, yAtMax*1.10));

        function xOf(z){ return padL + (z - zMin) / (zMax - zMin) * plotW; }
        function yOf(y){ return padT + (yMax - y) / (yMax - yMin) * plotH; }

        // Background
        ctx.clearRect(0,0,W,H);
        // subtle vignette
        const g = ctx.createRadialGradient(W*0.2,H*0.15,20, W*0.45,H*0.35, Math.max(W,H));
        g.addColorStop(0,"rgba(125,211,252,0.12)");
        g.addColorStop(1,"rgba(0,0,0,0)");
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);

        // Gridlines
        ctx.save();
        ctx.lineWidth = 1;
        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        ctx.fillStyle = "rgba(255,255,255,0.86)";

        // X ticks
        const xTicks = 6;
        for(let i=0;i<=xTicks;i++){
          const z = zMin + (zMax - zMin) * (i/xTicks);
          const x = xOf(z);
          ctx.beginPath();
          ctx.moveTo(x, padT);
          ctx.lineTo(x, padT + plotH);
          ctx.stroke();
        }
        // Y ticks
        const yTicks = 5;
        for(let i=0;i<=yTicks;i++){
          const y = yMin + (yMax - yMin) * (i/yTicks);
          const yy = yOf(y);
          ctx.beginPath();
          ctx.moveTo(padL, yy);
          ctx.lineTo(padL + plotW, yy);
          ctx.stroke();
        }
        ctx.restore();

        // Axes
        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.35)";
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(padL, padT);
        ctx.lineTo(padL, padT + plotH);
        ctx.lineTo(padL + plotW, padT + plotH);
        ctx.stroke();
        ctx.restore();

        // Labels & title
        ctx.save();
        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.font = "700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("Pulse broadening due to GVD (example values)", padL, 10);

        ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.fillStyle = "rgba(255,255,255,0.80)";
        ctx.fillText("τ(z)/τ0 (dimensionless)", 10, padT - 2);

        ctx.textAlign = "center";
        ctx.textBaseline = "alphabetic";
        ctx.fillText("Propagation distance z (mm)", padL + plotW/2, H - 14);
        ctx.restore();

        // Tick labels
        ctx.save();
        ctx.fillStyle = "rgba(255,255,255,0.75)";
        ctx.font = "11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";

        // x tick labels
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        for(let i=0;i<=xTicks;i++){
          const z = zMin + (zMax - zMin) * (i/xTicks);
          const x = xOf(z);
          // tick mark
          ctx.strokeStyle = "rgba(255,255,255,0.35)";
          ctx.beginPath();
          ctx.moveTo(x, padT + plotH);
          ctx.lineTo(x, padT + plotH + 6);
          ctx.stroke();
          ctx.fillText(z.toFixed(0), x, padT + plotH + 10);
        }

        // y tick labels
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        for(let i=0;i<=yTicks;i++){
          const y = yMin + (yMax - yMin) * (i/yTicks);
          const yy = yOf(y);
          ctx.strokeStyle = "rgba(255,255,255,0.35)";
          ctx.beginPath();
          ctx.moveTo(padL - 6, yy);
          ctx.lineTo(padL, yy);
          ctx.stroke();
          ctx.fillText(y.toFixed(2), padL - 10, yy);
        }
        ctx.restore();

        // Curve
        const N = 400;
        ctx.save();
        ctx.lineWidth = 2.2;
        ctx.strokeStyle = "rgba(125,211,252,0.95)";
        ctx.beginPath();
        for(let i=0;i<=N;i++){
          const z = zMin + (zMax - zMin) * (i/N);
          const ratio = Math.sqrt(1 + Math.pow((beta2_fs2_per_mm * z) / (tau0_fs*tau0_fs), 2));
          const x = xOf(z);
          const y = yOf(ratio);
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.stroke();
        ctx.restore();

        // Legend
        ctx.save();
        const lx = padL + plotW - 250;
        const ly = padT + 12;
        ctx.fillStyle = "rgba(0,0,0,0.35)";
        ctx.strokeStyle = "rgba(255,255,255,0.12)";
        roundRect(ctx, lx, ly, 235, 58, 12);
        ctx.fill(); ctx.stroke();

        ctx.strokeStyle = "rgba(125,211,252,0.95)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(lx+14, ly+18);
        ctx.lineTo(lx+44, ly+18);
        ctx.stroke();

        ctx.fillStyle = "rgba(255,255,255,0.86)";
        ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textBaseline = "middle";
        ctx.fillText("τ(z)/τ0 = √(1 + (β'' z / τ0²)²)", lx+52, ly+18);

        ctx.fillStyle = "rgba(255,255,255,0.74)";
        ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.fillText("Example: τ0=100 fs, |β''|=100 fs²/mm", lx+14, ly+40);
        ctx.restore();

        function roundRect(c, x, y, w, h, r){
          const rr = Math.min(r, w/2, h/2);
          c.beginPath();
          c.moveTo(x+rr, y);
          c.arcTo(x+w, y, x+w, y+h, rr);
          c.arcTo(x+w, y+h, x, y+h, rr);
          c.arcTo(x, y+h, x, y, rr);
          c.arcTo(x, y, x+w, y, rr);
          c.closePath();
        }
      }

      const ro = new ResizeObserver(()=>draw());
      ro.observe(canvas);
      draw();
    })();
  </script>
</body>
</html>
