<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interferometer with a Two-Photon Absorbing Detector vs SHG Interferometer — Expansion and Term Comparison</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1724;
      --panel2:#111c2c;
      --text:#e8edf6;
      --muted:#aab6cc;
      --faint:#7f8aa3;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#6ee7b7;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(125,211,252,.18), transparent 55%),
        radial-gradient(900px 600px at 110% 15%, rgba(167,139,250,.16), transparent 50%),
        linear-gradient(180deg, #070a10 0%, var(--bg) 35%, #070a10 100%);
      color:var(--text);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre{font-family:var(--mono)}
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding: clamp(18px, 2.5vw, 28px);
    }

    header.hero{
      position:relative;
      padding: clamp(18px, 2.5vw, 28px);
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header.hero::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(700px 350px at 25% 20%, rgba(125,211,252,.22), transparent 60%),
        radial-gradient(650px 350px at 85% 40%, rgba(167,139,250,.20), transparent 60%);
      filter: blur(10px);
      opacity:.7;
      pointer-events:none;
    }
    header.hero > *{position:relative}
    .kicker{
      color: var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:.78rem;
      margin:0 0 10px 0;
    }
    h1{
      margin: 0 0 10px 0;
      font-size: clamp(1.55rem, 2.4vw, 2.25rem);
      line-height:1.18;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      max-width: 85ch;
    }

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
      margin-top: 18px;
      align-items:start;
    }
    @media (max-width: 980px){
      .layout{grid-template-columns: 1fr}
    }

    nav.toc{
      position:sticky;
      top: 14px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(17,28,44,.75), rgba(15,23,36,.68));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    nav.toc header{
      padding: 14px 16px 12px 16px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    nav.toc header .title{
      font-weight:700;
      font-size:.98rem;
      letter-spacing:.02em;
    }
    nav.toc header .pill{
      font-size:.72rem;
      color: var(--muted);
      padding: 4px 10px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.03);
      white-space:nowrap;
    }
    nav.toc ul{
      list-style:none;
      padding: 10px 12px 14px 12px;
      margin:0;
      display:grid;
      gap: 6px;
    }
    nav.toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--text);
      border:1px solid transparent;
      background: transparent;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      font-size: .95rem;
    }
    nav.toc a:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(125,211,252,.22);
      transform: translateY(-1px);
      text-decoration:none;
    }

    main{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(15,23,36,.72), rgba(15,23,36,.50));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .content{
      padding: clamp(18px, 2.4vw, 28px);
    }

    section{
      scroll-margin-top: 90px;
      margin: 0 0 18px 0;
      padding: 0 0 18px 0;
      border-bottom: 1px solid var(--line);
    }
    section:last-child{border-bottom:none; padding-bottom:0; margin-bottom:0}
    h2{
      margin: 0 0 10px 0;
      font-size: clamp(1.2rem, 1.8vw, 1.55rem);
      letter-spacing:.01em;
    }
    h3{
      margin: 14px 0 8px 0;
      font-size: 1.05rem;
      color: var(--text);
    }
    p{margin: 8px 0; color: var(--text)}
    .muted{color: var(--muted)}
    .fine{color: var(--faint); font-size:.95rem}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 10px;
    }
    @media (max-width: 900px){ .grid2{grid-template-columns:1fr} }

    .card{
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border-radius: var(--radius);
      padding: 14px 14px;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
    }

    .callout{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 12px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      position:relative;
      overflow:hidden;
      margin-top: 10px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:.74rem;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(125,211,252,.12);
    }
    .dot.warn{background: var(--warn); box-shadow:0 0 0 3px rgba(251,191,36,.14)}
    .dot.good{background: var(--good); box-shadow:0 0 0 3px rgba(110,231,183,.14)}
    .dot.bad{background: var(--bad); box-shadow:0 0 0 3px rgba(251,113,133,.14)}

    .eqbox{
      border:1px solid rgba(125,211,252,.22);
      background: linear-gradient(180deg, rgba(125,211,252,.08), rgba(125,211,252,.04));
      border-radius: var(--radius);
      padding: 12px 12px;
      margin: 10px 0;
    }
    .eqrow{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    pre.eq{
      margin:0;
      padding:0;
      white-space:pre-wrap;
      word-break:break-word;
      color:#eaf5ff;
      font-size: .96rem;
      line-height:1.5;
    }
    .btn{
      appearance:none;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 999px;
      padding: 7px 10px;
      font-size:.86rem;
      cursor:pointer;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(125,211,252,.30)}
    .btn.small{padding:6px 9px; font-size:.82rem}
    .btn.good{border-color: rgba(110,231,183,.32)}
    .btn.good:hover{border-color: rgba(110,231,183,.55)}

    details{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 10px 12px;
      background: rgba(255,255,255,.03);
      margin: 10px 0;
    }
    summary{
      cursor:pointer;
      font-weight:650;
      color: var(--text);
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    summary .chev{
      width: 10px; height: 10px;
      border-right: 2px solid var(--muted);
      border-bottom: 2px solid var(--muted);
      transform: rotate(-45deg);
      transition: transform .18s ease;
      margin-left:auto;
      opacity:.9;
    }
    details[open] summary .chev{transform: rotate(45deg)}
    .klist{
      margin: 8px 0 0 0;
      padding-left: 18px;
      color: var(--muted);
    }
    .klist li{margin: 5px 0}
    .bullets{
      margin: 10px 0 0 0;
      padding-left: 18px;
      color: var(--text);
    }
    .bullets li{margin: 6px 0}
    .divider{
      height:1px;
      background: var(--line);
      margin: 14px 0;
    }

    figure{
      margin: 12px 0 0 0;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    figcaption{
      padding: 10px 12px;
      border-top:1px solid var(--line);
      color: var(--muted);
      font-size:.92rem;
    }
    canvas{display:block; width:100%; height:auto}

    .backtop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.03);
      color: var(--text);
      text-decoration:none;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .backtop:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.05);
      border-color: rgba(125,211,252,.30);
      text-decoration:none;
    }

    footer{
      padding: 14px clamp(18px, 2.4vw, 28px);
      border-top:1px solid var(--line);
      color: var(--muted);
      background: rgba(0,0,0,.14);
    }

    @media print{
      body{background:#fff; color:#000}
      header.hero, nav.toc, main, .card, .callout, .eqbox, details, figure{
        box-shadow:none !important;
        background:#fff !important;
        color:#000 !important;
        border-color:#bbb !important;
      }
      nav.toc{position:static}
      .btn{display:none}
      a{color:#000; text-decoration:underline}
      .layout{grid-template-columns: 1fr}
      section{break-inside:avoid}
      h1, h2, h3{color:#000}
      .muted, .fine{color:#222}
      pre.eq{color:#000}
      figcaption{color:#222}
    }
  </style>
</head>
<body>
  <a id="top"></a>
  <div class="wrap">
    <header class="hero" aria-label="Article header">
      <p class="kicker">Photonics • Nonlinear interferometry • Phase-sensitive autocorrelation</p>
      <h1>Two-Photon Absorbing Detector Interferometer vs SHG Interferometer: Expand the Measured Function and Compare Terms</h1>
      <p class="subtitle">
        We expand the two-photon-absorber interferometric signal into DC, carrier-frequency, and double-carrier-frequency components (0, ν<sub>0</sub>, 2ν<sub>0</sub>),
        then compare the resulting terms to the classic second-harmonic-generation (SHG) interferometer result.
      </p>
    </header>

    <div class="layout">
      <nav class="toc" aria-label="Table of contents">
        <header>
          <div class="title">On this page</div>
          <div class="pill">Sticky TOC</div>
        </header>
        <ul>
          <li><a href="#qs">Quick Summary</a></li>
          <li><a href="#primer">PART 0 — Concept Primer</a></li>
          <li><a href="#industry">PART 0B — Industry & Applied Physics</a></li>
          <li><a href="#analysis">PART 1 — Problem Analysis</a></li>
          <li><a href="#strategy">PART 2 — Strategy & Tips</a></li>
          <li><a href="#solution">PART 3 — Full Solution</a></li>
          <li><a href="#deeper">PART 4 — Deeper Understanding</a></li>
          <li><a href="#plotguide">PART 5 — Optional Plot Guide</a></li>
        </ul>
      </nav>

      <main>
        <div class="content">
          <section id="qs" aria-label="Quick summary">
            <h2>Quick Summary</h2>
            <ul class="bullets">
              <li><span class="muted">What this is about:</span> comparing two interferometric pulse-measurement schemes that both use <em>nonlinear detection</em> and therefore respond to high instantaneous intensity.</li>
              <li><span class="muted">Key physics idea:</span> the signal contains terms oscillating with delay at frequencies 0, ν<sub>0</sub>, and 2ν<sub>0</sub>, carrying phase information through complex correlation functions.</li>
              <li><span class="muted">Governing measurement (two-photon absorber):</span> detector rate ∝ intensity² ⇒
                <div class="eqbox">
                  <div class="eqrow">
                    <pre class="eq" id="eq_qs_1">R_U^(2)(τ) = ∫ |U(t) + U(t − τ)|^4 dt</pre>
                    <button class="btn small" data-copy="#eq_qs_1">Copy equation</button>
                  </div>
                </div>
              </li>
              <li><span class="muted">SHG interferometer measurement:</span> SH field ∝ [U(t)+U(t−τ)]² and square-law detector measures |·|², giving the <em>same integrand</em> and thus the same functional dependence on τ.</li>
              <li><span class="muted">Main result form:</span></li>
            </ul>

            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_qs_2">R_U^(2)(τ) = C0(τ) + 4 Re{ C1(τ) e^{j 2πν0 τ} } + 2 Re{ C2(τ) e^{j 4πν0 τ} }</pre>
                <button class="btn small" data-copy="#eq_qs_2">Copy equation</button>
              </div>
            </div>

            <ul class="bullets">
              <li><span class="muted">What it means:</span> a fringed autocorrelation: slow envelope (C0) plus carrier and second-harmonic delay fringes (C1 and C2) encoding phase.</li>
              <li><span class="muted">Result type:</span> symbolic; plot is illustrative only.</li>
            </ul>
            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="primer" aria-label="Concept primer">
            <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

            <div class="grid2">
              <div class="card">
                <h3>Core definitions (symbols + typical units)</h3>
                <ul class="klist">
                  <li><strong>t</strong> — time [s]</li>
                  <li><strong>τ</strong> — delay [s]</li>
                  <li><strong>U(t)</strong> — analytic optical field [field units]</li>
                  <li><strong>ν<sub>0</sub></strong> — carrier frequency [Hz], ω<sub>0</sub>=2πν<sub>0</sub> [rad/s]</li>
                  <li><strong>A(t)</strong> — complex envelope [field units]</li>
                  <li><strong>I(t)</strong> — intensity ∝ |U(t)|² [W/m² if absolutely scaled]</li>
                  <li><strong>TPA</strong> — two-photon absorption rate ∝ I²</li>
                  <li><strong>SHG</strong> — nonlinear process generating 2ω<sub>0</sub> field ∝ U²</li>
                </ul>
              </div>

              <div class="card">
                <h3>Physical meaning (intuition)</h3>
                <p class="muted">
                  The interferometer overlaps a pulse with a delayed copy. Nonlinear detection emphasizes temporal overlap
                  (stronger response when both copies coincide). Because the optical field oscillates at ν<sub>0</sub>,
                  the measured signal can contain fringes vs τ at ν<sub>0</sub> and 2ν<sub>0</sub>.
                </p>
              </div>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot good"></span>Key principle</div>
              <p>
                With U(t)=A(t)e^{j2πν<sub>0</sub>t}, the delayed copy contributes a factor e^{−j2πν<sub>0</sub>τ}.
                Expanding nonlinear powers of the summed field naturally produces harmonic terms at 0, ν<sub>0</sub>, 2ν<sub>0</sub>.
              </p>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot warn"></span>Validity conditions & assumptions</div>
              <ul class="klist">
                <li>Ideal interferometer (balanced, stable delay, no dispersion mismatch).</li>
                <li>Detector models: TPA ∝ |U|⁴; SHG field ∝ U² then detector ∝ |·|².</li>
                <li>Envelope slowly varying relative to carrier period.</li>
              </ul>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot bad"></span>What to watch for</div>
              <ul class="klist">
                <li>Add fields first, then apply detector nonlinearity (do not add intensities).</li>
                <li>Keep e^{−jω<sub>0</sub>τ} factor for the delayed arm.</li>
                <li>Handle complex conjugates carefully: measurable signals are real.</li>
              </ul>
            </div>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="industry" aria-label="Industry and applied perspective">
            <h2>PART 0B — Industry & Applied Physics Perspective</h2>

            <div class="grid2">
              <div class="card">
                <h3>Where this appears in industry</h3>
                <ul class="klist">
                  <li>Ultrafast laser manufacturing: process quality depends on peak intensity (pulse characterization).</li>
                  <li>Telecom/datacom photonics: coherent sources, combs, and optical sampling timing checks.</li>
                  <li>Integrated photonics: TPA detectors in semiconductors/waveguides for compact metrology.</li>
                </ul>
              </div>
              <div class="card">
                <h3>Why engineers care</h3>
                <ul class="klist">
                  <li>Performance: pulse width/phase controls nonlinear conversion and ablation thresholds.</li>
                  <li>Reliability & safety: avoid overdriving optics and inconsistent yield.</li>
                  <li>Cost/throughput: reduce alignment/calibration burden; enable robust packaging.</li>
                </ul>
              </div>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot warn"></span>Trade-offs (real systems)</div>
              <ul class="klist">
                <li><strong>SHG:</strong> phase matching, alignment sensitivity, finite bandwidth.</li>
                <li><strong>TPA:</strong> broadband and integrable, but can saturate or show carrier/thermal dynamics.</li>
                <li>Interferometer non-idealities (dispersion mismatch, polarization drift) reduce fringe visibility.</li>
              </ul>
            </div>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="analysis" aria-label="Problem analysis">
            <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

            <h3>Restate the problem</h3>
            <p class="muted">
              Expand the two-photon-detector interferometer signal R(τ)=∫|U(t)+U(t−τ)|⁴dt into the same harmonic form used
              for the SHG interferometer, and compare the terms to identify what each scheme measures.
            </p>

            <div class="grid2">
              <div class="card">
                <h3>Given</h3>
                <ul class="klist">
                  <li>TPA: R(τ)=∫|U(t)+U(t−τ)|⁴dt</li>
                  <li>SHG+detector: R(τ)=∫|[U(t)+U(t−τ)]²|²dt</li>
                  <li>Target form: C0 + 4Re{C1 e^{j2πν0τ}} + 2Re{C2 e^{j4πν0τ}}</li>
                </ul>
              </div>
              <div class="card">
                <h3>Unknowns</h3>
                <ul class="klist">
                  <li>Explicit expressions for C0(τ), C1(τ), C2(τ) from the TPA definition.</li>
                  <li>Comparison statement: whether the SHG interferometer yields the same function and why.</li>
                </ul>
              </div>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot"></span>Approach choice</div>
              <p class="muted">
                Use U(t)=A(t)e^{jω0 t}, rewrite the sum, compute |·|² then square to get |·|⁴, group terms by e^{±jω0τ} and e^{±j2ω0τ}, and define C-terms by integration.
              </p>
            </div>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="strategy" aria-label="Strategy and tips">
            <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

            <div class="card">
              <ol class="klist" style="color:var(--text);">
                <li>Write U(t)=A(t)e^{jω0 t} and U(t−τ)=A(t−τ)e^{jω0 t}e^{−jω0 τ}.</li>
                <li>Define S(t,τ)=A(t)+A(t−τ)e^{−jω0 τ} so R(τ)=∫|S|⁴dt.</li>
                <li>Compute |S|² = I(t)+I(t−τ)+X e^{jω0τ}+X* e^{−jω0τ}, where X=A(t)A*(t−τ).</li>
                <li>Square to get |S|⁴, group DC, e^{±jω0τ}, e^{±j2ω0τ} terms.</li>
                <li>Integrate each grouped coefficient over t to define C0, C1, C2.</li>
                <li>Compare with SHG expression using identity |(U1+U2)²|²=|U1+U2|⁴.</li>
              </ol>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot bad"></span>Common mistakes</div>
              <ul class="klist">
                <li>Dropping the e^{−jω0τ} relative phase factor.</li>
                <li>Forgetting that (Z+Z*)=2Re{Z} introduces factor 2’s.</li>
                <li>Mixing up A(t) (envelope) with U(t) (carrier included).</li>
              </ul>
            </div>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="solution" aria-label="Full solution">
            <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

            <h3>Start: TPA measurement definition</h3>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_s1">R_U^(2)(τ) = ∫ |U(t) + U(t − τ)|^4 dt</pre>
                <button class="btn small" data-copy="#eq_s1">Copy equation</button>
              </div>
            </div>

            <h3>Step 1 — Carrier/envelope separation</h3>
            <p class="muted">Let U(t)=A(t)e^{jω0 t}. Then:</p>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_s2">U(t − τ) = A(t − τ) e^{jω0(t − τ)} = A(t − τ) e^{jω0 t} e^{−jω0 τ}</pre>
                <button class="btn small" data-copy="#eq_s2">Copy equation</button>
              </div>
            </div>
            <p class="muted">So:</p>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_s3">U(t) + U(t − τ) = e^{jω0 t}[ A(t) + A(t − τ)e^{−jω0 τ} ]</pre>
                <button class="btn small" data-copy="#eq_s3">Copy equation</button>
              </div>
            </div>
            <p class="muted">
              Because |e^{jω0 t}|=1, define
              S(t,τ)=A(t)+A(t−τ)e^{−jω0 τ}, so R(τ)=∫|S(t,τ)|⁴ dt.
            </p>

            <h3>Step 2 — Expand |S|²</h3>
            <p class="muted">Define a=A(t), b=A(t−τ), φ=ω0τ, and X(t,τ)=a b* = A(t)A*(t−τ). Also I(t)=|A(t)|².</p>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_s5">|S|^2 = |a + b e^{−jφ}|^2
= (a + b e^{−jφ})(a* + b* e^{jφ})
= |a|^2 + |b|^2 + a b* e^{jφ} + a* b e^{−jφ}
= I(t) + I(t−τ) + X e^{jφ} + X* e^{−jφ}</pre>
                <button class="btn small" data-copy="#eq_s5">Copy equation</button>
              </div>
            </div>

            <h3>Step 3 — Square to get |S|⁴ and group harmonics</h3>
            <p class="muted">
              Let Q = I(t)+I(t−τ) (real) and F = X e^{jφ}+X* e^{−jφ} (real). Then |S|⁴ = (Q+F)² = Q² + 2QF + F².
            </p>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_group">Q^2 = I(t)^2 + I(t−τ)^2 + 2 I(t) I(t−τ)

2QF = 2[I(t)+I(t−τ)] X e^{jφ} + 2[I(t)+I(t−τ)] X* e^{−jφ}

F^2 = X^2 e^{j2φ} + (X*)^2 e^{−j2φ} + 2|X|^2</pre>
                <button class="btn small" data-copy="#eq_group">Copy equation</button>
              </div>
            </div>

            <p class="muted">Combine them:</p>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_s9">|S|^4 =
[ I(t)^2 + I(t−τ)^2 + 2 I(t) I(t−τ) + 2|X|^2 ]
+ [ 2(I(t)+I(t−τ))X e^{jφ} + 2(I(t)+I(t−τ))X* e^{−jφ} ]
+ [ X^2 e^{j2φ} + (X*)^2 e^{−j2φ} ]</pre>
                <button class="btn small" data-copy="#eq_s9">Copy equation</button>
              </div>
            </div>

            <h3>Step 4 — Integrate and define C0, C1, C2</h3>
            <p class="muted">
              With φ=ω0τ=2πν0τ and X=A(t)A*(t−τ), define:
            </p>

            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_Cs">C0(τ) = ∫ [ I(t)^2 + I(t−τ)^2 + 2 I(t) I(t−τ) + 2 |A(t)A*(t−τ)|^2 ] dt

C1(τ) = ∫ [ I(t) + I(t−τ) ] [ A(t)A*(t−τ) ] dt

C2(τ) = ∫ [ A(t)A*(t−τ) ]^2 dt</pre>
                <button class="btn small" data-copy="#eq_Cs">Copy equation</button>
              </div>
            </div>

            <p class="muted">
              Then the measured signal is:
            </p>
            <div class="eqbox">
              <div class="eqrow">
                <pre class="eq" id="eq_main">R_U^(2)(τ) = C0(τ) + 4 Re{ C1(τ) e^{j 2πν0 τ} } + 2 Re{ C2(τ) e^{j 4πν0 τ} }</pre>
                <button class="btn small good" data-copy="#eq_main">Copy equation</button>
              </div>
            </div>

            <div class="callout">
              <div class="tag"><span class="dot good"></span>Final answer</div>
              <div class="eqbox">
                <div class="eqrow">
                  <pre class="eq" id="final_answer">R_U^(2)(τ) = C0(τ) + 4 Re{ C1(τ) e^{j 2πν0 τ} } + 2 Re{ C2(τ) e^{j 4πν0 τ} }

C0(τ) = ∫ [ I(t)^2 + I(t−τ)^2 + 2 I(t) I(t−τ) + 2 |A(t)A*(t−τ)|^2 ] dt
C1(τ) = ∫ [ I(t) + I(t−τ) ] [ A(t)A*(t−τ) ] dt
C2(τ) = ∫ [ A(t)A*(t−τ) ]^2 dt

U(t)=A(t)e^{j2πν0 t},  I(t)=|A(t)|^2.</pre>
                  <button class="btn small good" data-copy="#final_answer">Copy final answer</button>
                </div>
              </div>
            </div>

            <h3>Comparison to the SHG interferometer</h3>
            <p class="muted">
              The SHG interferometer (Eq. 23.6-13) measures:
              ∫ |[U(t)+U(t−τ)]²|² dt. But |(·)²|² = |·|⁴, so
              <strong>both the TPA interferometer and the SHG+conventional detector interferometer measure the same delay function</strong>
              (up to an overall proportionality constant and real-world non-idealities like phase matching or detector saturation).
              Therefore the C0, C1, C2 term structure and the phase-sensitive fringe information are the same in the ideal theory.
            </p>

            <div class="callout">
              <div class="tag"><span class="dot warn"></span>Sanity checks</div>
              <ul class="klist">
                <li><strong>|τ| → large:</strong> overlap vanishes → correlation/fringe terms go to zero → R(τ) tends to baseline from separated pulses.</li>
                <li><strong>τ=0:</strong> maximum overlap → strongest nonlinear response.</li>
                <li><strong>Carrier jitter:</strong> averaging over random φ suppresses oscillatory (ν0, 2ν0) components.</li>
              </ul>
            </div>

            <figure aria-label="Optional plot figure">
              <canvas id="plot" width="1200" height="520" aria-label="Static plot of interferometric nonlinear autocorrelation"></canvas>
              <figcaption>
                <strong>Optional learning plot (example values):</strong> normalized R_U^(2)(τ) for a Gaussian pulse envelope, showing overlap envelope + optical fringes (illustration only).
              </figcaption>
            </figure>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="deeper" aria-label="Deeper understanding">
            <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

            <h3>What each term controls</h3>
            <ul class="bullets">
              <li><strong>C0(τ):</strong> slow envelope/background, dominated by intensity overlap and |A(t)A*(t−τ)|².</li>
              <li><strong>C1(τ)e^{jω0τ}:</strong> carrier-frequency fringes; mixes intensity with first-order field correlation → phase-sensitive.</li>
              <li><strong>C2(τ)e^{j2ω0τ}:</strong> second-harmonic fringes; depends on squared field correlation → often even more phase sensitive.</li>
            </ul>

            <details>
              <summary>Alternative derivation idea <span class="chev" aria-hidden="true"></span></summary>
              <p class="muted">
                Write |S|² = Q + 2Re{X e^{jφ}} and square:
                |S|⁴ = Q² + 4QRe{X e^{jφ}} + 4(Re{X e^{jφ}})²,
                with (Re{Z})² = (|Z|² + Re{Z²})/2. This immediately yields DC, φ, and 2φ terms.
              </p>
            </details>

            <h3>Concept checks (with answers)</h3>
            <ul class="bullets">
              <li><strong>Q:</strong> Why do 2ν0 terms appear? <strong>A:</strong> nonlinear squaring mixes ν0 with itself → 2ν0.</li>
              <li><strong>Q:</strong> What survives if fringes are averaged out? <strong>A:</strong> mainly C0(τ).</li>
              <li><strong>Q:</strong> Main practical difference SHG vs TPA? <strong>A:</strong> SHG needs phase matching/alignment; TPA can be integrated but may saturate or have carrier dynamics.</li>
            </ul>

            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>

          <section id="plotguide" aria-label="Optional plot guide">
            <h2>PART 5 — Optional Plot Guide</h2>
            <div class="callout">
              <div class="tag"><span class="dot"></span>Plot meaning</div>
              <ul class="klist">
                <li><strong>x-axis:</strong> delay τ (fs) — example units for visualization.</li>
                <li><strong>y-axis:</strong> normalized R_U^(2)(τ) (a.u.).</li>
                <li><strong>Example values (plot only):</strong> Gaussian envelope width T=35 fs, λ=800 nm.</li>
                <li><strong>Notice:</strong> broad overlap envelope + rapid optical fringes (from ω0 and 2ω0 terms).</li>
              </ul>
            </div>
            <a class="backtop" href="#top" aria-label="Back to top">↑ Back to top</a>
          </section>
        </div>

        <footer>
          <div><strong>Note:</strong> Ideally, SHG+detector and TPA detection produce the same mathematical delay function because both measure a |U(t)+U(t−τ)|⁴-type quantity; differences arise from real device physics and bandwidth constraints.</div>
        </footer>
      </main>
    </div>
  </div>

  <script>
    (function(){
      // Copy buttons
      function getTextFromSelector(sel){
        var el = document.querySelector(sel);
        if(!el) return "";
        return (el.innerText || el.textContent || "").trim();
      }

      async function copyText(text){
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
            return true;
          }
        }catch(e){}
        try{
          var ta = document.createElement("textarea");
          ta.value = text;
          ta.setAttribute("readonly","");
          ta.style.position="fixed";
          ta.style.left="-9999px";
          ta.style.top="0";
          document.body.appendChild(ta);
          ta.select();
          var ok = document.execCommand("copy");
          document.body.removeChild(ta);
          return ok;
        }catch(e){
          return false;
        }
      }

      document.addEventListener("click", async function(ev){
        var btn = ev.target.closest("[data-copy]");
        if(!btn) return;
        var sel = btn.getAttribute("data-copy");
        var text = getTextFromSelector(sel);
        if(!text) return;

        var old = btn.textContent;
        var ok = await copyText(text);
        btn.textContent = ok ? "Copied ✓" : "Copy failed";
        btn.style.borderColor = ok ? "rgba(110,231,183,.55)" : "rgba(251,113,133,.55)";
        setTimeout(function(){
          btn.textContent = old;
          btn.style.borderColor = "";
        }, 1100);
      });

      // ---- Static plot (example) ----
      const canvas = document.getElementById("plot");
      const ctx = canvas.getContext("2d", { alpha: false });

      function gaussian(x, s){ return Math.exp(-(x*x)/(2*s*s)); }

      function computeTrace(){
        // Example parameters (plot only)
        const c = 299792458;
        const lambda = 800e-9;
        const nu0 = c / lambda;
        const w0  = 2*Math.PI*nu0;

        const T = 35e-15;
        const tMax = 220e-15;
        const N_t = 2400;
        const dt = (2*tMax)/(N_t-1);

        const tauMax = 200e-15;
        const N_tau = 900;
        const taus = new Array(N_tau);
        const y = new Array(N_tau);

        const t = new Array(N_t);
        for(let i=0;i<N_t;i++) t[i] = -tMax + i*dt;

        const A = new Array(N_t);
        for(let i=0;i<N_t;i++) A[i] = gaussian(t[i], T);

        function A_at(time){
          const idx = Math.round((time + tMax)/dt);
          if(idx < 0 || idx >= N_t) return 0;
          return A[idx];
        }

        for(let k=0;k<N_tau;k++){
          const tau = -tauMax + (2*tauMax)*k/(N_tau-1);
          taus[k] = tau;

          let acc = 0;
          for(let i=0;i<N_t;i++){
            const ti = t[i];
            const A1 = A[i];
            const A2 = A_at(ti - tau);

            const c1 = Math.cos(w0*ti), s1 = Math.sin(w0*ti);
            const c2 = Math.cos(w0*(ti - tau)), s2 = Math.sin(w0*(ti - tau));

            const u1r = A1*c1, u1i = A1*s1;
            const u2r = A2*c2, u2i = A2*s2;

            const sr = u1r + u2r;
            const si = u1i + u2i;

            const mag2 = sr*sr + si*si;
            acc += mag2*mag2 * dt;
          }
          y[k] = acc;
        }

        let ymax = 0;
        for(let k=0;k<N_tau;k++) if(y[k] > ymax) ymax = y[k];
        for(let k=0;k<N_tau;k++) y[k] /= (ymax || 1);

        return { taus, y };
      }

      function roundRect(ctx, x, y, w, h, r){
        const rr = Math.min(r, w/2, h/2);
        ctx.beginPath();
        ctx.moveTo(x+rr, y);
        ctx.arcTo(x+w, y, x+w, y+h, rr);
        ctx.arcTo(x+w, y+h, x, y+h, rr);
        ctx.arcTo(x, y+h, x, y, rr);
        ctx.arcTo(x, y, x+w, y, rr);
        ctx.closePath();
      }

      function draw(){
        const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
        const cssW = canvas.clientWidth || 900;
        const cssH = Math.round(cssW * 0.43);
        canvas.style.height = cssH + "px";
        canvas.width = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);

        ctx.setTransform(dpr,0,0,dpr,0,0);

        const W = cssW, H = cssH;
        ctx.fillStyle = "#0c1220";
        ctx.fillRect(0,0,W,H);

        const padL = 62, padR = 18, padT = 44, padB = 48;
        const x0 = padL, y0 = padT, x1 = W - padR, y1 = H - padB;
        const pw = x1 - x0, ph = y1 - y0;

        const { taus, y } = computeTrace();
        const xMin = taus[0]*1e15, xMax = taus[taus.length-1]*1e15;
        const yMin = 0, yMax = 1.05;

        function X(xfs){ return x0 + ((xfs - xMin)/(xMax - xMin))*pw; }
        function Y(v){ return y1 - ((v - yMin)/(yMax - yMin))*ph; }

        ctx.strokeStyle = "rgba(255,255,255,0.08)";
        ctx.lineWidth = 1;

        const xTicks = 8;
        for(let i=0;i<=xTicks;i++){
          const xv = xMin + (xMax-xMin)*i/xTicks;
          const xx = X(xv);
          ctx.beginPath(); ctx.moveTo(xx, y0); ctx.lineTo(xx, y1); ctx.stroke();
        }

        const yTicks = 6;
        for(let i=0;i<=yTicks;i++){
          const yv = yMin + (yMax-yMin)*i/yTicks;
          const yy = Y(yv);
          ctx.beginPath(); ctx.moveTo(x0, yy); ctx.lineTo(x1, yy); ctx.stroke();
        }

        ctx.strokeStyle = "rgba(255,255,255,0.28)";
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(x0, y0); ctx.lineTo(x0, y1); ctx.lineTo(x1, y1);
        ctx.stroke();

        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.font = "700 14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("Example: Normalized nonlinear interferometric autocorrelation  R(τ) = ∫|U(t)+U(t−τ)|^4 dt", x0, 14);

        ctx.fillStyle = "rgba(255,255,255,0.80)";
        ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "bottom";
        ctx.fillText("Delay τ (fs)", x0 + pw/2, H - 14);

        ctx.save();
        ctx.translate(16, y0 + ph/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        ctx.fillText("Normalized signal (a.u.)", 0, 0);
        ctx.restore();

        ctx.fillStyle = "rgba(255,255,255,0.70)";
        ctx.font = "500 11px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";

        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        for(let i=0;i<=xTicks;i++){
          const xv = xMin + (xMax-xMin)*i/xTicks;
          const xx = X(xv);
          ctx.strokeStyle = "rgba(255,255,255,0.28)";
          ctx.beginPath(); ctx.moveTo(xx, y1); ctx.lineTo(xx, y1+6); ctx.stroke();
          ctx.fillText(Math.round(xv).toString(), xx, y1+9);
        }

        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        for(let i=0;i<=yTicks;i++){
          const yv = yMin + (yMax-yMin)*i/yTicks;
          const yy = Y(yv);
          ctx.strokeStyle = "rgba(255,255,255,0.28)";
          ctx.beginPath(); ctx.moveTo(x0-6, yy); ctx.lineTo(x0, yy); ctx.stroke();
          ctx.fillText(yv.toFixed(2), x0-10, yy);
        }

        ctx.lineWidth = 1.6;
        ctx.strokeStyle = "rgba(125,211,252,0.92)";
        ctx.beginPath();
        for(let k=0;k<taus.length;k++){
          const xx = X(taus[k]*1e15);
          const yy = Y(y[k]);
          if(k===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
        }
        ctx.stroke();

        const lx = x1 - 240, ly = y0 + 10, lw = 230, lh = 44;
        ctx.fillStyle = "rgba(0,0,0,0.35)";
        ctx.strokeStyle = "rgba(255,255,255,0.14)";
        ctx.lineWidth = 1;
        roundRect(ctx, lx, ly, lw, lh, 10);
        ctx.fill(); ctx.stroke();

        ctx.strokeStyle = "rgba(125,211,252,0.92)";
        ctx.lineWidth = 2.2;
        ctx.beginPath();
        ctx.moveTo(lx+14, ly+22);
        ctx.lineTo(lx+46, ly+22);
        ctx.stroke();

        ctx.fillStyle = "rgba(255,255,255,0.80)";
        ctx.font = "600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";
        ctx.fillText("R(τ) (example Gaussian A(t), λ=800 nm)", lx+56, ly+22);
      }

      let raf = null;
      function scheduleDraw(){
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(draw);
      }
      window.addEventListener("resize", scheduleDraw, {passive:true});
      scheduleDraw();
    })();
  </script>
</body>
</html>
