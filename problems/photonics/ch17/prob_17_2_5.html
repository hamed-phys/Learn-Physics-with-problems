<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Radiative Recombination Rate in Thermal Equilibrium (Direct Gap)</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1624;
      --panel2:#111b2d;
      --text:#e9eef7;
      --muted:#a9b4c7;
      --faint:#7f8aa3;
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(110,231,255,.12), transparent 60%),
        radial-gradient(900px 700px at 90% 10%, rgba(167,139,250,.12), transparent 60%),
        radial-gradient(700px 700px at 50% 110%, rgba(52,211,153,.10), transparent 60%),
        var(--bg);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    header{
      position:relative;
      padding:42px 22px 20px;
      border-bottom:1px solid var(--line);
      overflow:hidden;
    }
    header .wrap{
      max-width:1200px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      align-items:start;
    }
    h1{
      margin:0 0 10px;
      font-size:clamp(1.6rem, 2.6vw, 2.35rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      font-size:1.02rem;
      max-width:72ch;
    }
    .badgeRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }
    .badge{
      padding:8px 10px;
      border:1px solid var(--line2);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:999px;
      color:var(--muted);
      font-size:.86rem;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:22px 22px 70px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      align-items:start;
    }

    /* Sticky ToC */
    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:14px 14px 10px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .toc h2{
      margin:0 0 10px;
      font-size:1.0rem;
      letter-spacing:.2px;
      color:var(--text);
    }
    .toc a{
      display:block;
      padding:7px 9px;
      border-radius:10px;
      color:var(--muted);
      border:1px solid transparent;
      transition: all .18s ease;
      font-size:.93rem;
    }
    .toc a:hover{
      background: rgba(110,231,255,.08);
      border-color: rgba(110,231,255,.20);
      color:var(--text);
      text-decoration:none;
      transform: translateX(2px);
    }
    .toc .mini{
      margin-top:10px;
      color:var(--faint);
      font-size:.85rem;
      border-top:1px dashed var(--line);
      padding-top:10px;
    }

    section{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:18px 18px 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      margin-bottom:16px;
      scroll-margin-top: 16px;
    }
    section h2{
      margin:0 0 10px;
      font-size:1.25rem;
      letter-spacing:.2px;
    }
    section h3{
      margin:14px 0 8px;
      font-size:1.06rem;
      color:var(--text);
    }
    p{margin:10px 0}
    ul{margin:10px 0 10px 20px; color:var(--muted)}
    li{margin:6px 0}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      header .wrap{grid-template-columns: 1fr; }
      .badgeRow{justify-content:flex-start}
      main{grid-template-columns: 1fr; }
      nav.toc{position:relative; top:auto}
      .grid2,.grid3{grid-template-columns: 1fr;}
    }

    .callout{
      border-radius: var(--radius2);
      border:1px solid var(--line2);
      padding:12px 12px 10px;
      background: rgba(15,22,36,.55);
    }
    .callout strong{color:var(--text)}
    .callout.assump{border-color: rgba(251,191,36,.30); background: rgba(251,191,36,.06)}
    .callout.keyeq{border-color: rgba(110,231,255,.28); background: rgba(110,231,255,.06)}
    .callout.mist{border-color: rgba(251,113,133,.30); background: rgba(251,113,133,.06)}
    .callout.ans{border-color: rgba(52,211,153,.30); background: rgba(52,211,153,.06)}

    .eqWrap{
      position:relative;
      border-radius: var(--radius2);
      border:1px solid var(--line2);
      background: rgba(0,0,0,.25);
      padding:12px 12px 10px;
      overflow:hidden;
    }
    .eq{
      font-family: var(--mono);
      font-size: .94rem;
      color: #eaf2ff;
      white-space: pre-wrap;
      margin:0;
    }
    .copyBtn{
      position:absolute;
      top:10px;
      right:10px;
      border:1px solid var(--line2);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding:7px 9px;
      font-size:.82rem;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .copyBtn:hover{
      transform: translateY(-1px);
      background: rgba(110,231,255,.10);
      border-color: rgba(110,231,255,.28);
    }
    .copyBtn:active{transform: translateY(0px) scale(.98);}

    .vizCard{
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .vizTop{
      padding:12px 12px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .vizTop .title{
      font-weight:700;
      letter-spacing:.2px;
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }
    .ctrl{
      display:flex;
      gap:8px;
      align-items:center;
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid var(--line2);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size:.86rem;
    }
    input[type="range"]{
      width: 160px;
      accent-color: var(--accent);
    }
    select{
      background: rgba(0,0,0,.25);
      border:1px solid var(--line2);
      color: var(--text);
      border-radius: 10px;
      padding:6px 8px;
      font-size:.88rem;
      outline:none;
    }
    .vizBody{
      padding:10px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      background: rgba(7,10,16,.35);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 14px;
    }
    .smallCanvas{height:260px;}
    .readout{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      margin-top:10px;
    }
    .readout .tile{
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      padding:10px 12px;
    }
    .k{
      color: var(--faint);
      font-size:.86rem;
      margin-bottom:2px;
    }
    .v{
      font-family: var(--mono);
      font-size:.98rem;
      color: var(--text);
    }

    footer{
      max-width:1200px;
      margin:0 auto;
      padding:0 22px 40px;
      color: var(--faint);
      font-size:.9rem;
    }

    /* Print-friendly */
    @media print{
      body{background:white; color:black}
      header, nav.toc{display:none}
      main{grid-template-columns:1fr; padding:0}
      section{box-shadow:none; border:1px solid #ddd; background:white}
      canvas{border:1px solid #bbb; background:white}
      .copyBtn{display:none}
      .callout{background:#f6f6f6}
    }

    /* subtle animation */
    @keyframes floatIn{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0)}
    }
    section{animation: floatIn .35s ease both;}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div>
        <h1>17-2-5 — Radiative Recombination Rate in Thermal Equilibrium</h1>
        <div class="subtitle">
          We derive the <b>integrated spontaneous emission rate</b> for a <b>direct-gap semiconductor</b> in thermal equilibrium,
          connect it to the phenomenological law <b>R = r<sub>r</sub> n p</b>, and compute the radiative recombination coefficient
          for <b>GaAs at 300 K</b>.
        </div>
      </div>
      <div class="badgeRow">
        <div class="badge">Topic: Photon emission &amp; carrier statistics</div>
        <div class="badge">Key result: r<sub>r</sub> ∝ T<sup>-3/2</sup>/τ<sub>r</sub></div>
        <div class="badge">Interactive: spectrum + coefficient vs T</div>
      </div>
    </div>
  </header>

  <main>
    <nav class="toc" aria-label="Table of Contents">
      <h2>Table of Contents</h2>
      <a href="#quick">Quick Summary</a>
      <a href="#part0">PART 0 — Concept Primer</a>
      <a href="#part1">PART 1 — Problem Analysis</a>
      <a href="#part2">PART 2 — Strategy &amp; Tips</a>
      <a href="#part3">PART 3 — Full Solution</a>
      <a href="#part4">PART 4 — Deeper Understanding</a>
      <a href="#part5">PART 5 — Visualization Guide</a>
      <div class="mini">
        Tip: Use the temperature slider in the visualization card to see how the spectrum widens and how r<sub>r</sub>(T) falls like T<sup>-3/2</sup>.
      </div>
    </nav>

    <article>
      <section id="quick">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this is about:</b> finding the total (frequency-integrated) <b>direct interband spontaneous emission rate</b> in thermal equilibrium.</li>
          <li><b>Key physics idea:</b> for parabolic bands and nondegenerate carriers, the emission spectrum is governed by the <b>joint density of states</b> (∝ √ε) times a <b>Boltzmann factor</b> (∝ e<sup>-ε/kT</sup>).</li>
          <li><b>Governing spectral form:</b> r<sub>sp</sub>(ν) ∝ √(hν − E<sub>g</sub>) · exp[−(hν − E<sub>g</sub>)/(kT)] · exp(−E<sub>g</sub>/kT) for hν ≥ E<sub>g</sub>.</li>
          <li><b>Main integral trick:</b> substitute ε = hν − E<sub>g</sub> and use ∫<sub>0</sub><sup>∞</sup> ε<sup>1/2</sup> e<sup>-ε/kT</sup> dε = (√π/2)(kT)<sup>3/2</sup>.</li>
          <li><b>Integrated emission rate:</b> R<sub>sp</sub> ≡ ∫ r<sub>sp</sub>(ν)dν ∝ (kT)<sup>3/2</sup> e<sup>-E<sub>g</sub>/kT</sup> / τ<sub>r</sub>.</li>
          <li><b>Link to recombination law:</b> in equilibrium, set R<sub>sp</sub> = r<sub>r</sub> n p and use mass action n p = N<sub>c</sub>N<sub>v</sub> e<sup>-E<sub>g</sub>/kT</sup>.</li>
          <li><b>Final result type:</b> symbolic r<sub>r</sub>(T) and a numeric estimate for GaAs at 300 K (cm³/s).</li>
        </ul>
      </section>

      <section id="part0">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <div class="callout">
            <strong>Core definitions (symbols &amp; units)</strong>
            <ul>
              <li><b>n, p</b> — electron and hole concentrations [cm⁻³].</li>
              <li><b>r<sub>sp</sub>(ν)</b> — spectral spontaneous emission rate per volume per frequency
                [photons·s⁻¹·cm⁻³·Hz⁻¹].</li>
              <li><b>R<sub>sp</sub></b> — total spontaneous emission rate per volume, integrated over ν
                [photons·s⁻¹·cm⁻³].</li>
              <li><b>r<sub>r</sub></b> — radiative recombination coefficient [cm³/s], used in <b>R = r<sub>r</sub> n p</b>.</li>
              <li><b>E<sub>g</sub></b> — bandgap energy [eV or J].</li>
              <li><b>m<sub>c</sub>, m<sub>v</sub></b> — conduction/valence effective masses [kg], often quoted as multiples of m₀.</li>
              <li><b>m<sub>r</sub></b> — reduced mass: m<sub>r</sub> = (m<sub>c</sub> m<sub>v</sub>)/(m<sub>c</sub> + m<sub>v</sub>).</li>
              <li><b>τ<sub>r</sub></b> — radiative lifetime parameter appearing in microscopic emission prefactors [s].</li>
            </ul>
          </div>

          <div class="callout">
            <strong>Physical meaning (what these represent)</strong>
            <ul>
              <li><b>r<sub>sp</sub>(ν)</b> is how many photons are emitted at frequency ν per unit time per unit volume.</li>
              <li><b>R<sub>sp</sub></b> counts all emitted photons across the spectrum: it is the area under the spectral curve.</li>
              <li><b>r<sub>r</sub></b> packages the complicated quantum-mechanical transition physics into a single macroscopic number:
                if you know n and p, you know the radiative rate <b>R</b>.</li>
              <li><b>Mass action</b> (n p set by temperature and band structure in equilibrium) connects microscopic emission to macroscopic recombination.</li>
            </ul>
          </div>
        </div>

        <h3>Key principles &amp; validity conditions</h3>
        <div class="grid2">
          <div class="callout assump">
            <strong>Assumptions used in this problem</strong>
            <ul>
              <li><b>Direct-gap</b> semiconductor (photon can take momentum; no phonon required).</li>
              <li><b>Parabolic bands</b> near edges → joint density of states ∝ √ε.</li>
              <li><b>Thermal equilibrium</b> and <b>nondegenerate</b> carriers (Boltzmann approximation): Fermi level in the gap and away from band edges.</li>
              <li>Ignore excitonic effects and detailed frequency-dependence of optical matrix elements over the narrow thermal range.</li>
            </ul>
          </div>

          <div class="callout">
            <strong>Common models/approximations (why we use them)</strong>
            <ul>
              <li><b>Boltzmann tails</b>: simplifies Fermi-Dirac to exp(−E/kT), turning spectra into tractable integrals.</li>
              <li><b>Reduced mass</b>: compresses two-body electron-hole kinetic energy into a single effective parameter.</li>
              <li><b>Peak × width estimate</b>: quick engineering approximation; surprisingly accurate when spectra are unimodal and “thermal-width” is ~kT.</li>
            </ul>
          </div>
        </div>

        <h3>Mini intuition examples</h3>
        <ul>
          <li><b>Why the spectrum starts at E<sub>g</sub>:</b> you can’t emit a photon with energy less than the bandgap in a direct band-to-band transition.</li>
          <li><b>Why the width is ~kT:</b> carriers have thermal kinetic energy; photons can exceed E<sub>g</sub> by a few kT due to excess kinetic energy ε.</li>
        </ul>

        <div class="callout.mist callout mist">
          <strong>What to watch for (typical pitfalls)</strong>
          <ul>
            <li>Mixing <b>h</b> and <b>ħ</b>: remember h = 2πħ; factors of 2π matter.</li>
            <li>Forgetting the <b>threshold</b> hν ≥ E<sub>g</sub> when setting integration limits.</li>
            <li>Confusing microscopic <b>τ<sub>r</sub></b> with macroscopic <b>r<sub>r</sub></b>. One is a time, the other is a cm³/s coefficient.</li>
            <li>Using degenerate statistics when the problem explicitly assumes Fermi level in the gap (Boltzmann limit).</li>
          </ul>
        </div>
      </section>

      <section id="part1">
        <h2>PART 1 — Problem Analysis (no solving yet)</h2>

        <h3>Problem rewritten clearly</h3>
        <p>
          For a direct-gap semiconductor in thermal equilibrium (Boltzmann regime), the spectral spontaneous emission rate
          r<sub>sp</sub>(ν) has a thermal shape that begins at ν = E<sub>g</sub>/h.  
          (a) Show that integrating r<sub>sp</sub>(ν) over all ν gives a closed-form expression proportional to (kT)<sup>3/2</sup> e<sup>-E<sub>g</sub>/kT</sup>.
          (b) Compare to an approximation using <em>peak rate × spectral width</em> with width ≈ 2kT/h.
          (c) Use the equilibrium mass-action relation n p to derive the radiative recombination coefficient r<sub>r</sub> in R = r<sub>r</sub> n p.
          (d) Evaluate r<sub>r</sub> for GaAs at T = 300 K using m<sub>c</sub>=0.07m₀, m<sub>v</sub>=0.5m₀, τ<sub>r</sub>=0.4 ns and compare to tabulated values (~10⁻¹⁰ cm³/s).
        </p>

        <div class="grid2">
          <div class="callout">
            <strong>Given quantities</strong>
            <ul>
              <li>T (temperature), E<sub>g</sub> (bandgap), effective masses m<sub>c</sub>, m<sub>v</sub>, and τ<sub>r</sub>.</li>
              <li>Boltzmann/nondegenerate assumption: Fermi level in the gap, away from band edges.</li>
              <li>Mass action in equilibrium:
                n p = N<sub>c</sub> N<sub>v</sub> exp(−E<sub>g</sub>/kT),
                with N<sub>c</sub>, N<sub>v</sub> the effective density of states.</li>
            </ul>
          </div>
          <div class="callout">
            <strong>Unknowns / what must be found</strong>
            <ul>
              <li>(a) A closed-form expression for R<sub>sp</sub> = ∫ r<sub>sp</sub>(ν)dν.</li>
              <li>(b) A numerical ratio (approx / exact) for the peak×width estimate.</li>
              <li>(c) The coefficient r<sub>r</sub> in R = r<sub>r</sub> n p.</li>
              <li>(d) r<sub>r</sub> for GaAs at 300 K (cm³/s).</li>
            </ul>
          </div>
        </div>

        <h3>Relevant laws/principles (and why they apply)</h3>
        <ul>
          <li><b>Joint density of states (direct transitions):</b> near the band edge, the available e–h states for a photon of energy E = hν scale as √(E − E<sub>g</sub>).</li>
          <li><b>Thermal occupation (Boltzmann limit):</b> the probability of having excess kinetic energy ε is ∝ e<sup>-ε/kT</sup>, turning the spectral dependence into a tractable exponential integral.</li>
          <li><b>Mass action in equilibrium:</b> fixes n p independently of doping position (under nondegenerate assumptions), enabling elimination of the exp(−E<sub>g</sub>/kT) factor.</li>
        </ul>

        <div class="callout assump">
          <strong>Explicit assumptions</strong>
          <ul>
            <li>Thermal equilibrium; no external pumping.</li>
            <li>Nondegenerate carrier statistics (Boltzmann). Equivalent statement: E<sub>F</sub> is within the gap and not near band edges.</li>
            <li>Direct interband spontaneous emission dominates the specific derived expression.</li>
          </ul>
        </div>

        <h3>Possible approaches (choose the best)</h3>
        <div class="grid3">
          <div class="callout">
            <strong>Approach A — Direct integration (best)</strong>
            <p style="margin:8px 0;color:var(--muted)">
              Start from r<sub>sp</sub>(ν) ∝ √(hν−E<sub>g</sub>) e<sup>-(hν−E<sub>g</sub>)/kT</sup> and integrate using a gamma-function identity.
            </p>
            <div class="k">Pros</div>
            <div class="v">Exact closed form; clean physics</div>
          </div>
          <div class="callout">
            <strong>Approach B — Peak×width estimate</strong>
            <p style="margin:8px 0;color:var(--muted)">
              Find the peak of the spectral shape and multiply by an estimated width ~2kT/h.
            </p>
            <div class="k">Pros</div>
            <div class="v">Fast &amp; intuitive</div>
          </div>
          <div class="callout">
            <strong>Approach C — Detailed balance / Planck-law route</strong>
            <p style="margin:8px 0;color:var(--muted)">
              Use absorption/emission detailed balance (van Roosbroeck–Shockley style) and integrate.
            </p>
            <div class="k">Pros</div>
            <div class="v">More general, but heavier</div>
          </div>
        </div>
        <p><b>We choose Approach A</b> because the problem explicitly hints at the needed integral identity and expects the (kT)<sup>3/2</sup> result.</p>
      </section>

      <section id="part2">
        <h2>PART 2 — Strategy &amp; Tips (roadmap only)</h2>

        <ol style="margin:10px 0 10px 20px; color:var(--muted)">
          <li><b>Write the spectral form</b> for direct interband emission in the Boltzmann limit.
            <br><span style="color:var(--faint)">Tool:</span> joint DOS ∝ √(hν−E<sub>g</sub>) and Boltzmann factor exp(−(hν−E<sub>g</sub>)/kT).  
            <br><span style="color:var(--faint)">Meaning:</span> spectrum rises from the band edge and decays thermally.</li>

          <li><b>Change variables</b> to the excess energy ε = hν − E<sub>g</sub>.
            <br><span style="color:var(--faint)">Tool:</span> dν = dε / h, lower limit ε=0.
            <br><span style="color:var(--faint)">Meaning:</span> integrate over carrier kinetic energy above the gap.</li>

          <li><b>Evaluate the integral</b> ∫ ε<sup>1/2</sup> e<sup>-ε/kT</sup> dε using the provided identity.
            <br><span style="color:var(--faint)">Tool:</span> gamma-function integral.
            <br><span style="color:var(--faint)">Meaning:</span> thermal averaging of √ε yields (kT)<sup>3/2</sup>.</li>

          <li><b>For (b), locate the peak</b> of √ε e<sup>-ε/kT</sup> and multiply by width ~2kT/h.
            <br><span style="color:var(--faint)">Tool:</span> derivative = 0.
            <br><span style="color:var(--faint)">Meaning:</span> checks how good “peak×width” is.</li>

          <li><b>Use mass action</b> n p = N<sub>c</sub>N<sub>v</sub> e<sup>-E<sub>g</sub>/kT</sup> to eliminate the exponential.
            <br><span style="color:var(--faint)">Tool:</span> N<sub>c</sub>, N<sub>v</sub> formulas.
            <br><span style="color:var(--faint)">Meaning:</span> macroscopic recombination coefficient should not carry e<sup>-E<sub>g</sub>/kT</sup> in equilibrium.</li>

          <li><b>Solve for r<sub>r</sub></b> by setting R<sub>sp</sub> = r<sub>r</sub> n p.
            <br><span style="color:var(--faint)">Meaning:</span> derive r<sub>r</sub> in terms of τ<sub>r</sub>, masses, and T.</li>

          <li><b>Plug numbers for GaAs</b> and convert SI → cm³/s.
            <br><span style="color:var(--faint)">Tip:</span> 1 m³/s = 10⁶ cm³/s.</li>
        </ol>

        <div class="callout mist">
          <strong>Common mistakes &amp; quick tips</strong>
          <ul>
            <li>When switching from ν to ε, don’t forget <b>dν = dε / h</b>.</li>
            <li>Keep track of <b>units</b>: the final r<sub>r</sub> must be a volume per time.</li>
            <li>In (c), be systematic with <b>h = 2πħ</b> to avoid missing π factors.</li>
          </ul>
        </div>
      </section>

      <section id="part3">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Qualitative expectation (before calculating)</h3>
        <p>
          In thermal equilibrium, the emission spectrum should:
          (i) start at photon energy E = E<sub>g</sub> (no lower-energy direct interband photons),
          (ii) rise initially because the number of available e–h states increases with excess energy,
          and (iii) then fall because high excess energies are exponentially rare in a Boltzmann distribution.
          Therefore r<sub>sp</sub> should look like a single hump with a width on the order of kT.
          Integrating over the spectrum should produce something like “thermal phase space” (kT)<sup>3/2</sup> times the probability of having an e–h pair across the gap, exp(−E<sub>g</sub>/kT).
        </p>

        <h3>(a) Integrate the direct interband spontaneous emission rate</h3>

        <p>
          In the Boltzmann (nondegenerate) regime for a direct-gap semiconductor with parabolic bands, the spectral spontaneous emission rate
          has the form
        </p>

        <div class="eqWrap callout keyeq">
          <button class="copyBtn" data-copy="eqA">Copy</button>
          <pre class="eq" id="eqA">r_sp(ν) = D0 · √(hν − Eg) · exp[ −(hν)/ (kT) ],   for hν ≥ Eg
r_sp(ν) = 0,                                     for hν &lt; Eg</pre>
        </div>

        <p>
          Here:
          <b>ν</b> is frequency [Hz], <b>h</b> is Planck’s constant, <b>k</b> is Boltzmann’s constant, and
          <b>D0</b> is a (material + matrix element) prefactor with the correct units.
          The <b>√(hν−E<sub>g</sub>)</b> comes from the joint density of states near the band edge, and the exponential comes from the Boltzmann factor.
        </p>

        <p>
          We want the integrated rate (photons per second per cm³):
        </p>

        <div class="eqWrap callout keyeq">
          <button class="copyBtn" data-copy="eqIntDef">Copy</button>
          <pre class="eq" id="eqIntDef">Rsp ≡ ∫₀^∞ r_sp(ν) dν = ∫_{ν=Eg/h}^∞ D0 √(hν − Eg) · exp[−hν/(kT)] dν</pre>
        </div>

        <p><b>Step 1: substitute the excess energy ε = hν − E<sub>g</sub>.</b></p>
        <ul>
          <li>ε ≥ 0 corresponds to ν ≥ E<sub>g</sub>/h.</li>
          <li>hν = ε + E<sub>g</sub>.</li>
          <li>dν = dε / h.</li>
        </ul>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqSub">Copy</button>
          <pre class="eq" id="eqSub">Rsp = ∫₀^∞ D0 √ε · exp[−(ε+Eg)/(kT)] · (dε / h)
    = (D0/h) · exp(−Eg/kT) · ∫₀^∞ ε^{1/2} exp(−ε/(kT)) dε</pre>
        </div>

        <p>
          <b>What we did:</b> we factored out the bandgap contribution exp(−E<sub>g</sub>/kT), leaving a pure thermal integral over ε.
        </p>

        <p><b>Step 2: evaluate the thermal integral.</b> Using the gamma-function identity (given in the problem):
        </p>

        <div class="eqWrap callout keyeq">
          <button class="copyBtn" data-copy="eqGamma">Copy</button>
          <pre class="eq" id="eqGamma">∫₀^∞ x^{1/2} e^{−x/a} dx = (√π/2) a^{3/2}     (a &gt; 0)</pre>
        </div>

        <p>
          Here a = kT, so:
        </p>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqIntegralRes">Copy</button>
          <pre class="eq" id="eqIntegralRes">∫₀^∞ ε^{1/2} exp(−ε/(kT)) dε = (√π/2) (kT)^{3/2}</pre>
        </div>

        <p><b>Therefore, the integrated emission rate is</b></p>

        <div class="eqWrap callout ans">
          <button class="copyBtn" data-copy="eqPartA">Copy</button>
          <pre class="eq" id="eqPartA">Rsp = ∫₀^∞ r_sp(ν)dν
    = D0 · (√π / (2h)) · (kT)^{3/2} · exp(−Eg/kT)</pre>
        </div>

        <p>
          This matches the target form: proportional to (kT)<sup>3/2</sup> and exponentially suppressed by the bandgap.
          In the text’s microscopic model, the prefactor can be written as
          D0(√π/2h) = (m_r)^{3/2}/(√2 π^{3/2} ħ^3 τ_r),
          giving the equivalent expression:
        </p>

        <div class="eqWrap callout keyeq">
          <button class="copyBtn" data-copy="eqPartA2">Copy</button>
          <pre class="eq" id="eqPartA2">Rsp = [(m_r)^{3/2}/(√2 π^{3/2} ħ^3 τr)] · (kT)^{3/2} · exp(−Eg/kT)
where  m_r = (mc mv)/(mc + mv)</pre>
        </div>

        <h3>(b) Compare to the “peak × width” approximation</h3>
        <p>
          The spectral shape versus excess energy ε is essentially f(ε)=√ε e<sup>-ε/kT</sup> (up to constants).
          Find its maximum:
        </p>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqPeak">Copy</button>
          <pre class="eq" id="eqPeak">Let f(ε) = ε^{1/2} e^{−ε/(kT)}.
ln f = (1/2) ln ε − ε/(kT).
d/dε (ln f) = (1/(2ε)) − 1/(kT) = 0  ⇒  ε_peak = (kT)/2.</pre>
        </div>

        <p>
          Thus f(ε<sub>peak</sub>) = √(kT/2) · e<sup>-1/2</sup>.
          Using the suggested spectral width Δν ≈ 2kT/h (equivalently Δε ≈ 2kT), the crude integrated estimate is:
        </p>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqApproxB">Copy</button>
          <pre class="eq" id="eqApproxB">Rsp,approx ≈ r_sp,peak · Δν
≈ [D0 √(kT/2) e^{−1/2} e^{−Eg/kT}] · (2kT/h)
= (D0/h) · [ √2 e^{−1/2} ] · (kT)^{3/2} · e^{−Eg/kT}.</pre>
        </div>

        <p>
          Compare the coefficient to the exact coefficient from (a):
        </p>

        <div class="eqWrap callout">
          <button class="copyBtn" data-copy="eqRatio">Copy</button>
          <pre class="eq" id="eqRatio">Exact coefficient:     C_exact = (√π)/2  ≈ 0.8862
Approx coefficient:    C_approx = √2 e^{−1/2} ≈ 1.4142×0.6065 ≈ 0.8578
Ratio: C_approx/C_exact ≈ 0.968  (about 3% low)</pre>
        </div>

        <p>
          <b>Interpretation:</b> the peak×width rule works well here because the spectrum is a single thermal hump with width ~kT and a smoothly varying prefactor.
        </p>

        <h3>(c) Derive the radiative recombination coefficient r<sub>r</sub></h3>
        <p>
          The phenomenological radiative recombination rate is written as
        </p>

        <div class="eqWrap callout keyeq">
          <button class="copyBtn" data-copy="eqPhen">Copy</button>
          <pre class="eq" id="eqPhen">Rr = r_r · n · p   (photons·s⁻¹·cm⁻³)</pre>
        </div>

        <p>
          In <b>thermal equilibrium</b>, the spontaneous emission rate must equal the radiative recombination rate:
          R<sub>sp</sub> = R<sub>r</sub>.
          Also in equilibrium (Boltzmann regime), mass action gives:
        </p>

        <div class="eqWrap callout keyeq">
          <button class="copyBtn" data-copy="eqMassAction">Copy</button>
          <pre class="eq" id="eqMassAction">n p = Nc Nv exp(−Eg/kT)
Nc = 2 (2π mc kT / h²)^{3/2}
Nv = 2 (2π mv kT / h²)^{3/2}</pre>
        </div>

        <p>
          Multiply N<sub>c</sub> and N<sub>v</sub>:
        </p>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqNcNv">Copy</button>
          <pre class="eq" id="eqNcNv">Nc Nv = 4 (2π kT / h²)^3 (mc mv)^{3/2}
⇒ n p = 4 (2π kT / h²)^3 (mc mv)^{3/2} exp(−Eg/kT)</pre>
        </div>

        <p>
          Set (a)’s result equal to r<sub>r</sub> n p. Using the microscopic form from (a):
        </p>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqSetEqual">Copy</button>
          <pre class="eq" id="eqSetEqual">[(m_r)^{3/2}/(√2 π^{3/2} ħ^3 τr)] (kT)^{3/2} e^{−Eg/kT}
= r_r · [4 (2π kT / h²)^3 (mc mv)^{3/2} e^{−Eg/kT}]</pre>
        </div>

        <p>
          Cancel the common factor e<sup>-E<sub>g</sub>/kT</sup> (this is the key equilibrium simplification),
          and also simplify the constants using h = 2πħ.
          After algebra (shown compactly):
        </p>

        <div class="eqWrap">
          <button class="copyBtn" data-copy="eqAlgebraC">Copy</button>
          <pre class="eq" id="eqAlgebraC">4 (2π kT / h²)^3 = 4 (2π kT / (4π² ħ²))^3
                 = 4 (kT / (2π ħ²))^3
                 = (kT)^3 / (2 π^3 ħ^6).</pre>
        </div>

        <p>
          Solving for r<sub>r</sub> yields:
        </p>

        <div class="eqWrap callout ans">
          <button class="copyBtn" data-copy="eqPartC">Copy</button>
          <pre class="eq" id="eqPartC">r_r = (√2 π^{3/2} ħ^3) / [ (mc + mv)^{3/2} (kT)^{3/2} τr ]</pre>
        </div>

        <p>
          <b>Why (m<sub>c</sub> + m<sub>v</sub>) appears:</b> because m<sub>r</sub> = (m<sub>c</sub>m<sub>v</sub>)/(m<sub>c</sub>+m<sub>v</sub>), and the combination
          (m<sub>r</sub>/(m<sub>c</sub>m<sub>v</sub>))<sup>3/2</sup> becomes 1/(m<sub>c</sub>+m<sub>v</sub>)<sup>3/2</sup>.
        </p>

        <h3>(d) Numerical value for GaAs at 300 K</h3>
        <p>
          Use m<sub>c</sub>=0.07m₀, m<sub>v</sub>=0.5m₀, τ<sub>r</sub>=0.4 ns, T=300 K.
          Compute r<sub>r</sub> in SI (m³/s) and convert to cm³/s using 1 m³/s = 10⁶ cm³/s.
        </p>

        <div class="eqWrap callout">
          <button class="copyBtn" data-copy="eqNum">Copy</button>
          <pre class="eq" id="eqNum">Constants:
ħ = 1.054571817×10⁻³⁴ J·s
k = 1.380649×10⁻²³ J/K
m0 = 9.1093837015×10⁻³¹ kg

Inputs (GaAs example):
mc = 0.07 m0
mv = 0.50 m0
τr = 0.4 ns = 0.4×10⁻⁹ s
T  = 300 K

Result:
r_r ≈ 2.32×10⁻¹⁶ m³/s = 2.32×10⁻¹⁰ cm³/s</pre>
        </div>

        <div class="callout ans">
          <strong>Final numeric answer (GaAs, 300 K)</strong>
          <div class="eqWrap" style="margin-top:10px">
            <button class="copyBtn" data-copy="eqFinalAns">Copy</button>
            <pre class="eq" id="eqFinalAns">r_r(GaAs, 300 K) ≈ 2.3 × 10^(-10) cm^3/s</pre>
          </div>
          <p style="margin:10px 0 0;color:var(--muted)">
            This is of the same order as the representative tabulated value (~10⁻¹⁰ cm³/s), and the agreement is reasonable given model simplifications.
          </p>
        </div>

        <h3>Sanity checks</h3>
        <div class="grid2">
          <div class="callout">
            <strong>Units / dimensions</strong>
            <p style="margin:8px 0;color:var(--muted)">
              In r<sub>r</sub> = (√2 π<sup>3/2</sup> ħ³)/[(m)<sup>3/2</sup>(kT)<sup>3/2</sup>τ],
              note ħ³/(m<sup>3/2</sup>(kT)<sup>3/2</sup>) has units of volume, then dividing by τ gives volume/time: cm³/s.
            </p>
          </div>
          <div class="callout">
            <strong>Limiting behavior</strong>
            <ul>
              <li>T ↑ ⇒ r<sub>r</sub> ∝ T<sup>-3/2</sup> decreases (thermal broadening reduces equilibrium recombination coefficient).</li>
              <li>τ<sub>r</sub> ↑ ⇒ r<sub>r</sub> decreases linearly (slower microscopic radiative process → smaller macroscopic coefficient).</li>
              <li>Heavier masses (m<sub>c</sub>+m<sub>v</sub> ↑) ⇒ r<sub>r</sub> decreases (smaller effective “quantum volume” scale).</li>
            </ul>
          </div>
        </div>

        <p>
          <b>Connection to the diagram &amp; plots:</b>
          the diagram shows the threshold E<sub>g</sub> and excess energy ε = E − E<sub>g</sub>.
          The main plot draws r<sub>sp</sub>(E) vs photon energy E; the area under that curve is the integrated rate R<sub>sp</sub>.
          The secondary plot shows r<sub>r</sub>(T) sweeping with temperature, with the current slider value highlighted.
        </p>
      </section>

      <section id="part4">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the final formulas</h3>
        <div class="grid2">
          <div class="callout">
            <strong>Integrated spontaneous emission (equilibrium)</strong>
            <p style="margin:8px 0;color:var(--muted)">
              R<sub>sp</sub> ∝ (kT)<sup>3/2</sup> e<sup>-E<sub>g</sub>/kT</sup>/τ<sub>r</sub>.
              The exponential term is the “cost” to create an electron-hole pair across the gap; the (kT)<sup>3/2</sup> factor is the thermal phase space for their kinetic energies.
            </p>
          </div>
          <div class="callout">
            <strong>Radiative coefficient</strong>
            <p style="margin:8px 0;color:var(--muted)">
              r<sub>r</sub> = (√2 π<sup>3/2</sup> ħ³)/[(m<sub>c</sub>+m<sub>v</sub>)<sup>3/2</sup>(kT)<sup>3/2</sup>τ<sub>r</sub>].
              Notice e<sup>-E<sub>g</sub>/kT</sup> is gone: equilibrium mass action supplies the same factor, canceling it out when solving for r<sub>r</sub>.
            </p>
          </div>
        </div>

        <h3>How parameters change outcomes (connect to the interactive plots)</h3>
        <ul>
          <li><b>Increase T:</b> spectrum widens to higher photon energies (more excess kinetic energy), but r<sub>r</sub>(T) falls as T<sup>-3/2</sup>.</li>
          <li><b>Increase E<sub>g</sub> (in the spectrum plot):</b> the threshold shifts right; the integrated equilibrium emission R<sub>sp</sub> is exponentially suppressed by e<sup>-E<sub>g</sub>/kT</sup>.</li>
          <li><b>Increase τ<sub>r</sub>:</b> both R<sub>sp</sub> and r<sub>r</sub> drop inversely (slower radiative process).</li>
          <li><b>Increase effective masses:</b> r<sub>r</sub> decreases because the characteristic “quantum volume scale” ħ³/(m kT)<sup>3/2</sup> shrinks.</li>
        </ul>

        <h3>Alternative derivation idea (brief)</h3>
        <p>
          A more general route uses <b>detailed balance</b> between absorption and emission (often associated with the van Roosbroeck–Shockley relation).
          One relates the emission spectrum to the absorption coefficient and the photon occupation number, then integrates.
          Under the same parabolic-band and Boltzmann assumptions, it reduces to the same √ε e<sup>-ε/kT</sup> integral and yields the same scaling.
        </p>

        <h3>Concept check (quick self-test)</h3>
        <ul>
          <li><b>Q:</b> Why is there a low-frequency cutoff at ν = E<sub>g</sub>/h? <b>A:</b> Direct interband photons must at least supply the bandgap energy.</li>
          <li><b>Q:</b> Why does the integral scale like (kT)<sup>3/2</sup>? <b>A:</b> It’s the thermal average of √ε over a Boltzmann distribution, producing a gamma-function moment.</li>
          <li><b>Q:</b> Why does r<sub>r</sub> not contain e<sup>-E<sub>g</sub>/kT</sup>? <b>A:</b> That factor cancels when dividing R<sub>sp</sub> by n p from mass action.</li>
          <li><b>Q:</b> If τ<sub>r</sub> doubles, what happens to r<sub>r</sub>? <b>A:</b> r<sub>r</sub> halves (inverse proportionality).</li>
        </ul>
      </section>

      <section id="part5">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>

        <div class="vizCard" id="viz">
          <div class="vizTop">
            <div class="title">Interactive Visualizations — Band Diagram, Spectrum, and r<sub>r</sub>(T)</div>
            <div class="controls" aria-label="Interactive controls">
              <div class="ctrl">
                <span>T (K)</span>
                <input id="tSlider" type="range" min="120" max="700" step="1" value="300" />
                <span id="tVal" class="v">300</span>
              </div>
              <div class="ctrl">
                <span>Material preset</span>
                <select id="preset">
                  <option value="gaas" selected>GaAs (example)</option>
                  <option value="si">Si (rough)</option>
                  <option value="gan">GaN (rough)</option>
                  <option value="custom">Custom</option>
                </select>
              </div>
              <div class="ctrl">
                <span>τr (ns)</span>
                <input id="tauSlider" type="range" min="0.05" max="5.0" step="0.01" value="0.40" />
                <span id="tauVal" class="v">0.40</span>
              </div>
            </div>
          </div>

          <div class="vizBody">
            <canvas id="cDiagram" class="smallCanvas" aria-label="Band diagram canvas"></canvas>
            <canvas id="cSpectrum" aria-label="Spontaneous emission spectrum canvas"></canvas>
            <canvas id="cCoeff" class="smallCanvas" aria-label="Radiative coefficient vs temperature canvas"></canvas>

            <div class="readout" aria-label="Numeric readouts">
              <div class="tile">
                <div class="k">Current r<sub>r</sub>(T) (cm³/s)</div>
                <div class="v" id="rrOut">—</div>
                <div class="k" style="margin-top:10px">Model: r<sub>r</sub> = (√2 π<sup>3/2</sup> ħ³)/[(m<sub>c</sub>+m<sub>v</sub>)<sup>3/2</sup>(kT)<sup>3/2</sup>τ<sub>r</sub>]</div>
              </div>
              <div class="tile">
                <div class="k">Example integrated R<sub>sp</sub> scale (arb. prefactor removed)</div>
                <div class="v" id="rspOut">—</div>
                <div class="k" style="margin-top:10px">Shown to emphasize: (kT)<sup>3/2</sup> e<sup>-E<sub>g</sub>/kT</sup></div>
              </div>
            </div>
          </div>
        </div>

        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Band diagram:</b> conduction and valence bands, bandgap E<sub>g</sub>, and a radiative transition emitting a photon of energy E = hν = E<sub>g</sub> + ε.</li>
          <li><b>Main plot (spectrum):</b> r<sub>sp</sub>(E) vs photon energy E (eV). It starts at E<sub>g</sub> and has a thermal hump; changing T broadens the hump.</li>
          <li><b>Secondary plot:</b> r<sub>r</sub>(T) vs T (cm³/s) for the selected masses and τ<sub>r</sub>, with the current slider point highlighted.</li>
        </ul>

        <h3>Interactive controls (what changes and why)</h3>
        <ul>
          <li><b>T slider:</b> increases thermal energy kT, making the spectrum wider in E and lowering r<sub>r</sub> as T<sup>-3/2</sup>.</li>
          <li><b>Preset selector:</b> changes effective masses and E<sub>g</sub> (used in the spectrum threshold).</li>
          <li><b>τ<sub>r</sub> slider:</b> scales r<sub>r</sub> and the spectrum amplitude inversely (longer τ<sub>r</sub> → weaker radiative processes).</li>
        </ul>
      </section>
    </article>
  </main>

  <footer>
    Built as a self-contained tutorial article (vanilla HTML/CSS/JS). Equations are presented in plain text and are copyable via the buttons.
  </footer>

  <script>
    // ---------- Copy buttons ----------
    (function(){
      function copyText(text){
        navigator.clipboard.writeText(text).then(()=>{},()=>{});
      }
      document.querySelectorAll(".copyBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-copy");
          const el = document.getElementById(id);
          if(!el) return;
          copyText(el.textContent.replace(/\u00a0/g,' '));
          const old = btn.textContent;
          btn.textContent = "Copied ✓";
          setTimeout(()=>btn.textContent = old, 900);
        });
      });
    })();

    // ---------- Physics + plotting utilities ----------
    const C = {
      h: 6.62607015e-34,
      hbar: 1.054571817e-34,
      k: 1.380649e-23,
      q: 1.602176634e-19,
      m0: 9.1093837015e-31
    };

    // Presets (rough): Eg used mainly for spectrum threshold visualization
    const presets = {
      gaas: { name:"GaAs", Eg_eV: 1.42, mc_m0: 0.07, mv_m0: 0.50, tau_ns: 0.40 },
      si:   { name:"Si",   Eg_eV: 1.12, mc_m0: 0.26, mv_m0: 0.39, tau_ns: 10.0 }, // illustrative
      gan:  { name:"GaN",  Eg_eV: 3.40, mc_m0: 0.20, mv_m0: 0.80, tau_ns: 0.02 }  // illustrative
    };

    const state = {
      T: 300,
      Eg_eV: presets.gaas.Eg_eV,
      mc: presets.gaas.mc_m0 * C.m0,
      mv: presets.gaas.mv_m0 * C.m0,
      tau: presets.gaas.tau_ns * 1e-9,
      presetKey: "gaas"
    };

    function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

    // Radiative coefficient (part c): r_r in m^3/s then convert to cm^3/s
    function rr_m3s(T, mc, mv, tau){
      const num = Math.sqrt(2) * Math.pow(Math.PI, 1.5) * Math.pow(C.hbar, 3);
      const den = Math.pow(mc + mv, 1.5) * Math.pow(C.k * T, 1.5) * tau;
      return num / den;
    }

    // Spectrum model in energy domain:
    // r_sp(E) = A * sqrt(E - Eg) * exp(-(E - Eg)/(kT)) * exp(-Eg/(kT)),  E>=Eg
    // with A chosen so that integral matches the (a) microscopic integrated form:
    // Rsp = [(m_r)^{3/2}/(√2 π^{3/2} ħ^3 τr)] (kT)^{3/2} exp(-Eg/kT)
    // This implies A = √2 (m_r)^{3/2} / (π^2 ħ^3 τr)  [in SI: photons/(s·m^3·J^{1/2})]
    function spectrum_rsp_E_SI(E_J, T, Eg_J, mc, mv, tau){
      if(E_J < Eg_J) return 0;
      const mr = (mc * mv) / (mc + mv);
      const A = Math.sqrt(2) * Math.pow(mr, 1.5) / (Math.pow(Math.PI, 2) * Math.pow(C.hbar, 3) * tau);
      const eps = E_J - Eg_J;
      return A * Math.sqrt(eps) * Math.exp(-eps/(C.k*T)) * Math.exp(-Eg_J/(C.k*T)); // photons/(s·m^3·J)
    }

    // Helper: "shape scale" for Rsp dependence ignoring microscopic prefactor:
    function rsp_scale(T, Eg_J){
      return Math.pow(C.k*T, 1.5) * Math.exp(-Eg_J/(C.k*T)); // J^{3/2} (dimensionful), used as relative readout
    }

    // ---------- Canvas drawing (HiDPI) ----------
    function setupCanvas(canvas){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.max(2, Math.floor(rect.width * dpr));
      canvas.height = Math.max(2, Math.floor(rect.height * dpr));
      const ctx = canvas.getContext("2d");
      ctx.setTransform(dpr,0,0,dpr,0,0);
      return { ctx, w: rect.width, h: rect.height, dpr };
    }

    function clear(ctx, w, h){
      ctx.clearRect(0,0,w,h);
      // subtle vignette
      const g = ctx.createRadialGradient(w*0.25,h*0.25, 0, w*0.5,h*0.5, Math.max(w,h));
      g.addColorStop(0, "rgba(255,255,255,0.04)");
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);
    }

    function drawAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel, title){
      const {x,y,w,h} = box;
      // frame
      ctx.strokeStyle = "rgba(255,255,255,0.14)";
      ctx.lineWidth = 1;
      ctx.strokeRect(x,y,w,h);

      // title
      ctx.fillStyle = "rgba(233,238,247,0.92)";
      ctx.font = "700 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(title, x+8, y-10);

      // grid + ticks
      ctx.font = "11px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
      const nGrid = 6;
      for(let i=0;i<=nGrid;i++){
        const tx = x + (w*i/nGrid);
        const ty = y + (h*i/nGrid);
        ctx.strokeStyle = "rgba(255,255,255,0.07)";
        ctx.beginPath(); ctx.moveTo(tx,y); ctx.lineTo(tx,y+h); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(x,ty); ctx.lineTo(x+w,ty); ctx.stroke();
      }

      // ticks labels
      ctx.fillStyle = "rgba(169,180,199,0.95)";
      for(let i=0;i<=nGrid;i++){
        const xv = xMin + (xMax-xMin)*i/nGrid;
        const yv = yMax - (yMax-yMin)*i/nGrid;
        const tx = x + (w*i/nGrid);
        const ty = y + (h*i/nGrid);

        ctx.fillText(formatTick(xv), tx-10, y+h+16);
        ctx.fillText(formatTick(yv), x-54, ty+4);
      }

      // axis labels
      ctx.fillStyle = "rgba(233,238,247,0.88)";
      ctx.font = "12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(xLabel, x + w/2 - ctx.measureText(xLabel).width/2, y + h + 36);

      ctx.save();
      ctx.translate(x-34, y + h/2);
      ctx.rotate(-Math.PI/2);
      ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
      ctx.restore();

      function formatTick(v){
        const av = Math.abs(v);
        if(av >= 1000) return v.toFixed(0);
        if(av >= 10) return v.toFixed(1);
        if(av >= 1) return v.toFixed(2);
        if(av >= 0.01) return v.toFixed(3);
        return v.toExponential(1);
      }
    }

    function mapX(xVal, box, xMin, xMax){
      return box.x + (xVal - xMin) / (xMax - xMin) * box.w;
    }
    function mapY(yVal, box, yMin, yMax){
      return box.y + (yMax - yVal) / (yMax - yMin) * box.h;
    }

    // ---------- Plot 1: Band diagram ----------
    function drawDiagram(){
      const canvas = document.getElementById("cDiagram");
      const {ctx, w, h} = setupCanvas(canvas);
      clear(ctx, w, h);

      const pad = 14;
      const box = { x: pad, y: pad+22, w: w-2*pad, h: h-2*pad-26 };

      // Title
      ctx.fillStyle = "rgba(233,238,247,0.92)";
      ctx.font = "700 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Labeled setup: direct interband radiative transition", box.x+8, box.y-8);

      // Bands
      const x0 = box.x + 30;
      const x1 = box.x + box.w - 30;
      const yC = box.y + box.h*0.28;
      const yV = box.y + box.h*0.78;

      ctx.strokeStyle = "rgba(110,231,255,0.65)";
      ctx.lineWidth = 2.2;
      ctx.beginPath();
      ctx.moveTo(x0, yC); ctx.quadraticCurveTo((x0+x1)/2, yC-18, x1, yC);
      ctx.stroke();

      ctx.strokeStyle = "rgba(167,139,250,0.65)";
      ctx.beginPath();
      ctx.moveTo(x0, yV); ctx.quadraticCurveTo((x0+x1)/2, yV+18, x1, yV);
      ctx.stroke();

      // Labels
      ctx.fillStyle = "rgba(233,238,247,0.86)";
      ctx.font = "12px ui-sans-serif, system-ui";
      ctx.fillText("Conduction band (E_c)", x0, yC-14);
      ctx.fillText("Valence band (E_v)", x0, yV+22);

      // Eg arrow
      ctx.strokeStyle = "rgba(251,191,36,0.85)";
      ctx.lineWidth = 2;
      const ax = box.x + box.w*0.12;
      ctx.beginPath();
      ctx.moveTo(ax, yV);
      ctx.lineTo(ax, yC);
      ctx.stroke();

      // arrow heads
      ctx.fillStyle = "rgba(251,191,36,0.85)";
      tri(ctx, ax, yC, 7, -Math.PI/2);
      tri(ctx, ax, yV, 7, Math.PI/2);

      ctx.fillStyle = "rgba(251,191,36,0.95)";
      ctx.font = "700 12px ui-sans-serif, system-ui";
      ctx.fillText(`Eg ≈ ${state.Eg_eV.toFixed(2)} eV`, ax+10, (yC+yV)/2);

      // Radiative transition arrow
      const tx = box.x + box.w*0.62;
      const ty0 = yC + 12;
      const ty1 = yV - 12;

      ctx.strokeStyle = "rgba(52,211,153,0.85)";
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      ctx.moveTo(tx, ty0);
      ctx.lineTo(tx, ty1);
      ctx.stroke();
      tri(ctx, tx, ty1, 8, Math.PI/2);

      ctx.fillStyle = "rgba(52,211,153,0.95)";
      ctx.font = "12px ui-sans-serif, system-ui";
      ctx.fillText("radiative transition", tx+10, (ty0+ty1)/2 - 8);
      ctx.fillStyle = "rgba(169,180,199,0.95)";
      ctx.fillText("photon: E = hν = Eg + ε", tx+10, (ty0+ty1)/2 + 10);

      // Excess energy ε note
      ctx.strokeStyle = "rgba(255,255,255,0.18)";
      ctx.setLineDash([4,4]);
      ctx.beginPath();
      ctx.moveTo(x0, yC); ctx.lineTo(x1, yC);
      ctx.moveTo(x0, yV); ctx.lineTo(x1, yV);
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.fillStyle = "rgba(169,180,199,0.95)";
      ctx.font = "11px " + getComputedStyle(document.body).fontFamily;
      ctx.fillText("Thermal spread in ε (~kT) broadens spectrum above Eg", box.x+12, box.y+box.h-10);

      function tri(ctx,x,y,s,ang){
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(ang);
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.lineTo(-s, -s*0.7);
        ctx.lineTo(s, -s*0.7);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }
    }

    // ---------- Plot 2: Spectrum r_sp(E) ----------
    function drawSpectrum(){
      const canvas = document.getElementById("cSpectrum");
      const {ctx, w, h} = setupCanvas(canvas);
      clear(ctx, w, h);

      const padL = 64, padR = 18, padT = 40, padB = 48;
      const box = { x: padL, y: padT, w: w - padL - padR, h: h - padT - padB };

      // x-range: Eg to Eg + 8kT (in eV), with cap for display
      const Eg_J = state.Eg_eV * C.q;
      const kT_J = C.k * state.T;
      const xMin = state.Eg_eV;
      const xMax = state.Eg_eV + Math.min(1.8, (8*kT_J)/C.q); // show up to ~8kT, capped
      // compute y values
      const N = 260;
      let yMax = 0;
      const xs = [];
      const ys = [];
      for(let i=0;i<N;i++){
        const x_eV = xMin + (xMax-xMin)*i/(N-1);
        const E_J = x_eV * C.q;
        // convert SI density per Joule -> per eV by multiplying by dJ/d(eV)=q
        const y_SI_perJ = spectrum_rsp_E_SI(E_J, state.T, Eg_J, state.mc, state.mv, state.tau);
        const y_per_eV_m3 = y_SI_perJ * C.q; // photons/(s·m^3·eV)
        const y_per_eV_cm3 = y_per_eV_m3 / 1e6; // photons/(s·cm^3·eV)
        xs.push(x_eV);
        ys.push(y_per_eV_cm3);
        if(y_per_eV_cm3 > yMax) yMax = y_per_eV_cm3;
      }
      yMax *= 1.12;
      const yMin = 0;

      drawAxes(
        ctx, box, xMin, xMax, yMin, yMax,
        "Photon energy E = hν (eV)",
        "r_sp(E) (photons / (s·cm³·eV))",
        "Main plot: direct interband spontaneous emission spectrum (thermal equilibrium)"
      );

      // Plot curve
      ctx.lineWidth = 2.2;
      ctx.strokeStyle = "rgba(110,231,255,0.9)";
      ctx.beginPath();
      for(let i=0;i<N;i++){
        const X = mapX(xs[i], box, xMin, xMax);
        const Y = mapY(ys[i], box, yMin, yMax);
        if(i===0) ctx.moveTo(X,Y);
        else ctx.lineTo(X,Y);
      }
      ctx.stroke();

      // Eg line
      const xEg = mapX(state.Eg_eV, box, xMin, xMax);
      ctx.strokeStyle = "rgba(251,191,36,0.8)";
      ctx.lineWidth = 1.6;
      ctx.beginPath();
      ctx.moveTo(xEg, box.y);
      ctx.lineTo(xEg, box.y + box.h);
      ctx.stroke();

      ctx.fillStyle = "rgba(251,191,36,0.95)";
      ctx.font = "12px ui-sans-serif, system-ui";
      ctx.fillText("Eg", clamp(xEg+6, box.x+6, box.x+box.w-18), box.y+14);

      // Peak marker (in ε-space peak at Eg + kT/2)
      const xPeak = state.Eg_eV + (0.5*C.k*state.T)/C.q;
      if(xPeak >= xMin && xPeak <= xMax){
        const yPeak = (()=>{
          const E_J = xPeak*C.q;
          const y_SI_perJ = spectrum_rsp_E_SI(E_J, state.T, Eg_J, state.mc, state.mv, state.tau);
          return (y_SI_perJ*C.q)/1e6;
        })();
        const Xp = mapX(xPeak, box, xMin, xMax);
        const Yp = mapY(yPeak, box, yMin, yMax);
        ctx.fillStyle = "rgba(52,211,153,0.95)";
        ctx.beginPath(); ctx.arc(Xp, Yp, 4.2, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "rgba(169,180,199,0.95)";
        ctx.font = "11px ui-sans-serif, system-ui";
        ctx.fillText("peak (ε = kT/2)", clamp(Xp+8, box.x+6, box.x+box.w-110), clamp(Yp-8, box.y+14, box.y+box.h-6));
      }

      // Legend
      ctx.fillStyle = "rgba(233,238,247,0.88)";
      ctx.font = "12px ui-sans-serif, system-ui";
      ctx.fillText(`T = ${state.T} K, τr = ${(state.tau*1e9).toFixed(2)} ns`, box.x+8, box.y+box.h-10);
    }

    // ---------- Plot 3: r_r(T) sweep ----------
    function drawCoeff(){
      const canvas = document.getElementById("cCoeff");
      const {ctx, w, h} = setupCanvas(canvas);
      clear(ctx, w, h);

      const padL = 64, padR = 18, padT = 40, padB = 48;
      const box = { x: padL, y: padT, w: w - padL - padR, h: h - padT - padB };

      const Tmin = 120, Tmax = 700;
      const N = 240;

      // Compute rr(T)
      const rrVals = [];
      let yMax = 0;
      for(let i=0;i<N;i++){
        const T = Tmin + (Tmax-Tmin)*i/(N-1);
        const rr = rr_m3s(T, state.mc, state.mv, state.tau) * 1e6; // cm^3/s
        rrVals.push(rr);
        if(rr > yMax) yMax = rr;
      }
      yMax *= 1.12;
      const yMin = 0;

      drawAxes(
        ctx, box, Tmin, Tmax, yMin, yMax,
        "Temperature T (K)",
        "r_r(T) (cm³/s)",
        "Secondary plot: radiative recombination coefficient vs temperature"
      );

      // Curve
      ctx.lineWidth = 2.2;
      ctx.strokeStyle = "rgba(167,139,250,0.92)";
      ctx.beginPath();
      for(let i=0;i<N;i++){
        const T = Tmin + (Tmax-Tmin)*i/(N-1);
        const X = mapX(T, box, Tmin, Tmax);
        const Y = mapY(rrVals[i], box, yMin, yMax);
        if(i===0) ctx.moveTo(X,Y);
        else ctx.lineTo(X,Y);
      }
      ctx.stroke();

      // Highlight current T point
      const rrNow = rr_m3s(state.T, state.mc, state.mv, state.tau) * 1e6;
      const Xn = mapX(state.T, box, Tmin, Tmax);
      const Yn = mapY(rrNow, box, yMin, yMax);
      ctx.fillStyle = "rgba(110,231,255,0.95)";
      ctx.beginPath(); ctx.arc(Xn, Yn, 4.6, 0, Math.PI*2); ctx.fill();
      ctx.strokeStyle = "rgba(110,231,255,0.55)";
      ctx.lineWidth = 1.3;
      ctx.beginPath();
      ctx.moveTo(Xn, box.y); ctx.lineTo(Xn, box.y+box.h);
      ctx.stroke();

      ctx.fillStyle = "rgba(169,180,199,0.95)";
      ctx.font = "11px ui-sans-serif, system-ui";
      ctx.fillText(`current: ${rrNow.toExponential(2)} cm³/s`, clamp(Xn+8, box.x+6, box.x+box.w-160), clamp(Yn-10, box.y+14, box.y+box.h-6));

      // Note scaling
      ctx.fillStyle = "rgba(169,180,199,0.88)";
      ctx.font = "12px ui-sans-serif, system-ui";
      ctx.fillText("Scaling: r_r ∝ T^(−3/2) / τr", box.x+8, box.y+box.h-10);
    }

    // ---------- UI + updates ----------
    function applyPreset(key){
      state.presetKey = key;
      if(key === "custom") return;
      const p = presets[key];
      state.Eg_eV = p.Eg_eV;
      state.mc = p.mc_m0 * C.m0;
      state.mv = p.mv_m0 * C.m0;
      state.tau = p.tau_ns * 1e-9;
      // update tau slider to match preset
      const tauSlider = document.getElementById("tauSlider");
      tauSlider.value = clamp(p.tau_ns, parseFloat(tauSlider.min), parseFloat(tauSlider.max));
      document.getElementById("tauVal").textContent = parseFloat(tauSlider.value).toFixed(2);
    }

    function updateReadouts(){
      const rr = rr_m3s(state.T, state.mc, state.mv, state.tau) * 1e6; // cm^3/s
      document.getElementById("rrOut").textContent = rr.toExponential(3);

      const Eg_J = state.Eg_eV * C.q;
      const scale = rsp_scale(state.T, Eg_J);
      // scale is dimensionful; show normalized against value at 300K for readability
      const scale300 = rsp_scale(300, Eg_J);
      const rel = scale / scale300;
      document.getElementById("rspOut").textContent = `relative: ${rel.toFixed(3)} (vs 300 K)`;
    }

    function redrawAll(){
      drawDiagram();
      drawSpectrum();
      drawCoeff();
      updateReadouts();
    }

    function init(){
      const tSlider = document.getElementById("tSlider");
      const tauSlider = document.getElementById("tauSlider");
      const presetSel = document.getElementById("preset");

      tSlider.addEventListener("input", ()=>{
        state.T = parseInt(tSlider.value,10);
        document.getElementById("tVal").textContent = state.T;
        redrawAll();
      });

      tauSlider.addEventListener("input", ()=>{
        const ns = parseFloat(tauSlider.value);
        state.tau = ns * 1e-9;
        document.getElementById("tauVal").textContent = ns.toFixed(2);
        presetSel.value = "custom";
        state.presetKey = "custom";
        redrawAll();
      });

      presetSel.addEventListener("change", ()=>{
        applyPreset(presetSel.value);
        redrawAll();
      });

      // Resize redraw
      let resizeTimer = null;
      window.addEventListener("resize", ()=>{
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(redrawAll, 120);
      });

      // initial
      applyPreset("gaas");
      document.getElementById("tVal").textContent = state.T;
      document.getElementById("tauVal").textContent = (state.tau*1e9).toFixed(2);
      redrawAll();
    }

    init();
  </script>
</body>
</html>
