<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donor Electron Ionization Energies and Effective Bohr Radii (Hydrogenic Model)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1621;
      --panel2:#0c1320;
      --text:#e9eef6;
      --muted:#b8c3d6;
      --faint:#7f8aa3;
      --line:rgba(255,255,255,0.10);
      --line2:rgba(255,255,255,0.16);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --warn:#fde68a;
      --bad:#fca5a5;
      --shadow: 0 14px 40px rgba(0,0,0,0.45);
      --radius:18px;
      --radius2:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 10% 10%, rgba(125,211,252,0.10), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(167,139,250,0.10), transparent 55%),
        radial-gradient(800px 700px at 60% 110%, rgba(134,239,172,0.07), transparent 55%),
        linear-gradient(180deg, #070a0f, var(--bg) 40%, #070a0f);
      line-height:1.55;
    }

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    code, pre{font-family:var(--mono)}
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:28px 18px 60px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      align-items:start;
    }

    header.hero{
      grid-column:1 / -1;
      background: linear-gradient(135deg, rgba(125,211,252,0.12), rgba(167,139,250,0.10));
      border:1px solid var(--line);
      border-radius:calc(var(--radius) + 6px);
      box-shadow:var(--shadow);
      padding:22px 18px;
      overflow:hidden;
      position:relative;
    }
    header.hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(800px 300px at 20% 30%, rgba(125,211,252,0.18), transparent 60%),
        radial-gradient(700px 300px at 80% 20%, rgba(167,139,250,0.16), transparent 60%),
        radial-gradient(700px 350px at 50% 100%, rgba(134,239,172,0.10), transparent 65%);
      filter: blur(0px);
      pointer-events:none;
      opacity:0.9;
    }
    header.hero > *{position:relative}
    .kicker{
      display:inline-flex;
      gap:10px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
      letter-spacing:0.3px;
      margin-bottom:10px;
    }
    .pill{
      border:1px solid var(--line2);
      background:rgba(0,0,0,0.18);
      border-radius:999px;
      padding:5px 10px;
      font-size:12px;
      color:var(--muted);
    }
    h1{
      margin:0;
      font-size: clamp(22px, 3.1vw, 34px);
      letter-spacing:-0.4px;
      line-height:1.15;
    }
    .sub{
      margin-top:10px;
      color:var(--muted);
      max-width:88ch;
      font-size: 15px;
    }

    nav.toc{
      position:sticky;
      top:14px;
      align-self:start;
      background:rgba(15,22,33,0.70);
      backdrop-filter: blur(10px);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      padding:14px 12px;
    }
    nav.toc h2{
      margin:4px 6px 10px;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--faint);
    }
    .toc a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      border:1px solid transparent;
      transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
      font-size:14px;
    }
    .toc a:hover{
      background:rgba(255,255,255,0.06);
      border-color:rgba(255,255,255,0.10);
      transform: translateY(-1px);
      text-decoration:none;
      color:var(--text);
    }
    .toc .small{font-size:13px; color:var(--faint)}
    .toc .hr{
      height:1px;
      background:var(--line);
      margin:10px 6px;
    }

    main{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    section.card{
      background: rgba(15,22,33,0.78);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: 0 12px 30px rgba(0,0,0,0.33);
      padding:18px 16px;
      overflow:hidden;
    }
    section.card h2{
      margin:0 0 10px;
      font-size:18px;
      letter-spacing:-0.2px;
    }
    section.card h3{
      margin:16px 0 8px;
      font-size:16px;
      letter-spacing:-0.2px;
      color:var(--text);
    }
    .meta{
      color:var(--faint);
      font-size:13px;
      margin-top:-6px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }

    .callout{
      border-radius: var(--radius2);
      border:1px solid var(--line2);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      padding:12px 12px;
    }
    .callout strong{color:var(--text)}
    .callout .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
      letter-spacing:0.08em;
      text-transform:uppercase;
    }
    .tag .dot{
      width:8px;height:8px;border-radius:99px;background:var(--accent);
      box-shadow:0 0 0 3px rgba(125,211,252,0.15);
    }
    .tag.warn .dot{background:var(--warn); box-shadow:0 0 0 3px rgba(253,230,138,0.15)}
    .tag.good .dot{background:var(--good); box-shadow:0 0 0 3px rgba(134,239,172,0.15)}
    .tag.bad .dot{background:var(--bad); box-shadow:0 0 0 3px rgba(252,165,165,0.15)}

    ul{margin:8px 0 0 18px}
    li{margin:6px 0}
    .eq{
      font-family:var(--mono);
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.20);
      overflow:auto;
      position:relative;
    }
    .eq .copy{
      position:absolute;
      top:8px; right:8px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color:var(--text);
      border-radius:12px;
      padding:6px 10px;
      font-size:12px;
      cursor:pointer;
      transition: transform 120ms ease, background 120ms ease;
      user-select:none;
    }
    .eq .copy:hover{background: rgba(255,255,255,0.10); transform: translateY(-1px)}
    .eq .copy:active{transform: translateY(0px) scale(0.98)}
    .eq small{color:var(--faint); display:block; margin-top:6px}

    table{
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,0.15);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,0.09);
      text-align:left;
      font-size:14px;
    }
    th{
      color:var(--muted);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      background: rgba(255,255,255,0.04);
    }
    tr:last-child td{border-bottom:none}
    .hi{
      outline: 2px solid rgba(125,211,252,0.5);
      outline-offset:-2px;
      background: rgba(125,211,252,0.06);
    }

    .vizGrid{
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:12px;
      align-items:start;
    }
    .vizStack{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    figure{
      margin:0;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(0,0,0,0.16);
      overflow:hidden;
    }
    figcaption{
      padding:10px 12px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:13px;
    }
    canvas{
      width:100%;
      height:320px;
      display:block;
      background: radial-gradient(900px 400px at 30% 10%, rgba(125,211,252,0.08), transparent 55%),
                  radial-gradient(800px 380px at 70% 20%, rgba(167,139,250,0.07), transparent 55%),
                  rgba(0,0,0,0.10);
    }
    .smallCanvas{height:280px}

    .controls{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .control{
      padding:10px 12px;
      border-radius: var(--radius2);
      border:1px solid var(--line2);
      background: rgba(255,255,255,0.03);
    }
    .control label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:12px;
      color:var(--muted);
      font-size:13px;
      letter-spacing:0.02em;
    }
    .control label span.value{
      color:var(--text);
      font-family:var(--mono);
      font-size:13px;
    }
    .control input[type="range"]{width:100%}
    select, button{
      width:100%;
      border-radius: 14px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.18);
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    button{
      cursor:pointer;
      transition: transform 120ms ease, background 120ms ease;
      background: linear-gradient(180deg, rgba(125,211,252,0.10), rgba(125,211,252,0.04));
    }
    button:hover{transform: translateY(-1px); background: linear-gradient(180deg, rgba(125,211,252,0.14), rgba(125,211,252,0.06))}
    button:active{transform: translateY(0px) scale(0.99)}
    .note{
      color:var(--faint);
      font-size:13px;
      margin-top:8px;
    }

    footer{
      grid-column:1 / -1;
      color:var(--faint);
      font-size:13px;
      padding:10px 2px 0;
      text-align:center;
    }

    .fadeIn{
      animation: fadeIn 520ms ease both;
    }
    @keyframes fadeIn{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0px)}
    }

    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
      nav.toc{position:relative; top:auto}
      .vizGrid{grid-template-columns:1fr}
    }

    @media print{
      body{background:#fff;color:#000}
      header.hero, section.card, nav.toc, figure{box-shadow:none}
      nav.toc{display:none}
      section.card{break-inside:avoid-page; background:#fff}
      .eq{background:#fff}
      canvas{display:none}
      figcaption{display:none}
      a{color:#000; text-decoration:underline}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="hero fadeIn">
      <div class="kicker">
        <span class="pill">Photonics / Semiconductor Physics</span>
        <span class="pill">Hydrogenic donor model</span>
        <span class="pill">Interactive plots</span>
      </div>
      <h1>17.1–6 — Donor-Electron Ionization Energies and Effective Bohr Radii</h1>
      <div class="sub">
        We estimate the donor binding (ionization) energy <b>E<sub>D</sub></b> and effective Bohr radius <b>a<sub>D</sub></b> for
        Si, GaAs, GaN, and Na<sup>+</sup>-doped polyacetylene using the screened Coulomb (hydrogenic) model with
        electron effective mass and bulk relative permittivity.
      </div>
    </header>

    <nav class="toc fadeIn" aria-label="Table of contents">
      <h2>On this page</h2>
      <a href="#qs">Quick Summary</a>
      <a href="#p0">PART 0 — Concept Primer</a>
      <a href="#p1">PART 1 — Problem Analysis</a>
      <a href="#p2">PART 2 — Strategy &amp; Tips</a>
      <a href="#p3">PART 3 — Full Solution</a>
      <a href="#p4">PART 4 — Deeper Understanding</a>
      <a href="#p5">PART 5 — Visualization Guide</a>
      <div class="hr"></div>
      <a class="small" href="#viz">Interactive Visualizations</a>
      <a class="small" href="#final">Final Numeric Results</a>
    </nav>

    <main>
      <section id="qs" class="card fadeIn">
        <h2>Quick Summary</h2>
        <ul>
          <li><b>What this is about:</b> estimating how tightly a donor electron is bound in different semiconductors.</li>
          <li><b>Key physics idea:</b> a shallow donor behaves like a <b>hydrogen atom</b> but with (i) reduced mass replaced by electron effective mass <b>m*</b>, and (ii) Coulomb interaction <b>screened</b> by bulk relative permittivity <b>&epsilon;<sub>r</sub></b>.</li>
          <li><b>Governing energy scale:</b> the effective Rydberg
            <span style="font-family:var(--mono)">E<sub>D</sub> = (m*/m0) · (1/&epsilon;<sub>r</sub><sup>2</sup>) · 13.6 eV</span>.</li>
          <li><b>Governing length scale:</b> the effective Bohr radius
            <span style="font-family:var(--mono)">a<sub>D</sub> = (&epsilon;<sub>r</sub> / (m*/m0)) · a0</span>, with <span style="font-family:var(--mono)">a0 = 0.529 Å</span>.</li>
          <li><b>Thermal excitation check:</b> compare <b>E<sub>D</sub></b> to <b>k<sub>B</sub>T</b> &approx; <b>25.9 meV</b> at 300 K to judge if donors are ionized at room temperature.</li>
          <li><b>Final results type:</b> numeric <b>E<sub>D</sub></b> (meV or eV) and <b>a<sub>D</sub></b> (nm) for each material + interpretation.</li>
        </ul>
      </section>

      <section id="p0" class="card fadeIn">
        <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

        <div class="grid2">
          <div class="callout">
            <div class="tag"><span class="dot"></span><span>Core definitions</span></div>
            <ul>
              <li><b>Donor ionization energy</b> <b>E<sub>D</sub></b> [eV]: energy required to free a donor-bound electron into the conduction band (i.e., to ionize the donor).</li>
              <li><b>Effective Bohr radius</b> <b>a<sub>D</sub></b> [m or nm]: characteristic size of the donor electron wavefunction around the impurity.</li>
              <li><b>Effective mass</b> <b>m*</b> [kg]: band-structure-corrected inertia of an electron near a band edge (here, conduction-band electron mass).</li>
              <li><b>Relative permittivity</b> <b>&epsilon;<sub>r</sub></b> [dimensionless]: how strongly the crystal screens Coulomb fields compared to vacuum.</li>
            </ul>
          </div>

          <div class="callout">
            <div class="tag good"><span class="dot"></span><span>Physical meaning</span></div>
            <ul>
              <li><b>Screening</b> reduces the Coulomb attraction between the donor core (+) and the electron (−), making the bound state <b>shallower</b> and <b>larger</b>.</li>
              <li><b>Smaller m*</b> makes the electron more “delocalized,” which also makes binding <b>weaker</b> and radius <b>larger</b>.</li>
              <li>These donors are called <b>shallow</b> when <b>E<sub>D</sub></b> is small (meV–tens of meV) and <b>a<sub>D</sub></b> is much larger than the lattice spacing.</li>
            </ul>
          </div>
        </div>

        <h3>Key law / model: hydrogenic donor (effective-mass approximation)</h3>
        <div class="eq" data-copy="ED = (m*/m0) * (1/eps_r^2) * 13.6 eV
aD = (eps_r / (m*/m0)) * a0,  a0 = 0.529 Angstrom">
          <button class="copy" type="button">Copy</button>
          <div><b>Hydrogenic donor formulas (effective-mass + screening):</b></div>
          <div style="margin-top:6px;">
            E<sub>D</sub> = (m*/m<sub>0</sub>) · (1/&epsilon;<sub>r</sub><sup>2</sup>) · 13.6 eV<br/>
            a<sub>D</sub> = (&epsilon;<sub>r</sub> / (m*/m<sub>0</sub>)) · a<sub>0</sub>, &nbsp; a<sub>0</sub> = 0.529 Å
          </div>
          <small>
            These come from the hydrogen atom with replacements: m<sub>0</sub> → m*, and Coulomb constant reduced by &epsilon;<sub>r</sub>.
          </small>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout">
            <div class="tag warn"><span class="dot"></span><span>Validity & assumptions</span></div>
            <ul>
              <li>Donor is <b>shallow</b>: wavefunction spans many unit cells (EMA valid).</li>
              <li>Isotropic, parabolic band approximation near the conduction-band minimum.</li>
              <li>Use <b>bulk</b> &epsilon;<sub>r</sub> (static / low-frequency screening relevant to bound charge).</li>
              <li>Neglect “central-cell” corrections and multi-valley anisotropy (important for precise spectroscopy, not for order-of-magnitude estimates).</li>
            </ul>
          </div>
          <div class="callout">
            <div class="tag"><span class="dot"></span><span>Mini intuition examples</span></div>
            <ul>
              <li>If &epsilon;<sub>r</sub> doubles, <b>E<sub>D</sub></b> drops by a factor of <b>4</b> and <b>a<sub>D</sub></b> grows by a factor of <b>2</b>.</li>
              <li>If m* becomes 10× smaller, <b>E<sub>D</sub></b> becomes 10× smaller and <b>a<sub>D</sub></b> becomes 10× larger.</li>
            </ul>
            <div class="note"><b>What to watch for:</b> confusing refractive index with permittivity (here we need &epsilon;<sub>r</sub> given), mixing meV and eV, and forgetting the square on &epsilon;<sub>r</sub> in E<sub>D</sub>.</div>
          </div>
        </div>
      </section>

      <section id="p1" class="card fadeIn">
        <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

        <h3>Restatement in plain words</h3>
        <p>
          For each listed material, treat the donor electron like a hydrogen electron in a medium:
          replace the electron mass by the material’s effective mass <b>m*</b>, and divide Coulomb interactions by the
          bulk relative permittivity <b>&epsilon;<sub>r</sub></b>. Estimate the donor ionization energy <b>E<sub>D</sub></b>
          and the effective Bohr radius <b>a<sub>D</sub></b>. Then comment on whether thermal energy at room temperature
          can ionize these donors, and explain the role of bulk permittivity in the estimates.
        </p>

        <div class="grid2">
          <div class="callout">
            <div class="tag"><span class="dot"></span><span>Given</span></div>
            <ul>
              <li>Si: m*/m<sub>0</sub> = 0.98, &epsilon;<sub>r</sub> = 12.3</li>
              <li>GaAs: m*/m<sub>0</sub> = 0.07, &epsilon;<sub>r</sub> = 13</li>
              <li>GaN: m*/m<sub>0</sub> = 0.20, &epsilon;<sub>r</sub> = 6.25</li>
              <li>Na<sup>+</sup>-doped polyacetylene: m*/m<sub>0</sub> = 1, &epsilon;<sub>r</sub> = 3</li>
            </ul>
          </div>

          <div class="callout">
            <div class="tag"><span class="dot"></span><span>Unknowns</span></div>
            <ul>
              <li>E<sub>D</sub> for each material (eV or meV)</li>
              <li>a<sub>D</sub> for each material (nm)</li>
              <li>Thermal-ionization commentary via comparison with k<sub>B</sub>T</li>
              <li>Interpretation of &epsilon;<sub>r</sub> (screening) in the model</li>
            </ul>
          </div>
        </div>

        <h3>Why these principles apply (and what we ignore)</h3>
        <ul>
          <li><b>Applies:</b> hydrogenic bound-state physics because a donor is a Coulomb center and the electron near the conduction band behaves like a free particle with mass m*.</li>
          <li><b>We ignore:</b> detailed chemistry of the donor (“central-cell” effects), anisotropic effective mass tensors, and multi-valley corrections—these change numerical values but not the core scaling.</li>
          <li><b>We use bulk permittivity:</b> because the long-range Coulomb interaction of a slowly varying bound charge distribution is screened by the crystal’s dielectric response.</li>
        </ul>

        <div class="callout">
          <div class="tag warn"><span class="dot"></span><span>Assumptions</span></div>
          <ul>
            <li>Donors are shallow enough for EMA to be meaningful (best for typical donors in Si, GaAs; more questionable for organic polymer case).</li>
            <li>Single-particle picture (no strong polaron/exciton effects in the donor estimate).</li>
            <li>Temperature only enters through <b>k<sub>B</sub>T</b> comparison (not through bandstructure changes).</li>
          </ul>
        </div>

        <h3>Possible approaches</h3>
        <ul>
          <li><b>Approach A (best):</b> Use hydrogenic scaling formulas directly (fast, transparent, matches “estimate” wording).</li>
          <li><b>Approach B:</b> Solve Schrödinger equation with screened Coulomb potential and effective mass from scratch (same result, more algebra).</li>
          <li><b>Approach C:</b> Use experimental donor energies (accurate, but not the point of this exercise).</li>
        </ul>
        <p><b>Chosen approach:</b> Approach A — direct hydrogenic scaling — because the problem provides exactly m* and &epsilon;<sub>r</sub> and asks for estimates.</p>
      </section>

      <section id="p2" class="card fadeIn">
        <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>
        <ol>
          <li><b>Goal:</b> write the hydrogenic donor formulas. <br/><b>Tool:</b> effective-mass + dielectric screening replacements. <br/><b>Meaning:</b> sets the energy and size scales of the donor state.</li>
          <li><b>Goal:</b> compute E<sub>D</sub> for each material. <br/><b>Tool:</b> E<sub>D</sub> = 13.6 eV · (m*/m0)/&epsilon;<sub>r</sub><sup>2</sup>. <br/><b>Meaning:</b> how “shallow” the donor level is below the conduction band.</li>
          <li><b>Goal:</b> compute a<sub>D</sub> for each material. <br/><b>Tool:</b> a<sub>D</sub> = a0 · &epsilon;<sub>r</sub> /(m*/m0). <br/><b>Meaning:</b> spatial extent (localization) of the donor electron.</li>
          <li><b>Goal:</b> compare E<sub>D</sub> to k<sub>B</sub>T at 300 K. <br/><b>Tool:</b> k<sub>B</sub>T ≈ 25.9 meV. <br/><b>Meaning:</b> predicts whether donors are thermally ionized (conducting) at room temperature.</li>
          <li><b>Goal:</b> interpret permittivity’s role. <br/><b>Tool:</b> scaling E<sub>D</sub>∝1/&epsilon;<sub>r</sub><sup>2</sup>, a<sub>D</sub>∝&epsilon;<sub>r</sub>. <br/><b>Meaning:</b> stronger screening → weaker binding → larger radius.</li>
        </ol>

        <div class="grid2">
          <div class="callout">
            <div class="tag warn"><span class="dot"></span><span>Common mistakes</span></div>
            <ul>
              <li>Forgetting the <b>square</b> on &epsilon;<sub>r</sub> in E<sub>D</sub>.</li>
              <li>Reporting E<sub>D</sub> in eV when the scale is meV (or vice versa).</li>
              <li>Interpreting a small E<sub>D</sub> as “more localized” (it’s the opposite).</li>
            </ul>
          </div>
          <div class="callout">
            <div class="tag good"><span class="dot"></span><span>Quick tips</span></div>
            <ul>
              <li>Use <b>meV</b> for typical inorganic donors; use <b>eV</b> if it comes out large.</li>
              <li>Check: if &epsilon;<sub>r</sub> is big and m* is small → donors are extremely shallow.</li>
              <li>Sanity: if a<sub>D</sub> is many nm, it spans lots of lattice constants → EMA is reasonable.</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="p3" class="card fadeIn">
        <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

        <h3>Physical intuition first</h3>
        <p>
          A donor acts like a positively charged center once it gives up an electron. The bound electron experiences a Coulomb attraction,
          but the crystal <b>screens</b> this attraction by a factor &epsilon;<sub>r</sub>. Also, the electron’s kinetic energy is governed
          by its band effective mass m*. Strong screening (large &epsilon;<sub>r</sub>) and small m* both make the electron easier to unbind:
          we expect <b>GaAs</b> (very small m*) to have an especially <b>tiny</b> binding energy and a <b>large</b> donor radius.
        </p>

        <h3>Step 1 — Start from hydrogen scales and apply replacements</h3>
        <p>
          For hydrogen in vacuum, the ground-state binding energy is 13.6 eV and the Bohr radius is a<sub>0</sub> = 0.529 Å.
          For a donor in a semiconductor:
        </p>
        <ul>
          <li>Replace m<sub>0</sub> → m* (effective mass)</li>
          <li>Replace Coulomb interaction 1/(4&pi;&epsilon;<sub>0</sub>) → 1/(4&pi;&epsilon;<sub>0</sub>&epsilon;<sub>r</sub>) (dielectric screening)</li>
        </ul>

        <div class="eq" data-copy="ED = 13.6 eV * (m*/m0) / (eps_r^2)
aD = 0.529 Angstrom * (eps_r) / (m*/m0)
kBT(300K) ~ 25.9 meV">
          <button class="copy" type="button">Copy</button>
          <div><b>Working equations:</b></div>
          <div style="margin-top:6px;">
            E<sub>D</sub> = 13.6 eV · (m*/m<sub>0</sub>) / (&epsilon;<sub>r</sub><sup>2</sup>)<br/>
            a<sub>D</sub> = a<sub>0</sub> · (&epsilon;<sub>r</sub>) / (m*/m<sub>0</sub>), &nbsp; a<sub>0</sub>=0.529 Å<br/>
            k<sub>B</sub>T (300 K) &approx; 25.9 meV
          </div>
          <small>
            Units: E<sub>D</sub> in eV; a<sub>D</sub> in meters (convert to nm by dividing by 10<sup>−9</sup>).
          </small>
        </div>

        <h3>Step 2 — Compute numeric values (material by material)</h3>

        <div class="callout">
          <div class="tag"><span class="dot"></span><span>Constants used</span></div>
          <ul>
            <li>Hydrogen ground state binding energy: 13.6 eV</li>
            <li>Bohr radius: a<sub>0</sub> = 0.529 Å = 0.0529 nm</li>
            <li>Thermal energy at 300 K: k<sub>B</sub>T ≈ 25.9 meV</li>
          </ul>
        </div>

        <h3>a) Silicon (Si): m*/m0 = 0.98, &epsilon;<sub>r</sub> = 12.3</h3>
        <p><b>Ionization energy</b></p>
        <div class="eq" data-copy="Si: ED = 13.6 eV * 0.98 / (12.3^2) = 0.0881 eV = 88.1 meV">
          <button class="copy" type="button">Copy</button>
          E<sub>D</sub> = 13.6 eV · 0.98 / (12.3<sup>2</sup>)
          = 0.0881 eV = 88.1 meV
        </div>
        <p><b>Bohr radius</b></p>
        <div class="eq" data-copy="Si: aD = 0.0529 nm * (12.3/0.98) = 0.664 nm">
          <button class="copy" type="button">Copy</button>
          a<sub>D</sub> = 0.0529 nm · (12.3 / 0.98) = 0.664 nm
        </div>
        <p>
          <b>Thermal comment:</b> 88 meV is several times k<sub>B</sub>T (25.9 meV), so Si donors are not guaranteed to be fully ionized at 300 K;
          they are <b>moderately shallow</b>.
        </p>

        <h3>b) Gallium arsenide (GaAs): m*/m0 = 0.07, &epsilon;<sub>r</sub> = 13</h3>
        <p><b>Ionization energy</b></p>
        <div class="eq" data-copy="GaAs: ED = 13.6 eV * 0.07 / (13^2) = 0.00563 eV = 5.63 meV">
          <button class="copy" type="button">Copy</button>
          E<sub>D</sub> = 13.6 eV · 0.07 / (13<sup>2</sup>)
          = 0.00563 eV = 5.63 meV
        </div>
        <p><b>Bohr radius</b></p>
        <div class="eq" data-copy="GaAs: aD = 0.0529 nm * (13/0.07) = 9.82 nm">
          <button class="copy" type="button">Copy</button>
          a<sub>D</sub> = 0.0529 nm · (13 / 0.07) = 9.82 nm
        </div>
        <p>
          <b>Thermal comment:</b> 5.6 meV is far smaller than k<sub>B</sub>T at room temperature, so GaAs donors are
          <b>very shallow</b> and are typically <b>thermally ionized</b> at 300 K (high free-electron fraction).
        </p>

        <h3>c) Gallium nitride (GaN): m*/m0 = 0.20, &epsilon;<sub>r</sub> = 6.25</h3>
        <p><b>Ionization energy</b></p>
        <div class="eq" data-copy="GaN: ED = 13.6 eV * 0.20 / (6.25^2) = 0.0696 eV = 69.6 meV">
          <button class="copy" type="button">Copy</button>
          E<sub>D</sub> = 13.6 eV · 0.20 / (6.25<sup>2</sup>)
          = 0.0696 eV = 69.6 meV
        </div>
        <p><b>Bohr radius</b></p>
        <div class="eq" data-copy="GaN: aD = 0.0529 nm * (6.25/0.20) = 1.65 nm">
          <button class="copy" type="button">Copy</button>
          a<sub>D</sub> = 0.0529 nm · (6.25 / 0.20) = 1.65 nm
        </div>
        <p>
          <b>Thermal comment:</b> 70 meV is larger than k<sub>B</sub>T, so donors in GaN are less easily ionized than in GaAs.
          This helps explain why achieving high n-type conductivity in wide-bandgap materials can be harder: donors can be <b>less shallow</b>.
        </p>

        <h3>d) Na<sup>+</sup>-doped polyacetylene: m*/m0 = 1, &epsilon;<sub>r</sub> = 3</h3>
        <p><b>Ionization energy</b></p>
        <div class="eq" data-copy="Polyacetylene: ED = 13.6 eV * 1 / (3^2) = 1.51 eV">
          <button class="copy" type="button">Copy</button>
          E<sub>D</sub> = 13.6 eV · 1 / (3<sup>2</sup>)
          = 1.51 eV
        </div>
        <p><b>Bohr radius</b></p>
        <div class="eq" data-copy="Polyacetylene: aD = 0.0529 nm * (3/1) = 0.159 nm">
          <button class="copy" type="button">Copy</button>
          a<sub>D</sub> = 0.0529 nm · (3 / 1) = 0.159 nm
        </div>
        <p>
          <b>Thermal comment:</b> 1.5 eV is enormous compared to k<sub>B</sub>T. This would be a <b>deep</b> bound state in this simplistic model.
          In organics, carriers and bound states are often better described with polaron/exciton physics and localized molecular orbitals; the hydrogenic EMA can fail.
          The problem hint about <b>OLEDs</b> and <b>bound excitons</b> is a clue that Coulomb binding can remain strong when &epsilon;<sub>r</sub> is small.
        </p>

        <h3>Sanity checks</h3>
        <ul>
          <li><b>Units:</b> E<sub>D</sub> inherits eV from 13.6 eV, scaled by dimensionless factors; a<sub>D</sub> inherits length from a<sub>0</sub>.</li>
          <li><b>Limiting cases:</b> as &epsilon;<sub>r</sub> → ∞, E<sub>D</sub> → 0 and a<sub>D</sub> → ∞ (complete screening → no binding). As m* → 0, E<sub>D</sub> → 0 and a<sub>D</sub> → ∞ (electron too “light” to localize).</li>
          <li><b>Physical interpretation:</b> GaAs has tiny m* and large &epsilon;<sub>r</sub> ⇒ extremely shallow, very large radius; polyacetylene has low &epsilon;<sub>r</sub> ⇒ strong binding and small radius.</li>
        </ul>

        <p>
          <b>Connection to the diagram/plots:</b> The diagram shows a screened Coulomb potential around a donor.
          The plots visualize exactly the scalings above: E<sub>D</sub> falls like 1/&epsilon;<sub>r</sub><sup>2</sup>, while a<sub>D</sub> grows like &epsilon;<sub>r</sub>.
          The interactive sliders let you see how changing the same physical knobs (screening and effective mass) simultaneously changes both energy and size.
        </p>
      </section>

      <section id="p4" class="card fadeIn">
        <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

        <h3>Re-interpreting the formulas</h3>
        <ul>
          <li><b>E<sub>D</sub> ∝ m*</b>: heavier effective mass means higher kinetic-energy cost to spread out, so localization is easier → stronger binding.</li>
          <li><b>E<sub>D</sub> ∝ 1/&epsilon;<sub>r</sub><sup>2</sup></b>: screening weakens the Coulomb attraction strongly; doubling &epsilon;<sub>r</sub> quarters the binding energy.</li>
          <li><b>a<sub>D</sub> ∝ &epsilon;<sub>r</sub></b> and <b>a<sub>D</sub> ∝ 1/m*</b>: more screening and smaller mass both expand the wavefunction.</li>
        </ul>

        <div class="grid2">
          <div class="callout">
            <div class="tag good"><span class="dot"></span><span>Thermal excitation (room temperature)</span></div>
            <ul>
              <li>At 300 K, k<sub>B</sub>T ≈ 25.9 meV sets a rough “thermal ionization” scale.</li>
              <li><b>GaAs (5.6 meV)</b>: E<sub>D</sub> ≪ k<sub>B</sub>T ⇒ donors mostly ionized.</li>
              <li><b>Si (88 meV)</b> and <b>GaN (70 meV)</b>: E<sub>D</sub> &gt; k<sub>B</sub>T ⇒ donors less ionized; higher T or heavy doping helps.</li>
              <li><b>Polyacetylene (1.5 eV)</b>: E<sub>D</sub> ≫ k<sub>B</sub>T ⇒ not thermally ionized in this simple picture.</li>
            </ul>
          </div>

          <div class="callout">
            <div class="tag warn"><span class="dot"></span><span>Role of bulk permittivity</span></div>
            <ul>
              <li>Bulk &epsilon;<sub>r</sub> enters because the donor’s electric field polarizes the medium, reducing the effective Coulomb attraction.</li>
              <li>In low-&epsilon;<sub>r</sub> media (many organics), Coulomb binding remains strong → small radii and large binding energies (excitons can be strongly bound).</li>
              <li>In high-&epsilon;<sub>r</sub> crystals, donors (and excitons) are generally more weakly bound.</li>
            </ul>
          </div>
        </div>

        <h3>Alternative derivation idea (brief)</h3>
        <p>
          Start from the Schrödinger equation for a Coulomb potential
          <span style="font-family:var(--mono)">V(r) = -e^2/(4π ε0 εr r)</span>
          but replace the kinetic term with effective mass:
          <span style="font-family:var(--mono)">-(ħ^2/2m*)∇^2</span>.
          Then rescale lengths by a<sub>D</sub> so the equation becomes identical to hydrogen, immediately yielding the same eigenvalues and radius scaling.
        </p>

        <h3>Concept checks (with answers)</h3>
        <ul>
          <li><b>Q:</b> If &epsilon;<sub>r</sub> increases, what happens to E<sub>D</sub>? <b>A:</b> It decreases like 1/&epsilon;<sub>r</sub><sup>2</sup>.</li>
          <li><b>Q:</b> Why does GaAs have such a large a<sub>D</sub>? <b>A:</b> Its m* is very small, so a<sub>D</sub> ∝ 1/m* is very large.</li>
          <li><b>Q:</b> What does “shallow donor” mean in practice? <b>A:</b> Binding energy is small (meV–tens of meV) and radius spans many lattice constants, enabling thermal ionization.</li>
          <li><b>Q:</b> Why might the organic-polymer estimate be less reliable? <b>A:</b> Charge carriers can localize strongly (polarons), screening can be nontrivial, and the band-like EMA picture may fail.</li>
        </ul>
      </section>

      <section id="viz" class="card fadeIn">
        <h2>Interactive Visualizations</h2>
        <p class="meta">
          Use the controls to switch materials or sweep parameters. All canvases update live.
        </p>

        <div class="vizGrid">
          <div class="vizStack">
            <figure>
              <canvas id="cDiagram" aria-label="Donor diagram canvas"></canvas>
              <figcaption>
                <b>Diagram:</b> Donor core (+) with a screened Coulomb potential and an electron probability cloud characterized by the effective Bohr radius a<sub>D</sub>.
              </figcaption>
            </figure>

            <figure>
              <canvas id="cMain" aria-label="Main plot canvas"></canvas>
              <figcaption>
                <b>Main plot:</b> Donor ionization energy E<sub>D</sub> versus relative permittivity &epsilon;<sub>r</sub> (with your chosen m*/m<sub>0</sub>).
              </figcaption>
            </figure>
          </div>

          <div class="vizStack">
            <div class="controls">
              <div class="control">
                <label>
                  <span>Preset material</span>
                </label>
                <select id="preset">
                  <option value="Si">Silicon (Si)</option>
                  <option value="GaAs">Gallium arsenide (GaAs)</option>
                  <option value="GaN">Gallium nitride (GaN)</option>
                  <option value="Poly">Na+-doped polyacetylene</option>
                  <option value="Custom">Custom</option>
                </select>
                <div class="note">Selecting a preset sets m*/m0 and &epsilon;<sub>r</sub>. Choose “Custom” to freely adjust.</div>
              </div>

              <div class="control">
                <label>
                  <span>Relative permittivity &epsilon;<sub>r</sub></span>
                  <span class="value" id="epsVal">12.30</span>
                </label>
                <input id="eps" type="range" min="2" max="20" step="0.01" value="12.3" />
                <div class="note">Energy drops ~ 1/&epsilon;<sub>r</sub><sup>2</sup>; radius grows ~ &epsilon;<sub>r</sub>.</div>
              </div>

              <div class="control">
                <label>
                  <span>Effective mass ratio m*/m<sub>0</sub></span>
                  <span class="value" id="mVal">0.98</span>
                </label>
                <input id="m" type="range" min="0.03" max="1.20" step="0.001" value="0.98" />
                <div class="note">Energy grows ~ m*; radius shrinks ~ 1/m*.</div>
              </div>

              <div class="control">
                <label>
                  <span>Temperature T (for k<sub>B</sub>T comparison)</span>
                  <span class="value" id="tVal">300 K</span>
                </label>
                <input id="temp" type="range" min="50" max="600" step="1" value="300" />
                <div class="note">k<sub>B</sub>T sets a thermal ionization scale (rule-of-thumb, not a full ionization model).</div>
              </div>

              <div class="control">
                <button id="snap" type="button">Snap sweep range to current &epsilon;<sub>r</sub></button>
                <div class="note">Adjusts the plot window to focus around your chosen &epsilon;<sub>r</sub>.</div>
              </div>
            </div>

            <figure>
              <canvas id="cSecondary" class="smallCanvas" aria-label="Secondary plot canvas"></canvas>
              <figcaption>
                <b>Secondary plot:</b> Effective Bohr radius a<sub>D</sub> versus relative permittivity &epsilon;<sub>r</sub> (with your chosen m*/m<sub>0</sub>).
              </figcaption>
            </figure>
          </div>
        </div>
      </section>

      <section id="final" class="card fadeIn">
        <h2>Final Numeric Results</h2>

        <div class="eq" data-copy="Results:
Si: m*/m0=0.98, eps_r=12.3 => ED=0.0881 eV (88.1 meV), aD=0.664 nm
GaAs: m*/m0=0.07, eps_r=13 => ED=0.00563 eV (5.63 meV), aD=9.82 nm
GaN: m*/m0=0.20, eps_r=6.25 => ED=0.0696 eV (69.6 meV), aD=1.65 nm
Na+-doped polyacetylene: m*/m0=1, eps_r=3 => ED=1.51 eV, aD=0.159 nm">
          <button class="copy" type="button">Copy</button>
          <b>Copy-friendly final answers (plain text):</b>
          <div style="margin-top:6px; white-space:pre-wrap;">
Si: m*/m0=0.98, eps_r=12.3 → ED=0.0881 eV (88.1 meV), aD=0.664 nm
GaAs: m*/m0=0.07, eps_r=13 → ED=0.00563 eV (5.63 meV), aD=9.82 nm
GaN: m*/m0=0.20, eps_r=6.25 → ED=0.0696 eV (69.6 meV), aD=1.65 nm
Na+-doped polyacetylene: m*/m0=1, eps_r=3 → ED=1.51 eV, aD=0.159 nm
          </div>
        </div>

        <table aria-label="Computed donor energies and radii table">
          <thead>
            <tr>
              <th>Material</th>
              <th>m*/m0</th>
              <th>&epsilon;<sub>r</sub></th>
              <th>E<sub>D</sub></th>
              <th>a<sub>D</sub></th>
              <th>Thermal note (300 K)</th>
            </tr>
          </thead>
          <tbody id="resultBody">
            <!-- filled by JS -->
          </tbody>
        </table>

        <div class="grid2" style="margin-top:12px;">
          <div class="callout">
            <div class="tag good"><span class="dot"></span><span>Thermal excitations: the big picture</span></div>
            <ul>
              <li><b>GaAs:</b> E<sub>D</sub> ≪ k<sub>B</sub>T → donors readily ionize → strong n-type conduction at room temperature.</li>
              <li><b>Si, GaN:</b> E<sub>D</sub> &gt; k<sub>B</sub>T → incomplete ionization unless temperature is higher or doping is heavy (and band-tail/impurity-band effects appear).</li>
              <li><b>Low-&epsilon;<sub>r</sub> organics:</b> strong Coulomb binding → excitons/donor states can be deep; thermal ionization is weak → recombination and excitonic physics become central.</li>
            </ul>
          </div>
          <div class="callout">
            <div class="tag warn"><span class="dot"></span><span>Why permittivity matters so much</span></div>
            <ul>
              <li>Because E<sub>D</sub> scales as <b>1/&epsilon;<sub>r</sub><sup>2</sup></b>, even modest changes in screening strongly change ionization energies.</li>
              <li>Because a<sub>D</sub> scales as <b>&epsilon;<sub>r</sub></b>, higher screening spreads the donor wavefunction over more lattice sites (more “hydrogenic”).</li>
              <li>This is why materials with high &epsilon;<sub>r</sub> typically have <b>shallow</b> hydrogen-like donors and weakly bound excitons.</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="p5" class="card fadeIn">
        <h2>PART 5 — Visualization Guide (How to Read the Plots)</h2>
        <h3>What each canvas shows</h3>
        <ul>
          <li><b>Diagram canvas:</b> a donor core (+) in a lattice, a screened potential well, and the electron probability cloud size set by a<sub>D</sub>.</li>
          <li><b>Main plot:</b> E<sub>D</sub> (meV) vs &epsilon;<sub>r</sub> for the current m*/m<sub>0</sub>. The curve follows E<sub>D</sub> ∝ 1/&epsilon;<sub>r</sub><sup>2</sup>.</li>
          <li><b>Secondary plot:</b> a<sub>D</sub> (nm) vs &epsilon;<sub>r</sub> for the current m*/m<sub>0</sub>. The curve follows a<sub>D</sub> ∝ &epsilon;<sub>r</sub>.</li>
        </ul>

        <h3>Interactive controls</h3>
        <ul>
          <li><b>Preset material:</b> loads the given (m*/m<sub>0</sub>, &epsilon;<sub>r</sub>) pair for Si, GaAs, GaN, or polyacetylene.</li>
          <li><b>&epsilon;<sub>r</sub> slider:</b> increasing &epsilon;<sub>r</sub> should push the highlighted point <b>down</b> in the energy plot and <b>up</b> in the radius plot.</li>
          <li><b>m*/m<sub>0</sub> slider:</b> increasing m* should push the point <b>up</b> in energy and <b>down</b> in radius.</li>
          <li><b>Temperature slider:</b> updates the displayed k<sub>B</sub>T reference line in the energy plot for quick thermal comparison.</li>
        </ul>

        <div class="callout">
          <div class="tag"><span class="dot"></span><span>Plot-reading tip</span></div>
          <p style="margin:0;">
            If the highlighted E<sub>D</sub> point lies <b>below</b> the k<sub>B</sub>T line, donors are likely thermally ionized (shallow).
            If it lies <b>above</b>, donors are less ionized (deeper), and carrier freeze-out becomes more important.
          </p>
        </div>
      </section>

      <footer>
        Built as a self-contained learning article (vanilla HTML/CSS/JS). Copy buttons included for equations and final results.
      </footer>
    </main>
  </div>

  <script>
    // ----------------------------
    // Copy buttons for equations
    // ----------------------------
    function setupCopyButtons(){
      document.querySelectorAll('.eq').forEach(eq=>{
        const btn = eq.querySelector('.copy');
        if(!btn) return;
        btn.addEventListener('click', async ()=>{
          const txt = eq.getAttribute('data-copy') || eq.innerText;
          try{
            await navigator.clipboard.writeText(txt.trim());
            const old = btn.textContent;
            btn.textContent = "Copied!";
            setTimeout(()=>btn.textContent = old, 900);
          }catch(e){
            // fallback
            const ta = document.createElement('textarea');
            ta.value = txt.trim();
            document.body.appendChild(ta);
            ta.select();
            try{ document.execCommand('copy'); }catch(_){}
            document.body.removeChild(ta);
            const old = btn.textContent;
            btn.textContent = "Copied!";
            setTimeout(()=>btn.textContent = old, 900);
          }
        });
      });
    }

    // ----------------------------
    // Physics helpers
    // ----------------------------
    const CONST = {
      Ry_eV: 13.6,
      a0_nm: 0.0529,        // 0.529 Å in nm
      kB_eV_perK: 8.617333262e-5
    };

    function donorEnergy_eV(mratio, epsr){
      return CONST.Ry_eV * (mratio) / (epsr*epsr);
    }
    function donorRadius_nm(mratio, epsr){
      return CONST.a0_nm * (epsr) / (mratio);
    }
    function kBT_meV(T){
      return 1000 * CONST.kB_eV_perK * T;
    }

    const materials = {
      "Si":   { name:"Silicon (Si)", m:0.98, eps:12.3 },
      "GaAs": { name:"Gallium arsenide (GaAs)", m:0.07, eps:13.0 },
      "GaN":  { name:"Gallium nitride (GaN)", m:0.20, eps:6.25 },
      "Poly": { name:"Na+-doped polyacetylene", m:1.00, eps:3.0 }
    };

    // ----------------------------
    // Canvas utilities (HiDPI + responsive)
    // ----------------------------
    function setupHiDPICanvas(canvas){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(2, Math.floor(rect.width * dpr));
      const h = Math.max(2, Math.floor(rect.height * dpr));
      if(canvas.width !== w || canvas.height !== h){
        canvas.width = w;
        canvas.height = h;
      }
      const ctx = canvas.getContext('2d');
      ctx.setTransform(dpr,0,0,dpr,0,0);
      return {ctx, widthCSS: rect.width, heightCSS: rect.height, dpr};
    }

    function clear(ctx, w, h){
      ctx.clearRect(0,0,w,h);
    }

    function lerp(a,b,t){ return a + (b-a)*t; }

    function roundTo(x, n=2){
      const p = Math.pow(10,n);
      return Math.round(x*p)/p;
    }

    function niceTicks(min, max, target=6){
      // returns {min,max,step,ticks[]}
      const span = max - min;
      if(span <= 0) return {min, max, step:1, ticks:[min,max]};
      const raw = span / target;
      const pow10 = Math.pow(10, Math.floor(Math.log10(raw)));
      const n = raw / pow10;
      let step;
      if(n < 1.5) step = 1 * pow10;
      else if(n < 3.5) step = 2 * pow10;
      else if(n < 7.5) step = 5 * pow10;
      else step = 10 * pow10;
      const niceMin = Math.floor(min/step)*step;
      const niceMax = Math.ceil(max/step)*step;
      const ticks = [];
      for(let v=niceMin; v<=niceMax + 1e-12; v+=step) ticks.push(v);
      return {min:niceMin, max:niceMax, step, ticks};
    }

    function drawAxes(ctx, box, xCfg, yCfg, title, xLabel, yLabel){
      const {x,y,w,h} = box;
      ctx.save();
      // panel
      ctx.fillStyle = "rgba(0,0,0,0.18)";
      ctx.fillRect(x,y,w,h);
      ctx.strokeStyle = "rgba(255,255,255,0.14)";
      ctx.lineWidth = 1;
      ctx.strokeRect(x+0.5,y+0.5,w-1,h-1);

      // title
      ctx.fillStyle = "rgba(233,238,246,0.96)";
      ctx.font = "600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(title, x+10, y+20);

      const padL=56, padR=18, padT=30, padB=44;
      const px0 = x+padL, py0 = y+h-padB;
      const px1 = x+w-padR, py1 = y+padT;

      // grid + ticks
      ctx.strokeStyle = "rgba(255,255,255,0.08)";
      ctx.fillStyle = "rgba(184,195,214,0.92)";
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";

      // X ticks
      xCfg.ticks.forEach(tv=>{
        const t = (tv - xCfg.min) / (xCfg.max - xCfg.min);
        const px = lerp(px0, px1, t);
        // gridline
        ctx.beginPath();
        ctx.moveTo(px, py0);
        ctx.lineTo(px, py1);
        ctx.stroke();
        // tick label
        ctx.fillText(formatTick(tv), px-10, py0+18);
      });

      // Y ticks
      yCfg.ticks.forEach(tv=>{
        const t = (tv - yCfg.min) / (yCfg.max - yCfg.min);
        const py = lerp(py0, py1, t);
        ctx.beginPath();
        ctx.moveTo(px0, py);
        ctx.lineTo(px1, py);
        ctx.stroke();
        // tick label
        ctx.fillText(formatTick(tv), x+10, py+4);
      });

      // axes lines
      ctx.strokeStyle = "rgba(255,255,255,0.22)";
      ctx.lineWidth = 1.2;
      ctx.beginPath();
      ctx.moveTo(px0, py0);
      ctx.lineTo(px1, py0);
      ctx.moveTo(px0, py0);
      ctx.lineTo(px0, py1);
      ctx.stroke();

      // labels
      ctx.fillStyle = "rgba(184,195,214,0.95)";
      ctx.font = "13px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText(xLabel, (px0+px1)/2 - ctx.measureText(xLabel).width/2, y+h-14);

      ctx.save();
      ctx.translate(x+14, (py0+py1)/2);
      ctx.rotate(-Math.PI/2);
      ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
      ctx.restore();

      ctx.restore();

      return {px0, py0, px1, py1};
    }

    function formatTick(v){
      const av = Math.abs(v);
      if(av >= 1000) return (v/1000).toFixed(1)+"k";
      if(av >= 100) return v.toFixed(0);
      if(av >= 10) return v.toFixed(1);
      if(av >= 1) return v.toFixed(2);
      if(av >= 0.1) return v.toFixed(2);
      return v.toExponential(1);
    }

    function plotLine(ctx, area, xCfg, yCfg, f, color="rgba(125,211,252,0.95)", width=2){
      const {px0,py0,px1,py1} = area;
      ctx.save();
      ctx.strokeStyle = color;
      ctx.lineWidth = width;
      ctx.beginPath();
      const N=220;
      for(let i=0;i<=N;i++){
        const x = lerp(xCfg.min, xCfg.max, i/N);
        const y = f(x);
        const tx = (x - xCfg.min) / (xCfg.max - xCfg.min);
        const ty = (y - yCfg.min) / (yCfg.max - yCfg.min);
        const px = lerp(px0, px1, tx);
        const py = lerp(py0, py1, ty);
        if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      }
      ctx.stroke();
      ctx.restore();
    }

    function plotPoint(ctx, area, xCfg, yCfg, x, y, label, color="rgba(233,238,246,0.95)"){
      const {px0,py0,px1,py1} = area;
      const tx = (x - xCfg.min) / (xCfg.max - xCfg.min);
      const ty = (y - yCfg.min) / (yCfg.max - yCfg.min);
      const px = lerp(px0, px1, tx);
      const py = lerp(py0, py1, ty);

      ctx.save();
      // halo
      ctx.fillStyle = "rgba(125,211,252,0.20)";
      ctx.beginPath(); ctx.arc(px,py,10,0,Math.PI*2); ctx.fill();
      // dot
      ctx.fillStyle = "rgba(125,211,252,0.95)";
      ctx.beginPath(); ctx.arc(px,py,4,0,Math.PI*2); ctx.fill();

      ctx.fillStyle = color;
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      ctx.fillText(label, px+10, py-10);
      ctx.restore();
    }

    function plotHLine(ctx, area, yCfg, y, label){
      const {px0,py0,px1,py1} = area;
      if(y < yCfg.min || y > yCfg.max) return;
      const ty = (y - yCfg.min) / (yCfg.max - yCfg.min);
      const py = lerp(py0, py1, ty);
      ctx.save();
      ctx.strokeStyle = "rgba(253,230,138,0.75)";
      ctx.lineWidth = 2;
      ctx.setLineDash([6,4]);
      ctx.beginPath();
      ctx.moveTo(px0, py);
      ctx.lineTo(px1, py);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = "rgba(253,230,138,0.92)";
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      ctx.fillText(label, px0+6, py-6);
      ctx.restore();
    }

    // ----------------------------
    // Diagram drawing
    // ----------------------------
    function drawDiagram(canvas, mratio, epsr){
      const {ctx, widthCSS:w, heightCSS:h} = setupHiDPICanvas(canvas);
      clear(ctx, w, h);

      // background
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.14)";
      ctx.fillRect(0,0,w,h);

      // lattice dots
      ctx.globalAlpha = 0.30;
      ctx.fillStyle = "rgba(255,255,255,0.10)";
      const step = Math.max(18, Math.min(34, w/18));
      for(let yy=30; yy<h-20; yy+=step){
        for(let xx=20; xx<w-20; xx+=step){
          ctx.beginPath();
          ctx.arc(xx, yy, 1.2, 0, Math.PI*2);
          ctx.fill();
        }
      }
      ctx.globalAlpha = 1;

      const cx = w*0.33, cy = h*0.55;

      // donor core (+)
      ctx.fillStyle = "rgba(167,139,250,0.95)";
      ctx.beginPath(); ctx.arc(cx, cy, 16, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = "rgba(233,238,246,0.95)";
      ctx.font = "700 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("+", cx-4, cy+5);

      // potential well (schematic)
      const left = w*0.08, right=w*0.92, top=h*0.18, mid=h*0.40;
      ctx.strokeStyle = "rgba(125,211,252,0.55)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(left, mid);
      // draw a -1/r-like curve centered at cx
      const N=240;
      for(let i=0;i<=N;i++){
        const x = lerp(left, right, i/N);
        const r = Math.max(10, Math.abs(x - cx));
        const y = mid + 380/r; // smaller r => larger y (downwards)
        const yy = Math.min(h*0.90, Math.max(top, y));
        if(i===0) ctx.lineTo(x, yy); else ctx.lineTo(x, yy);
      }
      ctx.stroke();

      // electron cloud size ~ aD (scaled for display)
      const a_nm = donorRadius_nm(mratio, epsr);
      const cloud = Math.min(110, Math.max(28, a_nm*10)); // nm -> px-ish scaling
      const grd = ctx.createRadialGradient(cx, cy, 6, cx, cy, cloud);
      grd.addColorStop(0, "rgba(125,211,252,0.22)");
      grd.addColorStop(0.5, "rgba(125,211,252,0.12)");
      grd.addColorStop(1, "rgba(125,211,252,0.00)");
      ctx.fillStyle = grd;
      ctx.beginPath(); ctx.arc(cx, cy, cloud, 0, Math.PI*2); ctx.fill();

      // label aD
      ctx.strokeStyle = "rgba(233,238,246,0.65)";
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(cx+cloud, cy);
      ctx.stroke();
      ctx.fillStyle = "rgba(233,238,246,0.92)";
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      ctx.fillText("aD", cx+cloud/2 - 10, cy-10);

      // labels
      ctx.fillStyle = "rgba(233,238,246,0.96)";
      ctx.font = "600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Screened donor potential and bound electron", 12, 22);

      ctx.fillStyle = "rgba(184,195,214,0.92)";
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      const EDmeV = donorEnergy_eV(mratio, epsr)*1000;
      ctx.fillText(`m*/m0=${roundTo(mratio,3)}   eps_r=${roundTo(epsr,2)}   ED=${roundTo(EDmeV,2)} meV   aD=${roundTo(a_nm,3)} nm`, 12, 42);

      // axis cue for potential
      ctx.fillText("V(r) (schematic)", left, top-8);
      ctx.fillText("r", right-10, mid+18);

      ctx.restore();
    }

    // ----------------------------
    // Plot drawing
    // ----------------------------
    let sweep = {min:2, max:20};

    function drawEnergyPlot(canvas, mratio, epsr, T){
      const {ctx, widthCSS:w, heightCSS:h} = setupHiDPICanvas(canvas);
      clear(ctx, w, h);

      const xMin = sweep.min, xMax = sweep.max;
      // compute y range from endpoints
      const y1 = donorEnergy_eV(mratio, xMin)*1000;
      const y2 = donorEnergy_eV(mratio, xMax)*1000;
      const yMaxRaw = Math.max(y1,y2, donorEnergy_eV(mratio, epsr)*1000);
      const yMinRaw = 0;
      const yCfg = niceTicks(yMinRaw, yMaxRaw*1.10, 6);
      const xCfg = niceTicks(xMin, xMax, 7);

      const area = drawAxes(
        ctx,
        {x:12,y:10,w:w-24,h:h-20},
        xCfg,
        yCfg,
        "Donor ionization energy vs permittivity",
        "Relative permittivity  εr  (dimensionless)",
        "ED  (meV)"
      );

      // curve
      plotLine(ctx, area, xCfg, yCfg, (x)=>donorEnergy_eV(mratio, x)*1000, "rgba(125,211,252,0.95)", 2.5);

      // kBT reference
      const kb = kBT_meV(T);
      plotHLine(ctx, area, yCfg, kb, `kBT = ${roundTo(kb,1)} meV`);

      // current point
      const EDmeV = donorEnergy_eV(mratio, epsr)*1000;
      plotPoint(ctx, area, xCfg, yCfg, epsr, EDmeV, `(${roundTo(epsr,2)}, ${roundTo(EDmeV,2)})`);

      // legend-ish
      ctx.save();
      ctx.fillStyle = "rgba(233,238,246,0.92)";
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      ctx.fillText(`Curve uses m*/m0 = ${roundTo(mratio,3)}`, 26, h-26);
      ctx.restore();
    }

    function drawRadiusPlot(canvas, mratio, epsr){
      const {ctx, widthCSS:w, heightCSS:h} = setupHiDPICanvas(canvas);
      clear(ctx, w, h);

      const xMin = sweep.min, xMax = sweep.max;
      const y1 = donorRadius_nm(mratio, xMin);
      const y2 = donorRadius_nm(mratio, xMax);
      const yMaxRaw = Math.max(y1,y2, donorRadius_nm(mratio, epsr));
      const yCfg = niceTicks(0, yMaxRaw*1.10, 6);
      const xCfg = niceTicks(xMin, xMax, 7);

      const area = drawAxes(
        ctx,
        {x:12,y:10,w:w-24,h:h-20},
        xCfg,
        yCfg,
        "Effective Bohr radius vs permittivity",
        "Relative permittivity  εr  (dimensionless)",
        "aD  (nm)"
      );

      plotLine(ctx, area, xCfg, yCfg, (x)=>donorRadius_nm(mratio, x), "rgba(167,139,250,0.92)", 2.5);

      const a = donorRadius_nm(mratio, epsr);
      plotPoint(ctx, area, xCfg, yCfg, epsr, a, `(${roundTo(epsr,2)}, ${roundTo(a,3)})`, "rgba(233,238,246,0.92)");

      ctx.save();
      ctx.fillStyle = "rgba(233,238,246,0.92)";
      ctx.font = "12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";
      ctx.fillText(`Curve uses m*/m0 = ${roundTo(mratio,3)}`, 26, h-26);
      ctx.restore();
    }

    // ----------------------------
    // Results table
    // ----------------------------
    function fmtEnergy(eV){
      // choose meV if < 0.2 eV
      if(eV < 0.2) return `${roundTo(eV*1000,2)} meV`;
      return `${roundTo(eV,3)} eV`;
    }
    function fmtRadius(nm){
      return `${roundTo(nm,3)} nm`;
    }
    function thermalNote(eV, T=300){
      const kb = CONST.kB_eV_perK*T;
      const ratio = eV / kb;
      if(ratio < 0.6) return "ED ≪ kBT → mostly ionized";
      if(ratio < 1.5) return "ED ~ kBT → partial ionization";
      return "ED > kBT → incomplete ionization";
    }

    function populateTable(currentPresetKey){
      const body = document.getElementById('resultBody');
      body.innerHTML = "";
      const keys = ["Si","GaAs","GaN","Poly"];
      keys.forEach(k=>{
        const m = materials[k].m;
        const eps = materials[k].eps;
        const ED = donorEnergy_eV(m, eps);
        const a = donorRadius_nm(m, eps);
        const tr = document.createElement('tr');
        if(k === currentPresetKey) tr.classList.add('hi');
        tr.innerHTML = `
          <td><b>${materials[k].name}</b></td>
          <td>${roundTo(m,3)}</td>
          <td>${roundTo(eps,2)}</td>
          <td>${fmtEnergy(ED)}</td>
          <td>${fmtRadius(a)}</td>
          <td>${thermalNote(ED, 300)}</td>
        `;
        body.appendChild(tr);
      });
    }

    // ----------------------------
    // Wiring & live updates
    // ----------------------------
    const el = {
      preset: document.getElementById('preset'),
      eps: document.getElementById('eps'),
      m: document.getElementById('m'),
      temp: document.getElementById('temp'),
      epsVal: document.getElementById('epsVal'),
      mVal: document.getElementById('mVal'),
      tVal: document.getElementById('tVal'),
      snap: document.getElementById('snap'),
      cDiagram: document.getElementById('cDiagram'),
      cMain: document.getElementById('cMain'),
      cSecondary: document.getElementById('cSecondary')
    };

    function setControlsFromPreset(key){
      if(key in materials){
        el.eps.value = materials[key].eps;
        el.m.value = materials[key].m;
      }
      updateLabels();
      renderAll();
    }

    function updateLabels(){
      el.epsVal.textContent = Number(el.eps.value).toFixed(2);
      el.mVal.textContent = Number(el.m.value).toFixed(3);
      el.tVal.textContent = `${Number(el.temp.value)} K`;
    }

    function renderAll(){
      const mratio = Number(el.m.value);
      const epsr = Number(el.eps.value);
      const T = Number(el.temp.value);

      drawDiagram(el.cDiagram, mratio, epsr);
      drawEnergyPlot(el.cMain, mratio, epsr, T);
      drawRadiusPlot(el.cSecondary, mratio, epsr);

      const presetKey = el.preset.value;
      populateTable(presetKey in materials ? presetKey : null);
    }

    function maybeSetCustom(){
      if(el.preset.value !== "Custom"){
        el.preset.value = "Custom";
      }
    }

    el.preset.addEventListener('change', ()=>{
      const key = el.preset.value;
      if(key === "Custom"){
        updateLabels();
        renderAll();
      }else{
        setControlsFromPreset(key);
      }
    });

    el.eps.addEventListener('input', ()=>{
      updateLabels();
      if(el.preset.value !== "Custom"){
        // user altered a preset -> switch to custom
        maybeSetCustom();
      }
      renderAll();
    });

    el.m.addEventListener('input', ()=>{
      updateLabels();
      if(el.preset.value !== "Custom"){
        maybeSetCustom();
      }
      renderAll();
    });

    el.temp.addEventListener('input', ()=>{
      updateLabels();
      renderAll();
    });

    el.snap.addEventListener('click', ()=>{
      const epsr = Number(el.eps.value);
      const span = 10;
      sweep.min = Math.max(2, epsr - span/2);
      sweep.max = Math.min(20, epsr + span/2);
      // ensure min<max
      if(sweep.max - sweep.min < 4){
        sweep.min = Math.max(2, epsr - 2);
        sweep.max = Math.min(20, epsr + 2);
      }
      renderAll();
    });

    // Smooth scrolling for TOC (in-page)
    document.querySelectorAll('nav.toc a[href^="#"]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        const id = a.getAttribute('href');
        const target = document.querySelector(id);
        if(!target) return;
        e.preventDefault();
        target.scrollIntoView({behavior:'smooth', block:'start'});
        history.replaceState(null, "", id);
      });
    });

    // Resize handler
    let rAF = null;
    window.addEventListener('resize', ()=>{
      if(rAF) cancelAnimationFrame(rAF);
      rAF = requestAnimationFrame(()=>renderAll());
    });

    // Init
    setupCopyButtons();
    updateLabels();
    populateTable("Si");
    renderAll();
  </script>
</body>
</html>
