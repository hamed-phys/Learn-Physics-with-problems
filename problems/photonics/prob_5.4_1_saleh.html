<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Electric Field of Focused Light (Uniform Spot & Gaussian Beam)</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#101827;
      --card2:#0f172a;
      --text:#e6edf7;
      --muted:#a8b3c7;
      --line:rgba(255,255,255,.10);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --radius: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(125,211,252,.14), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(167,139,250,.12), transparent 55%),
        linear-gradient(180deg, #070a10 0%, var(--bg) 55%, #070a10 100%);
      line-height:1.55;
    }

    header{
      padding:28px 18px 18px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:0 14px 60px;
    }

    .title-row{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size: clamp(1.35rem, 2.4vw, 2.1rem);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:8px 0 0;
      color:var(--muted);
      max-width:70ch;
    }

    .grid{
      display:grid;
      grid-template-columns: 310px 1fr;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    nav.toc{
      position:sticky;
      top:12px;
      align-self:start;
      background: rgba(16,24,39,.75);
      backdrop-filter: blur(10px);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px 14px 10px;
      box-shadow: var(--shadow);
    }

    nav.toc h2{
      font-size: .95rem;
      margin:0 0 8px;
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .toc a{
      display:block;
      padding:8px 10px;
      margin:4px 0;
      text-decoration:none;
      color:var(--muted);
      border-radius:12px;
      border:1px solid transparent;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:.92rem;
    }
    .toc a:hover{
      background: rgba(125,211,252,.08);
      border-color: rgba(125,211,252,.20);
      color:var(--text);
      transform: translateY(-1px);
    }

    main{padding-top:16px}

    section{
      background: rgba(16,24,39,.70);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px 16px;
      box-shadow: var(--shadow);
    }

    section + section{margin-top:16px}

    h2{
      margin:0 0 10px;
      font-size:1.15rem;
      letter-spacing:.2px;
    }
    h3{
      margin:14px 0 8px;
      font-size:1.02rem;
      color: var(--text);
    }

    .quick{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .quick{grid-template-columns:1fr}
    }

    .card{
      background: rgba(15,23,42,.72);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
    }

    ul{margin:8px 0 0 18px; color:var(--muted)}
    li{margin:6px 0}

    .eq{
      font-family:var(--mono);
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:12px 12px 10px;
      overflow:auto;
      position:relative;
    }
    .eq code{white-space:pre; color:#f1f6ff}

    .copy-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      align-items:center;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:9px 11px;
      border-radius:14px;
      cursor:pointer;
      font-weight:600;
      font-size:.92rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .btn:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.25);
      transform: translateY(-1px);
    }
    .btn:active{transform: translateY(0px) scale(.99)}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size:.88rem;
    }
    .badge b{color:var(--text)}

    .callout{
      border-left:4px solid rgba(125,211,252,.55);
      background: rgba(125,211,252,.07);
      padding:12px 12px 12px 12px;
      border-radius: 14px;
      color: var(--muted);
    }

    .result{
      border:1px solid rgba(52,211,153,.28);
      background: rgba(52,211,153,.08);
      border-radius: 16px;
      padding:14px;
      margin-top:12px;
    }
    .result h3{margin-top:0}
    .box{
      border:1px dashed rgba(255,255,255,.22);
      border-radius:14px;
      padding:10px 12px;
      background: rgba(0,0,0,.22);
      font-family:var(--mono);
      overflow:auto;
    }

    .two-col{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width: 900px){
      .two-col{grid-template-columns:1fr}
    }

    .viz{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    @media (max-width: 980px){
      .viz{grid-template-columns:1fr}
    }

    figure{
      margin:0;
      background: rgba(15,23,42,.65);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:12px;
      overflow:hidden;
    }
    figcaption{
      margin-top:10px;
      color:var(--muted);
      font-size:.92rem;
    }

    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius: 14px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
    }

    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin:10px 0 0;
    }
    @media (max-width: 980px){
      .controls{grid-template-columns:1fr}
    }

    .control{
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px 10px 8px;
    }
    .control label{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      font-size:.92rem;
      color:var(--muted);
    }
    .control label span strong{color:var(--text)}
    input[type="range"]{width:100%}
    .small{
      color:var(--muted);
      font-size:.9rem;
      margin-top:6px;
    }

    .hr{
      height:1px;
      background: var(--line);
      margin:12px 0;
    }

    footer{
      margin-top:18px;
      color: var(--muted);
      font-size:.9rem;
      text-align:center;
      padding:18px 10px 30px;
      opacity:.92;
    }

    /* Print-friendly */
    @media print{
      body{background:white;color:black}
      header, nav.toc, .btn, .controls{display:none !important}
      section, figure, .card{box-shadow:none; background:white; border-color:#ccc}
      canvas{border-color:#ddd}
      .eq, .box{background:#f7f7f7; border-color:#ddd}
      .result{background:#f1fff7; border-color:#9ae6b4}
      .callout{background:#eef9ff; border-color:#90cdf4}
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="title-row">
        <div>
          <h1>Electric Field of Focused Light: Uniform Spot vs. Gaussian Beam</h1>
          <p class="subtitle">
            We relate optical power to intensity, then intensity to the peak electric field amplitude in free space.
            Part (a) treats the focused light as a uniform TEM plane wave over a square target; part (b) uses the
            Gaussian-beam on-axis intensity at the waist.
          </p>
        </div>
        <div class="badge" title="Constants used throughout (free space)">
          <span>Assume:</span>
          <b>vacuum</b>
          <span>·</span>
          <span>time-average intensity</span>
        </div>
      </div>

      <div class="quick">
        <div class="card">
          <h2 id="quick">Quick Summary</h2>
          <ul>
            <li>Uniform spot intensity: <span class="eq-inline" style="font-family:var(--mono);color:#f1f6ff">I = P/A</span>.</li>
            <li>Plane wave in free space: <span style="font-family:var(--mono);color:#f1f6ff">I = (1/2) c ε0 E0²</span> (with <span style="font-family:var(--mono);color:#f1f6ff">E0</span> = peak field).</li>
            <li><b>Part (a):</b> <span style="font-family:var(--mono);color:#f1f6ff">E0 = √(2P/(A c ε0))</span>. For <span style="font-family:var(--mono);color:#f1f6ff">P=1 W</span>, <span style="font-family:var(--mono);color:#f1f6ff">A=(0.1 mm)²</span> ⇒ <b id="E0aQuick">≈ 2.74×10⁵ V/m</b>.</li>
            <li><b>Part (b):</b> Gaussian waist on-axis intensity: <span style="font-family:var(--mono);color:#f1f6ff">I(0)=2P/(π w0²)</span>.</li>
            <li>So <span style="font-family:var(--mono);color:#f1f6ff">E0,center = √(4P/(π w0² c ε0))</span>. For <span style="font-family:var(--mono);color:#f1f6ff">w0=0.1 mm</span> ⇒ <b id="E0bQuick">≈ 2.19×10⁵ V/m</b>.</li>
          </ul>
        </div>

        <div class="card">
          <h2>What you’ll get here</h2>
          <ul>
            <li>A clean roadmap before the algebra.</li>
            <li>Step-by-step derivations with units and checks.</li>
            <li>Interactive diagrams + plots where you can change <span style="font-family:var(--mono);color:#f1f6ff">P</span>, spot size, and <span style="font-family:var(--mono);color:#f1f6ff">w0</span>.</li>
            <li>Copy buttons for key equations and final answers.</li>
          </ul>
          <div class="hr"></div>
          <div class="copy-row">
            <button class="btn" id="copyAllAnswers">Copy final numeric answers</button>
            <span class="badge" id="copyStatus">Ready</span>
          </div>
        </div>
      </div>

      <div class="grid">
        <nav class="toc" aria-label="Table of contents">
          <h2>
            <span>Contents</span>
            <span class="badge" style="padding:5px 10px;">sticky</span>
          </h2>
          <a href="#part1">PART 1 — Problem Analysis</a>
          <a href="#part2">PART 2 — Strategy & Tips</a>
          <a href="#part3">PART 3 — Full Solution</a>
          <a href="#viz">Interactive Visualizations</a>
          <a href="#final">Final Results</a>
        </nav>

        <main>
          <section id="part1">
            <h2>PART 1 — Problem Analysis (no solving yet)</h2>

            <h3>1) Restate the problem (in my own words)</h3>
            <p style="color:var(--muted); margin:0;">
              (a) A beam of optical power <span style="font-family:var(--mono);color:#f1f6ff">P = 1 W</span> is focused uniformly onto a square target in free space with size
              <span style="font-family:var(--mono);color:#f1f6ff">0.1 mm × 0.1 mm</span>. Treat the light over that area as a TEM plane wave with uniform intensity.
              Find the <em>peak</em> electric-field amplitude <span style="font-family:var(--mono);color:#f1f6ff">E0</span> (V/m).
              <br/><br/>
              (b) For a Gaussian beam of power <span style="font-family:var(--mono);color:#f1f6ff">P = 1 W</span> and waist radius <span style="font-family:var(--mono);color:#f1f6ff">w0 = 0.1 mm</span>, find the electric field at the beam center (on-axis at the waist).
            </p>

            <div class="two-col" style="margin-top:12px;">
              <div class="card">
                <h3>Given quantities</h3>
                <ul>
                  <li>Free space (vacuum): <span style="font-family:var(--mono);color:#f1f6ff">ε0</span>, <span style="font-family:var(--mono);color:#f1f6ff">c</span></li>
                  <li>Power: <span style="font-family:var(--mono);color:#f1f6ff">P = 1 W</span></li>
                  <li>(a) Target size: <span style="font-family:var(--mono);color:#f1f6ff">0.1 mm × 0.1 mm</span></li>
                  <li>(b) Waist radius: <span style="font-family:var(--mono);color:#f1f6ff">w0 = 0.1 mm</span></li>
                </ul>
              </div>
              <div class="card">
                <h3>Unknowns / what must be found</h3>
                <ul>
                  <li>(a) Peak electric field amplitude <span style="font-family:var(--mono);color:#f1f6ff">E0</span> for a uniform plane wave over area <span style="font-family:var(--mono);color:#f1f6ff">A</span>.</li>
                  <li>(b) Peak electric field amplitude <span style="font-family:var(--mono);color:#f1f6ff">E0</span> at the Gaussian beam center (r=0, z=0).</li>
                </ul>
                <div class="callout" style="margin-top:10px;">
                  Key idea: <b>Power → intensity</b>, then <b>intensity → field amplitude</b>.
                </div>
              </div>
            </div>

            <h3>2) Relevant physical principles (and why they apply)</h3>
            <ul>
              <li><b>Intensity definition:</b> average power per area. For uniform illumination, <span style="font-family:var(--mono);color:#f1f6ff">I = P/A</span>. This applies because the problem states the power is focused uniformly onto a flat target.</li>
              <li><b>Plane-wave energy flow (Poynting vector):</b> for a TEM plane wave in vacuum,
                the time-averaged intensity is <span style="font-family:var(--mono);color:#f1f6ff">I = ⟨S⟩ = (1/2) c ε0 E0²</span>.
                This links an electromagnetic wave’s field amplitude to its delivered power density.</li>
              <li><b>Gaussian beam intensity profile at the waist:</b> at <span style="font-family:var(--mono);color:#f1f6ff">z=0</span>,
                <span style="font-family:var(--mono);color:#f1f6ff">I(r)= I0 exp(-2r²/w0²)</span> and total power fixes
                <span style="font-family:var(--mono);color:#f1f6ff">I0 = 2P/(π w0²)</span>.
                This applies because the problem explicitly specifies a Gaussian beam and asks for the on-axis field at the waist.</li>
            </ul>

            <h3>3) Possible approaches (compare briefly)</h3>
            <ul>
              <li><b>Approach A (best):</b> Use <span style="font-family:var(--mono);color:#f1f6ff">I</span> and the plane-wave relation <span style="font-family:var(--mono);color:#f1f6ff">I=(1/2)cε0E0²</span>. Fast, direct, and exactly what the prompt hints (TEM plane wave).</li>
              <li><b>Approach B:</b> Start from Maxwell’s plane-wave relation <span style="font-family:var(--mono);color:#f1f6ff">B0=E0/c</span> and compute <span style="font-family:var(--mono);color:#f1f6ff">⟨S⟩ = ⟨(1/μ0) E×B⟩</span>. Equivalent, slightly longer.</li>
              <li><b>Approach C:</b> For Gaussian beam, integrate the radial intensity to get power, then link intensity to field. This is needed for (b), and reduces to Approach A once <span style="font-family:var(--mono);color:#f1f6ff">I0</span> is known.</li>
            </ul>

            <div class="result">
              <h3>Chosen approach</h3>
              <p style="margin:0;color:var(--muted);">
                Use <b>power-to-intensity</b> plus the <b>plane-wave intensity–field</b> relation. It matches the assumptions and yields clean symbolic formulas that are easy to sanity-check.
              </p>
            </div>
          </section>

          <section id="part2">
            <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

            <h3>Minimal step-by-step plan</h3>
            <ol style="margin:8px 0 0 20px; color:var(--muted);">
              <li><b>Convert geometry to area</b> — goal: compute illuminated area <span style="font-family:var(--mono);color:#f1f6ff">A</span>. Tool: unit conversion (mm → m) and <span style="font-family:var(--mono);color:#f1f6ff">A = L×L</span>.</li>
              <li><b>Compute intensity (uniform case)</b> — goal: get <span style="font-family:var(--mono);color:#f1f6ff">I</span>. Tool: <span style="font-family:var(--mono);color:#f1f6ff">I=P/A</span>.</li>
              <li><b>Relate intensity to peak field</b> — goal: solve for <span style="font-family:var(--mono);color:#f1f6ff">E0</span>. Tool: <span style="font-family:var(--mono);color:#f1f6ff">I=(1/2)cε0E0²</span>.</li>
              <li><b>Gaussian on-axis intensity</b> — goal: find <span style="font-family:var(--mono);color:#f1f6ff">I0=I(r=0)</span>. Tool: integrate Gaussian profile to match total power: <span style="font-family:var(--mono);color:#f1f6ff">I0=2P/(πw0²)</span>.</li>
              <li><b>Convert Gaussian on-axis intensity to field</b> — goal: get <span style="font-family:var(--mono);color:#f1f6ff">E0,center</span>. Tool: same plane-wave relation.</li>
              <li><b>Sanity checks</b> — goal: confirm units, scaling with area/waist, plausibility vs. typical optical fields.</li>
            </ol>

            <h3>Common mistakes & quick tips</h3>
            <ul>
              <li><b>Mixing peak vs RMS:</b> The relation <span style="font-family:var(--mono);color:#f1f6ff">I=(1/2)cε0E0²</span> uses <b>peak</b> amplitude <span style="font-family:var(--mono);color:#f1f6ff">E0</span> (not RMS). If you use RMS, the factor changes.</li>
              <li><b>Forgetting mm → m:</b> <span style="font-family:var(--mono);color:#f1f6ff">0.1 mm = 1×10⁻⁴ m</span>, so areas become <span style="font-family:var(--mono);color:#f1f6ff">~10⁻⁸ m²</span>.</li>
              <li><b>Gaussian waist definition:</b> <span style="font-family:var(--mono);color:#f1f6ff">w0</span> is the <b>1/e² intensity radius</b>. The on-axis intensity uses <span style="font-family:var(--mono);color:#f1f6ff">I0=2P/(πw0²)</span>.</li>
              <li><b>Uniform vs Gaussian “same size”:</b> a square side and a Gaussian waist are different size concepts; compare via intensity formulas, not by eyeballing.</li>
            </ul>

            <div class="copy-row">
              <button class="btn" data-copy="I = (1/2) c ε0 E0^2  =>  E0 = sqrt(2I/(c ε0))">Copy key relation: I ↔ E0</button>
              <button class="btn" data-copy="Gaussian waist: I(r) = I0 exp(-2r^2/w0^2),  I0 = 2P/(π w0^2)">Copy Gaussian intensity</button>
            </div>
          </section>

          <section id="part3">
            <h2>PART 3 — Full Solution</h2>

            <h3>Physical intuition (before equations)</h3>
            <p style="color:var(--muted); margin:0;">
              Concentrating the same optical power into a smaller area raises the intensity (power per area).
              In electromagnetic waves, higher intensity means larger electric and magnetic field amplitudes.
              Therefore, <span style="font-family:var(--mono);color:#f1f6ff">E0</span> must scale like the square root of intensity, and thus like
              <span style="font-family:var(--mono);color:#f1f6ff">1/√A</span> (uniform spot) or <span style="font-family:var(--mono);color:#f1f6ff">1/w0</span> (Gaussian center).
            </p>

            <div class="hr"></div>

            <h3>Constants (vacuum)</h3>
            <div class="eq">
              <code>c  = 2.99792458×10^8  m/s
ε0 = 8.854187817×10^-12 F/m</code>
            </div>

            <h3>(a) Uniformly focused power on a square target</h3>
            <p style="color:var(--muted); margin:0 0 8px;">
              The target is a square of side <span style="font-family:var(--mono);color:#f1f6ff">L = 0.1 mm</span>.
              First convert to meters and compute area.
            </p>

            <div class="eq">
              <code>Given: L = 0.1 mm = 0.1×10^-3 m = 1.0×10^-4 m
Area:  A = L^2 = (1.0×10^-4 m)^2 = 1.0×10^-8 m^2</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              Uniform intensity on the target:
            </p>
            <div class="eq">
              <code>I = P/A</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              For a TEM plane wave in vacuum, the time-averaged intensity (magnitude of the average Poynting vector) is
            </p>
            <div class="eq">
              <code>I = ⟨S⟩ = (1/2) c ε0 E0^2</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              Solve for the peak field amplitude <span style="font-family:var(--mono);color:#f1f6ff">E0</span>:
            </p>
            <div class="eq">
              <code>(1/2) c ε0 E0^2 = P/A
E0^2 = (2P)/(A c ε0)
E0 = √(2P/(A c ε0))</code>
            </div>

            <div class="result" id="resA">
              <h3>Result (a)</h3>
              <div class="box" id="boxA">E0(a) = √(2P/(A c ε0))</div>
              <div class="hr"></div>
              <div class="box" id="boxA_num">For P=1 W, A=1.0×10^-8 m^2:
I = 1.0×10^8 W/m^2
E0(a) ≈ 2.7449×10^5 V/m</div>
              <div class="copy-row">
                <button class="btn" data-copy="E0(a) = sqrt(2P/(A c ε0))">Copy symbolic (a)</button>
                <button class="btn" id="copyA_num">Copy numeric (a)</button>
              </div>
            </div>

            <h3>(b) Electric field at the center of a Gaussian beam at the waist</h3>
            <p style="color:var(--muted); margin:0 0 8px;">
              At the waist <span style="font-family:var(--mono);color:#f1f6ff">z=0</span>, the Gaussian intensity profile is
            </p>
            <div class="eq">
              <code>I(r) = I0 exp(-2r^2/w0^2)</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              Total power is the area integral of intensity:
            </p>
            <div class="eq">
              <code>P = ∫∫ I(r) dA
  = ∫_0^{2π} ∫_0^{∞} I0 exp(-2r^2/w0^2) (r dr dθ)</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              Evaluate the integral (do it step-by-step):
            </p>
            <div class="eq">
              <code>P = 2π I0 ∫_0^{∞} r exp(-2r^2/w0^2) dr

Let u = 2r^2/w0^2  =>  du = (4r/w0^2) dr  =>  r dr = (w0^2/4) du

So:
∫_0^{∞} r exp(-2r^2/w0^2) dr
= (w0^2/4) ∫_0^{∞} e^{-u} du
= (w0^2/4) [1]
= w0^2/4</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              Therefore:
            </p>
            <div class="eq">
              <code>P = 2π I0 (w0^2/4) = (π w0^2/2) I0
=> I0 = 2P/(π w0^2)</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              At the center (on-axis), <span style="font-family:var(--mono);color:#f1f6ff">r=0</span>, the intensity equals <span style="font-family:var(--mono);color:#f1f6ff">I0</span>.
              Link it to the peak electric field using the same free-space plane-wave relation:
            </p>
            <div class="eq">
              <code>I0 = (1/2) c ε0 E0,center^2
E0,center = √(2 I0/(c ε0))</code>
            </div>

            <p style="color:var(--muted); margin:10px 0 8px;">
              Substitute <span style="font-family:var(--mono);color:#f1f6ff">I0 = 2P/(π w0²)</span>:
            </p>
            <div class="eq">
              <code>E0,center = √( 2*(2P/(π w0^2)) / (c ε0) )
= √( 4P / (π w0^2 c ε0) )</code>
            </div>

            <div class="result" id="resB">
              <h3>Result (b)</h3>
              <div class="box" id="boxB">E0(center) = √(4P/(π w0^2 c ε0))</div>
              <div class="hr"></div>
              <div class="box" id="boxB_num">For P=1 W, w0=0.1 mm = 1.0×10^-4 m:
I0 = 6.3662×10^7 W/m^2
E0(center) ≈ 2.1901×10^5 V/m</div>
              <div class="copy-row">
                <button class="btn" data-copy="E0(center) = sqrt(4P/(π w0^2 c ε0))">Copy symbolic (b)</button>
                <button class="btn" id="copyB_num">Copy numeric (b)</button>
              </div>
            </div>

            <h3>Sanity checks</h3>
            <div class="two-col">
              <div class="card">
                <h3 style="margin-top:0;">Units</h3>
                <ul>
                  <li><span style="font-family:var(--mono);color:#f1f6ff">I</span> has units W/m².</li>
                  <li><span style="font-family:var(--mono);color:#f1f6ff">c ε0</span> has units (m/s)·(F/m) = F/s = C/(V·s).</li>
                  <li><span style="font-family:var(--mono);color:#f1f6ff">I/(c ε0)</span> reduces to V²/m², so <span style="font-family:var(--mono);color:#f1f6ff">E0</span> is V/m. ✅</li>
                </ul>
              </div>
              <div class="card">
                <h3 style="margin-top:0;">Scaling & limits</h3>
                <ul>
                  <li>Uniform spot: <span style="font-family:var(--mono);color:#f1f6ff">E0 ∝ 1/√A</span>. Halve the linear size → area /4 → <span style="font-family:var(--mono);color:#f1f6ff">E0</span> doubles.</li>
                  <li>Gaussian center: <span style="font-family:var(--mono);color:#f1f6ff">E0 ∝ 1/w0</span>. Tighter focus (smaller <span style="font-family:var(--mono);color:#f1f6ff">w0</span>) gives a larger on-axis field.</li>
                  <li>Both: <span style="font-family:var(--mono);color:#f1f6ff">E0 ∝ √P</span>. Four times power doubles <span style="font-family:var(--mono);color:#f1f6ff">E0</span>.</li>
                </ul>
              </div>
            </div>
          </section>

          <section id="viz">
            <h2>Interactive Visualizations</h2>
            <p style="margin:0;color:var(--muted);">
              Use the sliders to change optical power <span style="font-family:var(--mono);color:#f1f6ff">P</span>,
              uniform square side <span style="font-family:var(--mono);color:#f1f6ff">L</span>, and Gaussian waist radius <span style="font-family:var(--mono);color:#f1f6ff">w0</span>.
              All plots and the diagram update live and use the <b>same formulas</b> as the solution.
            </p>

            <div class="controls" aria-label="Interactive controls">
              <div class="control">
                <label for="pwr">
                  <span>Power <strong>P</strong></span>
                  <span class="badge"><b id="pwrVal">1.00</b>&nbsp;W</span>
                </label>
                <input id="pwr" type="range" min="0.10" max="5.00" step="0.01" value="1.00"/>
                <div class="small">Affects both cases: <span style="font-family:var(--mono);color:#f1f6ff">E0 ∝ √P</span>.</div>
              </div>

              <div class="control">
                <label for="side">
                  <span>Uniform square side <strong>L</strong></span>
                  <span class="badge"><b id="sideVal">0.10</b>&nbsp;mm</span>
                </label>
                <input id="side" type="range" min="0.02" max="0.20" step="0.001" value="0.10"/>
                <div class="small">Uniform area: <span style="font-family:var(--mono);color:#f1f6ff">A=L²</span>.</div>
              </div>

              <div class="control">
                <label for="w0">
                  <span>Gaussian waist radius <strong>w0</strong></span>
                  <span class="badge"><b id="w0Val">0.10</b>&nbsp;mm</span>
                </label>
                <input id="w0" type="range" min="0.02" max="0.20" step="0.001" value="0.10"/>
                <div class="small">On-axis intensity: <span style="font-family:var(--mono);color:#f1f6ff">I0=2P/(πw0²)</span>.</div>
              </div>
            </div>

            <div class="viz">
              <figure>
                <canvas id="diag" aria-label="Diagram canvas"></canvas>
                <figcaption>
                  <b>Diagram:</b> Focused beam onto a square target (uniform case) and Gaussian waist (Gaussian case).
                  Labels show current values of <span style="font-family:var(--mono);color:#f1f6ff">P</span>, <span style="font-family:var(--mono);color:#f1f6ff">L</span>, and <span style="font-family:var(--mono);color:#f1f6ff">w0</span>.
                </figcaption>
              </figure>

              <figure>
                <canvas id="plot1" aria-label="Main plot canvas"></canvas>
                <figcaption>
                  <b>Main plot:</b> Peak electric field vs characteristic size.
                  <span style="font-family:var(--mono);color:#f1f6ff">r_eq = √(A/π)</span> for the uniform square (equal-area disk),
                  and <span style="font-family:var(--mono);color:#f1f6ff">w0</span> for the Gaussian center field.
                </figcaption>
              </figure>

              <figure style="grid-column: 1 / -1;">
                <canvas id="plot2" aria-label="Secondary plot canvas"></canvas>
                <figcaption>
                  <b>Secondary plot:</b> Intensity profile vs radius.
                  Gaussian: <span style="font-family:var(--mono);color:#f1f6ff">I(r)=I0 exp(-2r²/w0²)</span>.
                  Uniform: a flat intensity inside the equal-area radius <span style="font-family:var(--mono);color:#f1f6ff">r_eq</span> (shown for comparison).
                </figcaption>
              </figure>
            </div>
          </section>

          <section id="final">
            <h2>Final Results (boxed)</h2>

            <div class="two-col">
              <div class="result">
                <h3 style="margin-top:0;">(a) Uniform over 0.1 mm × 0.1 mm</h3>
                <div class="box">E0(a) = √(2P/(A c ε0)),  with A = L^2</div>
                <div class="hr"></div>
                <div class="box" id="finalA">For P=1 W, L=0.1 mm:
A = 1.0×10^-8 m^2
E0(a) ≈ 2.7449×10^5 V/m</div>
              </div>

              <div class="result">
                <h3 style="margin-top:0;">(b) Gaussian beam center at waist</h3>
                <div class="box">E0(center) = √(4P/(π w0^2 c ε0))</div>
                <div class="hr"></div>
                <div class="box" id="finalB">For P=1 W, w0=0.1 mm:
E0(center) ≈ 2.1901×10^5 V/m</div>
              </div>
            </div>

            <div class="copy-row" style="margin-top:12px;">
              <button class="btn" id="copyFinalA">Copy final (a)</button>
              <button class="btn" id="copyFinalB">Copy final (b)</button>
              <button class="btn" id="copyFinalBoth">Copy both</button>
              <span class="badge" id="finalStatus">Copied text will be plain</span>
            </div>
          </section>

          <footer>
            Built with vanilla HTML/CSS/JS. Uses free-space relations between time-averaged intensity and peak electric field.
          </footer>
        </main>
      </div>
    </div>
  </header>

  <script>
    (function(){
      // ---------- Constants ----------
      const c = 2.99792458e8;            // m/s
      const eps0 = 8.854187817e-12;      // F/m
      const PI = Math.PI;

      // ---------- Helpers ----------
      const fmt = {
        fixed(x, n=2){ return Number(x).toFixed(n); },
        sci(x, sig=4){
          if (!isFinite(x)) return String(x);
          if (x === 0) return "0";
          const exp = Math.floor(Math.log10(Math.abs(x)));
          const mant = x / Math.pow(10, exp);
          return `${mant.toFixed(sig-1)}×10^${exp}`;
        }
      };

      function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }

      async function copyText(text){
        try{
          await navigator.clipboard.writeText(text);
          return true;
        }catch(e){
          // Fallback
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try{
            document.execCommand("copy");
            document.body.removeChild(ta);
            return true;
          }catch(err){
            document.body.removeChild(ta);
            return false;
          }
        }
      }

      function setStatus(el, msg, ok=true){
        el.innerHTML = ok ? `✔ ${msg}` : `⚠ ${msg}`;
        el.style.borderColor = ok ? "rgba(52,211,153,.28)" : "rgba(251,191,36,.35)";
        el.style.background = ok ? "rgba(52,211,153,.08)" : "rgba(251,191,36,.10)";
        el.style.color = ok ? "rgba(230,255,245,.92)" : "rgba(255,240,210,.92)";
        clearTimeout(setStatus._t);
        setStatus._t = setTimeout(()=>{
          el.innerHTML = "Ready";
          el.style.borderColor = "rgba(255,255,255,.14)";
          el.style.background = "rgba(255,255,255,.06)";
          el.style.color = "var(--muted)";
        }, 1600);
      }

      // ---------- Physics core ----------
      function uniformAreaFromSide_mm(Lmm){
        const L = Lmm * 1e-3; // mm -> m
        return L * L;
      }

      function uniformIntensity(P, A){
        return P / A;
      }

      function E0_from_I(I){
        // I = (1/2) c eps0 E0^2
        return Math.sqrt(2 * I / (c * eps0));
      }

      function gaussianI0(P, w0_m){
        return 2 * P / (PI * w0_m * w0_m);
      }

      function gaussianIntensity(P, w0_m, r_m){
        return gaussianI0(P, w0_m) * Math.exp(-2 * (r_m*r_m) / (w0_m*w0_m));
      }

      function gaussianE0center(P, w0_m){
        // E0 = sqrt(4P/(pi w0^2 c eps0))
        return Math.sqrt(4 * P / (PI * w0_m * w0_m * c * eps0));
      }

      function equivalentRadiusFromArea(A){
        // A = pi r_eq^2
        return Math.sqrt(A / PI);
      }

      // ---------- DOM ----------
      const elP = document.getElementById("pwr");
      const elL = document.getElementById("side");
      const elW = document.getElementById("w0");
      const pwrVal = document.getElementById("pwrVal");
      const sideVal = document.getElementById("sideVal");
      const w0Val = document.getElementById("w0Val");

      const E0aQuick = document.getElementById("E0aQuick");
      const E0bQuick = document.getElementById("E0bQuick");

      const boxA_num = document.getElementById("boxA_num");
      const boxB_num = document.getElementById("boxB_num");
      const finalA = document.getElementById("finalA");
      const finalB = document.getElementById("finalB");

      const copyStatus = document.getElementById("copyStatus");
      const finalStatus = document.getElementById("finalStatus");

      // Copy buttons (generic)
      document.querySelectorAll("[data-copy]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const text = btn.getAttribute("data-copy") || "";
          const ok = await copyText(text);
          setStatus(copyStatus, ok ? "Copied" : "Copy failed", ok);
        });
      });

      // ---------- Canvases ----------
      const canvDiag = document.getElementById("diag");
      const canvP1 = document.getElementById("plot1");
      const canvP2 = document.getElementById("plot2");

      function setupCanvas(canvas){
        const ctx = canvas.getContext("2d");
        function resize(){
          const dpr = window.devicePixelRatio || 1;
          const rect = canvas.getBoundingClientRect();
          canvas.width = Math.max(1, Math.floor(rect.width * dpr));
          canvas.height = Math.max(1, Math.floor(rect.height * dpr));
          ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
        }
        return { ctx, resize };
      }

      const diag = setupCanvas(canvDiag);
      const p1 = setupCanvas(canvP1);
      const p2 = setupCanvas(canvP2);

      // ---------- Plotting primitives ----------
      function clear(ctx, w, h){
        ctx.clearRect(0,0,w,h);
        // subtle background
        ctx.fillStyle = "rgba(0,0,0,0.20)";
        ctx.fillRect(0,0,w,h);
      }

      function drawGridAxes(ctx, W, H, opts){
        const pad = opts.pad || {l:52,r:18,t:34,b:46};
        const xMin = opts.xMin, xMax = opts.xMax, yMin = opts.yMin, yMax = opts.yMax;
        const xLabel = opts.xLabel || "", yLabel = opts.yLabel || "", title = opts.title || "";
        const xTicks = opts.xTicks || 6, yTicks = opts.yTicks || 6;

        // Frame
        ctx.save();
        ctx.strokeStyle = "rgba(255,255,255,0.14)";
        ctx.lineWidth = 1;
        ctx.strokeRect(pad.l, pad.t, W - pad.l - pad.r, H - pad.t - pad.b);

        // Title
        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.font = "600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(title, pad.l, 20);

        // Grid + ticks
        ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillStyle = "rgba(168,179,199,0.95)";
        ctx.strokeStyle = "rgba(255,255,255,0.08)";
        ctx.lineWidth = 1;

        const plotW = W - pad.l - pad.r;
        const plotH = H - pad.t - pad.b;

        function xToPx(x){ return pad.l + (x - xMin) * plotW / (xMax - xMin); }
        function yToPx(y){ return pad.t + plotH - (y - yMin) * plotH / (yMax - yMin); }

        // x grid
        for(let i=0;i<=xTicks;i++){
          const x = xMin + (xMax - xMin) * i / xTicks;
          const px = xToPx(x);
          ctx.beginPath();
          ctx.moveTo(px, pad.t);
          ctx.lineTo(px, pad.t + plotH);
          ctx.stroke();

          ctx.fillText(opts.xTickFmt ? opts.xTickFmt(x) : x.toFixed(2), px - 10, pad.t + plotH + 18);
          // tick mark
          ctx.strokeStyle = "rgba(255,255,255,0.14)";
          ctx.beginPath();
          ctx.moveTo(px, pad.t + plotH);
          ctx.lineTo(px, pad.t + plotH + 5);
          ctx.stroke();
          ctx.strokeStyle = "rgba(255,255,255,0.08)";
        }

        // y grid
        for(let i=0;i<=yTicks;i++){
          const y = yMin + (yMax - yMin) * i / yTicks;
          const py = yToPx(y);
          ctx.beginPath();
          ctx.moveTo(pad.l, py);
          ctx.lineTo(pad.l + plotW, py);
          ctx.stroke();

          ctx.fillText(opts.yTickFmt ? opts.yTickFmt(y) : y.toFixed(2), 8, py + 4);
          ctx.strokeStyle = "rgba(255,255,255,0.14)";
          ctx.beginPath();
          ctx.moveTo(pad.l - 5, py);
          ctx.lineTo(pad.l, py);
          ctx.stroke();
          ctx.strokeStyle = "rgba(255,255,255,0.08)";
        }

        // axis labels
        ctx.fillStyle = "rgba(230,237,247,0.90)";
        ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(xLabel, pad.l + plotW/2 - ctx.measureText(xLabel).width/2, H - 12);

        ctx.save();
        ctx.translate(14, pad.t + plotH/2);
        ctx.rotate(-Math.PI/2);
        ctx.fillText(yLabel, -ctx.measureText(yLabel).width/2, 0);
        ctx.restore();

        ctx.restore();
        return { pad, xToPx, yToPx, plotW, plotH };
      }

      function drawLine(ctx, pts, strokeStyle, width=2){
        ctx.save();
        ctx.strokeStyle = strokeStyle;
        ctx.lineWidth = width;
        ctx.beginPath();
        for(let i=0;i<pts.length;i++){
          const p = pts[i];
          if(i===0) ctx.moveTo(p.x,p.y);
          else ctx.lineTo(p.x,p.y);
        }
        ctx.stroke();
        ctx.restore();
      }

      function drawLegend(ctx, items, x, y){
        ctx.save();
        ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.strokeStyle = "rgba(255,255,255,0.12)";
        ctx.lineWidth = 1;
        const pad = 10;
        const rowH = 18;
        const w = 260;
        const h = pad*2 + items.length*rowH;
        ctx.fillStyle = "rgba(0,0,0,0.35)";
        ctx.fillRect(x, y, w, h);
        ctx.strokeRect(x, y, w, h);

        for(let i=0;i<items.length;i++){
          const iy = y + pad + i*rowH + 6;
          // line sample
          ctx.strokeStyle = items[i].color;
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(x+12, iy);
          ctx.lineTo(x+42, iy);
          ctx.stroke();

          ctx.fillStyle = "rgba(230,237,247,0.92)";
          ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
          ctx.fillText(items[i].label, x+52, iy+4);
        }
        ctx.restore();
      }

      function drawMarker(ctx, x, y, color="rgba(125,211,252,0.9)", label=null){
        ctx.save();
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x,y,4.2,0,2*Math.PI);
        ctx.fill();
        ctx.strokeStyle = "rgba(0,0,0,0.4)";
        ctx.lineWidth = 1;
        ctx.stroke();

        if(label){
          ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
          ctx.fillStyle = "rgba(230,237,247,0.92)";
          ctx.fillText(label, x+8, y-8);
        }
        ctx.restore();
      }

      // ---------- Renderers ----------
      function drawDiagram(state){
        const ctx = diag.ctx;
        const rect = canvDiag.getBoundingClientRect();
        const W = rect.width, H = rect.height;
        clear(ctx, W, H);

        // Layout
        const midX = W * 0.50;
        const topY = 34;

        // Titles
        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.font = "700 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText("Setup Diagram", 14, 22);

        ctx.fillStyle = "rgba(168,179,199,0.95)";
        ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText("Uniform spot on square target (left) and Gaussian waist (right)", 14, 40);

        // Left: uniform spot onto square
        const leftX0 = 20;
        const leftW = midX - 30;
        const boxY = 70;
        const boxH = H - 110;

        // Beam arrow
        ctx.strokeStyle = "rgba(125,211,252,0.70)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(leftX0 + leftW*0.15, boxY + 20);
        ctx.lineTo(leftX0 + leftW*0.15, boxY + boxH*0.55);
        ctx.stroke();
        // arrow head
        ctx.beginPath();
        ctx.moveTo(leftX0 + leftW*0.15, boxY + boxH*0.55);
        ctx.lineTo(leftX0 + leftW*0.15 - 8, boxY + boxH*0.55 - 12);
        ctx.lineTo(leftX0 + leftW*0.15 + 8, boxY + boxH*0.55 - 12);
        ctx.closePath();
        ctx.fillStyle = "rgba(125,211,252,0.70)";
        ctx.fill();

        // Target square
        const sqSize = clamp(leftW*0.35, 70, 120);
        const sqX = leftX0 + leftW*0.40;
        const sqY = boxY + boxH*0.55 - sqSize/2;

        ctx.fillStyle = "rgba(255,255,255,0.06)";
        ctx.strokeStyle = "rgba(255,255,255,0.18)";
        ctx.lineWidth = 1.5;
        ctx.fillRect(sqX, sqY, sqSize, sqSize);
        ctx.strokeRect(sqX, sqY, sqSize, sqSize);

        // Uniform shading
        ctx.fillStyle = "rgba(125,211,252,0.10)";
        ctx.fillRect(sqX+1, sqY+1, sqSize-2, sqSize-2);

        // Label L
        ctx.strokeStyle = "rgba(168,179,199,0.65)";
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(sqX, sqY + sqSize + 16);
        ctx.lineTo(sqX + sqSize, sqY + sqSize + 16);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(sqX, sqY + sqSize + 10);
        ctx.lineTo(sqX, sqY + sqSize + 22);
        ctx.lineTo(sqX, sqY + sqSize + 10);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(sqX + sqSize, sqY + sqSize + 10);
        ctx.lineTo(sqX + sqSize, sqY + sqSize + 22);
        ctx.stroke();

        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(`L = ${fmt.fixed(state.Lmm,3)} mm`, sqX + 4, sqY + sqSize + 36);

        // Info
        ctx.fillStyle = "rgba(168,179,199,0.95)";
        ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText("Assume uniform TEM plane wave over target area A = L²", leftX0 + 10, boxY + boxH + 14);

        // Right: Gaussian waist cross-section
        const rightX0 = midX + 10;
        const rightW = W - rightX0 - 20;

        // Axis line
        const cx = rightX0 + rightW*0.52;
        const cy = boxY + boxH*0.50;

        ctx.strokeStyle = "rgba(255,255,255,0.15)";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(cx, boxY + 10);
        ctx.lineTo(cx, boxY + boxH + 10);
        ctx.stroke();
        ctx.fillStyle = "rgba(168,179,199,0.95)";
        ctx.fillText("beam axis", cx + 6, boxY + 24);

        // Gaussian profile (intensity envelope)
        ctx.strokeStyle = "rgba(167,139,250,0.75)";
        ctx.lineWidth = 2.5;

        const yTop = boxY + 20;
        const yBot = boxY + boxH;
        const amp = clamp(rightW*0.22, 55, 105);

        ctx.beginPath();
        for(let i=0;i<=120;i++){
          const t = i/120;
          const y = yTop + (yBot - yTop)*t;
          const yn = (t-0.5)*3.2;
          const xoff = amp * Math.exp(-yn*yn);
          const x = cx + xoff;
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.stroke();

        ctx.beginPath();
        for(let i=0;i<=120;i++){
          const t = i/120;
          const y = yTop + (yBot - yTop)*t;
          const yn = (t-0.5)*3.2;
          const xoff = amp * Math.exp(-yn*yn);
          const x = cx - xoff;
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.stroke();

        // Waist marker (w0)
        const y0 = cy;
        const w0px = clamp((state.w0mm/0.2) * amp * 1.2, 20, amp); // visual scale
        ctx.strokeStyle = "rgba(168,179,199,0.65)";
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(cx - w0px, y0);
        ctx.lineTo(cx + w0px, y0);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(cx - w0px, y0-6);
        ctx.lineTo(cx - w0px, y0+6);
        ctx.moveTo(cx + w0px, y0-6);
        ctx.lineTo(cx + w0px, y0+6);
        ctx.stroke();

        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(`w0 = ${fmt.fixed(state.w0mm,3)} mm`, cx - w0px + 2, y0 - 10);

        ctx.fillStyle = "rgba(168,179,199,0.95)";
        ctx.fillText("Gaussian at waist (z=0): I(r)=I0 exp(-2r²/w0²)", rightX0 + 6, boxY + boxH + 14);

        // Shared annotation: P, E0 values
        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.font = "700 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(`P = ${fmt.fixed(state.P,2)} W`, 14, H - 16);

        ctx.fillStyle = "rgba(168,179,199,0.95)";
        ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillText(`E0(a) ≈ ${fmt.sci(state.E0a,4)} V/m`, 120, H - 16);
        ctx.fillText(`E0(center) ≈ ${fmt.sci(state.E0b,4)} V/m`, 320, H - 16);
      }

      function drawMainPlot(state){
        const ctx = p1.ctx;
        const rect = canvP1.getBoundingClientRect();
        const W = rect.width, H = rect.height;
        clear(ctx, W, H);

        // We plot E0 vs size (mm) for:
        // (1) uniform square -> use equivalent radius r_eq = sqrt(A/pi)
        // (2) gaussian -> use w0 directly
        // Use same x-axis in mm: size = mm from 0.02 to 0.20
        const xMin = 0.02, xMax = 0.20;

        // Build curves
        const N = 160;
        let eMax = 0;

        const ptsUniform = [];
        const ptsGauss = [];
        for(let i=0;i<=N;i++){
          const xmm = xMin + (xMax-xMin)*i/N;
          // Uniform: interpret slider axis as equivalent radius r_eq (mm)
          const r = xmm * 1e-3; // m
          const A = PI * r * r;
          const Iu = uniformIntensity(state.P, A);
          const Eu = E0_from_I(Iu);
          eMax = Math.max(eMax, Eu);
          ptsUniform.push({x: xmm, y: Eu});

          // Gaussian: w0 = xmm (mm)
          const w0 = xmm * 1e-3;
          const Eg = gaussianE0center(state.P, w0);
          eMax = Math.max(eMax, Eg);
          ptsGauss.push({x: xmm, y: Eg});
        }

        // Axis range
        const yMin = 0;
        const yMax = eMax * 1.08;

        const ax = drawGridAxes(ctx, W, H, {
          title: "Peak electric field vs characteristic size",
          xMin, xMax,
          yMin, yMax,
          xTicks: 6,
          yTicks: 6,
          xLabel: "Size parameter (mm):  r_eq for uniform (equal-area),  w0 for Gaussian",
          yLabel: "Peak electric field E0 (V/m)",
          xTickFmt: (x)=> x.toFixed(2),
          yTickFmt: (y)=> {
            if(yMax>2e6) return fmt.sci(y,3);
            if(yMax>2e5) return fmt.sci(y,3);
            return y.toFixed(0);
          }
        });

        // Map to pixels
        const uPix = ptsUniform.map(p=>({x: ax.xToPx(p.x), y: ax.yToPx(p.y)}));
        const gPix = ptsGauss.map(p=>({x: ax.xToPx(p.x), y: ax.yToPx(p.y)}));

        // Colors (kept consistent across plots)
        const colU = "rgba(125,211,252,0.85)";
        const colG = "rgba(167,139,250,0.85)";

        drawLine(ctx, uPix, colU, 2.6);
        drawLine(ctx, gPix, colG, 2.6);

        // Mark current parameter points
        const Acur = uniformAreaFromSide_mm(state.Lmm);
        const rEqCur = equivalentRadiusFromArea(Acur) * 1e3; // mm
        const EuCur = state.E0a;
        const EgCur = state.E0b;
        const w0Cur = state.w0mm;

        // markers
        drawMarker(ctx, ax.xToPx(rEqCur), ax.yToPx(EuCur), colU, "current uniform");
        drawMarker(ctx, ax.xToPx(w0Cur), ax.yToPx(EgCur), colG, "current Gaussian");

        // Legend
        drawLegend(ctx, [
          {color: colU, label: "Uniform illumination (equal-area disk): E0 = √(2P/(A c ε0))"},
          {color: colG, label: "Gaussian on-axis at waist: E0 = √(4P/(π w0² c ε0))"}
        ], ax.pad.l + 10, ax.pad.t + 10);
      }

      function drawSecondaryPlot(state){
        const ctx = p2.ctx;
        const rect = canvP2.getBoundingClientRect();
        const W = rect.width, H = rect.height;
        clear(ctx, W, H);

        // Plot intensity vs radius in mm, comparing:
        // Gaussian: I(r) = I0 exp(-2r^2/w0^2)
        // Uniform: I = P/A inside r_eq (equal-area), else 0
        const w0m = state.w0mm * 1e-3;
        const I0 = gaussianI0(state.P, w0m);

        const Acur = uniformAreaFromSide_mm(state.Lmm);
        const rEq = equivalentRadiusFromArea(Acur); // m
        const Iu = uniformIntensity(state.P, Acur);

        // Choose radius range up to ~3*w0 or 1.6*rEq, whichever larger (in mm)
        const rMax_m = Math.max(3.0*w0m, 1.6*rEq);
        const xMin = 0;
        const xMax = rMax_m * 1e3; // mm

        // y-axis intensity
        const yMin = 0;
        const yMax = Math.max(I0, Iu) * 1.08;

        const ax = drawGridAxes(ctx, W, H, {
          title: "Intensity profile vs radius (Gaussian vs uniform comparison)",
          xMin, xMax,
          yMin, yMax,
          xTicks: 6,
          yTicks: 6,
          xLabel: "Radius r (mm)",
          yLabel: "Intensity I (W/m²)",
          xTickFmt: (x)=> x.toFixed(2),
          yTickFmt: (y)=> fmt.sci(y,3)
        });

        const N = 220;
        const colG = "rgba(167,139,250,0.85)";
        const colU = "rgba(125,211,252,0.75)";

        // Gaussian curve
        const ptsG = [];
        for(let i=0;i<=N;i++){
          const rmm = xMin + (xMax-xMin)*i/N;
          const r = rmm * 1e-3;
          const Ig = gaussianIntensity(state.P, w0m, r);
          ptsG.push({x: ax.xToPx(rmm), y: ax.yToPx(Ig)});
        }
        drawLine(ctx, ptsG, colG, 2.6);

        // Uniform step: constant until rEq
        const rEq_mm = rEq * 1e3;
        const x0 = ax.xToPx(0);
        const x1 = ax.xToPx(clamp(rEq_mm, xMin, xMax));
        const yIu = ax.yToPx(Iu);
        const y0 = ax.yToPx(0);

        ctx.save();
        ctx.strokeStyle = colU;
        ctx.lineWidth = 2.6;
        ctx.beginPath();
        ctx.moveTo(x0, yIu);
        ctx.lineTo(x1, yIu);
        ctx.lineTo(x1, y0);
        ctx.stroke();
        ctx.restore();

        // Mark w0 and rEq
        // vertical line at r = w0
        const xw = ax.xToPx(state.w0mm);
        ctx.save();
        ctx.strokeStyle = "rgba(167,139,250,0.35)";
        ctx.lineWidth = 1.5;
        ctx.setLineDash([6,6]);
        ctx.beginPath();
        ctx.moveTo(xw, ax.pad.t);
        ctx.lineTo(xw, H - ax.pad.b);
        ctx.stroke();
        ctx.restore();
        drawMarker(ctx, xw, ax.yToPx(gaussianIntensity(state.P, w0m, w0m)), "rgba(167,139,250,0.9)", "r=w0");

        const xr = ax.xToPx(rEq_mm);
        ctx.save();
        ctx.strokeStyle = "rgba(125,211,252,0.35)";
        ctx.lineWidth = 1.5;
        ctx.setLineDash([6,6]);
        ctx.beginPath();
        ctx.moveTo(xr, ax.pad.t);
        ctx.lineTo(xr, H - ax.pad.b);
        ctx.stroke();
        ctx.restore();
        drawMarker(ctx, xr, yIu, "rgba(125,211,252,0.9)", "r=r_eq");

        // Legend
        drawLegend(ctx, [
          {color: colG, label: "Gaussian: I(r)=I0 exp(-2r²/w0²)"},
          {color: colU, label: "Uniform (equal-area): I= P/A for r≤r_eq"}
        ], ax.pad.l + 10, ax.pad.t + 10);

        // Small annotation for current values
        ctx.save();
        ctx.fillStyle = "rgba(230,237,247,0.92)";
        ctx.font = "600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
        const note = `I0=${fmt.sci(I0,4)} W/m²   |   Iu=${fmt.sci(Iu,4)} W/m²   |   r_eq=${fmt.fixed(rEq_mm,3)} mm`;
        ctx.fillText(note, ax.pad.l, H - 16);
        ctx.restore();
      }

      // ---------- State + Updates ----------
      const state = {
        P: 1.00,
        Lmm: 0.10,
        w0mm: 0.10,
        A: 1e-8,
        Iu: 1e8,
        E0a: 0,
        I0: 0,
        E0b: 0
      };

      function compute(){
        state.A = uniformAreaFromSide_mm(state.Lmm);
        state.Iu = uniformIntensity(state.P, state.A);
        state.E0a = E0_from_I(state.Iu);

        const w0m = state.w0mm * 1e-3;
        state.I0 = gaussianI0(state.P, w0m);
        state.E0b = E0_from_I(state.I0);

        // Update quick + boxes
        E0aQuick.textContent = `≈ ${fmt.sci(state.E0a,4)} V/m`;
        E0bQuick.textContent = `≈ ${fmt.sci(state.E0b,4)} V/m`;

        boxA_num.textContent =
`For P=${fmt.fixed(state.P,2)} W, A=${fmt.sci(state.A,4)} m^2:
I = ${fmt.sci(state.Iu,4)} W/m^2
E0(a) ≈ ${fmt.sci(state.E0a,4)} V/m`;

        boxB_num.textContent =
`For P=${fmt.fixed(state.P,2)} W, w0=${fmt.fixed(state.w0mm,3)} mm = ${fmt.sci(state.w0mm*1e-3,4)} m:
I0 = ${fmt.sci(state.I0,4)} W/m^2
E0(center) ≈ ${fmt.sci(state.E0b,4)} V/m`;

        finalA.textContent =
`For P=${fmt.fixed(state.P,2)} W, L=${fmt.fixed(state.Lmm,3)} mm:
A = ${fmt.sci(state.A,4)} m^2
E0(a) ≈ ${fmt.sci(state.E0a,4)} V/m`;

        finalB.textContent =
`For P=${fmt.fixed(state.P,2)} W, w0=${fmt.fixed(state.w0mm,3)} mm:
E0(center) ≈ ${fmt.sci(state.E0b,4)} V/m`;
      }

      function render(){
        // Ensure canvases are crisp
        diag.resize(); p1.resize(); p2.resize();
        drawDiagram(state);
        drawMainPlot(state);
        drawSecondaryPlot(state);
      }

      function update(){
        compute();
        render();
      }

      // ---------- Inputs ----------
      function syncUI(){
        pwrVal.textContent = fmt.fixed(state.P,2);
        sideVal.textContent = fmt.fixed(state.Lmm,3);
        w0Val.textContent = fmt.fixed(state.w0mm,3);
      }

      elP.addEventListener("input", ()=>{
        state.P = parseFloat(elP.value);
        syncUI(); update();
      });
      elL.addEventListener("input", ()=>{
        state.Lmm = parseFloat(elL.value);
        syncUI(); update();
      });
      elW.addEventListener("input", ()=>{
        state.w0mm = parseFloat(elW.value);
        syncUI(); update();
      });

      // ---------- Copy final answers ----------
      document.getElementById("copyA_num").addEventListener("click", async ()=>{
        const t = boxA_num.textContent;
        const ok = await copyText(t);
        setStatus(copyStatus, ok ? "Copied (a)" : "Copy failed", ok);
      });
      document.getElementById("copyB_num").addEventListener("click", async ()=>{
        const t = boxB_num.textContent;
        const ok = await copyText(t);
        setStatus(copyStatus, ok ? "Copied (b)" : "Copy failed", ok);
      });

      function finalTextA(){
        return `Part (a) — Uniform spot on square target:
E0(a) = sqrt(2P/(A c ε0)),  A=L^2
With P=${fmt.fixed(state.P,2)} W, L=${fmt.fixed(state.Lmm,3)} mm:
A=${fmt.sci(state.A,4)} m^2
E0(a) ≈ ${fmt.sci(state.E0a,6)} V/m`;
      }
      function finalTextB(){
        return `Part (b) — Gaussian beam at waist center:
E0(center) = sqrt(4P/(π w0^2 c ε0))
With P=${fmt.fixed(state.P,2)} W, w0=${fmt.fixed(state.w0mm,3)} mm:
E0(center) ≈ ${fmt.sci(state.E0b,6)} V/m`;
      }

      document.getElementById("copyFinalA").addEventListener("click", async ()=>{
        const ok = await copyText(finalTextA());
        setStatus(finalStatus, ok ? "Copied final (a)" : "Copy failed", ok);
      });
      document.getElementById("copyFinalB").addEventListener("click", async ()=>{
        const ok = await copyText(finalTextB());
        setStatus(finalStatus, ok ? "Copied final (b)" : "Copy failed", ok);
      });
      document.getElementById("copyFinalBoth").addEventListener("click", async ()=>{
        const ok = await copyText(finalTextA() + "\n\n" + finalTextB());
        setStatus(finalStatus, ok ? "Copied both" : "Copy failed", ok);
      });

      document.getElementById("copyAllAnswers").addEventListener("click", async ()=>{
        const a = `Default given values (P=1 W, L=0.1 mm, w0=0.1 mm):
E0(a) ≈ 2.7449×10^5 V/m
E0(center) ≈ 2.1901×10^5 V/m`;
        const ok = await copyText(a);
        setStatus(copyStatus, ok ? "Copied numeric answers" : "Copy failed", ok);
      });

      // ---------- Initial compute with default problem values ----------
      function setDefaultsProblem(){
        state.P = 1.00;
        state.Lmm = 0.10;
        state.w0mm = 0.10;
        elP.value = state.P.toFixed(2);
        elL.value = state.Lmm.toFixed(3);
        elW.value = state.w0mm.toFixed(3);
        syncUI();
        update();
      }

      // Resize handling
      let resizeT = null;
      window.addEventListener("resize", ()=>{
        clearTimeout(resizeT);
        resizeT = setTimeout(()=>{ render(); }, 90);
      });

      // Smooth TOC scrolling
      document.querySelectorAll('a[href^="#"]').forEach(a=>{
        a.addEventListener("click", (e)=>{
          const id = a.getAttribute("href");
          const el = document.querySelector(id);
          if(el){
            e.preventDefault();
            el.scrollIntoView({behavior:"smooth", block:"start"});
          }
        });
      });

      setDefaultsProblem();
    })();
  </script>
</body>
</html>
