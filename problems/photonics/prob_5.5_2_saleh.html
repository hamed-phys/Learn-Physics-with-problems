<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amplitude-Modulated Wave in a Dispersive Medium (Three-Tone Propagation)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111826;
      --panel2:#0f1623;
      --text:#e7eefc;
      --muted:#a9b6cf;
      --line:rgba(231,238,252,.14);
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1000px 650px at 15% 10%, rgba(110,231,255,.10), transparent 60%),
        radial-gradient(900px 600px at 80% 35%, rgba(167,139,250,.10), transparent 55%),
        linear-gradient(180deg, #070a0f 0%, #0b0f14 30%, #070a0f 100%);
      line-height:1.55;
    }

    a{color:var(--accent)}
    code, pre{font-family:var(--mono)}
    pre{
      margin:0;
      padding:14px 14px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:14px;
      overflow:auto;
      white-space:pre-wrap;
      word-break:break-word;
    }

    header{
      position:relative;
      padding:42px 18px 18px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.03), transparent);
    }

    .wrap{
      width:min(1100px, 100%);
      margin:0 auto;
      padding:0 18px;
    }

    .hero{
      display:grid;
      grid-template-columns: 1.3fr .7fr;
      gap:18px;
      align-items:start;
    }

    h1{
      margin:0 0 10px 0;
      font-size:clamp(1.55rem, 2.2vw + 1rem, 2.35rem);
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      margin:0 0 14px 0;
      max-width:70ch;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px 16px;
    }

    .quick ul{
      margin:10px 0 0;
      padding-left:18px;
      color:var(--muted);
    }
    .quick li{margin:6px 0}

    .toc{
      position:sticky;
      top:12px;
      align-self:start;
      padding:14px 14px;
      background:linear-gradient(180deg, rgba(17,24,38,.95), rgba(17,24,38,.72));
      backdrop-filter: blur(8px);
    }
    .toc h2{
      font-size:0.95rem;
      margin:0 0 10px 0;
      color:#d9e4ff;
      letter-spacing:.25px;
    }
    .toc nav a{
      display:block;
      padding:7px 10px;
      border-radius:12px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid transparent;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      font-size:.93rem;
    }
    .toc nav a:hover{
      background:rgba(110,231,255,.08);
      border-color:rgba(110,231,255,.22);
      transform: translateX(2px);
      color:var(--text);
    }

    main{padding:22px 0 52px}
    section{margin-top:18px}
    section > .card{padding:18px}
    h2{
      margin:0 0 10px 0;
      font-size:1.25rem;
      letter-spacing:.2px;
    }
    h3{
      margin:16px 0 8px;
      font-size:1.05rem;
      color:#d9e4ff;
    }
    p{margin:8px 0; color:var(--muted)}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 920px){
      .hero{grid-template-columns:1fr}
      .grid2,.grid3{grid-template-columns:1fr}
      .toc{position:relative; top:auto}
    }

    .callout{
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(167,139,250,.12), rgba(167,139,250,.04));
      padding:14px 14px;
      color:var(--muted);
    }
    .callout strong{color:var(--text)}
    .callout.good{
      background:linear-gradient(180deg, rgba(52,211,153,.12), rgba(52,211,153,.04));
    }
    .callout.warn{
      background:linear-gradient(180deg, rgba(251,191,36,.14), rgba(251,191,36,.04));
    }

    .eq{
      position:relative;
      margin-top:10px;
    }
    .eq .toolbar{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      margin:8px 0 8px;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(231,238,252,.18);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:.92rem;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(110,231,255,.30);
      background: rgba(110,231,255,.08);
    }
    .btn:active{transform: translateY(0px)}
    .btn.small{padding:6px 9px; font-size:.88rem}

    .kpi{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:.92rem;
    }
    .pill b{color:var(--text)}
    .pill .dot{
      display:inline-block;
      width:8px;height:8px;border-radius:999px;
      margin-right:8px;
      background:var(--accent);
      vertical-align:middle;
      box-shadow:0 0 0 3px rgba(110,231,255,.12);
    }

    figure{margin:0}
    canvas{
      width:100%;
      height:320px;
      display:block;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
    }
    .plotTitle{
      margin:0 0 8px 0;
      color:#d9e4ff;
      font-size:1rem;
    }
    .controls{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      align-items:center;
      margin-top:10px;
      padding:12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(255,255,255,.03);
    }
    @media (max-width:920px){
      .controls{grid-template-columns:1fr}
    }
    .controlRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    label{color:var(--muted); font-size:.95rem}
    input[type="range"]{width:100%}
    .readout{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
      align-items:center;
    }
    .readout .pill{font-size:.9rem}

    .boxed{
      border:1px solid rgba(110,231,255,.25);
      background:linear-gradient(180deg, rgba(110,231,255,.10), rgba(110,231,255,.03));
      border-radius:var(--radius);
      padding:14px;
      margin-top:12px;
      box-shadow:0 0 0 1px rgba(110,231,255,.10) inset;
    }
    .boxed h3{margin-top:0}
    .boxed pre{background:rgba(0,0,0,.22)}

    .muted{color:var(--muted)}
    .fine{font-size:.92rem}
    .hr{
      height:1px;
      background:var(--line);
      margin:14px 0;
    }

    footer{
      padding:18px 0 26px;
      border-top:1px solid var(--line);
      color:var(--muted);
      background:linear-gradient(180deg, transparent, rgba(255,255,255,.02));
    }

    /* subtle entrance */
    .fadeIn{
      animation: fadeInUp .45s ease both;
    }
    @keyframes fadeInUp{
      from{opacity:0; transform: translateY(8px)}
      to{opacity:1; transform: translateY(0)}
    }

    /* print-friendly */
    @media print{
      body{background:white; color:black}
      .card, .toc, canvas{box-shadow:none}
      .toc{display:none}
      .btn{display:none}
      pre{border:1px solid #ccc; background:#f7f7f7}
      .card{border:1px solid #ccc; background:white}
      p, .muted{color:#222}
      header{border-bottom:1px solid #ddd}
      footer{border-top:1px solid #ddd}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap hero">
    <div class="fadeIn">
      <h1>Amplitude-Modulated Wave in a Dispersive Medium</h1>
      <p class="subtitle">
        A three-frequency (carrier + two sidebands) view of AM propagation: dispersion shifts sideband phases differently,
        turning “pure AM” into a mix of amplitude and phase modulation—except at special distances.
      </p>

      <div class="card quick">
        <h2 id="quick-summary" style="margin:0 0 6px 0;">Quick Summary</h2>
        <ul>
          <li>The input complex wave has a carrier at <code>ν0</code> and sidebands at <code>ν0 ± fs</code>.</li>
          <li>In a dispersive medium, each frequency component accumulates a different phase <code>exp(-jβ(ν)z)</code>.</li>
          <li>The transmitted complex envelope (factoring out the carrier) is
            <code>a(z,t)=1+(m/2)e^{j(Ωt-Δβ+z)}+(m/2)e^{-j(Ωt+Δβ-z)}</code>.</li>
          <li>The “phase-only” contamination is governed by the sideband phase mismatch <code>(β2−β1)z</code>.</li>
          <li>At distances <code>z = 2πn/(β2−β1)</code>, the envelope is real (up to a constant) ⇒ pure AM, no PM.</li>
        </ul>
      </div>
    </div>

    <aside class="card toc fadeIn" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <nav>
        <a href="#part1">PART 1 — Problem Analysis</a>
        <a href="#part2">PART 2 — Strategy & Tips</a>
        <a href="#part3">PART 3 — Full Solution</a>
        <a href="#viz">Interactive Visualizations</a>
      </nav>
      <div class="hr"></div>
      <p class="fine muted" style="margin:0;">
        Tip: use the <b>z</b> slider to see when the envelope phase becomes flat (pure AM).
      </p>
    </aside>
  </div>
</header>

<main class="wrap">
  <!-- PART 1 -->
  <section id="part1" class="fadeIn">
    <div class="card">
      <h2>PART 1 — Problem Analysis (no solving yet)</h2>

      <h3>Restate the problem</h3>
      <p>
        At <code>z=0</code> we are given an amplitude-modulated complex wave:
        <code>A(t) = [1 + m cos(2π f<sub>s</sub> t)] exp(j 2π ν<sub>0</sub> t)</code>, with <code>f<sub>s</sub> ≪ ν<sub>0</sub></code>.
        The wave travels a distance <code>z</code> in a lossless dispersive medium whose propagation constant depends on frequency, <code>β(ν)</code>.
        We know <code>β(ν0)=β0</code>, <code>β(ν0−fs)=β1</code>, and <code>β(ν0+fs)=β2</code>.
        We must derive the <b>complex envelope</b> after propagation and show that for certain <code>z</code> the output remains
        <b>pure AM (no phase modulation)</b>.
      </p>

      <div class="grid2">
        <div class="callout">
          <strong>Given</strong>
          <ul>
            <li>Input: <code>A(t) = [1 + m cos(2π f<sub>s</sub> t)] exp(j 2π ν<sub>0</sub> t)</code></li>
            <li><code>f<sub>s</sub> ≪ ν<sub>0</sub></code>, modulation index <code>m</code> (assume <code>|m|≤1</code> typical)</li>
            <li>Lossless medium (negligible attenuation)</li>
            <li><code>β(ν0)=β0</code>, <code>β(ν0−fs)=β1</code>, <code>β(ν0+fs)=β2</code></li>
          </ul>
        </div>
        <div class="callout good">
          <strong>Unknowns / What to find</strong>
          <ul>
            <li>The transmitted <b>complex envelope</b> as a function of <code>β0, β1, β2, z</code></li>
            <li>A condition on <code>z</code> such that the wave is <b>AM only</b> (no PM)</li>
          </ul>
        </div>
      </div>

      <h3>Relevant principles (and why they apply)</h3>
      <p>
        This is a <b>linear, time-invariant propagation</b> problem in a dispersive medium.
        In such media, each monochromatic component at frequency <code>ν</code> acquires a phase factor
        <code>exp(-j β(ν) z)</code>. Because attenuation is negligible, only phase shifts matter.
        An AM signal is naturally decomposed into <b>three tones</b> (carrier + upper/lower sidebands),
        so tracking their relative phases after propagation determines whether the recombined signal is
        purely amplitude-modulated or contains a phase-modulated (quadrature) component.
      </p>

      <h3>Possible approaches</h3>
      <div class="grid3">
        <div class="callout">
          <strong>Approach A: Fourier/sideband decomposition</strong>
          <p class="fine muted">
            Expand the cosine into exponentials, propagate each tone with its own <code>β</code>, then factor out the carrier to get the envelope.
            This is clean and exactly matches the provided <code>β0,β1,β2</code>.
          </p>
        </div>
        <div class="callout">
          <strong>Approach B: Small-signal envelope + Taylor expansion</strong>
          <p class="fine muted">
            Use <code>β(ν)≈β(ν0)+β'(ν0)(ν−ν0)+…</code> and derive group delay/dispersion effects.
            Useful for general insight, but the problem already gives discrete values at three frequencies.
          </p>
        </div>
        <div class="callout">
          <strong>Approach C: I/Q (in-phase/quadrature) representation</strong>
          <p class="fine muted">
            Represent the envelope as <code>1 + I cos(Ωt) + Q sin(Ωt)</code>. Shows AM vs PM immediately.
            Best used after doing A to identify when <code>Q=0</code>.
          </p>
        </div>
      </div>

      <div class="callout warn" style="margin-top:12px;">
        <strong>Chosen approach:</strong> <b>Approach A</b>, then convert to an <b>I/Q form</b> to read off the “pure AM” condition.
        This uses the given <code>β0,β1,β2</code> directly and makes the physics transparent: dispersion causes a sideband phase mismatch.
      </div>
    </div>
  </section>

  <!-- PART 2 -->
  <section id="part2" class="fadeIn">
    <div class="card">
      <h2>PART 2 — Strategy & Tips (roadmap only)</h2>

      <h3>Step-by-step roadmap (no algebra yet)</h3>
      <ol class="muted">
        <li><b>Goal:</b> Express AM waveform as a sum of 3 complex exponentials (carrier + sidebands). <br/>
          <b>Tool:</b> <code>cos x = (e^{jx}+e^{-jx})/2</code>.
        </li>
        <li><b>Goal:</b> Propagate each frequency component through the medium. <br/>
          <b>Tool:</b> For each tone at <code>ν</code>, multiply by <code>exp(-jβ(ν)z)</code>.
        </li>
        <li><b>Goal:</b> Factor out the carrier term at <code>ν0</code> to define the <b>complex envelope</b>. <br/>
          <b>Tool:</b> Write output as <code>A(z,t)=a(z,t) exp(j2πν0 t - jβ0 z)</code>.
        </li>
        <li><b>Goal:</b> Combine the two sideband terms into a cosine with a possible complex coefficient. <br/>
          <b>Tool:</b> Exponential factoring to get <code>2 cos(Ωt - θ)</code> times a phase factor.
        </li>
        <li><b>Goal:</b> Identify when the envelope is purely real (up to a global phase), i.e. no quadrature term. <br/>
          <b>Tool:</b> Require the sideband mismatch phase factor to be <code>±1</code>.
        </li>
        <li><b>Goal:</b> State the special distances <code>z</code> and interpret physically. <br/>
          <b>Tool:</b> Solve a simple phase condition in terms of <code>β2−β1</code>.
        </li>
      </ol>

      <h3>Common mistakes & quick tips</h3>
      <ul class="muted">
        <li><b>Sign mistakes</b> in the propagation phase: for forward propagation the tone picks up <code>exp(-jβz)</code>.</li>
        <li><b>Mixing ω and ν</b>: here the problem uses frequency <code>ν</code> (Hz) and modulation <code>f<sub>s</sub></code>. Keep <code>Ω=2π f<sub>s</sub></code>.</li>
        <li><b>Envelope definition</b>: the envelope is what remains after factoring out <code>exp(j2πν0 t - jβ0 z)</code>.</li>
        <li><b>Pure AM condition</b> is not “no phase shift”: it’s “no time-varying phase” (no PM), allowing a constant phase.</li>
      </ul>
    </div>
  </section>

  <!-- PART 3 -->
  <section id="part3" class="fadeIn">
    <div class="card">
      <h2>PART 3 — Full Solution</h2>

      <h3>Physical intuition (before math)</h3>
      <p>
        An AM wave is a carrier plus two symmetric sidebands. In a nondispersive medium,
        all three tones acquire phases that stay “locked” so their interference produces a purely real envelope
        (amplitude varies, but phase does not). In a dispersive medium, the sidebands accumulate
        <b>different</b> phases because <code>β(ν)</code> depends on <code>ν</code>. When recombined, the two sidebands may no longer be
        symmetric in phase, generating a quadrature (sine) term in the envelope—i.e., <b>phase modulation</b>.
        However, at special distances the sideband mismatch becomes an integer multiple of <code>2π</code>, restoring pure AM.
      </p>

      <div class="hr"></div>

      <h3>1) Expand the input into carrier + sidebands</h3>
      <p>
        Start from the given complex waveform at <code>z=0</code>:
      </p>
      <div class="eq" id="eq1">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq1txt">Copy equation</button>
        </div>
        <pre id="eq1txt">A(0,t) = [1 + m cos(2π f_s t)] · exp(j 2π ν0 t)</pre>
      </div>

      <p>
        Use <code>cos x = (e^{jx}+e^{-jx})/2</code>. Let <code>Ω = 2π f_s</code>. Then:
      </p>
      <div class="eq" id="eq2">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq2txt">Copy equation</button>
        </div>
        <pre id="eq2txt">A(0,t)
= exp(j 2π ν0 t)
+ (m/2) exp(j 2π (ν0+f_s) t)
+ (m/2) exp(j 2π (ν0−f_s) t)</pre>
      </div>

      <h3>2) Propagate each tone through the dispersive medium</h3>
      <p>
        In a lossless dispersive medium, each frequency component at <code>ν</code> picks up phase <code>exp(-j β(ν) z)</code>.
        Using the given values:
        <code>β(ν0)=β0</code>, <code>β(ν0−f_s)=β1</code>, <code>β(ν0+f_s)=β2</code>.
      </p>
      <div class="eq" id="eq3">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq3txt">Copy equation</button>
        </div>
        <pre id="eq3txt">A(z,t)
= exp(j 2π ν0 t − j β0 z)
+ (m/2) exp(j 2π (ν0+f_s) t − j β2 z)
+ (m/2) exp(j 2π (ν0−f_s) t − j β1 z)</pre>
      </div>

      <h3>3) Factor out the carrier to identify the complex envelope</h3>
      <p>
        Define the complex envelope <code>a(z,t)</code> by factoring out the carrier term
        <code>exp(j 2π ν0 t − j β0 z)</code>:
      </p>

      <div class="eq" id="eq4">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq4txt">Copy equation</button>
        </div>
        <pre id="eq4txt">A(z,t) = a(z,t) · exp(j 2π ν0 t − j β0 z)</pre>
      </div>

      <p>
        Substitute and simplify. Let the sideband phase offsets relative to the carrier be:
        <code>Δβ+ = β2 − β0</code> (upper sideband relative phase slope),
        <code>Δβ− = β1 − β0</code> (lower sideband relative phase slope).
        Then:
      </p>

      <div class="eq" id="eq5">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq5txt">Copy equation</button>
        </div>
        <pre id="eq5txt">a(z,t)
= 1
+ (m/2) exp(j Ω t − j(β2−β0) z)
+ (m/2) exp(−j Ω t − j(β1−β0) z)</pre>
      </div>

      <div class="callout good">
        <strong>This is the requested complex envelope</strong> in terms of <code>β0, β1, β2, z</code> (and <code>m, f_s</code> through <code>Ω</code>).
      </div>

      <h3>4) Rewrite the envelope to expose AM vs PM</h3>
      <p>
        The key question is: does <code>a(z,t)</code> have a time-varying phase?
        Combine the two sideband exponentials into a cosine times a (possibly complex) factor.
      </p>

      <p>
        Write the sideband sum as:
      </p>

      <div class="eq" id="eq6">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq6txt">Copy equation</button>
        </div>
        <pre id="eq6txt">S(z,t) = exp(j(Ω t − (β2−β0)z)) + exp(−j(Ω t + (β1−β0)z))</pre>
      </div>

      <p>
        Define:
        <code>φ+ = (β2−β0)z</code>, <code>φ− = (β1−β0)z</code>.
        Then
        <code>S = e^{j(Ω t − φ+)} + e^{-j(Ω t + φ−)}</code>.
        Factor out the mismatch half-difference:
      </p>

      <div class="eq" id="eq7">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq7txt">Copy equation</button>
        </div>
        <pre id="eq7txt">Let  φ_avg = (φ+ + φ−)/2,   Δφ = φ+ − φ−.
Then
S(z,t) = 2 · exp(−j Δφ/2) · cos(Ω t − φ_avg)</pre>
      </div>

      <p>
        Here <code>Δφ = (φ+ − φ−) = [(β2−β0) − (β1−β0)]z = (β2 − β1)z</code>,
        and <code>φ_avg = [(β2−β0)+(β1−β0)]z/2 = [(β1+β2)/2 − β0]z</code>.
        Substitute back into <code>a(z,t)=1+(m/2)S</code>:
      </p>

      <div class="boxed" id="finalBox">
        <h3>Final symbolic envelope (boxed)</h3>
        <div class="toolbar" style="justify-content:flex-end;">
          <button class="btn small" data-copy="#finalTxt">Copy final answer</button>
        </div>
        <pre id="finalTxt">Define Ω = 2π f_s.
a(z,t) = 1 + m · exp(−j(β2−β1)z/2) · cos( Ω t − ( (β1+β2)/2 − β0 ) z )

And the full field:
A(z,t) = a(z,t) · exp(j 2π ν0 t − j β0 z)</pre>
      </div>

      <h3>5) When is there AM with no phase modulation?</h3>
      <p>
        The envelope is “pure AM” when it can be written as a <b>real</b> amplitude factor (possibly with a shifted cosine argument),
        i.e. the modulation term is not rotated into quadrature. In the boxed result, the only potentially complex part is:
        <code>exp(−j(β2−β1)z/2)</code>.
      </p>

      <p>
        For the modulation to be purely in-phase (no PM), require this factor to be real: <code>exp(−j(β2−β1)z/2)=±1</code>.
        That occurs when:
      </p>

      <div class="eq" id="eq8">
        <div class="toolbar">
          <button class="btn small" data-copy="#eq8txt">Copy equation</button>
        </div>
        <pre id="eq8txt">(β2 − β1) z / 2 = nπ   ⇒   z = 2π n / (β2 − β1),   n ∈ ℤ</pre>
      </div>

      <div class="callout good">
        <strong>Conclusion:</strong> At distances <code>z = 2π n /(β2−β1)</code>, the envelope has <b>no time-varying phase</b>.
        The output remains amplitude-modulated (with possibly a sign flip and a shift of the modulation cosine).
      </div>

      <h3>Sanity checks</h3>
      <div class="grid3">
        <div class="callout">
          <strong>Units</strong>
          <p class="fine muted">
            <code>β</code> has units rad/m, so <code>β z</code> is radians (dimensionless). The exponent phases are unitless, consistent.
          </p>
        </div>
        <div class="callout">
          <strong>Limiting case: no dispersion</strong>
          <p class="fine muted">
            If <code>β1=β2</code> then <code>β2−β1=0</code> ⇒ mismatch factor is <code>1</code> for all <code>z</code>.
            Pure AM is preserved at any distance.
          </p>
        </div>
        <div class="callout">
          <strong>Physical interpretation</strong>
          <p class="fine muted">
            Dispersion introduces a relative phase between upper/lower sidebands. When that relative phase equals <code>2πn</code>,
            the sidebands interfere in-phase to produce only amplitude variation—no quadrature component, hence no PM.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Visualizations -->
  <section id="viz" class="fadeIn">
    <div class="card">
      <h2>Interactive Visualizations</h2>
      <p class="muted">
        The plots below use <b>example values</b> (clearly editable via controls) while the derived formulas above remain fully symbolic.
        We visualize the envelope <code>a(z,t)</code> and show how dispersion causes phase modulation except at special distances
        <code>z = 2πn/(β2−β1)</code>.
      </p>

      <div class="controls" role="group" aria-label="Interactive controls">
        <div class="controlRow">
          <div>
            <label for="zSlider"><b>Propagation distance z</b> (m)</label>
            <input id="zSlider" type="range" min="0" max="200" value="60" step="0.1" />
          </div>
          <div>
            <label for="betaDiffSlider"><b>Sideband mismatch (β2 − β1)</b> (rad/m)</label>
            <input id="betaDiffSlider" type="range" min="0.01" max="0.25" value="0.12" step="0.001" />
          </div>
          <div class="kpi">
            <span class="pill"><span class="dot"></span><b>Example</b>: m=0.7, f<sub>s</sub>=1 kHz</span>
            <span class="pill"><b>β0</b>=10 rad/m</span>
            <span class="pill"><b>(β1+β2)/2</b> is held at 10 rad/m in the demo</span>
          </div>
        </div>

        <div class="readout">
          <button id="snapBtn" class="btn">Snap z to nearest “pure AM” distance</button>
          <span class="pill"><b>z</b> = <span id="zRead">60.0</span> m</span>
          <span class="pill"><b>β2−β1</b> = <span id="bdRead">0.120</span> rad/m</span>
          <span class="pill"><b>Nearest n</b> = <span id="nRead">1</span></span>
          <span class="pill"><b>Ideal z<sub>n</sub></b> = <span id="znRead">52.36</span> m</span>
        </div>
      </div>

      <div class="grid2" style="margin-top:14px;">
        <figure>
          <p class="plotTitle">1) Setup diagram (carrier + sidebands accumulate different phases)</p>
          <canvas id="cDiagram" aria-label="Propagation diagram"></canvas>
          <p class="fine muted" style="margin-top:8px;">
            Diagram shows three tones propagating a distance <code>z</code> and acquiring phases <code>β0 z</code>, <code>β1 z</code>, <code>β2 z</code>.
          </p>
        </figure>

        <figure>
          <p class="plotTitle">2) Main plot — Envelope magnitude |a(z,t)| vs time</p>
          <canvas id="cMag" aria-label="Magnitude plot"></canvas>
          <p class="fine muted" style="margin-top:8px;">
            Pure AM appears as a cosine-like magnitude with minimal accompanying phase swings.
          </p>
        </figure>
      </div>

      <figure style="margin-top:14px;">
        <p class="plotTitle">3) Secondary plot — Envelope phase arg(a(z,t)) vs time</p>
        <canvas id="cPhase" aria-label="Phase plot"></canvas>
        <p class="fine muted" style="margin-top:8px;">
          At special distances <code>z = 2πn/(β2−β1)</code>, the phase becomes approximately flat (no PM).
        </p>
      </figure>

      <div class="callout warn" style="margin-top:12px;">
        <strong>Note:</strong> The demo keeps <code>β0</code> and the average sideband phase slope fixed, while you vary the mismatch <code>(β2−β1)</code>.
        That isolates the effect that creates phase modulation.
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="wrap">
    <p class="fine muted" style="margin:0;">
      Built with vanilla HTML/CSS/JS. Equations are plain text (copy buttons included). Canvases are high-DPI aware and responsive.
    </p>
  </div>
</footer>

<script>
/* ---------------------------
   Copy buttons
---------------------------- */
(function(){
  const buttons = document.querySelectorAll('[data-copy]');
  buttons.forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const sel = btn.getAttribute('data-copy');
      const el = document.querySelector(sel);
      if(!el) return;
      const text = el.textContent.replace(/\n+$/,'');
      try{
        await navigator.clipboard.writeText(text);
        const old = btn.textContent;
        btn.textContent = 'Copied ✓';
        setTimeout(()=>btn.textContent = old, 900);
      }catch(e){
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        const old = btn.textContent;
        btn.textContent = 'Copied ✓';
        setTimeout(()=>btn.textContent = old, 900);
      }
    });
  });
})();

/* ---------------------------
   Math helpers (complex)
---------------------------- */
function c(re, im){ return {re, im}; }
function cAdd(a,b){ return {re:a.re+b.re, im:a.im+b.im}; }
function cMul(a,b){ return {re:a.re*b.re - a.im*b.im, im:a.re*b.im + a.im*b.re}; }
function cExpj(theta){ return {re:Math.cos(theta), im:Math.sin(theta)}; }
function cAbs(a){ return Math.hypot(a.re,a.im); }
function cArg(a){ return Math.atan2(a.im,a.re); }

/* ---------------------------
   High-DPI canvas scaling
---------------------------- */
function fitCanvas(canvas, cssHeight){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(10, rect.width);
  const h = cssHeight || rect.height || 300;
  canvas.width = Math.round(w * dpr);
  canvas.height = Math.round(h * dpr);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {ctx, w, h, dpr};
}

/* ---------------------------
   Plot utilities
---------------------------- */
function drawAxes(ctx, box, xMin, xMax, yMin, yMax, xLabel, yLabel, title){
  const {x,y,w,h} = box;
  // background
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
  ctx.save();
  ctx.translate(0.5,0.5);

  // panel fill
  ctx.fillStyle = 'rgba(0,0,0,0.10)';
  ctx.fillRect(x,y,w,h);

  // grid
  const gridN = 8;
  ctx.strokeStyle = 'rgba(231,238,252,0.12)';
  ctx.lineWidth = 1;
  for(let i=0;i<=gridN;i++){
    const gx = x + (w*i/gridN);
    const gy = y + (h*i/gridN);
    ctx.beginPath(); ctx.moveTo(gx,y); ctx.lineTo(gx,y+h); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x,gy); ctx.lineTo(x+w,gy); ctx.stroke();
  }

  // axes outline
  ctx.strokeStyle = 'rgba(231,238,252,0.22)';
  ctx.lineWidth = 1.2;
  ctx.strokeRect(x,y,w,h);

  // ticks + labels
  ctx.fillStyle = 'rgba(231,238,252,0.82)';
  ctx.font = '12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='center';
  ctx.textBaseline='top';

  for(let i=0;i<=gridN;i++){
    const t = i/gridN;
    const xv = xMin + t*(xMax-xMin);
    const px = x + t*w;
    ctx.beginPath();
    ctx.strokeStyle='rgba(231,238,252,0.28)';
    ctx.moveTo(px, y+h);
    ctx.lineTo(px, y+h+5);
    ctx.stroke();
    ctx.fillText(formatNum(xv), px, y+h+7);
  }

  ctx.textAlign='right';
  ctx.textBaseline='middle';
  for(let i=0;i<=gridN;i++){
    const t = i/gridN;
    const yv = yMax - t*(yMax-yMin);
    const py = y + t*h;
    ctx.beginPath();
    ctx.strokeStyle='rgba(231,238,252,0.28)';
    ctx.moveTo(x-5, py);
    ctx.lineTo(x, py);
    ctx.stroke();
    ctx.fillText(formatNum(yv), x-8, py);
  }

  // axis labels
  ctx.fillStyle='rgba(231,238,252,0.9)';
  ctx.textAlign='center';
  ctx.textBaseline='bottom';
  ctx.fillText(xLabel, x + w/2, y + h + 44);

  ctx.save();
  ctx.translate(x - 52, y + h/2);
  ctx.rotate(-Math.PI/2);
  ctx.textAlign='center';
  ctx.textBaseline='top';
  ctx.fillText(yLabel, 0, 0);
  ctx.restore();

  // title
  ctx.fillStyle='rgba(231,238,252,0.92)';
  ctx.font = '13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='left';
  ctx.textBaseline='top';
  ctx.fillText(title, x+10, y+8);

  ctx.restore();
}

function plotLine(ctx, box, xMin,xMax,yMin,yMax, xs, ys, style){
  const {x,y,w,h} = box;
  function X(v){ return x + (v-xMin)/(xMax-xMin)*w; }
  function Y(v){ return y + (yMax-v)/(yMax-yMin)*h; }
  ctx.save();
  ctx.strokeStyle = style.stroke || 'rgba(110,231,255,0.95)';
  ctx.lineWidth = style.width || 2;
  if(style.dash){ ctx.setLineDash(style.dash); }
  ctx.beginPath();
  for(let i=0;i<xs.length;i++){
    const px = X(xs[i]);
    const py = Y(ys[i]);
    if(i===0) ctx.moveTo(px,py);
    else ctx.lineTo(px,py);
  }
  ctx.stroke();
  ctx.restore();
}

function drawLegend(ctx, items, x, y){
  ctx.save();
  ctx.font='12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='left';
  ctx.textBaseline='middle';
  let yy = y;
  items.forEach(it=>{
    ctx.strokeStyle = it.stroke;
    ctx.lineWidth = 3;
    ctx.setLineDash(it.dash || []);
    ctx.beginPath();
    ctx.moveTo(x, yy);
    ctx.lineTo(x+22, yy);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='rgba(231,238,252,0.85)';
    ctx.fillText(it.label, x+30, yy);
    yy += 18;
  });
  ctx.restore();
}

function formatNum(v){
  const av = Math.abs(v);
  if(av>=1000) return v.toFixed(0);
  if(av>=100) return v.toFixed(1);
  if(av>=10) return v.toFixed(2);
  if(av>=1) return v.toFixed(3);
  return v.toFixed(4);
}

/* ---------------------------
   Physics model (envelope)
   a(z,t) = 1 + (m/2) e^{j(Ωt - (β2-β0)z)} + (m/2) e^{-j(Ωt + (β1-β0)z)}
---------------------------- */
const params = {
  m: 0.7,
  fs: 1000,          // Hz (example)
  beta0: 10.0,       // rad/m (example)
  betaDiff: 0.12,    // (β2-β1) rad/m (controlled)
  z: 60.0
};

// In the demo, keep average sideband beta at beta0:
// i.e., (β1+β2)/2 = β0  => β1 = β0 - betaDiff/2, β2 = β0 + betaDiff/2
function betasFromDiff(){
  const beta1 = params.beta0 - params.betaDiff/2;
  const beta2 = params.beta0 + params.betaDiff/2;
  return {beta1, beta2};
}

function envelopeAt(t){
  const Ω = 2*Math.PI*params.fs;
  const {beta1, beta2} = betasFromDiff();
  const Δp = (beta2 - params.beta0) * params.z;
  const Δm = (beta1 - params.beta0) * params.z;
  // term1: 1
  let a = c(1,0);
  // term2: (m/2) e^{j(Ω t - Δp)}
  a = cAdd(a, cMul(c(params.m/2,0), cExpj(Ω*t - Δp)));
  // term3: (m/2) e^{-j(Ω t + Δm)} = (m/2) e^{j(-Ω t - Δm)}
  a = cAdd(a, cMul(c(params.m/2,0), cExpj(-Ω*t - Δm)));
  return a;
}

/* ---------------------------
   Drawing: Diagram
---------------------------- */
function drawDiagram(){
  const canvas = document.getElementById('cDiagram');
  const {ctx,w,h} = fitCanvas(canvas, 320);

  // background
  ctx.clearRect(0,0,w,h);

  // Title
  ctx.fillStyle='rgba(231,238,252,0.92)';
  ctx.font='14px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='left';
  ctx.textBaseline='top';
  ctx.fillText('Three tones propagate through a dispersive medium', 12, 10);

  // Layout coords
  const leftX = 70, rightX = w - 70;
  const midY = h/2 + 10;

  // medium bar
  const barY = midY - 60;
  const barH = 120;
  ctx.fillStyle='rgba(255,255,255,0.04)';
  ctx.strokeStyle='rgba(231,238,252,0.18)';
  ctx.lineWidth=1.2;
  ctx.beginPath();
  roundRect(ctx, leftX, barY, rightX-leftX, barH, 16);
  ctx.fill();
  ctx.stroke();

  // labels
  ctx.fillStyle='rgba(231,238,252,0.75)';
  ctx.font='12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='center';
  ctx.fillText('z = 0', leftX, barY - 18);
  ctx.fillText('z', rightX, barY - 18);

  // arrow showing z
  ctx.strokeStyle='rgba(110,231,255,0.8)';
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(leftX+18, barY-10);
  ctx.lineTo(rightX-18, barY-10);
  ctx.stroke();
  arrowHead(ctx, rightX-18, barY-10, 0);

  // three rays (carrier + sidebands)
  const {beta1, beta2} = betasFromDiff();
  const rows = [
    {label:'Upper sideband ν0+fs', beta:beta2, y: midY - 36, stroke:'rgba(167,139,250,0.95)'},
    {label:'Carrier ν0',          beta:params.beta0, y: midY,      stroke:'rgba(110,231,255,0.95)'},
    {label:'Lower sideband ν0−fs', beta:beta1, y: midY + 36, stroke:'rgba(52,211,153,0.95)'}
  ];

  rows.forEach(r=>{
    ctx.strokeStyle=r.stroke;
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.moveTo(leftX+18, r.y);
    ctx.lineTo(rightX-18, r.y);
    ctx.stroke();
    arrowHead(ctx, rightX-18, r.y, 0);

    // phase text
    ctx.fillStyle='rgba(231,238,252,0.78)';
    ctx.font='12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
    ctx.textAlign='left';
    const phase = r.beta * params.z;
    const txt = `phase = β z ≈ ${formatNum(r.beta)}·${formatNum(params.z)} = ${formatNum(phase)} rad`;
    ctx.fillText(txt, leftX+26, r.y + 10);

    ctx.fillStyle='rgba(231,238,252,0.85)';
    ctx.font='12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillText(r.label, leftX+26, r.y - 18);
  });

  // mismatch highlight
  const mismatch = (beta2 - beta1) * params.z;
  ctx.fillStyle='rgba(251,191,36,0.12)';
  ctx.strokeStyle='rgba(251,191,36,0.45)';
  ctx.lineWidth=1.2;
  const boxX = 16, boxY = h-74, boxW = w-32, boxH = 58;
  ctx.beginPath(); roundRect(ctx, boxX, boxY, boxW, boxH, 14); ctx.fill(); ctx.stroke();

  ctx.fillStyle='rgba(231,238,252,0.9)';
  ctx.font='12.5px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
  ctx.textAlign='left';
  ctx.fillText(`Sideband mismatch phase: (β2 − β1) z = ${formatNum(beta2-beta1)}·${formatNum(params.z)} = ${formatNum(mismatch)} rad`, boxX+12, boxY+12);

  const isPure = nearMultiple(mismatch, 2*Math.PI, 0.04);
  ctx.fillStyle = isPure ? 'rgba(52,211,153,0.95)' : 'rgba(251,191,36,0.95)';
  ctx.font='12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.fillText(isPure ? '≈ 2πn  →  pure AM (no PM)' : 'not 2πn  →  AM + PM', boxX+12, boxY+34);
}

function roundRect(ctx,x,y,w,h,r){
  const rr = Math.min(r, w/2, h/2);
  ctx.moveTo(x+rr,y);
  ctx.arcTo(x+w,y,x+w,y+h,rr);
  ctx.arcTo(x+w,y+h,x,y+h,rr);
  ctx.arcTo(x,y+h,x,y,rr);
  ctx.arcTo(x,y,x+w,y,rr);
  ctx.closePath();
}
function arrowHead(ctx, x, y, angle){
  const size = 8;
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(angle);
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.lineTo(-size, -size*0.6);
  ctx.lineTo(-size, size*0.6);
  ctx.closePath();
  ctx.fillStyle = ctx.strokeStyle;
  ctx.fill();
  ctx.restore();
}
function nearMultiple(val, base, tol){
  const n = Math.round(val/base);
  return Math.abs(val - n*base) < tol;
}

/* ---------------------------
   Drawing: Magnitude and Phase plots
---------------------------- */
function drawMag(){
  const canvas = document.getElementById('cMag');
  const {ctx,w,h} = fitCanvas(canvas, 320);

  const padL=62, padR=16, padT=34, padB=58;
  const box = {x:padL,y:padT,w:w-padL-padR,h:h-padT-padB};

  // time window: 3 modulation periods
  const T = 1/params.fs;
  const tMin = 0, tMax = 3*T;
  const N = 600;
  const xs = new Array(N);
  const ys = new Array(N);
  const ysIdeal = new Array(N);

  // "ideal pure AM envelope" for comparison: 1 + m cos(Ω t - φ_avg)
  // In the demo, φ_avg = ((β1+β2)/2 - β0)z = 0, so ideal is 1 + m cos(Ω t).
  const Ω = 2*Math.PI*params.fs;

  let yMin=+Infinity, yMax=-Infinity;
  for(let i=0;i<N;i++){
    const t = tMin + (tMax-tMin)*i/(N-1);
    const a = envelopeAt(t);
    const mag = cAbs(a);
    const ideal = 1 + params.m*Math.cos(Ω*t); // demo-average locked to carrier
    xs[i]=t*1000; // ms
    ys[i]=mag;
    ysIdeal[i]=Math.max(0, ideal); // keep non-negative for display (envelope magnitude)
    yMin = Math.min(yMin, mag, ideal);
    yMax = Math.max(yMax, mag, ideal);
  }
  // margins
  const yPad = 0.08*(yMax-yMin || 1);
  yMin -= yPad; yMax += yPad;

  drawAxes(ctx, box, tMin*1000, tMax*1000, yMin, yMax, 'time t (ms)', '|a(z,t)| (dimensionless)', 'Envelope magnitude (demo)');

  plotLine(ctx, box, tMin*1000,tMax*1000,yMin,yMax, xs, ys, {stroke:'rgba(110,231,255,0.95)', width:2.4});
  plotLine(ctx, box, tMin*1000,tMax*1000,yMin,yMax, xs, ysIdeal, {stroke:'rgba(231,238,252,0.65)', width:2, dash:[6,4]});

  // legend
  drawLegend(ctx, [
    {label:'|a(z,t)| (dispersive)', stroke:'rgba(110,231,255,0.95)'},
    {label:'ideal pure AM reference', stroke:'rgba(231,238,252,0.65)', dash:[6,4]}
  ], box.x+12, box.y+28);

  // annotation: phase mismatch factor
  const {beta1, beta2} = betasFromDiff();
  const mismatch = (beta2-beta1)*params.z;
  const isPure = nearMultiple(mismatch, 2*Math.PI, 0.04);

  ctx.save();
  ctx.fillStyle = isPure ? 'rgba(52,211,153,0.95)' : 'rgba(251,191,36,0.95)';
  ctx.font='12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.textAlign='left';
  ctx.textBaseline='top';
  ctx.fillText(`(β2−β1)z = ${formatNum(mismatch)} rad  →  ${isPure ? 'pure AM' : 'AM + PM'}`, box.x+12, box.y+48);
  ctx.restore();
}

function unwrapPhases(ph){
  // simple unwrap
  const out = ph.slice();
  let offset = 0;
  for(let i=1;i<out.length;i++){
    let dp = out[i] - out[i-1];
    if(dp > Math.PI) offset -= 2*Math.PI;
    else if(dp < -Math.PI) offset += 2*Math.PI;
    out[i] += offset;
  }
  return out;
}

function drawPhase(){
  const canvas = document.getElementById('cPhase');
  const {ctx,w,h} = fitCanvas(canvas, 320);

  const padL=62, padR=16, padT=34, padB=58;
  const box = {x:padL,y:padT,w:w-padL-padR,h:h-padT-padB};

  const T = 1/params.fs;
  const tMin = 0, tMax = 3*T;
  const N = 600;
  const xs = new Array(N);
  const ph = new Array(N);

  let yMin=+Infinity, yMax=-Infinity;
  for(let i=0;i<N;i++){
    const t = tMin + (tMax-tMin)*i/(N-1);
    const a = envelopeAt(t);
    xs[i]=t*1000;
    ph[i]=cArg(a);
  }
  const phU = unwrapPhases(ph);
  for(let i=0;i<N;i++){
    yMin = Math.min(yMin, phU[i]);
    yMax = Math.max(yMax, phU[i]);
  }

  const yPad = 0.12*(yMax-yMin || 1);
  yMin -= yPad; yMax += yPad;

  drawAxes(ctx, box, tMin*1000, tMax*1000, yMin, yMax, 'time t (ms)', 'arg(a) (rad)', 'Envelope phase (demo)');

  plotLine(ctx, box, tMin*1000,tMax*1000,yMin,yMax, xs, phU, {stroke:'rgba(167,139,250,0.95)', width:2.4});

  // legend
  drawLegend(ctx, [{label:'arg(a(z,t))', stroke:'rgba(167,139,250,0.95)'}], box.x+12, box.y+28);

  // show max phase swing
  const phMin = Math.min(...phU);
  const phMax = Math.max(...phU);
  const swing = phMax - phMin;

  const {beta1, beta2} = betasFromDiff();
  const mismatch = (beta2-beta1)*params.z;
  const isPure = nearMultiple(mismatch, 2*Math.PI, 0.04);

  ctx.save();
  ctx.fillStyle = isPure ? 'rgba(52,211,153,0.95)' : 'rgba(251,191,36,0.95)';
  ctx.font='12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
  ctx.textAlign='left';
  ctx.textBaseline='top';
  ctx.fillText(`phase swing ≈ ${formatNum(swing)} rad`, box.x+12, box.y+48);
  ctx.fillText(isPure ? 'mismatch ≈ 2πn → phase ~ constant' : 'mismatch ≠ 2πn → phase varies', box.x+12, box.y+66);
  ctx.restore();
}

/* ---------------------------
   UI bindings
---------------------------- */
const zSlider = document.getElementById('zSlider');
const betaDiffSlider = document.getElementById('betaDiffSlider');
const zRead = document.getElementById('zRead');
const bdRead = document.getElementById('bdRead');
const nRead = document.getElementById('nRead');
const znRead = document.getElementById('znRead');
const snapBtn = document.getElementById('snapBtn');

function updateDerivedReadout(){
  const bd = params.betaDiff;
  const z = params.z;
  const n = bd > 0 ? Math.round((bd*z)/(2*Math.PI)) : 0;
  const zn = bd > 0 ? (2*Math.PI*n)/bd : 0;
  zRead.textContent = params.z.toFixed(1);
  bdRead.textContent = params.betaDiff.toFixed(3);
  nRead.textContent = String(n);
  znRead.textContent = (isFinite(zn) ? zn : 0).toFixed(2);
}

function redrawAll(){
  updateDerivedReadout();
  drawDiagram();
  drawMag();
  drawPhase();
}

zSlider.addEventListener('input', ()=>{
  params.z = parseFloat(zSlider.value);
  redrawAll();
});
betaDiffSlider.addEventListener('input', ()=>{
  params.betaDiff = parseFloat(betaDiffSlider.value);
  redrawAll();
});

snapBtn.addEventListener('click', ()=>{
  const bd = params.betaDiff;
  if(!(bd>0)) return;
  const n = Math.round((bd*params.z)/(2*Math.PI));
  const zn = (2*Math.PI*n)/bd;
  params.z = Math.max(parseFloat(zSlider.min), Math.min(parseFloat(zSlider.max), zn));
  zSlider.value = params.z;
  redrawAll();
});

window.addEventListener('resize', ()=>{
  redrawAll();
});

// initial
redrawAll();
</script>
</body>
</html>
