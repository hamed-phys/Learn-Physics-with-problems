<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Choosing Fiber-Optic Components for Different Links (Sources, Fibers, Amplifiers, Detectors)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1733;
      --card:#101a3a;
      --text:#eaf0ff;
      --muted:#b8c3e6;
      --faint:#7f8ab5;
      --accent:#7cf1c7;
      --accent2:#86a8ff;
      --warn:#ffcf66;
      --danger:#ff6b8b;
      --ok:#66f2a7;
      --line:rgba(255,255,255,.12);
      --line2:rgba(255,255,255,.18);
      --shadow: 0 18px 45px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 24px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 800px at 80% -10%, rgba(134,168,255,.18), transparent 60%),
        radial-gradient(900px 700px at 10% 0%, rgba(124,241,199,.12), transparent 55%),
        linear-gradient(180deg, var(--bg), #070a14 70%, #060913);
      color:var(--text);
      line-height:1.55;
    }
    a{color:inherit; text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{
      width:min(1180px, 92vw);
      margin: 0 auto;
      padding: 28px 0 70px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 22px;
    }
    header{
      grid-column: 1 / -1;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      padding: 22px 22px 18px;
      position:relative;
      overflow:hidden;
    }
    header::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(900px 220px at 25% 0%, rgba(124,241,199,.12), transparent 60%),
                  radial-gradient(700px 260px at 85% 10%, rgba(134,168,255,.14), transparent 55%);
      pointer-events:none;
      filter: blur(0.2px);
    }
    .kicker{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: var(--muted);
      font-size: 12px;
    }
    .kicker .dot{
      width:10px; height:10px; border-radius:99px;
      background: conic-gradient(from 210deg, var(--accent), var(--accent2), var(--accent));
      box-shadow: 0 0 0 3px rgba(124,241,199,.10);
    }
    h1{
      position:relative;
      margin: 10px 0 6px;
      font-size: clamp(22px, 2.6vw, 34px);
      line-height:1.15;
      letter-spacing: -0.02em;
    }
    .subtitle{
      position:relative;
      color: var(--muted);
      margin: 0;
      max-width: 85ch;
      font-size: 14.5px;
    }
    .meta{
      position:relative;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 12px;
      color: var(--faint);
      font-size: 12.5px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding: 7px 10px;
      border-radius: 999px;
    }
    .pill strong{color:var(--text); font-weight:700}
    nav.toc{
      position: sticky;
      top: 14px;
      align-self:start;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 12px;
      overflow:hidden;
    }
    nav.toc h2{
      margin: 0 0 10px;
      font-size: 13px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: var(--muted);
    }
    .toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid transparent;
      color: var(--text);
      font-size: 13.5px;
      line-height:1.25;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .toc a:hover{
      background: rgba(124,241,199,.07);
      border-color: rgba(124,241,199,.18);
      transform: translateY(-1px);
      text-decoration:none;
    }
    .toc .small{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--line);
      color: var(--faint);
      font-size: 12.5px;
    }
    main{
      background: rgba(255,255,255,.02);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .content{
      padding: 18px 18px 10px;
    }
    section{
      padding: 18px;
      border-top: 1px solid var(--line);
    }
    section:first-of-type{border-top:none}
    section h2{
      margin: 0 0 10px;
      font-size: 18px;
      letter-spacing:-0.01em;
    }
    section h3{
      margin: 14px 0 8px;
      font-size: 15.5px;
      color: var(--muted);
    }
    p{margin: 10px 0}
    ul{margin:10px 0 10px 20px}
    li{margin:6px 0}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr}
      nav.toc{position:relative; top:0}
      .grid2,.grid3{grid-template-columns: 1fr}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px 14px 12px;
    }
    .callout{
      border-radius: var(--radius);
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.03);
      padding: 12px 12px 10px;
      position:relative;
      overflow:hidden;
    }
    .callout::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(124,241,199,.14), transparent 45%);
      opacity:.55;
      pointer-events:none;
    }
    .callout.warn::before{ background: linear-gradient(90deg, rgba(255,207,102,.18), transparent 45%); }
    .callout.danger::before{ background: linear-gradient(90deg, rgba(255,107,139,.18), transparent 45%); }
    .callout.ok::before{ background: linear-gradient(90deg, rgba(102,242,167,.16), transparent 45%); }
    .callout > *{position:relative}
    .label{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .label .tag{
      width:10px;height:10px;border-radius:99px;background:var(--accent);
      box-shadow: 0 0 0 3px rgba(124,241,199,.10);
    }
    .label.warn .tag{background:var(--warn); box-shadow: 0 0 0 3px rgba(255,207,102,.12);}
    .label.danger .tag{background:var(--danger); box-shadow: 0 0 0 3px rgba(255,107,139,.12);}
    .label.ok .tag{background:var(--ok); box-shadow: 0 0 0 3px rgba(102,242,167,.12);}
    .eq{
      font-family: var(--mono);
      background: rgba(0,0,0,.35);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 10px;
      overflow:auto;
      margin: 10px 0;
      white-space: pre;
      tab-size: 2;
    }
    .eqRow{
      display:flex;
      gap:10px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .copyBtn{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 650;
      letter-spacing:.01em;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .copyBtn:hover{
      transform: translateY(-1px);
      background: rgba(124,241,199,.08);
      border-color: rgba(124,241,199,.22);
    }
    .copyBtn:active{transform: translateY(0px) scale(0.99)}
    .copyBtn small{font-weight:700; color:var(--muted)}
    details{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.02);
      border-radius: var(--radius);
      padding: 10px 12px;
      margin: 10px 0;
    }
    summary{
      cursor:pointer;
      font-weight: 750;
      color: var(--muted);
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    summary::before{
      content:"▸";
      margin-right:10px;
      color: var(--accent);
      display:inline-block;
      transform: translateY(-1px);
      transition: transform .15s ease;
    }
    details[open] summary::before{transform: rotate(90deg) translateX(2px)}
    .backTop{
      display:inline-flex;
      gap:8px;
      align-items:center;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 13px;
      transition: transform .12s ease, background .12s ease;
    }
    .backTop:hover{transform: translateY(-1px); background: rgba(134,168,255,.08); text-decoration:none}
    figure{
      margin: 12px 0 0;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.25);
      border-radius: var(--radius2);
      padding: 12px;
      overflow:hidden;
    }
    figcaption{
      margin-top: 10px;
      color: var(--faint);
      font-size: 12.5px;
    }
    canvas{width:100%; height: 320px; display:block; border-radius: 16px;}
    .mono{font-family: var(--mono)}
    footer{
      grid-column: 1 / -1;
      color: var(--faint);
      font-size: 12.5px;
      padding: 10px 2px 0;
    }

    @media (prefers-reduced-motion: no-preference){
      section{animation: fadeUp .35s ease both}
      section:nth-of-type(2){animation-delay: .03s}
      section:nth-of-type(3){animation-delay: .06s}
      section:nth-of-type(4){animation-delay: .09s}
      section:nth-of-type(5){animation-delay: .12s}
      section:nth-of-type(6){animation-delay: .15s}
      section:nth-of-type(7){animation-delay: .18s}
      @keyframes fadeUp{
        from{opacity:0; transform: translateY(6px)}
        to{opacity:1; transform: translateY(0)}
      }
    }

    @media print{
      body{background:#fff;color:#000}
      header, nav.toc, main{box-shadow:none}
      header, nav.toc, main, .card, .callout, figure, .eq{background:#fff}
      .wrap{width:100%; grid-template-columns: 1fr; padding: 0}
      nav.toc{display:none}
      a{color:#000; text-decoration:underline}
      section{break-inside: avoid-page}
      figure{break-inside: avoid}
      .copyBtn{display:none}
      .backTop{display:none}
      canvas{height: 260px}
    }
  </style>
</head>
<body>
  <div id="top"></div>
  <div class="wrap">
    <header>
      <div class="kicker"><span class="dot"></span><span>Optical Fiber Communications • Component Selection</span></div>
      <h1>Choosing Sources, Fibers, Amplifiers, and Detectors for Four Real Links</h1>
      <p class="subtitle">
        We use the wavelength “compatibility map” (materials vs operating bands) to select practical component sets for
        four applications, while explaining the physics: loss windows, dispersion, receiver sensitivity, and engineering trade-offs.
      </p>
      <div class="meta">
        <span class="pill"><strong>Focus:</strong> applied physics + industrial engineering relevance</span>
        <span class="pill"><strong>Outputs:</strong> component choices for (a)–(d)</span>
        <span class="pill"><strong>One static plot:</strong> typical silica attenuation vs wavelength</span>
      </div>
    </header>

    <nav class="toc" aria-label="Table of contents">
      <h2>Table of Contents</h2>
      <a href="#quick">Quick Summary</a>
      <a href="#primer">PART 0 — Concept Primer</a>
      <a href="#industry">PART 0B — Industry &amp; Applied Physics</a>
      <a href="#analysis">PART 1 — Problem Analysis</a>
      <a href="#strategy">PART 2 — Strategy &amp; Tips</a>
      <a href="#solution">PART 3 — Full Solution</a>
      <a href="#deeper">PART 4 — Deeper Understanding</a>
      <a href="#plotguide">PART 5 — Optional Plot Guide</a>
      <div class="small">
        <div><span class="mono">Bands:</span> 850&nbsp;nm (1st gen), 1310&nbsp;nm (2nd), 1550&nbsp;nm (3rd, EDFA-friendly)</div>
        <div style="margin-top:8px;"><a class="backTop" href="#top" title="Back to top">↑ Back to top</a></div>
      </div>
    </nav>

    <main>
      <div class="content">
        <section id="quick">
          <h2>Quick Summary</h2>
          <ul>
            <li><strong>What this is about:</strong> selecting <em>compatible</em> optical components (source, fiber, amplifier, detector) for different link needs.</li>
            <li><strong>Key physics idea:</strong> pick a wavelength band where the fiber has low loss and acceptable dispersion, then match source/detector materials that operate there.</li>
            <li><strong>Governing link relation (power budget):</strong> received power is transmitter power minus losses plus amplifier gains.</li>
            <li><strong>Governing performance idea:</strong> bit-rate–distance is constrained by <em>loss</em> (SNR) and <em>dispersion</em> (pulse spreading/rise-time).</li>
            <li><strong>Main windows:</strong> ~850&nbsp;nm (cheap + MMF), ~1310&nbsp;nm (low dispersion in standard SMF), ~1550&nbsp;nm (lowest loss + optical amplifiers like EDFA).</li>
            <li><strong>Result type:</strong> qualitative/engineering selections (not a numeric design), justified by physics and compatibility ranges.</li>
            <li><strong>Physical meaning:</strong> long-haul needs low loss + amplification; short links can prioritize cost and ease (LED/MMF/Si).</li>
          </ul>

          <div class="callout">
            <div class="label"><span class="tag"></span><span>Key equations (copyable)</span></div>
            <div class="eqRow">
              <pre class="eq" id="eq1" data-copy="Power budget (dB):
P_rx(dBm) = P_tx(dBm) - α(dB/km)·L(km) - ΣL_misc(dB) + ΣG_amp(dB)"></pre>
              <button class="copyBtn" data-copy-target="eq1" type="button" aria-label="Copy power budget equation">
                ⧉ Copy <small>power budget</small>
              </button>
            </div>
            <div class="eqRow">
              <pre class="eq" id="eq2" data-copy="Rise-time / dispersion idea:
Total system rise time t_sys ≈ sqrt(t_tx^2 + t_rx^2 + t_disp^2)
To avoid intersymbol interference, require roughly: t_sys ≲ (0.7 / B)"></pre>
              <button class="copyBtn" data-copy-target="eq2" type="button" aria-label="Copy rise-time equation">
                ⧉ Copy <small>dispersion/rise-time</small>
              </button>
            </div>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="primer">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

          <div class="grid2">
            <div class="card">
              <h3>Core definitions (symbols &amp; SI units)</h3>
              <ul>
                <li><strong>Wavelength</strong> <span class="mono">λ</span> (m, commonly nm): optical carrier wavelength (e.g., 850 nm, 1310 nm, 1550 nm).</li>
                <li><strong>Fiber length</strong> <span class="mono">L</span> (m or km).</li>
                <li><strong>Attenuation coefficient</strong> <span class="mono">α</span> (dB/km): power loss per kilometer.</li>
                <li><strong>Bit rate</strong> <span class="mono">B</span> (b/s): digital data rate; for analog, use bandwidth (Hz).</li>
                <li><strong>Source power</strong> <span class="mono">P_tx</span> (W or dBm): launched optical power.</li>
                <li><strong>Received power</strong> <span class="mono">P_rx</span> (W or dBm): optical power at the detector.</li>
                <li><strong>Amplifier gain</strong> <span class="mono">G_amp</span> (dB): optical gain (e.g., EDFA).</li>
                <li><strong>Dispersion</strong> (ps/(nm·km) or modal delay): pulse broadening mechanisms that limit high-speed distance.</li>
              </ul>
            </div>

            <div class="card">
              <h3>Physical meaning &amp; intuition</h3>
              <ul>
                <li><strong>Loss</strong> reduces received power → worse SNR and higher BER (bit-error rate).</li>
                <li><strong>Dispersion</strong> spreads pulses → neighboring bits overlap (intersymbol interference), even if power is high.</li>
                <li><strong>Single-mode fiber (SMF)</strong> minimizes modal dispersion → best for long/high-rate links.</li>
                <li><strong>Multimode fiber (MMF)</strong> is easier to couple light into and cheaper for short distances but suffers modal dispersion → limits high-rate over long length.</li>
                <li><strong>Detectors:</strong> PIN photodiode is simpler; APD provides internal gain (better sensitivity) but adds noise and complexity.</li>
              </ul>
            </div>
          </div>

          <h3>Key principles &amp; validity conditions</h3>
          <div class="callout">
            <div class="label"><span class="tag"></span><span>Principles used</span></div>
            <ul>
              <li><strong>Compatibility by wavelength:</strong> component material systems only operate efficiently over certain <span class="mono">λ</span> ranges (as in the provided figure).</li>
              <li><strong>Fiber attenuation windows:</strong> silica has favorable “windows” near ~850, ~1310, and ~1550 nm (lowest loss near ~1550 nm).</li>
              <li><strong>Dispersion management:</strong> standard SMF has near-zero chromatic dispersion around ~1310 nm; around ~1550 nm dispersion is larger unless managed (e.g., DSF or compensation).</li>
              <li><strong>Amplification availability:</strong> EDFAs provide strong, practical optical gain mainly in the C/L bands (~1530–1625 nm).</li>
            </ul>
          </div>

          <h3>Common models/approximations (why engineers use them)</h3>
          <ul>
            <li><strong>dB arithmetic:</strong> cascading losses and gains becomes simple addition in dB (fast for system-level design).</li>
            <li><strong>Rise-time budget:</strong> instead of full eye-diagram simulation, approximate combined bandwidth limits using root-sum-square of rise times.</li>
            <li><strong>Window-based design:</strong> pick from the three “generations” of wavelengths (≈850/1310/1550 nm) as a first pass, then refine.</li>
          </ul>

          <h3>Mini intuition examples (minimal algebra)</h3>
          <ul>
            <li><strong>Short link (meters):</strong> loss and dispersion are tiny → cost dominates → LED + MMF + Si PIN often wins.</li>
            <li><strong>1 km at moderate rate:</strong> dispersion starts to matter for MMF at high rate; SMF or 1310 nm operation is a safe “industrial default.”</li>
            <li><strong>100 km span:</strong> even 0.2 dB/km produces ~20 dB loss → you either need high power, sensitive receiver, and/or optical amplifiers/repeaters.</li>
          </ul>

          <div class="callout warn">
            <div class="label warn"><span class="tag"></span><span>What to watch for (pitfalls)</span></div>
            <ul>
              <li><strong>Incompatible wavelength pairing:</strong> e.g., 1550 nm laser with a Si detector (Si cuts off near ~1.0–1.1 μm).</li>
              <li><strong>MMF at high bit rate over long length:</strong> modal dispersion can dominate, even if loss is acceptable.</li>
              <li><strong>Amplifier band mismatch:</strong> EDFA gain bands don’t cover 850 nm or 1310 nm well.</li>
              <li><strong>Temperature sensitivity:</strong> laser wavelength and output power vary with temperature; uncooled lasers can drift into worse dispersion/receiver alignment.</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="industry">
          <h2>PART 0B — Industry &amp; Applied Physics Perspective</h2>

          <div class="grid3">
            <div class="card">
              <h3>Where this appears in industry</h3>
              <ul>
                <li><strong>Telecom &amp; subsea:</strong> transoceanic cables, metro/backbone networks.</li>
                <li><strong>Data centers &amp; LANs:</strong> short-reach interconnects, switch-to-switch links.</li>
                <li><strong>Industrial sensing:</strong> sensor backhaul in factories, power plants, rail systems.</li>
                <li><strong>Utilities &amp; infrastructure:</strong> SCADA links, substation communications.</li>
              </ul>
            </div>

            <div class="card">
              <h3>Why engineers care</h3>
              <ul>
                <li><strong>Performance:</strong> bandwidth, BER, latency, reach.</li>
                <li><strong>Reliability:</strong> temperature variation, aging, connector contamination, repairability.</li>
                <li><strong>Cost:</strong> transceiver BOM, installation labor, spares, energy use (amplifiers/thermal control).</li>
                <li><strong>Manufacturability:</strong> alignment tolerances (MMF is forgiving; SMF is tighter).</li>
              </ul>
            </div>

            <div class="card">
              <h3>How it’s validated</h3>
              <ul>
                <li><strong>Optical power budget tests:</strong> OPM/OLTS measurements, insertion loss, return loss.</li>
                <li><strong>Dispersion/eye quality:</strong> BER testers, eye diagrams, chromatic dispersion measurements.</li>
                <li><strong>Spectrum checks:</strong> OSA verification of source wavelength/drift.</li>
                <li><strong>Environmental qualification:</strong> thermal cycling, vibration, humidity (industrial standards).</li>
              </ul>
            </div>
          </div>

          <h3>Design trade-offs &amp; real constraints</h3>
          <div class="callout">
            <div class="label"><span class="tag"></span><span>Trade-offs</span></div>
            <ul>
              <li><strong>850 nm vs 1310/1550 nm:</strong> 850 nm components can be cheaper (Si detectors, MMF optics), but loss and reach are worse than 1550 nm long-haul.</li>
              <li><strong>PIN vs APD:</strong> APD improves sensitivity (useful when power is scarce) but increases noise, needs high bias, and is more complex to qualify.</li>
              <li><strong>SMF vs MMF:</strong> SMF enables long/high-rate but requires better alignment and sometimes tighter connector cleanliness practices.</li>
              <li><strong>Temperature management:</strong> adding a TEC (thermo-electric cooler) stabilizes lasers but increases cost and power consumption.</li>
            </ul>
          </div>

          <details>
            <summary>From lab to product: adapting the idealized model</summary>
            <p>
              In textbooks, you often choose components by wavelength compatibility and assume stable output power and perfect connectors.
              In products, you add margins: connector aging, splice repairs, bend losses, amplifier noise figure, and temperature drift.
              The “right” choice is usually the cheapest architecture that still meets BER and availability targets with comfortable margin
              across environmental and manufacturing variations.
            </p>
          </details>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="analysis">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

          <h3>Problem restatement (in plain words)</h3>
          <p>
            For each of four applications, choose an appropriate combination of
            <strong>fiber type</strong>, <strong>optical source</strong>, <strong>amplifier (if needed)</strong>,
            and <strong>detector</strong>, consistent with the wavelength-operation ranges shown in the given figure.
            Multiple answers may be acceptable, but some combinations are incompatible.
          </p>

          <div class="grid2">
            <div class="card">
              <h3>Given</h3>
              <ul>
                <li>(a) Transoceanic cable: <span class="mono">B = 2.5 Gb/s</span>, repeater spacing <span class="mono">L ≈ 100 km</span>.</li>
                <li>(b) 1 m analog sensor link: <span class="mono">f ≈ 1 kHz</span>.</li>
                <li>(c) Computer LAN: <span class="mono">B = 500 Mb/s</span> (distance not specified → typical short/medium reach).</li>
                <li>(d) 1 km data link: <span class="mono">B = 100 Mb/s</span>, temperature variation <span class="mono">±50°C</span>.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Unknowns</h3>
              <ul>
                <li>Choose operating <strong>wavelength band</strong> (≈850, 1310, 1550 nm, or telecom bands O/E/S/C/L/U).</li>
                <li>Select <strong>source technology/material</strong> (LED vs laser; AlGaAs vs InGaAsP).</li>
                <li>Select <strong>detector material/type</strong> (Si, Ge, InGaAs; PIN vs APD).</li>
                <li>Select <strong>fiber type</strong> (MMF step/GRIN vs SMF vs DSF).</li>
                <li>Decide if an <strong>optical amplifier</strong> (e.g., EDFA) is appropriate.</li>
              </ul>
            </div>
          </div>

          <h3>Relevant principles &amp; why they apply</h3>
          <ul>
            <li><strong>Link distance &amp; loss:</strong> long spans (100 km) strongly favor low-loss bands and amplification.</li>
            <li><strong>Bit rate &amp; dispersion:</strong> multi-Gb/s requires dispersion control (especially over tens of km and more).</li>
            <li><strong>Cost/performance matching:</strong> for very short links (1 m, 1 kHz), “telecom-grade” components are unnecessary.</li>
            <li><strong>Environmental robustness:</strong> wide temperature range pushes designs toward stable wavelength choices and/or temperature control.</li>
          </ul>

          <div class="callout warn">
            <div class="label warn"><span class="tag"></span><span>Assumptions (explicit)</span></div>
            <ul>
              <li>“Appropriate choices” means a physically compatible, common engineering solution (not an exhaustive optimization).</li>
              <li>For LAN (c), assume typical building/data-center distances (tens to hundreds of meters) unless stated otherwise.</li>
              <li>We prioritize choices consistent with standard telecom practice: 850 nm for short-reach, 1310 nm for low-dispersion SMF, 1550 nm for lowest loss + EDFA compatibility.</li>
              <li>We use the figure’s compatibility ranges as the primary constraint (source/detector/amplifier/fiber must overlap in wavelength).</li>
            </ul>
          </div>

          <h3>Possible approaches (compare 2–3)</h3>
          <div class="grid3">
            <div class="card">
              <h3>Approach A: “Three windows” heuristic</h3>
              <p>
                Choose among 850/1310/1550 nm first, then pick compatible materials and fiber type.
              </p>
              <ul>
                <li><strong>Pros:</strong> fast, industry-aligned.</li>
                <li><strong>Cons:</strong> less precise for WDM bands and dispersion-managed systems.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Approach B: Link-budget-first</h3>
              <p>
                Start from distance and required power margin; add amplification or higher-sensitivity detectors.
              </p>
              <ul>
                <li><strong>Pros:</strong> very practical for long-haul.</li>
                <li><strong>Cons:</strong> can overlook dispersion limits if used alone.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Approach C: Dispersion-first</h3>
              <p>
                Start from bit rate and length; choose fiber type/wavelength to control dispersion, then handle power.
              </p>
              <ul>
                <li><strong>Pros:</strong> strong for high-speed systems.</li>
                <li><strong>Cons:</strong> may be overkill for short/low-speed links.</li>
              </ul>
            </div>
          </div>

          <p>
            <strong>Best choice here:</strong> a hybrid of <strong>Approach A</strong> (quick wavelength window selection)
            plus targeted checks from <strong>B</strong> (loss &amp; amplification) and <strong>C</strong> (dispersion) for the long and fast cases.
          </p>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="strategy">
          <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>

          <ol>
            <li><strong>Classify the link</strong> (short vs long, low vs high bit rate) to decide if loss/dispersion are dominant.</li>
            <li><strong>Pick the wavelength band</strong> that best matches needs (850 for cheap short reach; 1310 for low dispersion SMF; 1550 for lowest loss and EDFA).</li>
            <li><strong>Select fiber type</strong> (MMF for short/cost, SMF for long/high-rate; DSF if operating near 1550 and dispersion matters).</li>
            <li><strong>Select the source</strong> (LED for low-speed/low-cost; laser for higher speed/longer reach) consistent with that wavelength band.</li>
            <li><strong>Select the detector</strong> material that responds at that wavelength (Si for ~850; Ge/InGaAs for 1310/1550).</li>
            <li><strong>Decide on amplification</strong> (EDFA mainly for 1550 C/L band; otherwise use electrical regeneration or none).</li>
            <li><strong>Check incompatibilities</strong> (material cutoffs, amplifier band mismatch, MMF dispersion at high bit rate).</li>
            <li><strong>Add “industrial margin” thinking</strong> (temperature drift, connector variability, maintainability).</li>
          </ol>

          <div class="callout danger">
            <div class="label danger"><span class="tag"></span><span>Common mistakes (quick tips)</span></div>
            <ul>
              <li><strong>Using Si detectors at 1310/1550 nm:</strong> Si won’t detect efficiently there → choose Ge or InGaAs.</li>
              <li><strong>Expecting EDFA outside 1550 bands:</strong> EDFA is not a general-purpose amplifier for 850/1310 nm.</li>
              <li><strong>Choosing MMF for long/high-rate:</strong> modal dispersion can destroy the eye diagram even if power seems adequate.</li>
              <li><strong>Ignoring temperature:</strong> uncooled lasers drift in wavelength and output; choose 1310 nm or add stabilization if needed.</li>
            </ul>
          </div>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="solution">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

          <h3>Start with qualitative expectations</h3>
          <ul>
            <li><strong>(a) 2.5 Gb/s over 100 km spans:</strong> must use <em>SMF</em> and a low-loss band, likely 1550 nm with <em>optical amplification</em> and a laser source.</li>
            <li><strong>(b) 1 m, 1 kHz analog:</strong> physics constraints are minimal → choose cheapest, simplest compatible components (LED + MMF + Si detector).</li>
            <li><strong>(c) 500 Mb/s LAN:</strong> moderate/high speed but typically short → MMF at 850 nm with a laser (e.g., VCSEL class) is common; Si PIN detection works.</li>
            <li><strong>(d) 1 km, 100 Mb/s, ±50°C:</strong> moderate reach + harsh temperature → prefer a robust wavelength/dispersion point and stable components (often 1310 nm on SMF), or require stabilization if using a laser.</li>
          </ul>

          <h3>Step 1: Use the figure as a “compatibility filter”</h3>
          <p>
            The given chart tells us which materials operate over which wavelengths:
          </p>
          <ul>
            <li><strong>Sources:</strong> AlGaAs (near ~800–900 nm) and InGaAsP (roughly ~1200–1600+ nm).</li>
            <li><strong>Detectors:</strong> Si (up to about ~1.0–1.1 μm), Ge (extends to ~1.6 μm), InGaAs (roughly ~1.0–1.7 μm).</li>
            <li><strong>Amplifiers:</strong> EDFA works in ~1550 region (C/L bands), while other amplifiers may cover parts of 1300–1600 depending on type.</li>
            <li><strong>Fibers:</strong> silica-based fibers operate across these windows; SMF/DSF are used for long-haul/high rate.</li>
          </ul>
          <p>
            So our first physics rule is: <strong>choose λ, then ensure every component can operate at that λ</strong>.
          </p>

          <h3>Step 2: Apply distance + bit-rate physics to choose λ and fiber</h3>

          <div class="callout">
            <div class="label"><span class="tag"></span><span>Loss argument (why 1550 nm wins for long-haul)</span></div>
            <p>
              For very long spans, the attenuation term <span class="mono">α·L</span> dominates the power budget.
              Silica fiber has its <strong>lowest attenuation near ~1550 nm</strong>, so this is the standard long-haul window.
            </p>
            <pre class="eq" id="eq3" data-copy="Power budget reminder:
P_rx(dBm) = P_tx(dBm) - α·L - ΣL_misc + ΣG_amp

Long-haul trick:
Choose λ where α is minimal (≈1550 nm) and use optical amplifiers (EDFA) to restore power."></pre>
            <button class="copyBtn" data-copy-target="eq3" type="button">⧉ Copy <small>long-haul logic</small></button>
          </div>

          <p>
            For dispersion: at multi-Gb/s, SMF is strongly preferred to avoid modal dispersion. At 1550 nm, chromatic dispersion in standard SMF is nonzero;
            one classic fix is to use <strong>dispersion-shifted fiber (DSF)</strong> or dispersion management if the span is long and the bit rate is high.
          </p>

          <details>
            <summary>Why 1310 nm is attractive for “robust industrial” links</summary>
            <p>
              Standard SMF has near-zero chromatic dispersion around ~1310 nm. That means pulses spread less due to wavelength drift/linewidth.
              In harsh temperature environments, wavelength drift from uncooled lasers is a real effect; operating near a low-dispersion point reduces sensitivity
              to that drift, improving eye opening without requiring elaborate dispersion compensation.
            </p>
          </details>

          <h3>Step 3: Select compatible source/detector/amplifier per case</h3>
          <p>
            Now we map each application to a typical wavelength band and choose components consistent with the figure and with engineering practice.
          </p>

          <div class="callout ok" style="margin-top:12px;">
            <div class="label ok"><span class="tag"></span><span>Final answer (copyable)</span></div>
            <div class="eqRow" style="align-items:flex-start;">
              <pre class="eq" id="final" data-copy="FINAL COMPONENT CHOICES (one strong set per case)

(a) Transoceanic, 2.5 Gb/s, 100-km repeater spacing:
- Wavelength band: 1550 nm (C-band) (lowest loss, EDFA-friendly)
- Fiber: SMF (often dispersion-managed); consider DSF/dispersion compensation for 2.5 Gb/s over 100 km
- Source: InGaAsP laser (DFB-class) at ~1550 nm
- Amplifier: EDFA (in-line optical amplifier at repeaters)
- Detector: InGaAs PIN or InGaAs APD (APD if extra sensitivity margin is needed)

(b) 1 m analog sensor link at 1 kHz:
- Wavelength band: 850 nm (cheap short-reach window)
- Fiber: MMF (step-index or GRIN)
- Source: AlGaAs LED (or low-cost 850 nm laser if desired, but unnecessary)
- Amplifier: none
- Detector: Si PIN photodiode

(c) Computer LAN at 500 Mb/s (typical short/medium reach):
- Wavelength band: 850 nm (short-reach high-volume optics)
- Fiber: MMF (prefer GRIN for reduced modal dispersion)
- Source: 850 nm laser (AlGaAs-based; commonly VCSEL-class in practice)
- Amplifier: none
- Detector: Si PIN (APD optional but usually not required)

(d) 1 km, 100 Mb/s with ±50°C temperature variations:
- Wavelength band: 1310 nm (O-band: low chromatic dispersion in standard SMF; robust vs wavelength drift)
- Fiber: SMF (good margin over 1 km, low dispersion)
- Source: InGaAsP LED or InGaAsP laser at ~1310 nm
  * industrial note: if using a laser, prefer temperature stabilization (TEC) or a spec’d uncooled design with margin
- Amplifier: none
- Detector: Ge PIN or InGaAs PIN (both cover ~1310 nm; InGaAs commonly preferred for performance)"></pre>
              <button class="copyBtn" data-copy-target="final" type="button" style="height:fit-content;">⧉ Copy <small>final answer</small></button>
            </div>
          </div>

          <h3>Sanity checks (why these choices make sense)</h3>
          <div class="grid2">
            <div class="card">
              <h3>Compatibility check</h3>
              <ul>
                <li><strong>850 nm:</strong> AlGaAs source + Si detector are compatible; MMF works well.</li>
                <li><strong>1310 nm:</strong> InGaAsP source + Ge/InGaAs detector are compatible; SMF/ silica window.</li>
                <li><strong>1550 nm:</strong> InGaAsP source + InGaAs detector are compatible; EDFA works in this region.</li>
              </ul>
            </div>
            <div class="card">
              <h3>Physics check</h3>
              <ul>
                <li><strong>Long-haul (a):</strong> lowest-loss band + amplification is essential; SMF avoids modal dispersion.</li>
                <li><strong>Very short (b):</strong> bandwidth and loss margins are huge → simplest/cheapest components dominate.</li>
                <li><strong>LAN (c):</strong> 850 nm MMF supports high-volume, cost-effective transceivers at hundreds of Mb/s.</li>
                <li><strong>Temperature (d):</strong> 1310 nm on SMF reduces dispersion sensitivity to wavelength drift.</li>
              </ul>
            </div>
          </div>

          <h3>Optional: one helpful plot (typical silica attenuation vs wavelength)</h3>
          <figure aria-label="Typical attenuation curve for silica fiber">
            <canvas id="attPlot" width="1200" height="640"></canvas>
            <figcaption>
              <strong>Figure:</strong> Typical silica fiber attenuation (example curve) showing why ~1550 nm is favored for long-haul and why ~850 nm is acceptable for short links.
              Values are representative “textbook typical” example values used only to illustrate trends (not a substitute for a datasheet).
            </figcaption>
          </figure>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="deeper">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

          <h3>Re-interpret the selections: what controls what?</h3>
          <ul>
            <li><strong>Wavelength</strong> sets: fiber loss level, dispersion regime, and which materials (source/detector) are feasible.</li>
            <li><strong>Fiber type</strong> sets: modal dispersion (MMF) vs alignment tolerance and reach (SMF).</li>
            <li><strong>Source type</strong> sets: modulation bandwidth (laser &gt; LED), linewidth (affects chromatic dispersion), cost, and temperature drift behavior.</li>
            <li><strong>Detector type</strong> sets: sensitivity and noise (APD can help power-limited cases but adds complexity).</li>
            <li><strong>Amplifier choice</strong> sets: feasible long-span architecture (EDFA makes 1550 nm systems scalable).</li>
          </ul>

          <h3>Parameter dependence (qualitative)</h3>
          <div class="callout">
            <div class="label"><span class="tag"></span><span>How changes push design decisions</span></div>
            <ul>
              <li>If <strong>L increases</strong> (everything else fixed) → loss dominates → move toward 1550 nm + SMF + amplification.</li>
              <li>If <strong>B increases</strong> at moderate/long L → dispersion dominates → move toward SMF (and maybe DSF/dispersion management) + laser.</li>
              <li>If <strong>temperature range increases</strong> → either stabilize the laser (TEC) or choose a regime less sensitive to wavelength drift (often 1310 nm SMF for moderate reach).</li>
              <li>If <strong>cost pressure increases</strong> and reach is short → favor 850 nm MMF + Si detector + simpler optics.</li>
            </ul>
          </div>

          <h3>Alternative derivation idea (brief but meaningful)</h3>
          <p>
            Instead of starting from wavelength windows, you can start from a <strong>rise-time budget</strong> and a <strong>power budget</strong> simultaneously:
            pick candidate (fiber, λ) pairs, estimate <span class="mono">t_disp</span> and <span class="mono">α·L</span>, then see whether a PIN receiver has enough sensitivity margin.
            If not, upgrade in this order: (i) better λ (lower α), (ii) SMF/dispersion management, (iii) APD, (iv) optical amplification.
          </p>

          <h3>Concept check (self-test, with answers)</h3>
          <ul>
            <li><strong>Q:</strong> Why not use 850 nm for a 100 km span? <strong>A:</strong> Higher attenuation at 850 nm would create too much loss, and amplification options like EDFA are not available there.</li>
            <li><strong>Q:</strong> Why is SMF preferred over MMF for long/high-rate links? <strong>A:</strong> SMF eliminates modal dispersion, which can dominate MMF at high rates and long lengths.</li>
            <li><strong>Q:</strong> Why is 1310 nm often considered “robust” for moderate-length links? <strong>A:</strong> Standard SMF has near-zero chromatic dispersion around 1310 nm, reducing sensitivity to source linewidth and wavelength drift.</li>
            <li><strong>Q:</strong> When would you choose an APD instead of a PIN? <strong>A:</strong> When the link is power-limited and additional receiver sensitivity is needed, accepting higher noise/complexity.</li>
          </ul>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>

        <section id="plotguide">
          <h2>PART 5 — Optional Plot Guide (Because a Plot Exists)</h2>

          <h3>What the plot shows and why it’s useful</h3>
          <p>
            The plot is a <strong>representative attenuation curve</strong> for silica fiber:
            attenuation (dB/km) versus wavelength (nm). It visually explains the core engineering motivation:
            <strong>choose ~1550 nm for long-haul because loss is lowest</strong>, while <strong>850 nm can be perfectly fine for short reach</strong> where distance is tiny.
          </p>

          <h3>Axes, units, and example values</h3>
          <ul>
            <li><strong>x-axis:</strong> wavelength <span class="mono">λ</span> in nm (from ~700 to ~1700 nm).</li>
            <li><strong>y-axis:</strong> attenuation in dB/km (log-like range but plotted linearly here for clarity).</li>
            <li><strong>Example values:</strong> typical textbook-like points (e.g., ~2.5 dB/km at 850 nm, ~0.35 dB/km at 1310 nm, ~0.2 dB/km at 1550 nm) used only to illustrate trend.</li>
          </ul>

          <h3>Features to notice</h3>
          <ul>
            <li><strong>Minimum near 1550 nm:</strong> explains long-haul preference and why EDFAs (C/L bands) are so valuable.</li>
            <li><strong>Higher loss near 850 nm:</strong> still acceptable for meters to a few hundred meters, especially with cheap components.</li>
            <li><strong>“1310 nm window”:</strong> intermediate loss; often paired with low dispersion in standard SMF for robust moderate links.</li>
          </ul>

          <a class="backTop" href="#top">↑ Back to top</a>
        </section>
      </div>
    </main>

    <footer>
      <p>
        Built as a self-contained learning article (vanilla HTML/CSS/JS). Component selections are “strong typical choices” consistent with wavelength-compatibility ranges and standard engineering practice.
      </p>
    </footer>
  </div>

  <script>
    // Copy buttons (plain text)
    (function(){
      function getCopyTextFromEl(el){
        if(!el) return "";
        const explicit = el.getAttribute("data-copy");
        if(explicit && explicit.trim()) return explicit.trim();
        return (el.textContent || "").trim();
      }
      async function copyText(txt){
        try{
          await navigator.clipboard.writeText(txt);
          return true;
        }catch(e){
          // Fallback
          const ta = document.createElement("textarea");
          ta.value = txt;
          ta.setAttribute("readonly", "");
          ta.style.position = "fixed";
          ta.style.top = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          let ok = false;
          try{ ok = document.execCommand("copy"); }catch(_e){ ok=false; }
          document.body.removeChild(ta);
          return ok;
        }
      }
      function flash(btn, ok){
        const prev = btn.innerHTML;
        btn.innerHTML = ok ? "✓ Copied" : "✕ Copy failed";
        btn.style.borderColor = ok ? "rgba(102,242,167,.35)" : "rgba(255,107,139,.35)";
        btn.style.background = ok ? "rgba(102,242,167,.10)" : "rgba(255,107,139,.10)";
        setTimeout(()=>{
          btn.innerHTML = prev;
          btn.style.borderColor = "";
          btn.style.background = "";
        }, 900);
      }
      document.addEventListener("click", async (ev)=>{
        const btn = ev.target.closest(".copyBtn");
        if(!btn) return;
        const id = btn.getAttribute("data-copy-target");
        const target = id ? document.getElementById(id) : null;
        const txt = getCopyTextFromEl(target);
        const ok = await copyText(txt);
        flash(btn, ok);
      });
    })();

    // One static plot (canvas): typical silica attenuation vs wavelength
    (function(){
      const canvas = document.getElementById("attPlot");
      if(!canvas) return;

      function draw(){
        const parent = canvas.parentElement;
        const cssW = Math.max(320, parent.clientWidth - 2);
        const cssH = 320;

        const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
        canvas.style.width = cssW + "px";
        canvas.style.height = cssH + "px";
        canvas.width = Math.floor(cssW * dpr);
        canvas.height = Math.floor(cssH * dpr);

        const ctx = canvas.getContext("2d");
        ctx.setTransform(dpr,0,0,dpr,0,0);
        ctx.clearRect(0,0,cssW,cssH);

        // Plot area
        const padL = 60, padR = 18, padT = 44, padB = 44;
        const x0 = padL, y0 = cssH - padB;
        const w = cssW - padL - padR;
        const h = cssH - padT - padB;

        // Axes ranges
        const xmin = 700, xmax = 1700; // nm
        const ymin = 0, ymax = 3.0; // dB/km (illustrative)

        function X(x){ return x0 + (x - xmin) * w / (xmax - xmin); }
        function Y(y){ return y0 - (y - ymin) * h / (ymax - ymin); }

        // Background
        ctx.fillStyle = "rgba(255,255,255,0.02)";
        roundRect(ctx, x0-10, padT-10, w+20, h+20, 16);
        ctx.fill();

        // Grid
        ctx.lineWidth = 1;
        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        // x ticks every 100 nm
        for(let x=700; x<=1700; x+=100){
          const xx = X(x);
          ctx.beginPath();
          ctx.moveTo(xx, padT);
          ctx.lineTo(xx, y0);
          ctx.stroke();
        }
        // y ticks every 0.5 dB/km
        for(let y=0; y<=3.0+1e-9; y+=0.5){
          const yy = Y(y);
          ctx.beginPath();
          ctx.moveTo(x0, yy);
          ctx.lineTo(x0+w, yy);
          ctx.stroke();
        }

        // Axes
        ctx.strokeStyle = "rgba(255,255,255,0.22)";
        ctx.lineWidth = 1.2;
        ctx.beginPath();
        ctx.moveTo(x0, padT);
        ctx.lineTo(x0, y0);
        ctx.lineTo(x0+w, y0);
        ctx.stroke();

        // Labels
        ctx.fillStyle = "rgba(234,240,255,0.95)";
        ctx.font = "700 14px " + getSans();
        ctx.textAlign = "left";
        ctx.textBaseline = "alphabetic";
        ctx.fillText("Typical Silica Fiber Attenuation vs Wavelength (example curve)", x0, 24);

        ctx.fillStyle = "rgba(184,195,230,0.95)";
        ctx.font = "600 12px " + getSans();

        // x-axis label
        ctx.textAlign = "center";
        ctx.fillText("Wavelength λ (nm)", x0 + w/2, cssH - 12);

        // y-axis label (rotated)
        ctx.save();
        ctx.translate(18, padT + h/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = "center";
        ctx.fillText("Attenuation (dB/km)", 0, 0);
        ctx.restore();

        // Tick labels
        ctx.fillStyle = "rgba(184,195,230,0.90)";
        ctx.font = "600 11px " + getSans();

        // x ticks
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        for(let x=700; x<=1700; x+=200){
          const xx = X(x);
          ctx.fillText(String(x), xx, y0 + 6);
        }
        // y ticks
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        for(let y=0; y<=3.0+1e-9; y+=0.5){
          const yy = Y(y);
          ctx.fillText(y.toFixed(1), x0 - 8, yy);
        }

        // Construct a smooth-ish illustrative curve:
        const pts = [
          {x:700,  y:2.9},
          {x:800,  y:2.7},
          {x:850,  y:2.5},
          {x:950,  y:1.6},
          {x:1050, y:1.1},
          {x:1200, y:0.55},
          {x:1310, y:0.35},
          {x:1450, y:0.32},
          {x:1550, y:0.20},
          {x:1625, y:0.23},
          {x:1700, y:0.35}
        ];

        // Draw curve
        ctx.lineWidth = 2.2;
        ctx.strokeStyle = "rgba(124,241,199,0.92)";
        ctx.beginPath();
        for(let i=0;i<pts.length;i++){
          const p = pts[i];
          const xx = X(p.x), yy = Y(p.y);
          if(i===0) ctx.moveTo(xx, yy);
          else{
            const prev = pts[i-1];
            const mx = (prev.x + p.x)/2;
            const my = (prev.y + p.y)/2;
            ctx.quadraticCurveTo(X(prev.x), Y(prev.y), X(mx), Y(my));
            if(i === pts.length-1){
              ctx.quadraticCurveTo(X(p.x), Y(p.y), X(p.x), Y(p.y));
            }
          }
        }
        ctx.stroke();

        // Mark the three common windows
        const marks = [
          {x:850,  label:"850 nm",  y:2.5},
          {x:1310, label:"1310 nm", y:0.35},
          {x:1550, label:"1550 nm", y:0.20}
        ];
        for(const m of marks){
          const xx = X(m.x), yy = Y(m.y);
          ctx.fillStyle = "rgba(255,255,255,0.92)";
          ctx.beginPath();
          ctx.arc(xx, yy, 4.5, 0, Math.PI*2);
          ctx.fill();

          ctx.strokeStyle = "rgba(255,255,255,0.18)";
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(xx, yy);
          ctx.lineTo(xx, y0);
          ctx.stroke();

          const text = m.label;
          ctx.font = "700 11px " + getSans();
          const tw = ctx.measureText(text).width;
          const bx = Math.min(x0+w- (tw+18), Math.max(x0+6, xx + 10));
          const by = Math.max(padT+6, yy - 22);
          ctx.fillStyle = "rgba(15,23,51,0.78)";
          ctx.strokeStyle = "rgba(255,255,255,0.14)";
          ctx.lineWidth = 1;
          roundRect(ctx, bx, by, tw+14, 18, 9);
          ctx.fill();
          ctx.stroke();

          ctx.fillStyle = "rgba(234,240,255,0.96)";
          ctx.textAlign = "left";
          ctx.textBaseline = "middle";
          ctx.fillText(text, bx+7, by+9);
        }

        // Legend
        const legX = x0 + 12, legY = padT + 8;
        ctx.fillStyle = "rgba(0,0,0,0.25)";
        ctx.strokeStyle = "rgba(255,255,255,0.12)";
        ctx.lineWidth = 1;
        roundRect(ctx, legX, legY, 220, 46, 12);
        ctx.fill();
        ctx.stroke();

        ctx.strokeStyle = "rgba(124,241,199,0.92)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(legX+12, legY+16);
        ctx.lineTo(legX+44, legY+16);
        ctx.stroke();

        ctx.fillStyle = "rgba(184,195,230,0.95)";
        ctx.font = "700 12px " + getSans();
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";
        ctx.fillText("Example attenuation curve", legX+54, legY+16);

        ctx.fillStyle = "rgba(127,138,181,0.95)";
        ctx.font = "600 11px " + getSans();
        ctx.fillText("Illustrates why 1550 nm is long-haul", legX+12, legY+34);
      }

      function roundRect(ctx, x, y, w, h, r){
        const rr = Math.min(r, w/2, h/2);
        ctx.beginPath();
        ctx.moveTo(x+rr, y);
        ctx.arcTo(x+w, y, x+w, y+h, rr);
        ctx.arcTo(x+w, y+h, x, y+h, rr);
        ctx.arcTo(x, y+h, x, y, rr);
        ctx.arcTo(x, y, x+w, y, rr);
        ctx.closePath();
      }
      function getSans(){
        return 'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
      }

      let raf = null;
      function requestDraw(){
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(draw);
      }
      window.addEventListener("resize", requestDraw, {passive:true});
      requestDraw();
    })();
  </script>
</body>
</html>
