<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Time Budget for a Dispersion-Limited Fiber-Optic Link (100 km @ 1550 nm)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#101a33;
      --card2:#0f1730;
      --text:#eaf0ff;
      --muted:#b9c4e6;
      --faint:#7f8ab3;
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --line:rgba(255,255,255,.10);
      --shadow: 0 14px 34px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(125,211,252,.14), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(167,139,250,.14), transparent 55%),
        radial-gradient(900px 700px at 60% 85%, rgba(52,211,153,.10), transparent 60%),
        linear-gradient(180deg, #070a14 0%, #0b1020 30%, #070a14 100%);
      color:var(--text);
      line-height:1.55;
    }

    header{
      padding: clamp(18px, 3vw, 34px) clamp(16px, 4vw, 56px) 18px;
      border-bottom:1px solid var(--line);
      position:relative;
      overflow:hidden;
    }
    header::after{
      content:"";
      position:absolute;
      inset:-80px -120px auto -120px;
      height:220px;
      background: radial-gradient(closest-side, rgba(125,211,252,.22), transparent 70%);
      filter: blur(2px);
      opacity:.9;
      pointer-events:none;
      transform: rotate(-3deg);
    }
    .title-wrap{
      position:relative;
      z-index:1;
      max-width: 1200px;
      margin:0 auto;
      display:grid;
      gap:10px;
    }
    h1{
      margin:0;
      font-size: clamp(22px, 2.5vw, 34px);
      letter-spacing:.2px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      max-width: 78ch;
      font-size: clamp(13px, 1.15vw, 15px);
    }

    main{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px clamp(16px, 4vw, 56px) 60px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
      align-items:start;
    }

    nav.toc{
      position: sticky;
      top: 14px;
      align-self:start;
      background: linear-gradient(180deg, rgba(16,26,51,.92), rgba(15,23,48,.92));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 10px;
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .toc h2{
      margin:0 0 8px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .12em;
      color: var(--muted);
    }
    .toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--text);
      text-decoration:none;
      font-size: 13.5px;
      border: 1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .toc a:hover{
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.18);
      transform: translateY(-1px);
    }
    .toc .mini{
      color: var(--faint);
      font-size: 12px;
      margin: 8px 10px 0;
    }

    article{
      display:grid;
      gap: 16px;
    }

    section{
      background: linear-gradient(180deg, rgba(16,26,51,.82), rgba(15,23,48,.82));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(14px, 2vw, 22px);
      position:relative;
      overflow:hidden;
    }
    section::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(700px 240px at 14% 6%, rgba(167,139,250,.10), transparent 55%);
      pointer-events:none;
    }
    section > *{position:relative}

    h2{
      margin:0 0 10px;
      font-size: clamp(18px, 1.6vw, 22px);
    }
    h3{
      margin: 14px 0 8px;
      font-size: 16px;
      color: var(--text);
    }
    p{margin: 8px 0; color: var(--muted)}
    ul{margin: 8px 0 0 20px; color: var(--muted)}
    li{margin: 6px 0}
    .kicker{
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 12.5px;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){
      .layout{grid-template-columns: 1fr}
      nav.toc{position:relative; top:auto}
      .grid2,.grid3{grid-template-columns:1fr}
    }

    .callout{
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px 12px 10px;
      background: rgba(0,0,0,.14);
    }
    .callout strong{color: var(--text)}
    .callout .label{
      display:flex; align-items:center; gap:10px;
      font-size: 12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(125,211,252,.12);
      flex:0 0 auto;
    }
    .dot.warn{background: var(--warn); box-shadow:0 0 0 4px rgba(251,191,36,.14)}
    .dot.ok{background: var(--ok); box-shadow:0 0 0 4px rgba(52,211,153,.14)}
    .dot.bad{background: var(--bad); box-shadow:0 0 0 4px rgba(251,113,133,.14)}
    .eqbox{
      border:1px solid rgba(125,211,252,.22);
      background: rgba(125,211,252,.06);
      border-radius: 16px;
      padding: 12px;
      margin-top: 10px;
    }
    .eq{
      font-family: var(--mono);
      color: var(--text);
      font-size: 13.5px;
      white-space: pre-wrap;
      word-break: break-word;
      margin: 0;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .copybtn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12.5px;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .copybtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(125,211,252,.25);
    }
    .copybtn:active{transform: translateY(0px)}
    .copybtn[aria-live]::after{
      content: attr(data-status);
      margin-left: 8px;
      color: var(--faint);
      font-weight: 600;
    }

    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.10);
    }
    .table th, .table td{
      padding: 10px 10px;
      border-bottom: 1px solid var(--line);
      text-align:left;
      vertical-align: top;
      color: var(--muted);
      font-size: 13.5px;
    }
    .table th{
      color: var(--text);
      font-weight: 650;
      background: rgba(255,255,255,.04);
    }
    .table tr:last-child td{border-bottom:none}

    details{
      border: 1px dashed rgba(255,255,255,.16);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(0,0,0,.10);
      margin-top: 10px;
    }
    summary{
      cursor:pointer;
      color: var(--text);
      font-weight: 650;
      outline:none;
    }
    details p, details ul{color: var(--muted)}
    .backtop{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top: 10px;
      text-decoration:none;
      color: var(--accent);
      font-weight: 650;
      font-size: 13.5px;
    }
    .backtop:hover{text-decoration: underline}

    figure{
      margin: 10px 0 0;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(0,0,0,.14);
      overflow:hidden;
    }
    figure figcaption{
      padding: 10px 12px;
      color: var(--muted);
      font-size: 13px;
      border-top: 1px solid var(--line);
    }
    canvas{
      display:block;
      width:100%;
      height: 320px;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
    }

    .final{
      border: 1px solid rgba(52,211,153,.22);
      background: rgba(52,211,153,.06);
      border-radius: 16px;
      padding: 12px;
    }
    .final h3{margin-top:0}
    .final .ans{
      font-family: var(--mono);
      color: var(--text);
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 13.8px;
      margin: 0;
    }

    footer{
      max-width:1200px;
      margin: 0 auto;
      padding: 18px clamp(16px, 4vw, 56px) 34px;
      color: var(--faint);
      border-top: 1px solid var(--line);
    }

    /* Print-friendly */
    @media print{
      body{background:#fff; color:#000}
      header, footer{border:none}
      nav.toc{display:none}
      section{break-inside: avoid; box-shadow:none; background:#fff; border:1px solid #ccc}
      .eqbox, .final, details, figure{break-inside: avoid}
      a{color:#000; text-decoration:none}
      .copybtn{display:none}
    }

    /* Subtle micro-animation */
    @media (prefers-reduced-motion: no-preference){
      section{
        animation: rise .35s ease both;
      }
      @keyframes rise{
        from{opacity:0; transform: translateY(6px)}
        to{opacity:1; transform: translateY(0)}
      }
    }
  </style>
</head>

<body>
<a id="top"></a>
<header>
  <div class="title-wrap">
    <div class="kicker">
      <span class="pill">Fiber Optics • Time Budget • Chromatic Dispersion</span>
      <span class="pill">Applied Physics + Industrial Engineering Lens</span>
    </div>
    <h1>Time Budget for a Dispersion-Limited System (100 km SMF @ 1550 nm)</h1>
    <p class="subtitle">
      We compute dispersion-induced pulse spreading, combine transmitter/fiber/receiver response times,
      and translate rise-time constraints into maximum data rates under two engineering criteria.
    </p>
  </div>
</header>

<main class="layout">
  <nav class="toc" aria-label="Table of contents">
    <h2>Contents</h2>
    <a href="#quick">Quick Summary</a>
    <a href="#part0">PART 0 — Concept Primer</a>
    <a href="#part0b">PART 0B — Industry & Applied Physics</a>
    <a href="#part1">PART 1 — Problem Analysis</a>
    <a href="#part2">PART 2 — Strategy & Tips</a>
    <a href="#part3">PART 3 — Full Solution</a>
    <a href="#part4">PART 4 — Deeper Understanding</a>
    <a href="#part5">PART 5 — Optional Plot Guide</a>
    <div class="mini">Tip: Use the copy buttons to grab equations and final answers as plain text.</div>
  </nav>

  <article>
    <section id="quick">
      <div class="kicker"><span class="pill">Quick Summary</span></div>
      <ul>
        <li><strong>What this problem is about:</strong> A 100 km single-mode fiber link is limited by <em>chromatic dispersion</em> plus finite transmitter/receiver response times.</li>
        <li><strong>Key physics idea:</strong> Source spectral width causes different wavelengths to travel with different group delays → pulse broadening.</li>
        <li><strong>Governing dispersion relation:</strong> <span class="eq">Δt_f ≈ |D| · L · Δλ</span> (with D in ps/(km·nm), L in km, Δλ in nm).</li>
        <li><strong>System time budget model:</strong> Independent rise-time contributions combine as <span class="eq">t_sys ≈ √(t_tx² + t_f² + t_rx²)</span>.</li>
        <li><strong>Engineering criteria:</strong>
          <ul>
            <li>Fiber-only constraint: <span class="eq">t_f ≤ 0.25 · T_b</span></li>
            <li>Overall system constraint: <span class="eq">t_sys ≤ 0.70 · T_b</span></li>
          </ul>
        </li>
        <li><strong>Result type:</strong> Numeric maximum data rates (Gb/s) for standard SMF (D=17) and dispersion-shifted fiber (D=1).</li>
        <li><strong>Physical meaning:</strong> Higher dispersion or longer fiber forces longer bit periods to avoid intersymbol interference (ISI), lowering data rate.</li>
        <li><strong>Headline outcomes:</strong> For SMF at 1550 nm, dispersion dominates; dispersion-shifted fiber dramatically relaxes the limit.</li>
      </ul>

      <div class="row" style="margin-top:12px">
        <div class="eqbox" style="flex:1 1 520px">
          <div class="row">
            <div>
              <div class="kicker" style="margin:0"><span class="pill">Key Equations (copy)</span></div>
            </div>
            <button class="copybtn" data-copy="Δt_f ≈ |D|·L·Δλ
t_sys ≈ sqrt(t_tx^2 + t_f^2 + t_rx^2)
Fiber criterion: t_f ≤ 0.25·T_b  ⇒  R_b,max = 1/T_b ≤ 1/(4·t_f)
System criterion: t_sys ≤ 0.70·T_b ⇒ R_b,max ≤ 0.70/t_sys" aria-live="polite">Copy</button>
          </div>
          <pre class="eq">Δt_f ≈ |D|·L·Δλ
t_sys ≈ √(t_tx² + t_f² + t_rx²)
Fiber criterion: t_f ≤ 0.25·T_b  ⇒  R_b,max ≤ 1/(4·t_f)
System criterion: t_sys ≤ 0.70·T_b ⇒ R_b,max ≤ 0.70/t_sys</pre>
        </div>

        <div class="callout" style="flex:1 1 260px">
          <div class="label"><span class="dot ok"></span>What you’ll compute</div>
          <ul style="margin-top:0">
            <li>Dispersion broadening for D=17 and D=1</li>
            <li>Rise-time RSS system budget</li>
            <li>Two max data-rate limits</li>
          </ul>
        </div>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part0">
      <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

      <h3>0.1 Core definitions (symbols + SI units)</h3>
      <table class="table" aria-label="Definitions">
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Meaning</th>
            <th>Typical units</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="eq">D</span></td>
            <td>Chromatic dispersion coefficient: group-delay change per wavelength per length</td>
            <td>ps/(km·nm)</td>
          </tr>
          <tr>
            <td><span class="eq">L</span></td>
            <td>Fiber length</td>
            <td>km (or m)</td>
          </tr>
          <tr>
            <td><span class="eq">Δλ</span></td>
            <td>Source spectral width (often RMS or FWHM proxy; used here as given)</td>
            <td>nm</td>
          </tr>
          <tr>
            <td><span class="eq">Δt_f</span></td>
            <td>Dispersion-induced temporal broadening (“fiber response time” contribution)</td>
            <td>ps, ns</td>
          </tr>
          <tr>
            <td><span class="eq">t_tx</span></td>
            <td>Transmitter (source) response/rise time contribution</td>
            <td>ps, ns</td>
          </tr>
          <tr>
            <td><span class="eq">t_rx</span></td>
            <td>Receiver response/rise time contribution</td>
            <td>ps, ns</td>
          </tr>
          <tr>
            <td><span class="eq">t_sys</span></td>
            <td>Overall system response time (combined)</td>
            <td>ps, ns</td>
          </tr>
          <tr>
            <td><span class="eq">T_b</span></td>
            <td>Bit duration (time allocated per bit)</td>
            <td>s</td>
          </tr>
          <tr>
            <td><span class="eq">R_b</span></td>
            <td>Bit rate (data rate) <span class="eq">R_b = 1/T_b</span></td>
            <td>bits/s (Gb/s)</td>
          </tr>
        </tbody>
      </table>

      <h3>0.2 Physical meaning (intuition)</h3>
      <p>
        In a dispersive medium, the <strong>group velocity</strong> depends on wavelength. A laser with finite spectral width
        emits a band of wavelengths. Those wavelengths arrive at slightly different times, turning a short pulse into a longer one.
        If pulses broaden too much, neighboring bits overlap (ISI), increasing errors.
      </p>

      <h3>0.3 Key principles + validity conditions</h3>
      <div class="grid2">
        <div class="callout">
          <div class="label"><span class="dot"></span>Chromatic dispersion model</div>
          <p style="margin-top:0">
            For single-mode fiber where chromatic dispersion dominates, a common engineering estimate is:
          </p>
          <div class="eqbox">
            <div class="row">
              <pre class="eq" style="margin:0">Δt_f ≈ |D| · L · Δλ</pre>
              <button class="copybtn" data-copy="Δt_f ≈ |D|·L·Δλ" aria-live="polite">Copy</button>
            </div>
          </div>
          <p>
            This is valid when dispersion is approximately constant over the source spectrum and when we need a quick
            “time budget” estimate rather than a detailed pulse-shape calculation.
          </p>
        </div>

        <div class="callout">
          <div class="label"><span class="dot"></span>Rise-time budgeting (RSS)</div>
          <p style="margin-top:0">
            Independent broadening mechanisms often combine approximately in <em>root-sum-square</em> form:
          </p>
          <div class="eqbox">
            <div class="row">
              <pre class="eq" style="margin:0">t_sys ≈ √(t_tx² + t_f² + t_rx²)</pre>
              <button class="copybtn" data-copy="t_sys ≈ sqrt(t_tx^2 + t_f^2 + t_rx^2)" aria-live="polite">Copy</button>
            </div>
          </div>
          <p>
            This is an engineering approximation that treats contributions as uncorrelated.
            It is widely used for quick link feasibility checks.
          </p>
        </div>
      </div>

      <h3>0.4 Common approximations and why engineers use them</h3>
      <ul>
        <li><strong>Linear dispersion approximation:</strong> assumes <span class="eq">D</span> is constant near the operating wavelength (1550 nm). Great for budgeting and early design.</li>
        <li><strong>Pulse-spread equals “fiber response time”:</strong> treats broadening as a single effective time constant governing ISI risk.</li>
        <li><strong>RSS combination:</strong> avoids detailed convolution of impulse responses while giving reasonable conservative estimates.</li>
      </ul>

      <h3>0.5 Mini intuition examples (conceptual, minimal algebra)</h3>
      <ul>
        <li><strong>Double the fiber length:</strong> broadening doubles, because <span class="eq">Δt_f ∝ L</span>.</li>
        <li><strong>Narrower laser spectrum:</strong> a smaller <span class="eq">Δλ</span> means less temporal spreading, enabling higher data rates.</li>
        <li><strong>Dispersion-shifted fiber:</strong> reducing <span class="eq">D</span> near 1550 nm can turn a “dispersion-limited” link into a “receiver-limited” link.</li>
      </ul>

      <h3>0.6 What to watch for (pitfalls)</h3>
      <div class="callout">
        <div class="label"><span class="dot warn"></span>Pitfalls & misconceptions</div>
        <ul style="margin-top:0">
          <li><strong>Unit mismatches:</strong> ps vs ns, km vs m, and nm must be consistent.</li>
          <li><strong>What “response time” means:</strong> in many link budgets it is effectively a rise time; the constants 25% and 70% are empirical design rules tied to acceptable ISI.</li>
          <li><strong>Dispersion sign:</strong> for broadening magnitude we use <span class="eq">|D|</span> (sign affects chirp interactions, not needed here).</li>
          <li><strong>Single-mode ≠ zero dispersion:</strong> single-mode eliminates modal dispersion, but chromatic dispersion remains.</li>
        </ul>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part0b">
      <h2>PART 0B — Industry & Applied Physics Perspective</h2>

      <h3>Why this matters in real systems</h3>
      <p>
        “Time budget” calculations like this are a first-pass tool used in industry to decide whether a link can meet
        a target throughput before investing in hardware, installation, and test campaigns. From an industrial engineering
        viewpoint, this is about <strong>capacity planning</strong>, <strong>risk reduction</strong>, and <strong>cost-performance optimization</strong>.
      </p>

      <h3>Where it appears (concrete application areas)</h3>
      <ul>
        <li><strong>Telecom backhaul & long-haul links:</strong> choosing fiber type (SMF vs dispersion-shifted), lasers, and dispersion compensation.</li>
        <li><strong>Data-center interconnect (DCI):</strong> metro links where pushing higher Gb/s impacts equipment selection and operational margins.</li>
        <li><strong>Industrial sensing & monitoring:</strong> distributed fiber sensors (temperature/strain) and timing distribution where pulse integrity matters.</li>
        <li><strong>High-reliability infrastructure:</strong> rail signaling, utility communication, and oil/gas monitoring where error rates and margins are contractual.</li>
      </ul>

      <h3>Why engineers care (performance + constraints)</h3>
      <div class="grid2">
        <div class="callout">
          <div class="label"><span class="dot ok"></span>Performance metrics</div>
          <ul style="margin-top:0">
            <li>Bit error rate (BER) and eye opening</li>
            <li>Throughput / spectral efficiency</li>
            <li>Latency and timing jitter sensitivity</li>
            <li>Upgrade path headroom (future higher rates)</li>
          </ul>
        </div>
        <div class="callout">
          <div class="label"><span class="dot warn"></span>Constraints</div>
          <ul style="margin-top:0">
            <li>Component bandwidth and noise (APD vs PIN)</li>
            <li>Manufacturing tolerances (laser linewidth variations)</li>
            <li>Environmental drift (temperature affects dispersion slightly)</li>
            <li>Cost and complexity (dispersion compensation vs better fiber)</li>
          </ul>
        </div>
      </div>

      <h3>How it’s validated in practice (brief)</h3>
      <ul>
        <li><strong>Eye diagram measurements:</strong> a sampling oscilloscope reveals ISI and timing spread directly.</li>
        <li><strong>BER testing:</strong> run pseudorandom bit sequences and measure BER versus power/dispersion.</li>
        <li><strong>Optical spectrum analysis:</strong> confirm source spectral width <span class="eq">Δλ</span> and assess chirp/linewidth.</li>
        <li><strong>Chromatic dispersion testing:</strong> measure dispersion parameter <span class="eq">D</span> using phase-shift or time-of-flight methods.</li>
      </ul>

      <h3>From lab to product (how ideal models get adapted)</h3>
      <p>
        Real links add non-idealities: laser chirp, polarization effects, connector reflections, nonlinearities at high power,
        and temperature-dependent behavior. Industrial designs therefore use this time budget as a <strong>screening model</strong>,
        then refine with system-level simulation and acceptance tests. The budgeting rule-of-thumb (25% and 70%) embeds
        practical margin for these uncertainties.
      </p>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part1">
      <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

      <h3>1.1 Restate the problem (in plain words)</h3>
      <p>
        A 100 km single-mode fiber link at 1550 nm uses a laser with spectral width 0.2 nm and transmitter response time 20 ps.
        The fiber has dispersion coefficient 17 ps/(km·nm). The receiver is an InGaAs APD with response time 0.1 ns.
        Find the maximum data rate under:
        (i) a constraint that the <strong>fiber</strong> response time is ≤ 25% of the bit duration,
        and (ii) a constraint that the <strong>overall system</strong> response time is ≤ 70% of the bit duration.
        Then repeat both data-rate calculations if dispersion is reduced to 1 ps/(km·nm) (dispersion-shifted fiber).
      </p>

      <h3>1.2 Given quantities</h3>
      <table class="table" aria-label="Given values">
        <thead>
          <tr>
            <th>Quantity</th>
            <th>Value</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Fiber length <span class="eq">L</span></td>
            <td>100 km</td>
            <td>Single-mode; ignore modal dispersion</td>
          </tr>
          <tr>
            <td>Wavelength</td>
            <td>1550 nm</td>
            <td>Operating point (dispersion coefficient given at/near this)</td>
          </tr>
          <tr>
            <td>Laser spectral width <span class="eq">Δλ</span></td>
            <td>0.2 nm</td>
            <td>Used in chromatic broadening estimate</td>
          </tr>
          <tr>
            <td>Transmitter response time <span class="eq">t_tx</span></td>
            <td>20 ps = 0.020 ns</td>
            <td>Given</td>
          </tr>
          <tr>
            <td>Receiver response time <span class="eq">t_rx</span></td>
            <td>0.1 ns</td>
            <td>Given (APD)</td>
          </tr>
          <tr>
            <td>Dispersion coefficient <span class="eq">D</span> (SMF)</td>
            <td>17 ps/(km·nm)</td>
            <td>Standard single-mode fiber at ~1550 nm</td>
          </tr>
          <tr>
            <td>Dispersion coefficient <span class="eq">D</span> (DSF)</td>
            <td>1 ps/(km·nm)</td>
            <td>Dispersion-shifted fiber case</td>
          </tr>
        </tbody>
      </table>

      <h3>1.3 Unknowns (what we must find)</h3>
      <ul>
        <li><span class="eq">R_b,max</span> for SMF using fiber-only criterion (<span class="eq">t_f ≤ 0.25 T_b</span>).</li>
        <li><span class="eq">R_b,max</span> for SMF using overall system criterion (<span class="eq">t_sys ≤ 0.70 T_b</span>).</li>
        <li>Same two maximum data rates for DSF (<span class="eq">D = 1 ps/(km·nm)</span>).</li>
      </ul>

      <h3>1.4 Relevant principles (and why they apply)</h3>
      <ul>
        <li><strong>Chromatic dispersion pulse spread:</strong> applies because the fiber is single-mode (so modal dispersion is negligible) and dispersion coefficient is provided.</li>
        <li><strong>Rise-time budgeting (RSS):</strong> applies because transmitter, fiber, and receiver limitations contribute to pulse rise/broadening in different subsystems.</li>
        <li><strong>ISI design rules (25% and 70%):</strong> apply as engineering constraints linking allowable spreading to bit duration.</li>
      </ul>

      <div class="callout">
        <div class="label"><span class="dot warn"></span>Assumptions (explicit)</div>
        <ul style="margin-top:0">
          <li>Only chromatic dispersion limits the fiber; polarization-mode dispersion and nonlinearities are neglected.</li>
          <li>Dispersion coefficient <span class="eq">D</span> is constant over the laser spectrum.</li>
          <li>“Response time” values can be treated as comparable rise-time-like quantities and combined via RSS.</li>
          <li>NRZ-style reasoning: bit duration <span class="eq">T_b</span> sets the time slot; broadening relative to <span class="eq">T_b</span> governs ISI.</li>
        </ul>
      </div>

      <h3>1.5 Possible approaches (compare and choose)</h3>
      <div class="grid3">
        <div class="callout">
          <div class="label"><span class="dot"></span>Approach A: Time-budget rules (this problem)</div>
          <p style="margin-top:0">
            Use <span class="eq">Δt_f ≈ |D|LΔλ</span> and RSS combination. Fast, matches typical textbook link design.
          </p>
          <p><strong>Best for:</strong> quick feasibility checks, early-stage design.</p>
        </div>
        <div class="callout">
          <div class="label"><span class="dot"></span>Approach B: Frequency-domain bandwidth method</div>
          <p style="margin-top:0">
            Convert rise times to equivalent bandwidths and enforce bandwidth > bit-rate factor.
          </p>
          <p><strong>Pros:</strong> ties directly to electronics bandwidth; <strong>Cons:</strong> needs extra constants and conventions.</p>
        </div>
        <div class="callout">
          <div class="label"><span class="dot"></span>Approach C: Full pulse convolution</div>
          <p style="margin-top:0">
            Model impulse responses and convolve to compute eye closure precisely.
          </p>
          <p><strong>Pros:</strong> most accurate; <strong>Cons:</strong> far beyond what’s needed here.</p>
        </div>
      </div>
      <p>
        <strong>Chosen approach:</strong> Approach A, because the problem explicitly gives time-domain response times
        and uses percentage-of-bit-duration criteria—classic time-budget engineering.
      </p>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part2">
      <h2>PART 2 — Strategy & Tips (Roadmap Only)</h2>

      <ol style="color:var(--muted); margin: 8px 0 0 20px">
        <li><strong>Compute fiber dispersion broadening</strong> using <span class="eq">t_f = |D|LΔλ</span>. (Goal: isolate the fiber’s time spread.)</li>
        <li><strong>Apply fiber-only criterion</strong> <span class="eq">t_f ≤ 0.25T_b</span> to find minimum allowable <span class="eq">T_b</span>. (Goal: ensure fiber spreading is a small fraction of a bit.)</li>
        <li><strong>Convert bit duration to max data rate</strong> using <span class="eq">R_b = 1/T_b</span>. (Goal: produce max Gb/s.)</li>
        <li><strong>Compute overall system response time</strong> via RSS: <span class="eq">t_sys = √(t_tx² + t_f² + t_rx²)</span>. (Goal: include transmitter and receiver speed limits.)</li>
        <li><strong>Apply system criterion</strong> <span class="eq">t_sys ≤ 0.70T_b</span> to get another <span class="eq">R_b,max</span>. (Goal: global ISI control.)</li>
        <li><strong>Repeat</strong> steps 1–5 for dispersion-shifted fiber (<span class="eq">D = 1</span>). (Goal: quantify the benefit of low dispersion.)</li>
      </ol>

      <div class="callout" style="margin-top:12px">
        <div class="label"><span class="dot warn"></span>Common mistakes (quick tips)</div>
        <ul style="margin-top:0">
          <li>Don’t forget <span class="eq">L</span> is in km when using <span class="eq">D</span> in ps/(km·nm).</li>
          <li>Convert ps → ns consistently before comparing to receiver time (0.1 ns).</li>
          <li>For fiber-only criterion, <strong>use only</strong> <span class="eq">t_f</span> (not the RSS time).</li>
          <li>For system criterion, <strong>use RSS</strong> time; it will often be dominated by the largest contributor.</li>
        </ul>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part3">
      <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

      <h3>3.1 Qualitative expectation (before calculating)</h3>
      <p>
        With standard SMF at 1550 nm, <span class="eq">D</span> is relatively large (17 ps/(km·nm)). Over 100 km, even a modest
        spectral width (0.2 nm) can produce hundreds of picoseconds of broadening, which is comparable to (or larger than) typical
        electronics response times. So we expect dispersion to be a major limiter. With dispersion-shifted fiber (D=1),
        the fiber contribution should become small, shifting the bottleneck toward the receiver (0.1 ns).
      </p>

      <h3>3.2 Step 1: Compute dispersion-induced broadening (SMF, D = 17)</h3>
      <p>
        Use the engineering estimate:
      </p>
      <div class="eqbox">
        <div class="row">
          <pre class="eq" style="margin:0">t_f = Δt_f ≈ |D| · L · Δλ</pre>
          <button class="copybtn" data-copy="t_f = Δt_f ≈ |D|·L·Δλ" aria-live="polite">Copy</button>
        </div>
      </div>
      <p>
        Insert values (<span class="eq">D = 17 ps/(km·nm), L = 100 km, Δλ = 0.2 nm</span>):
      </p>
      <div class="eqbox">
        <pre class="eq">t_f = 17 × 100 × 0.2  ps
    = 340 ps
    = 0.34 ns</pre>
      </div>
      <p>
        <strong>Interpretation:</strong> the fiber alone spreads a pulse by about 0.34 ns. That is already several times the transmitter’s 20 ps,
        and a few times the receiver’s 0.1 ns—so dispersion is likely the dominant term.
      </p>

      <h3>3.3 Step 2: Max data rate using the fiber-only criterion</h3>
      <p>
        Criterion: fiber response time must not exceed 25% of the bit duration:
      </p>
      <div class="eqbox">
        <div class="row">
          <pre class="eq" style="margin:0">t_f ≤ 0.25 · T_b</pre>
          <button class="copybtn" data-copy="t_f ≤ 0.25·T_b" aria-live="polite">Copy</button>
        </div>
      </div>
      <p>
        Solve for the minimum allowed bit duration:
      </p>
      <div class="eqbox">
        <pre class="eq">T_b ≥ t_f / 0.25 = 4 t_f</pre>
      </div>
      <p>
        Then the maximum bit rate <span class="eq">R_b = 1/T_b</span> satisfies:
      </p>
      <div class="eqbox">
        <pre class="eq">R_b,max = 1/T_b ≤ 1/(4 t_f)</pre>
      </div>
      <p>
        Insert <span class="eq">t_f = 0.34 ns</span>:
      </p>
      <div class="eqbox">
        <pre class="eq">T_b,min = 4(0.34 ns) = 1.36 ns
R_b,max = 1 / (1.36 × 10⁻⁹ s) ≈ 0.735 × 10⁹ s⁻¹ ≈ 0.735 Gb/s</pre>
      </div>

      <h3>3.4 Step 3: Compute overall system response time (SMF) via RSS</h3>
      <p>
        Combine transmitter, fiber, receiver response times using RSS:
      </p>
      <div class="eqbox">
        <pre class="eq">t_sys ≈ √(t_tx² + t_f² + t_rx²)</pre>
      </div>
      <p>
        Convert all to ns:
        <span class="eq">t_tx = 20 ps = 0.020 ns</span>,
        <span class="eq">t_f = 0.34 ns</span>,
        <span class="eq">t_rx = 0.10 ns</span>.
      </p>
      <div class="eqbox">
        <pre class="eq">t_sys = √(0.020² + 0.34² + 0.10²) ns
      = √(0.0004 + 0.1156 + 0.0100) ns
      = √(0.1260) ns
      ≈ 0.355 ns</pre>
      </div>
      <p>
        <strong>Interpretation:</strong> the RSS total (0.355 ns) is only slightly larger than the fiber term (0.34 ns),
        confirming dispersion dominates the time budget for SMF.
      </p>

      <h3>3.5 Step 4: Max data rate using the overall system criterion</h3>
      <p>
        Criterion: overall response time must not exceed 70% of the bit duration:
      </p>
      <div class="eqbox">
        <pre class="eq">t_sys ≤ 0.70 · T_b  ⇒  T_b ≥ t_sys / 0.70</pre>
      </div>
      <p>
        Thus:
      </p>
      <div class="eqbox">
        <pre class="eq">R_b,max = 1/T_b ≤ 0.70 / t_sys</pre>
      </div>
      <p>
        Insert <span class="eq">t_sys ≈ 0.355 ns</span>:
      </p>
      <div class="eqbox">
        <pre class="eq">R_b,max ≤ 0.70 / (0.355 × 10⁻⁹ s)
      ≈ 1.97 × 10⁹ s⁻¹
      ≈ 1.97 Gb/s</pre>
      </div>

      <h3>3.6 Repeat for dispersion-shifted fiber (DSF, D = 1 ps/(km·nm))</h3>

      <h4 style="margin: 10px 0 6px; color: var(--text)">Step 1: DSF fiber broadening</h4>
      <div class="eqbox">
        <pre class="eq">t_f(DSF) = D · L · Δλ
         = 1 × 100 × 0.2 ps
         = 20 ps
         = 0.020 ns</pre>
      </div>
      <p>
        Now the fiber broadening is as small as the transmitter response (both 20 ps), and far smaller than the receiver (0.1 ns).
      </p>

      <h4 style="margin: 10px 0 6px; color: var(--text)">Step 2: DSF max data rate (fiber-only criterion 25%)</h4>
      <div class="eqbox">
        <pre class="eq">T_b,min = 4 t_f = 4(0.020 ns) = 0.080 ns
R_b,max = 1 / (0.080 × 10⁻⁹ s) = 12.5 × 10⁹ s⁻¹ = 12.5 Gb/s</pre>
      </div>

      <h4 style="margin: 10px 0 6px; color: var(--text)">Step 3: DSF overall system response time</h4>
      <div class="eqbox">
        <pre class="eq">t_sys(DSF) = √(t_tx² + t_f² + t_rx²)
           = √(0.020² + 0.020² + 0.10²) ns
           = √(0.0004 + 0.0004 + 0.0100) ns
           = √(0.0108) ns
           ≈ 0.104 ns</pre>
      </div>
      <p>
        <strong>Interpretation:</strong> the receiver (0.1 ns) now dominates the RSS total, meaning the link becomes electronics-limited rather than dispersion-limited.
      </p>

      <h4 style="margin: 10px 0 6px; color: var(--text)">Step 4: DSF max data rate (system criterion 70%)</h4>
      <div class="eqbox">
        <pre class="eq">R_b,max ≤ 0.70 / (0.104 × 10⁻⁹ s)
      ≈ 6.74 × 10⁹ s⁻¹
      ≈ 6.7 Gb/s</pre>
      </div>

      <h3>3.7 Sanity checks</h3>
      <div class="grid2">
        <div class="callout">
          <div class="label"><span class="dot ok"></span>Units / dimensions</div>
          <ul style="margin-top:0">
            <li><span class="eq">D·L·Δλ</span> → (ps/(km·nm))·(km)·(nm) = ps ✔</li>
            <li><span class="eq">R_b,max</span> computed from 1/time → s⁻¹ ✔</li>
          </ul>
        </div>
        <div class="callout">
          <div class="label"><span class="dot ok"></span>Limiting-case logic</div>
          <ul style="margin-top:0">
            <li>If <span class="eq">D → 0</span>, fiber broadening vanishes and receiver/transmitter set the limit ✔</li>
            <li>If <span class="eq">L</span> doubles, SMF fiber-limited rate halves under the 25% rule (since <span class="eq">R ∝ 1/L</span>) ✔</li>
          </ul>
        </div>
      </div>

      <div class="final" style="margin-top:12px">
        <div class="row">
          <h3 style="margin:0">Final Answers (copy)</h3>
          <button class="copybtn" data-copy="Given: L=100 km, Δλ=0.2 nm, t_tx=20 ps, t_rx=0.1 ns.

SMF (D=17 ps/(km·nm)):
t_f = D·L·Δλ = 340 ps = 0.34 ns
Fiber-only (t_f ≤ 0.25 T_b): R_b,max = 1/(4 t_f) ≈ 0.735 Gb/s
System (t_sys ≤ 0.70 T_b), with t_sys=√(t_tx^2+t_f^2+t_rx^2)=0.355 ns: R_b,max ≈ 1.97 Gb/s

Dispersion-shifted fiber (D=1 ps/(km·nm)):
t_f = 20 ps = 0.020 ns
Fiber-only: R_b,max = 1/(4 t_f) = 12.5 Gb/s
System, t_sys=√(0.020^2+0.020^2+0.10^2)=0.104 ns: R_b,max ≈ 6.7 Gb/s" aria-live="polite">Copy</button>
        </div>
        <pre class="ans">Given: L=100 km, Δλ=0.2 nm, t_tx=20 ps, t_rx=0.1 ns.

SMF (D=17 ps/(km·nm)):
t_f = D·L·Δλ = 340 ps = 0.34 ns
Fiber-only (t_f ≤ 0.25 T_b): R_b,max = 1/(4 t_f) ≈ 0.735 Gb/s
System (t_sys ≤ 0.70 T_b), with t_sys=√(t_tx^2+t_f^2+t_rx^2)=0.355 ns: R_b,max ≈ 1.97 Gb/s

Dispersion-shifted fiber (D=1 ps/(km·nm)):
t_f = 20 ps = 0.020 ns
Fiber-only: R_b,max = 1/(4 t_f) = 12.5 Gb/s
System, t_sys=√(0.020^2+0.020^2+0.10^2)=0.104 ns: R_b,max ≈ 6.7 Gb/s</pre>
      </div>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section>
      <h2>One Static Plot (Dispersion Broadening vs Fiber Length)</h2>
      <p>
        Since dispersion broadening scales linearly with length, one clean way to “see” why long links become dispersion-limited
        is to plot <span class="eq">Δt_f = D·L·Δλ</span> for two fiber types. This is a static, non-interactive plot with the problem’s numbers.
      </p>

      <figure>
        <canvas id="plot" aria-label="Dispersion-induced broadening versus fiber length"></canvas>
        <figcaption>
          <strong>Plot:</strong> Dispersion-induced broadening <span class="eq">Δt_f</span> vs. length <span class="eq">L</span> for Δλ = 0.2 nm.
          Two lines: SMF (D=17) and DSF (D=1). Markers show the problem point at L = 100 km.
        </figcaption>
      </figure>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part4">
      <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

      <h3>4.1 Re-interpret the formulas: what each term controls</h3>
      <ul>
        <li><strong><span class="eq">t_f = D·L·Δλ</span>:</strong>
          <ul>
            <li><span class="eq">D</span> is a <em>material+waveguide property</em>: how sensitive group delay is to wavelength.</li>
            <li><span class="eq">L</span> is the accumulation distance: dispersion is cumulative.</li>
            <li><span class="eq">Δλ</span> is source “color spread”: broader spectra smear pulses more.</li>
          </ul>
        </li>
        <li><strong><span class="eq">t_sys = √(t_tx² + t_f² + t_rx²)</span>:</strong>
          the largest term often dominates; RSS reflects partial independence of effects.</li>
        <li><strong>Data-rate limits:</strong>
          <ul>
            <li>Fiber-only: <span class="eq">R_b,max ∝ 1/t_f ∝ 1/(D·L·Δλ)</span></li>
            <li>System: <span class="eq">R_b,max ∝ 1/t_sys</span>, so reducing one term helps only until another becomes dominant.</li>
          </ul>
        </li>
      </ul>

      <h3>4.2 Parameter dependence (how changes affect outcome)</h3>
      <div class="grid2">
        <div class="callout">
          <div class="label"><span class="dot"></span>Qualitative effects</div>
          <ul style="margin-top:0">
            <li>Increase <span class="eq">L</span> → increases dispersion broadening linearly → lowers max rate roughly as <span class="eq">1/L</span> in dispersion-limited regime.</li>
            <li>Decrease <span class="eq">Δλ</span> (narrower laser) → less ISI → higher max rate.</li>
            <li>Decrease <span class="eq">D</span> (DSF, compensation) → shifts bottleneck to receiver bandwidth.</li>
            <li>Improve <span class="eq">t_rx</span> (faster detector/TIA) → boosts max rate strongly once dispersion is small.</li>
          </ul>
        </div>
        <div class="callout">
          <div class="label"><span class="dot ok"></span>Quantitative “back of envelope”</div>
          <p style="margin-top:0">
            In the fiber-only 25% rule:
          </p>
          <div class="eqbox"><pre class="eq" style="margin:0">R_b,max ≈ 1 / (4 D L Δλ)</pre></div>
          <p>
            So cutting <span class="eq">D</span> by 17× (from 17 to 1) increases this limit by 17×:
            0.735 Gb/s → about 12.5 Gb/s (exactly what we found).
          </p>
        </div>
      </div>

      <h3>4.3 Alternative derivation idea (brief but meaningful)</h3>
      <details>
        <summary>Bandwidth viewpoint: rise time ↔ bandwidth (engineering convention)</summary>
        <p>
          A common rule relates rise time <span class="eq">t_r</span> to bandwidth <span class="eq">B</span>, e.g. <span class="eq">t_r ≈ 0.35/B</span>
          for certain low-pass responses. One can translate transmitter/fiber/receiver into equivalent bandwidth limits and then
          require sufficient bandwidth relative to bit rate (NRZ often needs bandwidth on the order of ~0.7R_b to ~R_b depending on specs).
          The time-budget approach used in this problem is effectively the time-domain cousin of that frequency-domain logic.
        </p>
      </details>

      <h3>4.4 Concept checks (self-test with answers)</h3>
      <ul>
        <li><strong>Q:</strong> If you halve the laser spectral width <span class="eq">Δλ</span>, what happens to <span class="eq">t_f</span> and the fiber-only <span class="eq">R_b,max</span>?<br/>
            <strong>A:</strong> <span class="eq">t_f</span> halves; fiber-only <span class="eq">R_b,max</span> doubles.</li>
        <li><strong>Q:</strong> Why does dispersion-shifted fiber not increase the system-limited rate as much as the fiber-only rate? <br/>
            <strong>A:</strong> Because once <span class="eq">t_f</span> becomes small, the receiver time <span class="eq">t_rx</span> dominates <span class="eq">t_sys</span>.</li>
        <li><strong>Q:</strong> In the SMF case, which term dominates <span class="eq">t_sys</span>? <br/>
            <strong>A:</strong> The fiber dispersion term <span class="eq">t_f ≈ 0.34 ns</span>.</li>
        <li><strong>Q:</strong> Which criterion is more restrictive here for SMF: 25% fiber-only or 70% system? <br/>
            <strong>A:</strong> The 25% fiber-only rule gives a lower rate (~0.735 Gb/s) than the 70% system rule (~1.97 Gb/s), so it is more restrictive.</li>
      </ul>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>

    <section id="part5">
      <h2>PART 5 — Optional Plot Guide</h2>
      <p>
        <strong>What it shows:</strong> The plot displays <span class="eq">Δt_f</span> increasing linearly with fiber length <span class="eq">L</span>
        for two dispersion coefficients (SMF: 17, DSF: 1) using the <em>problem’s</em> spectral width <span class="eq">Δλ = 0.2 nm</span>.
      </p>
      <ul>
        <li><strong>x-axis:</strong> Fiber length <span class="eq">L</span> (km)</li>
        <li><strong>y-axis:</strong> Dispersion-induced broadening <span class="eq">Δt_f</span> (ns)</li>
        <li><strong>Values used:</strong> These are not “example values”; they are the given problem values for <span class="eq">D</span> and <span class="eq">Δλ</span>.</li>
        <li><strong>Features to notice:</strong>
          <ul>
            <li>The SMF line is 17× steeper than the DSF line.</li>
            <li>At 100 km, SMF reaches ~0.34 ns broadening, while DSF is only ~0.02 ns.</li>
            <li>This visual directly explains why the bottleneck shifts from dispersion (SMF) to receiver speed (DSF).</li>
          </ul>
        </li>
      </ul>

      <a class="backtop" href="#top">↑ Back to top</a>
    </section>
  </article>
</main>

<footer>
  <div style="max-width:1200px; margin:0 auto;">
    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
      <span>Built as a self-contained learning article (vanilla HTML/CSS/JS). No external libraries.</span>
      <a href="#top" class="backtop" style="margin:0">↑ Back to top</a>
    </div>
  </div>
</footer>

<script>
(function(){
  // Smooth scroll for in-page anchors (respect reduced motion)
  const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href^="#"]');
    if(!a) return;
    const id = a.getAttribute('href');
    if(!id || id === '#') return;
    const el = document.querySelector(id);
    if(!el) return;
    e.preventDefault();
    el.scrollIntoView({behavior: reduce ? 'auto' : 'smooth', block:'start'});
    history.replaceState(null, '', id);
  });

  // Copy buttons
  function setStatus(btn, text){
    btn.setAttribute('data-status', text);
    btn.setAttribute('aria-live','polite');
    clearTimeout(btn._t);
    btn._t = setTimeout(()=>{ btn.setAttribute('data-status',''); }, 1200);
  }
  async function copyText(btn){
    const txt = btn.getAttribute('data-copy') || '';
    try{
      await navigator.clipboard.writeText(txt);
      setStatus(btn, 'Copied');
    }catch(err){
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = txt;
      ta.style.position='fixed';
      ta.style.left='-9999px';
      document.body.appendChild(ta);
      ta.select();
      try{
        document.execCommand('copy');
        setStatus(btn,'Copied');
      }catch(e){
        setStatus(btn,'Copy failed');
      }
      document.body.removeChild(ta);
    }
  }
  document.querySelectorAll('.copybtn').forEach(btn=>{
    btn.addEventListener('click', ()=>copyText(btn));
  });

  // Static plot on canvas: Δt_f vs L for SMF and DSF with Δλ=0.2 nm
  const canvas = document.getElementById('plot');
  if(!canvas) return;

  const D_smf = 17; // ps/(km·nm)
  const D_dsf = 1;  // ps/(km·nm)
  const dLambda = 0.2; // nm
  const L_mark = 100; // km

  function nsFrom_ps(ps){ return ps * 1e-3; } // 1 ps = 1e-3 ns
  function tFiber_ns(D, L_km, dLam_nm){
    const ps = Math.abs(D) * L_km * dLam_nm;
    return nsFrom_ps(ps);
  }

  function draw(){
    const parentW = canvas.clientWidth || 900;
    const parentH = canvas.clientHeight || 320;
    const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
    canvas.width = Math.floor(parentW * dpr);
    canvas.height = Math.floor(parentH * dpr);
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const w = parentW, h = parentH;
    ctx.clearRect(0,0,w,h);

    // Plot area
    const padL = 56, padR = 18, padT = 30, padB = 44;
    const x0 = padL, y0 = padT, x1 = w - padR, y1 = h - padB;
    const pw = x1 - x0, ph = y1 - y0;

    // Ranges
    const Lmax = 120; // km
    const ymin = 0;
    const ymax = tFiber_ns(D_smf, Lmax, dLambda) * 1.10;

    function X(L){ return x0 + (L / Lmax) * pw; }
    function Y(t){ return y1 - ((t - ymin) / (ymax - ymin)) * ph; }

    // Title
    ctx.fillStyle = 'rgba(234,240,255,0.95)';
    ctx.font = '700 14px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';
    ctx.fillText('Dispersion broadening: Δt_f = D·L·Δλ  (Δλ = 0.2 nm)', x0, 10);

    // Grid
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.lineWidth = 1;

    const xticks = [0, 20, 40, 60, 80, 100, 120];
    const yticks = (function(){
      // choose "nice" ticks
      const step = 0.05; // ns
      const arr = [];
      for(let v=0; v<=ymax + 1e-9; v+=step) arr.push(v);
      return arr;
    })();

    // vertical grid
    xticks.forEach(L=>{
      const x = X(L);
      ctx.beginPath();
      ctx.moveTo(x, y0);
      ctx.lineTo(x, y1);
      ctx.stroke();
    });
    // horizontal grid
    yticks.forEach(t=>{
      const y = Y(t);
      ctx.beginPath();
      ctx.moveTo(x0, y);
      ctx.lineTo(x1, y);
      ctx.stroke();
    });

    // Axes
    ctx.strokeStyle = 'rgba(255,255,255,0.22)';
    ctx.lineWidth = 1.2;
    ctx.beginPath();
    ctx.moveTo(x0, y0);
    ctx.lineTo(x0, y1);
    ctx.lineTo(x1, y1);
    ctx.stroke();

    // Ticks + labels
    ctx.fillStyle = 'rgba(185,196,230,0.95)';
    ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';

    xticks.forEach(L=>{
      const x = X(L);
      ctx.strokeStyle = 'rgba(255,255,255,0.24)';
      ctx.beginPath();
      ctx.moveTo(x, y1);
      ctx.lineTo(x, y1 + 6);
      ctx.stroke();
      ctx.fillText(String(L), x, y1 + 8);
    });

    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    yticks.forEach(t=>{
      const y = Y(t);
      ctx.strokeStyle = 'rgba(255,255,255,0.20)';
      ctx.beginPath();
      ctx.moveTo(x0 - 6, y);
      ctx.lineTo(x0, y);
      ctx.stroke();
      ctx.fillText(t.toFixed(2), x0 - 8, y);
    });

    // Axis labels
    ctx.fillStyle = 'rgba(234,240,255,0.92)';
    ctx.font = '650 12.5px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';
    ctx.fillText('Fiber length L (km)', x0 + pw/2, h - 8);

    ctx.save();
    ctx.translate(14, y0 + ph/2);
    ctx.rotate(-Math.PI/2);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.fillText('Dispersion broadening Δt_f (ns)', 0, 0);
    ctx.restore();

    // Curves
    function drawLine(D, label, style){
      ctx.strokeStyle = style.stroke;
      ctx.lineWidth = 2.2;
      ctx.beginPath();
      for(let L=0; L<=Lmax; L+=2){
        const t = tFiber_ns(D, L, dLambda);
        const x = X(L);
        const y = Y(t);
        if(L===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.stroke();

      // marker at 100 km
      const tM = tFiber_ns(D, L_mark, dLambda);
      const xM = X(L_mark);
      const yM = Y(tM);
      ctx.fillStyle = style.fill;
      ctx.beginPath();
      ctx.arc(xM, yM, 4.8, 0, Math.PI*2);
      ctx.fill();

      // small label near marker
      ctx.font = '600 12px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'left';
      ctx.textBaseline = 'bottom';
      ctx.fillStyle = 'rgba(234,240,255,0.90)';
      const txt = label + ' @100 km: ' + tM.toFixed(2) + ' ns';
      ctx.fillText(txt, Math.min(xM + 10, x1 - 200), yM - 8);
    }

    drawLine(D_smf, 'SMF (D=17)', {stroke:'rgba(125,211,252,0.95)', fill:'rgba(125,211,252,0.95)'});
    drawLine(D_dsf, 'DSF (D=1)',  {stroke:'rgba(167,139,250,0.95)', fill:'rgba(167,139,250,0.95)'});

    // Legend
    const lx = x1 - 210, ly = y0 + 10;
    ctx.fillStyle = 'rgba(0,0,0,0.35)';
    ctx.strokeStyle = 'rgba(255,255,255,0.14)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(lx, ly, 200, 54, 12);
    ctx.fill();
    ctx.stroke();

    ctx.font = '600 12px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign='left';
    ctx.textBaseline='middle';

    // SMF
    ctx.strokeStyle='rgba(125,211,252,0.95)';
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.moveTo(lx+12, ly+18);
    ctx.lineTo(lx+42, ly+18);
    ctx.stroke();
    ctx.fillStyle='rgba(234,240,255,0.92)';
    ctx.fillText('SMF: D = 17 ps/(km·nm)', lx+52, ly+18);

    // DSF
    ctx.strokeStyle='rgba(167,139,250,0.95)';
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.moveTo(lx+12, ly+36);
    ctx.lineTo(lx+42, ly+36);
    ctx.stroke();
    ctx.fillStyle='rgba(234,240,255,0.92)';
    ctx.fillText('DSF: D = 1 ps/(km·nm)', lx+52, ly+36);
  }

  // Add roundRect polyfill for older browsers
  if (!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r){
      r = Math.min(r, w/2, h/2);
      this.beginPath();
      this.moveTo(x+r, y);
      this.arcTo(x+w, y, x+w, y+h, r);
      this.arcTo(x+w, y+h, x, y+h, r);
      this.arcTo(x, y+h, x, y, r);
      this.arcTo(x, y, x+w, y, r);
      this.closePath();
      return this;
    };
  }

  const ro = new ResizeObserver(()=>draw());
  ro.observe(canvas);
  draw();
})();
</script>
</body>
</html>
