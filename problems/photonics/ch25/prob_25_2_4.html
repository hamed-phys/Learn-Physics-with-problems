<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Maximum Length of an Analog Optical Link (Shot-Noise-Limited APD Receiver)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --card2:#0f1730;
      --ink:#eaf0ff;
      --muted:#b7c3e6;
      --faint:#93a4d6;
      --accent:#7cf2c7;
      --accent2:#9bb7ff;
      --warn:#ffd27a;
      --danger:#ff7a9c;
      --line:rgba(255,255,255,0.10);
      --shadow: 0 14px 40px rgba(0,0,0,0.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 900px at 18% 8%, rgba(124,242,199,0.14), transparent 60%),
        radial-gradient(900px 700px at 80% 20%, rgba(155,183,255,0.12), transparent 55%),
        radial-gradient(1100px 800px at 55% 90%, rgba(255,122,156,0.08), transparent 60%),
        var(--bg);
      line-height:1.55;
    }
    a{color:var(--accent2); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding: 34px 20px 18px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), transparent);
      position:relative;
      overflow:hidden;
    }
    header::after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 160px at 20% 0%, rgba(124,242,199,0.18), transparent 70%),
        radial-gradient(820px 190px at 80% 0%, rgba(155,183,255,0.16), transparent 70%);
      pointer-events:none;
      opacity:0.9;
    }
    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 20px 44px;
      position:relative;
      z-index:1;
    }
    .title{display:grid; gap:10px}
    h1{
      margin:0;
      font-weight:800;
      letter-spacing:-0.02em;
      font-size: clamp(1.55rem, 3.2vw, 2.35rem);
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      max-width: 90ch;
      font-size: 1.02rem;
    }
    main{padding: 22px 0 0;}
    .grid{
      display:grid;
      grid-template-columns: 330px 1fr;
      gap: 18px;
      align-items:start;
    }
    nav.toc{
      position: sticky;
      top: 14px;
      align-self:start;
      background: rgba(17,26,51,0.62);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 14px 14px 12px;
    }
    .toc h2{
      margin: 0 0 10px;
      font-size: 0.98rem;
      letter-spacing: 0.02em;
      color: var(--ink);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .pill{
      font-size: 0.78rem;
      color: var(--bg);
      background: var(--accent);
      padding: 3px 8px;
      border-radius: 999px;
      font-weight: 750;
      letter-spacing:0.02em;
      white-space:nowrap;
    }
    .toc a{
      display:block;
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--muted);
      border: 1px solid transparent;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
      font-size: 0.95rem;
    }
    .toc a:hover{
      background: rgba(124,242,199,0.10);
      border-color: rgba(124,242,199,0.22);
      color: var(--ink);
      text-decoration:none;
      transform: translateX(2px);
    }
    .toc .back{
      margin-top: 10px;
      border-top:1px solid var(--line);
      padding-top: 10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .toc .back a{
      padding: 7px 10px;
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.08);
      color: var(--muted);
    }
    .toc .back a:hover{
      background: rgba(155,183,255,0.10);
      border-color: rgba(155,183,255,0.22);
      color: var(--ink);
    }
    article{display:grid; gap: 16px;}
    section{
      background: rgba(17,26,51,0.58);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 18px 18px;
      overflow:hidden;
      position:relative;
    }
    section::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,0.05), transparent 55%);
      opacity:0.6;
      pointer-events:none;
    }
    section > *{position:relative; z-index:1}
    h2{
      margin: 0 0 8px;
      font-size: 1.25rem;
      letter-spacing:-0.01em;
    }
    h3{margin: 14px 0 6px; font-size: 1.06rem; color: var(--ink);}
    p{margin: 8px 0; color: var(--muted)}
    ul{margin: 8px 0 0 20px; color: var(--muted)}
    li{margin: 6px 0}
    .callouts{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
      margin-top: 10px;
    }
    .box{
      grid-column: span 12;
      background: rgba(15,23,48,0.72);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 12px 12px;
      overflow:hidden;
    }
    .box strong{color:var(--ink)}
    .box.assump{border-color: rgba(124,242,199,0.24)}
    .box.eq{border-color: rgba(155,183,255,0.26)}
    .box.mist{border-color: rgba(255,210,122,0.26)}
    .box.ans{border-color: rgba(124,242,199,0.34); background: rgba(124,242,199,0.08)}
    .tagrow{display:flex; gap:8px; flex-wrap:wrap; margin: 8px 0 0;}
    .tag{
      font-size: 0.82rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      color: var(--muted);
      white-space:nowrap;
    }
    .kpi{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .kpi .tile{
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 10px 10px;
    }
    .kpi .label{font-size: 0.82rem; color: var(--faint); margin-bottom: 4px;}
    .kpi .value{font-family: var(--mono); font-size: 1.02rem; color: var(--ink); font-weight: 700;}
    .eqline{
      font-family: var(--mono);
      background: rgba(0,0,0,0.20);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 10px 10px;
      overflow:auto;
      margin: 8px 0;
      color: #f2f6ff;
    }
    .eqrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin: 6px 0 0;
    }
    button.copy{
      appearance:none;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: var(--ink);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 700;
      font-size: 0.88rem;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    button.copy:hover{
      transform: translateY(-1px);
      background: rgba(124,242,199,0.10);
      border-color: rgba(124,242,199,0.22);
    }
    button.copy:active{transform: translateY(0px) scale(0.99)}
    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: rgba(17,26,51,0.85);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(8px);
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 9999;
      font-weight: 650;
    }
    .toast.show{opacity: 1; transform: translateY(0);}
    details{
      margin-top: 10px;
      background: rgba(255,255,255,0.035);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 10px 12px;
    }
    summary{
      cursor:pointer;
      font-weight: 800;
      color: var(--ink);
      list-style:none;
      outline:none;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    summary::before{
      content:"▸";
      display:inline-block;
      margin-right:8px;
      color: var(--accent2);
      transform: translateY(-1px);
      transition: transform .15s ease;
    }
    details[open] summary::before{transform: rotate(90deg) translateX(2px) translateY(-1px)}
    figure{margin: 10px 0 0; padding: 0;}
    .plotcard{
      background: rgba(15,23,48,0.72);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      overflow:hidden;
    }
    .plothead{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .plothead .t{margin:0; font-weight: 850; letter-spacing:-0.01em;}
    .plothead .s{margin:2px 0 0; color: var(--muted); font-size: 0.92rem; max-width: 90ch;}
    canvas{
      display:block;
      width: 100%;
      height: 340px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
    }
    footer{
      padding: 18px 20px 34px;
      color: var(--faint);
      border-top: 1px solid var(--line);
    }
    .footgrid{
      max-width: 1180px;
      margin: 0 auto;
      padding: 0 20px;
      display:flex;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
      nav.toc{position:relative; top:auto}
      canvas{height: 300px}
    }
    @media (max-width: 560px){
      section{padding: 16px 14px}
      .kpi{grid-template-columns: 1fr}
      canvas{height: 280px}
    }
    @media print{
      :root{
        --bg:#ffffff;
        --ink:#000000;
        --muted:#1a1a1a;
        --faint:#333333;
        --card:#ffffff;
        --card2:#ffffff;
        --line:#d9d9d9;
      }
      body{background:#ffffff}
      header, section, nav.toc{
        background:#ffffff !important;
        box-shadow:none !important;
        backdrop-filter:none !important;
      }
      nav.toc{display:none}
      button.copy{display:none}
      .toast{display:none}
      a{color:#000; text-decoration:underline}
      section{break-inside: avoid; page-break-inside: avoid}
      h2{break-after: avoid-page}
      .plotcard{break-inside: avoid; page-break-inside: avoid}
      canvas{height: 260px}
    }
  </style>
</head>
<body>
  <header id="top">
    <div class="wrap">
      <div class="title">
        <h1>Maximum Length of an Analog Optical Fiber Link (Intensity Modulation, APD Receiver)</h1>
        <p class="subtitle">
          We determine the <strong>receiver optical power sensitivity</strong> needed to meet a specified <strong>analog SNR</strong> in a given bandwidth,
          then convert that sensitivity into an <strong>attenuation-limited maximum fiber length</strong>. Along the way, we highlight what matters in real engineering:
          noise budgets, detector physics, and practical design trade-offs.
        </p>
        <div class="tagrow" aria-label="Key topics">
          <span class="tag">Direct detection</span>
          <span class="tag">Intensity modulation</span>
          <span class="tag">Shot-noise-limited</span>
          <span class="tag">Avalanche photodiode (APD)</span>
          <span class="tag">Link budget</span>
          <span class="tag">Industrial relevance</span>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <nav class="toc" aria-label="Table of Contents">
        <h2>
          <span>Table of Contents</span>
          <span class="pill">Sticky</span>
        </h2>
        <a href="#quick">Quick Summary</a>
        <a href="#primer">PART 0 — Concept Primer</a>
        <a href="#industry">PART 0B — Industry &amp; Applied Physics Perspective</a>
        <a href="#analysis">PART 1 — Problem Analysis</a>
        <a href="#strategy">PART 2 — Strategy &amp; Tips</a>
        <a href="#solution">PART 3 — Full Solution</a>
        <a href="#deeper">PART 4 — Deeper Understanding</a>
        <a href="#plotguide">PART 5 — Optional Plot Guide</a>
        <div class="back">
          <a href="#top" title="Back to top">↑ Back to top</a>
          <a href="#final" title="Jump to final answer">↘ Final answer</a>
        </div>
      </nav>

      <article>
        <section id="quick">
          <h2>Quick Summary</h2>
          <ul>
            <li><strong>What this problem is about:</strong> Find the <strong>maximum fiber length</strong> of an analog intensity-modulated optical link limited only by <strong>fiber attenuation</strong>.</li>
            <li><strong>Key physics idea:</strong> For direct detection, the dominant noise (here) is <strong>photodetection shot noise</strong>; for an APD it is amplified and includes an <strong>excess noise factor</strong> <span style="font-family:var(--mono)">F</span>.</li>
            <li><strong>Core governing relation (shot-noise-limited SNR):</strong> in bandwidth <span style="font-family:var(--mono)">B</span>, SNR scales as
              <span style="font-family:var(--mono)">SNR ∝ (R·P̄·m²)/(q·F·B)</span> (details in Part 3).</li>
            <li><strong>Optical power sensitivity:</strong> required average received power <span style="font-family:var(--mono)">P̄_req</span> that achieves the specified SNR.</li>
            <li><strong>Link budget conversion:</strong> attenuation <span style="font-family:var(--mono)">α</span> (dB/km) gives
              <span style="font-family:var(--mono)">L_max = (10/α)·log10(P_tx/P̄_req)</span>.</li>
            <li><strong>Result type:</strong> Numeric (all values are provided).</li>
            <li><strong>Physical meaning:</strong> The link can be this long before optical power drops so low that shot noise prevents meeting the required analog SNR.</li>
            <li><strong>Industrial takeaway:</strong> Even with APD gain, shot-noise-limited SNR can become <em>gain-independent</em>; improving SNR often means more optical power, lower bandwidth, higher responsivity, or lower excess noise.</li>
          </ul>

          <div class="callouts">
            <div class="box ans" id="final">
              <strong>Final numeric results (preview):</strong>
              <div class="kpi" role="group" aria-label="Key results">
                <div class="tile">
                  <div class="label">Required received average optical power</div>
                  <div class="value">P̄<sub>req</sub> ≈ 2.56 μW</div>
                </div>
                <div class="tile">
                  <div class="label">Attenuation-limited maximum length</div>
                  <div class="value">L<sub>max</sub> ≈ 6.36 km</div>
                </div>
                <div class="tile">
                  <div class="label">Given fiber attenuation</div>
                  <div class="value">α = 2.5 dB/km</div>
                </div>
              </div>
              <div class="eqrow" style="margin-top:10px">
                <button class="copy" data-copy="Required received average optical power: P_req ≈ 2.56e-6 W (2.56 μW)
Maximum fiber length (attenuation-limited): L_max ≈ 6.36 km">
                  ⧉ Copy final answer (plain text)
                </button>
              </div>
            </div>
          </div>
        </section>

        <section id="primer">
          <h2>PART 0 — Concept Primer (Theory Before Solving)</h2>

          <h3>0.1 Core definitions (symbols and SI units)</h3>
          <ul>
            <li><strong>Bandwidth</strong> <span style="font-family:var(--mono)">B</span> (Hz): the electrical noise-equivalent bandwidth over which SNR is specified (here 10 MHz).</li>
            <li><strong>Signal-to-noise ratio</strong> <span style="font-family:var(--mono)">SNR</span> (unitless): ratio of signal power to noise power in bandwidth <span style="font-family:var(--mono)">B</span>. In dB: <span style="font-family:var(--mono)">SNR_dB = 10 log10(SNR)</span>.</li>
            <li><strong>Average optical power</strong> <span style="font-family:var(--mono)">P̄</span> (W): the time-averaged received optical power.</li>
            <li><strong>Modulation index</strong> <span style="font-family:var(--mono)">m</span> (unitless): for intensity modulation, a common model is
              <span style="font-family:var(--mono)">P(t) = P̄ [1 + m cos(ωt)]</span>, with <span style="font-family:var(--mono)">0 ≤ m ≤ 1</span>.</li>
            <li><strong>Responsivity</strong> <span style="font-family:var(--mono)">R</span> (A/W): converts optical power to primary photocurrent (before APD gain). Here it is stated <em>excluding</em> the gain.</li>
            <li><strong>APD mean gain</strong> <span style="font-family:var(--mono)">G</span> (unitless): average internal multiplication of photocurrent.</li>
            <li><strong>Excess noise factor</strong> <span style="font-family:var(--mono)">F</span> (unitless): models stochastic multiplication noise in APDs; <span style="font-family:var(--mono)">F ≥ 1</span>.</li>
            <li><strong>Electron charge</strong> <span style="font-family:var(--mono)">q</span> (C): <span style="font-family:var(--mono)">q ≈ 1.602×10⁻¹⁹ C</span>.</li>
            <li><strong>Fiber attenuation</strong> <span style="font-family:var(--mono)">α</span> (dB/km): power loss per unit length in decibels.</li>
          </ul>

          <h3>0.2 Physical meaning (intuition)</h3>
          <p>
            In direct detection, the photodiode measures optical <em>power</em> by producing current. Electron arrivals are discrete, creating unavoidable
            <strong>shot noise</strong>. In an APD, internal gain boosts current, but its randomness adds extra noise captured by <span style="font-family:var(--mono)">F</span>.
          </p>

          <h3>0.3 Key principles and validity conditions</h3>
          <div class="callouts">
            <div class="box assump">
              <strong>Validity conditions:</strong>
              <ul>
                <li>Receiver noise dominated by shot noise (thermal/amplifier noise negligible, as stated).</li>
                <li>Linear regime (no saturation; modulation treated linearly).</li>
                <li>Noise approximately white across bandwidth <span style="font-family:var(--mono)">B</span>.</li>
                <li>APD modeled by mean gain <span style="font-family:var(--mono)">G</span> and excess noise factor <span style="font-family:var(--mono)">F</span>.</li>
              </ul>
            </div>
          </div>

          <h3>0.4 Common models/approximations (why used)</h3>
          <ul>
            <li><strong>Sinusoidal IM:</strong> <span style="font-family:var(--mono)">P(t)=P̄[1+m cos(ωt)]</span> simplifies analog SNR calculation.</li>
            <li><strong>APD shot noise:</strong> <span style="font-family:var(--mono)">i_n² = 2 q I_p G² F B</span> captures multiplication noise without microscopic modeling.</li>
            <li><strong>dB attenuation:</strong> <span style="font-family:var(--mono)">P_rx = P_tx·10^(-αL/10)</span> makes the length relation linear in log space.</li>
          </ul>

          <h3>0.5 Mini intuition examples</h3>
          <ul>
            <li>Double <span style="font-family:var(--mono)">B</span> → double noise power → need ~2× received power to keep SNR.</li>
            <li>Halve <span style="font-family:var(--mono)">m</span> → signal amplitude halves → SNR drops by factor 4 (≈ 6 dB).</li>
            <li>In shot-noise limit, raising <span style="font-family:var(--mono)">G</span> often does <em>not</em> improve SNR because signal and noise scale similarly; <span style="font-family:var(--mono)">F</span> remains.</li>
          </ul>

          <h3>0.6 What to watch for (pitfalls)</h3>
          <div class="callouts">
            <div class="box mist">
              <strong>Pitfalls:</strong>
              <ul>
                <li>Confusing average power <span style="font-family:var(--mono)">P̄</span> with modulation amplitude <span style="font-family:var(--mono)">mP̄</span>.</li>
                <li>Forgetting sinusoid RMS factor (peak/√2).</li>
                <li>Using <span style="font-family:var(--mono)">20 log10</span> for SNR (should be <span style="font-family:var(--mono)">10 log10</span>).</li>
                <li>Dropping the APD excess noise factor <span style="font-family:var(--mono)">F</span>.</li>
              </ul>
            </div>
          </div>

          <details>
            <summary>Optional deeper note: why analog links can be demanding</summary>
            <p>
              Analog links often require high SNR across a bandwidth and high linearity. Unlike digital links (where decisions and coding can help),
              analog fidelity depends directly on noise and distortion, pushing requirements on optical power, detector noise, and component linearity.
            </p>
          </details>
        </section>

        <section id="industry">
          <h2>PART 0B — Industry &amp; Applied Physics Perspective</h2>

          <h3>Where this appears in industry</h3>
          <ul>
            <li><strong>RF-over-fiber / antenna remoting:</strong> distributing analog RF signals with controlled SNR and dynamic range.</li>
            <li><strong>Industrial instrumentation:</strong> EMI-immune analog telemetry in factories, substations, high-voltage test labs.</li>
            <li><strong>CATV &amp; broadband distribution:</strong> analog modulation requires stringent noise and distortion budgets.</li>
          </ul>

          <h3>Why engineers care</h3>
          <ul>
            <li><strong>Performance:</strong> SNR sets measurement fidelity and RF dynamic range.</li>
            <li><strong>Reliability:</strong> link margin covers aging, contamination, bending, temperature drift.</li>
            <li><strong>Cost &amp; manufacturability:</strong> longer reach can force better fiber, more launch power, optical amplification, or better receivers.</li>
          </ul>

          <h3>Typical measurement/validation methods</h3>
          <ul>
            <li>Measure launch/received power with calibrated optical power meters.</li>
            <li>Measure SNR/noise floor using spectrum analyzers over specified bandwidth.</li>
            <li>Characterize APD gain and excess noise versus bias and temperature.</li>
          </ul>

          <h3>Design trade-offs and constraints</h3>
          <ul>
            <li><strong>Bandwidth vs reach:</strong> larger <span style="font-family:var(--mono)">B</span> reduces reach unless power increases.</li>
            <li><strong>Gain vs excess noise:</strong> higher APD gain can raise <span style="font-family:var(--mono)">F</span> and may not improve shot-noise-limited SNR.</li>
            <li><strong>Modulation depth vs linearity:</strong> larger <span style="font-family:var(--mono)">m</span> boosts SNR but risks distortion/saturation.</li>
            <li><strong>Non-ideal losses:</strong> connectors/splices/bends add extra dB loss beyond fiber attenuation.</li>
          </ul>

          <details>
            <summary>From lab to product: adapting the ideal model</summary>
            <p>
              Real link budgets add connector/splice insertion loss, coupling loss, laser RIN, APD dark current, thermal noise, and margin (often 3–6 dB).
              The clean equations become a margin-driven specification to ensure yield and reliability across environments.
            </p>
          </details>
        </section>

        <section id="analysis">
          <h2>PART 1 — Problem Analysis (No Solving Yet)</h2>

          <h3>1.1 Restate the problem</h3>
          <p>
            Given an intensity-modulated analog optical link with specified bandwidth and required SNR, an LED launch power, and an APD receiver
            (shot-noise-limited), find the maximum fiber length before attenuation reduces received power below the receiver sensitivity required to meet SNR.
          </p>

          <h3>1.2 Given quantities</h3>
          <ul>
            <li><span style="font-family:var(--mono)">B = 10 MHz = 1.0×10⁷ Hz</span></li>
            <li><span style="font-family:var(--mono)">SNR = 40 dB</span></li>
            <li><span style="font-family:var(--mono)">P_tx = 100 μW = 1.0×10⁻⁴ W</span></li>
            <li><span style="font-family:var(--mono)">m = 0.5</span></li>
            <li><span style="font-family:var(--mono)">α = 2.5 dB/km</span></li>
            <li><span style="font-family:var(--mono)">R = 0.5 A/W</span>, <span style="font-family:var(--mono)">G = 100</span>, <span style="font-family:var(--mono)">F = 5</span></li>
          </ul>

          <h3>1.3 Unknowns</h3>
          <ul>
            <li>Required received average optical power <span style="font-family:var(--mono)">P̄_req</span>.</li>
            <li>Maximum length <span style="font-family:var(--mono)">L_max</span>.</li>
          </ul>

          <h3>1.4 Relevant principles</h3>
          <ul>
            <li>Shot-noise-limited APD detection with excess noise factor.</li>
            <li>Sinusoidal intensity modulation (modulation index gives AC amplitude).</li>
            <li>Fiber attenuation in dB/km for link budget.</li>
          </ul>

          <h3>1.5 Assumptions</h3>
          <div class="callouts">
            <div class="box assump">
              <strong>Assumptions:</strong>
              <ul>
                <li>No connector/splice/coupling losses; only fiber attenuation.</li>
                <li>Circuit noise negligible (as stated).</li>
                <li>No dispersion limit considered (question asks attenuation-limited).</li>
                <li>Linear IM and linear receiver behavior (no saturation).</li>
              </ul>
            </div>
          </div>

          <h3>1.6 Approaches compared</h3>
          <ul>
            <li><strong>Direct SNR from shot noise:</strong> fastest, most transparent, matches given APD model.</li>
            <li><strong>NEP method:</strong> practical engineering framing, but algebraically similar.</li>
            <li><strong>Photon-counting statistics:</strong> deeper, but unnecessary since responsivity and APD noise model are given.</li>
          </ul>
          <p><strong>Choice:</strong> Direct SNR approach.</p>
        </section>

        <section id="strategy">
          <h2>PART 2 — Strategy &amp; Tips (Roadmap Only)</h2>
          <ol style="margin:8px 0 0 20px; color:var(--muted)">
            <li>Convert <span style="font-family:var(--mono)">40 dB</span> to linear SNR.</li>
            <li>Write <span style="font-family:var(--mono)">P(t)=P̄[1+m cos(ωt)]</span> and convert to signal current RMS at APD output.</li>
            <li>Write APD shot noise <span style="font-family:var(--mono)">i_n²=2qI_pG²FB</span> with <span style="font-family:var(--mono)">I_p=RP̄</span>.</li>
            <li>Form <span style="font-family:var(--mono)">SNR = i_s,rms² / i_n²</span>; simplify and solve for <span style="font-family:var(--mono)">P̄_req</span>.</li>
            <li>Use attenuation law <span style="font-family:var(--mono)">P̄_rx=P_tx·10^(-αL/10)</span> and set <span style="font-family:var(--mono)">P̄_rx=P̄_req</span>.</li>
            <li>Solve for <span style="font-family:var(--mono)">L_max</span> and sanity-check.</li>
          </ol>

          <div class="callouts">
            <div class="box mist">
              <strong>Common mistakes:</strong>
              <ul>
                <li>Forgetting sinusoid RMS factor (<span style="font-family:var(--mono)">1/√2</span>).</li>
                <li>Using wrong dB conversion for SNR.</li>
                <li>Applying APD gain twice (responsivity is given excluding gain).</li>
                <li>Ignoring <span style="font-family:var(--mono)">F</span>.</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="solution">
          <h2>PART 3 — Full Solution (Detailed + Teaching)</h2>

          <h3>3.1 Convert SNR from dB to linear</h3>
          <div class="eqline">SNR = 10^(SNR_dB/10) = 10^(40/10) = 10^4 = 10000</div>

          <h3>3.2 Signal current from intensity modulation</h3>
          <p>Model the received optical power as:</p>
          <div class="eqline">P(t) = P̄ [1 + m cos(ωt)]</div>
          <p>Primary (unmultiplied) average photocurrent:</p>
          <div class="eqline">I_p = R P̄</div>
          <p>After APD gain, the AC signal current (peak amplitude) is:</p>
          <div class="eqline">i_s(peak) = G · R · m · P̄</div>
          <p>For a sinusoid, RMS current is peak/√2:</p>
          <div class="eqline">i_s,rms = (G R m P̄)/√2</div>

          <h3>3.3 APD shot noise (with excess noise factor)</h3>
          <p>Mean-square noise current in bandwidth <span style="font-family:var(--mono)">B</span>:</p>
          <div class="eqline">i_n^2 = 2 q I_p G^2 F B = 2 q (R P̄) G^2 F B</div>

          <div class="callouts">
            <div class="box eq">
              <strong>Key equation (SNR) + Copy:</strong>
              <div class="eqline" id="eqSNR">
SNR = (i_s,rms^2)/(i_n^2)
    = [ (G R m P̄)^2 / 2 ] / [ 2 q (R P̄) G^2 F B ]</div>
              <div class="eqrow">
                <button class="copy" data-copy="SNR = (i_s,rms^2)/(i_n^2) = [ (G*R*m*P_bar)^2 / 2 ] / [ 2*q*(R*P_bar)*G^2*F*B ]">
                  ⧉ Copy key equation (plain text)
                </button>
              </div>
            </div>
          </div>

          <h3>3.4 Simplify SNR and solve for receiver sensitivity</h3>
          <p>
            Simplify the expression:
            <span style="font-family:var(--mono)">G²</span> cancels and one factor of <span style="font-family:var(--mono)">R P̄</span> cancels, giving:
          </p>
          <div class="eqline">SNR = (R P̄ m^2) / (4 q F B)</div>

          <p>Therefore, the required average received optical power is:</p>
          <div class="eqline">P̄_req = (4 q F B · SNR) / (R m^2)</div>

          <h3>3.5 Insert numbers</h3>
          <ul>
            <li><span style="font-family:var(--mono)">q = 1.602×10⁻¹⁹ C</span></li>
            <li><span style="font-family:var(--mono)">F = 5</span></li>
            <li><span style="font-family:var(--mono)">B = 1.0×10⁷ Hz</span></li>
            <li><span style="font-family:var(--mono)">SNR = 10000</span></li>
            <li><span style="font-family:var(--mono)">R = 0.5 A/W</span></li>
            <li><span style="font-family:var(--mono)">m = 0.5 ⇒ m² = 0.25</span></li>
          </ul>

          <div class="eqline">P̄_req = [4(1.602×10⁻¹⁹)(5)(1.0×10⁷)(1.0×10⁴)] / [(0.5)(0.25)]</div>
          <div class="eqline">4 q F B SNR = 4·1.602×10⁻¹⁹·5·10⁷·10⁴ = 3.204×10⁻⁷</div>
          <div class="eqline">R m² = 0.5·0.25 = 0.125</div>
          <div class="eqline">P̄_req = (3.204×10⁻⁷)/0.125 = 2.56×10⁻⁶ W = 2.56 μW</div>

          <h3>3.6 Convert sensitivity to maximum fiber length (attenuation-limited)</h3>
          <p>Fiber attenuation law (dB/km):</p>
          <div class="eqline">P̄_rx(L) = P_tx · 10^(-αL/10)</div>
          <p>Set <span style="font-family:var(--mono)">P̄_rx(L_max)=P̄_req</span>:</p>
          <div class="eqline">L_max = (10/α) · log10(P_tx / P̄_req)</div>

          <p>Insert <span style="font-family:var(--mono)">P_tx = 100 μW = 1.0×10⁻⁴ W</span>, <span style="font-family:var(--mono)">P̄_req = 2.56×10⁻⁶ W</span>, <span style="font-family:var(--mono)">α=2.5 dB/km</span>:</p>
          <div class="eqline">P_tx / P̄_req = (1.0×10⁻⁴)/(2.56×10⁻⁶) ≈ 39.0</div>
          <div class="eqline">log10(39.0) ≈ 1.591</div>
          <div class="eqline">L_max = (10/2.5)·1.591 = 4·1.591 ≈ 6.36 km</div>

          <div class="callouts">
            <div class="box ans" id="final">
              <strong>Final Answer (boxed):</strong>
              <div class="eqline">Required received average optical power: P̄_req ≈ 2.56 μW</div>
              <div class="eqline">Attenuation-limited maximum fiber length: L_max ≈ 6.36 km</div>
              <div class="eqrow">
                <button class="copy" data-copy="P_bar_req ≈ 2.56×10^-6 W (2.56 μW)
L_max ≈ 6.36 km (attenuation-limited, shot-noise-limited APD with F=5)">
                  ⧉ Copy final answer (plain text)
                </button>
              </div>
            </div>
          </div>

          <h3>3.7 Sanity checks</h3>
          <ul>
            <li><strong>Units:</strong> <span style="font-family:var(--mono)">qB</span> has units of A; dividing by <span style="font-family:var(--mono)">R</span> (A/W) gives W → correct.</li>
            <li><strong>Limiting cases:</strong> Larger <span style="font-family:var(--mono)">B</span> or required SNR increases <span style="font-family:var(--mono)">P̄_req</span> → shorter length, consistent.</li>
            <li><strong>Gain independence:</strong> <span style="font-family:var(--mono)">G</span> cancels in the shot-noise limit, matching APD theory; <span style="font-family:var(--mono)">F</span> remains as penalty.</li>
          </ul>

          <figure class="plotcard" aria-label="Received optical power versus fiber length">
            <div class="plothead">
              <div>
                <p class="t" style="margin:0">Single static plot: Received power vs length (attenuation) with sensitivity threshold</p>
                <p class="s">Uses the actual problem values and marks where <span style="font-family:var(--mono)">P̄_rx(L)</span> crosses <span style="font-family:var(--mono)">P̄_req</span>.</p>
              </div>
            </div>
            <canvas id="plot" width="1200" height="420" role="img" aria-label="Plot of received power (microW) vs length (km) with threshold"></canvas>
          </figure>
        </section>

        <section id="deeper">
          <h2>PART 4 — Deeper Understanding (Theory Around the Result)</h2>

          <h3>4.1 What each term controls</h3>
          <div class="eqline">P̄_req = (4 q F B · SNR) / (R m^2)</div>
          <ul>
            <li><strong>Increase <span style="font-family:var(--mono)">B</span>:</strong> more noise integrated → higher required power.</li>
            <li><strong>Increase required SNR:</strong> proportional increase in required power.</li>
            <li><strong>Increase <span style="font-family:var(--mono)">R</span> or <span style="font-family:var(--mono)">m</span>:</strong> larger signal current → lower required power (note <span style="font-family:var(--mono)">m²</span>).</li>
            <li><strong>Increase <span style="font-family:var(--mono)">F</span>:</strong> worse multiplication noise → higher required power.</li>
          </ul>

          <h3>4.2 Alternative derivation (NEP idea)</h3>
          <p>
            Compute an equivalent noise current spectral density from shot noise, refer it to equivalent optical power noise via responsivity,
            and require signal power in bandwidth <span style="font-family:var(--mono)">B</span> to exceed noise by the specified SNR. This yields the same scaling and constants.
          </p>

          <h3>4.3 Concept check (Q&amp;A)</h3>
          <ul>
            <li><strong>Q:</strong> Why doesn’t higher APD gain improve SNR here? <strong>A:</strong> Because in shot-noise-limited operation, both signal and shot noise scale with gain, so SNR becomes gain-independent (but still penalized by <span style="font-family:var(--mono)">F</span>).</li>
            <li><strong>Q:</strong> What would reduce the real-world maximum length versus this calculation? <strong>A:</strong> Connector/splice loss, coupling loss, bending loss, APD dark current, thermal noise, laser RIN, and required engineering margin.</li>
            <li><strong>Q:</strong> Why does <span style="font-family:var(--mono)">m</span> matter so strongly? <strong>A:</strong> Because SNR ∝ <span style="font-family:var(--mono)">m²</span>; small reductions in modulation depth can cost many dB.</li>
          </ul>

          <div class="callouts">
            <div class="box eq">
              <strong>Equation bundle (copyable):</strong>
              <div class="eqline">SNR = (R·P̄·m²)/(4 q F B)</div>
              <div class="eqline">P̄_req = (4 q F B · SNR)/(R m²)</div>
              <div class="eqline">L_max = (10/α)·log10(P_tx/P̄_req)</div>
              <div class="eqrow">
                <button class="copy" data-copy="SNR = (R*P_bar*m^2)/(4*q*F*B)
P_bar_req = (4*q*F*B*SNR)/(R*m^2)
L_max = (10/alpha_dB_per_km)*log10(P_tx/P_bar_req)">
                  ⧉ Copy equations (plain text)
                </button>
              </div>
            </div>
          </div>

          <p><a href="#top">↑ Back to top</a></p>
        </section>

        <section id="plotguide">
          <h2>PART 5 — Optional Plot Guide (Because a Plot Exists)</h2>
          <ul>
            <li><strong>What it shows:</strong> Exponential decay of received power with fiber length plus a horizontal sensitivity threshold.</li>
            <li><strong>Axes:</strong> Length <span style="font-family:var(--mono)">L</span> (km) vs received average power <span style="font-family:var(--mono)">P̄_rx</span> (μW).</li>
            <li><strong>Notable feature:</strong> Intersection point indicates <span style="font-family:var(--mono)">L_max</span>.</li>
            <li><strong>Values used:</strong> These are the actual problem values (not example values).</li>
          </ul>
          <p><a href="#top">↑ Back to top</a></p>
        </section>
      </article>
    </div>
  </main>

  <footer>
    <div class="footgrid">
      <div>
        <strong>Note:</strong> This is an attenuation-only, shot-noise-limited result. Real systems typically include additional loss and noise terms and require margin.
      </div>
      <div><a href="#top">Back to top</a></div>
    </div>
  </footer>

  <div class="toast" id="toast" role="status" aria-live="polite">Copied.</div>

  <script>
    (function(){
      const toast = document.getElementById('toast');
      function showToast(msg){
        toast.textContent = msg || "Copied.";
        toast.classList.add('show');
        clearTimeout(showToast._t);
        showToast._t = setTimeout(()=>toast.classList.remove('show'), 1200);
      }
      async function copyText(txt){
        try{
          await navigator.clipboard.writeText(txt);
          showToast("Copied to clipboard.");
        }catch(e){
          const ta = document.createElement('textarea');
          ta.value = txt;
          ta.setAttribute('readonly','');
          ta.style.position='fixed';
          ta.style.left='-9999px';
          document.body.appendChild(ta);
          ta.select();
          try{ document.execCommand('copy'); showToast("Copied to clipboard."); }
          catch(err){ showToast("Copy failed."); }
          document.body.removeChild(ta);
        }
      }
      document.addEventListener('click', (ev)=>{
        const btn = ev.target.closest('button.copy');
        if(!btn) return;
        const txt = btn.getAttribute('data-copy') || '';
        copyText(txt.trim());
      });

      // ---- Single static canvas plot (high-DPI, responsive) ----
      const canvas = document.getElementById('plot');
      const ctx = canvas.getContext('2d');

      const params = {
        Ptx_uW: 100.0,
        alpha_dB_per_km: 2.5,
        Preq_uW: 2.56,
        Lmax_km: 6.36
      };

      function niceTicks(min, max, n){
        const span = max - min;
        const raw = span / Math.max(1, n);
        const pow10 = Math.pow(10, Math.floor(Math.log10(raw)));
        const candidates = [1,2,5,10].map(m=>m*pow10);
        let step = candidates[0];
        for(const c of candidates){
          if(Math.abs(c-raw) < Math.abs(step-raw)) step = c;
        }
        const start = Math.ceil(min/step)*step;
        const ticks = [];
        for(let v=start; v<=max+1e-9; v+=step) ticks.push(v);
        return {step, ticks};
      }

      function roundRect(c, x, y, w, h, r){
        const rr = Math.min(r, w/2, h/2);
        c.beginPath();
        c.moveTo(x+rr, y);
        c.arcTo(x+w, y, x+w, y+h, rr);
        c.arcTo(x+w, y+h, x, y+h, rr);
        c.arcTo(x, y+h, x, y, rr);
        c.arcTo(x, y, x+w, y, rr);
        c.closePath();
      }

      function draw(){
        const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
        const rect = canvas.getBoundingClientRect();
        const w = Math.max(320, rect.width);
        const h = rect.height;

        canvas.width = Math.round(w * dpr);
        canvas.height = Math.round(h * dpr);
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);

        const pad = {l:58, r:18, t:24, b:46};
        const x0 = pad.l, y0 = pad.t, x1 = w - pad.r, y1 = h - pad.b;
        const pw = x1 - x0, ph = y1 - y0;

        const Lmin = 0, Lmax = 10;
        const Pmin = 0, Pmax = 100;

        function X(L){ return x0 + (L - Lmin) * pw / (Lmax - Lmin); }
        function Y(P){ return y1 - (P - Pmin) * ph / (Pmax - Pmin); }

        ctx.clearRect(0,0,w,h);
        const bg = ctx.createLinearGradient(0,0,0,h);
        bg.addColorStop(0, 'rgba(255,255,255,0.02)');
        bg.addColorStop(1, 'rgba(0,0,0,0.00)');
        ctx.fillStyle = bg;
        ctx.fillRect(0,0,w,h);

        const xt = niceTicks(Lmin, Lmax, 10);
        const yt = niceTicks(Pmin, Pmax, 6);

        // grid
        ctx.lineWidth = 1;
        ctx.strokeStyle = 'rgba(255,255,255,0.10)';
        ctx.beginPath();
        xt.ticks.forEach(v=>{
          const xx = X(v);
          ctx.moveTo(xx, y0);
          ctx.lineTo(xx, y1);
        });
        yt.ticks.forEach(v=>{
          const yy = Y(v);
          ctx.moveTo(x0, yy);
          ctx.lineTo(x1, yy);
        });
        ctx.stroke();

        // axes
        ctx.strokeStyle = 'rgba(255,255,255,0.22)';
        ctx.lineWidth = 1.25;
        ctx.beginPath();
        ctx.moveTo(x0, y0);
        ctx.lineTo(x0, y1);
        ctx.lineTo(x1, y1);
        ctx.stroke();

        // ticks & labels
        ctx.fillStyle = 'rgba(234,240,255,0.88)';
        ctx.font = '700 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        xt.ticks.forEach(v=>{
          const xx = X(v);
          ctx.strokeStyle = 'rgba(255,255,255,0.25)';
          ctx.beginPath();
          ctx.moveTo(xx, y1);
          ctx.lineTo(xx, y1+6);
          ctx.stroke();
          ctx.fillText(String(v.toFixed(0)), xx, y1+8);
        });

        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        yt.ticks.forEach(v=>{
          const yy = Y(v);
          ctx.strokeStyle = 'rgba(255,255,255,0.25)';
          ctx.beginPath();
          ctx.moveTo(x0-6, yy);
          ctx.lineTo(x0, yy);
          ctx.stroke();
          ctx.fillText(String(v.toFixed(0)), x0-10, yy);
        });

        // axis titles
        ctx.fillStyle = 'rgba(234,240,255,0.92)';
        ctx.font = '800 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText('Fiber length L (km)', x0 + pw/2, h - 10);

        ctx.save();
        ctx.translate(16, y0 + ph/2);
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText('Received average optical power P̄_rx (μW)', 0, 0);
        ctx.restore();

        // title
        ctx.fillStyle = 'rgba(234,240,255,0.92)';
        ctx.font = '900 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'top';
        ctx.fillText('Attenuation curve and sensitivity threshold', x0, 6);

        // curve
        const Ptx = params.Ptx_uW;
        const alpha = params.alpha_dB_per_km;
        ctx.strokeStyle = 'rgba(124,242,199,0.88)';
        ctx.lineWidth = 2.25;
        ctx.beginPath();
        const N = 350;
        for(let i=0;i<=N;i++){
          const L = Lmin + (Lmax - Lmin) * (i/N);
          const P = Ptx * Math.pow(10, -(alpha*L)/10);
          const xx = X(L);
          const yy = Y(Math.max(Pmin, Math.min(Pmax, P)));
          if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
        }
        ctx.stroke();

        // threshold
        const Preq = params.Preq_uW;
        ctx.strokeStyle = 'rgba(255,210,122,0.85)';
        ctx.lineWidth = 1.8;
        ctx.setLineDash([6,5]);
        ctx.beginPath();
        ctx.moveTo(x0, Y(Preq));
        ctx.lineTo(x1, Y(Preq));
        ctx.stroke();
        ctx.setLineDash([]);

        // intersection marker
        const Lm = params.Lmax_km;
        const Pm = Ptx * Math.pow(10, -(alpha*Lm)/10);
        const xi = X(Lm), yi = Y(Pm);
        ctx.fillStyle = 'rgba(255,255,255,0.92)';
        ctx.beginPath();
        ctx.arc(xi, yi, 4.6, 0, Math.PI*2);
        ctx.fill();

        // legend
        const lx = x1 - 248, ly = y0 + 10;
        ctx.fillStyle = 'rgba(17,26,51,0.72)';
        ctx.strokeStyle = 'rgba(255,255,255,0.14)';
        ctx.lineWidth = 1;
        roundRect(ctx, lx, ly, 238, 70, 12);
        ctx.fill(); ctx.stroke();

        ctx.font = '700 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';

        ctx.strokeStyle = 'rgba(124,242,199,0.88)';
        ctx.lineWidth = 2.25;
        ctx.beginPath(); ctx.moveTo(lx+12, ly+20); ctx.lineTo(lx+44, ly+20); ctx.stroke();
        ctx.fillStyle = 'rgba(234,240,255,0.88)';
        ctx.fillText('P̄_rx(L) from attenuation', lx+54, ly+20);

        ctx.strokeStyle = 'rgba(255,210,122,0.85)';
        ctx.lineWidth = 1.8;
        ctx.setLineDash([6,5]);
        ctx.beginPath(); ctx.moveTo(lx+12, ly+42); ctx.lineTo(lx+44, ly+42); ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillStyle = 'rgba(234,240,255,0.88)';
        ctx.fillText('Sensitivity P̄_req ≈ 2.56 μW', lx+54, ly+42);

        ctx.fillStyle = 'rgba(234,240,255,0.92)';
        ctx.font = '800 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';
        ctx.fillText(`L_max ≈ ${Lm.toFixed(2)} km`, lx+12, ly+62);
      }

      window.addEventListener('resize', draw, {passive:true});
      draw();
    })();
  </script>
</body>
</html>
